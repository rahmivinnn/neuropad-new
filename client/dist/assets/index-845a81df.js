function _mergeNamespaces(e,i){for(var c=0;c<i.length;c++){const b=i[c];if(typeof b!="string"&&!Array.isArray(b)){for(const $ in b)if($!=="default"&&!($ in e)){const it=Object.getOwnPropertyDescriptor(b,$);it&&Object.defineProperty(e,$,it.get?it:{enumerable:!0,get:()=>b[$]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const $ of document.querySelectorAll('link[rel="modulepreload"]'))b($);new MutationObserver($=>{for(const it of $)if(it.type==="childList")for(const at of it.addedNodes)at.tagName==="LINK"&&at.rel==="modulepreload"&&b(at)}).observe(document,{childList:!0,subtree:!0});function c($){const it={};return $.integrity&&(it.integrity=$.integrity),$.referrerPolicy&&(it.referrerPolicy=$.referrerPolicy),$.crossOrigin==="use-credentials"?it.credentials="include":$.crossOrigin==="anonymous"?it.credentials="omit":it.credentials="same-origin",it}function b($){if($.ep)return;$.ep=!0;const it=c($);fetch($.href,it)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r$1=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(e){return e===null||typeof e!="object"?null:(e=z$1&&e[z$1]||e["@@iterator"],typeof e=="function"?e:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(e,i,c){this.props=e,this.context=i,this.refs=D$1,this.updater=c||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(e,i){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,i,"setState")};E$1.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(e,i,c){this.props=e,this.context=i,this.refs=D$1,this.updater=c||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(e,i,c){var b,$={},it=null,at=null;if(i!=null)for(b in i.ref!==void 0&&(at=i.ref),i.key!==void 0&&(it=""+i.key),i)J.call(i,b)&&!L$1.hasOwnProperty(b)&&($[b]=i[b]);var h=arguments.length-2;if(h===1)$.children=c;else if(1<h){for(var dt=Array(h),ft=0;ft<h;ft++)dt[ft]=arguments[ft+2];$.children=dt}if(e&&e.defaultProps)for(b in h=e.defaultProps,h)$[b]===void 0&&($[b]=h[b]);return{$$typeof:l$1,type:e,key:it,ref:at,props:$,_owner:K$1.current}}function N$1(e,i){return{$$typeof:l$1,type:e.type,key:i,ref:e.ref,props:e.props,_owner:e._owner}}function O$1(e){return typeof e=="object"&&e!==null&&e.$$typeof===l$1}function escape(e){var i={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(c){return i[c]})}var P$1=/\/+/g;function Q$1(e,i){return typeof e=="object"&&e!==null&&e.key!=null?escape(""+e.key):i.toString(36)}function R$1(e,i,c,b,$){var it=typeof e;(it==="undefined"||it==="boolean")&&(e=null);var at=!1;if(e===null)at=!0;else switch(it){case"string":case"number":at=!0;break;case"object":switch(e.$$typeof){case l$1:case n$1:at=!0}}if(at)return at=e,$=$(at),e=b===""?"."+Q$1(at,0):b,I$1($)?(c="",e!=null&&(c=e.replace(P$1,"$&/")+"/"),R$1($,i,c,"",function(ft){return ft})):$!=null&&(O$1($)&&($=N$1($,c+(!$.key||at&&at.key===$.key?"":(""+$.key).replace(P$1,"$&/")+"/")+e)),i.push($)),1;if(at=0,b=b===""?".":b+":",I$1(e))for(var h=0;h<e.length;h++){it=e[h];var dt=b+Q$1(it,h);at+=R$1(it,i,c,dt,$)}else if(dt=A$1(e),typeof dt=="function")for(e=dt.call(e),h=0;!(it=e.next()).done;)it=it.value,dt=b+Q$1(it,h++),at+=R$1(it,i,c,dt,$);else if(it==="object")throw i=String(e),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return at}function S$1(e,i,c){if(e==null)return e;var b=[],$=0;return R$1(e,b,"","",function(it){return i.call(c,it,$++)}),b}function T$1(e){if(e._status===-1){var i=e._result;i=i(),i.then(function(c){(e._status===0||e._status===-1)&&(e._status=1,e._result=c)},function(c){(e._status===0||e._status===-1)&&(e._status=2,e._result=c)}),e._status===-1&&(e._status=0,e._result=i)}if(e._status===1)return e._result.default;throw e._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$2(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$1,forEach:function(e,i,c){S$1(e,function(){i.apply(this,arguments)},c)},count:function(e){var i=0;return S$1(e,function(){i++}),i},toArray:function(e){return S$1(e,function(i){return i})||[]},only:function(e){if(!O$1(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};react_production_min.Component=E$1;react_production_min.Fragment=p$2;react_production_min.Profiler=r$1;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$2;react_production_min.cloneElement=function(e,i,c){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var b=C$1({},e.props),$=e.key,it=e.ref,at=e._owner;if(i!=null){if(i.ref!==void 0&&(it=i.ref,at=K$1.current),i.key!==void 0&&($=""+i.key),e.type&&e.type.defaultProps)var h=e.type.defaultProps;for(dt in i)J.call(i,dt)&&!L$1.hasOwnProperty(dt)&&(b[dt]=i[dt]===void 0&&h!==void 0?h[dt]:i[dt])}var dt=arguments.length-2;if(dt===1)b.children=c;else if(1<dt){h=Array(dt);for(var ft=0;ft<dt;ft++)h[ft]=arguments[ft+2];b.children=h}return{$$typeof:l$1,type:e.type,key:$,ref:it,props:b,_owner:at}};react_production_min.createContext=function(e){return e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:t,_context:e},e.Consumer=e};react_production_min.createElement=M$1;react_production_min.createFactory=function(e){var i=M$1.bind(null,e);return i.type=e,i};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(e){return{$$typeof:v$1,render:e}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(e){return{$$typeof:y,_payload:{_status:-1,_result:e},_init:T$1}};react_production_min.memo=function(e,i){return{$$typeof:x,type:e,compare:i===void 0?null:i}};react_production_min.startTransition=function(e){var i=V$1.transition;V$1.transition={};try{e()}finally{V$1.transition=i}};react_production_min.unstable_act=X$2;react_production_min.useCallback=function(e,i){return U$1.current.useCallback(e,i)};react_production_min.useContext=function(e){return U$1.current.useContext(e)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(e){return U$1.current.useDeferredValue(e)};react_production_min.useEffect=function(e,i){return U$1.current.useEffect(e,i)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(e,i,c){return U$1.current.useImperativeHandle(e,i,c)};react_production_min.useInsertionEffect=function(e,i){return U$1.current.useInsertionEffect(e,i)};react_production_min.useLayoutEffect=function(e,i){return U$1.current.useLayoutEffect(e,i)};react_production_min.useMemo=function(e,i){return U$1.current.useMemo(e,i)};react_production_min.useReducer=function(e,i,c){return U$1.current.useReducer(e,i,c)};react_production_min.useRef=function(e){return U$1.current.useRef(e)};react_production_min.useState=function(e){return U$1.current.useState(e)};react_production_min.useSyncExternalStore=function(e,i,c){return U$1.current.useSyncExternalStore(e,i,c)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React$2=getDefaultExportFromCjs(reactExports),React$3=_mergeNamespaces({__proto__:null,default:React$2},[reactExports]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(e,i,c){var b,$={},it=null,at=null;c!==void 0&&(it=""+c),i.key!==void 0&&(it=""+i.key),i.ref!==void 0&&(at=i.ref);for(b in i)m$1.call(i,b)&&!p$1.hasOwnProperty(b)&&($[b]=i[b]);if(e&&e.defaultProps)for(b in i=e.defaultProps,i)$[b]===void 0&&($[b]=i[b]);return{$$typeof:k,type:e,key:it,ref:at,props:$,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function i(Ut,Jt){var Or=Ut.length;Ut.push(Jt);e:for(;0<Or;){var Cr=Or-1>>>1,pn=Ut[Cr];if(0<$(pn,Jt))Ut[Cr]=Jt,Ut[Or]=pn,Or=Cr;else break e}}function c(Ut){return Ut.length===0?null:Ut[0]}function b(Ut){if(Ut.length===0)return null;var Jt=Ut[0],Or=Ut.pop();if(Or!==Jt){Ut[0]=Or;e:for(var Cr=0,pn=Ut.length,On=pn>>>1;Cr<On;){var Zn=2*(Cr+1)-1,As=Ut[Zn],ss=Zn+1,Ls=Ut[ss];if(0>$(As,Or))ss<pn&&0>$(Ls,As)?(Ut[Cr]=Ls,Ut[ss]=Or,Cr=ss):(Ut[Cr]=As,Ut[Zn]=Or,Cr=Zn);else if(ss<pn&&0>$(Ls,Or))Ut[Cr]=Ls,Ut[ss]=Or,Cr=ss;else break e}}return Jt}function $(Ut,Jt){var Or=Ut.sortIndex-Jt.sortIndex;return Or!==0?Or:Ut.id-Jt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var it=performance;e.unstable_now=function(){return it.now()}}else{var at=Date,h=at.now();e.unstable_now=function(){return at.now()-h}}var dt=[],ft=[],xt=1,Ct=null,bt=3,kt=!1,Dt=!1,At=!1,Bt=typeof setTimeout=="function"?setTimeout:null,Tt=typeof clearTimeout=="function"?clearTimeout:null,It=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function St(Ut){for(var Jt=c(ft);Jt!==null;){if(Jt.callback===null)b(ft);else if(Jt.startTime<=Ut)b(ft),Jt.sortIndex=Jt.expirationTime,i(dt,Jt);else break;Jt=c(ft)}}function jt(Ut){if(At=!1,St(Ut),!Dt)if(c(dt)!==null)Dt=!0,Xt(Ht);else{var Jt=c(ft);Jt!==null&&mr(jt,Jt.startTime-Ut)}}function Ht(Ut,Jt){Dt=!1,At&&(At=!1,Tt(nr),nr=-1),kt=!0;var Or=bt;try{for(St(Jt),Ct=c(dt);Ct!==null&&(!(Ct.expirationTime>Jt)||Ut&&!Sr());){var Cr=Ct.callback;if(typeof Cr=="function"){Ct.callback=null,bt=Ct.priorityLevel;var pn=Cr(Ct.expirationTime<=Jt);Jt=e.unstable_now(),typeof pn=="function"?Ct.callback=pn:Ct===c(dt)&&b(dt),St(Jt)}else b(dt);Ct=c(dt)}if(Ct!==null)var On=!0;else{var Zn=c(ft);Zn!==null&&mr(jt,Zn.startTime-Jt),On=!1}return On}finally{Ct=null,bt=Or,kt=!1}}var Kt=!1,ir=null,nr=-1,kr=5,br=-1;function Sr(){return!(e.unstable_now()-br<kr)}function $r(){if(ir!==null){var Ut=e.unstable_now();br=Ut;var Jt=!0;try{Jt=ir(!0,Ut)}finally{Jt?rn():(Kt=!1,ir=null)}}else Kt=!1}var rn;if(typeof It=="function")rn=function(){It($r)};else if(typeof MessageChannel<"u"){var Zr=new MessageChannel,Kr=Zr.port2;Zr.port1.onmessage=$r,rn=function(){Kr.postMessage(null)}}else rn=function(){Bt($r,0)};function Xt(Ut){ir=Ut,Kt||(Kt=!0,rn())}function mr(Ut,Jt){nr=Bt(function(){Ut(e.unstable_now())},Jt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Ut){Ut.callback=null},e.unstable_continueExecution=function(){Dt||kt||(Dt=!0,Xt(Ht))},e.unstable_forceFrameRate=function(Ut){0>Ut||125<Ut?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):kr=0<Ut?Math.floor(1e3/Ut):5},e.unstable_getCurrentPriorityLevel=function(){return bt},e.unstable_getFirstCallbackNode=function(){return c(dt)},e.unstable_next=function(Ut){switch(bt){case 1:case 2:case 3:var Jt=3;break;default:Jt=bt}var Or=bt;bt=Jt;try{return Ut()}finally{bt=Or}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Ut,Jt){switch(Ut){case 1:case 2:case 3:case 4:case 5:break;default:Ut=3}var Or=bt;bt=Ut;try{return Jt()}finally{bt=Or}},e.unstable_scheduleCallback=function(Ut,Jt,Or){var Cr=e.unstable_now();switch(typeof Or=="object"&&Or!==null?(Or=Or.delay,Or=typeof Or=="number"&&0<Or?Cr+Or:Cr):Or=Cr,Ut){case 1:var pn=-1;break;case 2:pn=250;break;case 5:pn=1073741823;break;case 4:pn=1e4;break;default:pn=5e3}return pn=Or+pn,Ut={id:xt++,callback:Jt,priorityLevel:Ut,startTime:Or,expirationTime:pn,sortIndex:-1},Or>Cr?(Ut.sortIndex=Or,i(ft,Ut),c(dt)===null&&Ut===c(ft)&&(At?(Tt(nr),nr=-1):At=!0,mr(jt,Or-Cr))):(Ut.sortIndex=pn,i(dt,Ut),Dt||kt||(Dt=!0,Xt(Ht))),Ut},e.unstable_shouldYield=Sr,e.unstable_wrapCallback=function(Ut){var Jt=bt;return function(){var Or=bt;bt=Jt;try{return Ut.apply(this,arguments)}finally{bt=Or}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(e){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+e,c=1;c<arguments.length;c++)i+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+e+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(e,i){ha(e,i),ha(e+"Capture",i)}function ha(e,i){for(ea[e]=i,e=0;e<i.length;e++)da.add(i[e])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(e){return ja.call(ma,e)?!0:ja.call(la,e)?!1:ka.test(e)?ma[e]=!0:(la[e]=!0,!1)}function pa(e,i,c,b){if(c!==null&&c.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return b?!1:c!==null?!c.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function qa(e,i,c,b){if(i===null||typeof i>"u"||pa(e,i,c,b))return!0;if(b)return!1;if(c!==null)switch(c.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function v(e,i,c,b,$,it,at){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=b,this.attributeNamespace=$,this.mustUseProperty=c,this.propertyName=e,this.type=i,this.sanitizeURL=it,this.removeEmptyString=at}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){z[e]=new v(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var i=e[0];z[i]=new v(i,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){z[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){z[e]=new v(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){z[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){z[e]=new v(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){z[e]=new v(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){z[e]=new v(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){z[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var i=e.replace(ra,sa);z[i]=new v(i,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var i=e.replace(ra,sa);z[i]=new v(i,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var i=e.replace(ra,sa);z[i]=new v(i,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){z[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){z[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)});function ta(e,i,c,b){var $=z.hasOwnProperty(i)?z[i]:null;($!==null?$.type!==0:b||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(qa(i,c,$,b)&&(c=null),b||$===null?oa(i)&&(c===null?e.removeAttribute(i):e.setAttribute(i,""+c)):$.mustUseProperty?e[$.propertyName]=c===null?$.type===3?!1:"":c:(i=$.attributeName,b=$.attributeNamespace,c===null?e.removeAttribute(i):($=$.type,c=$===3||$===4&&c===!0?"":""+c,b?e.setAttributeNS(b,i,c):e.setAttribute(i,c))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(e){return e===null||typeof e!="object"?null:(e=Ja&&e[Ja]||e["@@iterator"],typeof e=="function"?e:null)}var A=Object.assign,La;function Ma(e){if(La===void 0)try{throw Error()}catch(c){var i=c.stack.trim().match(/\n( *(at )?)/);La=i&&i[1]||""}return`
`+La+e}var Na=!1;function Oa(e,i){if(!e||Na)return"";Na=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(ft){var b=ft}Reflect.construct(e,[],i)}else{try{i.call()}catch(ft){b=ft}e.call(i.prototype)}else{try{throw Error()}catch(ft){b=ft}e()}}catch(ft){if(ft&&b&&typeof ft.stack=="string"){for(var $=ft.stack.split(`
`),it=b.stack.split(`
`),at=$.length-1,h=it.length-1;1<=at&&0<=h&&$[at]!==it[h];)h--;for(;1<=at&&0<=h;at--,h--)if($[at]!==it[h]){if(at!==1||h!==1)do if(at--,h--,0>h||$[at]!==it[h]){var dt=`
`+$[at].replace(" at new "," at ");return e.displayName&&dt.includes("<anonymous>")&&(dt=dt.replace("<anonymous>",e.displayName)),dt}while(1<=at&&0<=h);break}}}finally{Na=!1,Error.prepareStackTrace=c}return(e=e?e.displayName||e.name:"")?Ma(e):""}function Pa(e){switch(e.tag){case 5:return Ma(e.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return e=Oa(e.type,!1),e;case 11:return e=Oa(e.type.render,!1),e;case 1:return e=Oa(e.type,!0),e;default:return""}}function Qa(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Ca:return(e.displayName||"Context")+".Consumer";case Ba:return(e._context.displayName||"Context")+".Provider";case Da:var i=e.render;return e=e.displayName,e||(e=i.displayName||i.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ga:return i=e.displayName||null,i!==null?i:Qa(e.type)||"Memo";case Ha:i=e._payload,e=e._init;try{return Qa(e(i))}catch{}}return null}function Ra(e){var i=e.type;switch(e.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=i.render,e=e.displayName||e.name||"",i.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(i);case 8:return i===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Sa(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ta(e){var i=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Ua(e){var i=Ta(e)?"checked":"value",c=Object.getOwnPropertyDescriptor(e.constructor.prototype,i),b=""+e[i];if(!e.hasOwnProperty(i)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var $=c.get,it=c.set;return Object.defineProperty(e,i,{configurable:!0,get:function(){return $.call(this)},set:function(at){b=""+at,it.call(this,at)}}),Object.defineProperty(e,i,{enumerable:c.enumerable}),{getValue:function(){return b},setValue:function(at){b=""+at},stopTracking:function(){e._valueTracker=null,delete e[i]}}}}function Va(e){e._valueTracker||(e._valueTracker=Ua(e))}function Wa(e){if(!e)return!1;var i=e._valueTracker;if(!i)return!0;var c=i.getValue(),b="";return e&&(b=Ta(e)?e.checked?"true":"false":e.value),e=b,e!==c?(i.setValue(e),!0):!1}function Xa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Ya(e,i){var c=i.checked;return A({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??e._wrapperState.initialChecked})}function Za(e,i){var c=i.defaultValue==null?"":i.defaultValue,b=i.checked!=null?i.checked:i.defaultChecked;c=Sa(i.value!=null?i.value:c),e._wrapperState={initialChecked:b,initialValue:c,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function ab(e,i){i=i.checked,i!=null&&ta(e,"checked",i,!1)}function bb(e,i){ab(e,i);var c=Sa(i.value),b=i.type;if(c!=null)b==="number"?(c===0&&e.value===""||e.value!=c)&&(e.value=""+c):e.value!==""+c&&(e.value=""+c);else if(b==="submit"||b==="reset"){e.removeAttribute("value");return}i.hasOwnProperty("value")?cb(e,i.type,c):i.hasOwnProperty("defaultValue")&&cb(e,i.type,Sa(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(e.defaultChecked=!!i.defaultChecked)}function db(e,i,c){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var b=i.type;if(!(b!=="submit"&&b!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+e._wrapperState.initialValue,c||i===e.value||(e.value=i),e.defaultValue=i}c=e.name,c!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,c!==""&&(e.name=c)}function cb(e,i,c){(i!=="number"||Xa(e.ownerDocument)!==e)&&(c==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+c&&(e.defaultValue=""+c))}var eb=Array.isArray;function fb(e,i,c,b){if(e=e.options,i){i={};for(var $=0;$<c.length;$++)i["$"+c[$]]=!0;for(c=0;c<e.length;c++)$=i.hasOwnProperty("$"+e[c].value),e[c].selected!==$&&(e[c].selected=$),$&&b&&(e[c].defaultSelected=!0)}else{for(c=""+Sa(c),i=null,$=0;$<e.length;$++){if(e[$].value===c){e[$].selected=!0,b&&(e[$].defaultSelected=!0);return}i!==null||e[$].disabled||(i=e[$])}i!==null&&(i.selected=!0)}}function gb(e,i){if(i.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},i,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function hb(e,i){var c=i.value;if(c==null){if(c=i.children,i=i.defaultValue,c!=null){if(i!=null)throw Error(p(92));if(eb(c)){if(1<c.length)throw Error(p(93));c=c[0]}i=c}i==null&&(i=""),c=i}e._wrapperState={initialValue:Sa(c)}}function ib(e,i){var c=Sa(i.value),b=Sa(i.defaultValue);c!=null&&(c=""+c,c!==e.value&&(e.value=c),i.defaultValue==null&&e.defaultValue!==c&&(e.defaultValue=c)),b!=null&&(e.defaultValue=""+b)}function jb(e){var i=e.textContent;i===e._wrapperState.initialValue&&i!==""&&i!==null&&(e.value=i)}function kb(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(e,i){return e==null||e==="http://www.w3.org/1999/xhtml"?kb(i):e==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var mb,nb=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,c,b,$){MSApp.execUnsafeLocalFunction(function(){return e(i,c,b,$)})}:e}(function(e,i){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=i;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=mb.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;i.firstChild;)e.appendChild(i.firstChild)}});function ob(e,i){if(i){var c=e.firstChild;if(c&&c===e.lastChild&&c.nodeType===3){c.nodeValue=i;return}}e.textContent=i}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(e){qb.forEach(function(i){i=i+e.charAt(0).toUpperCase()+e.substring(1),pb[i]=pb[e]})});function rb(e,i,c){return i==null||typeof i=="boolean"||i===""?"":c||typeof i!="number"||i===0||pb.hasOwnProperty(e)&&pb[e]?(""+i).trim():i+"px"}function sb(e,i){e=e.style;for(var c in i)if(i.hasOwnProperty(c)){var b=c.indexOf("--")===0,$=rb(c,i[c],b);c==="float"&&(c="cssFloat"),b?e.setProperty(c,$):e[c]=$}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(e,i){if(i){if(tb[e]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(p(137,e));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(p(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(p(61))}if(i.style!=null&&typeof i.style!="object")throw Error(p(62))}}function vb(e,i){if(e.indexOf("-")===-1)return typeof i.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yb=null,zb=null,Ab=null;function Bb(e){if(e=Cb(e)){if(typeof yb!="function")throw Error(p(280));var i=e.stateNode;i&&(i=Db(i),yb(e.stateNode,e.type,i))}}function Eb(e){zb?Ab?Ab.push(e):Ab=[e]:zb=e}function Fb(){if(zb){var e=zb,i=Ab;if(Ab=zb=null,Bb(e),i)for(e=0;e<i.length;e++)Bb(i[e])}}function Gb(e,i){return e(i)}function Hb(){}var Ib=!1;function Jb(e,i,c){if(Ib)return e(i,c);Ib=!0;try{return Gb(e,i,c)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(e,i){var c=e.stateNode;if(c===null)return null;var b=Db(c);if(b===null)return null;c=b[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(e=e.type,b=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!b;break e;default:e=!1}if(e)return null;if(c&&typeof c!="function")throw Error(p(231,i,typeof c));return c}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(e,i,c,b,$,it,at,h,dt){var ft=Array.prototype.slice.call(arguments,3);try{i.apply(c,ft)}catch(xt){this.onError(xt)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(e){Ob=!0,Pb=e}};function Tb(e,i,c,b,$,it,at,h,dt){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(e,i,c,b,$,it,at,h,dt){if(Tb.apply(this,arguments),Ob){if(Ob){var ft=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=ft)}}function Vb(e){var i=e,c=e;if(e.alternate)for(;i.return;)i=i.return;else{e=i;do i=e,i.flags&4098&&(c=i.return),e=i.return;while(e)}return i.tag===3?c:null}function Wb(e){if(e.tag===13){var i=e.memoizedState;if(i===null&&(e=e.alternate,e!==null&&(i=e.memoizedState)),i!==null)return i.dehydrated}return null}function Xb(e){if(Vb(e)!==e)throw Error(p(188))}function Yb(e){var i=e.alternate;if(!i){if(i=Vb(e),i===null)throw Error(p(188));return i!==e?null:e}for(var c=e,b=i;;){var $=c.return;if($===null)break;var it=$.alternate;if(it===null){if(b=$.return,b!==null){c=b;continue}break}if($.child===it.child){for(it=$.child;it;){if(it===c)return Xb($),e;if(it===b)return Xb($),i;it=it.sibling}throw Error(p(188))}if(c.return!==b.return)c=$,b=it;else{for(var at=!1,h=$.child;h;){if(h===c){at=!0,c=$,b=it;break}if(h===b){at=!0,b=$,c=it;break}h=h.sibling}if(!at){for(h=it.child;h;){if(h===c){at=!0,c=it,b=$;break}if(h===b){at=!0,b=it,c=$;break}h=h.sibling}if(!at)throw Error(p(189))}}if(c.alternate!==b)throw Error(p(190))}if(c.tag!==3)throw Error(p(188));return c.stateNode.current===c?e:i}function Zb(e){return e=Yb(e),e!==null?$b(e):null}function $b(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var i=$b(e);if(i!==null)return i;e=e.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(e){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,e,void 0,(e.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(e){return e>>>=0,e===0?32:31-(pc(e)/qc|0)|0}var rc=64,sc=4194304;function tc(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function uc(e,i){var c=e.pendingLanes;if(c===0)return 0;var b=0,$=e.suspendedLanes,it=e.pingedLanes,at=c&268435455;if(at!==0){var h=at&~$;h!==0?b=tc(h):(it&=at,it!==0&&(b=tc(it)))}else at=c&~$,at!==0?b=tc(at):it!==0&&(b=tc(it));if(b===0)return 0;if(i!==0&&i!==b&&!(i&$)&&($=b&-b,it=i&-i,$>=it||$===16&&(it&4194240)!==0))return i;if(b&4&&(b|=c&16),i=e.entangledLanes,i!==0)for(e=e.entanglements,i&=b;0<i;)c=31-oc(i),$=1<<c,b|=e[c],i&=~$;return b}function vc(e,i){switch(e){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(e,i){for(var c=e.suspendedLanes,b=e.pingedLanes,$=e.expirationTimes,it=e.pendingLanes;0<it;){var at=31-oc(it),h=1<<at,dt=$[at];dt===-1?(!(h&c)||h&b)&&($[at]=vc(h,i)):dt<=i&&(e.expiredLanes|=h),it&=~h}}function xc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function yc(){var e=rc;return rc<<=1,!(rc&4194240)&&(rc=64),e}function zc(e){for(var i=[],c=0;31>c;c++)i.push(e);return i}function Ac(e,i,c){e.pendingLanes|=i,i!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,i=31-oc(i),e[i]=c}function Bc(e,i){var c=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;var b=e.eventTimes;for(e=e.expirationTimes;0<c;){var $=31-oc(c),it=1<<$;i[$]=0,b[$]=-1,e[$]=-1,c&=~it}}function Cc(e,i){var c=e.entangledLanes|=i;for(e=e.entanglements;c;){var b=31-oc(c),$=1<<b;$&i|e[b]&i&&(e[b]|=i),c&=~$}}var C=0;function Dc(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(e,i){switch(e){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(i.pointerId)}}function Tc(e,i,c,b,$,it){return e===null||e.nativeEvent!==it?(e={blockedOn:i,domEventName:c,eventSystemFlags:b,nativeEvent:it,targetContainers:[$]},i!==null&&(i=Cb(i),i!==null&&Fc(i)),e):(e.eventSystemFlags|=b,i=e.targetContainers,$!==null&&i.indexOf($)===-1&&i.push($),e)}function Uc(e,i,c,b,$){switch(i){case"focusin":return Lc=Tc(Lc,e,i,c,b,$),!0;case"dragenter":return Mc=Tc(Mc,e,i,c,b,$),!0;case"mouseover":return Nc=Tc(Nc,e,i,c,b,$),!0;case"pointerover":var it=$.pointerId;return Oc.set(it,Tc(Oc.get(it)||null,e,i,c,b,$)),!0;case"gotpointercapture":return it=$.pointerId,Pc.set(it,Tc(Pc.get(it)||null,e,i,c,b,$)),!0}return!1}function Vc(e){var i=Wc(e.target);if(i!==null){var c=Vb(i);if(c!==null){if(i=c.tag,i===13){if(i=Wb(c),i!==null){e.blockedOn=i,Ic(e.priority,function(){Gc(c)});return}}else if(i===3&&c.stateNode.current.memoizedState.isDehydrated){e.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Xc(e){if(e.blockedOn!==null)return!1;for(var i=e.targetContainers;0<i.length;){var c=Yc(e.domEventName,e.eventSystemFlags,i[0],e.nativeEvent);if(c===null){c=e.nativeEvent;var b=new c.constructor(c.type,c);wb=b,c.target.dispatchEvent(b),wb=null}else return i=Cb(c),i!==null&&Fc(i),e.blockedOn=c,!1;i.shift()}return!0}function Zc(e,i,c){Xc(e)&&c.delete(i)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(e,i){e.blockedOn===i&&(e.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(e){function i($){return ad($,e)}if(0<Kc.length){ad(Kc[0],e);for(var c=1;c<Kc.length;c++){var b=Kc[c];b.blockedOn===e&&(b.blockedOn=null)}}for(Lc!==null&&ad(Lc,e),Mc!==null&&ad(Mc,e),Nc!==null&&ad(Nc,e),Oc.forEach(i),Pc.forEach(i),c=0;c<Qc.length;c++)b=Qc[c],b.blockedOn===e&&(b.blockedOn=null);for(;0<Qc.length&&(c=Qc[0],c.blockedOn===null);)Vc(c),c.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(e,i,c,b){var $=C,it=cd.transition;cd.transition=null;try{C=1,fd(e,i,c,b)}finally{C=$,cd.transition=it}}function gd(e,i,c,b){var $=C,it=cd.transition;cd.transition=null;try{C=4,fd(e,i,c,b)}finally{C=$,cd.transition=it}}function fd(e,i,c,b){if(dd){var $=Yc(e,i,c,b);if($===null)hd(e,i,b,id$2,c),Sc(e,b);else if(Uc($,e,i,c,b))b.stopPropagation();else if(Sc(e,b),i&4&&-1<Rc.indexOf(e)){for(;$!==null;){var it=Cb($);if(it!==null&&Ec(it),it=Yc(e,i,c,b),it===null&&hd(e,i,b,id$2,c),it===$)break;$=it}$!==null&&b.stopPropagation()}else hd(e,i,b,null,c)}}var id$2=null;function Yc(e,i,c,b){if(id$2=null,e=xb(b),e=Wc(e),e!==null)if(i=Vb(e),i===null)e=null;else if(c=i.tag,c===13){if(e=Wb(i),e!==null)return e;e=null}else if(c===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;e=null}else i!==e&&(e=null);return id$2=e,null}function jd(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var e,i=ld,c=i.length,b,$="value"in kd?kd.value:kd.textContent,it=$.length;for(e=0;e<c&&i[e]===$[e];e++);var at=c-e;for(b=1;b<=at&&i[c-b]===$[it-b];b++);return md=$.slice(e,1<b?1-b:void 0)}function od(e){var i=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&i===13&&(e=13)):e=i,e===10&&(e=13),32<=e||e===13?e:0}function pd(){return!0}function qd(){return!1}function rd(e){function i(c,b,$,it,at){this._reactName=c,this._targetInst=$,this.type=b,this.nativeEvent=it,this.target=at,this.currentTarget=null;for(var h in e)e.hasOwnProperty(h)&&(c=e[h],this[h]=c?c(it):it[h]);return this.isDefaultPrevented=(it.defaultPrevented!=null?it.defaultPrevented:it.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),i}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==yd&&(yd&&e.type==="mousemove"?(wd=e.screenX-yd.screenX,xd=e.screenY-yd.screenY):xd=wd=0,yd=e),wd)},movementY:function(e){return"movementY"in e?e.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(e){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(e):(e=Od[e])?!!i[e]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(e){if(e.key){var i=Md[e.key]||e.key;if(i!=="Unidentified")return i}return e.type==="keypress"?(e=od(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Nd[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(e){return e.type==="keypress"?od(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?od(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=String.fromCharCode(32),fe=!1;function ge(e,i){switch(e){case"keyup":return $d.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ie=!1;function je(e,i){switch(e){case"compositionend":return he(i);case"keypress":return i.which!==32?null:(fe=!0,ee);case"textInput":return e=i.data,e===ee&&fe?null:e;default:return null}}function ke(e,i){if(ie)return e==="compositionend"||!ae&&ge(e,i)?(e=nd(),md=ld=kd=null,ie=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return de&&i.locale!=="ko"?null:i.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(e){var i=e&&e.nodeName&&e.nodeName.toLowerCase();return i==="input"?!!le[e.type]:i==="textarea"}function ne(e,i,c,b){Eb(b),i=oe(i,"onChange"),0<i.length&&(c=new td("onChange","change",null,c,b),e.push({event:c,listeners:i}))}var pe=null,qe=null;function re(e){se(e,0)}function te(e){var i=ue(e);if(Wa(i))return e}function ve(e,i){if(e==="change")return i}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(e){if(e.propertyName==="value"&&te(qe)){var i=[];ne(i,qe,e,xb(e)),Jb(re,i)}}function Ce(e,i,c){e==="focusin"?(Ae(),pe=i,qe=c,pe.attachEvent("onpropertychange",Be)):e==="focusout"&&Ae()}function De(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return te(qe)}function Ee(e,i){if(e==="click")return te(i)}function Fe(e,i){if(e==="input"||e==="change")return te(i)}function Ge(e,i){return e===i&&(e!==0||1/e===1/i)||e!==e&&i!==i}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(e,i){if(He(e,i))return!0;if(typeof e!="object"||e===null||typeof i!="object"||i===null)return!1;var c=Object.keys(e),b=Object.keys(i);if(c.length!==b.length)return!1;for(b=0;b<c.length;b++){var $=c[b];if(!ja.call(i,$)||!He(e[$],i[$]))return!1}return!0}function Je(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ke(e,i){var c=Je(e);e=0;for(var b;c;){if(c.nodeType===3){if(b=e+c.textContent.length,e<=i&&b>=i)return{node:c,offset:i-e};e=b}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Je(c)}}function Le(e,i){return e&&i?e===i?!0:e&&e.nodeType===3?!1:i&&i.nodeType===3?Le(e,i.parentNode):"contains"in e?e.contains(i):e.compareDocumentPosition?!!(e.compareDocumentPosition(i)&16):!1:!1}function Me(){for(var e=window,i=Xa();i instanceof e.HTMLIFrameElement;){try{var c=typeof i.contentWindow.location.href=="string"}catch{c=!1}if(c)e=i.contentWindow;else break;i=Xa(e.document)}return i}function Ne(e){var i=e&&e.nodeName&&e.nodeName.toLowerCase();return i&&(i==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||i==="textarea"||e.contentEditable==="true")}function Oe(e){var i=Me(),c=e.focusedElem,b=e.selectionRange;if(i!==c&&c&&c.ownerDocument&&Le(c.ownerDocument.documentElement,c)){if(b!==null&&Ne(c)){if(i=b.start,e=b.end,e===void 0&&(e=i),"selectionStart"in c)c.selectionStart=i,c.selectionEnd=Math.min(e,c.value.length);else if(e=(i=c.ownerDocument||document)&&i.defaultView||window,e.getSelection){e=e.getSelection();var $=c.textContent.length,it=Math.min(b.start,$);b=b.end===void 0?it:Math.min(b.end,$),!e.extend&&it>b&&($=b,b=it,it=$),$=Ke(c,it);var at=Ke(c,b);$&&at&&(e.rangeCount!==1||e.anchorNode!==$.node||e.anchorOffset!==$.offset||e.focusNode!==at.node||e.focusOffset!==at.offset)&&(i=i.createRange(),i.setStart($.node,$.offset),e.removeAllRanges(),it>b?(e.addRange(i),e.extend(at.node,at.offset)):(i.setEnd(at.node,at.offset),e.addRange(i)))}}for(i=[],e=c;e=e.parentNode;)e.nodeType===1&&i.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<i.length;c++)e=i[c],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(e,i,c){var b=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Te||Qe==null||Qe!==Xa(b)||(b=Qe,"selectionStart"in b&&Ne(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),Se&&Ie(Se,b)||(Se=b,b=oe(Re,"onSelect"),0<b.length&&(i=new td("onSelect","select",null,i,c),e.push({event:i,listeners:b}),i.target=Qe)))}function Ve(e,i){var c={};return c[e.toLowerCase()]=i.toLowerCase(),c["Webkit"+e]="webkit"+i,c["Moz"+e]="moz"+i,c}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(e){if(Xe[e])return Xe[e];if(!We[e])return e;var i=We[e],c;for(c in i)if(i.hasOwnProperty(c)&&c in Ye)return Xe[e]=i[c];return e}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(e,i){df.set(e,i),fa(i,[e])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(e,i,c){var b=e.type||"unknown-event";e.currentTarget=c,Ub(b,i,void 0,e),e.currentTarget=null}function se(e,i){i=(i&4)!==0;for(var c=0;c<e.length;c++){var b=e[c],$=b.event;b=b.listeners;e:{var it=void 0;if(i)for(var at=b.length-1;0<=at;at--){var h=b[at],dt=h.instance,ft=h.currentTarget;if(h=h.listener,dt!==it&&$.isPropagationStopped())break e;nf($,h,ft),it=dt}else for(at=0;at<b.length;at++){if(h=b[at],dt=h.instance,ft=h.currentTarget,h=h.listener,dt!==it&&$.isPropagationStopped())break e;nf($,h,ft),it=dt}}}if(Qb)throw e=Rb,Qb=!1,Rb=null,e}function D(e,i){var c=i[of];c===void 0&&(c=i[of]=new Set);var b=e+"__bubble";c.has(b)||(pf(i,e,2,!1),c.add(b))}function qf(e,i,c){var b=0;i&&(b|=4),pf(c,e,b,i)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(e){if(!e[rf]){e[rf]=!0,da.forEach(function(c){c!=="selectionchange"&&(mf.has(c)||qf(c,!1,e),qf(c,!0,e))});var i=e.nodeType===9?e:e.ownerDocument;i===null||i[rf]||(i[rf]=!0,qf("selectionchange",!1,i))}}function pf(e,i,c,b){switch(jd(i)){case 1:var $=ed;break;case 4:$=gd;break;default:$=fd}c=$.bind(null,i,c,e),$=void 0,!Lb||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||($=!0),b?$!==void 0?e.addEventListener(i,c,{capture:!0,passive:$}):e.addEventListener(i,c,!0):$!==void 0?e.addEventListener(i,c,{passive:$}):e.addEventListener(i,c,!1)}function hd(e,i,c,b,$){var it=b;if(!(i&1)&&!(i&2)&&b!==null)e:for(;;){if(b===null)return;var at=b.tag;if(at===3||at===4){var h=b.stateNode.containerInfo;if(h===$||h.nodeType===8&&h.parentNode===$)break;if(at===4)for(at=b.return;at!==null;){var dt=at.tag;if((dt===3||dt===4)&&(dt=at.stateNode.containerInfo,dt===$||dt.nodeType===8&&dt.parentNode===$))return;at=at.return}for(;h!==null;){if(at=Wc(h),at===null)return;if(dt=at.tag,dt===5||dt===6){b=it=at;continue e}h=h.parentNode}}b=b.return}Jb(function(){var ft=it,xt=xb(c),Ct=[];e:{var bt=df.get(e);if(bt!==void 0){var kt=td,Dt=e;switch(e){case"keypress":if(od(c)===0)break e;case"keydown":case"keyup":kt=Rd;break;case"focusin":Dt="focus",kt=Fd;break;case"focusout":Dt="blur",kt=Fd;break;case"beforeblur":case"afterblur":kt=Fd;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":kt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":kt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":kt=Vd;break;case $e:case af:case bf:kt=Hd;break;case cf:kt=Xd;break;case"scroll":kt=vd;break;case"wheel":kt=Zd;break;case"copy":case"cut":case"paste":kt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":kt=Td}var At=(i&4)!==0,Bt=!At&&e==="scroll",Tt=At?bt!==null?bt+"Capture":null:bt;At=[];for(var It=ft,St;It!==null;){St=It;var jt=St.stateNode;if(St.tag===5&&jt!==null&&(St=jt,Tt!==null&&(jt=Kb(It,Tt),jt!=null&&At.push(tf(It,jt,St)))),Bt)break;It=It.return}0<At.length&&(bt=new kt(bt,Dt,null,c,xt),Ct.push({event:bt,listeners:At}))}}if(!(i&7)){e:{if(bt=e==="mouseover"||e==="pointerover",kt=e==="mouseout"||e==="pointerout",bt&&c!==wb&&(Dt=c.relatedTarget||c.fromElement)&&(Wc(Dt)||Dt[uf]))break e;if((kt||bt)&&(bt=xt.window===xt?xt:(bt=xt.ownerDocument)?bt.defaultView||bt.parentWindow:window,kt?(Dt=c.relatedTarget||c.toElement,kt=ft,Dt=Dt?Wc(Dt):null,Dt!==null&&(Bt=Vb(Dt),Dt!==Bt||Dt.tag!==5&&Dt.tag!==6)&&(Dt=null)):(kt=null,Dt=ft),kt!==Dt)){if(At=Bd,jt="onMouseLeave",Tt="onMouseEnter",It="mouse",(e==="pointerout"||e==="pointerover")&&(At=Td,jt="onPointerLeave",Tt="onPointerEnter",It="pointer"),Bt=kt==null?bt:ue(kt),St=Dt==null?bt:ue(Dt),bt=new At(jt,It+"leave",kt,c,xt),bt.target=Bt,bt.relatedTarget=St,jt=null,Wc(xt)===ft&&(At=new At(Tt,It+"enter",Dt,c,xt),At.target=St,At.relatedTarget=Bt,jt=At),Bt=jt,kt&&Dt)t:{for(At=kt,Tt=Dt,It=0,St=At;St;St=vf(St))It++;for(St=0,jt=Tt;jt;jt=vf(jt))St++;for(;0<It-St;)At=vf(At),It--;for(;0<St-It;)Tt=vf(Tt),St--;for(;It--;){if(At===Tt||Tt!==null&&At===Tt.alternate)break t;At=vf(At),Tt=vf(Tt)}At=null}else At=null;kt!==null&&wf(Ct,bt,kt,At,!1),Dt!==null&&Bt!==null&&wf(Ct,Bt,Dt,At,!0)}}e:{if(bt=ft?ue(ft):window,kt=bt.nodeName&&bt.nodeName.toLowerCase(),kt==="select"||kt==="input"&&bt.type==="file")var Ht=ve;else if(me(bt))if(we)Ht=Fe;else{Ht=De;var Kt=Ce}else(kt=bt.nodeName)&&kt.toLowerCase()==="input"&&(bt.type==="checkbox"||bt.type==="radio")&&(Ht=Ee);if(Ht&&(Ht=Ht(e,ft))){ne(Ct,Ht,c,xt);break e}Kt&&Kt(e,bt,ft),e==="focusout"&&(Kt=bt._wrapperState)&&Kt.controlled&&bt.type==="number"&&cb(bt,"number",bt.value)}switch(Kt=ft?ue(ft):window,e){case"focusin":(me(Kt)||Kt.contentEditable==="true")&&(Qe=Kt,Re=ft,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(Ct,c,xt);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(Ct,c,xt)}var ir;if(ae)e:{switch(e){case"compositionstart":var nr="onCompositionStart";break e;case"compositionend":nr="onCompositionEnd";break e;case"compositionupdate":nr="onCompositionUpdate";break e}nr=void 0}else ie?ge(e,c)&&(nr="onCompositionEnd"):e==="keydown"&&c.keyCode===229&&(nr="onCompositionStart");nr&&(de&&c.locale!=="ko"&&(ie||nr!=="onCompositionStart"?nr==="onCompositionEnd"&&ie&&(ir=nd()):(kd=xt,ld="value"in kd?kd.value:kd.textContent,ie=!0)),Kt=oe(ft,nr),0<Kt.length&&(nr=new Ld(nr,e,null,c,xt),Ct.push({event:nr,listeners:Kt}),ir?nr.data=ir:(ir=he(c),ir!==null&&(nr.data=ir)))),(ir=ce?je(e,c):ke(e,c))&&(ft=oe(ft,"onBeforeInput"),0<ft.length&&(xt=new Ld("onBeforeInput","beforeinput",null,c,xt),Ct.push({event:xt,listeners:ft}),xt.data=ir))}se(Ct,i)})}function tf(e,i,c){return{instance:e,listener:i,currentTarget:c}}function oe(e,i){for(var c=i+"Capture",b=[];e!==null;){var $=e,it=$.stateNode;$.tag===5&&it!==null&&($=it,it=Kb(e,c),it!=null&&b.unshift(tf(e,it,$)),it=Kb(e,i),it!=null&&b.push(tf(e,it,$))),e=e.return}return b}function vf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function wf(e,i,c,b,$){for(var it=i._reactName,at=[];c!==null&&c!==b;){var h=c,dt=h.alternate,ft=h.stateNode;if(dt!==null&&dt===b)break;h.tag===5&&ft!==null&&(h=ft,$?(dt=Kb(c,it),dt!=null&&at.unshift(tf(c,dt,h))):$||(dt=Kb(c,it),dt!=null&&at.push(tf(c,dt,h)))),c=c.return}at.length!==0&&e.push({event:i,listeners:at})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(e){return(typeof e=="string"?e:""+e).replace(xf,`
`).replace(yf,"")}function Af(e,i,c){if(i=zf(i),zf(e)!==i&&c)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(e,i){return e==="textarea"||e==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(e){return Hf.resolve(null).then(e).catch(If)}:Ff;function If(e){setTimeout(function(){throw e})}function Kf(e,i){var c=i,b=0;do{var $=c.nextSibling;if(e.removeChild(c),$&&$.nodeType===8)if(c=$.data,c==="/$"){if(b===0){e.removeChild($),bd(i);return}b--}else c!=="$"&&c!=="$?"&&c!=="$!"||b++;c=$}while(c);bd(i)}function Lf(e){for(;e!=null;e=e.nextSibling){var i=e.nodeType;if(i===1||i===3)break;if(i===8){if(i=e.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return e}function Mf(e){e=e.previousSibling;for(var i=0;e;){if(e.nodeType===8){var c=e.data;if(c==="$"||c==="$!"||c==="$?"){if(i===0)return e;i--}else c==="/$"&&i++}e=e.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(e){var i=e[Of];if(i)return i;for(var c=e.parentNode;c;){if(i=c[uf]||c[Of]){if(c=i.alternate,i.child!==null||c!==null&&c.child!==null)for(e=Mf(e);e!==null;){if(c=e[Of])return c;e=Mf(e)}return i}e=c,c=e.parentNode}return null}function Cb(e){return e=e[Of]||e[uf],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ue(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(p(33))}function Db(e){return e[Pf]||null}var Sf=[],Tf=-1;function Uf(e){return{current:e}}function E(e){0>Tf||(e.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(e,i){Tf++,Sf[Tf]=e.current,e.current=i}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(e,i){var c=e.type.contextTypes;if(!c)return Vf;var b=e.stateNode;if(b&&b.__reactInternalMemoizedUnmaskedChildContext===i)return b.__reactInternalMemoizedMaskedChildContext;var $={},it;for(it in c)$[it]=i[it];return b&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=$),$}function Zf(e){return e=e.childContextTypes,e!=null}function $f(){E(Wf),E(H)}function ag(e,i,c){if(H.current!==Vf)throw Error(p(168));G(H,i),G(Wf,c)}function bg(e,i,c){var b=e.stateNode;if(i=i.childContextTypes,typeof b.getChildContext!="function")return c;b=b.getChildContext();for(var $ in b)if(!($ in i))throw Error(p(108,Ra(e)||"Unknown",$));return A({},c,b)}function cg(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,e),G(Wf,Wf.current),!0}function dg(e,i,c){var b=e.stateNode;if(!b)throw Error(p(169));c?(e=bg(e,i,Xf),b.__reactInternalMemoizedMergedChildContext=e,E(Wf),E(H),G(H,e)):E(Wf),G(Wf,c)}var eg=null,fg=!1,gg=!1;function hg(e){eg===null?eg=[e]:eg.push(e)}function ig(e){fg=!0,hg(e)}function jg(){if(!gg&&eg!==null){gg=!0;var e=0,i=C;try{var c=eg;for(C=1;e<c.length;e++){var b=c[e];do b=b(!0);while(b!==null)}eg=null,fg=!1}catch($){throw eg!==null&&(eg=eg.slice(e+1)),ac(fc,jg),$}finally{C=i,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(e,i){kg[lg++]=ng,kg[lg++]=mg,mg=e,ng=i}function ug(e,i,c){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=e;var b=rg;e=sg;var $=32-oc(b)-1;b&=~(1<<$),c+=1;var it=32-oc(i)+$;if(30<it){var at=$-$%5;it=(b&(1<<at)-1).toString(32),b>>=at,$-=at,rg=1<<32-oc(i)+$|c<<$|b,sg=it+e}else rg=1<<it|c<<$|b,sg=e}function vg(e){e.return!==null&&(tg(e,1),ug(e,1,0))}function wg(e){for(;e===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;e===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(e,i){var c=Bg(5,null,null,0);c.elementType="DELETED",c.stateNode=i,c.return=e,i=e.deletions,i===null?(e.deletions=[c],e.flags|=16):i.push(c)}function Cg(e,i){switch(e.tag){case 5:var c=e.type;return i=i.nodeType!==1||c.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(e.stateNode=i,xg=e,yg=Lf(i.firstChild),!0):!1;case 6:return i=e.pendingProps===""||i.nodeType!==3?null:i,i!==null?(e.stateNode=i,xg=e,yg=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(c=qg!==null?{id:rg,overflow:sg}:null,e.memoizedState={dehydrated:i,treeContext:c,retryLane:1073741824},c=Bg(18,null,null,0),c.stateNode=i,c.return=e,e.child=c,xg=e,yg=null,!0):!1;default:return!1}}function Dg(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Eg(e){if(I){var i=yg;if(i){var c=i;if(!Cg(e,i)){if(Dg(e))throw Error(p(418));i=Lf(c.nextSibling);var b=xg;i&&Cg(e,i)?Ag(b,c):(e.flags=e.flags&-4097|2,I=!1,xg=e)}}else{if(Dg(e))throw Error(p(418));e.flags=e.flags&-4097|2,I=!1,xg=e}}}function Fg(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;xg=e}function Gg(e){if(e!==xg)return!1;if(!I)return Fg(e),I=!0,!1;var i;if((i=e.tag!==3)&&!(i=e.tag!==5)&&(i=e.type,i=i!=="head"&&i!=="body"&&!Ef(e.type,e.memoizedProps)),i&&(i=yg)){if(Dg(e))throw Hg(),Error(p(418));for(;i;)Ag(e,i),i=Lf(i.nextSibling)}if(Fg(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(p(317));e:{for(e=e.nextSibling,i=0;e;){if(e.nodeType===8){var c=e.data;if(c==="/$"){if(i===0){yg=Lf(e.nextSibling);break e}i--}else c!=="$"&&c!=="$!"&&c!=="$?"||i++}e=e.nextSibling}yg=null}}else yg=xg?Lf(e.stateNode.nextSibling):null;return!0}function Hg(){for(var e=yg;e;)e=Lf(e.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(e){zg===null?zg=[e]:zg.push(e)}var Kg=ua.ReactCurrentBatchConfig;function Lg(e,i,c){if(e=c.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(p(309));var b=c.stateNode}if(!b)throw Error(p(147,e));var $=b,it=""+e;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===it?i.ref:(i=function(at){var h=$.refs;at===null?delete h[it]:h[it]=at},i._stringRef=it,i)}if(typeof e!="string")throw Error(p(284));if(!c._owner)throw Error(p(290,e))}return e}function Mg(e,i){throw e=Object.prototype.toString.call(i),Error(p(31,e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e))}function Ng(e){var i=e._init;return i(e._payload)}function Og(e){function i(Tt,It){if(e){var St=Tt.deletions;St===null?(Tt.deletions=[It],Tt.flags|=16):St.push(It)}}function c(Tt,It){if(!e)return null;for(;It!==null;)i(Tt,It),It=It.sibling;return null}function b(Tt,It){for(Tt=new Map;It!==null;)It.key!==null?Tt.set(It.key,It):Tt.set(It.index,It),It=It.sibling;return Tt}function $(Tt,It){return Tt=Pg(Tt,It),Tt.index=0,Tt.sibling=null,Tt}function it(Tt,It,St){return Tt.index=St,e?(St=Tt.alternate,St!==null?(St=St.index,St<It?(Tt.flags|=2,It):St):(Tt.flags|=2,It)):(Tt.flags|=1048576,It)}function at(Tt){return e&&Tt.alternate===null&&(Tt.flags|=2),Tt}function h(Tt,It,St,jt){return It===null||It.tag!==6?(It=Qg(St,Tt.mode,jt),It.return=Tt,It):(It=$(It,St),It.return=Tt,It)}function dt(Tt,It,St,jt){var Ht=St.type;return Ht===ya?xt(Tt,It,St.props.children,jt,St.key):It!==null&&(It.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===Ha&&Ng(Ht)===It.type)?(jt=$(It,St.props),jt.ref=Lg(Tt,It,St),jt.return=Tt,jt):(jt=Rg(St.type,St.key,St.props,null,Tt.mode,jt),jt.ref=Lg(Tt,It,St),jt.return=Tt,jt)}function ft(Tt,It,St,jt){return It===null||It.tag!==4||It.stateNode.containerInfo!==St.containerInfo||It.stateNode.implementation!==St.implementation?(It=Sg(St,Tt.mode,jt),It.return=Tt,It):(It=$(It,St.children||[]),It.return=Tt,It)}function xt(Tt,It,St,jt,Ht){return It===null||It.tag!==7?(It=Tg(St,Tt.mode,jt,Ht),It.return=Tt,It):(It=$(It,St),It.return=Tt,It)}function Ct(Tt,It,St){if(typeof It=="string"&&It!==""||typeof It=="number")return It=Qg(""+It,Tt.mode,St),It.return=Tt,It;if(typeof It=="object"&&It!==null){switch(It.$$typeof){case va:return St=Rg(It.type,It.key,It.props,null,Tt.mode,St),St.ref=Lg(Tt,null,It),St.return=Tt,St;case wa:return It=Sg(It,Tt.mode,St),It.return=Tt,It;case Ha:var jt=It._init;return Ct(Tt,jt(It._payload),St)}if(eb(It)||Ka(It))return It=Tg(It,Tt.mode,St,null),It.return=Tt,It;Mg(Tt,It)}return null}function bt(Tt,It,St,jt){var Ht=It!==null?It.key:null;if(typeof St=="string"&&St!==""||typeof St=="number")return Ht!==null?null:h(Tt,It,""+St,jt);if(typeof St=="object"&&St!==null){switch(St.$$typeof){case va:return St.key===Ht?dt(Tt,It,St,jt):null;case wa:return St.key===Ht?ft(Tt,It,St,jt):null;case Ha:return Ht=St._init,bt(Tt,It,Ht(St._payload),jt)}if(eb(St)||Ka(St))return Ht!==null?null:xt(Tt,It,St,jt,null);Mg(Tt,St)}return null}function kt(Tt,It,St,jt,Ht){if(typeof jt=="string"&&jt!==""||typeof jt=="number")return Tt=Tt.get(St)||null,h(It,Tt,""+jt,Ht);if(typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case va:return Tt=Tt.get(jt.key===null?St:jt.key)||null,dt(It,Tt,jt,Ht);case wa:return Tt=Tt.get(jt.key===null?St:jt.key)||null,ft(It,Tt,jt,Ht);case Ha:var Kt=jt._init;return kt(Tt,It,St,Kt(jt._payload),Ht)}if(eb(jt)||Ka(jt))return Tt=Tt.get(St)||null,xt(It,Tt,jt,Ht,null);Mg(It,jt)}return null}function Dt(Tt,It,St,jt){for(var Ht=null,Kt=null,ir=It,nr=It=0,kr=null;ir!==null&&nr<St.length;nr++){ir.index>nr?(kr=ir,ir=null):kr=ir.sibling;var br=bt(Tt,ir,St[nr],jt);if(br===null){ir===null&&(ir=kr);break}e&&ir&&br.alternate===null&&i(Tt,ir),It=it(br,It,nr),Kt===null?Ht=br:Kt.sibling=br,Kt=br,ir=kr}if(nr===St.length)return c(Tt,ir),I&&tg(Tt,nr),Ht;if(ir===null){for(;nr<St.length;nr++)ir=Ct(Tt,St[nr],jt),ir!==null&&(It=it(ir,It,nr),Kt===null?Ht=ir:Kt.sibling=ir,Kt=ir);return I&&tg(Tt,nr),Ht}for(ir=b(Tt,ir);nr<St.length;nr++)kr=kt(ir,Tt,nr,St[nr],jt),kr!==null&&(e&&kr.alternate!==null&&ir.delete(kr.key===null?nr:kr.key),It=it(kr,It,nr),Kt===null?Ht=kr:Kt.sibling=kr,Kt=kr);return e&&ir.forEach(function(Sr){return i(Tt,Sr)}),I&&tg(Tt,nr),Ht}function At(Tt,It,St,jt){var Ht=Ka(St);if(typeof Ht!="function")throw Error(p(150));if(St=Ht.call(St),St==null)throw Error(p(151));for(var Kt=Ht=null,ir=It,nr=It=0,kr=null,br=St.next();ir!==null&&!br.done;nr++,br=St.next()){ir.index>nr?(kr=ir,ir=null):kr=ir.sibling;var Sr=bt(Tt,ir,br.value,jt);if(Sr===null){ir===null&&(ir=kr);break}e&&ir&&Sr.alternate===null&&i(Tt,ir),It=it(Sr,It,nr),Kt===null?Ht=Sr:Kt.sibling=Sr,Kt=Sr,ir=kr}if(br.done)return c(Tt,ir),I&&tg(Tt,nr),Ht;if(ir===null){for(;!br.done;nr++,br=St.next())br=Ct(Tt,br.value,jt),br!==null&&(It=it(br,It,nr),Kt===null?Ht=br:Kt.sibling=br,Kt=br);return I&&tg(Tt,nr),Ht}for(ir=b(Tt,ir);!br.done;nr++,br=St.next())br=kt(ir,Tt,nr,br.value,jt),br!==null&&(e&&br.alternate!==null&&ir.delete(br.key===null?nr:br.key),It=it(br,It,nr),Kt===null?Ht=br:Kt.sibling=br,Kt=br);return e&&ir.forEach(function($r){return i(Tt,$r)}),I&&tg(Tt,nr),Ht}function Bt(Tt,It,St,jt){if(typeof St=="object"&&St!==null&&St.type===ya&&St.key===null&&(St=St.props.children),typeof St=="object"&&St!==null){switch(St.$$typeof){case va:e:{for(var Ht=St.key,Kt=It;Kt!==null;){if(Kt.key===Ht){if(Ht=St.type,Ht===ya){if(Kt.tag===7){c(Tt,Kt.sibling),It=$(Kt,St.props.children),It.return=Tt,Tt=It;break e}}else if(Kt.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===Ha&&Ng(Ht)===Kt.type){c(Tt,Kt.sibling),It=$(Kt,St.props),It.ref=Lg(Tt,Kt,St),It.return=Tt,Tt=It;break e}c(Tt,Kt);break}else i(Tt,Kt);Kt=Kt.sibling}St.type===ya?(It=Tg(St.props.children,Tt.mode,jt,St.key),It.return=Tt,Tt=It):(jt=Rg(St.type,St.key,St.props,null,Tt.mode,jt),jt.ref=Lg(Tt,It,St),jt.return=Tt,Tt=jt)}return at(Tt);case wa:e:{for(Kt=St.key;It!==null;){if(It.key===Kt)if(It.tag===4&&It.stateNode.containerInfo===St.containerInfo&&It.stateNode.implementation===St.implementation){c(Tt,It.sibling),It=$(It,St.children||[]),It.return=Tt,Tt=It;break e}else{c(Tt,It);break}else i(Tt,It);It=It.sibling}It=Sg(St,Tt.mode,jt),It.return=Tt,Tt=It}return at(Tt);case Ha:return Kt=St._init,Bt(Tt,It,Kt(St._payload),jt)}if(eb(St))return Dt(Tt,It,St,jt);if(Ka(St))return At(Tt,It,St,jt);Mg(Tt,St)}return typeof St=="string"&&St!==""||typeof St=="number"?(St=""+St,It!==null&&It.tag===6?(c(Tt,It.sibling),It=$(It,St),It.return=Tt,Tt=It):(c(Tt,It),It=Qg(St,Tt.mode,jt),It.return=Tt,Tt=It),at(Tt)):c(Tt,It)}return Bt}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(e){var i=Wg.current;E(Wg),e._currentValue=i}function bh(e,i,c){for(;e!==null;){var b=e.alternate;if((e.childLanes&i)!==i?(e.childLanes|=i,b!==null&&(b.childLanes|=i)):b!==null&&(b.childLanes&i)!==i&&(b.childLanes|=i),e===c)break;e=e.return}}function ch(e,i){Xg=e,Zg=Yg=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&i&&(dh=!0),e.firstContext=null)}function eh(e){var i=e._currentValue;if(Zg!==e)if(e={context:e,memoizedValue:i,next:null},Yg===null){if(Xg===null)throw Error(p(308));Yg=e,Xg.dependencies={lanes:0,firstContext:e}}else Yg=Yg.next=e;return i}var fh=null;function gh(e){fh===null?fh=[e]:fh.push(e)}function hh(e,i,c,b){var $=i.interleaved;return $===null?(c.next=c,gh(i)):(c.next=$.next,$.next=c),i.interleaved=c,ih(e,b)}function ih(e,i){e.lanes|=i;var c=e.alternate;for(c!==null&&(c.lanes|=i),c=e,e=e.return;e!==null;)e.childLanes|=i,c=e.alternate,c!==null&&(c.childLanes|=i),c=e,e=e.return;return c.tag===3?c.stateNode:null}var jh=!1;function kh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(e,i){e=e.updateQueue,i.updateQueue===e&&(i.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mh(e,i){return{eventTime:e,lane:i,tag:0,payload:null,callback:null,next:null}}function nh(e,i,c){var b=e.updateQueue;if(b===null)return null;if(b=b.shared,K&2){var $=b.pending;return $===null?i.next=i:(i.next=$.next,$.next=i),b.pending=i,ih(e,c)}return $=b.interleaved,$===null?(i.next=i,gh(b)):(i.next=$.next,$.next=i),b.interleaved=i,ih(e,c)}function oh(e,i,c){if(i=i.updateQueue,i!==null&&(i=i.shared,(c&4194240)!==0)){var b=i.lanes;b&=e.pendingLanes,c|=b,i.lanes=c,Cc(e,c)}}function ph(e,i){var c=e.updateQueue,b=e.alternate;if(b!==null&&(b=b.updateQueue,c===b)){var $=null,it=null;if(c=c.firstBaseUpdate,c!==null){do{var at={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};it===null?$=it=at:it=it.next=at,c=c.next}while(c!==null);it===null?$=it=i:it=it.next=i}else $=it=i;c={baseState:b.baseState,firstBaseUpdate:$,lastBaseUpdate:it,shared:b.shared,effects:b.effects},e.updateQueue=c;return}e=c.lastBaseUpdate,e===null?c.firstBaseUpdate=i:e.next=i,c.lastBaseUpdate=i}function qh(e,i,c,b){var $=e.updateQueue;jh=!1;var it=$.firstBaseUpdate,at=$.lastBaseUpdate,h=$.shared.pending;if(h!==null){$.shared.pending=null;var dt=h,ft=dt.next;dt.next=null,at===null?it=ft:at.next=ft,at=dt;var xt=e.alternate;xt!==null&&(xt=xt.updateQueue,h=xt.lastBaseUpdate,h!==at&&(h===null?xt.firstBaseUpdate=ft:h.next=ft,xt.lastBaseUpdate=dt))}if(it!==null){var Ct=$.baseState;at=0,xt=ft=dt=null,h=it;do{var bt=h.lane,kt=h.eventTime;if((b&bt)===bt){xt!==null&&(xt=xt.next={eventTime:kt,lane:0,tag:h.tag,payload:h.payload,callback:h.callback,next:null});e:{var Dt=e,At=h;switch(bt=i,kt=c,At.tag){case 1:if(Dt=At.payload,typeof Dt=="function"){Ct=Dt.call(kt,Ct,bt);break e}Ct=Dt;break e;case 3:Dt.flags=Dt.flags&-65537|128;case 0:if(Dt=At.payload,bt=typeof Dt=="function"?Dt.call(kt,Ct,bt):Dt,bt==null)break e;Ct=A({},Ct,bt);break e;case 2:jh=!0}}h.callback!==null&&h.lane!==0&&(e.flags|=64,bt=$.effects,bt===null?$.effects=[h]:bt.push(h))}else kt={eventTime:kt,lane:bt,tag:h.tag,payload:h.payload,callback:h.callback,next:null},xt===null?(ft=xt=kt,dt=Ct):xt=xt.next=kt,at|=bt;if(h=h.next,h===null){if(h=$.shared.pending,h===null)break;bt=h,h=bt.next,bt.next=null,$.lastBaseUpdate=bt,$.shared.pending=null}}while(1);if(xt===null&&(dt=Ct),$.baseState=dt,$.firstBaseUpdate=ft,$.lastBaseUpdate=xt,i=$.shared.interleaved,i!==null){$=i;do at|=$.lane,$=$.next;while($!==i)}else it===null&&($.shared.lanes=0);rh|=at,e.lanes=at,e.memoizedState=Ct}}function sh(e,i,c){if(e=i.effects,i.effects=null,e!==null)for(i=0;i<e.length;i++){var b=e[i],$=b.callback;if($!==null){if(b.callback=null,b=c,typeof $!="function")throw Error(p(191,$));$.call(b)}}}var th={},uh=Uf(th),vh$1=Uf(th),wh=Uf(th);function xh(e){if(e===th)throw Error(p(174));return e}function yh(e,i){switch(G(wh,i),G(vh$1,e),G(uh,th),e=i.nodeType,e){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:lb(null,"");break;default:e=e===8?i.parentNode:i,i=e.namespaceURI||null,e=e.tagName,i=lb(i,e)}E(uh),G(uh,i)}function zh(){E(uh),E(vh$1),E(wh)}function Ah(e){xh(wh.current);var i=xh(uh.current),c=lb(i,e.type);i!==c&&(G(vh$1,e),G(uh,c))}function Bh(e){vh$1.current===e&&(E(uh),E(vh$1))}var L=Uf(0);function Ch(e){for(var i=e;i!==null;){if(i.tag===13){var c=i.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Dh=[];function Eh(){for(var e=0;e<Dh.length;e++)Dh[e]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M=null,N=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P(){throw Error(p(321))}function Mh(e,i){if(i===null)return!1;for(var c=0;c<i.length&&c<e.length;c++)if(!He(e[c],i[c]))return!1;return!0}function Nh(e,i,c,b,$,it){if(Hh=it,M=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Fh.current=e===null||e.memoizedState===null?Oh:Ph,e=c(b,$),Jh){it=0;do{if(Jh=!1,Kh=0,25<=it)throw Error(p(301));it+=1,O=N=null,i.updateQueue=null,Fh.current=Qh,e=c(b,$)}while(Jh)}if(Fh.current=Rh,i=N!==null&&N.next!==null,Hh=0,O=N=M=null,Ih=!1,i)throw Error(p(300));return e}function Sh(){var e=Kh!==0;return Kh=0,e}function Th(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M.memoizedState=O=e:O=O.next=e,O}function Uh(){if(N===null){var e=M.alternate;e=e!==null?e.memoizedState:null}else e=N.next;var i=O===null?M.memoizedState:O.next;if(i!==null)O=i,N=e;else{if(e===null)throw Error(p(310));N=e,e={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O===null?M.memoizedState=O=e:O=O.next=e}return O}function Vh(e,i){return typeof i=="function"?i(e):i}function Wh(e){var i=Uh(),c=i.queue;if(c===null)throw Error(p(311));c.lastRenderedReducer=e;var b=N,$=b.baseQueue,it=c.pending;if(it!==null){if($!==null){var at=$.next;$.next=it.next,it.next=at}b.baseQueue=$=it,c.pending=null}if($!==null){it=$.next,b=b.baseState;var h=at=null,dt=null,ft=it;do{var xt=ft.lane;if((Hh&xt)===xt)dt!==null&&(dt=dt.next={lane:0,action:ft.action,hasEagerState:ft.hasEagerState,eagerState:ft.eagerState,next:null}),b=ft.hasEagerState?ft.eagerState:e(b,ft.action);else{var Ct={lane:xt,action:ft.action,hasEagerState:ft.hasEagerState,eagerState:ft.eagerState,next:null};dt===null?(h=dt=Ct,at=b):dt=dt.next=Ct,M.lanes|=xt,rh|=xt}ft=ft.next}while(ft!==null&&ft!==it);dt===null?at=b:dt.next=h,He(b,i.memoizedState)||(dh=!0),i.memoizedState=b,i.baseState=at,i.baseQueue=dt,c.lastRenderedState=b}if(e=c.interleaved,e!==null){$=e;do it=$.lane,M.lanes|=it,rh|=it,$=$.next;while($!==e)}else $===null&&(c.lanes=0);return[i.memoizedState,c.dispatch]}function Xh(e){var i=Uh(),c=i.queue;if(c===null)throw Error(p(311));c.lastRenderedReducer=e;var b=c.dispatch,$=c.pending,it=i.memoizedState;if($!==null){c.pending=null;var at=$=$.next;do it=e(it,at.action),at=at.next;while(at!==$);He(it,i.memoizedState)||(dh=!0),i.memoizedState=it,i.baseQueue===null&&(i.baseState=it),c.lastRenderedState=it}return[it,b]}function Yh(){}function Zh(e,i){var c=M,b=Uh(),$=i(),it=!He(b.memoizedState,$);if(it&&(b.memoizedState=$,dh=!0),b=b.queue,$h(ai.bind(null,c,b,e),[e]),b.getSnapshot!==i||it||O!==null&&O.memoizedState.tag&1){if(c.flags|=2048,bi(9,ci.bind(null,c,b,$,i),void 0,null),Q===null)throw Error(p(349));Hh&30||di(c,i,$)}return $}function di(e,i,c){e.flags|=16384,e={getSnapshot:i,value:c},i=M.updateQueue,i===null?(i={lastEffect:null,stores:null},M.updateQueue=i,i.stores=[e]):(c=i.stores,c===null?i.stores=[e]:c.push(e))}function ci(e,i,c,b){i.value=c,i.getSnapshot=b,ei(i)&&fi(e)}function ai(e,i,c){return c(function(){ei(i)&&fi(e)})}function ei(e){var i=e.getSnapshot;e=e.value;try{var c=i();return!He(e,c)}catch{return!0}}function fi(e){var i=ih(e,1);i!==null&&gi(i,e,1,-1)}function hi(e){var i=Th();return typeof e=="function"&&(e=e()),i.memoizedState=i.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:e},i.queue=e,e=e.dispatch=ii.bind(null,M,e),[i.memoizedState,e]}function bi(e,i,c,b){return e={tag:e,create:i,destroy:c,deps:b,next:null},i=M.updateQueue,i===null?(i={lastEffect:null,stores:null},M.updateQueue=i,i.lastEffect=e.next=e):(c=i.lastEffect,c===null?i.lastEffect=e.next=e:(b=c.next,c.next=e,e.next=b,i.lastEffect=e)),e}function ji(){return Uh().memoizedState}function ki(e,i,c,b){var $=Th();M.flags|=e,$.memoizedState=bi(1|i,c,void 0,b===void 0?null:b)}function li(e,i,c,b){var $=Uh();b=b===void 0?null:b;var it=void 0;if(N!==null){var at=N.memoizedState;if(it=at.destroy,b!==null&&Mh(b,at.deps)){$.memoizedState=bi(i,c,it,b);return}}M.flags|=e,$.memoizedState=bi(1|i,c,it,b)}function mi(e,i){return ki(8390656,8,e,i)}function $h(e,i){return li(2048,8,e,i)}function ni(e,i){return li(4,2,e,i)}function oi(e,i){return li(4,4,e,i)}function pi(e,i){if(typeof i=="function")return e=e(),i(e),function(){i(null)};if(i!=null)return e=e(),i.current=e,function(){i.current=null}}function qi(e,i,c){return c=c!=null?c.concat([e]):null,li(4,4,pi.bind(null,i,e),c)}function ri(){}function si(e,i){var c=Uh();i=i===void 0?null:i;var b=c.memoizedState;return b!==null&&i!==null&&Mh(i,b[1])?b[0]:(c.memoizedState=[e,i],e)}function ti(e,i){var c=Uh();i=i===void 0?null:i;var b=c.memoizedState;return b!==null&&i!==null&&Mh(i,b[1])?b[0]:(e=e(),c.memoizedState=[e,i],e)}function ui(e,i,c){return Hh&21?(He(c,i)||(c=yc(),M.lanes|=c,rh|=c,e.baseState=!0),i):(e.baseState&&(e.baseState=!1,dh=!0),e.memoizedState=c)}function vi(e,i){var c=C;C=c!==0&&4>c?c:4,e(!0);var b=Gh.transition;Gh.transition={};try{e(!1),i()}finally{C=c,Gh.transition=b}}function wi(){return Uh().memoizedState}function xi(e,i,c){var b=yi(e);if(c={lane:b,action:c,hasEagerState:!1,eagerState:null,next:null},zi(e))Ai(i,c);else if(c=hh(e,i,c,b),c!==null){var $=R();gi(c,e,b,$),Bi(c,i,b)}}function ii(e,i,c){var b=yi(e),$={lane:b,action:c,hasEagerState:!1,eagerState:null,next:null};if(zi(e))Ai(i,$);else{var it=e.alternate;if(e.lanes===0&&(it===null||it.lanes===0)&&(it=i.lastRenderedReducer,it!==null))try{var at=i.lastRenderedState,h=it(at,c);if($.hasEagerState=!0,$.eagerState=h,He(h,at)){var dt=i.interleaved;dt===null?($.next=$,gh(i)):($.next=dt.next,dt.next=$),i.interleaved=$;return}}catch{}finally{}c=hh(e,i,$,b),c!==null&&($=R(),gi(c,e,b,$),Bi(c,i,b))}}function zi(e){var i=e.alternate;return e===M||i!==null&&i===M}function Ai(e,i){Jh=Ih=!0;var c=e.pending;c===null?i.next=i:(i.next=c.next,c.next=i),e.pending=i}function Bi(e,i,c){if(c&4194240){var b=i.lanes;b&=e.pendingLanes,c|=b,i.lanes=c,Cc(e,c)}}var Rh={readContext:eh,useCallback:P,useContext:P,useEffect:P,useImperativeHandle:P,useInsertionEffect:P,useLayoutEffect:P,useMemo:P,useReducer:P,useRef:P,useState:P,useDebugValue:P,useDeferredValue:P,useTransition:P,useMutableSource:P,useSyncExternalStore:P,useId:P,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(e,i){return Th().memoizedState=[e,i===void 0?null:i],e},useContext:eh,useEffect:mi,useImperativeHandle:function(e,i,c){return c=c!=null?c.concat([e]):null,ki(4194308,4,pi.bind(null,i,e),c)},useLayoutEffect:function(e,i){return ki(4194308,4,e,i)},useInsertionEffect:function(e,i){return ki(4,2,e,i)},useMemo:function(e,i){var c=Th();return i=i===void 0?null:i,e=e(),c.memoizedState=[e,i],e},useReducer:function(e,i,c){var b=Th();return i=c!==void 0?c(i):i,b.memoizedState=b.baseState=i,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},b.queue=e,e=e.dispatch=xi.bind(null,M,e),[b.memoizedState,e]},useRef:function(e){var i=Th();return e={current:e},i.memoizedState=e},useState:hi,useDebugValue:ri,useDeferredValue:function(e){return Th().memoizedState=e},useTransition:function(){var e=hi(!1),i=e[0];return e=vi.bind(null,e[1]),Th().memoizedState=e,[i,e]},useMutableSource:function(){},useSyncExternalStore:function(e,i,c){var b=M,$=Th();if(I){if(c===void 0)throw Error(p(407));c=c()}else{if(c=i(),Q===null)throw Error(p(349));Hh&30||di(b,i,c)}$.memoizedState=c;var it={value:c,getSnapshot:i};return $.queue=it,mi(ai.bind(null,b,it,e),[e]),b.flags|=2048,bi(9,ci.bind(null,b,it,c,i),void 0,null),c},useId:function(){var e=Th(),i=Q.identifierPrefix;if(I){var c=sg,b=rg;c=(b&~(1<<32-oc(b)-1)).toString(32)+c,i=":"+i+"R"+c,c=Kh++,0<c&&(i+="H"+c.toString(32)),i+=":"}else c=Lh++,i=":"+i+"r"+c.toString(32)+":";return e.memoizedState=i},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var i=Uh();return ui(i,N.memoizedState,e)},useTransition:function(){var e=Wh(Vh)[0],i=Uh().memoizedState;return[e,i]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var i=Uh();return N===null?i.memoizedState=e:ui(i,N.memoizedState,e)},useTransition:function(){var e=Xh(Vh)[0],i=Uh().memoizedState;return[e,i]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(e,i){if(e&&e.defaultProps){i=A({},i),e=e.defaultProps;for(var c in e)i[c]===void 0&&(i[c]=e[c]);return i}return i}function Di(e,i,c,b){i=e.memoizedState,c=c(b,i),c=c==null?i:A({},i,c),e.memoizedState=c,e.lanes===0&&(e.updateQueue.baseState=c)}var Ei={isMounted:function(e){return(e=e._reactInternals)?Vb(e)===e:!1},enqueueSetState:function(e,i,c){e=e._reactInternals;var b=R(),$=yi(e),it=mh(b,$);it.payload=i,c!=null&&(it.callback=c),i=nh(e,it,$),i!==null&&(gi(i,e,$,b),oh(i,e,$))},enqueueReplaceState:function(e,i,c){e=e._reactInternals;var b=R(),$=yi(e),it=mh(b,$);it.tag=1,it.payload=i,c!=null&&(it.callback=c),i=nh(e,it,$),i!==null&&(gi(i,e,$,b),oh(i,e,$))},enqueueForceUpdate:function(e,i){e=e._reactInternals;var c=R(),b=yi(e),$=mh(c,b);$.tag=2,i!=null&&($.callback=i),i=nh(e,$,b),i!==null&&(gi(i,e,b,c),oh(i,e,b))}};function Fi(e,i,c,b,$,it,at){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(b,it,at):i.prototype&&i.prototype.isPureReactComponent?!Ie(c,b)||!Ie($,it):!0}function Gi(e,i,c){var b=!1,$=Vf,it=i.contextType;return typeof it=="object"&&it!==null?it=eh(it):($=Zf(i)?Xf:H.current,b=i.contextTypes,it=(b=b!=null)?Yf(e,$):Vf),i=new i(c,it),e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Ei,e.stateNode=i,i._reactInternals=e,b&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=$,e.__reactInternalMemoizedMaskedChildContext=it),i}function Hi(e,i,c,b){e=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(c,b),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(c,b),i.state!==e&&Ei.enqueueReplaceState(i,i.state,null)}function Ii(e,i,c,b){var $=e.stateNode;$.props=c,$.state=e.memoizedState,$.refs={},kh(e);var it=i.contextType;typeof it=="object"&&it!==null?$.context=eh(it):(it=Zf(i)?Xf:H.current,$.context=Yf(e,it)),$.state=e.memoizedState,it=i.getDerivedStateFromProps,typeof it=="function"&&(Di(e,i,it,c),$.state=e.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(i=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),i!==$.state&&Ei.enqueueReplaceState($,$.state,null),qh(e,c,$,b),$.state=e.memoizedState),typeof $.componentDidMount=="function"&&(e.flags|=4194308)}function Ji(e,i){try{var c="",b=i;do c+=Pa(b),b=b.return;while(b);var $=c}catch(it){$=`
Error generating stack: `+it.message+`
`+it.stack}return{value:e,source:i,stack:$,digest:null}}function Ki(e,i,c){return{value:e,source:null,stack:c??null,digest:i??null}}function Li(e,i){try{console.error(i.value)}catch(c){setTimeout(function(){throw c})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(e,i,c){c=mh(-1,c),c.tag=3,c.payload={element:null};var b=i.value;return c.callback=function(){Oi||(Oi=!0,Pi=b),Li(e,i)},c}function Qi(e,i,c){c=mh(-1,c),c.tag=3;var b=e.type.getDerivedStateFromError;if(typeof b=="function"){var $=i.value;c.payload=function(){return b($)},c.callback=function(){Li(e,i)}}var it=e.stateNode;return it!==null&&typeof it.componentDidCatch=="function"&&(c.callback=function(){Li(e,i),typeof b!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var at=i.stack;this.componentDidCatch(i.value,{componentStack:at!==null?at:""})}),c}function Si(e,i,c){var b=e.pingCache;if(b===null){b=e.pingCache=new Mi;var $=new Set;b.set(i,$)}else $=b.get(i),$===void 0&&($=new Set,b.set(i,$));$.has(c)||($.add(c),e=Ti.bind(null,e,i,c),i.then(e,e))}function Ui(e){do{var i;if((i=e.tag===13)&&(i=e.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return e;e=e.return}while(e!==null);return null}function Vi(e,i,c,b,$){return e.mode&1?(e.flags|=65536,e.lanes=$,e):(e===i?e.flags|=65536:(e.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(i=mh(-1,1),i.tag=2,nh(c,i,1))),c.lanes|=1),e)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(e,i,c,b){i.child=e===null?Vg(i,null,c,b):Ug(i,e.child,c,b)}function Yi(e,i,c,b,$){c=c.render;var it=i.ref;return ch(i,$),b=Nh(e,i,c,b,it,$),c=Sh(),e!==null&&!dh?(i.updateQueue=e.updateQueue,i.flags&=-2053,e.lanes&=~$,Zi(e,i,$)):(I&&c&&vg(i),i.flags|=1,Xi(e,i,b,$),i.child)}function $i(e,i,c,b,$){if(e===null){var it=c.type;return typeof it=="function"&&!aj(it)&&it.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(i.tag=15,i.type=it,bj(e,i,it,b,$)):(e=Rg(c.type,null,b,i,i.mode,$),e.ref=i.ref,e.return=i,i.child=e)}if(it=e.child,!(e.lanes&$)){var at=it.memoizedProps;if(c=c.compare,c=c!==null?c:Ie,c(at,b)&&e.ref===i.ref)return Zi(e,i,$)}return i.flags|=1,e=Pg(it,b),e.ref=i.ref,e.return=i,i.child=e}function bj(e,i,c,b,$){if(e!==null){var it=e.memoizedProps;if(Ie(it,b)&&e.ref===i.ref)if(dh=!1,i.pendingProps=b=it,(e.lanes&$)!==0)e.flags&131072&&(dh=!0);else return i.lanes=e.lanes,Zi(e,i,$)}return cj(e,i,c,b,$)}function dj(e,i,c){var b=i.pendingProps,$=b.children,it=e!==null?e.memoizedState:null;if(b.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=c;else{if(!(c&1073741824))return e=it!==null?it.baseLanes|c:c,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:e,cachePool:null,transitions:null},i.updateQueue=null,G(ej,fj),fj|=e,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},b=it!==null?it.baseLanes:c,G(ej,fj),fj|=b}else it!==null?(b=it.baseLanes|c,i.memoizedState=null):b=c,G(ej,fj),fj|=b;return Xi(e,i,$,c),i.child}function gj(e,i){var c=i.ref;(e===null&&c!==null||e!==null&&e.ref!==c)&&(i.flags|=512,i.flags|=2097152)}function cj(e,i,c,b,$){var it=Zf(c)?Xf:H.current;return it=Yf(i,it),ch(i,$),c=Nh(e,i,c,b,it,$),b=Sh(),e!==null&&!dh?(i.updateQueue=e.updateQueue,i.flags&=-2053,e.lanes&=~$,Zi(e,i,$)):(I&&b&&vg(i),i.flags|=1,Xi(e,i,c,$),i.child)}function hj(e,i,c,b,$){if(Zf(c)){var it=!0;cg(i)}else it=!1;if(ch(i,$),i.stateNode===null)ij(e,i),Gi(i,c,b),Ii(i,c,b,$),b=!0;else if(e===null){var at=i.stateNode,h=i.memoizedProps;at.props=h;var dt=at.context,ft=c.contextType;typeof ft=="object"&&ft!==null?ft=eh(ft):(ft=Zf(c)?Xf:H.current,ft=Yf(i,ft));var xt=c.getDerivedStateFromProps,Ct=typeof xt=="function"||typeof at.getSnapshotBeforeUpdate=="function";Ct||typeof at.UNSAFE_componentWillReceiveProps!="function"&&typeof at.componentWillReceiveProps!="function"||(h!==b||dt!==ft)&&Hi(i,at,b,ft),jh=!1;var bt=i.memoizedState;at.state=bt,qh(i,b,at,$),dt=i.memoizedState,h!==b||bt!==dt||Wf.current||jh?(typeof xt=="function"&&(Di(i,c,xt,b),dt=i.memoizedState),(h=jh||Fi(i,c,h,b,bt,dt,ft))?(Ct||typeof at.UNSAFE_componentWillMount!="function"&&typeof at.componentWillMount!="function"||(typeof at.componentWillMount=="function"&&at.componentWillMount(),typeof at.UNSAFE_componentWillMount=="function"&&at.UNSAFE_componentWillMount()),typeof at.componentDidMount=="function"&&(i.flags|=4194308)):(typeof at.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=b,i.memoizedState=dt),at.props=b,at.state=dt,at.context=ft,b=h):(typeof at.componentDidMount=="function"&&(i.flags|=4194308),b=!1)}else{at=i.stateNode,lh(e,i),h=i.memoizedProps,ft=i.type===i.elementType?h:Ci(i.type,h),at.props=ft,Ct=i.pendingProps,bt=at.context,dt=c.contextType,typeof dt=="object"&&dt!==null?dt=eh(dt):(dt=Zf(c)?Xf:H.current,dt=Yf(i,dt));var kt=c.getDerivedStateFromProps;(xt=typeof kt=="function"||typeof at.getSnapshotBeforeUpdate=="function")||typeof at.UNSAFE_componentWillReceiveProps!="function"&&typeof at.componentWillReceiveProps!="function"||(h!==Ct||bt!==dt)&&Hi(i,at,b,dt),jh=!1,bt=i.memoizedState,at.state=bt,qh(i,b,at,$);var Dt=i.memoizedState;h!==Ct||bt!==Dt||Wf.current||jh?(typeof kt=="function"&&(Di(i,c,kt,b),Dt=i.memoizedState),(ft=jh||Fi(i,c,ft,b,bt,Dt,dt)||!1)?(xt||typeof at.UNSAFE_componentWillUpdate!="function"&&typeof at.componentWillUpdate!="function"||(typeof at.componentWillUpdate=="function"&&at.componentWillUpdate(b,Dt,dt),typeof at.UNSAFE_componentWillUpdate=="function"&&at.UNSAFE_componentWillUpdate(b,Dt,dt)),typeof at.componentDidUpdate=="function"&&(i.flags|=4),typeof at.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof at.componentDidUpdate!="function"||h===e.memoizedProps&&bt===e.memoizedState||(i.flags|=4),typeof at.getSnapshotBeforeUpdate!="function"||h===e.memoizedProps&&bt===e.memoizedState||(i.flags|=1024),i.memoizedProps=b,i.memoizedState=Dt),at.props=b,at.state=Dt,at.context=dt,b=ft):(typeof at.componentDidUpdate!="function"||h===e.memoizedProps&&bt===e.memoizedState||(i.flags|=4),typeof at.getSnapshotBeforeUpdate!="function"||h===e.memoizedProps&&bt===e.memoizedState||(i.flags|=1024),b=!1)}return jj(e,i,c,b,it,$)}function jj(e,i,c,b,$,it){gj(e,i);var at=(i.flags&128)!==0;if(!b&&!at)return $&&dg(i,c,!1),Zi(e,i,it);b=i.stateNode,Wi.current=i;var h=at&&typeof c.getDerivedStateFromError!="function"?null:b.render();return i.flags|=1,e!==null&&at?(i.child=Ug(i,e.child,null,it),i.child=Ug(i,null,h,it)):Xi(e,i,h,it),i.memoizedState=b.state,$&&dg(i,c,!0),i.child}function kj(e){var i=e.stateNode;i.pendingContext?ag(e,i.pendingContext,i.pendingContext!==i.context):i.context&&ag(e,i.context,!1),yh(e,i.containerInfo)}function lj(e,i,c,b,$){return Ig(),Jg($),i.flags|=256,Xi(e,i,c,b),i.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(e){return{baseLanes:e,cachePool:null,transitions:null}}function oj(e,i,c){var b=i.pendingProps,$=L.current,it=!1,at=(i.flags&128)!==0,h;if((h=at)||(h=e!==null&&e.memoizedState===null?!1:($&2)!==0),h?(it=!0,i.flags&=-129):(e===null||e.memoizedState!==null)&&($|=1),G(L,$&1),e===null)return Eg(i),e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(i.mode&1?e.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(at=b.children,e=b.fallback,it?(b=i.mode,it=i.child,at={mode:"hidden",children:at},!(b&1)&&it!==null?(it.childLanes=0,it.pendingProps=at):it=pj(at,b,0,null),e=Tg(e,b,c,null),it.return=i,e.return=i,it.sibling=e,i.child=it,i.child.memoizedState=nj(c),i.memoizedState=mj,e):qj(i,at));if($=e.memoizedState,$!==null&&(h=$.dehydrated,h!==null))return rj(e,i,at,b,h,$,c);if(it){it=b.fallback,at=i.mode,$=e.child,h=$.sibling;var dt={mode:"hidden",children:b.children};return!(at&1)&&i.child!==$?(b=i.child,b.childLanes=0,b.pendingProps=dt,i.deletions=null):(b=Pg($,dt),b.subtreeFlags=$.subtreeFlags&14680064),h!==null?it=Pg(h,it):(it=Tg(it,at,c,null),it.flags|=2),it.return=i,b.return=i,b.sibling=it,i.child=b,b=it,it=i.child,at=e.child.memoizedState,at=at===null?nj(c):{baseLanes:at.baseLanes|c,cachePool:null,transitions:at.transitions},it.memoizedState=at,it.childLanes=e.childLanes&~c,i.memoizedState=mj,b}return it=e.child,e=it.sibling,b=Pg(it,{mode:"visible",children:b.children}),!(i.mode&1)&&(b.lanes=c),b.return=i,b.sibling=null,e!==null&&(c=i.deletions,c===null?(i.deletions=[e],i.flags|=16):c.push(e)),i.child=b,i.memoizedState=null,b}function qj(e,i){return i=pj({mode:"visible",children:i},e.mode,0,null),i.return=e,e.child=i}function sj(e,i,c,b){return b!==null&&Jg(b),Ug(i,e.child,null,c),e=qj(i,i.pendingProps.children),e.flags|=2,i.memoizedState=null,e}function rj(e,i,c,b,$,it,at){if(c)return i.flags&256?(i.flags&=-257,b=Ki(Error(p(422))),sj(e,i,at,b)):i.memoizedState!==null?(i.child=e.child,i.flags|=128,null):(it=b.fallback,$=i.mode,b=pj({mode:"visible",children:b.children},$,0,null),it=Tg(it,$,at,null),it.flags|=2,b.return=i,it.return=i,b.sibling=it,i.child=b,i.mode&1&&Ug(i,e.child,null,at),i.child.memoizedState=nj(at),i.memoizedState=mj,it);if(!(i.mode&1))return sj(e,i,at,null);if($.data==="$!"){if(b=$.nextSibling&&$.nextSibling.dataset,b)var h=b.dgst;return b=h,it=Error(p(419)),b=Ki(it,b,void 0),sj(e,i,at,b)}if(h=(at&e.childLanes)!==0,dh||h){if(b=Q,b!==null){switch(at&-at){case 4:$=2;break;case 16:$=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:$=32;break;case 536870912:$=268435456;break;default:$=0}$=$&(b.suspendedLanes|at)?0:$,$!==0&&$!==it.retryLane&&(it.retryLane=$,ih(e,$),gi(b,e,$,-1))}return tj(),b=Ki(Error(p(421))),sj(e,i,at,b)}return $.data==="$?"?(i.flags|=128,i.child=e.child,i=uj.bind(null,e),$._reactRetry=i,null):(e=it.treeContext,yg=Lf($.nextSibling),xg=i,I=!0,zg=null,e!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=e.id,sg=e.overflow,qg=i),i=qj(i,b.children),i.flags|=4096,i)}function vj(e,i,c){e.lanes|=i;var b=e.alternate;b!==null&&(b.lanes|=i),bh(e.return,i,c)}function wj(e,i,c,b,$){var it=e.memoizedState;it===null?e.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:b,tail:c,tailMode:$}:(it.isBackwards=i,it.rendering=null,it.renderingStartTime=0,it.last=b,it.tail=c,it.tailMode=$)}function xj(e,i,c){var b=i.pendingProps,$=b.revealOrder,it=b.tail;if(Xi(e,i,b.children,c),b=L.current,b&2)b=b&1|2,i.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=i.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&vj(e,c,i);else if(e.tag===19)vj(e,c,i);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break e;for(;e.sibling===null;){if(e.return===null||e.return===i)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}b&=1}if(G(L,b),!(i.mode&1))i.memoizedState=null;else switch($){case"forwards":for(c=i.child,$=null;c!==null;)e=c.alternate,e!==null&&Ch(e)===null&&($=c),c=c.sibling;c=$,c===null?($=i.child,i.child=null):($=c.sibling,c.sibling=null),wj(i,!1,$,c,it);break;case"backwards":for(c=null,$=i.child,i.child=null;$!==null;){if(e=$.alternate,e!==null&&Ch(e)===null){i.child=$;break}e=$.sibling,$.sibling=c,c=$,$=e}wj(i,!0,c,null,it);break;case"together":wj(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function ij(e,i){!(i.mode&1)&&e!==null&&(e.alternate=null,i.alternate=null,i.flags|=2)}function Zi(e,i,c){if(e!==null&&(i.dependencies=e.dependencies),rh|=i.lanes,!(c&i.childLanes))return null;if(e!==null&&i.child!==e.child)throw Error(p(153));if(i.child!==null){for(e=i.child,c=Pg(e,e.pendingProps),i.child=c,c.return=i;e.sibling!==null;)e=e.sibling,c=c.sibling=Pg(e,e.pendingProps),c.return=i;c.sibling=null}return i.child}function yj(e,i,c){switch(i.tag){case 3:kj(i),Ig();break;case 5:Ah(i);break;case 1:Zf(i.type)&&cg(i);break;case 4:yh(i,i.stateNode.containerInfo);break;case 10:var b=i.type._context,$=i.memoizedProps.value;G(Wg,b._currentValue),b._currentValue=$;break;case 13:if(b=i.memoizedState,b!==null)return b.dehydrated!==null?(G(L,L.current&1),i.flags|=128,null):c&i.child.childLanes?oj(e,i,c):(G(L,L.current&1),e=Zi(e,i,c),e!==null?e.sibling:null);G(L,L.current&1);break;case 19:if(b=(c&i.childLanes)!==0,e.flags&128){if(b)return xj(e,i,c);i.flags|=128}if($=i.memoizedState,$!==null&&($.rendering=null,$.tail=null,$.lastEffect=null),G(L,L.current),b)break;return null;case 22:case 23:return i.lanes=0,dj(e,i,c)}return Zi(e,i,c)}var zj,Aj,Bj,Cj;zj=function(e,i){for(var c=i.child;c!==null;){if(c.tag===5||c.tag===6)e.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===i)break;for(;c.sibling===null;){if(c.return===null||c.return===i)return;c=c.return}c.sibling.return=c.return,c=c.sibling}};Aj=function(){};Bj=function(e,i,c,b){var $=e.memoizedProps;if($!==b){e=i.stateNode,xh(uh.current);var it=null;switch(c){case"input":$=Ya(e,$),b=Ya(e,b),it=[];break;case"select":$=A({},$,{value:void 0}),b=A({},b,{value:void 0}),it=[];break;case"textarea":$=gb(e,$),b=gb(e,b),it=[];break;default:typeof $.onClick!="function"&&typeof b.onClick=="function"&&(e.onclick=Bf)}ub(c,b);var at;c=null;for(ft in $)if(!b.hasOwnProperty(ft)&&$.hasOwnProperty(ft)&&$[ft]!=null)if(ft==="style"){var h=$[ft];for(at in h)h.hasOwnProperty(at)&&(c||(c={}),c[at]="")}else ft!=="dangerouslySetInnerHTML"&&ft!=="children"&&ft!=="suppressContentEditableWarning"&&ft!=="suppressHydrationWarning"&&ft!=="autoFocus"&&(ea.hasOwnProperty(ft)?it||(it=[]):(it=it||[]).push(ft,null));for(ft in b){var dt=b[ft];if(h=$!=null?$[ft]:void 0,b.hasOwnProperty(ft)&&dt!==h&&(dt!=null||h!=null))if(ft==="style")if(h){for(at in h)!h.hasOwnProperty(at)||dt&&dt.hasOwnProperty(at)||(c||(c={}),c[at]="");for(at in dt)dt.hasOwnProperty(at)&&h[at]!==dt[at]&&(c||(c={}),c[at]=dt[at])}else c||(it||(it=[]),it.push(ft,c)),c=dt;else ft==="dangerouslySetInnerHTML"?(dt=dt?dt.__html:void 0,h=h?h.__html:void 0,dt!=null&&h!==dt&&(it=it||[]).push(ft,dt)):ft==="children"?typeof dt!="string"&&typeof dt!="number"||(it=it||[]).push(ft,""+dt):ft!=="suppressContentEditableWarning"&&ft!=="suppressHydrationWarning"&&(ea.hasOwnProperty(ft)?(dt!=null&&ft==="onScroll"&&D("scroll",e),it||h===dt||(it=[])):(it=it||[]).push(ft,dt))}c&&(it=it||[]).push("style",c);var ft=it;(i.updateQueue=ft)&&(i.flags|=4)}};Cj=function(e,i,c,b){c!==b&&(i.flags|=4)};function Dj(e,i){if(!I)switch(e.tailMode){case"hidden":i=e.tail;for(var c=null;i!==null;)i.alternate!==null&&(c=i),i=i.sibling;c===null?e.tail=null:c.sibling=null;break;case"collapsed":c=e.tail;for(var b=null;c!==null;)c.alternate!==null&&(b=c),c=c.sibling;b===null?i||e.tail===null?e.tail=null:e.tail.sibling=null:b.sibling=null}}function S(e){var i=e.alternate!==null&&e.alternate.child===e.child,c=0,b=0;if(i)for(var $=e.child;$!==null;)c|=$.lanes|$.childLanes,b|=$.subtreeFlags&14680064,b|=$.flags&14680064,$.return=e,$=$.sibling;else for($=e.child;$!==null;)c|=$.lanes|$.childLanes,b|=$.subtreeFlags,b|=$.flags,$.return=e,$=$.sibling;return e.subtreeFlags|=b,e.childLanes=c,i}function Ej(e,i,c){var b=i.pendingProps;switch(wg(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(i),null;case 1:return Zf(i.type)&&$f(),S(i),null;case 3:return b=i.stateNode,zh(),E(Wf),E(H),Eh(),b.pendingContext&&(b.context=b.pendingContext,b.pendingContext=null),(e===null||e.child===null)&&(Gg(i)?i.flags|=4:e===null||e.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(e,i),S(i),null;case 5:Bh(i);var $=xh(wh.current);if(c=i.type,e!==null&&i.stateNode!=null)Bj(e,i,c,b,$),e.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!b){if(i.stateNode===null)throw Error(p(166));return S(i),null}if(e=xh(uh.current),Gg(i)){b=i.stateNode,c=i.type;var it=i.memoizedProps;switch(b[Of]=i,b[Pf]=it,e=(i.mode&1)!==0,c){case"dialog":D("cancel",b),D("close",b);break;case"iframe":case"object":case"embed":D("load",b);break;case"video":case"audio":for($=0;$<lf.length;$++)D(lf[$],b);break;case"source":D("error",b);break;case"img":case"image":case"link":D("error",b),D("load",b);break;case"details":D("toggle",b);break;case"input":Za(b,it),D("invalid",b);break;case"select":b._wrapperState={wasMultiple:!!it.multiple},D("invalid",b);break;case"textarea":hb(b,it),D("invalid",b)}ub(c,it),$=null;for(var at in it)if(it.hasOwnProperty(at)){var h=it[at];at==="children"?typeof h=="string"?b.textContent!==h&&(it.suppressHydrationWarning!==!0&&Af(b.textContent,h,e),$=["children",h]):typeof h=="number"&&b.textContent!==""+h&&(it.suppressHydrationWarning!==!0&&Af(b.textContent,h,e),$=["children",""+h]):ea.hasOwnProperty(at)&&h!=null&&at==="onScroll"&&D("scroll",b)}switch(c){case"input":Va(b),db(b,it,!0);break;case"textarea":Va(b),jb(b);break;case"select":case"option":break;default:typeof it.onClick=="function"&&(b.onclick=Bf)}b=$,i.updateQueue=b,b!==null&&(i.flags|=4)}else{at=$.nodeType===9?$:$.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=kb(c)),e==="http://www.w3.org/1999/xhtml"?c==="script"?(e=at.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof b.is=="string"?e=at.createElement(c,{is:b.is}):(e=at.createElement(c),c==="select"&&(at=e,b.multiple?at.multiple=!0:b.size&&(at.size=b.size))):e=at.createElementNS(e,c),e[Of]=i,e[Pf]=b,zj(e,i,!1,!1),i.stateNode=e;e:{switch(at=vb(c,b),c){case"dialog":D("cancel",e),D("close",e),$=b;break;case"iframe":case"object":case"embed":D("load",e),$=b;break;case"video":case"audio":for($=0;$<lf.length;$++)D(lf[$],e);$=b;break;case"source":D("error",e),$=b;break;case"img":case"image":case"link":D("error",e),D("load",e),$=b;break;case"details":D("toggle",e),$=b;break;case"input":Za(e,b),$=Ya(e,b),D("invalid",e);break;case"option":$=b;break;case"select":e._wrapperState={wasMultiple:!!b.multiple},$=A({},b,{value:void 0}),D("invalid",e);break;case"textarea":hb(e,b),$=gb(e,b),D("invalid",e);break;default:$=b}ub(c,$),h=$;for(it in h)if(h.hasOwnProperty(it)){var dt=h[it];it==="style"?sb(e,dt):it==="dangerouslySetInnerHTML"?(dt=dt?dt.__html:void 0,dt!=null&&nb(e,dt)):it==="children"?typeof dt=="string"?(c!=="textarea"||dt!=="")&&ob(e,dt):typeof dt=="number"&&ob(e,""+dt):it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&it!=="autoFocus"&&(ea.hasOwnProperty(it)?dt!=null&&it==="onScroll"&&D("scroll",e):dt!=null&&ta(e,it,dt,at))}switch(c){case"input":Va(e),db(e,b,!1);break;case"textarea":Va(e),jb(e);break;case"option":b.value!=null&&e.setAttribute("value",""+Sa(b.value));break;case"select":e.multiple=!!b.multiple,it=b.value,it!=null?fb(e,!!b.multiple,it,!1):b.defaultValue!=null&&fb(e,!!b.multiple,b.defaultValue,!0);break;default:typeof $.onClick=="function"&&(e.onclick=Bf)}switch(c){case"button":case"input":case"select":case"textarea":b=!!b.autoFocus;break e;case"img":b=!0;break e;default:b=!1}}b&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return S(i),null;case 6:if(e&&i.stateNode!=null)Cj(e,i,e.memoizedProps,b);else{if(typeof b!="string"&&i.stateNode===null)throw Error(p(166));if(c=xh(wh.current),xh(uh.current),Gg(i)){if(b=i.stateNode,c=i.memoizedProps,b[Of]=i,(it=b.nodeValue!==c)&&(e=xg,e!==null))switch(e.tag){case 3:Af(b.nodeValue,c,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Af(b.nodeValue,c,(e.mode&1)!==0)}it&&(i.flags|=4)}else b=(c.nodeType===9?c:c.ownerDocument).createTextNode(b),b[Of]=i,i.stateNode=b}return S(i),null;case 13:if(E(L),b=i.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(I&&yg!==null&&i.mode&1&&!(i.flags&128))Hg(),Ig(),i.flags|=98560,it=!1;else if(it=Gg(i),b!==null&&b.dehydrated!==null){if(e===null){if(!it)throw Error(p(318));if(it=i.memoizedState,it=it!==null?it.dehydrated:null,!it)throw Error(p(317));it[Of]=i}else Ig(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;S(i),it=!1}else zg!==null&&(Fj(zg),zg=null),it=!0;if(!it)return i.flags&65536?i:null}return i.flags&128?(i.lanes=c,i):(b=b!==null,b!==(e!==null&&e.memoizedState!==null)&&b&&(i.child.flags|=8192,i.mode&1&&(e===null||L.current&1?T===0&&(T=3):tj())),i.updateQueue!==null&&(i.flags|=4),S(i),null);case 4:return zh(),Aj(e,i),e===null&&sf(i.stateNode.containerInfo),S(i),null;case 10:return ah(i.type._context),S(i),null;case 17:return Zf(i.type)&&$f(),S(i),null;case 19:if(E(L),it=i.memoizedState,it===null)return S(i),null;if(b=(i.flags&128)!==0,at=it.rendering,at===null)if(b)Dj(it,!1);else{if(T!==0||e!==null&&e.flags&128)for(e=i.child;e!==null;){if(at=Ch(e),at!==null){for(i.flags|=128,Dj(it,!1),b=at.updateQueue,b!==null&&(i.updateQueue=b,i.flags|=4),i.subtreeFlags=0,b=c,c=i.child;c!==null;)it=c,e=b,it.flags&=14680066,at=it.alternate,at===null?(it.childLanes=0,it.lanes=e,it.child=null,it.subtreeFlags=0,it.memoizedProps=null,it.memoizedState=null,it.updateQueue=null,it.dependencies=null,it.stateNode=null):(it.childLanes=at.childLanes,it.lanes=at.lanes,it.child=at.child,it.subtreeFlags=0,it.deletions=null,it.memoizedProps=at.memoizedProps,it.memoizedState=at.memoizedState,it.updateQueue=at.updateQueue,it.type=at.type,e=at.dependencies,it.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),c=c.sibling;return G(L,L.current&1|2),i.child}e=e.sibling}it.tail!==null&&B()>Gj&&(i.flags|=128,b=!0,Dj(it,!1),i.lanes=4194304)}else{if(!b)if(e=Ch(at),e!==null){if(i.flags|=128,b=!0,c=e.updateQueue,c!==null&&(i.updateQueue=c,i.flags|=4),Dj(it,!0),it.tail===null&&it.tailMode==="hidden"&&!at.alternate&&!I)return S(i),null}else 2*B()-it.renderingStartTime>Gj&&c!==1073741824&&(i.flags|=128,b=!0,Dj(it,!1),i.lanes=4194304);it.isBackwards?(at.sibling=i.child,i.child=at):(c=it.last,c!==null?c.sibling=at:i.child=at,it.last=at)}return it.tail!==null?(i=it.tail,it.rendering=i,it.tail=i.sibling,it.renderingStartTime=B(),i.sibling=null,c=L.current,G(L,b?c&1|2:c&1),i):(S(i),null);case 22:case 23:return Hj(),b=i.memoizedState!==null,e!==null&&e.memoizedState!==null!==b&&(i.flags|=8192),b&&i.mode&1?fj&1073741824&&(S(i),i.subtreeFlags&6&&(i.flags|=8192)):S(i),null;case 24:return null;case 25:return null}throw Error(p(156,i.tag))}function Ij(e,i){switch(wg(i),i.tag){case 1:return Zf(i.type)&&$f(),e=i.flags,e&65536?(i.flags=e&-65537|128,i):null;case 3:return zh(),E(Wf),E(H),Eh(),e=i.flags,e&65536&&!(e&128)?(i.flags=e&-65537|128,i):null;case 5:return Bh(i),null;case 13:if(E(L),e=i.memoizedState,e!==null&&e.dehydrated!==null){if(i.alternate===null)throw Error(p(340));Ig()}return e=i.flags,e&65536?(i.flags=e&-65537|128,i):null;case 19:return E(L),null;case 4:return zh(),null;case 10:return ah(i.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(e,i){var c=e.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(b){W(e,i,b)}else c.current=null}function Mj(e,i,c){try{c()}catch(b){W(e,i,b)}}var Nj=!1;function Oj(e,i){if(Cf=dd,e=Me(),Ne(e)){if("selectionStart"in e)var c={start:e.selectionStart,end:e.selectionEnd};else e:{c=(c=e.ownerDocument)&&c.defaultView||window;var b=c.getSelection&&c.getSelection();if(b&&b.rangeCount!==0){c=b.anchorNode;var $=b.anchorOffset,it=b.focusNode;b=b.focusOffset;try{c.nodeType,it.nodeType}catch{c=null;break e}var at=0,h=-1,dt=-1,ft=0,xt=0,Ct=e,bt=null;t:for(;;){for(var kt;Ct!==c||$!==0&&Ct.nodeType!==3||(h=at+$),Ct!==it||b!==0&&Ct.nodeType!==3||(dt=at+b),Ct.nodeType===3&&(at+=Ct.nodeValue.length),(kt=Ct.firstChild)!==null;)bt=Ct,Ct=kt;for(;;){if(Ct===e)break t;if(bt===c&&++ft===$&&(h=at),bt===it&&++xt===b&&(dt=at),(kt=Ct.nextSibling)!==null)break;Ct=bt,bt=Ct.parentNode}Ct=kt}c=h===-1||dt===-1?null:{start:h,end:dt}}else c=null}c=c||{start:0,end:0}}else c=null;for(Df={focusedElem:e,selectionRange:c},dd=!1,V=i;V!==null;)if(i=V,e=i.child,(i.subtreeFlags&1028)!==0&&e!==null)e.return=i,V=e;else for(;V!==null;){i=V;try{var Dt=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(Dt!==null){var At=Dt.memoizedProps,Bt=Dt.memoizedState,Tt=i.stateNode,It=Tt.getSnapshotBeforeUpdate(i.elementType===i.type?At:Ci(i.type,At),Bt);Tt.__reactInternalSnapshotBeforeUpdate=It}break;case 3:var St=i.stateNode.containerInfo;St.nodeType===1?St.textContent="":St.nodeType===9&&St.documentElement&&St.removeChild(St.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(jt){W(i,i.return,jt)}if(e=i.sibling,e!==null){e.return=i.return,V=e;break}V=i.return}return Dt=Nj,Nj=!1,Dt}function Pj(e,i,c){var b=i.updateQueue;if(b=b!==null?b.lastEffect:null,b!==null){var $=b=b.next;do{if(($.tag&e)===e){var it=$.destroy;$.destroy=void 0,it!==void 0&&Mj(i,c,it)}$=$.next}while($!==b)}}function Qj(e,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var c=i=i.next;do{if((c.tag&e)===e){var b=c.create;c.destroy=b()}c=c.next}while(c!==i)}}function Rj(e){var i=e.ref;if(i!==null){var c=e.stateNode;switch(e.tag){case 5:e=c;break;default:e=c}typeof i=="function"?i(e):i.current=e}}function Sj(e){var i=e.alternate;i!==null&&(e.alternate=null,Sj(i)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(i=e.stateNode,i!==null&&(delete i[Of],delete i[Pf],delete i[of],delete i[Qf],delete i[Rf])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Tj(e){return e.tag===5||e.tag===3||e.tag===4}function Uj(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Tj(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Vj(e,i,c){var b=e.tag;if(b===5||b===6)e=e.stateNode,i?c.nodeType===8?c.parentNode.insertBefore(e,i):c.insertBefore(e,i):(c.nodeType===8?(i=c.parentNode,i.insertBefore(e,c)):(i=c,i.appendChild(e)),c=c._reactRootContainer,c!=null||i.onclick!==null||(i.onclick=Bf));else if(b!==4&&(e=e.child,e!==null))for(Vj(e,i,c),e=e.sibling;e!==null;)Vj(e,i,c),e=e.sibling}function Wj(e,i,c){var b=e.tag;if(b===5||b===6)e=e.stateNode,i?c.insertBefore(e,i):c.appendChild(e);else if(b!==4&&(e=e.child,e!==null))for(Wj(e,i,c),e=e.sibling;e!==null;)Wj(e,i,c),e=e.sibling}var X$1=null,Xj=!1;function Yj(e,i,c){for(c=c.child;c!==null;)Zj(e,i,c),c=c.sibling}function Zj(e,i,c){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,c)}catch{}switch(c.tag){case 5:U||Lj(c,i);case 6:var b=X$1,$=Xj;X$1=null,Yj(e,i,c),X$1=b,Xj=$,X$1!==null&&(Xj?(e=X$1,c=c.stateNode,e.nodeType===8?e.parentNode.removeChild(c):e.removeChild(c)):X$1.removeChild(c.stateNode));break;case 18:X$1!==null&&(Xj?(e=X$1,c=c.stateNode,e.nodeType===8?Kf(e.parentNode,c):e.nodeType===1&&Kf(e,c),bd(e)):Kf(X$1,c.stateNode));break;case 4:b=X$1,$=Xj,X$1=c.stateNode.containerInfo,Xj=!0,Yj(e,i,c),X$1=b,Xj=$;break;case 0:case 11:case 14:case 15:if(!U&&(b=c.updateQueue,b!==null&&(b=b.lastEffect,b!==null))){$=b=b.next;do{var it=$,at=it.destroy;it=it.tag,at!==void 0&&(it&2||it&4)&&Mj(c,i,at),$=$.next}while($!==b)}Yj(e,i,c);break;case 1:if(!U&&(Lj(c,i),b=c.stateNode,typeof b.componentWillUnmount=="function"))try{b.props=c.memoizedProps,b.state=c.memoizedState,b.componentWillUnmount()}catch(h){W(c,i,h)}Yj(e,i,c);break;case 21:Yj(e,i,c);break;case 22:c.mode&1?(U=(b=U)||c.memoizedState!==null,Yj(e,i,c),U=b):Yj(e,i,c);break;default:Yj(e,i,c)}}function ak(e){var i=e.updateQueue;if(i!==null){e.updateQueue=null;var c=e.stateNode;c===null&&(c=e.stateNode=new Kj),i.forEach(function(b){var $=bk.bind(null,e,b);c.has(b)||(c.add(b),b.then($,$))})}}function ck(e,i){var c=i.deletions;if(c!==null)for(var b=0;b<c.length;b++){var $=c[b];try{var it=e,at=i,h=at;e:for(;h!==null;){switch(h.tag){case 5:X$1=h.stateNode,Xj=!1;break e;case 3:X$1=h.stateNode.containerInfo,Xj=!0;break e;case 4:X$1=h.stateNode.containerInfo,Xj=!0;break e}h=h.return}if(X$1===null)throw Error(p(160));Zj(it,at,$),X$1=null,Xj=!1;var dt=$.alternate;dt!==null&&(dt.return=null),$.return=null}catch(ft){W($,i,ft)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)dk(i,e),i=i.sibling}function dk(e,i){var c=e.alternate,b=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ck(i,e),ek(e),b&4){try{Pj(3,e,e.return),Qj(3,e)}catch(At){W(e,e.return,At)}try{Pj(5,e,e.return)}catch(At){W(e,e.return,At)}}break;case 1:ck(i,e),ek(e),b&512&&c!==null&&Lj(c,c.return);break;case 5:if(ck(i,e),ek(e),b&512&&c!==null&&Lj(c,c.return),e.flags&32){var $=e.stateNode;try{ob($,"")}catch(At){W(e,e.return,At)}}if(b&4&&($=e.stateNode,$!=null)){var it=e.memoizedProps,at=c!==null?c.memoizedProps:it,h=e.type,dt=e.updateQueue;if(e.updateQueue=null,dt!==null)try{h==="input"&&it.type==="radio"&&it.name!=null&&ab($,it),vb(h,at);var ft=vb(h,it);for(at=0;at<dt.length;at+=2){var xt=dt[at],Ct=dt[at+1];xt==="style"?sb($,Ct):xt==="dangerouslySetInnerHTML"?nb($,Ct):xt==="children"?ob($,Ct):ta($,xt,Ct,ft)}switch(h){case"input":bb($,it);break;case"textarea":ib($,it);break;case"select":var bt=$._wrapperState.wasMultiple;$._wrapperState.wasMultiple=!!it.multiple;var kt=it.value;kt!=null?fb($,!!it.multiple,kt,!1):bt!==!!it.multiple&&(it.defaultValue!=null?fb($,!!it.multiple,it.defaultValue,!0):fb($,!!it.multiple,it.multiple?[]:"",!1))}$[Pf]=it}catch(At){W(e,e.return,At)}}break;case 6:if(ck(i,e),ek(e),b&4){if(e.stateNode===null)throw Error(p(162));$=e.stateNode,it=e.memoizedProps;try{$.nodeValue=it}catch(At){W(e,e.return,At)}}break;case 3:if(ck(i,e),ek(e),b&4&&c!==null&&c.memoizedState.isDehydrated)try{bd(i.containerInfo)}catch(At){W(e,e.return,At)}break;case 4:ck(i,e),ek(e);break;case 13:ck(i,e),ek(e),$=e.child,$.flags&8192&&(it=$.memoizedState!==null,$.stateNode.isHidden=it,!it||$.alternate!==null&&$.alternate.memoizedState!==null||(fk=B())),b&4&&ak(e);break;case 22:if(xt=c!==null&&c.memoizedState!==null,e.mode&1?(U=(ft=U)||xt,ck(i,e),U=ft):ck(i,e),ek(e),b&8192){if(ft=e.memoizedState!==null,(e.stateNode.isHidden=ft)&&!xt&&e.mode&1)for(V=e,xt=e.child;xt!==null;){for(Ct=V=xt;V!==null;){switch(bt=V,kt=bt.child,bt.tag){case 0:case 11:case 14:case 15:Pj(4,bt,bt.return);break;case 1:Lj(bt,bt.return);var Dt=bt.stateNode;if(typeof Dt.componentWillUnmount=="function"){b=bt,c=bt.return;try{i=b,Dt.props=i.memoizedProps,Dt.state=i.memoizedState,Dt.componentWillUnmount()}catch(At){W(b,c,At)}}break;case 5:Lj(bt,bt.return);break;case 22:if(bt.memoizedState!==null){gk(Ct);continue}}kt!==null?(kt.return=bt,V=kt):gk(Ct)}xt=xt.sibling}e:for(xt=null,Ct=e;;){if(Ct.tag===5){if(xt===null){xt=Ct;try{$=Ct.stateNode,ft?(it=$.style,typeof it.setProperty=="function"?it.setProperty("display","none","important"):it.display="none"):(h=Ct.stateNode,dt=Ct.memoizedProps.style,at=dt!=null&&dt.hasOwnProperty("display")?dt.display:null,h.style.display=rb("display",at))}catch(At){W(e,e.return,At)}}}else if(Ct.tag===6){if(xt===null)try{Ct.stateNode.nodeValue=ft?"":Ct.memoizedProps}catch(At){W(e,e.return,At)}}else if((Ct.tag!==22&&Ct.tag!==23||Ct.memoizedState===null||Ct===e)&&Ct.child!==null){Ct.child.return=Ct,Ct=Ct.child;continue}if(Ct===e)break e;for(;Ct.sibling===null;){if(Ct.return===null||Ct.return===e)break e;xt===Ct&&(xt=null),Ct=Ct.return}xt===Ct&&(xt=null),Ct.sibling.return=Ct.return,Ct=Ct.sibling}}break;case 19:ck(i,e),ek(e),b&4&&ak(e);break;case 21:break;default:ck(i,e),ek(e)}}function ek(e){var i=e.flags;if(i&2){try{e:{for(var c=e.return;c!==null;){if(Tj(c)){var b=c;break e}c=c.return}throw Error(p(160))}switch(b.tag){case 5:var $=b.stateNode;b.flags&32&&(ob($,""),b.flags&=-33);var it=Uj(e);Wj(e,it,$);break;case 3:case 4:var at=b.stateNode.containerInfo,h=Uj(e);Vj(e,h,at);break;default:throw Error(p(161))}}catch(dt){W(e,e.return,dt)}e.flags&=-3}i&4096&&(e.flags&=-4097)}function hk(e,i,c){V=e,ik(e)}function ik(e,i,c){for(var b=(e.mode&1)!==0;V!==null;){var $=V,it=$.child;if($.tag===22&&b){var at=$.memoizedState!==null||Jj;if(!at){var h=$.alternate,dt=h!==null&&h.memoizedState!==null||U;h=Jj;var ft=U;if(Jj=at,(U=dt)&&!ft)for(V=$;V!==null;)at=V,dt=at.child,at.tag===22&&at.memoizedState!==null?jk($):dt!==null?(dt.return=at,V=dt):jk($);for(;it!==null;)V=it,ik(it),it=it.sibling;V=$,Jj=h,U=ft}kk(e)}else $.subtreeFlags&8772&&it!==null?(it.return=$,V=it):kk(e)}}function kk(e){for(;V!==null;){var i=V;if(i.flags&8772){var c=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:U||Qj(5,i);break;case 1:var b=i.stateNode;if(i.flags&4&&!U)if(c===null)b.componentDidMount();else{var $=i.elementType===i.type?c.memoizedProps:Ci(i.type,c.memoizedProps);b.componentDidUpdate($,c.memoizedState,b.__reactInternalSnapshotBeforeUpdate)}var it=i.updateQueue;it!==null&&sh(i,it,b);break;case 3:var at=i.updateQueue;if(at!==null){if(c=null,i.child!==null)switch(i.child.tag){case 5:c=i.child.stateNode;break;case 1:c=i.child.stateNode}sh(i,at,c)}break;case 5:var h=i.stateNode;if(c===null&&i.flags&4){c=h;var dt=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":dt.autoFocus&&c.focus();break;case"img":dt.src&&(c.src=dt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var ft=i.alternate;if(ft!==null){var xt=ft.memoizedState;if(xt!==null){var Ct=xt.dehydrated;Ct!==null&&bd(Ct)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||i.flags&512&&Rj(i)}catch(bt){W(i,i.return,bt)}}if(i===e){V=null;break}if(c=i.sibling,c!==null){c.return=i.return,V=c;break}V=i.return}}function gk(e){for(;V!==null;){var i=V;if(i===e){V=null;break}var c=i.sibling;if(c!==null){c.return=i.return,V=c;break}V=i.return}}function jk(e){for(;V!==null;){var i=V;try{switch(i.tag){case 0:case 11:case 15:var c=i.return;try{Qj(4,i)}catch(dt){W(i,c,dt)}break;case 1:var b=i.stateNode;if(typeof b.componentDidMount=="function"){var $=i.return;try{b.componentDidMount()}catch(dt){W(i,$,dt)}}var it=i.return;try{Rj(i)}catch(dt){W(i,it,dt)}break;case 5:var at=i.return;try{Rj(i)}catch(dt){W(i,at,dt)}}}catch(dt){W(i,i.return,dt)}if(i===e){V=null;break}var h=i.sibling;if(h!==null){h.return=i.return,V=h;break}V=i.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(e){return e.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(e=C,e!==0||(e=window.event,e=e===void 0?16:jd(e.type)),e):1}function gi(e,i,c,b){if(50<yk)throw yk=0,zk=null,Error(p(185));Ac(e,c,b),(!(K&2)||e!==Q)&&(e===Q&&(!(K&2)&&(qk|=c),T===4&&Ck(e,Z)),Dk(e,b),c===1&&K===0&&!(i.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(e,i){var c=e.callbackNode;wc(e,i);var b=uc(e,e===Q?Z:0);if(b===0)c!==null&&bc(c),e.callbackNode=null,e.callbackPriority=0;else if(i=b&-b,e.callbackPriority!==i){if(c!=null&&bc(c),i===1)e.tag===0?ig(Ek.bind(null,e)):hg(Ek.bind(null,e)),Jf(function(){!(K&6)&&jg()}),c=null;else{switch(Dc(b)){case 1:c=fc;break;case 4:c=gc;break;case 16:c=hc;break;case 536870912:c=jc;break;default:c=hc}c=Fk(c,Gk.bind(null,e))}e.callbackPriority=i,e.callbackNode=c}}function Gk(e,i){if(Ak=-1,Bk=0,K&6)throw Error(p(327));var c=e.callbackNode;if(Hk()&&e.callbackNode!==c)return null;var b=uc(e,e===Q?Z:0);if(b===0)return null;if(b&30||b&e.expiredLanes||i)i=Ik(e,b);else{i=b;var $=K;K|=2;var it=Jk();(Q!==e||Z!==i)&&(uk=null,Gj=B()+500,Kk(e,i));do try{Lk();break}catch(h){Mk(e,h)}while(1);$g(),mk.current=it,K=$,Y!==null?i=0:(Q=null,Z=0,i=T)}if(i!==0){if(i===2&&($=xc(e),$!==0&&(b=$,i=Nk(e,$))),i===1)throw c=pk,Kk(e,0),Ck(e,b),Dk(e,B()),c;if(i===6)Ck(e,b);else{if($=e.current.alternate,!(b&30)&&!Ok($)&&(i=Ik(e,b),i===2&&(it=xc(e),it!==0&&(b=it,i=Nk(e,it))),i===1))throw c=pk,Kk(e,0),Ck(e,b),Dk(e,B()),c;switch(e.finishedWork=$,e.finishedLanes=b,i){case 0:case 1:throw Error(p(345));case 2:Pk(e,tk,uk);break;case 3:if(Ck(e,b),(b&130023424)===b&&(i=fk+500-B(),10<i)){if(uc(e,0)!==0)break;if($=e.suspendedLanes,($&b)!==b){R(),e.pingedLanes|=e.suspendedLanes&$;break}e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),i);break}Pk(e,tk,uk);break;case 4:if(Ck(e,b),(b&4194240)===b)break;for(i=e.eventTimes,$=-1;0<b;){var at=31-oc(b);it=1<<at,at=i[at],at>$&&($=at),b&=~it}if(b=$,b=B()-b,b=(120>b?120:480>b?480:1080>b?1080:1920>b?1920:3e3>b?3e3:4320>b?4320:1960*lk(b/1960))-b,10<b){e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),b);break}Pk(e,tk,uk);break;case 5:Pk(e,tk,uk);break;default:throw Error(p(329))}}}return Dk(e,B()),e.callbackNode===c?Gk.bind(null,e):null}function Nk(e,i){var c=sk;return e.current.memoizedState.isDehydrated&&(Kk(e,i).flags|=256),e=Ik(e,i),e!==2&&(i=tk,tk=c,i!==null&&Fj(i)),e}function Fj(e){tk===null?tk=e:tk.push.apply(tk,e)}function Ok(e){for(var i=e;;){if(i.flags&16384){var c=i.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var b=0;b<c.length;b++){var $=c[b],it=$.getSnapshot;$=$.value;try{if(!He(it(),$))return!1}catch{return!1}}}if(c=i.child,i.subtreeFlags&16384&&c!==null)c.return=i,i=c;else{if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Ck(e,i){for(i&=~rk,i&=~qk,e.suspendedLanes|=i,e.pingedLanes&=~i,e=e.expirationTimes;0<i;){var c=31-oc(i),b=1<<c;e[c]=-1,i&=~b}}function Ek(e){if(K&6)throw Error(p(327));Hk();var i=uc(e,0);if(!(i&1))return Dk(e,B()),null;var c=Ik(e,i);if(e.tag!==0&&c===2){var b=xc(e);b!==0&&(i=b,c=Nk(e,b))}if(c===1)throw c=pk,Kk(e,0),Ck(e,i),Dk(e,B()),c;if(c===6)throw Error(p(345));return e.finishedWork=e.current.alternate,e.finishedLanes=i,Pk(e,tk,uk),Dk(e,B()),null}function Qk(e,i){var c=K;K|=1;try{return e(i)}finally{K=c,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(e){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var i=K;K|=1;var c=ok.transition,b=C;try{if(ok.transition=null,C=1,e)return e()}finally{C=b,ok.transition=c,K=i,!(K&6)&&jg()}}function Hj(){fj=ej.current,E(ej)}function Kk(e,i){e.finishedWork=null,e.finishedLanes=0;var c=e.timeoutHandle;if(c!==-1&&(e.timeoutHandle=-1,Gf(c)),Y!==null)for(c=Y.return;c!==null;){var b=c;switch(wg(b),b.tag){case 1:b=b.type.childContextTypes,b!=null&&$f();break;case 3:zh(),E(Wf),E(H),Eh();break;case 5:Bh(b);break;case 4:zh();break;case 13:E(L);break;case 19:E(L);break;case 10:ah(b.type._context);break;case 22:case 23:Hj()}c=c.return}if(Q=e,Y=e=Pg(e.current,null),Z=fj=i,T=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(i=0;i<fh.length;i++)if(c=fh[i],b=c.interleaved,b!==null){c.interleaved=null;var $=b.next,it=c.pending;if(it!==null){var at=it.next;it.next=$,b.next=at}c.pending=b}fh=null}return e}function Mk(e,i){do{var c=Y;try{if($g(),Fh.current=Rh,Ih){for(var b=M.memoizedState;b!==null;){var $=b.queue;$!==null&&($.pending=null),b=b.next}Ih=!1}if(Hh=0,O=N=M=null,Jh=!1,Kh=0,nk.current=null,c===null||c.return===null){T=1,pk=i,Y=null;break}e:{var it=e,at=c.return,h=c,dt=i;if(i=Z,h.flags|=32768,dt!==null&&typeof dt=="object"&&typeof dt.then=="function"){var ft=dt,xt=h,Ct=xt.tag;if(!(xt.mode&1)&&(Ct===0||Ct===11||Ct===15)){var bt=xt.alternate;bt?(xt.updateQueue=bt.updateQueue,xt.memoizedState=bt.memoizedState,xt.lanes=bt.lanes):(xt.updateQueue=null,xt.memoizedState=null)}var kt=Ui(at);if(kt!==null){kt.flags&=-257,Vi(kt,at,h,it,i),kt.mode&1&&Si(it,ft,i),i=kt,dt=ft;var Dt=i.updateQueue;if(Dt===null){var At=new Set;At.add(dt),i.updateQueue=At}else Dt.add(dt);break e}else{if(!(i&1)){Si(it,ft,i),tj();break e}dt=Error(p(426))}}else if(I&&h.mode&1){var Bt=Ui(at);if(Bt!==null){!(Bt.flags&65536)&&(Bt.flags|=256),Vi(Bt,at,h,it,i),Jg(Ji(dt,h));break e}}it=dt=Ji(dt,h),T!==4&&(T=2),sk===null?sk=[it]:sk.push(it),it=at;do{switch(it.tag){case 3:it.flags|=65536,i&=-i,it.lanes|=i;var Tt=Ni(it,dt,i);ph(it,Tt);break e;case 1:h=dt;var It=it.type,St=it.stateNode;if(!(it.flags&128)&&(typeof It.getDerivedStateFromError=="function"||St!==null&&typeof St.componentDidCatch=="function"&&(Ri===null||!Ri.has(St)))){it.flags|=65536,i&=-i,it.lanes|=i;var jt=Qi(it,h,i);ph(it,jt);break e}}it=it.return}while(it!==null)}Sk(c)}catch(Ht){i=Ht,Y===c&&c!==null&&(Y=c=c.return);continue}break}while(1)}function Jk(){var e=mk.current;return mk.current=Rh,e===null?Rh:e}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(e,i){var c=K;K|=2;var b=Jk();(Q!==e||Z!==i)&&(uk=null,Kk(e,i));do try{Tk();break}catch($){Mk(e,$)}while(1);if($g(),K=c,mk.current=b,Y!==null)throw Error(p(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(e){var i=Vk(e.alternate,e,fj);e.memoizedProps=e.pendingProps,i===null?Sk(e):Y=i,nk.current=null}function Sk(e){var i=e;do{var c=i.alternate;if(e=i.return,i.flags&32768){if(c=Ij(c,i),c!==null){c.flags&=32767,Y=c;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{T=6,Y=null;return}}else if(c=Ej(c,i,fj),c!==null){Y=c;return}if(i=i.sibling,i!==null){Y=i;return}Y=i=e}while(i!==null);T===0&&(T=5)}function Pk(e,i,c){var b=C,$=ok.transition;try{ok.transition=null,C=1,Wk(e,i,c,b)}finally{ok.transition=$,C=b}return null}function Wk(e,i,c,b){do Hk();while(wk!==null);if(K&6)throw Error(p(327));c=e.finishedWork;var $=e.finishedLanes;if(c===null)return null;if(e.finishedWork=null,e.finishedLanes=0,c===e.current)throw Error(p(177));e.callbackNode=null,e.callbackPriority=0;var it=c.lanes|c.childLanes;if(Bc(e,it),e===Q&&(Y=Q=null,Z=0),!(c.subtreeFlags&2064)&&!(c.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),it=(c.flags&15990)!==0,c.subtreeFlags&15990||it){it=ok.transition,ok.transition=null;var at=C;C=1;var h=K;K|=4,nk.current=null,Oj(e,c),dk(c,e),Oe(Df),dd=!!Cf,Df=Cf=null,e.current=c,hk(c),dc(),K=h,C=at,ok.transition=it}else e.current=c;if(vk&&(vk=!1,wk=e,xk=$),it=e.pendingLanes,it===0&&(Ri=null),mc(c.stateNode),Dk(e,B()),i!==null)for(b=e.onRecoverableError,c=0;c<i.length;c++)$=i[c],b($.value,{componentStack:$.stack,digest:$.digest});if(Oi)throw Oi=!1,e=Pi,Pi=null,e;return xk&1&&e.tag!==0&&Hk(),it=e.pendingLanes,it&1?e===zk?yk++:(yk=0,zk=e):yk=0,jg(),null}function Hk(){if(wk!==null){var e=Dc(xk),i=ok.transition,c=C;try{if(ok.transition=null,C=16>e?16:e,wk===null)var b=!1;else{if(e=wk,wk=null,xk=0,K&6)throw Error(p(331));var $=K;for(K|=4,V=e.current;V!==null;){var it=V,at=it.child;if(V.flags&16){var h=it.deletions;if(h!==null){for(var dt=0;dt<h.length;dt++){var ft=h[dt];for(V=ft;V!==null;){var xt=V;switch(xt.tag){case 0:case 11:case 15:Pj(8,xt,it)}var Ct=xt.child;if(Ct!==null)Ct.return=xt,V=Ct;else for(;V!==null;){xt=V;var bt=xt.sibling,kt=xt.return;if(Sj(xt),xt===ft){V=null;break}if(bt!==null){bt.return=kt,V=bt;break}V=kt}}}var Dt=it.alternate;if(Dt!==null){var At=Dt.child;if(At!==null){Dt.child=null;do{var Bt=At.sibling;At.sibling=null,At=Bt}while(At!==null)}}V=it}}if(it.subtreeFlags&2064&&at!==null)at.return=it,V=at;else e:for(;V!==null;){if(it=V,it.flags&2048)switch(it.tag){case 0:case 11:case 15:Pj(9,it,it.return)}var Tt=it.sibling;if(Tt!==null){Tt.return=it.return,V=Tt;break e}V=it.return}}var It=e.current;for(V=It;V!==null;){at=V;var St=at.child;if(at.subtreeFlags&2064&&St!==null)St.return=at,V=St;else e:for(at=It;V!==null;){if(h=V,h.flags&2048)try{switch(h.tag){case 0:case 11:case 15:Qj(9,h)}}catch(Ht){W(h,h.return,Ht)}if(h===at){V=null;break e}var jt=h.sibling;if(jt!==null){jt.return=h.return,V=jt;break e}V=h.return}}if(K=$,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,e)}catch{}b=!0}return b}finally{C=c,ok.transition=i}}return!1}function Xk(e,i,c){i=Ji(c,i),i=Ni(e,i,1),e=nh(e,i,1),i=R(),e!==null&&(Ac(e,1,i),Dk(e,i))}function W(e,i,c){if(e.tag===3)Xk(e,e,c);else for(;i!==null;){if(i.tag===3){Xk(i,e,c);break}else if(i.tag===1){var b=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(Ri===null||!Ri.has(b))){e=Ji(c,e),e=Qi(i,e,1),i=nh(i,e,1),e=R(),i!==null&&(Ac(i,1,e),Dk(i,e));break}}i=i.return}}function Ti(e,i,c){var b=e.pingCache;b!==null&&b.delete(i),i=R(),e.pingedLanes|=e.suspendedLanes&c,Q===e&&(Z&c)===c&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(e,0):rk|=c),Dk(e,i)}function Yk(e,i){i===0&&(e.mode&1?(i=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):i=1);var c=R();e=ih(e,i),e!==null&&(Ac(e,i,c),Dk(e,c))}function uj(e){var i=e.memoizedState,c=0;i!==null&&(c=i.retryLane),Yk(e,c)}function bk(e,i){var c=0;switch(e.tag){case 13:var b=e.stateNode,$=e.memoizedState;$!==null&&(c=$.retryLane);break;case 19:b=e.stateNode;break;default:throw Error(p(314))}b!==null&&b.delete(i),Yk(e,c)}var Vk;Vk=function(e,i,c){if(e!==null)if(e.memoizedProps!==i.pendingProps||Wf.current)dh=!0;else{if(!(e.lanes&c)&&!(i.flags&128))return dh=!1,yj(e,i,c);dh=!!(e.flags&131072)}else dh=!1,I&&i.flags&1048576&&ug(i,ng,i.index);switch(i.lanes=0,i.tag){case 2:var b=i.type;ij(e,i),e=i.pendingProps;var $=Yf(i,H.current);ch(i,c),$=Nh(null,i,b,e,$,c);var it=Sh();return i.flags|=1,typeof $=="object"&&$!==null&&typeof $.render=="function"&&$.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Zf(b)?(it=!0,cg(i)):it=!1,i.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,kh(i),$.updater=Ei,i.stateNode=$,$._reactInternals=i,Ii(i,b,e,c),i=jj(null,i,b,!0,it,c)):(i.tag=0,I&&it&&vg(i),Xi(null,i,$,c),i=i.child),i;case 16:b=i.elementType;e:{switch(ij(e,i),e=i.pendingProps,$=b._init,b=$(b._payload),i.type=b,$=i.tag=Zk(b),e=Ci(b,e),$){case 0:i=cj(null,i,b,e,c);break e;case 1:i=hj(null,i,b,e,c);break e;case 11:i=Yi(null,i,b,e,c);break e;case 14:i=$i(null,i,b,Ci(b.type,e),c);break e}throw Error(p(306,b,""))}return i;case 0:return b=i.type,$=i.pendingProps,$=i.elementType===b?$:Ci(b,$),cj(e,i,b,$,c);case 1:return b=i.type,$=i.pendingProps,$=i.elementType===b?$:Ci(b,$),hj(e,i,b,$,c);case 3:e:{if(kj(i),e===null)throw Error(p(387));b=i.pendingProps,it=i.memoizedState,$=it.element,lh(e,i),qh(i,b,null,c);var at=i.memoizedState;if(b=at.element,it.isDehydrated)if(it={element:b,isDehydrated:!1,cache:at.cache,pendingSuspenseBoundaries:at.pendingSuspenseBoundaries,transitions:at.transitions},i.updateQueue.baseState=it,i.memoizedState=it,i.flags&256){$=Ji(Error(p(423)),i),i=lj(e,i,b,c,$);break e}else if(b!==$){$=Ji(Error(p(424)),i),i=lj(e,i,b,c,$);break e}else for(yg=Lf(i.stateNode.containerInfo.firstChild),xg=i,I=!0,zg=null,c=Vg(i,null,b,c),i.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(Ig(),b===$){i=Zi(e,i,c);break e}Xi(e,i,b,c)}i=i.child}return i;case 5:return Ah(i),e===null&&Eg(i),b=i.type,$=i.pendingProps,it=e!==null?e.memoizedProps:null,at=$.children,Ef(b,$)?at=null:it!==null&&Ef(b,it)&&(i.flags|=32),gj(e,i),Xi(e,i,at,c),i.child;case 6:return e===null&&Eg(i),null;case 13:return oj(e,i,c);case 4:return yh(i,i.stateNode.containerInfo),b=i.pendingProps,e===null?i.child=Ug(i,null,b,c):Xi(e,i,b,c),i.child;case 11:return b=i.type,$=i.pendingProps,$=i.elementType===b?$:Ci(b,$),Yi(e,i,b,$,c);case 7:return Xi(e,i,i.pendingProps,c),i.child;case 8:return Xi(e,i,i.pendingProps.children,c),i.child;case 12:return Xi(e,i,i.pendingProps.children,c),i.child;case 10:e:{if(b=i.type._context,$=i.pendingProps,it=i.memoizedProps,at=$.value,G(Wg,b._currentValue),b._currentValue=at,it!==null)if(He(it.value,at)){if(it.children===$.children&&!Wf.current){i=Zi(e,i,c);break e}}else for(it=i.child,it!==null&&(it.return=i);it!==null;){var h=it.dependencies;if(h!==null){at=it.child;for(var dt=h.firstContext;dt!==null;){if(dt.context===b){if(it.tag===1){dt=mh(-1,c&-c),dt.tag=2;var ft=it.updateQueue;if(ft!==null){ft=ft.shared;var xt=ft.pending;xt===null?dt.next=dt:(dt.next=xt.next,xt.next=dt),ft.pending=dt}}it.lanes|=c,dt=it.alternate,dt!==null&&(dt.lanes|=c),bh(it.return,c,i),h.lanes|=c;break}dt=dt.next}}else if(it.tag===10)at=it.type===i.type?null:it.child;else if(it.tag===18){if(at=it.return,at===null)throw Error(p(341));at.lanes|=c,h=at.alternate,h!==null&&(h.lanes|=c),bh(at,c,i),at=it.sibling}else at=it.child;if(at!==null)at.return=it;else for(at=it;at!==null;){if(at===i){at=null;break}if(it=at.sibling,it!==null){it.return=at.return,at=it;break}at=at.return}it=at}Xi(e,i,$.children,c),i=i.child}return i;case 9:return $=i.type,b=i.pendingProps.children,ch(i,c),$=eh($),b=b($),i.flags|=1,Xi(e,i,b,c),i.child;case 14:return b=i.type,$=Ci(b,i.pendingProps),$=Ci(b.type,$),$i(e,i,b,$,c);case 15:return bj(e,i,i.type,i.pendingProps,c);case 17:return b=i.type,$=i.pendingProps,$=i.elementType===b?$:Ci(b,$),ij(e,i),i.tag=1,Zf(b)?(e=!0,cg(i)):e=!1,ch(i,c),Gi(i,b,$),Ii(i,b,$,c),jj(null,i,b,!0,e,c);case 19:return xj(e,i,c);case 22:return dj(e,i,c)}throw Error(p(156,i.tag))};function Fk(e,i){return ac(e,i)}function $k(e,i,c,b){this.tag=e,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(e,i,c,b){return new $k(e,i,c,b)}function aj(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Zk(e){if(typeof e=="function")return aj(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Da)return 11;if(e===Ga)return 14}return 2}function Pg(e,i){var c=e.alternate;return c===null?(c=Bg(e.tag,i,e.key,e.mode),c.elementType=e.elementType,c.type=e.type,c.stateNode=e.stateNode,c.alternate=e,e.alternate=c):(c.pendingProps=i,c.type=e.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=e.flags&14680064,c.childLanes=e.childLanes,c.lanes=e.lanes,c.child=e.child,c.memoizedProps=e.memoizedProps,c.memoizedState=e.memoizedState,c.updateQueue=e.updateQueue,i=e.dependencies,c.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},c.sibling=e.sibling,c.index=e.index,c.ref=e.ref,c}function Rg(e,i,c,b,$,it){var at=2;if(b=e,typeof e=="function")aj(e)&&(at=1);else if(typeof e=="string")at=5;else e:switch(e){case ya:return Tg(c.children,$,it,i);case za:at=8,$|=8;break;case Aa:return e=Bg(12,c,i,$|2),e.elementType=Aa,e.lanes=it,e;case Ea:return e=Bg(13,c,i,$),e.elementType=Ea,e.lanes=it,e;case Fa:return e=Bg(19,c,i,$),e.elementType=Fa,e.lanes=it,e;case Ia:return pj(c,$,it,i);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Ba:at=10;break e;case Ca:at=9;break e;case Da:at=11;break e;case Ga:at=14;break e;case Ha:at=16,b=null;break e}throw Error(p(130,e==null?e:typeof e,""))}return i=Bg(at,c,i,$),i.elementType=e,i.type=b,i.lanes=it,i}function Tg(e,i,c,b){return e=Bg(7,e,b,i),e.lanes=c,e}function pj(e,i,c,b){return e=Bg(22,e,b,i),e.elementType=Ia,e.lanes=c,e.stateNode={isHidden:!1},e}function Qg(e,i,c){return e=Bg(6,e,null,i),e.lanes=c,e}function Sg(e,i,c){return i=Bg(4,e.children!==null?e.children:[],e.key,i),i.lanes=c,i.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},i}function al(e,i,c,b,$){this.tag=i,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=b,this.onRecoverableError=$,this.mutableSourceEagerHydrationData=null}function bl(e,i,c,b,$,it,at,h,dt){return e=new al(e,i,c,h,dt),i===1?(i=1,it===!0&&(i|=8)):i=0,it=Bg(3,null,null,i),e.current=it,it.stateNode=e,it.memoizedState={element:b,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(it),e}function cl(e,i,c){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:b==null?null:""+b,children:e,containerInfo:i,implementation:c}}function dl(e){if(!e)return Vf;e=e._reactInternals;e:{if(Vb(e)!==e||e.tag!==1)throw Error(p(170));var i=e;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Zf(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(p(171))}if(e.tag===1){var c=e.type;if(Zf(c))return bg(e,c,i)}return i}function el(e,i,c,b,$,it,at,h,dt){return e=bl(c,b,!0,e,$,it,at,h,dt),e.context=dl(null),c=e.current,b=R(),$=yi(c),it=mh(b,$),it.callback=i??null,nh(c,it,$),e.current.lanes=$,Ac(e,$,b),Dk(e,b),e}function fl(e,i,c,b){var $=i.current,it=R(),at=yi($);return c=dl(c),i.context===null?i.context=c:i.pendingContext=c,i=mh(it,at),i.payload={element:e},b=b===void 0?null:b,b!==null&&(i.callback=b),e=nh($,i,at),e!==null&&(gi(e,$,at,it),oh(e,$,at)),at}function gl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function hl(e,i){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var c=e.retryLane;e.retryLane=c!==0&&c<i?c:i}}function il(e,i){hl(e,i),(e=e.alternate)&&hl(e,i)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(e){console.error(e)};function ll(e){this._internalRoot=e}ml.prototype.render=ll.prototype.render=function(e){var i=this._internalRoot;if(i===null)throw Error(p(409));fl(e,i,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var i=e.containerInfo;Rk(function(){fl(null,e,null,null)}),i[uf]=null}};function ml(e){this._internalRoot=e}ml.prototype.unstable_scheduleHydration=function(e){if(e){var i=Hc();e={blockedOn:null,target:e,priority:i};for(var c=0;c<Qc.length&&i!==0&&i<Qc[c].priority;c++);Qc.splice(c,0,e),c===0&&Vc(e)}};function nl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ol(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(e,i,c,b,$){if($){if(typeof b=="function"){var it=b;b=function(){var ft=gl(at);it.call(ft)}}var at=el(i,b,e,0,null,!1,!1,"",pl);return e._reactRootContainer=at,e[uf]=at.current,sf(e.nodeType===8?e.parentNode:e),Rk(),at}for(;$=e.lastChild;)e.removeChild($);if(typeof b=="function"){var h=b;b=function(){var ft=gl(dt);h.call(ft)}}var dt=bl(e,0,!1,null,null,!1,!1,"",pl);return e._reactRootContainer=dt,e[uf]=dt.current,sf(e.nodeType===8?e.parentNode:e),Rk(function(){fl(i,dt,c,b)}),dt}function rl(e,i,c,b,$){var it=c._reactRootContainer;if(it){var at=it;if(typeof $=="function"){var h=$;$=function(){var dt=gl(at);h.call(dt)}}fl(i,at,e,$)}else at=ql(c,i,e,$,b);return gl(at)}Ec=function(e){switch(e.tag){case 3:var i=e.stateNode;if(i.current.memoizedState.isDehydrated){var c=tc(i.pendingLanes);c!==0&&(Cc(i,c|1),Dk(i,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var b=ih(e,1);if(b!==null){var $=R();gi(b,e,1,$)}}),il(e,1)}};Fc=function(e){if(e.tag===13){var i=ih(e,134217728);if(i!==null){var c=R();gi(i,e,134217728,c)}il(e,134217728)}};Gc=function(e){if(e.tag===13){var i=yi(e),c=ih(e,i);if(c!==null){var b=R();gi(c,e,i,b)}il(e,i)}};Hc=function(){return C};Ic=function(e,i){var c=C;try{return C=e,i()}finally{C=c}};yb=function(e,i,c){switch(i){case"input":if(bb(e,c),i=c.name,c.type==="radio"&&i!=null){for(c=e;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<c.length;i++){var b=c[i];if(b!==e&&b.form===e.form){var $=Db(b);if(!$)throw Error(p(90));Wa(b),bb(b,$)}}}break;case"textarea":ib(e,c);break;case"select":i=c.value,i!=null&&fb(e,!!c.multiple,i,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Zb(e),e===null?null:e.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(e,i){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(i))throw Error(p(200));return cl(e,i,null,c)};reactDom_production_min.createRoot=function(e,i){if(!nl(e))throw Error(p(299));var c=!1,b="",$=kl;return i!=null&&(i.unstable_strictMode===!0&&(c=!0),i.identifierPrefix!==void 0&&(b=i.identifierPrefix),i.onRecoverableError!==void 0&&($=i.onRecoverableError)),i=bl(e,1,!1,null,null,c,!1,b,$),e[uf]=i.current,sf(e.nodeType===8?e.parentNode:e),new ll(i)};reactDom_production_min.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var i=e._reactInternals;if(i===void 0)throw typeof e.render=="function"?Error(p(188)):(e=Object.keys(e).join(","),Error(p(268,e)));return e=Zb(i),e=e===null?null:e.stateNode,e};reactDom_production_min.flushSync=function(e){return Rk(e)};reactDom_production_min.hydrate=function(e,i,c){if(!ol(i))throw Error(p(200));return rl(null,e,i,!0,c)};reactDom_production_min.hydrateRoot=function(e,i,c){if(!nl(e))throw Error(p(405));var b=c!=null&&c.hydratedSources||null,$=!1,it="",at=kl;if(c!=null&&(c.unstable_strictMode===!0&&($=!0),c.identifierPrefix!==void 0&&(it=c.identifierPrefix),c.onRecoverableError!==void 0&&(at=c.onRecoverableError)),i=el(i,null,e,1,c??null,$,!1,it,at),e[uf]=i.current,sf(e),b)for(e=0;e<b.length;e++)c=b[e],$=c._getVersion,$=$(c._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[c,$]:i.mutableSourceEagerHydrationData.push(c,$);return new ml(i)};reactDom_production_min.render=function(e,i,c){if(!ol(i))throw Error(p(200));return rl(null,e,i,!1,c)};reactDom_production_min.unmountComponentAtNode=function(e){if(!ol(e))throw Error(p(40));return e._reactRootContainer?(Rk(function(){rl(null,null,e,!1,function(){e._reactRootContainer=null,e[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(e,i,c,b){if(!ol(c))throw Error(p(200));if(e==null||e._reactInternals===void 0)throw Error(p(38));return rl(e,i,c,!1,b)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(e){console.error(e)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const ReactDOM=getDefaultExportFromCjs(reactDomExports);var createRoot,m=reactDomExports;createRoot=m.createRoot,m.hydrateRoot;function parse$1(e,i){if(e instanceof RegExp)return{keys:!1,pattern:e};var c,b,$,it,at=[],h="",dt=e.split("/");for(dt[0]||dt.shift();$=dt.shift();)c=$[0],c==="*"?(at.push(c),h+=$[1]==="?"?"(?:/(.*))?":"/(.*)"):c===":"?(b=$.indexOf("?",1),it=$.indexOf(".",1),at.push($.substring(1,~b?b:~it?it:$.length)),h+=~b&&!~it?"(?:/([^/]+?))?":"/([^/]+?)",~it&&(h+=(~b?"?":"")+"\\"+$.substring(it))):h+="/"+$;return{keys:at,pattern:new RegExp("^"+h+(i?"(?=$|/)":"/?$"),"i")}}var shim$3={exports:{}},useSyncExternalStoreShim_production$1={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var React$1=reactExports;function is$1(e,i){return e===i&&(e!==0||1/e===1/i)||e!==e&&i!==i}var objectIs$1=typeof Object.is=="function"?Object.is:is$1,useState$1=React$1.useState,useEffect$1=React$1.useEffect,useLayoutEffect$1=React$1.useLayoutEffect,useDebugValue$1=React$1.useDebugValue;function useSyncExternalStore$2$1(e,i){var c=i(),b=useState$1({inst:{value:c,getSnapshot:i}}),$=b[0].inst,it=b[1];return useLayoutEffect$1(function(){$.value=c,$.getSnapshot=i,checkIfSnapshotChanged$1($)&&it({inst:$})},[e,c,i]),useEffect$1(function(){return checkIfSnapshotChanged$1($)&&it({inst:$}),e(function(){checkIfSnapshotChanged$1($)&&it({inst:$})})},[e]),useDebugValue$1(c),c}function checkIfSnapshotChanged$1(e){var i=e.getSnapshot;e=e.value;try{var c=i();return!objectIs$1(e,c)}catch{return!0}}function useSyncExternalStore$1$1(e,i){return i()}var shim$2=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?useSyncExternalStore$1$1:useSyncExternalStore$2$1;useSyncExternalStoreShim_production$1.useSyncExternalStore=React$1.useSyncExternalStore!==void 0?React$1.useSyncExternalStore:shim$2;shim$3.exports=useSyncExternalStoreShim_production$1;var shimExports$1=shim$3.exports;const useBuiltinInsertionEffect=React$3["useInsertionEffect"],canUseDOM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",useIsomorphicLayoutEffect$2=canUseDOM?reactExports.useLayoutEffect:reactExports.useEffect,useInsertionEffect$1=useBuiltinInsertionEffect||useIsomorphicLayoutEffect$2,useEvent=e=>{const i=reactExports.useRef([e,(...c)=>i[0](...c)]).current;return useInsertionEffect$1(()=>{i[0]=e}),i[1]},eventPopstate="popstate",eventPushState="pushState",eventReplaceState="replaceState",eventHashchange="hashchange",events=[eventPopstate,eventPushState,eventReplaceState,eventHashchange],subscribeToLocationUpdates=e=>{for(const i of events)addEventListener(i,e);return()=>{for(const i of events)removeEventListener(i,e)}},useLocationProperty=(e,i)=>shimExports$1.useSyncExternalStore(subscribeToLocationUpdates,e,i),currentSearch=()=>location.search,useSearch=({ssrSearch:e=""}={})=>useLocationProperty(currentSearch,()=>e),currentPathname=()=>location.pathname,usePathname=({ssrPath:e}={})=>useLocationProperty(currentPathname,e?()=>e:currentPathname),navigate=(e,{replace:i=!1,state:c=null}={})=>history[i?eventReplaceState:eventPushState](c,"",e),useBrowserLocation=(e={})=>[usePathname(e),navigate],patchKey=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[patchKey]>"u"){for(const e of[eventPushState,eventReplaceState]){const i=history[e];history[e]=function(){const c=i.apply(this,arguments),b=new Event(e);return b.arguments=arguments,dispatchEvent(b),c}}Object.defineProperty(window,patchKey,{value:!0})}const _relativePath=(e,i)=>i.toLowerCase().indexOf(e.toLowerCase())?"~"+i:i.slice(e.length)||"/",baseDefaults=(e="")=>e==="/"?"":e,absolutePath=(e,i)=>e[0]==="~"?e.slice(1):baseDefaults(i)+e,relativePath=(e="",i)=>_relativePath(unescape(baseDefaults(e)),unescape(i)),unescape=e=>{try{return decodeURI(e)}catch{return e}},defaultRouter={hook:useBrowserLocation,searchHook:useSearch,parser:parse$1,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:e=>e},RouterCtx=reactExports.createContext(defaultRouter),useRouter=()=>reactExports.useContext(RouterCtx),Params0={},ParamsCtx=reactExports.createContext(Params0),useParams=()=>reactExports.useContext(ParamsCtx),useLocationFromRouter=e=>{const[i,c]=e.hook(e);return[relativePath(e.base,i),useEvent((b,$)=>c(absolutePath(b,e.base),$))]},matchRoute=(e,i,c,b)=>{const{pattern:$,keys:it}=i instanceof RegExp?{keys:!1,pattern:i}:e(i||"*",b),at=$.exec(c)||[],[h,...dt]=at;return h!==void 0?[!0,(()=>{const ft=it!==!1?Object.fromEntries(it.map((Ct,bt)=>[Ct,dt[bt]])):at.groups;let xt={...dt};return ft&&Object.assign(xt,ft),xt})(),...b?[h]:[]]:[!1,null]},Router$1=({children:e,...i})=>{var xt,Ct;const c=useRouter(),b=i.hook?defaultRouter:c;let $=b;const[it,at]=((xt=i.ssrPath)==null?void 0:xt.split("?"))??[];at&&(i.ssrSearch=at,i.ssrPath=it),i.hrefs=i.hrefs??((Ct=i.hook)==null?void 0:Ct.hrefs);let h=reactExports.useRef({}),dt=h.current,ft=dt;for(let bt in b){const kt=bt==="base"?b[bt]+(i[bt]||""):i[bt]||b[bt];dt===ft&&kt!==ft[bt]&&(h.current=ft={...ft}),ft[bt]=kt,(kt!==b[bt]||kt!==$[bt])&&($=ft)}return reactExports.createElement(RouterCtx.Provider,{value:$,children:e})},h_route=({children:e,component:i},c)=>i?reactExports.createElement(i,{params:c}):typeof e=="function"?e(c):e,useCachedParams=e=>{let i=reactExports.useRef(Params0);const c=i.current;return i.current=Object.keys(e).length!==Object.keys(c).length||Object.entries(e).some(([b,$])=>$!==c[b])?e:c},Route=({path:e,nest:i,match:c,...b})=>{const $=useRouter(),[it]=useLocationFromRouter($),[at,h,dt]=c??matchRoute($.parser,e,it,i),ft=useCachedParams({...useParams(),...h});if(!at)return null;const xt=dt?reactExports.createElement(Router$1,{base:dt},h_route(b,ft)):h_route(b,ft);return reactExports.createElement(ParamsCtx.Provider,{value:ft,children:xt})},Link=reactExports.forwardRef((e,i)=>{const c=useRouter(),[b,$]=useLocationFromRouter(c),{to:it="",href:at=it,onClick:h,asChild:dt,children:ft,className:xt,replace:Ct,state:bt,...kt}=e,Dt=useEvent(Bt=>{Bt.ctrlKey||Bt.metaKey||Bt.altKey||Bt.shiftKey||Bt.button!==0||(h==null||h(Bt),Bt.defaultPrevented||(Bt.preventDefault(),$(at,e)))}),At=c.hrefs(at[0]==="~"?at.slice(1):c.base+at,c);return dt&&reactExports.isValidElement(ft)?reactExports.cloneElement(ft,{onClick:Dt,href:At}):reactExports.createElement("a",{...kt,onClick:Dt,href:At,className:xt!=null&&xt.call?xt(b===at):xt,children:ft,ref:i})}),flattenChildren=e=>Array.isArray(e)?e.flatMap(i=>flattenChildren(i&&i.type===reactExports.Fragment?i.props.children:i)):[e],Switch=({children:e,location:i})=>{const c=useRouter(),[b]=useLocationFromRouter(c);for(const $ of flattenChildren(e)){let it=0;if(reactExports.isValidElement($)&&(it=matchRoute(c.parser,$.props.path,i||b,$.props.nest))[0])return reactExports.cloneElement($,{match:it})}return null};class Subscribable{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(i){const c={listener:i};return this.listeners.add(c),this.onSubscribe(),()=>{this.listeners.delete(c),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}}const isServer=typeof window>"u"||"Deno"in window;function noop$3(){}function functionalUpdate(e,i){return typeof e=="function"?e(i):e}function isValidTimeout(e){return typeof e=="number"&&e>=0&&e!==1/0}function timeUntilStale(e,i){return Math.max(e+(i||0)-Date.now(),0)}function parseQueryArgs(e,i,c){return isQueryKey(e)?typeof i=="function"?{...c,queryKey:e,queryFn:i}:{...i,queryKey:e}:e}function parseMutationArgs(e,i,c){return isQueryKey(e)?typeof i=="function"?{...c,mutationKey:e,mutationFn:i}:{...i,mutationKey:e}:typeof e=="function"?{...i,mutationFn:e}:{...e}}function parseFilterArgs(e,i,c){return isQueryKey(e)?[{...i,queryKey:e},c]:[e||{},i]}function matchQuery(e,i){const{type:c="all",exact:b,fetchStatus:$,predicate:it,queryKey:at,stale:h}=e;if(isQueryKey(at)){if(b){if(i.queryHash!==hashQueryKeyByOptions(at,i.options))return!1}else if(!partialMatchKey(i.queryKey,at))return!1}if(c!=="all"){const dt=i.isActive();if(c==="active"&&!dt||c==="inactive"&&dt)return!1}return!(typeof h=="boolean"&&i.isStale()!==h||typeof $<"u"&&$!==i.state.fetchStatus||it&&!it(i))}function matchMutation(e,i){const{exact:c,fetching:b,predicate:$,mutationKey:it}=e;if(isQueryKey(it)){if(!i.options.mutationKey)return!1;if(c){if(hashQueryKey(i.options.mutationKey)!==hashQueryKey(it))return!1}else if(!partialMatchKey(i.options.mutationKey,it))return!1}return!(typeof b=="boolean"&&i.state.status==="loading"!==b||$&&!$(i))}function hashQueryKeyByOptions(e,i){return((i==null?void 0:i.queryKeyHashFn)||hashQueryKey)(e)}function hashQueryKey(e){return JSON.stringify(e,(i,c)=>isPlainObject(c)?Object.keys(c).sort().reduce((b,$)=>(b[$]=c[$],b),{}):c)}function partialMatchKey(e,i){return partialDeepEqual(e,i)}function partialDeepEqual(e,i){return e===i?!0:typeof e!=typeof i?!1:e&&i&&typeof e=="object"&&typeof i=="object"?!Object.keys(i).some(c=>!partialDeepEqual(e[c],i[c])):!1}function replaceEqualDeep(e,i){if(e===i)return e;const c=isPlainArray(e)&&isPlainArray(i);if(c||isPlainObject(e)&&isPlainObject(i)){const b=c?e.length:Object.keys(e).length,$=c?i:Object.keys(i),it=$.length,at=c?[]:{};let h=0;for(let dt=0;dt<it;dt++){const ft=c?dt:$[dt];at[ft]=replaceEqualDeep(e[ft],i[ft]),at[ft]===e[ft]&&h++}return b===it&&h===b?e:at}return i}function shallowEqualObjects(e,i){if(e&&!i||i&&!e)return!1;for(const c in e)if(e[c]!==i[c])return!1;return!0}function isPlainArray(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function isPlainObject(e){if(!hasObjectPrototype(e))return!1;const i=e.constructor;if(typeof i>"u")return!0;const c=i.prototype;return!(!hasObjectPrototype(c)||!c.hasOwnProperty("isPrototypeOf"))}function hasObjectPrototype(e){return Object.prototype.toString.call(e)==="[object Object]"}function isQueryKey(e){return Array.isArray(e)}function sleep(e){return new Promise(i=>{setTimeout(i,e)})}function scheduleMicrotask(e){sleep(0).then(e)}function getAbortController(){if(typeof AbortController=="function")return new AbortController}function replaceData(e,i,c){return c.isDataEqual!=null&&c.isDataEqual(e,i)?e:typeof c.structuralSharing=="function"?c.structuralSharing(e,i):c.structuralSharing!==!1?replaceEqualDeep(e,i):i}class FocusManager extends Subscribable{constructor(){super(),this.setup=i=>{if(!isServer&&window.addEventListener){const c=()=>i();return window.addEventListener("visibilitychange",c,!1),window.addEventListener("focus",c,!1),()=>{window.removeEventListener("visibilitychange",c),window.removeEventListener("focus",c)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var i;(i=this.cleanup)==null||i.call(this),this.cleanup=void 0}}setEventListener(i){var c;this.setup=i,(c=this.cleanup)==null||c.call(this),this.cleanup=i(b=>{typeof b=="boolean"?this.setFocused(b):this.onFocus()})}setFocused(i){this.focused!==i&&(this.focused=i,this.onFocus())}onFocus(){this.listeners.forEach(({listener:i})=>{i()})}isFocused(){return typeof this.focused=="boolean"?this.focused:typeof document>"u"?!0:[void 0,"visible","prerender"].includes(document.visibilityState)}}const focusManager=new FocusManager,onlineEvents=["online","offline"];class OnlineManager extends Subscribable{constructor(){super(),this.setup=i=>{if(!isServer&&window.addEventListener){const c=()=>i();return onlineEvents.forEach(b=>{window.addEventListener(b,c,!1)}),()=>{onlineEvents.forEach(b=>{window.removeEventListener(b,c)})}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var i;(i=this.cleanup)==null||i.call(this),this.cleanup=void 0}}setEventListener(i){var c;this.setup=i,(c=this.cleanup)==null||c.call(this),this.cleanup=i(b=>{typeof b=="boolean"?this.setOnline(b):this.onOnline()})}setOnline(i){this.online!==i&&(this.online=i,this.onOnline())}onOnline(){this.listeners.forEach(({listener:i})=>{i()})}isOnline(){return typeof this.online=="boolean"?this.online:typeof navigator>"u"||typeof navigator.onLine>"u"?!0:navigator.onLine}}const onlineManager=new OnlineManager;function defaultRetryDelay(e){return Math.min(1e3*2**e,3e4)}function canFetch(e){return(e??"online")==="online"?onlineManager.isOnline():!0}class CancelledError{constructor(i){this.revert=i==null?void 0:i.revert,this.silent=i==null?void 0:i.silent}}function isCancelledError(e){return e instanceof CancelledError}function createRetryer(e){let i=!1,c=0,b=!1,$,it,at;const h=new Promise((Bt,Tt)=>{it=Bt,at=Tt}),dt=Bt=>{b||(kt(new CancelledError(Bt)),e.abort==null||e.abort())},ft=()=>{i=!0},xt=()=>{i=!1},Ct=()=>!focusManager.isFocused()||e.networkMode!=="always"&&!onlineManager.isOnline(),bt=Bt=>{b||(b=!0,e.onSuccess==null||e.onSuccess(Bt),$==null||$(),it(Bt))},kt=Bt=>{b||(b=!0,e.onError==null||e.onError(Bt),$==null||$(),at(Bt))},Dt=()=>new Promise(Bt=>{$=Tt=>{const It=b||!Ct();return It&&Bt(Tt),It},e.onPause==null||e.onPause()}).then(()=>{$=void 0,b||e.onContinue==null||e.onContinue()}),At=()=>{if(b)return;let Bt;try{Bt=e.fn()}catch(Tt){Bt=Promise.reject(Tt)}Promise.resolve(Bt).then(bt).catch(Tt=>{var It,St;if(b)return;const jt=(It=e.retry)!=null?It:3,Ht=(St=e.retryDelay)!=null?St:defaultRetryDelay,Kt=typeof Ht=="function"?Ht(c,Tt):Ht,ir=jt===!0||typeof jt=="number"&&c<jt||typeof jt=="function"&&jt(c,Tt);if(i||!ir){kt(Tt);return}c++,e.onFail==null||e.onFail(c,Tt),sleep(Kt).then(()=>{if(Ct())return Dt()}).then(()=>{i?kt(Tt):At()})})};return canFetch(e.networkMode)?At():Dt().then(At),{promise:h,cancel:dt,continue:()=>($==null?void 0:$())?h:Promise.resolve(),cancelRetry:ft,continueRetry:xt}}const defaultLogger=console;function createNotifyManager(){let e=[],i=0,c=xt=>{xt()},b=xt=>{xt()};const $=xt=>{let Ct;i++;try{Ct=xt()}finally{i--,i||h()}return Ct},it=xt=>{i?e.push(xt):scheduleMicrotask(()=>{c(xt)})},at=xt=>(...Ct)=>{it(()=>{xt(...Ct)})},h=()=>{const xt=e;e=[],xt.length&&scheduleMicrotask(()=>{b(()=>{xt.forEach(Ct=>{c(Ct)})})})};return{batch:$,batchCalls:at,schedule:it,setNotifyFunction:xt=>{c=xt},setBatchNotifyFunction:xt=>{b=xt}}}const notifyManager=createNotifyManager();class Removable{destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),isValidTimeout(this.cacheTime)&&(this.gcTimeout=setTimeout(()=>{this.optionalRemove()},this.cacheTime))}updateCacheTime(i){this.cacheTime=Math.max(this.cacheTime||0,i??(isServer?1/0:5*60*1e3))}clearGcTimeout(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)}}class Query extends Removable{constructor(i){super(),this.abortSignalConsumed=!1,this.defaultOptions=i.defaultOptions,this.setOptions(i.options),this.observers=[],this.cache=i.cache,this.logger=i.logger||defaultLogger,this.queryKey=i.queryKey,this.queryHash=i.queryHash,this.initialState=i.state||getDefaultState$1(this.options),this.state=this.initialState,this.scheduleGc()}get meta(){return this.options.meta}setOptions(i){this.options={...this.defaultOptions,...i},this.updateCacheTime(this.options.cacheTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.cache.remove(this)}setData(i,c){const b=replaceData(this.state.data,i,this.options);return this.dispatch({data:b,type:"success",dataUpdatedAt:c==null?void 0:c.updatedAt,manual:c==null?void 0:c.manual}),b}setState(i,c){this.dispatch({type:"setState",state:i,setStateOptions:c})}cancel(i){var c;const b=this.promise;return(c=this.retryer)==null||c.cancel(i),b?b.then(noop$3).catch(noop$3):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.initialState)}isActive(){return this.observers.some(i=>i.options.enabled!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(i=>i.getCurrentResult().isStale)}isStaleByTime(i=0){return this.state.isInvalidated||!this.state.dataUpdatedAt||!timeUntilStale(this.state.dataUpdatedAt,i)}onFocus(){var i;const c=this.observers.find(b=>b.shouldFetchOnWindowFocus());c&&c.refetch({cancelRefetch:!1}),(i=this.retryer)==null||i.continue()}onOnline(){var i;const c=this.observers.find(b=>b.shouldFetchOnReconnect());c&&c.refetch({cancelRefetch:!1}),(i=this.retryer)==null||i.continue()}addObserver(i){this.observers.includes(i)||(this.observers.push(i),this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:i}))}removeObserver(i){this.observers.includes(i)&&(this.observers=this.observers.filter(c=>c!==i),this.observers.length||(this.retryer&&(this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.scheduleGc()),this.cache.notify({type:"observerRemoved",query:this,observer:i}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.dispatch({type:"invalidate"})}fetch(i,c){var b,$;if(this.state.fetchStatus!=="idle"){if(this.state.dataUpdatedAt&&c!=null&&c.cancelRefetch)this.cancel({silent:!0});else if(this.promise){var it;return(it=this.retryer)==null||it.continueRetry(),this.promise}}if(i&&this.setOptions(i),!this.options.queryFn){const kt=this.observers.find(Dt=>Dt.options.queryFn);kt&&this.setOptions(kt.options)}const at=getAbortController(),h={queryKey:this.queryKey,pageParam:void 0,meta:this.meta},dt=kt=>{Object.defineProperty(kt,"signal",{enumerable:!0,get:()=>{if(at)return this.abortSignalConsumed=!0,at.signal}})};dt(h);const ft=()=>this.options.queryFn?(this.abortSignalConsumed=!1,this.options.queryFn(h)):Promise.reject("Missing queryFn for queryKey '"+this.options.queryHash+"'"),xt={fetchOptions:c,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:ft};if(dt(xt),(b=this.options.behavior)==null||b.onFetch(xt),this.revertState=this.state,this.state.fetchStatus==="idle"||this.state.fetchMeta!==(($=xt.fetchOptions)==null?void 0:$.meta)){var Ct;this.dispatch({type:"fetch",meta:(Ct=xt.fetchOptions)==null?void 0:Ct.meta})}const bt=kt=>{if(isCancelledError(kt)&&kt.silent||this.dispatch({type:"error",error:kt}),!isCancelledError(kt)){var Dt,At,Bt,Tt;(Dt=(At=this.cache.config).onError)==null||Dt.call(At,kt,this),(Bt=(Tt=this.cache.config).onSettled)==null||Bt.call(Tt,this.state.data,kt,this)}this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return this.retryer=createRetryer({fn:xt.fetchFn,abort:at==null?void 0:at.abort.bind(at),onSuccess:kt=>{var Dt,At,Bt,Tt;if(typeof kt>"u"){bt(new Error(this.queryHash+" data is undefined"));return}this.setData(kt),(Dt=(At=this.cache.config).onSuccess)==null||Dt.call(At,kt,this),(Bt=(Tt=this.cache.config).onSettled)==null||Bt.call(Tt,kt,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:bt,onFail:(kt,Dt)=>{this.dispatch({type:"failed",failureCount:kt,error:Dt})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:xt.options.retry,retryDelay:xt.options.retryDelay,networkMode:xt.options.networkMode}),this.promise=this.retryer.promise,this.promise}dispatch(i){const c=b=>{var $,it;switch(i.type){case"failed":return{...b,fetchFailureCount:i.failureCount,fetchFailureReason:i.error};case"pause":return{...b,fetchStatus:"paused"};case"continue":return{...b,fetchStatus:"fetching"};case"fetch":return{...b,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:($=i.meta)!=null?$:null,fetchStatus:canFetch(this.options.networkMode)?"fetching":"paused",...!b.dataUpdatedAt&&{error:null,status:"loading"}};case"success":return{...b,data:i.data,dataUpdateCount:b.dataUpdateCount+1,dataUpdatedAt:(it=i.dataUpdatedAt)!=null?it:Date.now(),error:null,isInvalidated:!1,status:"success",...!i.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const at=i.error;return isCancelledError(at)&&at.revert&&this.revertState?{...this.revertState,fetchStatus:"idle"}:{...b,error:at,errorUpdateCount:b.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:b.fetchFailureCount+1,fetchFailureReason:at,fetchStatus:"idle",status:"error"};case"invalidate":return{...b,isInvalidated:!0};case"setState":return{...b,...i.state}}};this.state=c(this.state),notifyManager.batch(()=>{this.observers.forEach(b=>{b.onQueryUpdate(i)}),this.cache.notify({query:this,type:"updated",action:i})})}}function getDefaultState$1(e){const i=typeof e.initialData=="function"?e.initialData():e.initialData,c=typeof i<"u",b=c?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:i,dataUpdateCount:0,dataUpdatedAt:c?b??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:c?"success":"loading",fetchStatus:"idle"}}class QueryCache extends Subscribable{constructor(i){super(),this.config=i||{},this.queries=[],this.queriesMap={}}build(i,c,b){var $;const it=c.queryKey,at=($=c.queryHash)!=null?$:hashQueryKeyByOptions(it,c);let h=this.get(at);return h||(h=new Query({cache:this,logger:i.getLogger(),queryKey:it,queryHash:at,options:i.defaultQueryOptions(c),state:b,defaultOptions:i.getQueryDefaults(it)}),this.add(h)),h}add(i){this.queriesMap[i.queryHash]||(this.queriesMap[i.queryHash]=i,this.queries.push(i),this.notify({type:"added",query:i}))}remove(i){const c=this.queriesMap[i.queryHash];c&&(i.destroy(),this.queries=this.queries.filter(b=>b!==i),c===i&&delete this.queriesMap[i.queryHash],this.notify({type:"removed",query:i}))}clear(){notifyManager.batch(()=>{this.queries.forEach(i=>{this.remove(i)})})}get(i){return this.queriesMap[i]}getAll(){return this.queries}find(i,c){const[b]=parseFilterArgs(i,c);return typeof b.exact>"u"&&(b.exact=!0),this.queries.find($=>matchQuery(b,$))}findAll(i,c){const[b]=parseFilterArgs(i,c);return Object.keys(b).length>0?this.queries.filter($=>matchQuery(b,$)):this.queries}notify(i){notifyManager.batch(()=>{this.listeners.forEach(({listener:c})=>{c(i)})})}onFocus(){notifyManager.batch(()=>{this.queries.forEach(i=>{i.onFocus()})})}onOnline(){notifyManager.batch(()=>{this.queries.forEach(i=>{i.onOnline()})})}}class Mutation extends Removable{constructor(i){super(),this.defaultOptions=i.defaultOptions,this.mutationId=i.mutationId,this.mutationCache=i.mutationCache,this.logger=i.logger||defaultLogger,this.observers=[],this.state=i.state||getDefaultState(),this.setOptions(i.options),this.scheduleGc()}setOptions(i){this.options={...this.defaultOptions,...i},this.updateCacheTime(this.options.cacheTime)}get meta(){return this.options.meta}setState(i){this.dispatch({type:"setState",state:i})}addObserver(i){this.observers.includes(i)||(this.observers.push(i),this.clearGcTimeout(),this.mutationCache.notify({type:"observerAdded",mutation:this,observer:i}))}removeObserver(i){this.observers=this.observers.filter(c=>c!==i),this.scheduleGc(),this.mutationCache.notify({type:"observerRemoved",mutation:this,observer:i})}optionalRemove(){this.observers.length||(this.state.status==="loading"?this.scheduleGc():this.mutationCache.remove(this))}continue(){var i,c;return(i=(c=this.retryer)==null?void 0:c.continue())!=null?i:this.execute()}async execute(){const i=()=>{var ir;return this.retryer=createRetryer({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:(nr,kr)=>{this.dispatch({type:"failed",failureCount:nr,error:kr})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:(ir=this.options.retry)!=null?ir:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode}),this.retryer.promise},c=this.state.status==="loading";try{var b,$,it,at,h,dt,ft,xt;if(!c){var Ct,bt,kt,Dt;this.dispatch({type:"loading",variables:this.options.variables}),await((Ct=(bt=this.mutationCache.config).onMutate)==null?void 0:Ct.call(bt,this.state.variables,this));const nr=await((kt=(Dt=this.options).onMutate)==null?void 0:kt.call(Dt,this.state.variables));nr!==this.state.context&&this.dispatch({type:"loading",context:nr,variables:this.state.variables})}const ir=await i();return await((b=($=this.mutationCache.config).onSuccess)==null?void 0:b.call($,ir,this.state.variables,this.state.context,this)),await((it=(at=this.options).onSuccess)==null?void 0:it.call(at,ir,this.state.variables,this.state.context)),await((h=(dt=this.mutationCache.config).onSettled)==null?void 0:h.call(dt,ir,null,this.state.variables,this.state.context,this)),await((ft=(xt=this.options).onSettled)==null?void 0:ft.call(xt,ir,null,this.state.variables,this.state.context)),this.dispatch({type:"success",data:ir}),ir}catch(ir){try{var At,Bt,Tt,It,St,jt,Ht,Kt;throw await((At=(Bt=this.mutationCache.config).onError)==null?void 0:At.call(Bt,ir,this.state.variables,this.state.context,this)),await((Tt=(It=this.options).onError)==null?void 0:Tt.call(It,ir,this.state.variables,this.state.context)),await((St=(jt=this.mutationCache.config).onSettled)==null?void 0:St.call(jt,void 0,ir,this.state.variables,this.state.context,this)),await((Ht=(Kt=this.options).onSettled)==null?void 0:Ht.call(Kt,void 0,ir,this.state.variables,this.state.context)),ir}finally{this.dispatch({type:"error",error:ir})}}}dispatch(i){const c=b=>{switch(i.type){case"failed":return{...b,failureCount:i.failureCount,failureReason:i.error};case"pause":return{...b,isPaused:!0};case"continue":return{...b,isPaused:!1};case"loading":return{...b,context:i.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!canFetch(this.options.networkMode),status:"loading",variables:i.variables};case"success":return{...b,data:i.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...b,data:void 0,error:i.error,failureCount:b.failureCount+1,failureReason:i.error,isPaused:!1,status:"error"};case"setState":return{...b,...i.state}}};this.state=c(this.state),notifyManager.batch(()=>{this.observers.forEach(b=>{b.onMutationUpdate(i)}),this.mutationCache.notify({mutation:this,type:"updated",action:i})})}}function getDefaultState(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class MutationCache extends Subscribable{constructor(i){super(),this.config=i||{},this.mutations=[],this.mutationId=0}build(i,c,b){const $=new Mutation({mutationCache:this,logger:i.getLogger(),mutationId:++this.mutationId,options:i.defaultMutationOptions(c),state:b,defaultOptions:c.mutationKey?i.getMutationDefaults(c.mutationKey):void 0});return this.add($),$}add(i){this.mutations.push(i),this.notify({type:"added",mutation:i})}remove(i){this.mutations=this.mutations.filter(c=>c!==i),this.notify({type:"removed",mutation:i})}clear(){notifyManager.batch(()=>{this.mutations.forEach(i=>{this.remove(i)})})}getAll(){return this.mutations}find(i){return typeof i.exact>"u"&&(i.exact=!0),this.mutations.find(c=>matchMutation(i,c))}findAll(i){return this.mutations.filter(c=>matchMutation(i,c))}notify(i){notifyManager.batch(()=>{this.listeners.forEach(({listener:c})=>{c(i)})})}resumePausedMutations(){var i;return this.resuming=((i=this.resuming)!=null?i:Promise.resolve()).then(()=>{const c=this.mutations.filter(b=>b.state.isPaused);return notifyManager.batch(()=>c.reduce((b,$)=>b.then(()=>$.continue().catch(noop$3)),Promise.resolve()))}).then(()=>{this.resuming=void 0}),this.resuming}}function infiniteQueryBehavior(){return{onFetch:e=>{e.fetchFn=()=>{var i,c,b,$,it,at;const h=(i=e.fetchOptions)==null||(c=i.meta)==null?void 0:c.refetchPage,dt=(b=e.fetchOptions)==null||($=b.meta)==null?void 0:$.fetchMore,ft=dt==null?void 0:dt.pageParam,xt=(dt==null?void 0:dt.direction)==="forward",Ct=(dt==null?void 0:dt.direction)==="backward",bt=((it=e.state.data)==null?void 0:it.pages)||[],kt=((at=e.state.data)==null?void 0:at.pageParams)||[];let Dt=kt,At=!1;const Bt=Kt=>{Object.defineProperty(Kt,"signal",{enumerable:!0,get:()=>{var ir;if((ir=e.signal)!=null&&ir.aborted)At=!0;else{var nr;(nr=e.signal)==null||nr.addEventListener("abort",()=>{At=!0})}return e.signal}})},Tt=e.options.queryFn||(()=>Promise.reject("Missing queryFn for queryKey '"+e.options.queryHash+"'")),It=(Kt,ir,nr,kr)=>(Dt=kr?[ir,...Dt]:[...Dt,ir],kr?[nr,...Kt]:[...Kt,nr]),St=(Kt,ir,nr,kr)=>{if(At)return Promise.reject("Cancelled");if(typeof nr>"u"&&!ir&&Kt.length)return Promise.resolve(Kt);const br={queryKey:e.queryKey,pageParam:nr,meta:e.options.meta};Bt(br);const Sr=Tt(br);return Promise.resolve(Sr).then(rn=>It(Kt,nr,rn,kr))};let jt;if(!bt.length)jt=St([]);else if(xt){const Kt=typeof ft<"u",ir=Kt?ft:getNextPageParam(e.options,bt);jt=St(bt,Kt,ir)}else if(Ct){const Kt=typeof ft<"u",ir=Kt?ft:getPreviousPageParam(e.options,bt);jt=St(bt,Kt,ir,!0)}else{Dt=[];const Kt=typeof e.options.getNextPageParam>"u";jt=(h&&bt[0]?h(bt[0],0,bt):!0)?St([],Kt,kt[0]):Promise.resolve(It([],kt[0],bt[0]));for(let nr=1;nr<bt.length;nr++)jt=jt.then(kr=>{if(h&&bt[nr]?h(bt[nr],nr,bt):!0){const Sr=Kt?kt[nr]:getNextPageParam(e.options,kr);return St(kr,Kt,Sr)}return Promise.resolve(It(kr,kt[nr],bt[nr]))})}return jt.then(Kt=>({pages:Kt,pageParams:Dt}))}}}}function getNextPageParam(e,i){return e.getNextPageParam==null?void 0:e.getNextPageParam(i[i.length-1],i)}function getPreviousPageParam(e,i){return e.getPreviousPageParam==null?void 0:e.getPreviousPageParam(i[0],i)}class QueryClient{constructor(i={}){this.queryCache=i.queryCache||new QueryCache,this.mutationCache=i.mutationCache||new MutationCache,this.logger=i.logger||defaultLogger,this.defaultOptions=i.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[],this.mountCount=0}mount(){this.mountCount++,this.mountCount===1&&(this.unsubscribeFocus=focusManager.subscribe(()=>{focusManager.isFocused()&&(this.resumePausedMutations(),this.queryCache.onFocus())}),this.unsubscribeOnline=onlineManager.subscribe(()=>{onlineManager.isOnline()&&(this.resumePausedMutations(),this.queryCache.onOnline())}))}unmount(){var i,c;this.mountCount--,this.mountCount===0&&((i=this.unsubscribeFocus)==null||i.call(this),this.unsubscribeFocus=void 0,(c=this.unsubscribeOnline)==null||c.call(this),this.unsubscribeOnline=void 0)}isFetching(i,c){const[b]=parseFilterArgs(i,c);return b.fetchStatus="fetching",this.queryCache.findAll(b).length}isMutating(i){return this.mutationCache.findAll({...i,fetching:!0}).length}getQueryData(i,c){var b;return(b=this.queryCache.find(i,c))==null?void 0:b.state.data}ensureQueryData(i,c,b){const $=parseQueryArgs(i,c,b),it=this.getQueryData($.queryKey);return it?Promise.resolve(it):this.fetchQuery($)}getQueriesData(i){return this.getQueryCache().findAll(i).map(({queryKey:c,state:b})=>{const $=b.data;return[c,$]})}setQueryData(i,c,b){const $=this.queryCache.find(i),it=$==null?void 0:$.state.data,at=functionalUpdate(c,it);if(typeof at>"u")return;const h=parseQueryArgs(i),dt=this.defaultQueryOptions(h);return this.queryCache.build(this,dt).setData(at,{...b,manual:!0})}setQueriesData(i,c,b){return notifyManager.batch(()=>this.getQueryCache().findAll(i).map(({queryKey:$})=>[$,this.setQueryData($,c,b)]))}getQueryState(i,c){var b;return(b=this.queryCache.find(i,c))==null?void 0:b.state}removeQueries(i,c){const[b]=parseFilterArgs(i,c),$=this.queryCache;notifyManager.batch(()=>{$.findAll(b).forEach(it=>{$.remove(it)})})}resetQueries(i,c,b){const[$,it]=parseFilterArgs(i,c,b),at=this.queryCache,h={type:"active",...$};return notifyManager.batch(()=>(at.findAll($).forEach(dt=>{dt.reset()}),this.refetchQueries(h,it)))}cancelQueries(i,c,b){const[$,it={}]=parseFilterArgs(i,c,b);typeof it.revert>"u"&&(it.revert=!0);const at=notifyManager.batch(()=>this.queryCache.findAll($).map(h=>h.cancel(it)));return Promise.all(at).then(noop$3).catch(noop$3)}invalidateQueries(i,c,b){const[$,it]=parseFilterArgs(i,c,b);return notifyManager.batch(()=>{var at,h;if(this.queryCache.findAll($).forEach(ft=>{ft.invalidate()}),$.refetchType==="none")return Promise.resolve();const dt={...$,type:(at=(h=$.refetchType)!=null?h:$.type)!=null?at:"active"};return this.refetchQueries(dt,it)})}refetchQueries(i,c,b){const[$,it]=parseFilterArgs(i,c,b),at=notifyManager.batch(()=>this.queryCache.findAll($).filter(dt=>!dt.isDisabled()).map(dt=>{var ft;return dt.fetch(void 0,{...it,cancelRefetch:(ft=it==null?void 0:it.cancelRefetch)!=null?ft:!0,meta:{refetchPage:$.refetchPage}})}));let h=Promise.all(at).then(noop$3);return it!=null&&it.throwOnError||(h=h.catch(noop$3)),h}fetchQuery(i,c,b){const $=parseQueryArgs(i,c,b),it=this.defaultQueryOptions($);typeof it.retry>"u"&&(it.retry=!1);const at=this.queryCache.build(this,it);return at.isStaleByTime(it.staleTime)?at.fetch(it):Promise.resolve(at.state.data)}prefetchQuery(i,c,b){return this.fetchQuery(i,c,b).then(noop$3).catch(noop$3)}fetchInfiniteQuery(i,c,b){const $=parseQueryArgs(i,c,b);return $.behavior=infiniteQueryBehavior(),this.fetchQuery($)}prefetchInfiniteQuery(i,c,b){return this.fetchInfiniteQuery(i,c,b).then(noop$3).catch(noop$3)}resumePausedMutations(){return this.mutationCache.resumePausedMutations()}getQueryCache(){return this.queryCache}getMutationCache(){return this.mutationCache}getLogger(){return this.logger}getDefaultOptions(){return this.defaultOptions}setDefaultOptions(i){this.defaultOptions=i}setQueryDefaults(i,c){const b=this.queryDefaults.find($=>hashQueryKey(i)===hashQueryKey($.queryKey));b?b.defaultOptions=c:this.queryDefaults.push({queryKey:i,defaultOptions:c})}getQueryDefaults(i){if(!i)return;const c=this.queryDefaults.find(b=>partialMatchKey(i,b.queryKey));return c==null?void 0:c.defaultOptions}setMutationDefaults(i,c){const b=this.mutationDefaults.find($=>hashQueryKey(i)===hashQueryKey($.mutationKey));b?b.defaultOptions=c:this.mutationDefaults.push({mutationKey:i,defaultOptions:c})}getMutationDefaults(i){if(!i)return;const c=this.mutationDefaults.find(b=>partialMatchKey(i,b.mutationKey));return c==null?void 0:c.defaultOptions}defaultQueryOptions(i){if(i!=null&&i._defaulted)return i;const c={...this.defaultOptions.queries,...this.getQueryDefaults(i==null?void 0:i.queryKey),...i,_defaulted:!0};return!c.queryHash&&c.queryKey&&(c.queryHash=hashQueryKeyByOptions(c.queryKey,c)),typeof c.refetchOnReconnect>"u"&&(c.refetchOnReconnect=c.networkMode!=="always"),typeof c.useErrorBoundary>"u"&&(c.useErrorBoundary=!!c.suspense),c}defaultMutationOptions(i){return i!=null&&i._defaulted?i:{...this.defaultOptions.mutations,...this.getMutationDefaults(i==null?void 0:i.mutationKey),...i,_defaulted:!0}}clear(){this.queryCache.clear(),this.mutationCache.clear()}}class QueryObserver extends Subscribable{constructor(i,c){super(),this.client=i,this.options=c,this.trackedProps=new Set,this.selectError=null,this.bindMethods(),this.setOptions(c)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.currentQuery.addObserver(this),shouldFetchOnMount(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return shouldFetchOn(this.currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return shouldFetchOn(this.currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.clearStaleTimeout(),this.clearRefetchInterval(),this.currentQuery.removeObserver(this)}setOptions(i,c){const b=this.options,$=this.currentQuery;if(this.options=this.client.defaultQueryOptions(i),shallowEqualObjects(b,this.options)||this.client.getQueryCache().notify({type:"observerOptionsUpdated",query:this.currentQuery,observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=b.queryKey),this.updateQuery();const it=this.hasListeners();it&&shouldFetchOptionally(this.currentQuery,$,this.options,b)&&this.executeFetch(),this.updateResult(c),it&&(this.currentQuery!==$||this.options.enabled!==b.enabled||this.options.staleTime!==b.staleTime)&&this.updateStaleTimeout();const at=this.computeRefetchInterval();it&&(this.currentQuery!==$||this.options.enabled!==b.enabled||at!==this.currentRefetchInterval)&&this.updateRefetchInterval(at)}getOptimisticResult(i){const c=this.client.getQueryCache().build(this.client,i),b=this.createResult(c,i);return shouldAssignObserverCurrentProperties(this,b,i)&&(this.currentResult=b,this.currentResultOptions=this.options,this.currentResultState=this.currentQuery.state),b}getCurrentResult(){return this.currentResult}trackResult(i){const c={};return Object.keys(i).forEach(b=>{Object.defineProperty(c,b,{configurable:!1,enumerable:!0,get:()=>(this.trackedProps.add(b),i[b])})}),c}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch({refetchPage:i,...c}={}){return this.fetch({...c,meta:{refetchPage:i}})}fetchOptimistic(i){const c=this.client.defaultQueryOptions(i),b=this.client.getQueryCache().build(this.client,c);return b.isFetchingOptimistic=!0,b.fetch().then(()=>this.createResult(b,c))}fetch(i){var c;return this.executeFetch({...i,cancelRefetch:(c=i.cancelRefetch)!=null?c:!0}).then(()=>(this.updateResult(),this.currentResult))}executeFetch(i){this.updateQuery();let c=this.currentQuery.fetch(this.options,i);return i!=null&&i.throwOnError||(c=c.catch(noop$3)),c}updateStaleTimeout(){if(this.clearStaleTimeout(),isServer||this.currentResult.isStale||!isValidTimeout(this.options.staleTime))return;const c=timeUntilStale(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},c)}computeRefetchInterval(){var i;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(i=this.options.refetchInterval)!=null?i:!1}updateRefetchInterval(i){this.clearRefetchInterval(),this.currentRefetchInterval=i,!(isServer||this.options.enabled===!1||!isValidTimeout(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||focusManager.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearStaleTimeout(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)}clearRefetchInterval(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)}createResult(i,c){const b=this.currentQuery,$=this.options,it=this.currentResult,at=this.currentResultState,h=this.currentResultOptions,dt=i!==b,ft=dt?i.state:this.currentQueryInitialState,xt=dt?this.currentResult:this.previousQueryResult,{state:Ct}=i;let{dataUpdatedAt:bt,error:kt,errorUpdatedAt:Dt,fetchStatus:At,status:Bt}=Ct,Tt=!1,It=!1,St;if(c._optimisticResults){const nr=this.hasListeners(),kr=!nr&&shouldFetchOnMount(i,c),br=nr&&shouldFetchOptionally(i,b,c,$);(kr||br)&&(At=canFetch(i.options.networkMode)?"fetching":"paused",bt||(Bt="loading")),c._optimisticResults==="isRestoring"&&(At="idle")}if(c.keepPreviousData&&!Ct.dataUpdatedAt&&xt!=null&&xt.isSuccess&&Bt!=="error")St=xt.data,bt=xt.dataUpdatedAt,Bt=xt.status,Tt=!0;else if(c.select&&typeof Ct.data<"u")if(it&&Ct.data===(at==null?void 0:at.data)&&c.select===this.selectFn)St=this.selectResult;else try{this.selectFn=c.select,St=c.select(Ct.data),St=replaceData(it==null?void 0:it.data,St,c),this.selectResult=St,this.selectError=null}catch(nr){this.selectError=nr}else St=Ct.data;if(typeof c.placeholderData<"u"&&typeof St>"u"&&Bt==="loading"){let nr;if(it!=null&&it.isPlaceholderData&&c.placeholderData===(h==null?void 0:h.placeholderData))nr=it.data;else if(nr=typeof c.placeholderData=="function"?c.placeholderData():c.placeholderData,c.select&&typeof nr<"u")try{nr=c.select(nr),this.selectError=null}catch(kr){this.selectError=kr}typeof nr<"u"&&(Bt="success",St=replaceData(it==null?void 0:it.data,nr,c),It=!0)}this.selectError&&(kt=this.selectError,St=this.selectResult,Dt=Date.now(),Bt="error");const jt=At==="fetching",Ht=Bt==="loading",Kt=Bt==="error";return{status:Bt,fetchStatus:At,isLoading:Ht,isSuccess:Bt==="success",isError:Kt,isInitialLoading:Ht&&jt,data:St,dataUpdatedAt:bt,error:kt,errorUpdatedAt:Dt,failureCount:Ct.fetchFailureCount,failureReason:Ct.fetchFailureReason,errorUpdateCount:Ct.errorUpdateCount,isFetched:Ct.dataUpdateCount>0||Ct.errorUpdateCount>0,isFetchedAfterMount:Ct.dataUpdateCount>ft.dataUpdateCount||Ct.errorUpdateCount>ft.errorUpdateCount,isFetching:jt,isRefetching:jt&&!Ht,isLoadingError:Kt&&Ct.dataUpdatedAt===0,isPaused:At==="paused",isPlaceholderData:It,isPreviousData:Tt,isRefetchError:Kt&&Ct.dataUpdatedAt!==0,isStale:isStale(i,c),refetch:this.refetch,remove:this.remove}}updateResult(i){const c=this.currentResult,b=this.createResult(this.currentQuery,this.options);if(this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,shallowEqualObjects(b,c))return;this.currentResult=b;const $={cache:!0},it=()=>{if(!c)return!0;const{notifyOnChangeProps:at}=this.options,h=typeof at=="function"?at():at;if(h==="all"||!h&&!this.trackedProps.size)return!0;const dt=new Set(h??this.trackedProps);return this.options.useErrorBoundary&&dt.add("error"),Object.keys(this.currentResult).some(ft=>{const xt=ft;return this.currentResult[xt]!==c[xt]&&dt.has(xt)})};(i==null?void 0:i.listeners)!==!1&&it()&&($.listeners=!0),this.notify({...$,...i})}updateQuery(){const i=this.client.getQueryCache().build(this.client,this.options);if(i===this.currentQuery)return;const c=this.currentQuery;this.currentQuery=i,this.currentQueryInitialState=i.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(c==null||c.removeObserver(this),i.addObserver(this))}onQueryUpdate(i){const c={};i.type==="success"?c.onSuccess=!i.manual:i.type==="error"&&!isCancelledError(i.error)&&(c.onError=!0),this.updateResult(c),this.hasListeners()&&this.updateTimers()}notify(i){notifyManager.batch(()=>{if(i.onSuccess){var c,b,$,it;(c=(b=this.options).onSuccess)==null||c.call(b,this.currentResult.data),($=(it=this.options).onSettled)==null||$.call(it,this.currentResult.data,null)}else if(i.onError){var at,h,dt,ft;(at=(h=this.options).onError)==null||at.call(h,this.currentResult.error),(dt=(ft=this.options).onSettled)==null||dt.call(ft,void 0,this.currentResult.error)}i.listeners&&this.listeners.forEach(({listener:xt})=>{xt(this.currentResult)}),i.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function shouldLoadOnMount(e,i){return i.enabled!==!1&&!e.state.dataUpdatedAt&&!(e.state.status==="error"&&i.retryOnMount===!1)}function shouldFetchOnMount(e,i){return shouldLoadOnMount(e,i)||e.state.dataUpdatedAt>0&&shouldFetchOn(e,i,i.refetchOnMount)}function shouldFetchOn(e,i,c){if(i.enabled!==!1){const b=typeof c=="function"?c(e):c;return b==="always"||b!==!1&&isStale(e,i)}return!1}function shouldFetchOptionally(e,i,c,b){return c.enabled!==!1&&(e!==i||b.enabled===!1)&&(!c.suspense||e.state.status!=="error")&&isStale(e,c)}function isStale(e,i){return e.isStaleByTime(i.staleTime)}function shouldAssignObserverCurrentProperties(e,i,c){return c.keepPreviousData?!1:c.placeholderData!==void 0?i.isPlaceholderData:!shallowEqualObjects(e.getCurrentResult(),i)}let MutationObserver$1=class extends Subscribable{constructor(i,c){super(),this.client=i,this.setOptions(c),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(i){var c;const b=this.options;this.options=this.client.defaultMutationOptions(i),shallowEqualObjects(b,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(c=this.currentMutation)==null||c.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var i;(i=this.currentMutation)==null||i.removeObserver(this)}}onMutationUpdate(i){this.updateResult();const c={listeners:!0};i.type==="success"?c.onSuccess=!0:i.type==="error"&&(c.onError=!0),this.notify(c)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(i,c){return this.mutateOptions=c,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof i<"u"?i:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const i=this.currentMutation?this.currentMutation.state:getDefaultState(),c=i.status==="loading",b={...i,isLoading:c,isPending:c,isSuccess:i.status==="success",isError:i.status==="error",isIdle:i.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=b}notify(i){notifyManager.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(i.onSuccess){var c,b,$,it;(c=(b=this.mutateOptions).onSuccess)==null||c.call(b,this.currentResult.data,this.currentResult.variables,this.currentResult.context),($=(it=this.mutateOptions).onSettled)==null||$.call(it,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(i.onError){var at,h,dt,ft;(at=(h=this.mutateOptions).onError)==null||at.call(h,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(dt=(ft=this.mutateOptions).onSettled)==null||dt.call(ft,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}i.listeners&&this.listeners.forEach(({listener:xt})=>{xt(this.currentResult)})})}};var shim$1={exports:{}},useSyncExternalStoreShim_production={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var React=reactExports;function is(e,i){return e===i&&(e!==0||1/e===1/i)||e!==e&&i!==i}var objectIs=typeof Object.is=="function"?Object.is:is,useState=React.useState,useEffect=React.useEffect,useLayoutEffect=React.useLayoutEffect,useDebugValue=React.useDebugValue;function useSyncExternalStore$2(e,i){var c=i(),b=useState({inst:{value:c,getSnapshot:i}}),$=b[0].inst,it=b[1];return useLayoutEffect(function(){$.value=c,$.getSnapshot=i,checkIfSnapshotChanged($)&&it({inst:$})},[e,c,i]),useEffect(function(){return checkIfSnapshotChanged($)&&it({inst:$}),e(function(){checkIfSnapshotChanged($)&&it({inst:$})})},[e]),useDebugValue(c),c}function checkIfSnapshotChanged(e){var i=e.getSnapshot;e=e.value;try{var c=i();return!objectIs(e,c)}catch{return!0}}function useSyncExternalStore$1(e,i){return i()}var shim=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?useSyncExternalStore$1:useSyncExternalStore$2;useSyncExternalStoreShim_production.useSyncExternalStore=React.useSyncExternalStore!==void 0?React.useSyncExternalStore:shim;shim$1.exports=useSyncExternalStoreShim_production;var shimExports=shim$1.exports;const useSyncExternalStore=shimExports.useSyncExternalStore,defaultContext=reactExports.createContext(void 0),QueryClientSharingContext=reactExports.createContext(!1);function getQueryClientContext(e,i){return e||(i&&typeof window<"u"?(window.ReactQueryClientContext||(window.ReactQueryClientContext=defaultContext),window.ReactQueryClientContext):defaultContext)}const useQueryClient=({context:e}={})=>{const i=reactExports.useContext(getQueryClientContext(e,reactExports.useContext(QueryClientSharingContext)));if(!i)throw new Error("No QueryClient set, use QueryClientProvider to set one");return i},QueryClientProvider=({client:e,children:i,context:c,contextSharing:b=!1})=>{reactExports.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]);const $=getQueryClientContext(c,b);return reactExports.createElement(QueryClientSharingContext.Provider,{value:!c&&b},reactExports.createElement($.Provider,{value:e},i))},IsRestoringContext=reactExports.createContext(!1),useIsRestoring=()=>reactExports.useContext(IsRestoringContext);IsRestoringContext.Provider;function createValue(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}const QueryErrorResetBoundaryContext=reactExports.createContext(createValue()),useQueryErrorResetBoundary=()=>reactExports.useContext(QueryErrorResetBoundaryContext);function shouldThrowError(e,i){return typeof e=="function"?e(...i):!!e}const ensurePreventErrorBoundaryRetry=(e,i)=>{(e.suspense||e.useErrorBoundary)&&(i.isReset()||(e.retryOnMount=!1))},useClearResetErrorBoundary=e=>{reactExports.useEffect(()=>{e.clearReset()},[e])},getHasError=({result:e,errorResetBoundary:i,useErrorBoundary:c,query:b})=>e.isError&&!i.isReset()&&!e.isFetching&&shouldThrowError(c,[e.error,b]),ensureStaleTime=e=>{e.suspense&&(typeof e.staleTime!="number"&&(e.staleTime=1e3),typeof e.cacheTime=="number"&&(e.cacheTime=Math.max(e.cacheTime,1e3)))},willFetch=(e,i)=>e.isLoading&&e.isFetching&&!i,shouldSuspend=(e,i,c)=>(e==null?void 0:e.suspense)&&willFetch(i,c),fetchOptimistic=(e,i,c)=>i.fetchOptimistic(e).then(({data:b})=>{e.onSuccess==null||e.onSuccess(b),e.onSettled==null||e.onSettled(b,null)}).catch(b=>{c.clearReset(),e.onError==null||e.onError(b),e.onSettled==null||e.onSettled(void 0,b)});function useBaseQuery(e,i){const c=useQueryClient({context:e.context}),b=useIsRestoring(),$=useQueryErrorResetBoundary(),it=c.defaultQueryOptions(e);it._optimisticResults=b?"isRestoring":"optimistic",it.onError&&(it.onError=notifyManager.batchCalls(it.onError)),it.onSuccess&&(it.onSuccess=notifyManager.batchCalls(it.onSuccess)),it.onSettled&&(it.onSettled=notifyManager.batchCalls(it.onSettled)),ensureStaleTime(it),ensurePreventErrorBoundaryRetry(it,$),useClearResetErrorBoundary($);const[at]=reactExports.useState(()=>new i(c,it)),h=at.getOptimisticResult(it);if(useSyncExternalStore(reactExports.useCallback(dt=>{const ft=b?()=>{}:at.subscribe(notifyManager.batchCalls(dt));return at.updateResult(),ft},[at,b]),()=>at.getCurrentResult(),()=>at.getCurrentResult()),reactExports.useEffect(()=>{at.setOptions(it,{listeners:!1})},[it,at]),shouldSuspend(it,h,b))throw fetchOptimistic(it,at,$);if(getHasError({result:h,errorResetBoundary:$,useErrorBoundary:it.useErrorBoundary,query:at.getCurrentQuery()}))throw h.error;return it.notifyOnChangeProps?h:at.trackResult(h)}function useQuery(e,i,c){const b=parseQueryArgs(e,i,c);return useBaseQuery(b,QueryObserver)}function useMutation(e,i,c){const b=parseMutationArgs(e,i,c),$=useQueryClient({context:b.context}),[it]=reactExports.useState(()=>new MutationObserver$1($,b));reactExports.useEffect(()=>{it.setOptions(b)},[it,b]);const at=useSyncExternalStore(reactExports.useCallback(dt=>it.subscribe(notifyManager.batchCalls(dt)),[it]),()=>it.getCurrentResult(),()=>it.getCurrentResult()),h=reactExports.useCallback((dt,ft)=>{it.mutate(dt,ft).catch(noop$2)},[it]);if(at.error&&shouldThrowError(it.options.useErrorBoundary,[at.error]))throw at.error;return{...at,mutate:h,mutateAsync:at.mutate}}function noop$2(){}async function throwIfResNotOk(e){if(!e.ok){const i=await e.text()||e.statusText;throw new Error(`${e.status}: ${i}`)}}async function apiRequest(e,i,c){const b=await fetch(i,{method:e,headers:c?{"Content-Type":"application/json"}:{},body:c?JSON.stringify(c):void 0,credentials:"include"});return await throwIfResNotOk(b),b}const getQueryFn=({on401:e})=>async({queryKey:i})=>{const c=await fetch(i.join("/"),{credentials:"include"});return e==="returnNull"&&c.status===401?null:(await throwIfResNotOk(c),await c.json())},queryClient=new QueryClient({defaultOptions:{queries:{queryFn:getQueryFn({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:!1},mutations:{retry:!1}}}),TOAST_LIMIT=1,TOAST_REMOVE_DELAY=1e6;let count$2=0;function genId(){return count$2=(count$2+1)%Number.MAX_SAFE_INTEGER,count$2.toString()}const toastTimeouts=new Map,addToRemoveQueue=e=>{if(toastTimeouts.has(e))return;const i=setTimeout(()=>{toastTimeouts.delete(e),dispatch({type:"REMOVE_TOAST",toastId:e})},TOAST_REMOVE_DELAY);toastTimeouts.set(e,i)},reducer=(e,i)=>{switch(i.type){case"ADD_TOAST":return{...e,toasts:[i.toast,...e.toasts].slice(0,TOAST_LIMIT)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(c=>c.id===i.toast.id?{...c,...i.toast}:c)};case"DISMISS_TOAST":{const{toastId:c}=i;return c?addToRemoveQueue(c):e.toasts.forEach(b=>{addToRemoveQueue(b.id)}),{...e,toasts:e.toasts.map(b=>b.id===c||c===void 0?{...b,open:!1}:b)}}case"REMOVE_TOAST":return i.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(c=>c.id!==i.toastId)}}},listeners=[];let memoryState={toasts:[]};function dispatch(e){memoryState=reducer(memoryState,e),listeners.forEach(i=>{i(memoryState)})}function toast({...e}){const i=genId(),c=$=>dispatch({type:"UPDATE_TOAST",toast:{...$,id:i}}),b=()=>dispatch({type:"DISMISS_TOAST",toastId:i});return dispatch({type:"ADD_TOAST",toast:{...e,id:i,open:!0,onOpenChange:$=>{$||b()}}}),{id:i,dismiss:b,update:c}}function useToast(){const[e,i]=reactExports.useState(memoryState);return reactExports.useEffect(()=>(listeners.push(i),()=>{const c=listeners.indexOf(i);c>-1&&listeners.splice(c,1)}),[e]),{...e,toast,dismiss:c=>dispatch({type:"DISMISS_TOAST",toastId:c})}}function composeEventHandlers(e,i,{checkForDefaultPrevented:c=!0}={}){return function($){if(e==null||e($),c===!1||!$.defaultPrevented)return i==null?void 0:i($)}}function setRef(e,i){if(typeof e=="function")return e(i);e!=null&&(e.current=i)}function composeRefs(...e){return i=>{let c=!1;const b=e.map($=>{const it=setRef($,i);return!c&&typeof it=="function"&&(c=!0),it});if(c)return()=>{for(let $=0;$<b.length;$++){const it=b[$];typeof it=="function"?it():setRef(e[$],null)}}}}function useComposedRefs(...e){return reactExports.useCallback(composeRefs(...e),e)}function createContext2(e,i){const c=reactExports.createContext(i),b=it=>{const{children:at,...h}=it,dt=reactExports.useMemo(()=>h,Object.values(h));return jsxRuntimeExports.jsx(c.Provider,{value:dt,children:at})};b.displayName=e+"Provider";function $(it){const at=reactExports.useContext(c);if(at)return at;if(i!==void 0)return i;throw new Error(`\`${it}\` must be used within \`${e}\``)}return[b,$]}function createContextScope(e,i=[]){let c=[];function b(it,at){const h=reactExports.createContext(at),dt=c.length;c=[...c,at];const ft=Ct=>{var Tt;const{scope:bt,children:kt,...Dt}=Ct,At=((Tt=bt==null?void 0:bt[e])==null?void 0:Tt[dt])||h,Bt=reactExports.useMemo(()=>Dt,Object.values(Dt));return jsxRuntimeExports.jsx(At.Provider,{value:Bt,children:kt})};ft.displayName=it+"Provider";function xt(Ct,bt){var At;const kt=((At=bt==null?void 0:bt[e])==null?void 0:At[dt])||h,Dt=reactExports.useContext(kt);if(Dt)return Dt;if(at!==void 0)return at;throw new Error(`\`${Ct}\` must be used within \`${it}\``)}return[ft,xt]}const $=()=>{const it=c.map(at=>reactExports.createContext(at));return function(h){const dt=(h==null?void 0:h[e])||it;return reactExports.useMemo(()=>({[`__scope${e}`]:{...h,[e]:dt}}),[h,dt])}};return $.scopeName=e,[b,composeContextScopes($,...i)]}function composeContextScopes(...e){const i=e[0];if(e.length===1)return i;const c=()=>{const b=e.map($=>({useScope:$(),scopeName:$.scopeName}));return function(it){const at=b.reduce((h,{useScope:dt,scopeName:ft})=>{const Ct=dt(it)[`__scope${ft}`];return{...h,...Ct}},{});return reactExports.useMemo(()=>({[`__scope${i.scopeName}`]:at}),[at])}};return c.scopeName=i.scopeName,c}function createSlot(e){const i=createSlotClone(e),c=reactExports.forwardRef((b,$)=>{const{children:it,...at}=b,h=reactExports.Children.toArray(it),dt=h.find(isSlottable);if(dt){const ft=dt.props.children,xt=h.map(Ct=>Ct===dt?reactExports.Children.count(ft)>1?reactExports.Children.only(null):reactExports.isValidElement(ft)?ft.props.children:null:Ct);return jsxRuntimeExports.jsx(i,{...at,ref:$,children:reactExports.isValidElement(ft)?reactExports.cloneElement(ft,void 0,xt):null})}return jsxRuntimeExports.jsx(i,{...at,ref:$,children:it})});return c.displayName=`${e}.Slot`,c}var Slot$1=createSlot("Slot");function createSlotClone(e){const i=reactExports.forwardRef((c,b)=>{const{children:$,...it}=c;if(reactExports.isValidElement($)){const at=getElementRef$1($),h=mergeProps(it,$.props);return $.type!==reactExports.Fragment&&(h.ref=b?composeRefs(b,at):at),reactExports.cloneElement($,h)}return reactExports.Children.count($)>1?reactExports.Children.only(null):null});return i.displayName=`${e}.SlotClone`,i}var SLOTTABLE_IDENTIFIER=Symbol("radix.slottable");function createSlottable(e){const i=({children:c})=>jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:c});return i.displayName=`${e}.Slottable`,i.__radixId=SLOTTABLE_IDENTIFIER,i}function isSlottable(e){return reactExports.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===SLOTTABLE_IDENTIFIER}function mergeProps(e,i){const c={...i};for(const b in i){const $=e[b],it=i[b];/^on[A-Z]/.test(b)?$&&it?c[b]=(...h)=>{const dt=it(...h);return $(...h),dt}:$&&(c[b]=$):b==="style"?c[b]={...$,...it}:b==="className"&&(c[b]=[$,it].filter(Boolean).join(" "))}return{...e,...c}}function getElementRef$1(e){var b,$;let i=(b=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:b.get,c=i&&"isReactWarning"in i&&i.isReactWarning;return c?e.ref:(i=($=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:$.get,c=i&&"isReactWarning"in i&&i.isReactWarning,c?e.props.ref:e.props.ref||e.ref)}function createCollection(e){const i=e+"CollectionProvider",[c,b]=createContextScope(i),[$,it]=c(i,{collectionRef:{current:null},itemMap:new Map}),at=At=>{const{scope:Bt,children:Tt}=At,It=React$2.useRef(null),St=React$2.useRef(new Map).current;return jsxRuntimeExports.jsx($,{scope:Bt,itemMap:St,collectionRef:It,children:Tt})};at.displayName=i;const h=e+"CollectionSlot",dt=createSlot(h),ft=React$2.forwardRef((At,Bt)=>{const{scope:Tt,children:It}=At,St=it(h,Tt),jt=useComposedRefs(Bt,St.collectionRef);return jsxRuntimeExports.jsx(dt,{ref:jt,children:It})});ft.displayName=h;const xt=e+"CollectionItemSlot",Ct="data-radix-collection-item",bt=createSlot(xt),kt=React$2.forwardRef((At,Bt)=>{const{scope:Tt,children:It,...St}=At,jt=React$2.useRef(null),Ht=useComposedRefs(Bt,jt),Kt=it(xt,Tt);return React$2.useEffect(()=>(Kt.itemMap.set(jt,{ref:jt,...St}),()=>void Kt.itemMap.delete(jt))),jsxRuntimeExports.jsx(bt,{[Ct]:"",ref:Ht,children:It})});kt.displayName=xt;function Dt(At){const Bt=it(e+"CollectionConsumer",At);return React$2.useCallback(()=>{const It=Bt.collectionRef.current;if(!It)return[];const St=Array.from(It.querySelectorAll(`[${Ct}]`));return Array.from(Bt.itemMap.values()).sort((Kt,ir)=>St.indexOf(Kt.ref.current)-St.indexOf(ir.ref.current))},[Bt.collectionRef,Bt.itemMap])}return[{Provider:at,Slot:ft,ItemSlot:kt},Dt,b]}var NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive=NODES.reduce((e,i)=>{const c=createSlot(`Primitive.${i}`),b=reactExports.forwardRef(($,it)=>{const{asChild:at,...h}=$,dt=at?c:i;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(dt,{...h,ref:it})});return b.displayName=`Primitive.${i}`,{...e,[i]:b}},{});function dispatchDiscreteCustomEvent(e,i){e&&reactDomExports.flushSync(()=>e.dispatchEvent(i))}function useCallbackRef$1(e){const i=reactExports.useRef(e);return reactExports.useEffect(()=>{i.current=e}),reactExports.useMemo(()=>(...c)=>{var b;return(b=i.current)==null?void 0:b.call(i,...c)},[])}function useEscapeKeydown(e,i=globalThis==null?void 0:globalThis.document){const c=useCallbackRef$1(e);reactExports.useEffect(()=>{const b=$=>{$.key==="Escape"&&c($)};return i.addEventListener("keydown",b,{capture:!0}),()=>i.removeEventListener("keydown",b,{capture:!0})},[c,i])}var DISMISSABLE_LAYER_NAME="DismissableLayer",CONTEXT_UPDATE="dismissableLayer.update",POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",FOCUS_OUTSIDE="dismissableLayer.focusOutside",originalBodyPointerEvents,DismissableLayerContext=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),DismissableLayer=reactExports.forwardRef((e,i)=>{const{disableOutsidePointerEvents:c=!1,onEscapeKeyDown:b,onPointerDownOutside:$,onFocusOutside:it,onInteractOutside:at,onDismiss:h,...dt}=e,ft=reactExports.useContext(DismissableLayerContext),[xt,Ct]=reactExports.useState(null),bt=(xt==null?void 0:xt.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,kt]=reactExports.useState({}),Dt=useComposedRefs(i,ir=>Ct(ir)),At=Array.from(ft.layers),[Bt]=[...ft.layersWithOutsidePointerEventsDisabled].slice(-1),Tt=At.indexOf(Bt),It=xt?At.indexOf(xt):-1,St=ft.layersWithOutsidePointerEventsDisabled.size>0,jt=It>=Tt,Ht=usePointerDownOutside(ir=>{const nr=ir.target,kr=[...ft.branches].some(br=>br.contains(nr));!jt||kr||($==null||$(ir),at==null||at(ir),ir.defaultPrevented||h==null||h())},bt),Kt=useFocusOutside(ir=>{const nr=ir.target;[...ft.branches].some(br=>br.contains(nr))||(it==null||it(ir),at==null||at(ir),ir.defaultPrevented||h==null||h())},bt);return useEscapeKeydown(ir=>{It===ft.layers.size-1&&(b==null||b(ir),!ir.defaultPrevented&&h&&(ir.preventDefault(),h()))},bt),reactExports.useEffect(()=>{if(xt)return c&&(ft.layersWithOutsidePointerEventsDisabled.size===0&&(originalBodyPointerEvents=bt.body.style.pointerEvents,bt.body.style.pointerEvents="none"),ft.layersWithOutsidePointerEventsDisabled.add(xt)),ft.layers.add(xt),dispatchUpdate(),()=>{c&&ft.layersWithOutsidePointerEventsDisabled.size===1&&(bt.body.style.pointerEvents=originalBodyPointerEvents)}},[xt,bt,c,ft]),reactExports.useEffect(()=>()=>{xt&&(ft.layers.delete(xt),ft.layersWithOutsidePointerEventsDisabled.delete(xt),dispatchUpdate())},[xt,ft]),reactExports.useEffect(()=>{const ir=()=>kt({});return document.addEventListener(CONTEXT_UPDATE,ir),()=>document.removeEventListener(CONTEXT_UPDATE,ir)},[]),jsxRuntimeExports.jsx(Primitive.div,{...dt,ref:Dt,style:{pointerEvents:St?jt?"auto":"none":void 0,...e.style},onFocusCapture:composeEventHandlers(e.onFocusCapture,Kt.onFocusCapture),onBlurCapture:composeEventHandlers(e.onBlurCapture,Kt.onBlurCapture),onPointerDownCapture:composeEventHandlers(e.onPointerDownCapture,Ht.onPointerDownCapture)})});DismissableLayer.displayName=DISMISSABLE_LAYER_NAME;var BRANCH_NAME="DismissableLayerBranch",DismissableLayerBranch=reactExports.forwardRef((e,i)=>{const c=reactExports.useContext(DismissableLayerContext),b=reactExports.useRef(null),$=useComposedRefs(i,b);return reactExports.useEffect(()=>{const it=b.current;if(it)return c.branches.add(it),()=>{c.branches.delete(it)}},[c.branches]),jsxRuntimeExports.jsx(Primitive.div,{...e,ref:$})});DismissableLayerBranch.displayName=BRANCH_NAME;function usePointerDownOutside(e,i=globalThis==null?void 0:globalThis.document){const c=useCallbackRef$1(e),b=reactExports.useRef(!1),$=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const it=h=>{if(h.target&&!b.current){let dt=function(){handleAndDispatchCustomEvent$1(POINTER_DOWN_OUTSIDE,c,ft,{discrete:!0})};const ft={originalEvent:h};h.pointerType==="touch"?(i.removeEventListener("click",$.current),$.current=dt,i.addEventListener("click",$.current,{once:!0})):dt()}else i.removeEventListener("click",$.current);b.current=!1},at=window.setTimeout(()=>{i.addEventListener("pointerdown",it)},0);return()=>{window.clearTimeout(at),i.removeEventListener("pointerdown",it),i.removeEventListener("click",$.current)}},[i,c]),{onPointerDownCapture:()=>b.current=!0}}function useFocusOutside(e,i=globalThis==null?void 0:globalThis.document){const c=useCallbackRef$1(e),b=reactExports.useRef(!1);return reactExports.useEffect(()=>{const $=it=>{it.target&&!b.current&&handleAndDispatchCustomEvent$1(FOCUS_OUTSIDE,c,{originalEvent:it},{discrete:!1})};return i.addEventListener("focusin",$),()=>i.removeEventListener("focusin",$)},[i,c]),{onFocusCapture:()=>b.current=!0,onBlurCapture:()=>b.current=!1}}function dispatchUpdate(){const e=new CustomEvent(CONTEXT_UPDATE);document.dispatchEvent(e)}function handleAndDispatchCustomEvent$1(e,i,c,{discrete:b}){const $=c.originalEvent.target,it=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:c});i&&$.addEventListener(e,i,{once:!0}),b?dispatchDiscreteCustomEvent($,it):$.dispatchEvent(it)}var Root$3=DismissableLayer,Branch=DismissableLayerBranch,useLayoutEffect2=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{},PORTAL_NAME$2="Portal",Portal$1=reactExports.forwardRef((e,i)=>{var h;const{container:c,...b}=e,[$,it]=reactExports.useState(!1);useLayoutEffect2(()=>it(!0),[]);const at=c||$&&((h=globalThis==null?void 0:globalThis.document)==null?void 0:h.body);return at?ReactDOM.createPortal(jsxRuntimeExports.jsx(Primitive.div,{...b,ref:i}),at):null});Portal$1.displayName=PORTAL_NAME$2;function useStateMachine(e,i){return reactExports.useReducer((c,b)=>i[c][b]??c,e)}var Presence=e=>{const{present:i,children:c}=e,b=usePresence$1(i),$=typeof c=="function"?c({present:b.isPresent}):reactExports.Children.only(c),it=useComposedRefs(b.ref,getElementRef($));return typeof c=="function"||b.isPresent?reactExports.cloneElement($,{ref:it}):null};Presence.displayName="Presence";function usePresence$1(e){const[i,c]=reactExports.useState(),b=reactExports.useRef(null),$=reactExports.useRef(e),it=reactExports.useRef("none"),at=e?"mounted":"unmounted",[h,dt]=useStateMachine(at,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const ft=getAnimationName(b.current);it.current=h==="mounted"?ft:"none"},[h]),useLayoutEffect2(()=>{const ft=b.current,xt=$.current;if(xt!==e){const bt=it.current,kt=getAnimationName(ft);e?dt("MOUNT"):kt==="none"||(ft==null?void 0:ft.display)==="none"?dt("UNMOUNT"):dt(xt&&bt!==kt?"ANIMATION_OUT":"UNMOUNT"),$.current=e}},[e,dt]),useLayoutEffect2(()=>{if(i){let ft;const xt=i.ownerDocument.defaultView??window,Ct=kt=>{const At=getAnimationName(b.current).includes(CSS.escape(kt.animationName));if(kt.target===i&&At&&(dt("ANIMATION_END"),!$.current)){const Bt=i.style.animationFillMode;i.style.animationFillMode="forwards",ft=xt.setTimeout(()=>{i.style.animationFillMode==="forwards"&&(i.style.animationFillMode=Bt)})}},bt=kt=>{kt.target===i&&(it.current=getAnimationName(b.current))};return i.addEventListener("animationstart",bt),i.addEventListener("animationcancel",Ct),i.addEventListener("animationend",Ct),()=>{xt.clearTimeout(ft),i.removeEventListener("animationstart",bt),i.removeEventListener("animationcancel",Ct),i.removeEventListener("animationend",Ct)}}else dt("ANIMATION_END")},[i,dt]),{isPresent:["mounted","unmountSuspended"].includes(h),ref:reactExports.useCallback(ft=>{b.current=ft?getComputedStyle(ft):null,c(ft)},[])}}function getAnimationName(e){return(e==null?void 0:e.animationName)||"none"}function getElementRef(e){var b,$;let i=(b=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:b.get,c=i&&"isReactWarning"in i&&i.isReactWarning;return c?e.ref:(i=($=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:$.get,c=i&&"isReactWarning"in i&&i.isReactWarning,c?e.props.ref:e.props.ref||e.ref)}var useInsertionEffect=React$3[" useInsertionEffect ".trim().toString()]||useLayoutEffect2;function useControllableState({prop:e,defaultProp:i,onChange:c=()=>{},caller:b}){const[$,it,at]=useUncontrolledState({defaultProp:i,onChange:c}),h=e!==void 0,dt=h?e:$;{const xt=reactExports.useRef(e!==void 0);reactExports.useEffect(()=>{const Ct=xt.current;Ct!==h&&console.warn(`${b} is changing from ${Ct?"controlled":"uncontrolled"} to ${h?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),xt.current=h},[h,b])}const ft=reactExports.useCallback(xt=>{var Ct;if(h){const bt=isFunction(xt)?xt(e):xt;bt!==e&&((Ct=at.current)==null||Ct.call(at,bt))}else it(xt)},[h,e,it,at]);return[dt,ft]}function useUncontrolledState({defaultProp:e,onChange:i}){const[c,b]=reactExports.useState(e),$=reactExports.useRef(c),it=reactExports.useRef(i);return useInsertionEffect(()=>{it.current=i},[i]),reactExports.useEffect(()=>{var at;$.current!==c&&((at=it.current)==null||at.call(it,c),$.current=c)},[c,$]),[c,b,it]}function isFunction(e){return typeof e=="function"}var VISUALLY_HIDDEN_STYLES=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),NAME$1="VisuallyHidden",VisuallyHidden=reactExports.forwardRef((e,i)=>jsxRuntimeExports.jsx(Primitive.span,{...e,ref:i,style:{...VISUALLY_HIDDEN_STYLES,...e.style}}));VisuallyHidden.displayName=NAME$1;var Root$2=VisuallyHidden,PROVIDER_NAME$1="ToastProvider",[Collection,useCollection,createCollectionScope]=createCollection("Toast"),[createToastContext,createToastScope]=createContextScope("Toast",[createCollectionScope]),[ToastProviderProvider,useToastProviderContext]=createToastContext(PROVIDER_NAME$1),ToastProvider$1=e=>{const{__scopeToast:i,label:c="Notification",duration:b=5e3,swipeDirection:$="right",swipeThreshold:it=50,children:at}=e,[h,dt]=reactExports.useState(null),[ft,xt]=reactExports.useState(0),Ct=reactExports.useRef(!1),bt=reactExports.useRef(!1);return c.trim()||console.error(`Invalid prop \`label\` supplied to \`${PROVIDER_NAME$1}\`. Expected non-empty \`string\`.`),jsxRuntimeExports.jsx(Collection.Provider,{scope:i,children:jsxRuntimeExports.jsx(ToastProviderProvider,{scope:i,label:c,duration:b,swipeDirection:$,swipeThreshold:it,toastCount:ft,viewport:h,onViewportChange:dt,onToastAdd:reactExports.useCallback(()=>xt(kt=>kt+1),[]),onToastRemove:reactExports.useCallback(()=>xt(kt=>kt-1),[]),isFocusedToastEscapeKeyDownRef:Ct,isClosePausedRef:bt,children:at})})};ToastProvider$1.displayName=PROVIDER_NAME$1;var VIEWPORT_NAME="ToastViewport",VIEWPORT_DEFAULT_HOTKEY=["F8"],VIEWPORT_PAUSE="toast.viewportPause",VIEWPORT_RESUME="toast.viewportResume",ToastViewport$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:c,hotkey:b=VIEWPORT_DEFAULT_HOTKEY,label:$="Notifications ({hotkey})",...it}=e,at=useToastProviderContext(VIEWPORT_NAME,c),h=useCollection(c),dt=reactExports.useRef(null),ft=reactExports.useRef(null),xt=reactExports.useRef(null),Ct=reactExports.useRef(null),bt=useComposedRefs(i,Ct,at.onViewportChange),kt=b.join("+").replace(/Key/g,"").replace(/Digit/g,""),Dt=at.toastCount>0;reactExports.useEffect(()=>{const Bt=Tt=>{var St;b.length!==0&&b.every(jt=>Tt[jt]||Tt.code===jt)&&((St=Ct.current)==null||St.focus())};return document.addEventListener("keydown",Bt),()=>document.removeEventListener("keydown",Bt)},[b]),reactExports.useEffect(()=>{const Bt=dt.current,Tt=Ct.current;if(Dt&&Bt&&Tt){const It=()=>{if(!at.isClosePausedRef.current){const Kt=new CustomEvent(VIEWPORT_PAUSE);Tt.dispatchEvent(Kt),at.isClosePausedRef.current=!0}},St=()=>{if(at.isClosePausedRef.current){const Kt=new CustomEvent(VIEWPORT_RESUME);Tt.dispatchEvent(Kt),at.isClosePausedRef.current=!1}},jt=Kt=>{!Bt.contains(Kt.relatedTarget)&&St()},Ht=()=>{Bt.contains(document.activeElement)||St()};return Bt.addEventListener("focusin",It),Bt.addEventListener("focusout",jt),Bt.addEventListener("pointermove",It),Bt.addEventListener("pointerleave",Ht),window.addEventListener("blur",It),window.addEventListener("focus",St),()=>{Bt.removeEventListener("focusin",It),Bt.removeEventListener("focusout",jt),Bt.removeEventListener("pointermove",It),Bt.removeEventListener("pointerleave",Ht),window.removeEventListener("blur",It),window.removeEventListener("focus",St)}}},[Dt,at.isClosePausedRef]);const At=reactExports.useCallback(({tabbingDirection:Bt})=>{const It=h().map(St=>{const jt=St.ref.current,Ht=[jt,...getTabbableCandidates$1(jt)];return Bt==="forwards"?Ht:Ht.reverse()});return(Bt==="forwards"?It.reverse():It).flat()},[h]);return reactExports.useEffect(()=>{const Bt=Ct.current;if(Bt){const Tt=It=>{var Ht,Kt,ir;const St=It.altKey||It.ctrlKey||It.metaKey;if(It.key==="Tab"&&!St){const nr=document.activeElement,kr=It.shiftKey;if(It.target===Bt&&kr){(Ht=ft.current)==null||Ht.focus();return}const $r=At({tabbingDirection:kr?"backwards":"forwards"}),rn=$r.findIndex(Zr=>Zr===nr);focusFirst$1($r.slice(rn+1))?It.preventDefault():kr?(Kt=ft.current)==null||Kt.focus():(ir=xt.current)==null||ir.focus()}};return Bt.addEventListener("keydown",Tt),()=>Bt.removeEventListener("keydown",Tt)}},[h,At]),jsxRuntimeExports.jsxs(Branch,{ref:dt,role:"region","aria-label":$.replace("{hotkey}",kt),tabIndex:-1,style:{pointerEvents:Dt?void 0:"none"},children:[Dt&&jsxRuntimeExports.jsx(FocusProxy,{ref:ft,onFocusFromOutsideViewport:()=>{const Bt=At({tabbingDirection:"forwards"});focusFirst$1(Bt)}}),jsxRuntimeExports.jsx(Collection.Slot,{scope:c,children:jsxRuntimeExports.jsx(Primitive.ol,{tabIndex:-1,...it,ref:bt})}),Dt&&jsxRuntimeExports.jsx(FocusProxy,{ref:xt,onFocusFromOutsideViewport:()=>{const Bt=At({tabbingDirection:"backwards"});focusFirst$1(Bt)}})]})});ToastViewport$1.displayName=VIEWPORT_NAME;var FOCUS_PROXY_NAME="ToastFocusProxy",FocusProxy=reactExports.forwardRef((e,i)=>{const{__scopeToast:c,onFocusFromOutsideViewport:b,...$}=e,it=useToastProviderContext(FOCUS_PROXY_NAME,c);return jsxRuntimeExports.jsx(VisuallyHidden,{tabIndex:0,...$,ref:i,style:{position:"fixed"},onFocus:at=>{var ft;const h=at.relatedTarget;!((ft=it.viewport)!=null&&ft.contains(h))&&b()}})});FocusProxy.displayName=FOCUS_PROXY_NAME;var TOAST_NAME="Toast",TOAST_SWIPE_START="toast.swipeStart",TOAST_SWIPE_MOVE="toast.swipeMove",TOAST_SWIPE_CANCEL="toast.swipeCancel",TOAST_SWIPE_END="toast.swipeEnd",Toast$1=reactExports.forwardRef((e,i)=>{const{forceMount:c,open:b,defaultOpen:$,onOpenChange:it,...at}=e,[h,dt]=useControllableState({prop:b,defaultProp:$??!0,onChange:it,caller:TOAST_NAME});return jsxRuntimeExports.jsx(Presence,{present:c||h,children:jsxRuntimeExports.jsx(ToastImpl,{open:h,...at,ref:i,onClose:()=>dt(!1),onPause:useCallbackRef$1(e.onPause),onResume:useCallbackRef$1(e.onResume),onSwipeStart:composeEventHandlers(e.onSwipeStart,ft=>{ft.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:composeEventHandlers(e.onSwipeMove,ft=>{const{x:xt,y:Ct}=ft.detail.delta;ft.currentTarget.setAttribute("data-swipe","move"),ft.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${xt}px`),ft.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${Ct}px`)}),onSwipeCancel:composeEventHandlers(e.onSwipeCancel,ft=>{ft.currentTarget.setAttribute("data-swipe","cancel"),ft.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),ft.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),ft.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),ft.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:composeEventHandlers(e.onSwipeEnd,ft=>{const{x:xt,y:Ct}=ft.detail.delta;ft.currentTarget.setAttribute("data-swipe","end"),ft.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),ft.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),ft.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${xt}px`),ft.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${Ct}px`),dt(!1)})})})});Toast$1.displayName=TOAST_NAME;var[ToastInteractiveProvider,useToastInteractiveContext]=createToastContext(TOAST_NAME,{onClose(){}}),ToastImpl=reactExports.forwardRef((e,i)=>{const{__scopeToast:c,type:b="foreground",duration:$,open:it,onClose:at,onEscapeKeyDown:h,onPause:dt,onResume:ft,onSwipeStart:xt,onSwipeMove:Ct,onSwipeCancel:bt,onSwipeEnd:kt,...Dt}=e,At=useToastProviderContext(TOAST_NAME,c),[Bt,Tt]=reactExports.useState(null),It=useComposedRefs(i,Zr=>Tt(Zr)),St=reactExports.useRef(null),jt=reactExports.useRef(null),Ht=$||At.duration,Kt=reactExports.useRef(0),ir=reactExports.useRef(Ht),nr=reactExports.useRef(0),{onToastAdd:kr,onToastRemove:br}=At,Sr=useCallbackRef$1(()=>{var Kr;(Bt==null?void 0:Bt.contains(document.activeElement))&&((Kr=At.viewport)==null||Kr.focus()),at()}),$r=reactExports.useCallback(Zr=>{!Zr||Zr===1/0||(window.clearTimeout(nr.current),Kt.current=new Date().getTime(),nr.current=window.setTimeout(Sr,Zr))},[Sr]);reactExports.useEffect(()=>{const Zr=At.viewport;if(Zr){const Kr=()=>{$r(ir.current),ft==null||ft()},Xt=()=>{const mr=new Date().getTime()-Kt.current;ir.current=ir.current-mr,window.clearTimeout(nr.current),dt==null||dt()};return Zr.addEventListener(VIEWPORT_PAUSE,Xt),Zr.addEventListener(VIEWPORT_RESUME,Kr),()=>{Zr.removeEventListener(VIEWPORT_PAUSE,Xt),Zr.removeEventListener(VIEWPORT_RESUME,Kr)}}},[At.viewport,Ht,dt,ft,$r]),reactExports.useEffect(()=>{it&&!At.isClosePausedRef.current&&$r(Ht)},[it,Ht,At.isClosePausedRef,$r]),reactExports.useEffect(()=>(kr(),()=>br()),[kr,br]);const rn=reactExports.useMemo(()=>Bt?getAnnounceTextContent(Bt):null,[Bt]);return At.viewport?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[rn&&jsxRuntimeExports.jsx(ToastAnnounce,{__scopeToast:c,role:"status","aria-live":b==="foreground"?"assertive":"polite",children:rn}),jsxRuntimeExports.jsx(ToastInteractiveProvider,{scope:c,onClose:Sr,children:reactDomExports.createPortal(jsxRuntimeExports.jsx(Collection.ItemSlot,{scope:c,children:jsxRuntimeExports.jsx(Root$3,{asChild:!0,onEscapeKeyDown:composeEventHandlers(h,()=>{At.isFocusedToastEscapeKeyDownRef.current||Sr(),At.isFocusedToastEscapeKeyDownRef.current=!1}),children:jsxRuntimeExports.jsx(Primitive.li,{tabIndex:0,"data-state":it?"open":"closed","data-swipe-direction":At.swipeDirection,...Dt,ref:It,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:composeEventHandlers(e.onKeyDown,Zr=>{Zr.key==="Escape"&&(h==null||h(Zr.nativeEvent),Zr.nativeEvent.defaultPrevented||(At.isFocusedToastEscapeKeyDownRef.current=!0,Sr()))}),onPointerDown:composeEventHandlers(e.onPointerDown,Zr=>{Zr.button===0&&(St.current={x:Zr.clientX,y:Zr.clientY})}),onPointerMove:composeEventHandlers(e.onPointerMove,Zr=>{if(!St.current)return;const Kr=Zr.clientX-St.current.x,Xt=Zr.clientY-St.current.y,mr=!!jt.current,Ut=["left","right"].includes(At.swipeDirection),Jt=["left","up"].includes(At.swipeDirection)?Math.min:Math.max,Or=Ut?Jt(0,Kr):0,Cr=Ut?0:Jt(0,Xt),pn=Zr.pointerType==="touch"?10:2,On={x:Or,y:Cr},Zn={originalEvent:Zr,delta:On};mr?(jt.current=On,handleAndDispatchCustomEvent(TOAST_SWIPE_MOVE,Ct,Zn,{discrete:!1})):isDeltaInDirection(On,At.swipeDirection,pn)?(jt.current=On,handleAndDispatchCustomEvent(TOAST_SWIPE_START,xt,Zn,{discrete:!1}),Zr.target.setPointerCapture(Zr.pointerId)):(Math.abs(Kr)>pn||Math.abs(Xt)>pn)&&(St.current=null)}),onPointerUp:composeEventHandlers(e.onPointerUp,Zr=>{const Kr=jt.current,Xt=Zr.target;if(Xt.hasPointerCapture(Zr.pointerId)&&Xt.releasePointerCapture(Zr.pointerId),jt.current=null,St.current=null,Kr){const mr=Zr.currentTarget,Ut={originalEvent:Zr,delta:Kr};isDeltaInDirection(Kr,At.swipeDirection,At.swipeThreshold)?handleAndDispatchCustomEvent(TOAST_SWIPE_END,kt,Ut,{discrete:!0}):handleAndDispatchCustomEvent(TOAST_SWIPE_CANCEL,bt,Ut,{discrete:!0}),mr.addEventListener("click",Jt=>Jt.preventDefault(),{once:!0})}})})})}),At.viewport)})]}):null}),ToastAnnounce=e=>{const{__scopeToast:i,children:c,...b}=e,$=useToastProviderContext(TOAST_NAME,i),[it,at]=reactExports.useState(!1),[h,dt]=reactExports.useState(!1);return useNextFrame(()=>at(!0)),reactExports.useEffect(()=>{const ft=window.setTimeout(()=>dt(!0),1e3);return()=>window.clearTimeout(ft)},[]),h?null:jsxRuntimeExports.jsx(Portal$1,{asChild:!0,children:jsxRuntimeExports.jsx(VisuallyHidden,{...b,children:it&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[$.label," ",c]})})})},TITLE_NAME$1="ToastTitle",ToastTitle$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:c,...b}=e;return jsxRuntimeExports.jsx(Primitive.div,{...b,ref:i})});ToastTitle$1.displayName=TITLE_NAME$1;var DESCRIPTION_NAME$1="ToastDescription",ToastDescription$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:c,...b}=e;return jsxRuntimeExports.jsx(Primitive.div,{...b,ref:i})});ToastDescription$1.displayName=DESCRIPTION_NAME$1;var ACTION_NAME="ToastAction",ToastAction$1=reactExports.forwardRef((e,i)=>{const{altText:c,...b}=e;return c.trim()?jsxRuntimeExports.jsx(ToastAnnounceExclude,{altText:c,asChild:!0,children:jsxRuntimeExports.jsx(ToastClose$1,{...b,ref:i})}):(console.error(`Invalid prop \`altText\` supplied to \`${ACTION_NAME}\`. Expected non-empty \`string\`.`),null)});ToastAction$1.displayName=ACTION_NAME;var CLOSE_NAME$1="ToastClose",ToastClose$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:c,...b}=e,$=useToastInteractiveContext(CLOSE_NAME$1,c);return jsxRuntimeExports.jsx(ToastAnnounceExclude,{asChild:!0,children:jsxRuntimeExports.jsx(Primitive.button,{type:"button",...b,ref:i,onClick:composeEventHandlers(e.onClick,$.onClose)})})});ToastClose$1.displayName=CLOSE_NAME$1;var ToastAnnounceExclude=reactExports.forwardRef((e,i)=>{const{__scopeToast:c,altText:b,...$}=e;return jsxRuntimeExports.jsx(Primitive.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":b||void 0,...$,ref:i})});function getAnnounceTextContent(e){const i=[];return Array.from(e.childNodes).forEach(b=>{if(b.nodeType===b.TEXT_NODE&&b.textContent&&i.push(b.textContent),isHTMLElement$1(b)){const $=b.ariaHidden||b.hidden||b.style.display==="none",it=b.dataset.radixToastAnnounceExclude==="";if(!$)if(it){const at=b.dataset.radixToastAnnounceAlt;at&&i.push(at)}else i.push(...getAnnounceTextContent(b))}}),i}function handleAndDispatchCustomEvent(e,i,c,{discrete:b}){const $=c.originalEvent.currentTarget,it=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:c});i&&$.addEventListener(e,i,{once:!0}),b?dispatchDiscreteCustomEvent($,it):$.dispatchEvent(it)}var isDeltaInDirection=(e,i,c=0)=>{const b=Math.abs(e.x),$=Math.abs(e.y),it=b>$;return i==="left"||i==="right"?it&&b>c:!it&&$>c};function useNextFrame(e=()=>{}){const i=useCallbackRef$1(e);useLayoutEffect2(()=>{let c=0,b=0;return c=window.requestAnimationFrame(()=>b=window.requestAnimationFrame(i)),()=>{window.cancelAnimationFrame(c),window.cancelAnimationFrame(b)}},[i])}function isHTMLElement$1(e){return e.nodeType===e.ELEMENT_NODE}function getTabbableCandidates$1(e){const i=[],c=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:b=>{const $=b.tagName==="INPUT"&&b.type==="hidden";return b.disabled||b.hidden||$?NodeFilter.FILTER_SKIP:b.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;c.nextNode();)i.push(c.currentNode);return i}function focusFirst$1(e){const i=document.activeElement;return e.some(c=>c===i?!0:(c.focus(),document.activeElement!==i))}var Provider$1=ToastProvider$1,Viewport=ToastViewport$1,Root2=Toast$1,Title$1=ToastTitle$1,Description$1=ToastDescription$1,Action=ToastAction$1,Close$1=ToastClose$1;function r(e){var i,c,b="";if(typeof e=="string"||typeof e=="number")b+=e;else if(typeof e=="object")if(Array.isArray(e)){var $=e.length;for(i=0;i<$;i++)e[i]&&(c=r(e[i]))&&(b&&(b+=" "),b+=c)}else for(c in e)e[c]&&(b&&(b+=" "),b+=c);return b}function clsx(){for(var e,i,c=0,b="",$=arguments.length;c<$;c++)(e=arguments[c])&&(i=r(e))&&(b&&(b+=" "),b+=i);return b}const falsyToString=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,cx=clsx,cva=(e,i)=>c=>{var b;if((i==null?void 0:i.variants)==null)return cx(e,c==null?void 0:c.class,c==null?void 0:c.className);const{variants:$,defaultVariants:it}=i,at=Object.keys($).map(ft=>{const xt=c==null?void 0:c[ft],Ct=it==null?void 0:it[ft];if(xt===null)return null;const bt=falsyToString(xt)||falsyToString(Ct);return $[ft][bt]}),h=c&&Object.entries(c).reduce((ft,xt)=>{let[Ct,bt]=xt;return bt===void 0||(ft[Ct]=bt),ft},{}),dt=i==null||(b=i.compoundVariants)===null||b===void 0?void 0:b.reduce((ft,xt)=>{let{class:Ct,className:bt,...kt}=xt;return Object.entries(kt).every(Dt=>{let[At,Bt]=Dt;return Array.isArray(Bt)?Bt.includes({...it,...h}[At]):{...it,...h}[At]===Bt})?[...ft,Ct,bt]:ft},[]);return cx(e,at,dt,c==null?void 0:c.class,c==null?void 0:c.className)};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const toKebabCase=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),mergeClasses=(...e)=>e.filter((i,c,b)=>!!i&&b.indexOf(i)===c).join(" ");/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Icon=reactExports.forwardRef(({color:e="currentColor",size:i=24,strokeWidth:c=2,absoluteStrokeWidth:b,className:$="",children:it,iconNode:at,...h},dt)=>reactExports.createElement("svg",{ref:dt,...defaultAttributes,width:i,height:i,stroke:e,strokeWidth:b?Number(c)*24/Number(i):c,className:mergeClasses("lucide",$),...h},[...at.map(([ft,xt])=>reactExports.createElement(ft,xt)),...Array.isArray(it)?it:[it]]));/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const createLucideIcon=(e,i)=>{const c=reactExports.forwardRef(({className:b,...$},it)=>reactExports.createElement(Icon,{ref:it,iconNode:i,className:mergeClasses(`lucide-${toKebabCase(e)}`,b),...$}));return c.displayName=`${e}`,c};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Activity=createLucideIcon("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ArrowLeft=createLucideIcon("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Battery=createLucideIcon("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bell=createLucideIcon("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bluetooth=createLucideIcon("Bluetooth",[["path",{d:"m7 7 10 10-5 5V2l5 5L7 17",key:"1q5490"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BookOpen=createLucideIcon("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Book=createLucideIcon("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Calendar=createLucideIcon("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CameraOff=createLucideIcon("CameraOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16",key:"qmtpty"}],["path",{d:"M9.5 4h5L17 7h3a2 2 0 0 1 2 2v7.5",key:"1ufyfc"}],["path",{d:"M14.121 15.121A3 3 0 1 1 9.88 10.88",key:"11zox6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Camera=createLucideIcon("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChartColumn=createLucideIcon("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CircleAlert=createLucideIcon("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CircleCheckBig=createLucideIcon("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CircleCheck=createLucideIcon("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CircleHelp=createLucideIcon("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CircleX=createLucideIcon("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Clipboard=createLucideIcon("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Clock=createLucideIcon("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Droplets=createLucideIcon("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Footprints=createLucideIcon("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gauge=createLucideIcon("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Grid3x3=createLucideIcon("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Heart=createLucideIcon("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const House=createLucideIcon("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Info=createLucideIcon("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Phone=createLucideIcon("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Plus=createLucideIcon("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RotateCcw=createLucideIcon("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RotateCw=createLucideIcon("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Save=createLucideIcon("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Search=createLucideIcon("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Settings=createLucideIcon("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Shield=createLucideIcon("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Star=createLucideIcon("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TrendingUp=createLucideIcon("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TriangleAlert=createLucideIcon("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const User=createLucideIcon("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Users=createLucideIcon("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Utensils=createLucideIcon("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=createLucideIcon("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),CLASS_PART_SEPARATOR="-",createClassGroupUtils=e=>{const i=createClassMap(e),{conflictingClassGroups:c,conflictingClassGroupModifiers:b}=e;return{getClassGroupId:at=>{const h=at.split(CLASS_PART_SEPARATOR);return h[0]===""&&h.length!==1&&h.shift(),getGroupRecursive(h,i)||getGroupIdForArbitraryProperty(at)},getConflictingClassGroupIds:(at,h)=>{const dt=c[at]||[];return h&&b[at]?[...dt,...b[at]]:dt}}},getGroupRecursive=(e,i)=>{var at;if(e.length===0)return i.classGroupId;const c=e[0],b=i.nextPart.get(c),$=b?getGroupRecursive(e.slice(1),b):void 0;if($)return $;if(i.validators.length===0)return;const it=e.join(CLASS_PART_SEPARATOR);return(at=i.validators.find(({validator:h})=>h(it)))==null?void 0:at.classGroupId},arbitraryPropertyRegex=/^\[(.+)\]$/,getGroupIdForArbitraryProperty=e=>{if(arbitraryPropertyRegex.test(e)){const i=arbitraryPropertyRegex.exec(e)[1],c=i==null?void 0:i.substring(0,i.indexOf(":"));if(c)return"arbitrary.."+c}},createClassMap=e=>{const{theme:i,prefix:c}=e,b={nextPart:new Map,validators:[]};return getPrefixedClassGroupEntries(Object.entries(e.classGroups),c).forEach(([it,at])=>{processClassesRecursively(at,b,it,i)}),b},processClassesRecursively=(e,i,c,b)=>{e.forEach($=>{if(typeof $=="string"){const it=$===""?i:getPart(i,$);it.classGroupId=c;return}if(typeof $=="function"){if(isThemeGetter($)){processClassesRecursively($(b),i,c,b);return}i.validators.push({validator:$,classGroupId:c});return}Object.entries($).forEach(([it,at])=>{processClassesRecursively(at,getPart(i,it),c,b)})})},getPart=(e,i)=>{let c=e;return i.split(CLASS_PART_SEPARATOR).forEach(b=>{c.nextPart.has(b)||c.nextPart.set(b,{nextPart:new Map,validators:[]}),c=c.nextPart.get(b)}),c},isThemeGetter=e=>e.isThemeGetter,getPrefixedClassGroupEntries=(e,i)=>i?e.map(([c,b])=>{const $=b.map(it=>typeof it=="string"?i+it:typeof it=="object"?Object.fromEntries(Object.entries(it).map(([at,h])=>[i+at,h])):it);return[c,$]}):e,createLruCache=e=>{if(e<1)return{get:()=>{},set:()=>{}};let i=0,c=new Map,b=new Map;const $=(it,at)=>{c.set(it,at),i++,i>e&&(i=0,b=c,c=new Map)};return{get(it){let at=c.get(it);if(at!==void 0)return at;if((at=b.get(it))!==void 0)return $(it,at),at},set(it,at){c.has(it)?c.set(it,at):$(it,at)}}},IMPORTANT_MODIFIER="!",createParseClassName=e=>{const{separator:i,experimentalParseClassName:c}=e,b=i.length===1,$=i[0],it=i.length,at=h=>{const dt=[];let ft=0,xt=0,Ct;for(let Bt=0;Bt<h.length;Bt++){let Tt=h[Bt];if(ft===0){if(Tt===$&&(b||h.slice(Bt,Bt+it)===i)){dt.push(h.slice(xt,Bt)),xt=Bt+it;continue}if(Tt==="/"){Ct=Bt;continue}}Tt==="["?ft++:Tt==="]"&&ft--}const bt=dt.length===0?h:h.substring(xt),kt=bt.startsWith(IMPORTANT_MODIFIER),Dt=kt?bt.substring(1):bt,At=Ct&&Ct>xt?Ct-xt:void 0;return{modifiers:dt,hasImportantModifier:kt,baseClassName:Dt,maybePostfixModifierPosition:At}};return c?h=>c({className:h,parseClassName:at}):at},sortModifiers=e=>{if(e.length<=1)return e;const i=[];let c=[];return e.forEach(b=>{b[0]==="["?(i.push(...c.sort(),b),c=[]):c.push(b)}),i.push(...c.sort()),i},createConfigUtils=e=>({cache:createLruCache(e.cacheSize),parseClassName:createParseClassName(e),...createClassGroupUtils(e)}),SPLIT_CLASSES_REGEX=/\s+/,mergeClassList=(e,i)=>{const{parseClassName:c,getClassGroupId:b,getConflictingClassGroupIds:$}=i,it=[],at=e.trim().split(SPLIT_CLASSES_REGEX);let h="";for(let dt=at.length-1;dt>=0;dt-=1){const ft=at[dt],{modifiers:xt,hasImportantModifier:Ct,baseClassName:bt,maybePostfixModifierPosition:kt}=c(ft);let Dt=!!kt,At=b(Dt?bt.substring(0,kt):bt);if(!At){if(!Dt){h=ft+(h.length>0?" "+h:h);continue}if(At=b(bt),!At){h=ft+(h.length>0?" "+h:h);continue}Dt=!1}const Bt=sortModifiers(xt).join(":"),Tt=Ct?Bt+IMPORTANT_MODIFIER:Bt,It=Tt+At;if(it.includes(It))continue;it.push(It);const St=$(At,Dt);for(let jt=0;jt<St.length;++jt){const Ht=St[jt];it.push(Tt+Ht)}h=ft+(h.length>0?" "+h:h)}return h};function twJoin(){let e=0,i,c,b="";for(;e<arguments.length;)(i=arguments[e++])&&(c=toValue(i))&&(b&&(b+=" "),b+=c);return b}const toValue=e=>{if(typeof e=="string")return e;let i,c="";for(let b=0;b<e.length;b++)e[b]&&(i=toValue(e[b]))&&(c&&(c+=" "),c+=i);return c};function createTailwindMerge(e,...i){let c,b,$,it=at;function at(dt){const ft=i.reduce((xt,Ct)=>Ct(xt),e());return c=createConfigUtils(ft),b=c.cache.get,$=c.cache.set,it=h,h(dt)}function h(dt){const ft=b(dt);if(ft)return ft;const xt=mergeClassList(dt,c);return $(dt,xt),xt}return function(){return it(twJoin.apply(null,arguments))}}const fromTheme=e=>{const i=c=>c[e]||[];return i.isThemeGetter=!0,i},arbitraryValueRegex=/^\[(?:([a-z-]+):)?(.+)\]$/i,fractionRegex=/^\d+\/\d+$/,stringLengths=new Set(["px","full","screen"]),tshirtUnitRegex=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,lengthUnitRegex=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,colorFunctionRegex=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,shadowRegex=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,imageRegex=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,isLength=e=>isNumber(e)||stringLengths.has(e)||fractionRegex.test(e),isArbitraryLength=e=>getIsArbitraryValue(e,"length",isLengthOnly),isNumber=e=>!!e&&!Number.isNaN(Number(e)),isArbitraryNumber=e=>getIsArbitraryValue(e,"number",isNumber),isInteger=e=>!!e&&Number.isInteger(Number(e)),isPercent=e=>e.endsWith("%")&&isNumber(e.slice(0,-1)),isArbitraryValue=e=>arbitraryValueRegex.test(e),isTshirtSize=e=>tshirtUnitRegex.test(e),sizeLabels=new Set(["length","size","percentage"]),isArbitrarySize=e=>getIsArbitraryValue(e,sizeLabels,isNever),isArbitraryPosition=e=>getIsArbitraryValue(e,"position",isNever),imageLabels=new Set(["image","url"]),isArbitraryImage=e=>getIsArbitraryValue(e,imageLabels,isImage),isArbitraryShadow=e=>getIsArbitraryValue(e,"",isShadow),isAny=()=>!0,getIsArbitraryValue=(e,i,c)=>{const b=arbitraryValueRegex.exec(e);return b?b[1]?typeof i=="string"?b[1]===i:i.has(b[1]):c(b[2]):!1},isLengthOnly=e=>lengthUnitRegex.test(e)&&!colorFunctionRegex.test(e),isNever=()=>!1,isShadow=e=>shadowRegex.test(e),isImage=e=>imageRegex.test(e),getDefaultConfig=()=>{const e=fromTheme("colors"),i=fromTheme("spacing"),c=fromTheme("blur"),b=fromTheme("brightness"),$=fromTheme("borderColor"),it=fromTheme("borderRadius"),at=fromTheme("borderSpacing"),h=fromTheme("borderWidth"),dt=fromTheme("contrast"),ft=fromTheme("grayscale"),xt=fromTheme("hueRotate"),Ct=fromTheme("invert"),bt=fromTheme("gap"),kt=fromTheme("gradientColorStops"),Dt=fromTheme("gradientColorStopPositions"),At=fromTheme("inset"),Bt=fromTheme("margin"),Tt=fromTheme("opacity"),It=fromTheme("padding"),St=fromTheme("saturate"),jt=fromTheme("scale"),Ht=fromTheme("sepia"),Kt=fromTheme("skew"),ir=fromTheme("space"),nr=fromTheme("translate"),kr=()=>["auto","contain","none"],br=()=>["auto","hidden","clip","visible","scroll"],Sr=()=>["auto",isArbitraryValue,i],$r=()=>[isArbitraryValue,i],rn=()=>["",isLength,isArbitraryLength],Zr=()=>["auto",isNumber,isArbitraryValue],Kr=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Xt=()=>["solid","dashed","dotted","double","none"],mr=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ut=()=>["start","end","center","between","around","evenly","stretch"],Jt=()=>["","0",isArbitraryValue],Or=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Cr=()=>[isNumber,isArbitraryValue];return{cacheSize:500,separator:":",theme:{colors:[isAny],spacing:[isLength,isArbitraryLength],blur:["none","",isTshirtSize,isArbitraryValue],brightness:Cr(),borderColor:[e],borderRadius:["none","","full",isTshirtSize,isArbitraryValue],borderSpacing:$r(),borderWidth:rn(),contrast:Cr(),grayscale:Jt(),hueRotate:Cr(),invert:Jt(),gap:$r(),gradientColorStops:[e],gradientColorStopPositions:[isPercent,isArbitraryLength],inset:Sr(),margin:Sr(),opacity:Cr(),padding:$r(),saturate:Cr(),scale:Cr(),sepia:Jt(),skew:Cr(),space:$r(),translate:$r()},classGroups:{aspect:[{aspect:["auto","square","video",isArbitraryValue]}],container:["container"],columns:[{columns:[isTshirtSize]}],"break-after":[{"break-after":Or()}],"break-before":[{"break-before":Or()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Kr(),isArbitraryValue]}],overflow:[{overflow:br()}],"overflow-x":[{"overflow-x":br()}],"overflow-y":[{"overflow-y":br()}],overscroll:[{overscroll:kr()}],"overscroll-x":[{"overscroll-x":kr()}],"overscroll-y":[{"overscroll-y":kr()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[At]}],"inset-x":[{"inset-x":[At]}],"inset-y":[{"inset-y":[At]}],start:[{start:[At]}],end:[{end:[At]}],top:[{top:[At]}],right:[{right:[At]}],bottom:[{bottom:[At]}],left:[{left:[At]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",isInteger,isArbitraryValue]}],basis:[{basis:Sr()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",isArbitraryValue]}],grow:[{grow:Jt()}],shrink:[{shrink:Jt()}],order:[{order:["first","last","none",isInteger,isArbitraryValue]}],"grid-cols":[{"grid-cols":[isAny]}],"col-start-end":[{col:["auto",{span:["full",isInteger,isArbitraryValue]},isArbitraryValue]}],"col-start":[{"col-start":Zr()}],"col-end":[{"col-end":Zr()}],"grid-rows":[{"grid-rows":[isAny]}],"row-start-end":[{row:["auto",{span:[isInteger,isArbitraryValue]},isArbitraryValue]}],"row-start":[{"row-start":Zr()}],"row-end":[{"row-end":Zr()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",isArbitraryValue]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",isArbitraryValue]}],gap:[{gap:[bt]}],"gap-x":[{"gap-x":[bt]}],"gap-y":[{"gap-y":[bt]}],"justify-content":[{justify:["normal",...Ut()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ut(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ut(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[It]}],px:[{px:[It]}],py:[{py:[It]}],ps:[{ps:[It]}],pe:[{pe:[It]}],pt:[{pt:[It]}],pr:[{pr:[It]}],pb:[{pb:[It]}],pl:[{pl:[It]}],m:[{m:[Bt]}],mx:[{mx:[Bt]}],my:[{my:[Bt]}],ms:[{ms:[Bt]}],me:[{me:[Bt]}],mt:[{mt:[Bt]}],mr:[{mr:[Bt]}],mb:[{mb:[Bt]}],ml:[{ml:[Bt]}],"space-x":[{"space-x":[ir]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ir]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",isArbitraryValue,i]}],"min-w":[{"min-w":[isArbitraryValue,i,"min","max","fit"]}],"max-w":[{"max-w":[isArbitraryValue,i,"none","full","min","max","fit","prose",{screen:[isTshirtSize]},isTshirtSize]}],h:[{h:[isArbitraryValue,i,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[isArbitraryValue,i,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[isArbitraryValue,i,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[isArbitraryValue,i,"auto","min","max","fit"]}],"font-size":[{text:["base",isTshirtSize,isArbitraryLength]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",isArbitraryNumber]}],"font-family":[{font:[isAny]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",isArbitraryValue]}],"line-clamp":[{"line-clamp":["none",isNumber,isArbitraryNumber]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",isLength,isArbitraryValue]}],"list-image":[{"list-image":["none",isArbitraryValue]}],"list-style-type":[{list:["none","disc","decimal",isArbitraryValue]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[Tt]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[Tt]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Xt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",isLength,isArbitraryLength]}],"underline-offset":[{"underline-offset":["auto",isLength,isArbitraryValue]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:$r()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",isArbitraryValue]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",isArbitraryValue]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Tt]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Kr(),isArbitraryPosition]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",isArbitrarySize]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},isArbitraryImage]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[Dt]}],"gradient-via-pos":[{via:[Dt]}],"gradient-to-pos":[{to:[Dt]}],"gradient-from":[{from:[kt]}],"gradient-via":[{via:[kt]}],"gradient-to":[{to:[kt]}],rounded:[{rounded:[it]}],"rounded-s":[{"rounded-s":[it]}],"rounded-e":[{"rounded-e":[it]}],"rounded-t":[{"rounded-t":[it]}],"rounded-r":[{"rounded-r":[it]}],"rounded-b":[{"rounded-b":[it]}],"rounded-l":[{"rounded-l":[it]}],"rounded-ss":[{"rounded-ss":[it]}],"rounded-se":[{"rounded-se":[it]}],"rounded-ee":[{"rounded-ee":[it]}],"rounded-es":[{"rounded-es":[it]}],"rounded-tl":[{"rounded-tl":[it]}],"rounded-tr":[{"rounded-tr":[it]}],"rounded-br":[{"rounded-br":[it]}],"rounded-bl":[{"rounded-bl":[it]}],"border-w":[{border:[h]}],"border-w-x":[{"border-x":[h]}],"border-w-y":[{"border-y":[h]}],"border-w-s":[{"border-s":[h]}],"border-w-e":[{"border-e":[h]}],"border-w-t":[{"border-t":[h]}],"border-w-r":[{"border-r":[h]}],"border-w-b":[{"border-b":[h]}],"border-w-l":[{"border-l":[h]}],"border-opacity":[{"border-opacity":[Tt]}],"border-style":[{border:[...Xt(),"hidden"]}],"divide-x":[{"divide-x":[h]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[h]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Tt]}],"divide-style":[{divide:Xt()}],"border-color":[{border:[$]}],"border-color-x":[{"border-x":[$]}],"border-color-y":[{"border-y":[$]}],"border-color-s":[{"border-s":[$]}],"border-color-e":[{"border-e":[$]}],"border-color-t":[{"border-t":[$]}],"border-color-r":[{"border-r":[$]}],"border-color-b":[{"border-b":[$]}],"border-color-l":[{"border-l":[$]}],"divide-color":[{divide:[$]}],"outline-style":[{outline:["",...Xt()]}],"outline-offset":[{"outline-offset":[isLength,isArbitraryValue]}],"outline-w":[{outline:[isLength,isArbitraryLength]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:rn()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[Tt]}],"ring-offset-w":[{"ring-offset":[isLength,isArbitraryLength]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",isTshirtSize,isArbitraryShadow]}],"shadow-color":[{shadow:[isAny]}],opacity:[{opacity:[Tt]}],"mix-blend":[{"mix-blend":[...mr(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":mr()}],filter:[{filter:["","none"]}],blur:[{blur:[c]}],brightness:[{brightness:[b]}],contrast:[{contrast:[dt]}],"drop-shadow":[{"drop-shadow":["","none",isTshirtSize,isArbitraryValue]}],grayscale:[{grayscale:[ft]}],"hue-rotate":[{"hue-rotate":[xt]}],invert:[{invert:[Ct]}],saturate:[{saturate:[St]}],sepia:[{sepia:[Ht]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[c]}],"backdrop-brightness":[{"backdrop-brightness":[b]}],"backdrop-contrast":[{"backdrop-contrast":[dt]}],"backdrop-grayscale":[{"backdrop-grayscale":[ft]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[xt]}],"backdrop-invert":[{"backdrop-invert":[Ct]}],"backdrop-opacity":[{"backdrop-opacity":[Tt]}],"backdrop-saturate":[{"backdrop-saturate":[St]}],"backdrop-sepia":[{"backdrop-sepia":[Ht]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[at]}],"border-spacing-x":[{"border-spacing-x":[at]}],"border-spacing-y":[{"border-spacing-y":[at]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",isArbitraryValue]}],duration:[{duration:Cr()}],ease:[{ease:["linear","in","out","in-out",isArbitraryValue]}],delay:[{delay:Cr()}],animate:[{animate:["none","spin","ping","pulse","bounce",isArbitraryValue]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[jt]}],"scale-x":[{"scale-x":[jt]}],"scale-y":[{"scale-y":[jt]}],rotate:[{rotate:[isInteger,isArbitraryValue]}],"translate-x":[{"translate-x":[nr]}],"translate-y":[{"translate-y":[nr]}],"skew-x":[{"skew-x":[Kt]}],"skew-y":[{"skew-y":[Kt]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",isArbitraryValue]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",isArbitraryValue]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":$r()}],"scroll-mx":[{"scroll-mx":$r()}],"scroll-my":[{"scroll-my":$r()}],"scroll-ms":[{"scroll-ms":$r()}],"scroll-me":[{"scroll-me":$r()}],"scroll-mt":[{"scroll-mt":$r()}],"scroll-mr":[{"scroll-mr":$r()}],"scroll-mb":[{"scroll-mb":$r()}],"scroll-ml":[{"scroll-ml":$r()}],"scroll-p":[{"scroll-p":$r()}],"scroll-px":[{"scroll-px":$r()}],"scroll-py":[{"scroll-py":$r()}],"scroll-ps":[{"scroll-ps":$r()}],"scroll-pe":[{"scroll-pe":$r()}],"scroll-pt":[{"scroll-pt":$r()}],"scroll-pr":[{"scroll-pr":$r()}],"scroll-pb":[{"scroll-pb":$r()}],"scroll-pl":[{"scroll-pl":$r()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",isArbitraryValue]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[isLength,isArbitraryLength,isArbitraryNumber]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},twMerge=createTailwindMerge(getDefaultConfig);function cn(...e){return twMerge(clsx(e))}const ToastProvider=Provider$1,ToastViewport=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx(Viewport,{ref:c,className:cn("fixed bottom-20 left-0 right-0 z-[100] flex max-h-screen w-full flex-col items-center p-4 gap-3",e),...i}));ToastViewport.displayName=Viewport.displayName;const toastVariants=cva("group pointer-events-auto relative flex w-full max-w-sm items-center gap-3 overflow-hidden rounded-2xl p-4 shadow-2xl backdrop-blur-xl transition-all data-[swipe=cancel]:translate-y-0 data-[swipe=end]:translate-y-[var(--radix-toast-swipe-end-y)] data-[swipe=move]:translate-y-[var(--radix-toast-swipe-move-y)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-bottom-full data-[state=open]:slide-in-from-bottom-full data-[state=open]:duration-300 data-[state=closed]:duration-200 border-0",{variants:{variant:{default:"bg-white/95 dark:bg-gray-900/95 text-gray-900 dark:text-white",destructive:"bg-red-500/95 text-white",success:"bg-green-500/95 text-white",info:"bg-blue-500/95 text-white"}},defaultVariants:{variant:"default"}}),Toast=reactExports.forwardRef(({className:e,variant:i,...c},b)=>jsxRuntimeExports.jsx(Root2,{ref:b,className:cn(toastVariants({variant:i}),e),...c}));Toast.displayName=Root2.displayName;const ToastAction=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx(Action,{ref:c,className:cn("inline-flex h-9 shrink-0 items-center justify-center rounded-xl px-4 text-sm font-semibold transition-colors active:scale-95 disabled:pointer-events-none disabled:opacity-50 group-[.default]:bg-gray-900 group-[.default]:text-white group-[.destructive]:bg-white/20 group-[.destructive]:text-white group-[.success]:bg-white/20 group-[.success]:text-white group-[.info]:bg-white/20 group-[.info]:text-white",e),...i}));ToastAction.displayName=Action.displayName;const ToastClose=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx(Close$1,{ref:c,className:cn("absolute right-2 top-2 rounded-full p-1.5 transition-all active:scale-90 disabled:pointer-events-none disabled:opacity-50 group-[.default]:text-gray-500 group-[.default]:hover:bg-gray-100 group-[.destructive]:text-white/90 group-[.destructive]:hover:bg-white/20 group-[.success]:text-white/90 group-[.success]:hover:bg-white/20 group-[.info]:text-white/90 group-[.info]:hover:bg-white/20",e),"toast-close":"",...i,children:jsxRuntimeExports.jsx(X,{className:"h-4 w-4"})}));ToastClose.displayName=Close$1.displayName;const ToastIcon=({variant:e})=>{switch(e){case"success":return jsxRuntimeExports.jsx(CircleCheck,{className:"h-5 w-5 shrink-0"});case"destructive":return jsxRuntimeExports.jsx(CircleAlert,{className:"h-5 w-5 shrink-0"});case"info":return jsxRuntimeExports.jsx(Info,{className:"h-5 w-5 shrink-0"});default:return null}},ToastTitle=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx(Title$1,{ref:c,className:cn("text-sm font-semibold leading-tight",e),...i}));ToastTitle.displayName=Title$1.displayName;const ToastDescription=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx(Description$1,{ref:c,className:cn("text-sm opacity-90 mt-0.5",e),...i}));ToastDescription.displayName=Description$1.displayName;function Toaster(){const{toasts:e}=useToast();return jsxRuntimeExports.jsxs(ToastProvider,{children:[e.map(function({id:i,title:c,description:b,action:$,variant:it,...at}){return jsxRuntimeExports.jsxs(Toast,{variant:it,...at,children:[jsxRuntimeExports.jsx(ToastIcon,{variant:it}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[c&&jsxRuntimeExports.jsx(ToastTitle,{children:c}),b&&jsxRuntimeExports.jsx(ToastDescription,{children:b})]}),$,jsxRuntimeExports.jsx(ToastClose,{})]},i)}),jsxRuntimeExports.jsx(ToastViewport,{})]})}var useReactId=React$3[" useId ".trim().toString()]||(()=>{}),count$1=0;function useId(e){const[i,c]=reactExports.useState(useReactId());return useLayoutEffect2(()=>{e||c(b=>b??String(count$1++))},[e]),e||(i?`radix-${i}`:"")}const sides=["top","right","bottom","left"],min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=e=>({x:e,y:e}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp$1(e,i,c){return max(e,min(i,c))}function evaluate(e,i){return typeof e=="function"?e(i):e}function getSide(e){return e.split("-")[0]}function getAlignment(e){return e.split("-")[1]}function getOppositeAxis(e){return e==="x"?"y":"x"}function getAxisLength(e){return e==="y"?"height":"width"}const yAxisSides=new Set(["top","bottom"]);function getSideAxis(e){return yAxisSides.has(getSide(e))?"y":"x"}function getAlignmentAxis(e){return getOppositeAxis(getSideAxis(e))}function getAlignmentSides(e,i,c){c===void 0&&(c=!1);const b=getAlignment(e),$=getAlignmentAxis(e),it=getAxisLength($);let at=$==="x"?b===(c?"end":"start")?"right":"left":b==="start"?"bottom":"top";return i.reference[it]>i.floating[it]&&(at=getOppositePlacement(at)),[at,getOppositePlacement(at)]}function getExpandedPlacements(e){const i=getOppositePlacement(e);return[getOppositeAlignmentPlacement(e),i,getOppositeAlignmentPlacement(i)]}function getOppositeAlignmentPlacement(e){return e.replace(/start|end/g,i=>oppositeAlignmentMap[i])}const lrPlacement=["left","right"],rlPlacement=["right","left"],tbPlacement=["top","bottom"],btPlacement=["bottom","top"];function getSideList(e,i,c){switch(e){case"top":case"bottom":return c?i?rlPlacement:lrPlacement:i?lrPlacement:rlPlacement;case"left":case"right":return i?tbPlacement:btPlacement;default:return[]}}function getOppositeAxisPlacements(e,i,c,b){const $=getAlignment(e);let it=getSideList(getSide(e),c==="start",b);return $&&(it=it.map(at=>at+"-"+$),i&&(it=it.concat(it.map(getOppositeAlignmentPlacement)))),it}function getOppositePlacement(e){return e.replace(/left|right|bottom|top/g,i=>oppositeSideMap[i])}function expandPaddingObject(e){return{top:0,right:0,bottom:0,left:0,...e}}function getPaddingObject(e){return typeof e!="number"?expandPaddingObject(e):{top:e,right:e,bottom:e,left:e}}function rectToClientRect(e){const{x:i,y:c,width:b,height:$}=e;return{width:b,height:$,top:c,left:i,right:i+b,bottom:c+$,x:i,y:c}}function computeCoordsFromPlacement(e,i,c){let{reference:b,floating:$}=e;const it=getSideAxis(i),at=getAlignmentAxis(i),h=getAxisLength(at),dt=getSide(i),ft=it==="y",xt=b.x+b.width/2-$.width/2,Ct=b.y+b.height/2-$.height/2,bt=b[h]/2-$[h]/2;let kt;switch(dt){case"top":kt={x:xt,y:b.y-$.height};break;case"bottom":kt={x:xt,y:b.y+b.height};break;case"right":kt={x:b.x+b.width,y:Ct};break;case"left":kt={x:b.x-$.width,y:Ct};break;default:kt={x:b.x,y:b.y}}switch(getAlignment(i)){case"start":kt[at]-=bt*(c&&ft?-1:1);break;case"end":kt[at]+=bt*(c&&ft?-1:1);break}return kt}const computePosition$1=async(e,i,c)=>{const{placement:b="bottom",strategy:$="absolute",middleware:it=[],platform:at}=c,h=it.filter(Boolean),dt=await(at.isRTL==null?void 0:at.isRTL(i));let ft=await at.getElementRects({reference:e,floating:i,strategy:$}),{x:xt,y:Ct}=computeCoordsFromPlacement(ft,b,dt),bt=b,kt={},Dt=0;for(let At=0;At<h.length;At++){const{name:Bt,fn:Tt}=h[At],{x:It,y:St,data:jt,reset:Ht}=await Tt({x:xt,y:Ct,initialPlacement:b,placement:bt,strategy:$,middlewareData:kt,rects:ft,platform:at,elements:{reference:e,floating:i}});xt=It??xt,Ct=St??Ct,kt={...kt,[Bt]:{...kt[Bt],...jt}},Ht&&Dt<=50&&(Dt++,typeof Ht=="object"&&(Ht.placement&&(bt=Ht.placement),Ht.rects&&(ft=Ht.rects===!0?await at.getElementRects({reference:e,floating:i,strategy:$}):Ht.rects),{x:xt,y:Ct}=computeCoordsFromPlacement(ft,bt,dt)),At=-1)}return{x:xt,y:Ct,placement:bt,strategy:$,middlewareData:kt}};async function detectOverflow(e,i){var c;i===void 0&&(i={});const{x:b,y:$,platform:it,rects:at,elements:h,strategy:dt}=e,{boundary:ft="clippingAncestors",rootBoundary:xt="viewport",elementContext:Ct="floating",altBoundary:bt=!1,padding:kt=0}=evaluate(i,e),Dt=getPaddingObject(kt),Bt=h[bt?Ct==="floating"?"reference":"floating":Ct],Tt=rectToClientRect(await it.getClippingRect({element:(c=await(it.isElement==null?void 0:it.isElement(Bt)))==null||c?Bt:Bt.contextElement||await(it.getDocumentElement==null?void 0:it.getDocumentElement(h.floating)),boundary:ft,rootBoundary:xt,strategy:dt})),It=Ct==="floating"?{x:b,y:$,width:at.floating.width,height:at.floating.height}:at.reference,St=await(it.getOffsetParent==null?void 0:it.getOffsetParent(h.floating)),jt=await(it.isElement==null?void 0:it.isElement(St))?await(it.getScale==null?void 0:it.getScale(St))||{x:1,y:1}:{x:1,y:1},Ht=rectToClientRect(it.convertOffsetParentRelativeRectToViewportRelativeRect?await it.convertOffsetParentRelativeRectToViewportRelativeRect({elements:h,rect:It,offsetParent:St,strategy:dt}):It);return{top:(Tt.top-Ht.top+Dt.top)/jt.y,bottom:(Ht.bottom-Tt.bottom+Dt.bottom)/jt.y,left:(Tt.left-Ht.left+Dt.left)/jt.x,right:(Ht.right-Tt.right+Dt.right)/jt.x}}const arrow$3=e=>({name:"arrow",options:e,async fn(i){const{x:c,y:b,placement:$,rects:it,platform:at,elements:h,middlewareData:dt}=i,{element:ft,padding:xt=0}=evaluate(e,i)||{};if(ft==null)return{};const Ct=getPaddingObject(xt),bt={x:c,y:b},kt=getAlignmentAxis($),Dt=getAxisLength(kt),At=await at.getDimensions(ft),Bt=kt==="y",Tt=Bt?"top":"left",It=Bt?"bottom":"right",St=Bt?"clientHeight":"clientWidth",jt=it.reference[Dt]+it.reference[kt]-bt[kt]-it.floating[Dt],Ht=bt[kt]-it.reference[kt],Kt=await(at.getOffsetParent==null?void 0:at.getOffsetParent(ft));let ir=Kt?Kt[St]:0;(!ir||!await(at.isElement==null?void 0:at.isElement(Kt)))&&(ir=h.floating[St]||it.floating[Dt]);const nr=jt/2-Ht/2,kr=ir/2-At[Dt]/2-1,br=min(Ct[Tt],kr),Sr=min(Ct[It],kr),$r=br,rn=ir-At[Dt]-Sr,Zr=ir/2-At[Dt]/2+nr,Kr=clamp$1($r,Zr,rn),Xt=!dt.arrow&&getAlignment($)!=null&&Zr!==Kr&&it.reference[Dt]/2-(Zr<$r?br:Sr)-At[Dt]/2<0,mr=Xt?Zr<$r?Zr-$r:Zr-rn:0;return{[kt]:bt[kt]+mr,data:{[kt]:Kr,centerOffset:Zr-Kr-mr,...Xt&&{alignmentOffset:mr}},reset:Xt}}}),flip$2=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(i){var c,b;const{placement:$,middlewareData:it,rects:at,initialPlacement:h,platform:dt,elements:ft}=i,{mainAxis:xt=!0,crossAxis:Ct=!0,fallbackPlacements:bt,fallbackStrategy:kt="bestFit",fallbackAxisSideDirection:Dt="none",flipAlignment:At=!0,...Bt}=evaluate(e,i);if((c=it.arrow)!=null&&c.alignmentOffset)return{};const Tt=getSide($),It=getSideAxis(h),St=getSide(h)===h,jt=await(dt.isRTL==null?void 0:dt.isRTL(ft.floating)),Ht=bt||(St||!At?[getOppositePlacement(h)]:getExpandedPlacements(h)),Kt=Dt!=="none";!bt&&Kt&&Ht.push(...getOppositeAxisPlacements(h,At,Dt,jt));const ir=[h,...Ht],nr=await detectOverflow(i,Bt),kr=[];let br=((b=it.flip)==null?void 0:b.overflows)||[];if(xt&&kr.push(nr[Tt]),Ct){const Zr=getAlignmentSides($,at,jt);kr.push(nr[Zr[0]],nr[Zr[1]])}if(br=[...br,{placement:$,overflows:kr}],!kr.every(Zr=>Zr<=0)){var Sr,$r;const Zr=(((Sr=it.flip)==null?void 0:Sr.index)||0)+1,Kr=ir[Zr];if(Kr&&(!(Ct==="alignment"?It!==getSideAxis(Kr):!1)||br.every(Ut=>getSideAxis(Ut.placement)===It?Ut.overflows[0]>0:!0)))return{data:{index:Zr,overflows:br},reset:{placement:Kr}};let Xt=($r=br.filter(mr=>mr.overflows[0]<=0).sort((mr,Ut)=>mr.overflows[1]-Ut.overflows[1])[0])==null?void 0:$r.placement;if(!Xt)switch(kt){case"bestFit":{var rn;const mr=(rn=br.filter(Ut=>{if(Kt){const Jt=getSideAxis(Ut.placement);return Jt===It||Jt==="y"}return!0}).map(Ut=>[Ut.placement,Ut.overflows.filter(Jt=>Jt>0).reduce((Jt,Or)=>Jt+Or,0)]).sort((Ut,Jt)=>Ut[1]-Jt[1])[0])==null?void 0:rn[0];mr&&(Xt=mr);break}case"initialPlacement":Xt=h;break}if($!==Xt)return{reset:{placement:Xt}}}return{}}}};function getSideOffsets(e,i){return{top:e.top-i.height,right:e.right-i.width,bottom:e.bottom-i.height,left:e.left-i.width}}function isAnySideFullyClipped(e){return sides.some(i=>e[i]>=0)}const hide$2=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(i){const{rects:c}=i,{strategy:b="referenceHidden",...$}=evaluate(e,i);switch(b){case"referenceHidden":{const it=await detectOverflow(i,{...$,elementContext:"reference"}),at=getSideOffsets(it,c.reference);return{data:{referenceHiddenOffsets:at,referenceHidden:isAnySideFullyClipped(at)}}}case"escaped":{const it=await detectOverflow(i,{...$,altBoundary:!0}),at=getSideOffsets(it,c.floating);return{data:{escapedOffsets:at,escaped:isAnySideFullyClipped(at)}}}default:return{}}}}},originSides=new Set(["left","top"]);async function convertValueToCoords(e,i){const{placement:c,platform:b,elements:$}=e,it=await(b.isRTL==null?void 0:b.isRTL($.floating)),at=getSide(c),h=getAlignment(c),dt=getSideAxis(c)==="y",ft=originSides.has(at)?-1:1,xt=it&&dt?-1:1,Ct=evaluate(i,e);let{mainAxis:bt,crossAxis:kt,alignmentAxis:Dt}=typeof Ct=="number"?{mainAxis:Ct,crossAxis:0,alignmentAxis:null}:{mainAxis:Ct.mainAxis||0,crossAxis:Ct.crossAxis||0,alignmentAxis:Ct.alignmentAxis};return h&&typeof Dt=="number"&&(kt=h==="end"?Dt*-1:Dt),dt?{x:kt*xt,y:bt*ft}:{x:bt*ft,y:kt*xt}}const offset$2=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(i){var c,b;const{x:$,y:it,placement:at,middlewareData:h}=i,dt=await convertValueToCoords(i,e);return at===((c=h.offset)==null?void 0:c.placement)&&(b=h.arrow)!=null&&b.alignmentOffset?{}:{x:$+dt.x,y:it+dt.y,data:{...dt,placement:at}}}}},shift$2=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(i){const{x:c,y:b,placement:$}=i,{mainAxis:it=!0,crossAxis:at=!1,limiter:h={fn:Bt=>{let{x:Tt,y:It}=Bt;return{x:Tt,y:It}}},...dt}=evaluate(e,i),ft={x:c,y:b},xt=await detectOverflow(i,dt),Ct=getSideAxis(getSide($)),bt=getOppositeAxis(Ct);let kt=ft[bt],Dt=ft[Ct];if(it){const Bt=bt==="y"?"top":"left",Tt=bt==="y"?"bottom":"right",It=kt+xt[Bt],St=kt-xt[Tt];kt=clamp$1(It,kt,St)}if(at){const Bt=Ct==="y"?"top":"left",Tt=Ct==="y"?"bottom":"right",It=Dt+xt[Bt],St=Dt-xt[Tt];Dt=clamp$1(It,Dt,St)}const At=h.fn({...i,[bt]:kt,[Ct]:Dt});return{...At,data:{x:At.x-c,y:At.y-b,enabled:{[bt]:it,[Ct]:at}}}}}},limitShift$2=function(e){return e===void 0&&(e={}),{options:e,fn(i){const{x:c,y:b,placement:$,rects:it,middlewareData:at}=i,{offset:h=0,mainAxis:dt=!0,crossAxis:ft=!0}=evaluate(e,i),xt={x:c,y:b},Ct=getSideAxis($),bt=getOppositeAxis(Ct);let kt=xt[bt],Dt=xt[Ct];const At=evaluate(h,i),Bt=typeof At=="number"?{mainAxis:At,crossAxis:0}:{mainAxis:0,crossAxis:0,...At};if(dt){const St=bt==="y"?"height":"width",jt=it.reference[bt]-it.floating[St]+Bt.mainAxis,Ht=it.reference[bt]+it.reference[St]-Bt.mainAxis;kt<jt?kt=jt:kt>Ht&&(kt=Ht)}if(ft){var Tt,It;const St=bt==="y"?"width":"height",jt=originSides.has(getSide($)),Ht=it.reference[Ct]-it.floating[St]+(jt&&((Tt=at.offset)==null?void 0:Tt[Ct])||0)+(jt?0:Bt.crossAxis),Kt=it.reference[Ct]+it.reference[St]+(jt?0:((It=at.offset)==null?void 0:It[Ct])||0)-(jt?Bt.crossAxis:0);Dt<Ht?Dt=Ht:Dt>Kt&&(Dt=Kt)}return{[bt]:kt,[Ct]:Dt}}}},size$2=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(i){var c,b;const{placement:$,rects:it,platform:at,elements:h}=i,{apply:dt=()=>{},...ft}=evaluate(e,i),xt=await detectOverflow(i,ft),Ct=getSide($),bt=getAlignment($),kt=getSideAxis($)==="y",{width:Dt,height:At}=it.floating;let Bt,Tt;Ct==="top"||Ct==="bottom"?(Bt=Ct,Tt=bt===(await(at.isRTL==null?void 0:at.isRTL(h.floating))?"start":"end")?"left":"right"):(Tt=Ct,Bt=bt==="end"?"top":"bottom");const It=At-xt.top-xt.bottom,St=Dt-xt.left-xt.right,jt=min(At-xt[Bt],It),Ht=min(Dt-xt[Tt],St),Kt=!i.middlewareData.shift;let ir=jt,nr=Ht;if((c=i.middlewareData.shift)!=null&&c.enabled.x&&(nr=St),(b=i.middlewareData.shift)!=null&&b.enabled.y&&(ir=It),Kt&&!bt){const br=max(xt.left,0),Sr=max(xt.right,0),$r=max(xt.top,0),rn=max(xt.bottom,0);kt?nr=Dt-2*(br!==0||Sr!==0?br+Sr:max(xt.left,xt.right)):ir=At-2*($r!==0||rn!==0?$r+rn:max(xt.top,xt.bottom))}await dt({...i,availableWidth:nr,availableHeight:ir});const kr=await at.getDimensions(h.floating);return Dt!==kr.width||At!==kr.height?{reset:{rects:!0}}:{}}}};function hasWindow(){return typeof window<"u"}function getNodeName(e){return isNode(e)?(e.nodeName||"").toLowerCase():"#document"}function getWindow(e){var i;return(e==null||(i=e.ownerDocument)==null?void 0:i.defaultView)||window}function getDocumentElement(e){var i;return(i=(isNode(e)?e.ownerDocument:e.document)||window.document)==null?void 0:i.documentElement}function isNode(e){return hasWindow()?e instanceof Node||e instanceof getWindow(e).Node:!1}function isElement(e){return hasWindow()?e instanceof Element||e instanceof getWindow(e).Element:!1}function isHTMLElement(e){return hasWindow()?e instanceof HTMLElement||e instanceof getWindow(e).HTMLElement:!1}function isShadowRoot(e){return!hasWindow()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof getWindow(e).ShadowRoot}const invalidOverflowDisplayValues=new Set(["inline","contents"]);function isOverflowElement(e){const{overflow:i,overflowX:c,overflowY:b,display:$}=getComputedStyle$2(e);return/auto|scroll|overlay|hidden|clip/.test(i+b+c)&&!invalidOverflowDisplayValues.has($)}const tableElements=new Set(["table","td","th"]);function isTableElement(e){return tableElements.has(getNodeName(e))}const topLayerSelectors=[":popover-open",":modal"];function isTopLayer(e){return topLayerSelectors.some(i=>{try{return e.matches(i)}catch{return!1}})}const transformProperties=["transform","translate","scale","rotate","perspective"],willChangeValues=["transform","translate","scale","rotate","perspective","filter"],containValues=["paint","layout","strict","content"];function isContainingBlock(e){const i=isWebKit(),c=isElement(e)?getComputedStyle$2(e):e;return transformProperties.some(b=>c[b]?c[b]!=="none":!1)||(c.containerType?c.containerType!=="normal":!1)||!i&&(c.backdropFilter?c.backdropFilter!=="none":!1)||!i&&(c.filter?c.filter!=="none":!1)||willChangeValues.some(b=>(c.willChange||"").includes(b))||containValues.some(b=>(c.contain||"").includes(b))}function getContainingBlock(e){let i=getParentNode(e);for(;isHTMLElement(i)&&!isLastTraversableNode(i);){if(isContainingBlock(i))return i;if(isTopLayer(i))return null;i=getParentNode(i)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const lastTraversableNodeNames=new Set(["html","body","#document"]);function isLastTraversableNode(e){return lastTraversableNodeNames.has(getNodeName(e))}function getComputedStyle$2(e){return getWindow(e).getComputedStyle(e)}function getNodeScroll(e){return isElement(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function getParentNode(e){if(getNodeName(e)==="html")return e;const i=e.assignedSlot||e.parentNode||isShadowRoot(e)&&e.host||getDocumentElement(e);return isShadowRoot(i)?i.host:i}function getNearestOverflowAncestor(e){const i=getParentNode(e);return isLastTraversableNode(i)?e.ownerDocument?e.ownerDocument.body:e.body:isHTMLElement(i)&&isOverflowElement(i)?i:getNearestOverflowAncestor(i)}function getOverflowAncestors(e,i,c){var b;i===void 0&&(i=[]),c===void 0&&(c=!0);const $=getNearestOverflowAncestor(e),it=$===((b=e.ownerDocument)==null?void 0:b.body),at=getWindow($);if(it){const h=getFrameElement(at);return i.concat(at,at.visualViewport||[],isOverflowElement($)?$:[],h&&c?getOverflowAncestors(h):[])}return i.concat($,getOverflowAncestors($,[],c))}function getFrameElement(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function getCssDimensions(e){const i=getComputedStyle$2(e);let c=parseFloat(i.width)||0,b=parseFloat(i.height)||0;const $=isHTMLElement(e),it=$?e.offsetWidth:c,at=$?e.offsetHeight:b,h=round(c)!==it||round(b)!==at;return h&&(c=it,b=at),{width:c,height:b,$:h}}function unwrapElement(e){return isElement(e)?e:e.contextElement}function getScale(e){const i=unwrapElement(e);if(!isHTMLElement(i))return createCoords(1);const c=i.getBoundingClientRect(),{width:b,height:$,$:it}=getCssDimensions(i);let at=(it?round(c.width):c.width)/b,h=(it?round(c.height):c.height)/$;return(!at||!Number.isFinite(at))&&(at=1),(!h||!Number.isFinite(h))&&(h=1),{x:at,y:h}}const noOffsets=createCoords(0);function getVisualOffsets(e){const i=getWindow(e);return!isWebKit()||!i.visualViewport?noOffsets:{x:i.visualViewport.offsetLeft,y:i.visualViewport.offsetTop}}function shouldAddVisualOffsets(e,i,c){return i===void 0&&(i=!1),!c||i&&c!==getWindow(e)?!1:i}function getBoundingClientRect(e,i,c,b){i===void 0&&(i=!1),c===void 0&&(c=!1);const $=e.getBoundingClientRect(),it=unwrapElement(e);let at=createCoords(1);i&&(b?isElement(b)&&(at=getScale(b)):at=getScale(e));const h=shouldAddVisualOffsets(it,c,b)?getVisualOffsets(it):createCoords(0);let dt=($.left+h.x)/at.x,ft=($.top+h.y)/at.y,xt=$.width/at.x,Ct=$.height/at.y;if(it){const bt=getWindow(it),kt=b&&isElement(b)?getWindow(b):b;let Dt=bt,At=getFrameElement(Dt);for(;At&&b&&kt!==Dt;){const Bt=getScale(At),Tt=At.getBoundingClientRect(),It=getComputedStyle$2(At),St=Tt.left+(At.clientLeft+parseFloat(It.paddingLeft))*Bt.x,jt=Tt.top+(At.clientTop+parseFloat(It.paddingTop))*Bt.y;dt*=Bt.x,ft*=Bt.y,xt*=Bt.x,Ct*=Bt.y,dt+=St,ft+=jt,Dt=getWindow(At),At=getFrameElement(Dt)}}return rectToClientRect({width:xt,height:Ct,x:dt,y:ft})}function getWindowScrollBarX(e,i){const c=getNodeScroll(e).scrollLeft;return i?i.left+c:getBoundingClientRect(getDocumentElement(e)).left+c}function getHTMLOffset(e,i){const c=e.getBoundingClientRect(),b=c.left+i.scrollLeft-getWindowScrollBarX(e,c),$=c.top+i.scrollTop;return{x:b,y:$}}function convertOffsetParentRelativeRectToViewportRelativeRect(e){let{elements:i,rect:c,offsetParent:b,strategy:$}=e;const it=$==="fixed",at=getDocumentElement(b),h=i?isTopLayer(i.floating):!1;if(b===at||h&&it)return c;let dt={scrollLeft:0,scrollTop:0},ft=createCoords(1);const xt=createCoords(0),Ct=isHTMLElement(b);if((Ct||!Ct&&!it)&&((getNodeName(b)!=="body"||isOverflowElement(at))&&(dt=getNodeScroll(b)),isHTMLElement(b))){const kt=getBoundingClientRect(b);ft=getScale(b),xt.x=kt.x+b.clientLeft,xt.y=kt.y+b.clientTop}const bt=at&&!Ct&&!it?getHTMLOffset(at,dt):createCoords(0);return{width:c.width*ft.x,height:c.height*ft.y,x:c.x*ft.x-dt.scrollLeft*ft.x+xt.x+bt.x,y:c.y*ft.y-dt.scrollTop*ft.y+xt.y+bt.y}}function getClientRects(e){return Array.from(e.getClientRects())}function getDocumentRect(e){const i=getDocumentElement(e),c=getNodeScroll(e),b=e.ownerDocument.body,$=max(i.scrollWidth,i.clientWidth,b.scrollWidth,b.clientWidth),it=max(i.scrollHeight,i.clientHeight,b.scrollHeight,b.clientHeight);let at=-c.scrollLeft+getWindowScrollBarX(e);const h=-c.scrollTop;return getComputedStyle$2(b).direction==="rtl"&&(at+=max(i.clientWidth,b.clientWidth)-$),{width:$,height:it,x:at,y:h}}const SCROLLBAR_MAX=25;function getViewportRect(e,i){const c=getWindow(e),b=getDocumentElement(e),$=c.visualViewport;let it=b.clientWidth,at=b.clientHeight,h=0,dt=0;if($){it=$.width,at=$.height;const xt=isWebKit();(!xt||xt&&i==="fixed")&&(h=$.offsetLeft,dt=$.offsetTop)}const ft=getWindowScrollBarX(b);if(ft<=0){const xt=b.ownerDocument,Ct=xt.body,bt=getComputedStyle(Ct),kt=xt.compatMode==="CSS1Compat"&&parseFloat(bt.marginLeft)+parseFloat(bt.marginRight)||0,Dt=Math.abs(b.clientWidth-Ct.clientWidth-kt);Dt<=SCROLLBAR_MAX&&(it-=Dt)}else ft<=SCROLLBAR_MAX&&(it+=ft);return{width:it,height:at,x:h,y:dt}}const absoluteOrFixed=new Set(["absolute","fixed"]);function getInnerBoundingClientRect(e,i){const c=getBoundingClientRect(e,!0,i==="fixed"),b=c.top+e.clientTop,$=c.left+e.clientLeft,it=isHTMLElement(e)?getScale(e):createCoords(1),at=e.clientWidth*it.x,h=e.clientHeight*it.y,dt=$*it.x,ft=b*it.y;return{width:at,height:h,x:dt,y:ft}}function getClientRectFromClippingAncestor(e,i,c){let b;if(i==="viewport")b=getViewportRect(e,c);else if(i==="document")b=getDocumentRect(getDocumentElement(e));else if(isElement(i))b=getInnerBoundingClientRect(i,c);else{const $=getVisualOffsets(e);b={x:i.x-$.x,y:i.y-$.y,width:i.width,height:i.height}}return rectToClientRect(b)}function hasFixedPositionAncestor(e,i){const c=getParentNode(e);return c===i||!isElement(c)||isLastTraversableNode(c)?!1:getComputedStyle$2(c).position==="fixed"||hasFixedPositionAncestor(c,i)}function getClippingElementAncestors(e,i){const c=i.get(e);if(c)return c;let b=getOverflowAncestors(e,[],!1).filter(h=>isElement(h)&&getNodeName(h)!=="body"),$=null;const it=getComputedStyle$2(e).position==="fixed";let at=it?getParentNode(e):e;for(;isElement(at)&&!isLastTraversableNode(at);){const h=getComputedStyle$2(at),dt=isContainingBlock(at);!dt&&h.position==="fixed"&&($=null),(it?!dt&&!$:!dt&&h.position==="static"&&!!$&&absoluteOrFixed.has($.position)||isOverflowElement(at)&&!dt&&hasFixedPositionAncestor(e,at))?b=b.filter(xt=>xt!==at):$=h,at=getParentNode(at)}return i.set(e,b),b}function getClippingRect(e){let{element:i,boundary:c,rootBoundary:b,strategy:$}=e;const at=[...c==="clippingAncestors"?isTopLayer(i)?[]:getClippingElementAncestors(i,this._c):[].concat(c),b],h=at[0],dt=at.reduce((ft,xt)=>{const Ct=getClientRectFromClippingAncestor(i,xt,$);return ft.top=max(Ct.top,ft.top),ft.right=min(Ct.right,ft.right),ft.bottom=min(Ct.bottom,ft.bottom),ft.left=max(Ct.left,ft.left),ft},getClientRectFromClippingAncestor(i,h,$));return{width:dt.right-dt.left,height:dt.bottom-dt.top,x:dt.left,y:dt.top}}function getDimensions(e){const{width:i,height:c}=getCssDimensions(e);return{width:i,height:c}}function getRectRelativeToOffsetParent(e,i,c){const b=isHTMLElement(i),$=getDocumentElement(i),it=c==="fixed",at=getBoundingClientRect(e,!0,it,i);let h={scrollLeft:0,scrollTop:0};const dt=createCoords(0);function ft(){dt.x=getWindowScrollBarX($)}if(b||!b&&!it)if((getNodeName(i)!=="body"||isOverflowElement($))&&(h=getNodeScroll(i)),b){const kt=getBoundingClientRect(i,!0,it,i);dt.x=kt.x+i.clientLeft,dt.y=kt.y+i.clientTop}else $&&ft();it&&!b&&$&&ft();const xt=$&&!b&&!it?getHTMLOffset($,h):createCoords(0),Ct=at.left+h.scrollLeft-dt.x-xt.x,bt=at.top+h.scrollTop-dt.y-xt.y;return{x:Ct,y:bt,width:at.width,height:at.height}}function isStaticPositioned(e){return getComputedStyle$2(e).position==="static"}function getTrueOffsetParent(e,i){if(!isHTMLElement(e)||getComputedStyle$2(e).position==="fixed")return null;if(i)return i(e);let c=e.offsetParent;return getDocumentElement(e)===c&&(c=c.ownerDocument.body),c}function getOffsetParent(e,i){const c=getWindow(e);if(isTopLayer(e))return c;if(!isHTMLElement(e)){let $=getParentNode(e);for(;$&&!isLastTraversableNode($);){if(isElement($)&&!isStaticPositioned($))return $;$=getParentNode($)}return c}let b=getTrueOffsetParent(e,i);for(;b&&isTableElement(b)&&isStaticPositioned(b);)b=getTrueOffsetParent(b,i);return b&&isLastTraversableNode(b)&&isStaticPositioned(b)&&!isContainingBlock(b)?c:b||getContainingBlock(e)||c}const getElementRects=async function(e){const i=this.getOffsetParent||getOffsetParent,c=this.getDimensions,b=await c(e.floating);return{reference:getRectRelativeToOffsetParent(e.reference,await i(e.floating),e.strategy),floating:{x:0,y:0,width:b.width,height:b.height}}};function isRTL(e){return getComputedStyle$2(e).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function rectsAreEqual(e,i){return e.x===i.x&&e.y===i.y&&e.width===i.width&&e.height===i.height}function observeMove(e,i){let c=null,b;const $=getDocumentElement(e);function it(){var h;clearTimeout(b),(h=c)==null||h.disconnect(),c=null}function at(h,dt){h===void 0&&(h=!1),dt===void 0&&(dt=1),it();const ft=e.getBoundingClientRect(),{left:xt,top:Ct,width:bt,height:kt}=ft;if(h||i(),!bt||!kt)return;const Dt=floor(Ct),At=floor($.clientWidth-(xt+bt)),Bt=floor($.clientHeight-(Ct+kt)),Tt=floor(xt),St={rootMargin:-Dt+"px "+-At+"px "+-Bt+"px "+-Tt+"px",threshold:max(0,min(1,dt))||1};let jt=!0;function Ht(Kt){const ir=Kt[0].intersectionRatio;if(ir!==dt){if(!jt)return at();ir?at(!1,ir):b=setTimeout(()=>{at(!1,1e-7)},1e3)}ir===1&&!rectsAreEqual(ft,e.getBoundingClientRect())&&at(),jt=!1}try{c=new IntersectionObserver(Ht,{...St,root:$.ownerDocument})}catch{c=new IntersectionObserver(Ht,St)}c.observe(e)}return at(!0),it}function autoUpdate(e,i,c,b){b===void 0&&(b={});const{ancestorScroll:$=!0,ancestorResize:it=!0,elementResize:at=typeof ResizeObserver=="function",layoutShift:h=typeof IntersectionObserver=="function",animationFrame:dt=!1}=b,ft=unwrapElement(e),xt=$||it?[...ft?getOverflowAncestors(ft):[],...getOverflowAncestors(i)]:[];xt.forEach(Tt=>{$&&Tt.addEventListener("scroll",c,{passive:!0}),it&&Tt.addEventListener("resize",c)});const Ct=ft&&h?observeMove(ft,c):null;let bt=-1,kt=null;at&&(kt=new ResizeObserver(Tt=>{let[It]=Tt;It&&It.target===ft&&kt&&(kt.unobserve(i),cancelAnimationFrame(bt),bt=requestAnimationFrame(()=>{var St;(St=kt)==null||St.observe(i)})),c()}),ft&&!dt&&kt.observe(ft),kt.observe(i));let Dt,At=dt?getBoundingClientRect(e):null;dt&&Bt();function Bt(){const Tt=getBoundingClientRect(e);At&&!rectsAreEqual(At,Tt)&&c(),At=Tt,Dt=requestAnimationFrame(Bt)}return c(),()=>{var Tt;xt.forEach(It=>{$&&It.removeEventListener("scroll",c),it&&It.removeEventListener("resize",c)}),Ct==null||Ct(),(Tt=kt)==null||Tt.disconnect(),kt=null,dt&&cancelAnimationFrame(Dt)}}const offset$1=offset$2,shift$1=shift$2,flip$1=flip$2,size$1=size$2,hide$1=hide$2,arrow$2=arrow$3,limitShift$1=limitShift$2,computePosition=(e,i,c)=>{const b=new Map,$={platform,...c},it={...$.platform,_c:b};return computePosition$1(e,i,{...$,platform:it})};var isClient=typeof document<"u",noop$1=function(){},index$1=isClient?reactExports.useLayoutEffect:noop$1;function deepEqual(e,i){if(e===i)return!0;if(typeof e!=typeof i)return!1;if(typeof e=="function"&&e.toString()===i.toString())return!0;let c,b,$;if(e&&i&&typeof e=="object"){if(Array.isArray(e)){if(c=e.length,c!==i.length)return!1;for(b=c;b--!==0;)if(!deepEqual(e[b],i[b]))return!1;return!0}if($=Object.keys(e),c=$.length,c!==Object.keys(i).length)return!1;for(b=c;b--!==0;)if(!{}.hasOwnProperty.call(i,$[b]))return!1;for(b=c;b--!==0;){const it=$[b];if(!(it==="_owner"&&e.$$typeof)&&!deepEqual(e[it],i[it]))return!1}return!0}return e!==e&&i!==i}function getDPR(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function roundByDPR(e,i){const c=getDPR(e);return Math.round(i*c)/c}function useLatestRef(e){const i=reactExports.useRef(e);return index$1(()=>{i.current=e}),i}function useFloating(e){e===void 0&&(e={});const{placement:i="bottom",strategy:c="absolute",middleware:b=[],platform:$,elements:{reference:it,floating:at}={},transform:h=!0,whileElementsMounted:dt,open:ft}=e,[xt,Ct]=reactExports.useState({x:0,y:0,strategy:c,placement:i,middlewareData:{},isPositioned:!1}),[bt,kt]=reactExports.useState(b);deepEqual(bt,b)||kt(b);const[Dt,At]=reactExports.useState(null),[Bt,Tt]=reactExports.useState(null),It=reactExports.useCallback(Ut=>{Ut!==Kt.current&&(Kt.current=Ut,At(Ut))},[]),St=reactExports.useCallback(Ut=>{Ut!==ir.current&&(ir.current=Ut,Tt(Ut))},[]),jt=it||Dt,Ht=at||Bt,Kt=reactExports.useRef(null),ir=reactExports.useRef(null),nr=reactExports.useRef(xt),kr=dt!=null,br=useLatestRef(dt),Sr=useLatestRef($),$r=useLatestRef(ft),rn=reactExports.useCallback(()=>{if(!Kt.current||!ir.current)return;const Ut={placement:i,strategy:c,middleware:bt};Sr.current&&(Ut.platform=Sr.current),computePosition(Kt.current,ir.current,Ut).then(Jt=>{const Or={...Jt,isPositioned:$r.current!==!1};Zr.current&&!deepEqual(nr.current,Or)&&(nr.current=Or,reactDomExports.flushSync(()=>{Ct(Or)}))})},[bt,i,c,Sr,$r]);index$1(()=>{ft===!1&&nr.current.isPositioned&&(nr.current.isPositioned=!1,Ct(Ut=>({...Ut,isPositioned:!1})))},[ft]);const Zr=reactExports.useRef(!1);index$1(()=>(Zr.current=!0,()=>{Zr.current=!1}),[]),index$1(()=>{if(jt&&(Kt.current=jt),Ht&&(ir.current=Ht),jt&&Ht){if(br.current)return br.current(jt,Ht,rn);rn()}},[jt,Ht,rn,br,kr]);const Kr=reactExports.useMemo(()=>({reference:Kt,floating:ir,setReference:It,setFloating:St}),[It,St]),Xt=reactExports.useMemo(()=>({reference:jt,floating:Ht}),[jt,Ht]),mr=reactExports.useMemo(()=>{const Ut={position:c,left:0,top:0};if(!Xt.floating)return Ut;const Jt=roundByDPR(Xt.floating,xt.x),Or=roundByDPR(Xt.floating,xt.y);return h?{...Ut,transform:"translate("+Jt+"px, "+Or+"px)",...getDPR(Xt.floating)>=1.5&&{willChange:"transform"}}:{position:c,left:Jt,top:Or}},[c,h,Xt.floating,xt.x,xt.y]);return reactExports.useMemo(()=>({...xt,update:rn,refs:Kr,elements:Xt,floatingStyles:mr}),[xt,rn,Kr,Xt,mr])}const arrow$1=e=>{function i(c){return{}.hasOwnProperty.call(c,"current")}return{name:"arrow",options:e,fn(c){const{element:b,padding:$}=typeof e=="function"?e(c):e;return b&&i(b)?b.current!=null?arrow$2({element:b.current,padding:$}).fn(c):{}:b?arrow$2({element:b,padding:$}).fn(c):{}}}},offset=(e,i)=>({...offset$1(e),options:[e,i]}),shift=(e,i)=>({...shift$1(e),options:[e,i]}),limitShift=(e,i)=>({...limitShift$1(e),options:[e,i]}),flip=(e,i)=>({...flip$1(e),options:[e,i]}),size=(e,i)=>({...size$1(e),options:[e,i]}),hide=(e,i)=>({...hide$1(e),options:[e,i]}),arrow=(e,i)=>({...arrow$1(e),options:[e,i]});var NAME="Arrow",Arrow$1=reactExports.forwardRef((e,i)=>{const{children:c,width:b=10,height:$=5,...it}=e;return jsxRuntimeExports.jsx(Primitive.svg,{...it,ref:i,width:b,height:$,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?c:jsxRuntimeExports.jsx("polygon",{points:"0,0 30,0 15,10"})})});Arrow$1.displayName=NAME;var Root$1=Arrow$1;function useSize(e){const[i,c]=reactExports.useState(void 0);return useLayoutEffect2(()=>{if(e){c({width:e.offsetWidth,height:e.offsetHeight});const b=new ResizeObserver($=>{if(!Array.isArray($)||!$.length)return;const it=$[0];let at,h;if("borderBoxSize"in it){const dt=it.borderBoxSize,ft=Array.isArray(dt)?dt[0]:dt;at=ft.inlineSize,h=ft.blockSize}else at=e.offsetWidth,h=e.offsetHeight;c({width:at,height:h})});return b.observe(e,{box:"border-box"}),()=>b.unobserve(e)}else c(void 0)},[e]),i}var POPPER_NAME="Popper",[createPopperContext,createPopperScope]=createContextScope(POPPER_NAME),[PopperProvider,usePopperContext]=createPopperContext(POPPER_NAME),ANCHOR_NAME="PopperAnchor",PopperAnchor=reactExports.forwardRef((e,i)=>{const{__scopePopper:c,virtualRef:b,...$}=e,it=usePopperContext(ANCHOR_NAME,c),at=reactExports.useRef(null),h=useComposedRefs(i,at),dt=reactExports.useRef(null);return reactExports.useEffect(()=>{const ft=dt.current;dt.current=(b==null?void 0:b.current)||at.current,ft!==dt.current&&it.onAnchorChange(dt.current)}),b?null:jsxRuntimeExports.jsx(Primitive.div,{...$,ref:h})});PopperAnchor.displayName=ANCHOR_NAME;var CONTENT_NAME$2="PopperContent",[PopperContentProvider,useContentContext]=createPopperContext(CONTENT_NAME$2),PopperContent=reactExports.forwardRef((e,i)=>{var Ls,$s,vo,Vs,bo,Po;const{__scopePopper:c,side:b="bottom",sideOffset:$=0,align:it="center",alignOffset:at=0,arrowPadding:h=0,avoidCollisions:dt=!0,collisionBoundary:ft=[],collisionPadding:xt=0,sticky:Ct="partial",hideWhenDetached:bt=!1,updatePositionStrategy:kt="optimized",onPlaced:Dt,...At}=e,Bt=usePopperContext(CONTENT_NAME$2,c),[Tt,It]=reactExports.useState(null),St=useComposedRefs(i,ws=>It(ws)),[jt,Ht]=reactExports.useState(null),Kt=useSize(jt),ir=(Kt==null?void 0:Kt.width)??0,nr=(Kt==null?void 0:Kt.height)??0,kr=b+(it!=="center"?"-"+it:""),br=typeof xt=="number"?xt:{top:0,right:0,bottom:0,left:0,...xt},Sr=Array.isArray(ft)?ft:[ft],$r=Sr.length>0,rn={padding:br,boundary:Sr.filter(isNotNull$1),altBoundary:$r},{refs:Zr,floatingStyles:Kr,placement:Xt,isPositioned:mr,middlewareData:Ut}=useFloating({strategy:"fixed",placement:kr,whileElementsMounted:(...ws)=>autoUpdate(...ws,{animationFrame:kt==="always"}),elements:{reference:Bt.anchor},middleware:[offset({mainAxis:$+nr,alignmentAxis:at}),dt&&shift({mainAxis:!0,crossAxis:!1,limiter:Ct==="partial"?limitShift():void 0,...rn}),dt&&flip({...rn}),size({...rn,apply:({elements:ws,rects:Jn,availableWidth:Hs,availableHeight:El})=>{const{width:Xo,height:_l}=Jn.reference,Io=ws.floating.style;Io.setProperty("--radix-popper-available-width",`${Hs}px`),Io.setProperty("--radix-popper-available-height",`${El}px`),Io.setProperty("--radix-popper-anchor-width",`${Xo}px`),Io.setProperty("--radix-popper-anchor-height",`${_l}px`)}}),jt&&arrow({element:jt,padding:h}),transformOrigin({arrowWidth:ir,arrowHeight:nr}),bt&&hide({strategy:"referenceHidden",...rn})]}),[Jt,Or]=getSideAndAlignFromPlacement(Xt),Cr=useCallbackRef$1(Dt);useLayoutEffect2(()=>{mr&&(Cr==null||Cr())},[mr,Cr]);const pn=(Ls=Ut.arrow)==null?void 0:Ls.x,On=($s=Ut.arrow)==null?void 0:$s.y,Zn=((vo=Ut.arrow)==null?void 0:vo.centerOffset)!==0,[As,ss]=reactExports.useState();return useLayoutEffect2(()=>{Tt&&ss(window.getComputedStyle(Tt).zIndex)},[Tt]),jsxRuntimeExports.jsx("div",{ref:Zr.setFloating,"data-radix-popper-content-wrapper":"",style:{...Kr,transform:mr?Kr.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:As,"--radix-popper-transform-origin":[(Vs=Ut.transformOrigin)==null?void 0:Vs.x,(bo=Ut.transformOrigin)==null?void 0:bo.y].join(" "),...((Po=Ut.hide)==null?void 0:Po.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:jsxRuntimeExports.jsx(PopperContentProvider,{scope:c,placedSide:Jt,onArrowChange:Ht,arrowX:pn,arrowY:On,shouldHideArrow:Zn,children:jsxRuntimeExports.jsx(Primitive.div,{"data-side":Jt,"data-align":Or,...At,ref:St,style:{...At.style,animation:mr?void 0:"none"}})})})});PopperContent.displayName=CONTENT_NAME$2;var ARROW_NAME$1="PopperArrow",OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},PopperArrow=reactExports.forwardRef(function(i,c){const{__scopePopper:b,...$}=i,it=useContentContext(ARROW_NAME$1,b),at=OPPOSITE_SIDE[it.placedSide];return jsxRuntimeExports.jsx("span",{ref:it.onArrowChange,style:{position:"absolute",left:it.arrowX,top:it.arrowY,[at]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[it.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[it.placedSide],visibility:it.shouldHideArrow?"hidden":void 0},children:jsxRuntimeExports.jsx(Root$1,{...$,ref:c,style:{...$.style,display:"block"}})})});PopperArrow.displayName=ARROW_NAME$1;function isNotNull$1(e){return e!==null}var transformOrigin=e=>({name:"transformOrigin",options:e,fn(i){var Bt,Tt,It;const{placement:c,rects:b,middlewareData:$}=i,at=((Bt=$.arrow)==null?void 0:Bt.centerOffset)!==0,h=at?0:e.arrowWidth,dt=at?0:e.arrowHeight,[ft,xt]=getSideAndAlignFromPlacement(c),Ct={start:"0%",center:"50%",end:"100%"}[xt],bt=(((Tt=$.arrow)==null?void 0:Tt.x)??0)+h/2,kt=(((It=$.arrow)==null?void 0:It.y)??0)+dt/2;let Dt="",At="";return ft==="bottom"?(Dt=at?Ct:`${bt}px`,At=`${-dt}px`):ft==="top"?(Dt=at?Ct:`${bt}px`,At=`${b.floating.height+dt}px`):ft==="right"?(Dt=`${-dt}px`,At=at?Ct:`${kt}px`):ft==="left"&&(Dt=`${b.floating.width+dt}px`,At=at?Ct:`${kt}px`),{data:{x:Dt,y:At}}}});function getSideAndAlignFromPlacement(e){const[i,c="center"]=e.split("-");return[i,c]}var Anchor=PopperAnchor,Content$1=PopperContent,Arrow=PopperArrow,[createTooltipContext,createTooltipScope]=createContextScope("Tooltip",[createPopperScope]),usePopperScope=createPopperScope(),PROVIDER_NAME="TooltipProvider",DEFAULT_DELAY_DURATION=700,TOOLTIP_OPEN="tooltip.open",[TooltipProviderContextProvider,useTooltipProviderContext]=createTooltipContext(PROVIDER_NAME),TooltipProvider$1=e=>{const{__scopeTooltip:i,delayDuration:c=DEFAULT_DELAY_DURATION,skipDelayDuration:b=300,disableHoverableContent:$=!1,children:it}=e,at=reactExports.useRef(!0),h=reactExports.useRef(!1),dt=reactExports.useRef(0);return reactExports.useEffect(()=>{const ft=dt.current;return()=>window.clearTimeout(ft)},[]),jsxRuntimeExports.jsx(TooltipProviderContextProvider,{scope:i,isOpenDelayedRef:at,delayDuration:c,onOpen:reactExports.useCallback(()=>{window.clearTimeout(dt.current),at.current=!1},[]),onClose:reactExports.useCallback(()=>{window.clearTimeout(dt.current),dt.current=window.setTimeout(()=>at.current=!0,b)},[b]),isPointerInTransitRef:h,onPointerInTransitChange:reactExports.useCallback(ft=>{h.current=ft},[]),disableHoverableContent:$,children:it})};TooltipProvider$1.displayName=PROVIDER_NAME;var TOOLTIP_NAME="Tooltip",[TooltipContextProvider,useTooltipContext]=createTooltipContext(TOOLTIP_NAME),TRIGGER_NAME$1="TooltipTrigger",TooltipTrigger=reactExports.forwardRef((e,i)=>{const{__scopeTooltip:c,...b}=e,$=useTooltipContext(TRIGGER_NAME$1,c),it=useTooltipProviderContext(TRIGGER_NAME$1,c),at=usePopperScope(c),h=reactExports.useRef(null),dt=useComposedRefs(i,h,$.onTriggerChange),ft=reactExports.useRef(!1),xt=reactExports.useRef(!1),Ct=reactExports.useCallback(()=>ft.current=!1,[]);return reactExports.useEffect(()=>()=>document.removeEventListener("pointerup",Ct),[Ct]),jsxRuntimeExports.jsx(Anchor,{asChild:!0,...at,children:jsxRuntimeExports.jsx(Primitive.button,{"aria-describedby":$.open?$.contentId:void 0,"data-state":$.stateAttribute,...b,ref:dt,onPointerMove:composeEventHandlers(e.onPointerMove,bt=>{bt.pointerType!=="touch"&&!xt.current&&!it.isPointerInTransitRef.current&&($.onTriggerEnter(),xt.current=!0)}),onPointerLeave:composeEventHandlers(e.onPointerLeave,()=>{$.onTriggerLeave(),xt.current=!1}),onPointerDown:composeEventHandlers(e.onPointerDown,()=>{$.open&&$.onClose(),ft.current=!0,document.addEventListener("pointerup",Ct,{once:!0})}),onFocus:composeEventHandlers(e.onFocus,()=>{ft.current||$.onOpen()}),onBlur:composeEventHandlers(e.onBlur,$.onClose),onClick:composeEventHandlers(e.onClick,$.onClose)})})});TooltipTrigger.displayName=TRIGGER_NAME$1;var PORTAL_NAME$1="TooltipPortal",[PortalProvider$1,usePortalContext$1]=createTooltipContext(PORTAL_NAME$1,{forceMount:void 0}),CONTENT_NAME$1="TooltipContent",TooltipContent$1=reactExports.forwardRef((e,i)=>{const c=usePortalContext$1(CONTENT_NAME$1,e.__scopeTooltip),{forceMount:b=c.forceMount,side:$="top",...it}=e,at=useTooltipContext(CONTENT_NAME$1,e.__scopeTooltip);return jsxRuntimeExports.jsx(Presence,{present:b||at.open,children:at.disableHoverableContent?jsxRuntimeExports.jsx(TooltipContentImpl,{side:$,...it,ref:i}):jsxRuntimeExports.jsx(TooltipContentHoverable,{side:$,...it,ref:i})})}),TooltipContentHoverable=reactExports.forwardRef((e,i)=>{const c=useTooltipContext(CONTENT_NAME$1,e.__scopeTooltip),b=useTooltipProviderContext(CONTENT_NAME$1,e.__scopeTooltip),$=reactExports.useRef(null),it=useComposedRefs(i,$),[at,h]=reactExports.useState(null),{trigger:dt,onClose:ft}=c,xt=$.current,{onPointerInTransitChange:Ct}=b,bt=reactExports.useCallback(()=>{h(null),Ct(!1)},[Ct]),kt=reactExports.useCallback((Dt,At)=>{const Bt=Dt.currentTarget,Tt={x:Dt.clientX,y:Dt.clientY},It=getExitSideFromRect(Tt,Bt.getBoundingClientRect()),St=getPaddedExitPoints(Tt,It),jt=getPointsFromRect(At.getBoundingClientRect()),Ht=getHull([...St,...jt]);h(Ht),Ct(!0)},[Ct]);return reactExports.useEffect(()=>()=>bt(),[bt]),reactExports.useEffect(()=>{if(dt&&xt){const Dt=Bt=>kt(Bt,xt),At=Bt=>kt(Bt,dt);return dt.addEventListener("pointerleave",Dt),xt.addEventListener("pointerleave",At),()=>{dt.removeEventListener("pointerleave",Dt),xt.removeEventListener("pointerleave",At)}}},[dt,xt,kt,bt]),reactExports.useEffect(()=>{if(at){const Dt=At=>{const Bt=At.target,Tt={x:At.clientX,y:At.clientY},It=(dt==null?void 0:dt.contains(Bt))||(xt==null?void 0:xt.contains(Bt)),St=!isPointInPolygon(Tt,at);It?bt():St&&(bt(),ft())};return document.addEventListener("pointermove",Dt),()=>document.removeEventListener("pointermove",Dt)}},[dt,xt,at,ft,bt]),jsxRuntimeExports.jsx(TooltipContentImpl,{...e,ref:it})}),[VisuallyHiddenContentContextProvider,useVisuallyHiddenContentContext]=createTooltipContext(TOOLTIP_NAME,{isInside:!1}),Slottable=createSlottable("TooltipContent"),TooltipContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeTooltip:c,children:b,"aria-label":$,onEscapeKeyDown:it,onPointerDownOutside:at,...h}=e,dt=useTooltipContext(CONTENT_NAME$1,c),ft=usePopperScope(c),{onClose:xt}=dt;return reactExports.useEffect(()=>(document.addEventListener(TOOLTIP_OPEN,xt),()=>document.removeEventListener(TOOLTIP_OPEN,xt)),[xt]),reactExports.useEffect(()=>{if(dt.trigger){const Ct=bt=>{const kt=bt.target;kt!=null&&kt.contains(dt.trigger)&&xt()};return window.addEventListener("scroll",Ct,{capture:!0}),()=>window.removeEventListener("scroll",Ct,{capture:!0})}},[dt.trigger,xt]),jsxRuntimeExports.jsx(DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:it,onPointerDownOutside:at,onFocusOutside:Ct=>Ct.preventDefault(),onDismiss:xt,children:jsxRuntimeExports.jsxs(Content$1,{"data-state":dt.stateAttribute,...ft,...h,ref:i,style:{...h.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[jsxRuntimeExports.jsx(Slottable,{children:b}),jsxRuntimeExports.jsx(VisuallyHiddenContentContextProvider,{scope:c,isInside:!0,children:jsxRuntimeExports.jsx(Root$2,{id:dt.contentId,role:"tooltip",children:$||b})})]})})});TooltipContent$1.displayName=CONTENT_NAME$1;var ARROW_NAME="TooltipArrow",TooltipArrow=reactExports.forwardRef((e,i)=>{const{__scopeTooltip:c,...b}=e,$=usePopperScope(c);return useVisuallyHiddenContentContext(ARROW_NAME,c).isInside?null:jsxRuntimeExports.jsx(Arrow,{...$,...b,ref:i})});TooltipArrow.displayName=ARROW_NAME;function getExitSideFromRect(e,i){const c=Math.abs(i.top-e.y),b=Math.abs(i.bottom-e.y),$=Math.abs(i.right-e.x),it=Math.abs(i.left-e.x);switch(Math.min(c,b,$,it)){case it:return"left";case $:return"right";case c:return"top";case b:return"bottom";default:throw new Error("unreachable")}}function getPaddedExitPoints(e,i,c=5){const b=[];switch(i){case"top":b.push({x:e.x-c,y:e.y+c},{x:e.x+c,y:e.y+c});break;case"bottom":b.push({x:e.x-c,y:e.y-c},{x:e.x+c,y:e.y-c});break;case"left":b.push({x:e.x+c,y:e.y-c},{x:e.x+c,y:e.y+c});break;case"right":b.push({x:e.x-c,y:e.y-c},{x:e.x-c,y:e.y+c});break}return b}function getPointsFromRect(e){const{top:i,right:c,bottom:b,left:$}=e;return[{x:$,y:i},{x:c,y:i},{x:c,y:b},{x:$,y:b}]}function isPointInPolygon(e,i){const{x:c,y:b}=e;let $=!1;for(let it=0,at=i.length-1;it<i.length;at=it++){const h=i[it],dt=i[at],ft=h.x,xt=h.y,Ct=dt.x,bt=dt.y;xt>b!=bt>b&&c<(Ct-ft)*(b-xt)/(bt-xt)+ft&&($=!$)}return $}function getHull(e){const i=e.slice();return i.sort((c,b)=>c.x<b.x?-1:c.x>b.x?1:c.y<b.y?-1:c.y>b.y?1:0),getHullPresorted(i)}function getHullPresorted(e){if(e.length<=1)return e.slice();const i=[];for(let b=0;b<e.length;b++){const $=e[b];for(;i.length>=2;){const it=i[i.length-1],at=i[i.length-2];if((it.x-at.x)*($.y-at.y)>=(it.y-at.y)*($.x-at.x))i.pop();else break}i.push($)}i.pop();const c=[];for(let b=e.length-1;b>=0;b--){const $=e[b];for(;c.length>=2;){const it=c[c.length-1],at=c[c.length-2];if((it.x-at.x)*($.y-at.y)>=(it.y-at.y)*($.x-at.x))c.pop();else break}c.push($)}return c.pop(),i.length===1&&c.length===1&&i[0].x===c[0].x&&i[0].y===c[0].y?i:i.concat(c)}var Provider=TooltipProvider$1,Content2=TooltipContent$1;const TooltipProvider=Provider,TooltipContent=reactExports.forwardRef(({className:e,sideOffset:i=4,...c},b)=>jsxRuntimeExports.jsx(Content2,{ref:b,sideOffset:i,className:cn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",e),...c}));TooltipContent.displayName=Content2.displayName;function getLocalUser(){try{const e=typeof window<"u"?localStorage.getItem("neuro_user"):null;return e?JSON.parse(e):null}catch{return null}}function useAuth(){const{data:e}=useQuery({queryKey:["local_auth_user"],retry:!1,staleTime:1/0,refetchOnWindowFocus:!1,queryFn:async()=>getLocalUser()});return{user:e??null,isLoading:!1,isAuthenticated:!!e}}const Card=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx("div",{ref:c,className:cn("rounded-lg border bg-card text-card-foreground shadow-sm",e),...i}));Card.displayName="Card";const CardHeader=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx("div",{ref:c,className:cn("flex flex-col space-y-1.5 p-6",e),...i}));CardHeader.displayName="CardHeader";const CardTitle=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx("div",{ref:c,className:cn("text-2xl font-semibold leading-none tracking-tight",e),...i}));CardTitle.displayName="CardTitle";const CardDescription=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx("div",{ref:c,className:cn("text-sm text-muted-foreground",e),...i}));CardDescription.displayName="CardDescription";const CardContent=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx("div",{ref:c,className:cn("p-6 pt-0",e),...i}));CardContent.displayName="CardContent";const CardFooter=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx("div",{ref:c,className:cn("flex items-center p-6 pt-0",e),...i}));CardFooter.displayName="CardFooter";function NotFound(){return jsxRuntimeExports.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:jsxRuntimeExports.jsx(Card,{className:"w-full max-w-md mx-4",children:jsxRuntimeExports.jsxs(CardContent,{className:"pt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex mb-4 gap-2",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"h-8 w-8 text-red-500"}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),jsxRuntimeExports.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}const buttonVariants=cva("inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-semibold transition-all active:scale-[0.98] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-gray-900 shadow-md active:shadow-sm rounded-2xl",destructive:"bg-red-500 text-white shadow-md active:shadow-sm rounded-2xl",outline:"border-2 border-gray-200 bg-white text-gray-900 active:bg-gray-50 rounded-2xl",secondary:"bg-gray-100 text-gray-900 active:bg-gray-200 rounded-2xl",ghost:"text-gray-700 active:bg-gray-100 rounded-2xl",link:"text-primary underline-offset-4 active:opacity-70"},size:{default:"h-12 px-6 py-3",sm:"h-10 px-4 py-2 rounded-xl",lg:"h-14 px-8 py-4 text-base rounded-2xl",icon:"h-12 w-12 rounded-2xl"}},defaultVariants:{variant:"default",size:"default"}}),Button=reactExports.forwardRef(({className:e,variant:i,size:c,asChild:b=!1,...$},it)=>{const at=b?Slot$1:"button";return jsxRuntimeExports.jsx(at,{className:cn(buttonVariants({variant:i,size:c,className:e})),ref:it,...$})});Button.displayName="Button";const Input=reactExports.forwardRef(({className:e,type:i,...c},b)=>jsxRuntimeExports.jsx("input",{type:i,className:cn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:b,...c}));Input.displayName="Input";const welcomeImg="/assets/Image-4dfc8e27.png";function Landing(){const[e,i]=reactExports.useState(""),[c,b]=reactExports.useState(""),[$,it]=reactExports.useState(!1),{toast:at}=useToast(),h=async dt=>{if(dt.preventDefault(),!e||!c){at({title:"Error",description:"Please enter email and password",variant:"destructive"});return}it(!0);try{const ft={id:`local-${Date.now()}`,email:e,firstName:e.includes("@")?e.split("@")[0]:"User",lastName:"",profileImageUrl:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};localStorage.setItem("neuro_user",JSON.stringify(ft)),at({title:"Login Successful",description:"Welcome to Neuropad!"}),setTimeout(()=>{window.location.href="/"},800)}catch{at({title:"Error",description:"Failed to save local session",variant:"destructive"}),it(!1)}};return jsxRuntimeExports.jsx("div",{className:"min-h-screen relative flex flex-col items-center justify-center px-6 neuropad-bg",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md",children:[jsxRuntimeExports.jsxs("div",{className:"text-center mb-8 sm:mb-12",children:[jsxRuntimeExports.jsx("div",{className:"w-40 h-40 sm:w-64 sm:h-64 mx-auto flex items-center justify-center mb-4 sm:mb-6",children:jsxRuntimeExports.jsx("img",{src:welcomeImg,alt:"Welcome",className:"w-full h-full object-contain"})}),jsxRuntimeExports.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Welcome to NeuroPad"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mt-2 text-sm sm:text-base",children:"Your personal health monitoring companion for diabetic foot care"})]}),jsxRuntimeExports.jsxs("form",{onSubmit:h,className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{type:"email",placeholder:"Email",value:e,onChange:dt=>i(dt.target.value),className:"w-full px-5 py-3 sm:px-6 sm:py-4 rounded-full bg-white neuropad-text-secondary placeholder:text-text-secondary focus:outline-none focus:ring-2 focus:ring-primary","data-testid":"input-email"}),jsxRuntimeExports.jsx(Input,{type:"password",placeholder:"Password",value:c,onChange:dt=>b(dt.target.value),className:"w-full px-5 py-3 sm:px-6 sm:py-4 rounded-full bg-white neuropad-text-secondary placeholder:text-text-secondary focus:outline-none focus:ring-2 focus:ring-primary","data-testid":"input-password"}),jsxRuntimeExports.jsx(Button,{type:"submit",disabled:$,className:"w-full py-3 sm:py-4 rounded-full neuropad-primary neuropad-text-primary font-semibold hover:neuropad-primary-dark transition-colors","data-testid":"button-login",children:$?"Loading...":"Continue"})]}),jsxRuntimeExports.jsxs("div",{className:"mt-6 sm:mt-8 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary",children:"AI-powered neuropathy health monitoring system"}),jsxRuntimeExports.jsx("p",{className:"text-xs neuropad-text-secondary mt-1 sm:mt-2",children:"Use any email and password to login"})]})]})})}const LayoutGroupContext=reactExports.createContext({});function useConstant(e){const i=reactExports.useRef(null);return i.current===null&&(i.current=e()),i.current}const PresenceContext=reactExports.createContext(null),MotionConfigContext=reactExports.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function usePresence(e=!0){const i=reactExports.useContext(PresenceContext);if(i===null)return[!0,null];const{isPresent:c,onExitComplete:b,register:$}=i,it=reactExports.useId();reactExports.useEffect(()=>{e&&$(it)},[e]);const at=reactExports.useCallback(()=>e&&b&&b(it),[it,b,e]);return!c&&b?[!1,at]:[!0]}const isBrowser=typeof window<"u",useIsomorphicLayoutEffect$1=isBrowser?reactExports.useLayoutEffect:reactExports.useEffect,noop=e=>e;let invariant=noop;function memo(e){let i;return()=>(i===void 0&&(i=e()),i)}const progress=(e,i,c)=>{const b=i-e;return b===0?1:(c-e)/b},secondsToMilliseconds=e=>e*1e3,millisecondsToSeconds=e=>e/1e3,MotionGlobalConfig={skipAnimations:!1,useManualTiming:!1};function createRenderStep(e){let i=new Set,c=new Set,b=!1,$=!1;const it=new WeakSet;let at={delta:0,timestamp:0,isProcessing:!1};function h(ft){it.has(ft)&&(dt.schedule(ft),e()),ft(at)}const dt={schedule:(ft,xt=!1,Ct=!1)=>{const kt=Ct&&b?i:c;return xt&&it.add(ft),kt.has(ft)||kt.add(ft),ft},cancel:ft=>{c.delete(ft),it.delete(ft)},process:ft=>{if(at=ft,b){$=!0;return}b=!0,[i,c]=[c,i],i.forEach(h),i.clear(),b=!1,$&&($=!1,dt.process(ft))}};return dt}const stepsOrder=["read","resolveKeyframes","update","preRender","render","postRender"],maxElapsed=40;function createRenderBatcher(e,i){let c=!1,b=!0;const $={delta:0,timestamp:0,isProcessing:!1},it=()=>c=!0,at=stepsOrder.reduce((Tt,It)=>(Tt[It]=createRenderStep(it),Tt),{}),{read:h,resolveKeyframes:dt,update:ft,preRender:xt,render:Ct,postRender:bt}=at,kt=()=>{const Tt=performance.now();c=!1,$.delta=b?1e3/60:Math.max(Math.min(Tt-$.timestamp,maxElapsed),1),$.timestamp=Tt,$.isProcessing=!0,h.process($),dt.process($),ft.process($),xt.process($),Ct.process($),bt.process($),$.isProcessing=!1,c&&i&&(b=!1,e(kt))},Dt=()=>{c=!0,b=!0,$.isProcessing||e(kt)};return{schedule:stepsOrder.reduce((Tt,It)=>{const St=at[It];return Tt[It]=(jt,Ht=!1,Kt=!1)=>(c||Dt(),St.schedule(jt,Ht,Kt)),Tt},{}),cancel:Tt=>{for(let It=0;It<stepsOrder.length;It++)at[stepsOrder[It]].cancel(Tt)},state:$,steps:at}}const{schedule:frame,cancel:cancelFrame,state:frameData,steps:frameSteps}=createRenderBatcher(typeof requestAnimationFrame<"u"?requestAnimationFrame:noop,!0),LazyContext=reactExports.createContext({strict:!1}),featureProps={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},featureDefinitions={};for(const e in featureProps)featureDefinitions[e]={isEnabled:i=>featureProps[e].some(c=>!!i[c])};function loadFeatures(e){for(const i in e)featureDefinitions[i]={...featureDefinitions[i],...e[i]}}const validMotionProps=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function isValidMotionProp(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||validMotionProps.has(e)}let shouldForward=e=>!isValidMotionProp(e);function loadExternalIsValidProp(e){e&&(shouldForward=i=>i.startsWith("on")?!isValidMotionProp(i):e(i))}try{loadExternalIsValidProp(require("@emotion/is-prop-valid").default)}catch{}function filterProps(e,i,c){const b={};for(const $ in e)$==="values"&&typeof e.values=="object"||(shouldForward($)||c===!0&&isValidMotionProp($)||!i&&!isValidMotionProp($)||e.draggable&&$.startsWith("onDrag"))&&(b[$]=e[$]);return b}function createDOMMotionComponentProxy(e){if(typeof Proxy>"u")return e;const i=new Map,c=(...b)=>e(...b);return new Proxy(c,{get:(b,$)=>$==="create"?e:(i.has($)||i.set($,e($)),i.get($))})}const MotionContext=reactExports.createContext({});function isVariantLabel(e){return typeof e=="string"||Array.isArray(e)}function isAnimationControls(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const variantPriorityOrder=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],variantProps=["initial",...variantPriorityOrder];function isControllingVariants(e){return isAnimationControls(e.animate)||variantProps.some(i=>isVariantLabel(e[i]))}function isVariantNode(e){return!!(isControllingVariants(e)||e.variants)}function getCurrentTreeVariants(e,i){if(isControllingVariants(e)){const{initial:c,animate:b}=e;return{initial:c===!1||isVariantLabel(c)?c:void 0,animate:isVariantLabel(b)?b:void 0}}return e.inherit!==!1?i:{}}function useCreateMotionContext(e){const{initial:i,animate:c}=getCurrentTreeVariants(e,reactExports.useContext(MotionContext));return reactExports.useMemo(()=>({initial:i,animate:c}),[variantLabelsAsDependency(i),variantLabelsAsDependency(c)])}function variantLabelsAsDependency(e){return Array.isArray(e)?e.join(" "):e}const motionComponentSymbol=Symbol.for("motionComponentSymbol");function isRefObject(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function useMotionRef(e,i,c){return reactExports.useCallback(b=>{b&&e.onMount&&e.onMount(b),i&&(b?i.mount(b):i.unmount()),c&&(typeof c=="function"?c(b):isRefObject(c)&&(c.current=b))},[i])}const camelToDash=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),optimizedAppearDataId="framerAppearId",optimizedAppearDataAttribute="data-"+camelToDash(optimizedAppearDataId),{schedule:microtask,cancel:cancelMicrotask}=createRenderBatcher(queueMicrotask,!1),SwitchLayoutGroupContext=reactExports.createContext({});function useVisualElement(e,i,c,b,$){var it,at;const{visualElement:h}=reactExports.useContext(MotionContext),dt=reactExports.useContext(LazyContext),ft=reactExports.useContext(PresenceContext),xt=reactExports.useContext(MotionConfigContext).reducedMotion,Ct=reactExports.useRef(null);b=b||dt.renderer,!Ct.current&&b&&(Ct.current=b(e,{visualState:i,parent:h,props:c,presenceContext:ft,blockInitialAnimation:ft?ft.initial===!1:!1,reducedMotionConfig:xt}));const bt=Ct.current,kt=reactExports.useContext(SwitchLayoutGroupContext);bt&&!bt.projection&&$&&(bt.type==="html"||bt.type==="svg")&&createProjectionNode$1(Ct.current,c,$,kt);const Dt=reactExports.useRef(!1);reactExports.useInsertionEffect(()=>{bt&&Dt.current&&bt.update(c,ft)});const At=c[optimizedAppearDataAttribute],Bt=reactExports.useRef(!!At&&!(!((it=window.MotionHandoffIsComplete)===null||it===void 0)&&it.call(window,At))&&((at=window.MotionHasOptimisedAnimation)===null||at===void 0?void 0:at.call(window,At)));return useIsomorphicLayoutEffect$1(()=>{bt&&(Dt.current=!0,window.MotionIsMounted=!0,bt.updateFeatures(),microtask.render(bt.render),Bt.current&&bt.animationState&&bt.animationState.animateChanges())}),reactExports.useEffect(()=>{bt&&(!Bt.current&&bt.animationState&&bt.animationState.animateChanges(),Bt.current&&(queueMicrotask(()=>{var Tt;(Tt=window.MotionHandoffMarkAsComplete)===null||Tt===void 0||Tt.call(window,At)}),Bt.current=!1))}),bt}function createProjectionNode$1(e,i,c,b){const{layoutId:$,layout:it,drag:at,dragConstraints:h,layoutScroll:dt,layoutRoot:ft}=i;e.projection=new c(e.latestValues,i["data-framer-portal-id"]?void 0:getClosestProjectingNode(e.parent)),e.projection.setOptions({layoutId:$,layout:it,alwaysMeasureLayout:!!at||h&&isRefObject(h),visualElement:e,animationType:typeof it=="string"?it:"both",initialPromotionConfig:b,layoutScroll:dt,layoutRoot:ft})}function getClosestProjectingNode(e){if(e)return e.options.allowProjection!==!1?e.projection:getClosestProjectingNode(e.parent)}function createRendererMotionComponent({preloadedFeatures:e,createVisualElement:i,useRender:c,useVisualState:b,Component:$}){var it,at;e&&loadFeatures(e);function h(ft,xt){let Ct;const bt={...reactExports.useContext(MotionConfigContext),...ft,layoutId:useLayoutId(ft)},{isStatic:kt}=bt,Dt=useCreateMotionContext(ft),At=b(ft,kt);if(!kt&&isBrowser){useStrictMode();const Bt=getProjectionFunctionality(bt);Ct=Bt.MeasureLayout,Dt.visualElement=useVisualElement($,At,bt,i,Bt.ProjectionNode)}return jsxRuntimeExports.jsxs(MotionContext.Provider,{value:Dt,children:[Ct&&Dt.visualElement?jsxRuntimeExports.jsx(Ct,{visualElement:Dt.visualElement,...bt}):null,c($,ft,useMotionRef(At,Dt.visualElement,xt),At,kt,Dt.visualElement)]})}h.displayName=`motion.${typeof $=="string"?$:`create(${(at=(it=$.displayName)!==null&&it!==void 0?it:$.name)!==null&&at!==void 0?at:""})`}`;const dt=reactExports.forwardRef(h);return dt[motionComponentSymbol]=$,dt}function useLayoutId({layoutId:e}){const i=reactExports.useContext(LayoutGroupContext).id;return i&&e!==void 0?i+"-"+e:e}function useStrictMode(e,i){reactExports.useContext(LazyContext).strict}function getProjectionFunctionality(e){const{drag:i,layout:c}=featureDefinitions;if(!i&&!c)return{};const b={...i,...c};return{MeasureLayout:i!=null&&i.isEnabled(e)||c!=null&&c.isEnabled(e)?b.MeasureLayout:void 0,ProjectionNode:b.ProjectionNode}}const lowercaseSVGElements=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function isSVGComponent(e){return typeof e!="string"||e.includes("-")?!1:!!(lowercaseSVGElements.indexOf(e)>-1||/[A-Z]/u.test(e))}function getValueState(e){const i=[{},{}];return e==null||e.values.forEach((c,b)=>{i[0][b]=c.get(),i[1][b]=c.getVelocity()}),i}function resolveVariantFromProps(e,i,c,b){if(typeof i=="function"){const[$,it]=getValueState(b);i=i(c!==void 0?c:e.custom,$,it)}if(typeof i=="string"&&(i=e.variants&&e.variants[i]),typeof i=="function"){const[$,it]=getValueState(b);i=i(c!==void 0?c:e.custom,$,it)}return i}const isKeyframesTarget=e=>Array.isArray(e),isCustomValue=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),resolveFinalValueInKeyframes=e=>isKeyframesTarget(e)?e[e.length-1]||0:e,isMotionValue=e=>!!(e&&e.getVelocity);function resolveMotionValue(e){const i=isMotionValue(e)?e.get():e;return isCustomValue(i)?i.toValue():i}function makeState({scrapeMotionValuesFromProps:e,createRenderState:i,onUpdate:c},b,$,it){const at={latestValues:makeLatestValues(b,$,it,e),renderState:i()};return c&&(at.onMount=h=>c({props:b,current:h,...at}),at.onUpdate=h=>c(h)),at}const makeUseVisualState=e=>(i,c)=>{const b=reactExports.useContext(MotionContext),$=reactExports.useContext(PresenceContext),it=()=>makeState(e,i,b,$);return c?it():useConstant(it)};function makeLatestValues(e,i,c,b){const $={},it=b(e,{});for(const bt in it)$[bt]=resolveMotionValue(it[bt]);let{initial:at,animate:h}=e;const dt=isControllingVariants(e),ft=isVariantNode(e);i&&ft&&!dt&&e.inherit!==!1&&(at===void 0&&(at=i.initial),h===void 0&&(h=i.animate));let xt=c?c.initial===!1:!1;xt=xt||at===!1;const Ct=xt?h:at;if(Ct&&typeof Ct!="boolean"&&!isAnimationControls(Ct)){const bt=Array.isArray(Ct)?Ct:[Ct];for(let kt=0;kt<bt.length;kt++){const Dt=resolveVariantFromProps(e,bt[kt]);if(Dt){const{transitionEnd:At,transition:Bt,...Tt}=Dt;for(const It in Tt){let St=Tt[It];if(Array.isArray(St)){const jt=xt?St.length-1:0;St=St[jt]}St!==null&&($[It]=St)}for(const It in At)$[It]=At[It]}}}return $}const transformPropOrder=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],transformProps=new Set(transformPropOrder),checkStringStartsWith=e=>i=>typeof i=="string"&&i.startsWith(e),isCSSVariableName=checkStringStartsWith("--"),startsAsVariableToken=checkStringStartsWith("var(--"),isCSSVariableToken=e=>startsAsVariableToken(e)?singleCssVariableRegex.test(e.split("/*")[0].trim()):!1,singleCssVariableRegex=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,getValueAsType=(e,i)=>i&&typeof e=="number"?i.transform(e):e,clamp=(e,i,c)=>c>i?i:c<e?e:c,number={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},alpha={...number,transform:e=>clamp(0,1,e)},scale={...number,default:1},createUnitType=e=>({test:i=>typeof i=="string"&&i.endsWith(e)&&i.split(" ").length===1,parse:parseFloat,transform:i=>`${i}${e}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),vh=createUnitType("vh"),vw=createUnitType("vw"),progressPercentage={...percent,parse:e=>percent.parse(e)/100,transform:e=>percent.transform(e*100)},browserNumberValueTypes={borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,radius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,top:px,right:px,bottom:px,left:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,backgroundPositionX:px,backgroundPositionY:px},transformValueTypes={rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px},int={...number,transform:Math.round},numberValueTypes={...browserNumberValueTypes,...transformValueTypes,zIndex:int,size:px,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int},translateAlias={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},numTransforms=transformPropOrder.length;function buildTransform(e,i,c){let b="",$=!0;for(let it=0;it<numTransforms;it++){const at=transformPropOrder[it],h=e[at];if(h===void 0)continue;let dt=!0;if(typeof h=="number"?dt=h===(at.startsWith("scale")?1:0):dt=parseFloat(h)===0,!dt||c){const ft=getValueAsType(h,numberValueTypes[at]);if(!dt){$=!1;const xt=translateAlias[at]||at;b+=`${xt}(${ft}) `}c&&(i[at]=ft)}}return b=b.trim(),c?b=c(i,$?"":b):$&&(b="none"),b}function buildHTMLStyles(e,i,c){const{style:b,vars:$,transformOrigin:it}=e;let at=!1,h=!1;for(const dt in i){const ft=i[dt];if(transformProps.has(dt)){at=!0;continue}else if(isCSSVariableName(dt)){$[dt]=ft;continue}else{const xt=getValueAsType(ft,numberValueTypes[dt]);dt.startsWith("origin")?(h=!0,it[dt]=xt):b[dt]=xt}}if(i.transform||(at||c?b.transform=buildTransform(i,e.transform,c):b.transform&&(b.transform="none")),h){const{originX:dt="50%",originY:ft="50%",originZ:xt=0}=it;b.transformOrigin=`${dt} ${ft} ${xt}`}}const dashKeys={offset:"stroke-dashoffset",array:"stroke-dasharray"},camelKeys={offset:"strokeDashoffset",array:"strokeDasharray"};function buildSVGPath(e,i,c=1,b=0,$=!0){e.pathLength=1;const it=$?dashKeys:camelKeys;e[it.offset]=px.transform(-b);const at=px.transform(i),h=px.transform(c);e[it.array]=`${at} ${h}`}function calcOrigin$1(e,i,c){return typeof e=="string"?e:px.transform(i+c*e)}function calcSVGTransformOrigin(e,i,c){const b=calcOrigin$1(i,e.x,e.width),$=calcOrigin$1(c,e.y,e.height);return`${b} ${$}`}function buildSVGAttrs(e,{attrX:i,attrY:c,attrScale:b,originX:$,originY:it,pathLength:at,pathSpacing:h=1,pathOffset:dt=0,...ft},xt,Ct){if(buildHTMLStyles(e,ft,Ct),xt){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:bt,style:kt,dimensions:Dt}=e;bt.transform&&(Dt&&(kt.transform=bt.transform),delete bt.transform),Dt&&($!==void 0||it!==void 0||kt.transform)&&(kt.transformOrigin=calcSVGTransformOrigin(Dt,$!==void 0?$:.5,it!==void 0?it:.5)),i!==void 0&&(bt.x=i),c!==void 0&&(bt.y=c),b!==void 0&&(bt.scale=b),at!==void 0&&buildSVGPath(bt,at,h,dt,!1)}const createHtmlRenderState=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),createSvgRenderState=()=>({...createHtmlRenderState(),attrs:{}}),isSVGTag=e=>typeof e=="string"&&e.toLowerCase()==="svg";function renderHTML(e,{style:i,vars:c},b,$){Object.assign(e.style,i,$&&$.getProjectionStyles(b));for(const it in c)e.style.setProperty(it,c[it])}const camelCaseAttributes=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function renderSVG(e,i,c,b){renderHTML(e,i,void 0,b);for(const $ in i.attrs)e.setAttribute(camelCaseAttributes.has($)?$:camelToDash($),i.attrs[$])}const scaleCorrectors={};function addScaleCorrector(e){Object.assign(scaleCorrectors,e)}function isForcedMotionValue(e,{layout:i,layoutId:c}){return transformProps.has(e)||e.startsWith("origin")||(i||c!==void 0)&&(!!scaleCorrectors[e]||e==="opacity")}function scrapeMotionValuesFromProps$1(e,i,c){var b;const{style:$}=e,it={};for(const at in $)(isMotionValue($[at])||i.style&&isMotionValue(i.style[at])||isForcedMotionValue(at,e)||((b=c==null?void 0:c.getValue(at))===null||b===void 0?void 0:b.liveStyle)!==void 0)&&(it[at]=$[at]);return it}function scrapeMotionValuesFromProps(e,i,c){const b=scrapeMotionValuesFromProps$1(e,i,c);for(const $ in e)if(isMotionValue(e[$])||isMotionValue(i[$])){const it=transformPropOrder.indexOf($)!==-1?"attr"+$.charAt(0).toUpperCase()+$.substring(1):$;b[it]=e[$]}return b}function updateSVGDimensions(e,i){try{i.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{i.dimensions={x:0,y:0,width:0,height:0}}}const layoutProps=["x","y","width","height","cx","cy","r"],svgMotionConfig={useVisualState:makeUseVisualState({scrapeMotionValuesFromProps,createRenderState:createSvgRenderState,onUpdate:({props:e,prevProps:i,current:c,renderState:b,latestValues:$})=>{if(!c)return;let it=!!e.drag;if(!it){for(const h in $)if(transformProps.has(h)){it=!0;break}}if(!it)return;let at=!i;if(i)for(let h=0;h<layoutProps.length;h++){const dt=layoutProps[h];e[dt]!==i[dt]&&(at=!0)}at&&frame.read(()=>{updateSVGDimensions(c,b),frame.render(()=>{buildSVGAttrs(b,$,isSVGTag(c.tagName),e.transformTemplate),renderSVG(c,b)})})}})},htmlMotionConfig={useVisualState:makeUseVisualState({scrapeMotionValuesFromProps:scrapeMotionValuesFromProps$1,createRenderState:createHtmlRenderState})};function copyRawValuesOnly(e,i,c){for(const b in i)!isMotionValue(i[b])&&!isForcedMotionValue(b,c)&&(e[b]=i[b])}function useInitialMotionValues({transformTemplate:e},i){return reactExports.useMemo(()=>{const c=createHtmlRenderState();return buildHTMLStyles(c,i,e),Object.assign({},c.vars,c.style)},[i])}function useStyle(e,i){const c=e.style||{},b={};return copyRawValuesOnly(b,c,e),Object.assign(b,useInitialMotionValues(e,i)),b}function useHTMLProps(e,i){const c={},b=useStyle(e,i);return e.drag&&e.dragListener!==!1&&(c.draggable=!1,b.userSelect=b.WebkitUserSelect=b.WebkitTouchCallout="none",b.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(c.tabIndex=0),c.style=b,c}function useSVGProps(e,i,c,b){const $=reactExports.useMemo(()=>{const it=createSvgRenderState();return buildSVGAttrs(it,i,isSVGTag(b),e.transformTemplate),{...it.attrs,style:{...it.style}}},[i]);if(e.style){const it={};copyRawValuesOnly(it,e.style,e),$.style={...it,...$.style}}return $}function createUseRender(e=!1){return(c,b,$,{latestValues:it},at)=>{const dt=(isSVGComponent(c)?useSVGProps:useHTMLProps)(b,it,at,c),ft=filterProps(b,typeof c=="string",e),xt=c!==reactExports.Fragment?{...ft,...dt,ref:$}:{},{children:Ct}=b,bt=reactExports.useMemo(()=>isMotionValue(Ct)?Ct.get():Ct,[Ct]);return reactExports.createElement(c,{...xt,children:bt})}}function createMotionComponentFactory(e,i){return function(b,{forwardMotionProps:$}={forwardMotionProps:!1}){const at={...isSVGComponent(b)?svgMotionConfig:htmlMotionConfig,preloadedFeatures:e,useRender:createUseRender($),createVisualElement:i,Component:b};return createRendererMotionComponent(at)}}function shallowCompare(e,i){if(!Array.isArray(i))return!1;const c=i.length;if(c!==e.length)return!1;for(let b=0;b<c;b++)if(i[b]!==e[b])return!1;return!0}function resolveVariant(e,i,c){const b=e.getProps();return resolveVariantFromProps(b,i,c!==void 0?c:b.custom,e)}const supportsScrollTimeline=memo(()=>window.ScrollTimeline!==void 0);class BaseGroupPlaybackControls{constructor(i){this.stop=()=>this.runAll("stop"),this.animations=i.filter(Boolean)}get finished(){return Promise.all(this.animations.map(i=>"finished"in i?i.finished:i))}getAll(i){return this.animations[0][i]}setAll(i,c){for(let b=0;b<this.animations.length;b++)this.animations[b][i]=c}attachTimeline(i,c){const b=this.animations.map($=>{if(supportsScrollTimeline()&&$.attachTimeline)return $.attachTimeline(i);if(typeof c=="function")return c($)});return()=>{b.forEach(($,it)=>{$&&$(),this.animations[it].stop()})}}get time(){return this.getAll("time")}set time(i){this.setAll("time",i)}get speed(){return this.getAll("speed")}set speed(i){this.setAll("speed",i)}get startTime(){return this.getAll("startTime")}get duration(){let i=0;for(let c=0;c<this.animations.length;c++)i=Math.max(i,this.animations[c].duration);return i}runAll(i){this.animations.forEach(c=>c[i]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class GroupPlaybackControls extends BaseGroupPlaybackControls{then(i,c){return Promise.all(this.animations).then(i).catch(c)}}function getValueTransition(e,i){return e?e[i]||e.default||e:void 0}const maxGeneratorDuration=2e4;function calcGeneratorDuration(e){let i=0;const c=50;let b=e.next(i);for(;!b.done&&i<maxGeneratorDuration;)i+=c,b=e.next(i);return i>=maxGeneratorDuration?1/0:i}function isGenerator(e){return typeof e=="function"}function attachTimeline(e,i){e.timeline=i,e.onfinish=null}const isBezierDefinition=e=>Array.isArray(e)&&typeof e[0]=="number",supportsFlags={linearEasing:void 0};function memoSupports(e,i){const c=memo(e);return()=>{var b;return(b=supportsFlags[i])!==null&&b!==void 0?b:c()}}const supportsLinearEasing=memoSupports(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),generateLinearEasing=(e,i,c=10)=>{let b="";const $=Math.max(Math.round(i/c),2);for(let it=0;it<$;it++)b+=e(progress(0,$-1,it))+", ";return`linear(${b.substring(0,b.length-2)})`};function isWaapiSupportedEasing(e){return!!(typeof e=="function"&&supportsLinearEasing()||!e||typeof e=="string"&&(e in supportedWaapiEasing||supportsLinearEasing())||isBezierDefinition(e)||Array.isArray(e)&&e.every(isWaapiSupportedEasing))}const cubicBezierAsString=([e,i,c,b])=>`cubic-bezier(${e}, ${i}, ${c}, ${b})`,supportedWaapiEasing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cubicBezierAsString([0,.65,.55,1]),circOut:cubicBezierAsString([.55,0,1,.45]),backIn:cubicBezierAsString([.31,.01,.66,-.59]),backOut:cubicBezierAsString([.33,1.53,.69,.99])};function mapEasingToNativeEasing(e,i){if(e)return typeof e=="function"&&supportsLinearEasing()?generateLinearEasing(e,i):isBezierDefinition(e)?cubicBezierAsString(e):Array.isArray(e)?e.map(c=>mapEasingToNativeEasing(c,i)||supportedWaapiEasing.easeOut):supportedWaapiEasing[e]}const isDragging={x:!1,y:!1};function isDragActive(){return isDragging.x||isDragging.y}function resolveElements(e,i,c){var b;if(e instanceof Element)return[e];if(typeof e=="string"){let $=document;i&&($=i.current);const it=(b=c==null?void 0:c[e])!==null&&b!==void 0?b:$.querySelectorAll(e);return it?Array.from(it):[]}return Array.from(e)}function setupGesture(e,i){const c=resolveElements(e),b=new AbortController,$={passive:!0,...i,signal:b.signal};return[c,$,()=>b.abort()]}function filterEvents$1(e){return i=>{i.pointerType==="touch"||isDragActive()||e(i)}}function hover(e,i,c={}){const[b,$,it]=setupGesture(e,c),at=filterEvents$1(h=>{const{target:dt}=h,ft=i(h);if(typeof ft!="function"||!dt)return;const xt=filterEvents$1(Ct=>{ft(Ct),dt.removeEventListener("pointerleave",xt)});dt.addEventListener("pointerleave",xt,$)});return b.forEach(h=>{h.addEventListener("pointerenter",at,$)}),it}const isNodeOrChild=(e,i)=>i?e===i?!0:isNodeOrChild(e,i.parentElement):!1,isPrimaryPointer=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,focusableElements=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function isElementKeyboardAccessible(e){return focusableElements.has(e.tagName)||e.tabIndex!==-1}const isPressing=new WeakSet;function filterEvents(e){return i=>{i.key==="Enter"&&e(i)}}function firePointerEvent(e,i){e.dispatchEvent(new PointerEvent("pointer"+i,{isPrimary:!0,bubbles:!0}))}const enableKeyboardPress=(e,i)=>{const c=e.currentTarget;if(!c)return;const b=filterEvents(()=>{if(isPressing.has(c))return;firePointerEvent(c,"down");const $=filterEvents(()=>{firePointerEvent(c,"up")}),it=()=>firePointerEvent(c,"cancel");c.addEventListener("keyup",$,i),c.addEventListener("blur",it,i)});c.addEventListener("keydown",b,i),c.addEventListener("blur",()=>c.removeEventListener("keydown",b),i)};function isValidPressEvent(e){return isPrimaryPointer(e)&&!isDragActive()}function press(e,i,c={}){const[b,$,it]=setupGesture(e,c),at=h=>{const dt=h.currentTarget;if(!isValidPressEvent(h)||isPressing.has(dt))return;isPressing.add(dt);const ft=i(h),xt=(kt,Dt)=>{window.removeEventListener("pointerup",Ct),window.removeEventListener("pointercancel",bt),!(!isValidPressEvent(kt)||!isPressing.has(dt))&&(isPressing.delete(dt),typeof ft=="function"&&ft(kt,{success:Dt}))},Ct=kt=>{xt(kt,c.useGlobalTarget||isNodeOrChild(dt,kt.target))},bt=kt=>{xt(kt,!1)};window.addEventListener("pointerup",Ct,$),window.addEventListener("pointercancel",bt,$)};return b.forEach(h=>{!isElementKeyboardAccessible(h)&&h.getAttribute("tabindex")===null&&(h.tabIndex=0),(c.useGlobalTarget?window:h).addEventListener("pointerdown",at,$),h.addEventListener("focus",ft=>enableKeyboardPress(ft,$),$)}),it}function setDragLock(e){return e==="x"||e==="y"?isDragging[e]?null:(isDragging[e]=!0,()=>{isDragging[e]=!1}):isDragging.x||isDragging.y?null:(isDragging.x=isDragging.y=!0,()=>{isDragging.x=isDragging.y=!1})}const positionalKeys=new Set(["width","height","top","left","right","bottom",...transformPropOrder]);let now;function clearTime(){now=void 0}const time={now:()=>(now===void 0&&time.set(frameData.isProcessing||MotionGlobalConfig.useManualTiming?frameData.timestamp:performance.now()),now),set:e=>{now=e,queueMicrotask(clearTime)}};function addUniqueItem(e,i){e.indexOf(i)===-1&&e.push(i)}function removeItem(e,i){const c=e.indexOf(i);c>-1&&e.splice(c,1)}class SubscriptionManager{constructor(){this.subscriptions=[]}add(i){return addUniqueItem(this.subscriptions,i),()=>removeItem(this.subscriptions,i)}notify(i,c,b){const $=this.subscriptions.length;if($)if($===1)this.subscriptions[0](i,c,b);else for(let it=0;it<$;it++){const at=this.subscriptions[it];at&&at(i,c,b)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function velocityPerSecond(e,i){return i?e*(1e3/i):0}const MAX_VELOCITY_DELTA=30,isFloat=e=>!isNaN(parseFloat(e)),collectMotionValues={current:void 0};class MotionValue{constructor(i,c={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(b,$=!0)=>{const it=time.now();this.updatedAt!==it&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(b),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),$&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(i),this.owner=c.owner}setCurrent(i){this.current=i,this.updatedAt=time.now(),this.canTrackVelocity===null&&i!==void 0&&(this.canTrackVelocity=isFloat(this.current))}setPrevFrameValue(i=this.current){this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt}onChange(i){return this.on("change",i)}on(i,c){this.events[i]||(this.events[i]=new SubscriptionManager);const b=this.events[i].add(c);return i==="change"?()=>{b(),frame.read(()=>{this.events.change.getSize()||this.stop()})}:b}clearListeners(){for(const i in this.events)this.events[i].clear()}attach(i,c){this.passiveEffect=i,this.stopPassiveEffect=c}set(i,c=!0){!c||!this.passiveEffect?this.updateAndNotify(i,c):this.passiveEffect(i,this.updateAndNotify)}setWithVelocity(i,c,b){this.set(c),this.prev=void 0,this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt-b}jump(i,c=!0){this.updateAndNotify(i),this.prev=i,this.prevUpdatedAt=this.prevFrameValue=void 0,c&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return collectMotionValues.current&&collectMotionValues.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const i=time.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||i-this.updatedAt>MAX_VELOCITY_DELTA)return 0;const c=Math.min(this.updatedAt-this.prevUpdatedAt,MAX_VELOCITY_DELTA);return velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),c)}start(i){return this.stop(),new Promise(c=>{this.hasAnimated=!0,this.animation=i(c),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function motionValue(e,i){return new MotionValue(e,i)}function setMotionValue(e,i,c){e.hasValue(i)?e.getValue(i).set(c):e.addValue(i,motionValue(c))}function setTarget(e,i){const c=resolveVariant(e,i);let{transitionEnd:b={},transition:$={},...it}=c||{};it={...it,...b};for(const at in it){const h=resolveFinalValueInKeyframes(it[at]);setMotionValue(e,at,h)}}function isWillChangeMotionValue(e){return!!(isMotionValue(e)&&e.add)}function addValueToWillChange(e,i){const c=e.getValue("willChange");if(isWillChangeMotionValue(c))return c.add(i)}function getOptimisedAppearId(e){return e.props[optimizedAppearDataAttribute]}const calcBezier=(e,i,c)=>(((1-3*c+3*i)*e+(3*c-6*i))*e+3*i)*e,subdivisionPrecision=1e-7,subdivisionMaxIterations=12;function binarySubdivide(e,i,c,b,$){let it,at,h=0;do at=i+(c-i)/2,it=calcBezier(at,b,$)-e,it>0?c=at:i=at;while(Math.abs(it)>subdivisionPrecision&&++h<subdivisionMaxIterations);return at}function cubicBezier(e,i,c,b){if(e===i&&c===b)return noop;const $=it=>binarySubdivide(it,0,1,e,c);return it=>it===0||it===1?it:calcBezier($(it),i,b)}const mirrorEasing=e=>i=>i<=.5?e(2*i)/2:(2-e(2*(1-i)))/2,reverseEasing=e=>i=>1-e(1-i),backOut=cubicBezier(.33,1.53,.69,.99),backIn=reverseEasing(backOut),backInOut=mirrorEasing(backIn),anticipate=e=>(e*=2)<1?.5*backIn(e):.5*(2-Math.pow(2,-10*(e-1))),circIn=e=>1-Math.sin(Math.acos(e)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circIn),isZeroValueString=e=>/^0[^.\s]+$/u.test(e);function isNone(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||isZeroValueString(e):!0}const sanitize=e=>Math.round(e*1e5)/1e5,floatRegex=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function isNullish(e){return e==null}const singleColorRegex=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,isColorString=(e,i)=>c=>!!(typeof c=="string"&&singleColorRegex.test(c)&&c.startsWith(e)||i&&!isNullish(c)&&Object.prototype.hasOwnProperty.call(c,i)),splitColor=(e,i,c)=>b=>{if(typeof b!="string")return b;const[$,it,at,h]=b.match(floatRegex);return{[e]:parseFloat($),[i]:parseFloat(it),[c]:parseFloat(at),alpha:h!==void 0?parseFloat(h):1}},clampRgbUnit=e=>clamp(0,255,e),rgbUnit={...number,transform:e=>Math.round(clampRgbUnit(e))},rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:e,green:i,blue:c,alpha:b=1})=>"rgba("+rgbUnit.transform(e)+", "+rgbUnit.transform(i)+", "+rgbUnit.transform(c)+", "+sanitize(alpha.transform(b))+")"};function parseHex(e){let i="",c="",b="",$="";return e.length>5?(i=e.substring(1,3),c=e.substring(3,5),b=e.substring(5,7),$=e.substring(7,9)):(i=e.substring(1,2),c=e.substring(2,3),b=e.substring(3,4),$=e.substring(4,5),i+=i,c+=c,b+=b,$+=$),{red:parseInt(i,16),green:parseInt(c,16),blue:parseInt(b,16),alpha:$?parseInt($,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:e,saturation:i,lightness:c,alpha:b=1})=>"hsla("+Math.round(e)+", "+percent.transform(sanitize(i))+", "+percent.transform(sanitize(c))+", "+sanitize(alpha.transform(b))+")"},color={test:e=>rgba.test(e)||hex.test(e)||hsla.test(e),parse:e=>rgba.test(e)?rgba.parse(e):hsla.test(e)?hsla.parse(e):hex.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?rgba.transform(e):hsla.transform(e)},colorRegex=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function test(e){var i,c;return isNaN(e)&&typeof e=="string"&&(((i=e.match(floatRegex))===null||i===void 0?void 0:i.length)||0)+(((c=e.match(colorRegex))===null||c===void 0?void 0:c.length)||0)>0}const NUMBER_TOKEN="number",COLOR_TOKEN="color",VAR_TOKEN="var",VAR_FUNCTION_TOKEN="var(",SPLIT_TOKEN="${}",complexRegex=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function analyseComplexValue(e){const i=e.toString(),c=[],b={color:[],number:[],var:[]},$=[];let it=0;const h=i.replace(complexRegex,dt=>(color.test(dt)?(b.color.push(it),$.push(COLOR_TOKEN),c.push(color.parse(dt))):dt.startsWith(VAR_FUNCTION_TOKEN)?(b.var.push(it),$.push(VAR_TOKEN),c.push(dt)):(b.number.push(it),$.push(NUMBER_TOKEN),c.push(parseFloat(dt))),++it,SPLIT_TOKEN)).split(SPLIT_TOKEN);return{values:c,split:h,indexes:b,types:$}}function parseComplexValue(e){return analyseComplexValue(e).values}function createTransformer(e){const{split:i,types:c}=analyseComplexValue(e),b=i.length;return $=>{let it="";for(let at=0;at<b;at++)if(it+=i[at],$[at]!==void 0){const h=c[at];h===NUMBER_TOKEN?it+=sanitize($[at]):h===COLOR_TOKEN?it+=color.transform($[at]):it+=$[at]}return it}}const convertNumbersToZero=e=>typeof e=="number"?0:e;function getAnimatableNone$1(e){const i=parseComplexValue(e);return createTransformer(e)(i.map(convertNumbersToZero))}const complex={test,parse:parseComplexValue,createTransformer,getAnimatableNone:getAnimatableNone$1},maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(e){const[i,c]=e.slice(0,-1).split("(");if(i==="drop-shadow")return e;const[b]=c.match(floatRegex)||[];if(!b)return e;const $=c.replace(b,"");let it=maxDefaults.has(i)?1:0;return b!==c&&(it*=100),i+"("+it+$+")"}const functionRegex=/\b([a-z-]*)\(.*?\)/gu,filter={...complex,getAnimatableNone:e=>{const i=e.match(functionRegex);return i?i.map(applyDefaultFilter).join(" "):e}},defaultValueTypes={...numberValueTypes,color,backgroundColor:color,outlineColor:color,fill:color,stroke:color,borderColor:color,borderTopColor:color,borderRightColor:color,borderBottomColor:color,borderLeftColor:color,filter,WebkitFilter:filter},getDefaultValueType=e=>defaultValueTypes[e];function getAnimatableNone(e,i){let c=getDefaultValueType(e);return c!==filter&&(c=complex),c.getAnimatableNone?c.getAnimatableNone(i):void 0}const invalidTemplates=new Set(["auto","none","0"]);function makeNoneKeyframesAnimatable(e,i,c){let b=0,$;for(;b<e.length&&!$;){const it=e[b];typeof it=="string"&&!invalidTemplates.has(it)&&analyseComplexValue(it).values.length&&($=e[b]),b++}if($&&c)for(const it of i)e[it]=getAnimatableNone(c,$)}const isNumOrPxType=e=>e===number||e===px,getPosFromMatrix=(e,i)=>parseFloat(e.split(", ")[i]),getTranslateFromMatrix=(e,i)=>(c,{transform:b})=>{if(b==="none"||!b)return 0;const $=b.match(/^matrix3d\((.+)\)$/u);if($)return getPosFromMatrix($[1],i);{const it=b.match(/^matrix\((.+)\)$/u);return it?getPosFromMatrix(it[1],e):0}},transformKeys=new Set(["x","y","z"]),nonTranslationalTransformKeys=transformPropOrder.filter(e=>!transformKeys.has(e));function removeNonTranslationalTransform(e){const i=[];return nonTranslationalTransformKeys.forEach(c=>{const b=e.getValue(c);b!==void 0&&(i.push([c,b.get()]),b.set(c.startsWith("scale")?1:0))}),i}const positionalValues={width:({x:e},{paddingLeft:i="0",paddingRight:c="0"})=>e.max-e.min-parseFloat(i)-parseFloat(c),height:({y:e},{paddingTop:i="0",paddingBottom:c="0"})=>e.max-e.min-parseFloat(i)-parseFloat(c),top:(e,{top:i})=>parseFloat(i),left:(e,{left:i})=>parseFloat(i),bottom:({y:e},{top:i})=>parseFloat(i)+(e.max-e.min),right:({x:e},{left:i})=>parseFloat(i)+(e.max-e.min),x:getTranslateFromMatrix(4,13),y:getTranslateFromMatrix(5,14)};positionalValues.translateX=positionalValues.x;positionalValues.translateY=positionalValues.y;const toResolve=new Set;let isScheduled=!1,anyNeedsMeasurement=!1;function measureAllKeyframes(){if(anyNeedsMeasurement){const e=Array.from(toResolve).filter(b=>b.needsMeasurement),i=new Set(e.map(b=>b.element)),c=new Map;i.forEach(b=>{const $=removeNonTranslationalTransform(b);$.length&&(c.set(b,$),b.render())}),e.forEach(b=>b.measureInitialState()),i.forEach(b=>{b.render();const $=c.get(b);$&&$.forEach(([it,at])=>{var h;(h=b.getValue(it))===null||h===void 0||h.set(at)})}),e.forEach(b=>b.measureEndState()),e.forEach(b=>{b.suspendedScrollY!==void 0&&window.scrollTo(0,b.suspendedScrollY)})}anyNeedsMeasurement=!1,isScheduled=!1,toResolve.forEach(e=>e.complete()),toResolve.clear()}function readAllKeyframes(){toResolve.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(anyNeedsMeasurement=!0)})}function flushKeyframeResolvers(){readAllKeyframes(),measureAllKeyframes()}class KeyframeResolver{constructor(i,c,b,$,it,at=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...i],this.onComplete=c,this.name=b,this.motionValue=$,this.element=it,this.isAsync=at}scheduleResolve(){this.isScheduled=!0,this.isAsync?(toResolve.add(this),isScheduled||(isScheduled=!0,frame.read(readAllKeyframes),frame.resolveKeyframes(measureAllKeyframes))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:i,name:c,element:b,motionValue:$}=this;for(let it=0;it<i.length;it++)if(i[it]===null)if(it===0){const at=$==null?void 0:$.get(),h=i[i.length-1];if(at!==void 0)i[0]=at;else if(b&&c){const dt=b.readValue(c,h);dt!=null&&(i[0]=dt)}i[0]===void 0&&(i[0]=h),$&&at===void 0&&$.set(i[0])}else i[it]=i[it-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),toResolve.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,toResolve.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const isNumericalString=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),splitCSSVariableRegex=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function parseCSSVariable(e){const i=splitCSSVariableRegex.exec(e);if(!i)return[,];const[,c,b,$]=i;return[`--${c??b}`,$]}function getVariableValue(e,i,c=1){const[b,$]=parseCSSVariable(e);if(!b)return;const it=window.getComputedStyle(i).getPropertyValue(b);if(it){const at=it.trim();return isNumericalString(at)?parseFloat(at):at}return isCSSVariableToken($)?getVariableValue($,i,c+1):$}const testValueType=e=>i=>i.test(e),auto={test:e=>e==="auto",parse:e=>e},dimensionValueTypes=[number,px,percent,degrees,vw,vh,auto],findDimensionValueType=e=>dimensionValueTypes.find(testValueType(e));class DOMKeyframesResolver extends KeyframeResolver{constructor(i,c,b,$,it){super(i,c,b,$,it,!0)}readKeyframes(){const{unresolvedKeyframes:i,element:c,name:b}=this;if(!c||!c.current)return;super.readKeyframes();for(let dt=0;dt<i.length;dt++){let ft=i[dt];if(typeof ft=="string"&&(ft=ft.trim(),isCSSVariableToken(ft))){const xt=getVariableValue(ft,c.current);xt!==void 0&&(i[dt]=xt),dt===i.length-1&&(this.finalKeyframe=ft)}}if(this.resolveNoneKeyframes(),!positionalKeys.has(b)||i.length!==2)return;const[$,it]=i,at=findDimensionValueType($),h=findDimensionValueType(it);if(at!==h)if(isNumOrPxType(at)&&isNumOrPxType(h))for(let dt=0;dt<i.length;dt++){const ft=i[dt];typeof ft=="string"&&(i[dt]=parseFloat(ft))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:i,name:c}=this,b=[];for(let $=0;$<i.length;$++)isNone(i[$])&&b.push($);b.length&&makeNoneKeyframesAnimatable(i,b,c)}measureInitialState(){const{element:i,unresolvedKeyframes:c,name:b}=this;if(!i||!i.current)return;b==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=positionalValues[b](i.measureViewportBox(),window.getComputedStyle(i.current)),c[0]=this.measuredOrigin;const $=c[c.length-1];$!==void 0&&i.getValue(b,$).jump($,!1)}measureEndState(){var i;const{element:c,name:b,unresolvedKeyframes:$}=this;if(!c||!c.current)return;const it=c.getValue(b);it&&it.jump(this.measuredOrigin,!1);const at=$.length-1,h=$[at];$[at]=positionalValues[b](c.measureViewportBox(),window.getComputedStyle(c.current)),h!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=h),!((i=this.removedTransforms)===null||i===void 0)&&i.length&&this.removedTransforms.forEach(([dt,ft])=>{c.getValue(dt).set(ft)}),this.resolveNoneKeyframes()}}const isAnimatable=(e,i)=>i==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(complex.test(e)||e==="0")&&!e.startsWith("url("));function hasKeyframesChanged(e){const i=e[0];if(e.length===1)return!0;for(let c=0;c<e.length;c++)if(e[c]!==i)return!0}function canAnimate(e,i,c,b){const $=e[0];if($===null)return!1;if(i==="display"||i==="visibility")return!0;const it=e[e.length-1],at=isAnimatable($,i),h=isAnimatable(it,i);return!at||!h?!1:hasKeyframesChanged(e)||(c==="spring"||isGenerator(c))&&b}const isNotNull=e=>e!==null;function getFinalKeyframe(e,{repeat:i,repeatType:c="loop"},b){const $=e.filter(isNotNull),it=i&&c!=="loop"&&i%2===1?0:$.length-1;return!it||b===void 0?$[it]:b}const MAX_RESOLVE_DELAY=40;class BaseAnimation{constructor({autoplay:i=!0,delay:c=0,type:b="keyframes",repeat:$=0,repeatDelay:it=0,repeatType:at="loop",...h}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=time.now(),this.options={autoplay:i,delay:c,type:b,repeat:$,repeatDelay:it,repeatType:at,...h},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>MAX_RESOLVE_DELAY?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&flushKeyframeResolvers(),this._resolved}onKeyframesResolved(i,c){this.resolvedAt=time.now(),this.hasAttemptedResolve=!0;const{name:b,type:$,velocity:it,delay:at,onComplete:h,onUpdate:dt,isGenerator:ft}=this.options;if(!ft&&!canAnimate(i,b,$,it))if(at)this.options.duration=0;else{dt&&dt(getFinalKeyframe(i,this.options,c)),h&&h(),this.resolveFinishedPromise();return}const xt=this.initPlayback(i,c);xt!==!1&&(this._resolved={keyframes:i,finalKeyframe:c,...xt},this.onPostResolved())}onPostResolved(){}then(i,c){return this.currentFinishedPromise.then(i,c)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(i=>{this.resolveFinishedPromise=i})}}const mixNumber$1=(e,i,c)=>e+(i-e)*c;function hueToRgb(e,i,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?e+(i-e)*6*c:c<1/2?i:c<2/3?e+(i-e)*(2/3-c)*6:e}function hslaToRgba({hue:e,saturation:i,lightness:c,alpha:b}){e/=360,i/=100,c/=100;let $=0,it=0,at=0;if(!i)$=it=at=c;else{const h=c<.5?c*(1+i):c+i-c*i,dt=2*c-h;$=hueToRgb(dt,h,e+1/3),it=hueToRgb(dt,h,e),at=hueToRgb(dt,h,e-1/3)}return{red:Math.round($*255),green:Math.round(it*255),blue:Math.round(at*255),alpha:b}}function mixImmediate(e,i){return c=>c>0?i:e}const mixLinearColor=(e,i,c)=>{const b=e*e,$=c*(i*i-b)+b;return $<0?0:Math.sqrt($)},colorTypes=[hex,rgba,hsla],getColorType=e=>colorTypes.find(i=>i.test(e));function asRGBA(e){const i=getColorType(e);if(!i)return!1;let c=i.parse(e);return i===hsla&&(c=hslaToRgba(c)),c}const mixColor=(e,i)=>{const c=asRGBA(e),b=asRGBA(i);if(!c||!b)return mixImmediate(e,i);const $={...c};return it=>($.red=mixLinearColor(c.red,b.red,it),$.green=mixLinearColor(c.green,b.green,it),$.blue=mixLinearColor(c.blue,b.blue,it),$.alpha=mixNumber$1(c.alpha,b.alpha,it),rgba.transform($))},combineFunctions=(e,i)=>c=>i(e(c)),pipe=(...e)=>e.reduce(combineFunctions),invisibleValues=new Set(["none","hidden"]);function mixVisibility(e,i){return invisibleValues.has(e)?c=>c<=0?e:i:c=>c>=1?i:e}function mixNumber(e,i){return c=>mixNumber$1(e,i,c)}function getMixer$1(e){return typeof e=="number"?mixNumber:typeof e=="string"?isCSSVariableToken(e)?mixImmediate:color.test(e)?mixColor:mixComplex:Array.isArray(e)?mixArray:typeof e=="object"?color.test(e)?mixColor:mixObject:mixImmediate}function mixArray(e,i){const c=[...e],b=c.length,$=e.map((it,at)=>getMixer$1(it)(it,i[at]));return it=>{for(let at=0;at<b;at++)c[at]=$[at](it);return c}}function mixObject(e,i){const c={...e,...i},b={};for(const $ in c)e[$]!==void 0&&i[$]!==void 0&&(b[$]=getMixer$1(e[$])(e[$],i[$]));return $=>{for(const it in b)c[it]=b[it]($);return c}}function matchOrder(e,i){var c;const b=[],$={color:0,var:0,number:0};for(let it=0;it<i.values.length;it++){const at=i.types[it],h=e.indexes[at][$[at]],dt=(c=e.values[h])!==null&&c!==void 0?c:0;b[it]=dt,$[at]++}return b}const mixComplex=(e,i)=>{const c=complex.createTransformer(i),b=analyseComplexValue(e),$=analyseComplexValue(i);return b.indexes.var.length===$.indexes.var.length&&b.indexes.color.length===$.indexes.color.length&&b.indexes.number.length>=$.indexes.number.length?invisibleValues.has(e)&&!$.values.length||invisibleValues.has(i)&&!b.values.length?mixVisibility(e,i):pipe(mixArray(matchOrder(b,$),$.values),c):mixImmediate(e,i)};function mix(e,i,c){return typeof e=="number"&&typeof i=="number"&&typeof c=="number"?mixNumber$1(e,i,c):getMixer$1(e)(e,i)}const velocitySampleDuration=5;function calcGeneratorVelocity(e,i,c){const b=Math.max(i-velocitySampleDuration,0);return velocityPerSecond(c-e(b),i-b)}const springDefaults={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},safeMin=.001;function findSpring({duration:e=springDefaults.duration,bounce:i=springDefaults.bounce,velocity:c=springDefaults.velocity,mass:b=springDefaults.mass}){let $,it,at=1-i;at=clamp(springDefaults.minDamping,springDefaults.maxDamping,at),e=clamp(springDefaults.minDuration,springDefaults.maxDuration,millisecondsToSeconds(e)),at<1?($=ft=>{const xt=ft*at,Ct=xt*e,bt=xt-c,kt=calcAngularFreq(ft,at),Dt=Math.exp(-Ct);return safeMin-bt/kt*Dt},it=ft=>{const Ct=ft*at*e,bt=Ct*c+c,kt=Math.pow(at,2)*Math.pow(ft,2)*e,Dt=Math.exp(-Ct),At=calcAngularFreq(Math.pow(ft,2),at);return(-$(ft)+safeMin>0?-1:1)*((bt-kt)*Dt)/At}):($=ft=>{const xt=Math.exp(-ft*e),Ct=(ft-c)*e+1;return-safeMin+xt*Ct},it=ft=>{const xt=Math.exp(-ft*e),Ct=(c-ft)*(e*e);return xt*Ct});const h=5/e,dt=approximateRoot($,it,h);if(e=secondsToMilliseconds(e),isNaN(dt))return{stiffness:springDefaults.stiffness,damping:springDefaults.damping,duration:e};{const ft=Math.pow(dt,2)*b;return{stiffness:ft,damping:at*2*Math.sqrt(b*ft),duration:e}}}const rootIterations=12;function approximateRoot(e,i,c){let b=c;for(let $=1;$<rootIterations;$++)b=b-e(b)/i(b);return b}function calcAngularFreq(e,i){return e*Math.sqrt(1-i*i)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(e,i){return i.some(c=>e[c]!==void 0)}function getSpringOptions(e){let i={velocity:springDefaults.velocity,stiffness:springDefaults.stiffness,damping:springDefaults.damping,mass:springDefaults.mass,isResolvedFromDuration:!1,...e};if(!isSpringType(e,physicsKeys)&&isSpringType(e,durationKeys))if(e.visualDuration){const c=e.visualDuration,b=2*Math.PI/(c*1.2),$=b*b,it=2*clamp(.05,1,1-(e.bounce||0))*Math.sqrt($);i={...i,mass:springDefaults.mass,stiffness:$,damping:it}}else{const c=findSpring(e);i={...i,...c,mass:springDefaults.mass},i.isResolvedFromDuration=!0}return i}function spring(e=springDefaults.visualDuration,i=springDefaults.bounce){const c=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:i}:e;let{restSpeed:b,restDelta:$}=c;const it=c.keyframes[0],at=c.keyframes[c.keyframes.length-1],h={done:!1,value:it},{stiffness:dt,damping:ft,mass:xt,duration:Ct,velocity:bt,isResolvedFromDuration:kt}=getSpringOptions({...c,velocity:-millisecondsToSeconds(c.velocity||0)}),Dt=bt||0,At=ft/(2*Math.sqrt(dt*xt)),Bt=at-it,Tt=millisecondsToSeconds(Math.sqrt(dt/xt)),It=Math.abs(Bt)<5;b||(b=It?springDefaults.restSpeed.granular:springDefaults.restSpeed.default),$||($=It?springDefaults.restDelta.granular:springDefaults.restDelta.default);let St;if(At<1){const Ht=calcAngularFreq(Tt,At);St=Kt=>{const ir=Math.exp(-At*Tt*Kt);return at-ir*((Dt+At*Tt*Bt)/Ht*Math.sin(Ht*Kt)+Bt*Math.cos(Ht*Kt))}}else if(At===1)St=Ht=>at-Math.exp(-Tt*Ht)*(Bt+(Dt+Tt*Bt)*Ht);else{const Ht=Tt*Math.sqrt(At*At-1);St=Kt=>{const ir=Math.exp(-At*Tt*Kt),nr=Math.min(Ht*Kt,300);return at-ir*((Dt+At*Tt*Bt)*Math.sinh(nr)+Ht*Bt*Math.cosh(nr))/Ht}}const jt={calculatedDuration:kt&&Ct||null,next:Ht=>{const Kt=St(Ht);if(kt)h.done=Ht>=Ct;else{let ir=0;At<1&&(ir=Ht===0?secondsToMilliseconds(Dt):calcGeneratorVelocity(St,Ht,Kt));const nr=Math.abs(ir)<=b,kr=Math.abs(at-Kt)<=$;h.done=nr&&kr}return h.value=h.done?at:Kt,h},toString:()=>{const Ht=Math.min(calcGeneratorDuration(jt),maxGeneratorDuration),Kt=generateLinearEasing(ir=>jt.next(Ht*ir).value,Ht,30);return Ht+"ms "+Kt}};return jt}function inertia({keyframes:e,velocity:i=0,power:c=.8,timeConstant:b=325,bounceDamping:$=10,bounceStiffness:it=500,modifyTarget:at,min:h,max:dt,restDelta:ft=.5,restSpeed:xt}){const Ct=e[0],bt={done:!1,value:Ct},kt=nr=>h!==void 0&&nr<h||dt!==void 0&&nr>dt,Dt=nr=>h===void 0?dt:dt===void 0||Math.abs(h-nr)<Math.abs(dt-nr)?h:dt;let At=c*i;const Bt=Ct+At,Tt=at===void 0?Bt:at(Bt);Tt!==Bt&&(At=Tt-Ct);const It=nr=>-At*Math.exp(-nr/b),St=nr=>Tt+It(nr),jt=nr=>{const kr=It(nr),br=St(nr);bt.done=Math.abs(kr)<=ft,bt.value=bt.done?Tt:br};let Ht,Kt;const ir=nr=>{kt(bt.value)&&(Ht=nr,Kt=spring({keyframes:[bt.value,Dt(bt.value)],velocity:calcGeneratorVelocity(St,nr,bt.value),damping:$,stiffness:it,restDelta:ft,restSpeed:xt}))};return ir(0),{calculatedDuration:null,next:nr=>{let kr=!1;return!Kt&&Ht===void 0&&(kr=!0,jt(nr),ir(nr)),Ht!==void 0&&nr>=Ht?Kt.next(nr-Ht):(!kr&&jt(nr),bt)}}}const easeIn=cubicBezier(.42,0,1,1),easeOut=cubicBezier(0,0,.58,1),easeInOut=cubicBezier(.42,0,.58,1),isEasingArray=e=>Array.isArray(e)&&typeof e[0]!="number",easingLookup={linear:noop,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate},easingDefinitionToFunction=e=>{if(isBezierDefinition(e)){invariant(e.length===4);const[i,c,b,$]=e;return cubicBezier(i,c,b,$)}else if(typeof e=="string")return easingLookup[e];return e};function createMixers(e,i,c){const b=[],$=c||mix,it=e.length-1;for(let at=0;at<it;at++){let h=$(e[at],e[at+1]);if(i){const dt=Array.isArray(i)?i[at]||noop:i;h=pipe(dt,h)}b.push(h)}return b}function interpolate(e,i,{clamp:c=!0,ease:b,mixer:$}={}){const it=e.length;if(invariant(it===i.length),it===1)return()=>i[0];if(it===2&&i[0]===i[1])return()=>i[1];const at=e[0]===e[1];e[0]>e[it-1]&&(e=[...e].reverse(),i=[...i].reverse());const h=createMixers(i,b,$),dt=h.length,ft=xt=>{if(at&&xt<e[0])return i[0];let Ct=0;if(dt>1)for(;Ct<e.length-2&&!(xt<e[Ct+1]);Ct++);const bt=progress(e[Ct],e[Ct+1],xt);return h[Ct](bt)};return c?xt=>ft(clamp(e[0],e[it-1],xt)):ft}function fillOffset(e,i){const c=e[e.length-1];for(let b=1;b<=i;b++){const $=progress(0,i,b);e.push(mixNumber$1(c,1,$))}}function defaultOffset(e){const i=[0];return fillOffset(i,e.length-1),i}function convertOffsetToTimes(e,i){return e.map(c=>c*i)}function defaultEasing(e,i){return e.map(()=>i||easeInOut).splice(0,e.length-1)}function keyframes({duration:e=300,keyframes:i,times:c,ease:b="easeInOut"}){const $=isEasingArray(b)?b.map(easingDefinitionToFunction):easingDefinitionToFunction(b),it={done:!1,value:i[0]},at=convertOffsetToTimes(c&&c.length===i.length?c:defaultOffset(i),e),h=interpolate(at,i,{ease:Array.isArray($)?$:defaultEasing(i,$)});return{calculatedDuration:e,next:dt=>(it.value=h(dt),it.done=dt>=e,it)}}const frameloopDriver=e=>{const i=({timestamp:c})=>e(c);return{start:()=>frame.update(i,!0),stop:()=>cancelFrame(i),now:()=>frameData.isProcessing?frameData.timestamp:time.now()}},generators={decay:inertia,inertia,tween:keyframes,keyframes,spring},percentToProgress=e=>e/100;class MainThreadAnimation extends BaseAnimation{constructor(i){super(i),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:dt}=this.options;dt&&dt()};const{name:c,motionValue:b,element:$,keyframes:it}=this.options,at=($==null?void 0:$.KeyframeResolver)||KeyframeResolver,h=(dt,ft)=>this.onKeyframesResolved(dt,ft);this.resolver=new at(it,h,c,b,$),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(i){const{type:c="keyframes",repeat:b=0,repeatDelay:$=0,repeatType:it,velocity:at=0}=this.options,h=isGenerator(c)?c:generators[c]||keyframes;let dt,ft;h!==keyframes&&typeof i[0]!="number"&&(dt=pipe(percentToProgress,mix(i[0],i[1])),i=[0,100]);const xt=h({...this.options,keyframes:i});it==="mirror"&&(ft=h({...this.options,keyframes:[...i].reverse(),velocity:-at})),xt.calculatedDuration===null&&(xt.calculatedDuration=calcGeneratorDuration(xt));const{calculatedDuration:Ct}=xt,bt=Ct+$,kt=bt*(b+1)-$;return{generator:xt,mirroredGenerator:ft,mapPercentToKeyframes:dt,calculatedDuration:Ct,resolvedDuration:bt,totalDuration:kt}}onPostResolved(){const{autoplay:i=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!i?this.pause():this.state=this.pendingPlayState}tick(i,c=!1){const{resolved:b}=this;if(!b){const{keyframes:nr}=this.options;return{done:!0,value:nr[nr.length-1]}}const{finalKeyframe:$,generator:it,mirroredGenerator:at,mapPercentToKeyframes:h,keyframes:dt,calculatedDuration:ft,totalDuration:xt,resolvedDuration:Ct}=b;if(this.startTime===null)return it.next(0);const{delay:bt,repeat:kt,repeatType:Dt,repeatDelay:At,onUpdate:Bt}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,i):this.speed<0&&(this.startTime=Math.min(i-xt/this.speed,this.startTime)),c?this.currentTime=i:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(i-this.startTime)*this.speed;const Tt=this.currentTime-bt*(this.speed>=0?1:-1),It=this.speed>=0?Tt<0:Tt>xt;this.currentTime=Math.max(Tt,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=xt);let St=this.currentTime,jt=it;if(kt){const nr=Math.min(this.currentTime,xt)/Ct;let kr=Math.floor(nr),br=nr%1;!br&&nr>=1&&(br=1),br===1&&kr--,kr=Math.min(kr,kt+1),!!(kr%2)&&(Dt==="reverse"?(br=1-br,At&&(br-=At/Ct)):Dt==="mirror"&&(jt=at)),St=clamp(0,1,br)*Ct}const Ht=It?{done:!1,value:dt[0]}:jt.next(St);h&&(Ht.value=h(Ht.value));let{done:Kt}=Ht;!It&&ft!==null&&(Kt=this.speed>=0?this.currentTime>=xt:this.currentTime<=0);const ir=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Kt);return ir&&$!==void 0&&(Ht.value=getFinalKeyframe(dt,this.options,$)),Bt&&Bt(Ht.value),ir&&this.finish(),Ht}get duration(){const{resolved:i}=this;return i?millisecondsToSeconds(i.calculatedDuration):0}get time(){return millisecondsToSeconds(this.currentTime)}set time(i){i=secondsToMilliseconds(i),this.currentTime=i,this.holdTime!==null||this.speed===0?this.holdTime=i:this.driver&&(this.startTime=this.driver.now()-i/this.speed)}get speed(){return this.playbackSpeed}set speed(i){const c=this.playbackSpeed!==i;this.playbackSpeed=i,c&&(this.time=millisecondsToSeconds(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:i=frameloopDriver,onPlay:c,startTime:b}=this.options;this.driver||(this.driver=i(it=>this.tick(it))),c&&c();const $=this.driver.now();this.holdTime!==null?this.startTime=$-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=$):this.startTime=b??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var i;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(i=this.currentTime)!==null&&i!==void 0?i:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:i}=this.options;i&&i()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(i){return this.startTime=0,this.tick(i,!0)}}function animateValue(e){return new MainThreadAnimation(e)}const acceleratedValues=new Set(["opacity","clipPath","filter","transform"]);function startWaapiAnimation(e,i,c,{delay:b=0,duration:$=300,repeat:it=0,repeatType:at="loop",ease:h="easeInOut",times:dt}={}){const ft={[i]:c};dt&&(ft.offset=dt);const xt=mapEasingToNativeEasing(h,$);return Array.isArray(xt)&&(ft.easing=xt),e.animate(ft,{delay:b,duration:$,easing:Array.isArray(xt)?"linear":xt,fill:"both",iterations:it+1,direction:at==="reverse"?"alternate":"normal"})}const supportsWaapi=memo(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),sampleDelta=10,maxDuration=2e4;function requiresPregeneratedKeyframes(e){return isGenerator(e.type)||e.type==="spring"||!isWaapiSupportedEasing(e.ease)}function pregenerateKeyframes(e,i){const c=new MainThreadAnimation({...i,keyframes:e,repeat:0,delay:0,isGenerator:!0});let b={done:!1,value:e[0]};const $=[];let it=0;for(;!b.done&&it<maxDuration;)b=c.sample(it),$.push(b.value),it+=sampleDelta;return{times:void 0,keyframes:$,duration:it-sampleDelta,ease:"linear"}}const unsupportedEasingFunctions={anticipate,backInOut,circInOut};function isUnsupportedEase(e){return e in unsupportedEasingFunctions}class AcceleratedAnimation extends BaseAnimation{constructor(i){super(i);const{name:c,motionValue:b,element:$,keyframes:it}=this.options;this.resolver=new DOMKeyframesResolver(it,(at,h)=>this.onKeyframesResolved(at,h),c,b,$),this.resolver.scheduleResolve()}initPlayback(i,c){let{duration:b=300,times:$,ease:it,type:at,motionValue:h,name:dt,startTime:ft}=this.options;if(!h.owner||!h.owner.current)return!1;if(typeof it=="string"&&supportsLinearEasing()&&isUnsupportedEase(it)&&(it=unsupportedEasingFunctions[it]),requiresPregeneratedKeyframes(this.options)){const{onComplete:Ct,onUpdate:bt,motionValue:kt,element:Dt,...At}=this.options,Bt=pregenerateKeyframes(i,At);i=Bt.keyframes,i.length===1&&(i[1]=i[0]),b=Bt.duration,$=Bt.times,it=Bt.ease,at="keyframes"}const xt=startWaapiAnimation(h.owner.current,dt,i,{...this.options,duration:b,times:$,ease:it});return xt.startTime=ft??this.calcStartTime(),this.pendingTimeline?(attachTimeline(xt,this.pendingTimeline),this.pendingTimeline=void 0):xt.onfinish=()=>{const{onComplete:Ct}=this.options;h.set(getFinalKeyframe(i,this.options,c)),Ct&&Ct(),this.cancel(),this.resolveFinishedPromise()},{animation:xt,duration:b,times:$,type:at,ease:it,keyframes:i}}get duration(){const{resolved:i}=this;if(!i)return 0;const{duration:c}=i;return millisecondsToSeconds(c)}get time(){const{resolved:i}=this;if(!i)return 0;const{animation:c}=i;return millisecondsToSeconds(c.currentTime||0)}set time(i){const{resolved:c}=this;if(!c)return;const{animation:b}=c;b.currentTime=secondsToMilliseconds(i)}get speed(){const{resolved:i}=this;if(!i)return 1;const{animation:c}=i;return c.playbackRate}set speed(i){const{resolved:c}=this;if(!c)return;const{animation:b}=c;b.playbackRate=i}get state(){const{resolved:i}=this;if(!i)return"idle";const{animation:c}=i;return c.playState}get startTime(){const{resolved:i}=this;if(!i)return null;const{animation:c}=i;return c.startTime}attachTimeline(i){if(!this._resolved)this.pendingTimeline=i;else{const{resolved:c}=this;if(!c)return noop;const{animation:b}=c;attachTimeline(b,i)}return noop}play(){if(this.isStopped)return;const{resolved:i}=this;if(!i)return;const{animation:c}=i;c.playState==="finished"&&this.updateFinishedPromise(),c.play()}pause(){const{resolved:i}=this;if(!i)return;const{animation:c}=i;c.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:i}=this;if(!i)return;const{animation:c,keyframes:b,duration:$,type:it,ease:at,times:h}=i;if(c.playState==="idle"||c.playState==="finished")return;if(this.time){const{motionValue:ft,onUpdate:xt,onComplete:Ct,element:bt,...kt}=this.options,Dt=new MainThreadAnimation({...kt,keyframes:b,duration:$,type:it,ease:at,times:h,isGenerator:!0}),At=secondsToMilliseconds(this.time);ft.setWithVelocity(Dt.sample(At-sampleDelta).value,Dt.sample(At).value,sampleDelta)}const{onStop:dt}=this.options;dt&&dt(),this.cancel()}complete(){const{resolved:i}=this;i&&i.animation.finish()}cancel(){const{resolved:i}=this;i&&i.animation.cancel()}static supports(i){const{motionValue:c,name:b,repeatDelay:$,repeatType:it,damping:at,type:h}=i;if(!c||!c.owner||!(c.owner.current instanceof HTMLElement))return!1;const{onUpdate:dt,transformTemplate:ft}=c.owner.getProps();return supportsWaapi()&&b&&acceleratedValues.has(b)&&!dt&&!ft&&!$&&it!=="mirror"&&at!==0&&h!=="inertia"}}const underDampedSpring={type:"spring",stiffness:500,damping:25,restSpeed:10},criticallyDampedSpring=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),keyframesTransition={type:"keyframes",duration:.8},ease={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},getDefaultTransition=(e,{keyframes:i})=>i.length>2?keyframesTransition:transformProps.has(e)?e.startsWith("scale")?criticallyDampedSpring(i[1]):underDampedSpring:ease;function isTransitionDefined({when:e,delay:i,delayChildren:c,staggerChildren:b,staggerDirection:$,repeat:it,repeatType:at,repeatDelay:h,from:dt,elapsed:ft,...xt}){return!!Object.keys(xt).length}const animateMotionValue=(e,i,c,b={},$,it)=>at=>{const h=getValueTransition(b,e)||{},dt=h.delay||b.delay||0;let{elapsed:ft=0}=b;ft=ft-secondsToMilliseconds(dt);let xt={keyframes:Array.isArray(c)?c:[null,c],ease:"easeOut",velocity:i.getVelocity(),...h,delay:-ft,onUpdate:bt=>{i.set(bt),h.onUpdate&&h.onUpdate(bt)},onComplete:()=>{at(),h.onComplete&&h.onComplete()},name:e,motionValue:i,element:it?void 0:$};isTransitionDefined(h)||(xt={...xt,...getDefaultTransition(e,xt)}),xt.duration&&(xt.duration=secondsToMilliseconds(xt.duration)),xt.repeatDelay&&(xt.repeatDelay=secondsToMilliseconds(xt.repeatDelay)),xt.from!==void 0&&(xt.keyframes[0]=xt.from);let Ct=!1;if((xt.type===!1||xt.duration===0&&!xt.repeatDelay)&&(xt.duration=0,xt.delay===0&&(Ct=!0)),Ct&&!it&&i.get()!==void 0){const bt=getFinalKeyframe(xt.keyframes,h);if(bt!==void 0)return frame.update(()=>{xt.onUpdate(bt),xt.onComplete()}),new GroupPlaybackControls([])}return!it&&AcceleratedAnimation.supports(xt)?new AcceleratedAnimation(xt):new MainThreadAnimation(xt)};function shouldBlockAnimation({protectedKeys:e,needsAnimating:i},c){const b=e.hasOwnProperty(c)&&i[c]!==!0;return i[c]=!1,b}function animateTarget(e,i,{delay:c=0,transitionOverride:b,type:$}={}){var it;let{transition:at=e.getDefaultTransition(),transitionEnd:h,...dt}=i;b&&(at=b);const ft=[],xt=$&&e.animationState&&e.animationState.getState()[$];for(const Ct in dt){const bt=e.getValue(Ct,(it=e.latestValues[Ct])!==null&&it!==void 0?it:null),kt=dt[Ct];if(kt===void 0||xt&&shouldBlockAnimation(xt,Ct))continue;const Dt={delay:c,...getValueTransition(at||{},Ct)};let At=!1;if(window.MotionHandoffAnimation){const Tt=getOptimisedAppearId(e);if(Tt){const It=window.MotionHandoffAnimation(Tt,Ct,frame);It!==null&&(Dt.startTime=It,At=!0)}}addValueToWillChange(e,Ct),bt.start(animateMotionValue(Ct,bt,kt,e.shouldReduceMotion&&positionalKeys.has(Ct)?{type:!1}:Dt,e,At));const Bt=bt.animation;Bt&&ft.push(Bt)}return h&&Promise.all(ft).then(()=>{frame.update(()=>{h&&setTarget(e,h)})}),ft}function animateVariant(e,i,c={}){var b;const $=resolveVariant(e,i,c.type==="exit"?(b=e.presenceContext)===null||b===void 0?void 0:b.custom:void 0);let{transition:it=e.getDefaultTransition()||{}}=$||{};c.transitionOverride&&(it=c.transitionOverride);const at=$?()=>Promise.all(animateTarget(e,$,c)):()=>Promise.resolve(),h=e.variantChildren&&e.variantChildren.size?(ft=0)=>{const{delayChildren:xt=0,staggerChildren:Ct,staggerDirection:bt}=it;return animateChildren(e,i,xt+ft,Ct,bt,c)}:()=>Promise.resolve(),{when:dt}=it;if(dt){const[ft,xt]=dt==="beforeChildren"?[at,h]:[h,at];return ft().then(()=>xt())}else return Promise.all([at(),h(c.delay)])}function animateChildren(e,i,c=0,b=0,$=1,it){const at=[],h=(e.variantChildren.size-1)*b,dt=$===1?(ft=0)=>ft*b:(ft=0)=>h-ft*b;return Array.from(e.variantChildren).sort(sortByTreeOrder).forEach((ft,xt)=>{ft.notify("AnimationStart",i),at.push(animateVariant(ft,i,{...it,delay:c+dt(xt)}).then(()=>ft.notify("AnimationComplete",i)))}),Promise.all(at)}function sortByTreeOrder(e,i){return e.sortNodePosition(i)}function animateVisualElement(e,i,c={}){e.notify("AnimationStart",i);let b;if(Array.isArray(i)){const $=i.map(it=>animateVariant(e,it,c));b=Promise.all($)}else if(typeof i=="string")b=animateVariant(e,i,c);else{const $=typeof i=="function"?resolveVariant(e,i,c.custom):i;b=Promise.all(animateTarget(e,$,c))}return b.then(()=>{e.notify("AnimationComplete",i)})}const numVariantProps=variantProps.length;function getVariantContext(e){if(!e)return;if(!e.isControllingVariants){const c=e.parent?getVariantContext(e.parent)||{}:{};return e.props.initial!==void 0&&(c.initial=e.props.initial),c}const i={};for(let c=0;c<numVariantProps;c++){const b=variantProps[c],$=e.props[b];(isVariantLabel($)||$===!1)&&(i[b]=$)}return i}const reversePriorityOrder=[...variantPriorityOrder].reverse(),numAnimationTypes=variantPriorityOrder.length;function animateList(e){return i=>Promise.all(i.map(({animation:c,options:b})=>animateVisualElement(e,c,b)))}function createAnimationState(e){let i=animateList(e),c=createState(),b=!0;const $=dt=>(ft,xt)=>{var Ct;const bt=resolveVariant(e,xt,dt==="exit"?(Ct=e.presenceContext)===null||Ct===void 0?void 0:Ct.custom:void 0);if(bt){const{transition:kt,transitionEnd:Dt,...At}=bt;ft={...ft,...At,...Dt}}return ft};function it(dt){i=dt(e)}function at(dt){const{props:ft}=e,xt=getVariantContext(e.parent)||{},Ct=[],bt=new Set;let kt={},Dt=1/0;for(let Bt=0;Bt<numAnimationTypes;Bt++){const Tt=reversePriorityOrder[Bt],It=c[Tt],St=ft[Tt]!==void 0?ft[Tt]:xt[Tt],jt=isVariantLabel(St),Ht=Tt===dt?It.isActive:null;Ht===!1&&(Dt=Bt);let Kt=St===xt[Tt]&&St!==ft[Tt]&&jt;if(Kt&&b&&e.manuallyAnimateOnMount&&(Kt=!1),It.protectedKeys={...kt},!It.isActive&&Ht===null||!St&&!It.prevProp||isAnimationControls(St)||typeof St=="boolean")continue;const ir=checkVariantsDidChange(It.prevProp,St);let nr=ir||Tt===dt&&It.isActive&&!Kt&&jt||Bt>Dt&&jt,kr=!1;const br=Array.isArray(St)?St:[St];let Sr=br.reduce($(Tt),{});Ht===!1&&(Sr={});const{prevResolvedValues:$r={}}=It,rn={...$r,...Sr},Zr=mr=>{nr=!0,bt.has(mr)&&(kr=!0,bt.delete(mr)),It.needsAnimating[mr]=!0;const Ut=e.getValue(mr);Ut&&(Ut.liveStyle=!1)};for(const mr in rn){const Ut=Sr[mr],Jt=$r[mr];if(kt.hasOwnProperty(mr))continue;let Or=!1;isKeyframesTarget(Ut)&&isKeyframesTarget(Jt)?Or=!shallowCompare(Ut,Jt):Or=Ut!==Jt,Or?Ut!=null?Zr(mr):bt.add(mr):Ut!==void 0&&bt.has(mr)?Zr(mr):It.protectedKeys[mr]=!0}It.prevProp=St,It.prevResolvedValues=Sr,It.isActive&&(kt={...kt,...Sr}),b&&e.blockInitialAnimation&&(nr=!1),nr&&(!(Kt&&ir)||kr)&&Ct.push(...br.map(mr=>({animation:mr,options:{type:Tt}})))}if(bt.size){const Bt={};bt.forEach(Tt=>{const It=e.getBaseTarget(Tt),St=e.getValue(Tt);St&&(St.liveStyle=!0),Bt[Tt]=It??null}),Ct.push({animation:Bt})}let At=!!Ct.length;return b&&(ft.initial===!1||ft.initial===ft.animate)&&!e.manuallyAnimateOnMount&&(At=!1),b=!1,At?i(Ct):Promise.resolve()}function h(dt,ft){var xt;if(c[dt].isActive===ft)return Promise.resolve();(xt=e.variantChildren)===null||xt===void 0||xt.forEach(bt=>{var kt;return(kt=bt.animationState)===null||kt===void 0?void 0:kt.setActive(dt,ft)}),c[dt].isActive=ft;const Ct=at(dt);for(const bt in c)c[bt].protectedKeys={};return Ct}return{animateChanges:at,setActive:h,setAnimateFunction:it,getState:()=>c,reset:()=>{c=createState(),b=!0}}}function checkVariantsDidChange(e,i){return typeof i=="string"?i!==e:Array.isArray(i)?!shallowCompare(i,e):!1}function createTypeState(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function createState(){return{animate:createTypeState(!0),whileInView:createTypeState(),whileHover:createTypeState(),whileTap:createTypeState(),whileDrag:createTypeState(),whileFocus:createTypeState(),exit:createTypeState()}}class Feature{constructor(i){this.isMounted=!1,this.node=i}update(){}}class AnimationFeature extends Feature{constructor(i){super(i),i.animationState||(i.animationState=createAnimationState(i))}updateAnimationControlsSubscription(){const{animate:i}=this.node.getProps();isAnimationControls(i)&&(this.unmountControls=i.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:i}=this.node.getProps(),{animate:c}=this.node.prevProps||{};i!==c&&this.updateAnimationControlsSubscription()}unmount(){var i;this.node.animationState.reset(),(i=this.unmountControls)===null||i===void 0||i.call(this)}}let id$1=0;class ExitAnimationFeature extends Feature{constructor(){super(...arguments),this.id=id$1++}update(){if(!this.node.presenceContext)return;const{isPresent:i,onExitComplete:c}=this.node.presenceContext,{isPresent:b}=this.node.prevPresenceContext||{};if(!this.node.animationState||i===b)return;const $=this.node.animationState.setActive("exit",!i);c&&!i&&$.then(()=>c(this.id))}mount(){const{register:i}=this.node.presenceContext||{};i&&(this.unmount=i(this.id))}unmount(){}}const animations={animation:{Feature:AnimationFeature},exit:{Feature:ExitAnimationFeature}};function addDomEvent(e,i,c,b={passive:!0}){return e.addEventListener(i,c,b),()=>e.removeEventListener(i,c)}function extractEventInfo(e){return{point:{x:e.pageX,y:e.pageY}}}const addPointerInfo=e=>i=>isPrimaryPointer(i)&&e(i,extractEventInfo(i));function addPointerEvent(e,i,c,b){return addDomEvent(e,i,addPointerInfo(c),b)}const distance=(e,i)=>Math.abs(e-i);function distance2D(e,i){const c=distance(e.x,i.x),b=distance(e.y,i.y);return Math.sqrt(c**2+b**2)}class PanSession{constructor(i,c,{transformPagePoint:b,contextWindow:$,dragSnapToOrigin:it=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Ct=getPanInfo(this.lastMoveEventInfo,this.history),bt=this.startEvent!==null,kt=distance2D(Ct.offset,{x:0,y:0})>=3;if(!bt&&!kt)return;const{point:Dt}=Ct,{timestamp:At}=frameData;this.history.push({...Dt,timestamp:At});const{onStart:Bt,onMove:Tt}=this.handlers;bt||(Bt&&Bt(this.lastMoveEvent,Ct),this.startEvent=this.lastMoveEvent),Tt&&Tt(this.lastMoveEvent,Ct)},this.handlePointerMove=(Ct,bt)=>{this.lastMoveEvent=Ct,this.lastMoveEventInfo=transformPoint(bt,this.transformPagePoint),frame.update(this.updatePoint,!0)},this.handlePointerUp=(Ct,bt)=>{this.end();const{onEnd:kt,onSessionEnd:Dt,resumeAnimation:At}=this.handlers;if(this.dragSnapToOrigin&&At&&At(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Bt=getPanInfo(Ct.type==="pointercancel"?this.lastMoveEventInfo:transformPoint(bt,this.transformPagePoint),this.history);this.startEvent&&kt&&kt(Ct,Bt),Dt&&Dt(Ct,Bt)},!isPrimaryPointer(i))return;this.dragSnapToOrigin=it,this.handlers=c,this.transformPagePoint=b,this.contextWindow=$||window;const at=extractEventInfo(i),h=transformPoint(at,this.transformPagePoint),{point:dt}=h,{timestamp:ft}=frameData;this.history=[{...dt,timestamp:ft}];const{onSessionStart:xt}=c;xt&&xt(i,getPanInfo(h,this.history)),this.removeListeners=pipe(addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(i){this.handlers=i}end(){this.removeListeners&&this.removeListeners(),cancelFrame(this.updatePoint)}}function transformPoint(e,i){return i?{point:i(e.point)}:e}function subtractPoint(e,i){return{x:e.x-i.x,y:e.y-i.y}}function getPanInfo({point:e},i){return{point:e,delta:subtractPoint(e,lastDevicePoint(i)),offset:subtractPoint(e,startDevicePoint(i)),velocity:getVelocity(i,.1)}}function startDevicePoint(e){return e[0]}function lastDevicePoint(e){return e[e.length-1]}function getVelocity(e,i){if(e.length<2)return{x:0,y:0};let c=e.length-1,b=null;const $=lastDevicePoint(e);for(;c>=0&&(b=e[c],!($.timestamp-b.timestamp>secondsToMilliseconds(i)));)c--;if(!b)return{x:0,y:0};const it=millisecondsToSeconds($.timestamp-b.timestamp);if(it===0)return{x:0,y:0};const at={x:($.x-b.x)/it,y:($.y-b.y)/it};return at.x===1/0&&(at.x=0),at.y===1/0&&(at.y=0),at}const SCALE_PRECISION=1e-4,SCALE_MIN=1-SCALE_PRECISION,SCALE_MAX=1+SCALE_PRECISION,TRANSLATE_PRECISION=.01,TRANSLATE_MIN=0-TRANSLATE_PRECISION,TRANSLATE_MAX=0+TRANSLATE_PRECISION;function calcLength(e){return e.max-e.min}function isNear(e,i,c){return Math.abs(e-i)<=c}function calcAxisDelta(e,i,c,b=.5){e.origin=b,e.originPoint=mixNumber$1(i.min,i.max,e.origin),e.scale=calcLength(c)/calcLength(i),e.translate=mixNumber$1(c.min,c.max,e.origin)-e.originPoint,(e.scale>=SCALE_MIN&&e.scale<=SCALE_MAX||isNaN(e.scale))&&(e.scale=1),(e.translate>=TRANSLATE_MIN&&e.translate<=TRANSLATE_MAX||isNaN(e.translate))&&(e.translate=0)}function calcBoxDelta(e,i,c,b){calcAxisDelta(e.x,i.x,c.x,b?b.originX:void 0),calcAxisDelta(e.y,i.y,c.y,b?b.originY:void 0)}function calcRelativeAxis(e,i,c){e.min=c.min+i.min,e.max=e.min+calcLength(i)}function calcRelativeBox(e,i,c){calcRelativeAxis(e.x,i.x,c.x),calcRelativeAxis(e.y,i.y,c.y)}function calcRelativeAxisPosition(e,i,c){e.min=i.min-c.min,e.max=e.min+calcLength(i)}function calcRelativePosition(e,i,c){calcRelativeAxisPosition(e.x,i.x,c.x),calcRelativeAxisPosition(e.y,i.y,c.y)}function applyConstraints(e,{min:i,max:c},b){return i!==void 0&&e<i?e=b?mixNumber$1(i,e,b.min):Math.max(e,i):c!==void 0&&e>c&&(e=b?mixNumber$1(c,e,b.max):Math.min(e,c)),e}function calcRelativeAxisConstraints(e,i,c){return{min:i!==void 0?e.min+i:void 0,max:c!==void 0?e.max+c-(e.max-e.min):void 0}}function calcRelativeConstraints(e,{top:i,left:c,bottom:b,right:$}){return{x:calcRelativeAxisConstraints(e.x,c,$),y:calcRelativeAxisConstraints(e.y,i,b)}}function calcViewportAxisConstraints(e,i){let c=i.min-e.min,b=i.max-e.max;return i.max-i.min<e.max-e.min&&([c,b]=[b,c]),{min:c,max:b}}function calcViewportConstraints(e,i){return{x:calcViewportAxisConstraints(e.x,i.x),y:calcViewportAxisConstraints(e.y,i.y)}}function calcOrigin(e,i){let c=.5;const b=calcLength(e),$=calcLength(i);return $>b?c=progress(i.min,i.max-b,e.min):b>$&&(c=progress(e.min,e.max-$,i.min)),clamp(0,1,c)}function rebaseAxisConstraints(e,i){const c={};return i.min!==void 0&&(c.min=i.min-e.min),i.max!==void 0&&(c.max=i.max-e.min),c}const defaultElastic=.35;function resolveDragElastic(e=defaultElastic){return e===!1?e=0:e===!0&&(e=defaultElastic),{x:resolveAxisElastic(e,"left","right"),y:resolveAxisElastic(e,"top","bottom")}}function resolveAxisElastic(e,i,c){return{min:resolvePointElastic(e,i),max:resolvePointElastic(e,c)}}function resolvePointElastic(e,i){return typeof e=="number"?e:e[i]||0}const createAxisDelta=()=>({translate:0,scale:1,origin:0,originPoint:0}),createDelta=()=>({x:createAxisDelta(),y:createAxisDelta()}),createAxis=()=>({min:0,max:0}),createBox=()=>({x:createAxis(),y:createAxis()});function eachAxis(e){return[e("x"),e("y")]}function convertBoundingBoxToBox({top:e,left:i,right:c,bottom:b}){return{x:{min:i,max:c},y:{min:e,max:b}}}function convertBoxToBoundingBox({x:e,y:i}){return{top:i.min,right:e.max,bottom:i.max,left:e.min}}function transformBoxPoints(e,i){if(!i)return e;const c=i({x:e.left,y:e.top}),b=i({x:e.right,y:e.bottom});return{top:c.y,left:c.x,bottom:b.y,right:b.x}}function isIdentityScale(e){return e===void 0||e===1}function hasScale({scale:e,scaleX:i,scaleY:c}){return!isIdentityScale(e)||!isIdentityScale(i)||!isIdentityScale(c)}function hasTransform(e){return hasScale(e)||has2DTranslate(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function has2DTranslate(e){return is2DTranslate(e.x)||is2DTranslate(e.y)}function is2DTranslate(e){return e&&e!=="0%"}function scalePoint(e,i,c){const b=e-c,$=i*b;return c+$}function applyPointDelta(e,i,c,b,$){return $!==void 0&&(e=scalePoint(e,$,b)),scalePoint(e,c,b)+i}function applyAxisDelta(e,i=0,c=1,b,$){e.min=applyPointDelta(e.min,i,c,b,$),e.max=applyPointDelta(e.max,i,c,b,$)}function applyBoxDelta(e,{x:i,y:c}){applyAxisDelta(e.x,i.translate,i.scale,i.originPoint),applyAxisDelta(e.y,c.translate,c.scale,c.originPoint)}const TREE_SCALE_SNAP_MIN=.999999999999,TREE_SCALE_SNAP_MAX=1.0000000000001;function applyTreeDeltas(e,i,c,b=!1){const $=c.length;if(!$)return;i.x=i.y=1;let it,at;for(let h=0;h<$;h++){it=c[h],at=it.projectionDelta;const{visualElement:dt}=it.options;dt&&dt.props.style&&dt.props.style.display==="contents"||(b&&it.options.layoutScroll&&it.scroll&&it!==it.root&&transformBox(e,{x:-it.scroll.offset.x,y:-it.scroll.offset.y}),at&&(i.x*=at.x.scale,i.y*=at.y.scale,applyBoxDelta(e,at)),b&&hasTransform(it.latestValues)&&transformBox(e,it.latestValues))}i.x<TREE_SCALE_SNAP_MAX&&i.x>TREE_SCALE_SNAP_MIN&&(i.x=1),i.y<TREE_SCALE_SNAP_MAX&&i.y>TREE_SCALE_SNAP_MIN&&(i.y=1)}function translateAxis(e,i){e.min=e.min+i,e.max=e.max+i}function transformAxis(e,i,c,b,$=.5){const it=mixNumber$1(e.min,e.max,$);applyAxisDelta(e,i,c,it,b)}function transformBox(e,i){transformAxis(e.x,i.x,i.scaleX,i.scale,i.originX),transformAxis(e.y,i.y,i.scaleY,i.scale,i.originY)}function measureViewportBox(e,i){return convertBoundingBoxToBox(transformBoxPoints(e.getBoundingClientRect(),i))}function measurePageBox(e,i,c){const b=measureViewportBox(e,c),{scroll:$}=i;return $&&(translateAxis(b.x,$.offset.x),translateAxis(b.y,$.offset.y)),b}const getContextWindow=({current:e})=>e?e.ownerDocument.defaultView:null,elementDragControls=new WeakMap;class VisualElementDragControls{constructor(i){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=createBox(),this.visualElement=i}start(i,{snapToCursor:c=!1}={}){const{presenceContext:b}=this.visualElement;if(b&&b.isPresent===!1)return;const $=xt=>{const{dragSnapToOrigin:Ct}=this.getProps();Ct?this.pauseAnimation():this.stopAnimation(),c&&this.snapToCursor(extractEventInfo(xt).point)},it=(xt,Ct)=>{const{drag:bt,dragPropagation:kt,onDragStart:Dt}=this.getProps();if(bt&&!kt&&(this.openDragLock&&this.openDragLock(),this.openDragLock=setDragLock(bt),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eachAxis(Bt=>{let Tt=this.getAxisMotionValue(Bt).get()||0;if(percent.test(Tt)){const{projection:It}=this.visualElement;if(It&&It.layout){const St=It.layout.layoutBox[Bt];St&&(Tt=calcLength(St)*(parseFloat(Tt)/100))}}this.originPoint[Bt]=Tt}),Dt&&frame.postRender(()=>Dt(xt,Ct)),addValueToWillChange(this.visualElement,"transform");const{animationState:At}=this.visualElement;At&&At.setActive("whileDrag",!0)},at=(xt,Ct)=>{const{dragPropagation:bt,dragDirectionLock:kt,onDirectionLock:Dt,onDrag:At}=this.getProps();if(!bt&&!this.openDragLock)return;const{offset:Bt}=Ct;if(kt&&this.currentDirection===null){this.currentDirection=getCurrentDirection(Bt),this.currentDirection!==null&&Dt&&Dt(this.currentDirection);return}this.updateAxis("x",Ct.point,Bt),this.updateAxis("y",Ct.point,Bt),this.visualElement.render(),At&&At(xt,Ct)},h=(xt,Ct)=>this.stop(xt,Ct),dt=()=>eachAxis(xt=>{var Ct;return this.getAnimationState(xt)==="paused"&&((Ct=this.getAxisMotionValue(xt).animation)===null||Ct===void 0?void 0:Ct.play())}),{dragSnapToOrigin:ft}=this.getProps();this.panSession=new PanSession(i,{onSessionStart:$,onStart:it,onMove:at,onSessionEnd:h,resumeAnimation:dt},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:ft,contextWindow:getContextWindow(this.visualElement)})}stop(i,c){const b=this.isDragging;if(this.cancel(),!b)return;const{velocity:$}=c;this.startAnimation($);const{onDragEnd:it}=this.getProps();it&&frame.postRender(()=>it(i,c))}cancel(){this.isDragging=!1;const{projection:i,animationState:c}=this.visualElement;i&&(i.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:b}=this.getProps();!b&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),c&&c.setActive("whileDrag",!1)}updateAxis(i,c,b){const{drag:$}=this.getProps();if(!b||!shouldDrag(i,$,this.currentDirection))return;const it=this.getAxisMotionValue(i);let at=this.originPoint[i]+b[i];this.constraints&&this.constraints[i]&&(at=applyConstraints(at,this.constraints[i],this.elastic[i])),it.set(at)}resolveConstraints(){var i;const{dragConstraints:c,dragElastic:b}=this.getProps(),$=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(i=this.visualElement.projection)===null||i===void 0?void 0:i.layout,it=this.constraints;c&&isRefObject(c)?this.constraints||(this.constraints=this.resolveRefConstraints()):c&&$?this.constraints=calcRelativeConstraints($.layoutBox,c):this.constraints=!1,this.elastic=resolveDragElastic(b),it!==this.constraints&&$&&this.constraints&&!this.hasMutatedConstraints&&eachAxis(at=>{this.constraints!==!1&&this.getAxisMotionValue(at)&&(this.constraints[at]=rebaseAxisConstraints($.layoutBox[at],this.constraints[at]))})}resolveRefConstraints(){const{dragConstraints:i,onMeasureDragConstraints:c}=this.getProps();if(!i||!isRefObject(i))return!1;const b=i.current,{projection:$}=this.visualElement;if(!$||!$.layout)return!1;const it=measurePageBox(b,$.root,this.visualElement.getTransformPagePoint());let at=calcViewportConstraints($.layout.layoutBox,it);if(c){const h=c(convertBoxToBoundingBox(at));this.hasMutatedConstraints=!!h,h&&(at=convertBoundingBoxToBox(h))}return at}startAnimation(i){const{drag:c,dragMomentum:b,dragElastic:$,dragTransition:it,dragSnapToOrigin:at,onDragTransitionEnd:h}=this.getProps(),dt=this.constraints||{},ft=eachAxis(xt=>{if(!shouldDrag(xt,c,this.currentDirection))return;let Ct=dt&&dt[xt]||{};at&&(Ct={min:0,max:0});const bt=$?200:1e6,kt=$?40:1e7,Dt={type:"inertia",velocity:b?i[xt]:0,bounceStiffness:bt,bounceDamping:kt,timeConstant:750,restDelta:1,restSpeed:10,...it,...Ct};return this.startAxisValueAnimation(xt,Dt)});return Promise.all(ft).then(h)}startAxisValueAnimation(i,c){const b=this.getAxisMotionValue(i);return addValueToWillChange(this.visualElement,i),b.start(animateMotionValue(i,b,0,c,this.visualElement,!1))}stopAnimation(){eachAxis(i=>this.getAxisMotionValue(i).stop())}pauseAnimation(){eachAxis(i=>{var c;return(c=this.getAxisMotionValue(i).animation)===null||c===void 0?void 0:c.pause()})}getAnimationState(i){var c;return(c=this.getAxisMotionValue(i).animation)===null||c===void 0?void 0:c.state}getAxisMotionValue(i){const c=`_drag${i.toUpperCase()}`,b=this.visualElement.getProps(),$=b[c];return $||this.visualElement.getValue(i,(b.initial?b.initial[i]:void 0)||0)}snapToCursor(i){eachAxis(c=>{const{drag:b}=this.getProps();if(!shouldDrag(c,b,this.currentDirection))return;const{projection:$}=this.visualElement,it=this.getAxisMotionValue(c);if($&&$.layout){const{min:at,max:h}=$.layout.layoutBox[c];it.set(i[c]-mixNumber$1(at,h,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:i,dragConstraints:c}=this.getProps(),{projection:b}=this.visualElement;if(!isRefObject(c)||!b||!this.constraints)return;this.stopAnimation();const $={x:0,y:0};eachAxis(at=>{const h=this.getAxisMotionValue(at);if(h&&this.constraints!==!1){const dt=h.get();$[at]=calcOrigin({min:dt,max:dt},this.constraints[at])}});const{transformTemplate:it}=this.visualElement.getProps();this.visualElement.current.style.transform=it?it({},""):"none",b.root&&b.root.updateScroll(),b.updateLayout(),this.resolveConstraints(),eachAxis(at=>{if(!shouldDrag(at,i,null))return;const h=this.getAxisMotionValue(at),{min:dt,max:ft}=this.constraints[at];h.set(mixNumber$1(dt,ft,$[at]))})}addListeners(){if(!this.visualElement.current)return;elementDragControls.set(this.visualElement,this);const i=this.visualElement.current,c=addPointerEvent(i,"pointerdown",dt=>{const{drag:ft,dragListener:xt=!0}=this.getProps();ft&&xt&&this.start(dt)}),b=()=>{const{dragConstraints:dt}=this.getProps();isRefObject(dt)&&dt.current&&(this.constraints=this.resolveRefConstraints())},{projection:$}=this.visualElement,it=$.addEventListener("measure",b);$&&!$.layout&&($.root&&$.root.updateScroll(),$.updateLayout()),frame.read(b);const at=addDomEvent(window,"resize",()=>this.scalePositionWithinConstraints()),h=$.addEventListener("didUpdate",({delta:dt,hasLayoutChanged:ft})=>{this.isDragging&&ft&&(eachAxis(xt=>{const Ct=this.getAxisMotionValue(xt);Ct&&(this.originPoint[xt]+=dt[xt].translate,Ct.set(Ct.get()+dt[xt].translate))}),this.visualElement.render())});return()=>{at(),c(),it(),h&&h()}}getProps(){const i=this.visualElement.getProps(),{drag:c=!1,dragDirectionLock:b=!1,dragPropagation:$=!1,dragConstraints:it=!1,dragElastic:at=defaultElastic,dragMomentum:h=!0}=i;return{...i,drag:c,dragDirectionLock:b,dragPropagation:$,dragConstraints:it,dragElastic:at,dragMomentum:h}}}function shouldDrag(e,i,c){return(i===!0||i===e)&&(c===null||c===e)}function getCurrentDirection(e,i=10){let c=null;return Math.abs(e.y)>i?c="y":Math.abs(e.x)>i&&(c="x"),c}class DragGesture extends Feature{constructor(i){super(i),this.removeGroupControls=noop,this.removeListeners=noop,this.controls=new VisualElementDragControls(i)}mount(){const{dragControls:i}=this.node.getProps();i&&(this.removeGroupControls=i.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||noop}unmount(){this.removeGroupControls(),this.removeListeners()}}const asyncHandler=e=>(i,c)=>{e&&frame.postRender(()=>e(i,c))};class PanGesture extends Feature{constructor(){super(...arguments),this.removePointerDownListener=noop}onPointerDown(i){this.session=new PanSession(i,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:getContextWindow(this.node)})}createPanHandlers(){const{onPanSessionStart:i,onPanStart:c,onPan:b,onPanEnd:$}=this.node.getProps();return{onSessionStart:asyncHandler(i),onStart:asyncHandler(c),onMove:b,onEnd:(it,at)=>{delete this.session,$&&frame.postRender(()=>$(it,at))}}}mount(){this.removePointerDownListener=addPointerEvent(this.node.current,"pointerdown",i=>this.onPointerDown(i))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const globalProjectionState={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function pixelsToPercent(e,i){return i.max===i.min?0:e/(i.max-i.min)*100}const correctBorderRadius={correct:(e,i)=>{if(!i.target)return e;if(typeof e=="string")if(px.test(e))e=parseFloat(e);else return e;const c=pixelsToPercent(e,i.target.x),b=pixelsToPercent(e,i.target.y);return`${c}% ${b}%`}},correctBoxShadow={correct:(e,{treeScale:i,projectionDelta:c})=>{const b=e,$=complex.parse(e);if($.length>5)return b;const it=complex.createTransformer(e),at=typeof $[0]!="number"?1:0,h=c.x.scale*i.x,dt=c.y.scale*i.y;$[0+at]/=h,$[1+at]/=dt;const ft=mixNumber$1(h,dt,.5);return typeof $[2+at]=="number"&&($[2+at]/=ft),typeof $[3+at]=="number"&&($[3+at]/=ft),it($)}};class MeasureLayoutWithContext extends reactExports.Component{componentDidMount(){const{visualElement:i,layoutGroup:c,switchLayoutGroup:b,layoutId:$}=this.props,{projection:it}=i;addScaleCorrector(defaultScaleCorrectors),it&&(c.group&&c.group.add(it),b&&b.register&&$&&b.register(it),it.root.didUpdate(),it.addEventListener("animationComplete",()=>{this.safeToRemove()}),it.setOptions({...it.options,onExitComplete:()=>this.safeToRemove()})),globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(i){const{layoutDependency:c,visualElement:b,drag:$,isPresent:it}=this.props,at=b.projection;return at&&(at.isPresent=it,$||i.layoutDependency!==c||c===void 0?at.willUpdate():this.safeToRemove(),i.isPresent!==it&&(it?at.promote():at.relegate()||frame.postRender(()=>{const h=at.getStack();(!h||!h.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:i}=this.props.visualElement;i&&(i.root.didUpdate(),microtask.postRender(()=>{!i.currentAnimation&&i.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:i,layoutGroup:c,switchLayoutGroup:b}=this.props,{projection:$}=i;$&&($.scheduleCheckAfterUnmount(),c&&c.group&&c.group.remove($),b&&b.deregister&&b.deregister($))}safeToRemove(){const{safeToRemove:i}=this.props;i&&i()}render(){return null}}function MeasureLayout(e){const[i,c]=usePresence(),b=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(MeasureLayoutWithContext,{...e,layoutGroup:b,switchLayoutGroup:reactExports.useContext(SwitchLayoutGroupContext),isPresent:i,safeToRemove:c})}const defaultScaleCorrectors={borderRadius:{...correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:correctBorderRadius,borderTopRightRadius:correctBorderRadius,borderBottomLeftRadius:correctBorderRadius,borderBottomRightRadius:correctBorderRadius,boxShadow:correctBoxShadow};function animateSingleValue(e,i,c){const b=isMotionValue(e)?e:motionValue(e);return b.start(animateMotionValue("",b,i,c)),b.animation}function isSVGElement(e){return e instanceof SVGElement&&e.tagName!=="svg"}const compareByDepth=(e,i)=>e.depth-i.depth;class FlatTree{constructor(){this.children=[],this.isDirty=!1}add(i){addUniqueItem(this.children,i),this.isDirty=!0}remove(i){removeItem(this.children,i),this.isDirty=!0}forEach(i){this.isDirty&&this.children.sort(compareByDepth),this.isDirty=!1,this.children.forEach(i)}}function delay(e,i){const c=time.now(),b=({timestamp:$})=>{const it=$-c;it>=i&&(cancelFrame(b),e(it-i))};return frame.read(b,!0),()=>cancelFrame(b)}const borders=["TopLeft","TopRight","BottomLeft","BottomRight"],numBorders=borders.length,asNumber=e=>typeof e=="string"?parseFloat(e):e,isPx=e=>typeof e=="number"||px.test(e);function mixValues(e,i,c,b,$,it){$?(e.opacity=mixNumber$1(0,c.opacity!==void 0?c.opacity:1,easeCrossfadeIn(b)),e.opacityExit=mixNumber$1(i.opacity!==void 0?i.opacity:1,0,easeCrossfadeOut(b))):it&&(e.opacity=mixNumber$1(i.opacity!==void 0?i.opacity:1,c.opacity!==void 0?c.opacity:1,b));for(let at=0;at<numBorders;at++){const h=`border${borders[at]}Radius`;let dt=getRadius(i,h),ft=getRadius(c,h);if(dt===void 0&&ft===void 0)continue;dt||(dt=0),ft||(ft=0),dt===0||ft===0||isPx(dt)===isPx(ft)?(e[h]=Math.max(mixNumber$1(asNumber(dt),asNumber(ft),b),0),(percent.test(ft)||percent.test(dt))&&(e[h]+="%")):e[h]=ft}(i.rotate||c.rotate)&&(e.rotate=mixNumber$1(i.rotate||0,c.rotate||0,b))}function getRadius(e,i){return e[i]!==void 0?e[i]:e.borderRadius}const easeCrossfadeIn=compress(0,.5,circOut),easeCrossfadeOut=compress(.5,.95,noop);function compress(e,i,c){return b=>b<e?0:b>i?1:c(progress(e,i,b))}function copyAxisInto(e,i){e.min=i.min,e.max=i.max}function copyBoxInto(e,i){copyAxisInto(e.x,i.x),copyAxisInto(e.y,i.y)}function copyAxisDeltaInto(e,i){e.translate=i.translate,e.scale=i.scale,e.originPoint=i.originPoint,e.origin=i.origin}function removePointDelta(e,i,c,b,$){return e-=i,e=scalePoint(e,1/c,b),$!==void 0&&(e=scalePoint(e,1/$,b)),e}function removeAxisDelta(e,i=0,c=1,b=.5,$,it=e,at=e){if(percent.test(i)&&(i=parseFloat(i),i=mixNumber$1(at.min,at.max,i/100)-at.min),typeof i!="number")return;let h=mixNumber$1(it.min,it.max,b);e===it&&(h-=i),e.min=removePointDelta(e.min,i,c,h,$),e.max=removePointDelta(e.max,i,c,h,$)}function removeAxisTransforms(e,i,[c,b,$],it,at){removeAxisDelta(e,i[c],i[b],i[$],i.scale,it,at)}const xKeys=["x","scaleX","originX"],yKeys=["y","scaleY","originY"];function removeBoxTransforms(e,i,c,b){removeAxisTransforms(e.x,i,xKeys,c?c.x:void 0,b?b.x:void 0),removeAxisTransforms(e.y,i,yKeys,c?c.y:void 0,b?b.y:void 0)}function isAxisDeltaZero(e){return e.translate===0&&e.scale===1}function isDeltaZero(e){return isAxisDeltaZero(e.x)&&isAxisDeltaZero(e.y)}function axisEquals(e,i){return e.min===i.min&&e.max===i.max}function boxEquals(e,i){return axisEquals(e.x,i.x)&&axisEquals(e.y,i.y)}function axisEqualsRounded(e,i){return Math.round(e.min)===Math.round(i.min)&&Math.round(e.max)===Math.round(i.max)}function boxEqualsRounded(e,i){return axisEqualsRounded(e.x,i.x)&&axisEqualsRounded(e.y,i.y)}function aspectRatio(e){return calcLength(e.x)/calcLength(e.y)}function axisDeltaEquals(e,i){return e.translate===i.translate&&e.scale===i.scale&&e.originPoint===i.originPoint}class NodeStack{constructor(){this.members=[]}add(i){addUniqueItem(this.members,i),i.scheduleRender()}remove(i){if(removeItem(this.members,i),i===this.prevLead&&(this.prevLead=void 0),i===this.lead){const c=this.members[this.members.length-1];c&&this.promote(c)}}relegate(i){const c=this.members.findIndex($=>i===$);if(c===0)return!1;let b;for(let $=c;$>=0;$--){const it=this.members[$];if(it.isPresent!==!1){b=it;break}}return b?(this.promote(b),!0):!1}promote(i,c){const b=this.lead;if(i!==b&&(this.prevLead=b,this.lead=i,i.show(),b)){b.instance&&b.scheduleRender(),i.scheduleRender(),i.resumeFrom=b,c&&(i.resumeFrom.preserveOpacity=!0),b.snapshot&&(i.snapshot=b.snapshot,i.snapshot.latestValues=b.animationValues||b.latestValues),i.root&&i.root.isUpdating&&(i.isLayoutDirty=!0);const{crossfade:$}=i.options;$===!1&&b.hide()}}exitAnimationComplete(){this.members.forEach(i=>{const{options:c,resumingFrom:b}=i;c.onExitComplete&&c.onExitComplete(),b&&b.options.onExitComplete&&b.options.onExitComplete()})}scheduleRender(){this.members.forEach(i=>{i.instance&&i.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function buildProjectionTransform(e,i,c){let b="";const $=e.x.translate/i.x,it=e.y.translate/i.y,at=(c==null?void 0:c.z)||0;if(($||it||at)&&(b=`translate3d(${$}px, ${it}px, ${at}px) `),(i.x!==1||i.y!==1)&&(b+=`scale(${1/i.x}, ${1/i.y}) `),c){const{transformPerspective:ft,rotate:xt,rotateX:Ct,rotateY:bt,skewX:kt,skewY:Dt}=c;ft&&(b=`perspective(${ft}px) ${b}`),xt&&(b+=`rotate(${xt}deg) `),Ct&&(b+=`rotateX(${Ct}deg) `),bt&&(b+=`rotateY(${bt}deg) `),kt&&(b+=`skewX(${kt}deg) `),Dt&&(b+=`skewY(${Dt}deg) `)}const h=e.x.scale*i.x,dt=e.y.scale*i.y;return(h!==1||dt!==1)&&(b+=`scale(${h}, ${dt})`),b||"none"}const metrics={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},isDebug=typeof window<"u"&&window.MotionDebug!==void 0,transformAxes=["","X","Y","Z"],hiddenVisibility={visibility:"hidden"},animationTarget=1e3;let id=0;function resetDistortingTransform(e,i,c,b){const{latestValues:$}=i;$[e]&&(c[e]=$[e],i.setStaticValue(e,0),b&&(b[e]=0))}function cancelTreeOptimisedTransformAnimations(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:i}=e.options;if(!i)return;const c=getOptimisedAppearId(i);if(window.MotionHasOptimisedAnimation(c,"transform")){const{layout:$,layoutId:it}=e.options;window.MotionCancelOptimisedAnimation(c,"transform",frame,!($||it))}const{parent:b}=e;b&&!b.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(b)}function createProjectionNode({attachResizeListener:e,defaultParent:i,measureScroll:c,checkIsScrollRoot:b,resetTransform:$}){return class{constructor(at={},h=i==null?void 0:i()){this.id=id++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,isDebug&&(metrics.totalNodes=metrics.resolvedTargetDeltas=metrics.recalculatedProjection=0),this.nodes.forEach(propagateDirtyNodes),this.nodes.forEach(resolveTargetDelta),this.nodes.forEach(calcProjection),this.nodes.forEach(cleanDirtyNodes),isDebug&&window.MotionDebug.record(metrics)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=at,this.root=h?h.root||h:this,this.path=h?[...h.path,h]:[],this.parent=h,this.depth=h?h.depth+1:0;for(let dt=0;dt<this.path.length;dt++)this.path[dt].shouldResetTransform=!0;this.root===this&&(this.nodes=new FlatTree)}addEventListener(at,h){return this.eventHandlers.has(at)||this.eventHandlers.set(at,new SubscriptionManager),this.eventHandlers.get(at).add(h)}notifyListeners(at,...h){const dt=this.eventHandlers.get(at);dt&&dt.notify(...h)}hasListeners(at){return this.eventHandlers.has(at)}mount(at,h=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=isSVGElement(at),this.instance=at;const{layoutId:dt,layout:ft,visualElement:xt}=this.options;if(xt&&!xt.current&&xt.mount(at),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),h&&(ft||dt)&&(this.isLayoutDirty=!0),e){let Ct;const bt=()=>this.root.updateBlockedByResize=!1;e(at,()=>{this.root.updateBlockedByResize=!0,Ct&&Ct(),Ct=delay(bt,250),globalProjectionState.hasAnimatedSinceResize&&(globalProjectionState.hasAnimatedSinceResize=!1,this.nodes.forEach(finishAnimation))})}dt&&this.root.registerSharedNode(dt,this),this.options.animate!==!1&&xt&&(dt||ft)&&this.addEventListener("didUpdate",({delta:Ct,hasLayoutChanged:bt,hasRelativeTargetChanged:kt,layout:Dt})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const At=this.options.transition||xt.getDefaultTransition()||defaultLayoutTransition,{onLayoutAnimationStart:Bt,onLayoutAnimationComplete:Tt}=xt.getProps(),It=!this.targetLayout||!boxEqualsRounded(this.targetLayout,Dt)||kt,St=!bt&&kt;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||St||bt&&(It||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(Ct,St);const jt={...getValueTransition(At,"layout"),onPlay:Bt,onComplete:Tt};(xt.shouldReduceMotion||this.options.layoutRoot)&&(jt.delay=0,jt.type=!1),this.startAnimation(jt)}else bt||finishAnimation(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=Dt})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const at=this.getStack();at&&at.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,cancelFrame(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(resetSkewAndRotation),this.animationId++)}getTransformTemplate(){const{visualElement:at}=this.options;return at&&at.getProps().transformTemplate}willUpdate(at=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let xt=0;xt<this.path.length;xt++){const Ct=this.path[xt];Ct.shouldResetTransform=!0,Ct.updateScroll("snapshot"),Ct.options.layoutRoot&&Ct.willUpdate(!1)}const{layoutId:h,layout:dt}=this.options;if(h===void 0&&!dt)return;const ft=this.getTransformTemplate();this.prevTransformTemplateValue=ft?ft(this.latestValues,""):void 0,this.updateSnapshot(),at&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(clearMeasurements);return}this.isUpdating||this.nodes.forEach(clearIsLayoutDirty),this.isUpdating=!1,this.nodes.forEach(resetTransformStyle),this.nodes.forEach(updateLayout),this.nodes.forEach(notifyLayoutUpdate),this.clearAllSnapshots();const h=time.now();frameData.delta=clamp(0,1e3/60,h-frameData.timestamp),frameData.timestamp=h,frameData.isProcessing=!0,frameSteps.update.process(frameData),frameSteps.preRender.process(frameData),frameSteps.render.process(frameData),frameData.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,microtask.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(clearSnapshot),this.sharedNodes.forEach(removeLeadSnapshots)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,frame.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){frame.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let dt=0;dt<this.path.length;dt++)this.path[dt].updateScroll();const at=this.layout;this.layout=this.measure(!1),this.layoutCorrected=createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:h}=this.options;h&&h.notify("LayoutMeasure",this.layout.layoutBox,at?at.layoutBox:void 0)}updateScroll(at="measure"){let h=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===at&&(h=!1),h){const dt=b(this.instance);this.scroll={animationId:this.root.animationId,phase:at,isRoot:dt,offset:c(this.instance),wasRoot:this.scroll?this.scroll.isRoot:dt}}}resetTransform(){if(!$)return;const at=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,h=this.projectionDelta&&!isDeltaZero(this.projectionDelta),dt=this.getTransformTemplate(),ft=dt?dt(this.latestValues,""):void 0,xt=ft!==this.prevTransformTemplateValue;at&&(h||hasTransform(this.latestValues)||xt)&&($(this.instance,ft),this.shouldResetTransform=!1,this.scheduleRender())}measure(at=!0){const h=this.measurePageBox();let dt=this.removeElementScroll(h);return at&&(dt=this.removeTransform(dt)),roundBox(dt),{animationId:this.root.animationId,measuredBox:h,layoutBox:dt,latestValues:{},source:this.id}}measurePageBox(){var at;const{visualElement:h}=this.options;if(!h)return createBox();const dt=h.measureViewportBox();if(!(((at=this.scroll)===null||at===void 0?void 0:at.wasRoot)||this.path.some(checkNodeWasScrollRoot))){const{scroll:xt}=this.root;xt&&(translateAxis(dt.x,xt.offset.x),translateAxis(dt.y,xt.offset.y))}return dt}removeElementScroll(at){var h;const dt=createBox();if(copyBoxInto(dt,at),!((h=this.scroll)===null||h===void 0)&&h.wasRoot)return dt;for(let ft=0;ft<this.path.length;ft++){const xt=this.path[ft],{scroll:Ct,options:bt}=xt;xt!==this.root&&Ct&&bt.layoutScroll&&(Ct.wasRoot&&copyBoxInto(dt,at),translateAxis(dt.x,Ct.offset.x),translateAxis(dt.y,Ct.offset.y))}return dt}applyTransform(at,h=!1){const dt=createBox();copyBoxInto(dt,at);for(let ft=0;ft<this.path.length;ft++){const xt=this.path[ft];!h&&xt.options.layoutScroll&&xt.scroll&&xt!==xt.root&&transformBox(dt,{x:-xt.scroll.offset.x,y:-xt.scroll.offset.y}),hasTransform(xt.latestValues)&&transformBox(dt,xt.latestValues)}return hasTransform(this.latestValues)&&transformBox(dt,this.latestValues),dt}removeTransform(at){const h=createBox();copyBoxInto(h,at);for(let dt=0;dt<this.path.length;dt++){const ft=this.path[dt];if(!ft.instance||!hasTransform(ft.latestValues))continue;hasScale(ft.latestValues)&&ft.updateSnapshot();const xt=createBox(),Ct=ft.measurePageBox();copyBoxInto(xt,Ct),removeBoxTransforms(h,ft.latestValues,ft.snapshot?ft.snapshot.layoutBox:void 0,xt)}return hasTransform(this.latestValues)&&removeBoxTransforms(h,this.latestValues),h}setTargetDelta(at){this.targetDelta=at,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(at){this.options={...this.options,...at,crossfade:at.crossfade!==void 0?at.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==frameData.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(at=!1){var h;const dt=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=dt.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=dt.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=dt.isSharedProjectionDirty);const ft=!!this.resumingFrom||this!==dt;if(!(at||ft&&this.isSharedProjectionDirty||this.isProjectionDirty||!((h=this.parent)===null||h===void 0)&&h.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:Ct,layoutId:bt}=this.options;if(!(!this.layout||!(Ct||bt))){if(this.resolvedRelativeTargetAt=frameData.timestamp,!this.targetDelta&&!this.relativeTarget){const kt=this.getClosestProjectingParent();kt&&kt.layout&&this.animationProgress!==1?(this.relativeParent=kt,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.layout.layoutBox,kt.layout.layoutBox),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=createBox(),this.targetWithTransforms=createBox()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):copyBoxInto(this.target,this.layout.layoutBox),applyBoxDelta(this.target,this.targetDelta)):copyBoxInto(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const kt=this.getClosestProjectingParent();kt&&!!kt.resumingFrom==!!this.resumingFrom&&!kt.options.layoutScroll&&kt.target&&this.animationProgress!==1?(this.relativeParent=kt,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.target,kt.target),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}isDebug&&metrics.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||hasScale(this.parent.latestValues)||has2DTranslate(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var at;const h=this.getLead(),dt=!!this.resumingFrom||this!==h;let ft=!0;if((this.isProjectionDirty||!((at=this.parent)===null||at===void 0)&&at.isProjectionDirty)&&(ft=!1),dt&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(ft=!1),this.resolvedRelativeTargetAt===frameData.timestamp&&(ft=!1),ft)return;const{layout:xt,layoutId:Ct}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(xt||Ct))return;copyBoxInto(this.layoutCorrected,this.layout.layoutBox);const bt=this.treeScale.x,kt=this.treeScale.y;applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,dt),h.layout&&!h.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(h.target=h.layout.layoutBox,h.targetWithTransforms=createBox());const{target:Dt}=h;if(!Dt){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(copyAxisDeltaInto(this.prevProjectionDelta.x,this.projectionDelta.x),copyAxisDeltaInto(this.prevProjectionDelta.y,this.projectionDelta.y)),calcBoxDelta(this.projectionDelta,this.layoutCorrected,Dt,this.latestValues),(this.treeScale.x!==bt||this.treeScale.y!==kt||!axisDeltaEquals(this.projectionDelta.x,this.prevProjectionDelta.x)||!axisDeltaEquals(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",Dt)),isDebug&&metrics.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(at=!0){var h;if((h=this.options.visualElement)===null||h===void 0||h.scheduleRender(),at){const dt=this.getStack();dt&&dt.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=createDelta(),this.projectionDelta=createDelta(),this.projectionDeltaWithTransform=createDelta()}setAnimationOrigin(at,h=!1){const dt=this.snapshot,ft=dt?dt.latestValues:{},xt={...this.latestValues},Ct=createDelta();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!h;const bt=createBox(),kt=dt?dt.source:void 0,Dt=this.layout?this.layout.source:void 0,At=kt!==Dt,Bt=this.getStack(),Tt=!Bt||Bt.members.length<=1,It=!!(At&&!Tt&&this.options.crossfade===!0&&!this.path.some(hasOpacityCrossfade));this.animationProgress=0;let St;this.mixTargetDelta=jt=>{const Ht=jt/1e3;mixAxisDelta(Ct.x,at.x,Ht),mixAxisDelta(Ct.y,at.y,Ht),this.setTargetDelta(Ct),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(calcRelativePosition(bt,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mixBox(this.relativeTarget,this.relativeTargetOrigin,bt,Ht),St&&boxEquals(this.relativeTarget,St)&&(this.isProjectionDirty=!1),St||(St=createBox()),copyBoxInto(St,this.relativeTarget)),At&&(this.animationValues=xt,mixValues(xt,ft,this.latestValues,Ht,It,Tt)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Ht},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(at){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(cancelFrame(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=frame.update(()=>{globalProjectionState.hasAnimatedSinceResize=!0,this.currentAnimation=animateSingleValue(0,animationTarget,{...at,onUpdate:h=>{this.mixTargetDelta(h),at.onUpdate&&at.onUpdate(h)},onComplete:()=>{at.onComplete&&at.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const at=this.getStack();at&&at.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(animationTarget),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const at=this.getLead();let{targetWithTransforms:h,target:dt,layout:ft,latestValues:xt}=at;if(!(!h||!dt||!ft)){if(this!==at&&this.layout&&ft&&shouldAnimatePositionOnly(this.options.animationType,this.layout.layoutBox,ft.layoutBox)){dt=this.target||createBox();const Ct=calcLength(this.layout.layoutBox.x);dt.x.min=at.target.x.min,dt.x.max=dt.x.min+Ct;const bt=calcLength(this.layout.layoutBox.y);dt.y.min=at.target.y.min,dt.y.max=dt.y.min+bt}copyBoxInto(h,dt),transformBox(h,xt),calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,h,xt)}}registerSharedNode(at,h){this.sharedNodes.has(at)||this.sharedNodes.set(at,new NodeStack),this.sharedNodes.get(at).add(h);const ft=h.options.initialPromotionConfig;h.promote({transition:ft?ft.transition:void 0,preserveFollowOpacity:ft&&ft.shouldPreserveFollowOpacity?ft.shouldPreserveFollowOpacity(h):void 0})}isLead(){const at=this.getStack();return at?at.lead===this:!0}getLead(){var at;const{layoutId:h}=this.options;return h?((at=this.getStack())===null||at===void 0?void 0:at.lead)||this:this}getPrevLead(){var at;const{layoutId:h}=this.options;return h?(at=this.getStack())===null||at===void 0?void 0:at.prevLead:void 0}getStack(){const{layoutId:at}=this.options;if(at)return this.root.sharedNodes.get(at)}promote({needsReset:at,transition:h,preserveFollowOpacity:dt}={}){const ft=this.getStack();ft&&ft.promote(this,dt),at&&(this.projectionDelta=void 0,this.needsReset=!0),h&&this.setOptions({transition:h})}relegate(){const at=this.getStack();return at?at.relegate(this):!1}resetSkewAndRotation(){const{visualElement:at}=this.options;if(!at)return;let h=!1;const{latestValues:dt}=at;if((dt.z||dt.rotate||dt.rotateX||dt.rotateY||dt.rotateZ||dt.skewX||dt.skewY)&&(h=!0),!h)return;const ft={};dt.z&&resetDistortingTransform("z",at,ft,this.animationValues);for(let xt=0;xt<transformAxes.length;xt++)resetDistortingTransform(`rotate${transformAxes[xt]}`,at,ft,this.animationValues),resetDistortingTransform(`skew${transformAxes[xt]}`,at,ft,this.animationValues);at.render();for(const xt in ft)at.setStaticValue(xt,ft[xt]),this.animationValues&&(this.animationValues[xt]=ft[xt]);at.scheduleRender()}getProjectionStyles(at){var h,dt;if(!this.instance||this.isSVG)return;if(!this.isVisible)return hiddenVisibility;const ft={visibility:""},xt=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,ft.opacity="",ft.pointerEvents=resolveMotionValue(at==null?void 0:at.pointerEvents)||"",ft.transform=xt?xt(this.latestValues,""):"none",ft;const Ct=this.getLead();if(!this.projectionDelta||!this.layout||!Ct.target){const At={};return this.options.layoutId&&(At.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,At.pointerEvents=resolveMotionValue(at==null?void 0:at.pointerEvents)||""),this.hasProjected&&!hasTransform(this.latestValues)&&(At.transform=xt?xt({},""):"none",this.hasProjected=!1),At}const bt=Ct.animationValues||Ct.latestValues;this.applyTransformsToTarget(),ft.transform=buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,bt),xt&&(ft.transform=xt(bt,ft.transform));const{x:kt,y:Dt}=this.projectionDelta;ft.transformOrigin=`${kt.origin*100}% ${Dt.origin*100}% 0`,Ct.animationValues?ft.opacity=Ct===this?(dt=(h=bt.opacity)!==null&&h!==void 0?h:this.latestValues.opacity)!==null&&dt!==void 0?dt:1:this.preserveOpacity?this.latestValues.opacity:bt.opacityExit:ft.opacity=Ct===this?bt.opacity!==void 0?bt.opacity:"":bt.opacityExit!==void 0?bt.opacityExit:0;for(const At in scaleCorrectors){if(bt[At]===void 0)continue;const{correct:Bt,applyTo:Tt}=scaleCorrectors[At],It=ft.transform==="none"?bt[At]:Bt(bt[At],Ct);if(Tt){const St=Tt.length;for(let jt=0;jt<St;jt++)ft[Tt[jt]]=It}else ft[At]=It}return this.options.layoutId&&(ft.pointerEvents=Ct===this?resolveMotionValue(at==null?void 0:at.pointerEvents)||"":"none"),ft}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(at=>{var h;return(h=at.currentAnimation)===null||h===void 0?void 0:h.stop()}),this.root.nodes.forEach(clearMeasurements),this.root.sharedNodes.clear()}}}function updateLayout(e){e.updateLayout()}function notifyLayoutUpdate(e){var i;const c=((i=e.resumeFrom)===null||i===void 0?void 0:i.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&c&&e.hasListeners("didUpdate")){const{layoutBox:b,measuredBox:$}=e.layout,{animationType:it}=e.options,at=c.source!==e.layout.source;it==="size"?eachAxis(Ct=>{const bt=at?c.measuredBox[Ct]:c.layoutBox[Ct],kt=calcLength(bt);bt.min=b[Ct].min,bt.max=bt.min+kt}):shouldAnimatePositionOnly(it,c.layoutBox,b)&&eachAxis(Ct=>{const bt=at?c.measuredBox[Ct]:c.layoutBox[Ct],kt=calcLength(b[Ct]);bt.max=bt.min+kt,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[Ct].max=e.relativeTarget[Ct].min+kt)});const h=createDelta();calcBoxDelta(h,b,c.layoutBox);const dt=createDelta();at?calcBoxDelta(dt,e.applyTransform($,!0),c.measuredBox):calcBoxDelta(dt,b,c.layoutBox);const ft=!isDeltaZero(h);let xt=!1;if(!e.resumeFrom){const Ct=e.getClosestProjectingParent();if(Ct&&!Ct.resumeFrom){const{snapshot:bt,layout:kt}=Ct;if(bt&&kt){const Dt=createBox();calcRelativePosition(Dt,c.layoutBox,bt.layoutBox);const At=createBox();calcRelativePosition(At,b,kt.layoutBox),boxEqualsRounded(Dt,At)||(xt=!0),Ct.options.layoutRoot&&(e.relativeTarget=At,e.relativeTargetOrigin=Dt,e.relativeParent=Ct)}}}e.notifyListeners("didUpdate",{layout:b,snapshot:c,delta:dt,layoutDelta:h,hasLayoutChanged:ft,hasRelativeTargetChanged:xt})}else if(e.isLead()){const{onExitComplete:b}=e.options;b&&b()}e.options.transition=void 0}function propagateDirtyNodes(e){isDebug&&metrics.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function cleanDirtyNodes(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function clearSnapshot(e){e.clearSnapshot()}function clearMeasurements(e){e.clearMeasurements()}function clearIsLayoutDirty(e){e.isLayoutDirty=!1}function resetTransformStyle(e){const{visualElement:i}=e.options;i&&i.getProps().onBeforeLayoutMeasure&&i.notify("BeforeLayoutMeasure"),e.resetTransform()}function finishAnimation(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function resolveTargetDelta(e){e.resolveTargetDelta()}function calcProjection(e){e.calcProjection()}function resetSkewAndRotation(e){e.resetSkewAndRotation()}function removeLeadSnapshots(e){e.removeLeadSnapshot()}function mixAxisDelta(e,i,c){e.translate=mixNumber$1(i.translate,0,c),e.scale=mixNumber$1(i.scale,1,c),e.origin=i.origin,e.originPoint=i.originPoint}function mixAxis(e,i,c,b){e.min=mixNumber$1(i.min,c.min,b),e.max=mixNumber$1(i.max,c.max,b)}function mixBox(e,i,c,b){mixAxis(e.x,i.x,c.x,b),mixAxis(e.y,i.y,c.y,b)}function hasOpacityCrossfade(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const defaultLayoutTransition={duration:.45,ease:[.4,0,.1,1]},userAgentContains=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),roundPoint=userAgentContains("applewebkit/")&&!userAgentContains("chrome/")?Math.round:noop;function roundAxis(e){e.min=roundPoint(e.min),e.max=roundPoint(e.max)}function roundBox(e){roundAxis(e.x),roundAxis(e.y)}function shouldAnimatePositionOnly(e,i,c){return e==="position"||e==="preserve-aspect"&&!isNear(aspectRatio(i),aspectRatio(c),.2)}function checkNodeWasScrollRoot(e){var i;return e!==e.root&&((i=e.scroll)===null||i===void 0?void 0:i.wasRoot)}const DocumentProjectionNode=createProjectionNode({attachResizeListener:(e,i)=>addDomEvent(e,"resize",i),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rootProjectionNode={current:void 0},HTMLProjectionNode=createProjectionNode({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!rootProjectionNode.current){const e=new DocumentProjectionNode({});e.mount(window),e.setOptions({layoutScroll:!0}),rootProjectionNode.current=e}return rootProjectionNode.current},resetTransform:(e,i)=>{e.style.transform=i!==void 0?i:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),drag={pan:{Feature:PanGesture},drag:{Feature:DragGesture,ProjectionNode:HTMLProjectionNode,MeasureLayout}};function handleHoverEvent(e,i,c){const{props:b}=e;e.animationState&&b.whileHover&&e.animationState.setActive("whileHover",c==="Start");const $="onHover"+c,it=b[$];it&&frame.postRender(()=>it(i,extractEventInfo(i)))}class HoverGesture extends Feature{mount(){const{current:i}=this.node;i&&(this.unmount=hover(i,c=>(handleHoverEvent(this.node,c,"Start"),b=>handleHoverEvent(this.node,b,"End"))))}unmount(){}}class FocusGesture extends Feature{constructor(){super(...arguments),this.isActive=!1}onFocus(){let i=!1;try{i=this.node.current.matches(":focus-visible")}catch{i=!0}!i||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pipe(addDomEvent(this.node.current,"focus",()=>this.onFocus()),addDomEvent(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function handlePressEvent(e,i,c){const{props:b}=e;e.animationState&&b.whileTap&&e.animationState.setActive("whileTap",c==="Start");const $="onTap"+(c==="End"?"":c),it=b[$];it&&frame.postRender(()=>it(i,extractEventInfo(i)))}class PressGesture extends Feature{mount(){const{current:i}=this.node;i&&(this.unmount=press(i,c=>(handlePressEvent(this.node,c,"Start"),(b,{success:$})=>handlePressEvent(this.node,b,$?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const observerCallbacks=new WeakMap,observers=new WeakMap,fireObserverCallback=e=>{const i=observerCallbacks.get(e.target);i&&i(e)},fireAllObserverCallbacks=e=>{e.forEach(fireObserverCallback)};function initIntersectionObserver({root:e,...i}){const c=e||document;observers.has(c)||observers.set(c,{});const b=observers.get(c),$=JSON.stringify(i);return b[$]||(b[$]=new IntersectionObserver(fireAllObserverCallbacks,{root:e,...i})),b[$]}function observeIntersection(e,i,c){const b=initIntersectionObserver(i);return observerCallbacks.set(e,c),b.observe(e),()=>{observerCallbacks.delete(e),b.unobserve(e)}}const thresholdNames={some:0,all:1};class InViewFeature extends Feature{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:i={}}=this.node.getProps(),{root:c,margin:b,amount:$="some",once:it}=i,at={root:c?c.current:void 0,rootMargin:b,threshold:typeof $=="number"?$:thresholdNames[$]},h=dt=>{const{isIntersecting:ft}=dt;if(this.isInView===ft||(this.isInView=ft,it&&!ft&&this.hasEnteredView))return;ft&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",ft);const{onViewportEnter:xt,onViewportLeave:Ct}=this.node.getProps(),bt=ft?xt:Ct;bt&&bt(dt)};return observeIntersection(this.node.current,at,h)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:i,prevProps:c}=this.node;["amount","margin","root"].some(hasViewportOptionChanged(i,c))&&this.startObserver()}unmount(){}}function hasViewportOptionChanged({viewport:e={}},{viewport:i={}}={}){return c=>e[c]!==i[c]}const gestureAnimations={inView:{Feature:InViewFeature},tap:{Feature:PressGesture},focus:{Feature:FocusGesture},hover:{Feature:HoverGesture}},layout={layout:{ProjectionNode:HTMLProjectionNode,MeasureLayout}},prefersReducedMotion={current:null},hasReducedMotionListener={current:!1};function initPrefersReducedMotion(){if(hasReducedMotionListener.current=!0,!!isBrowser)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),i=()=>prefersReducedMotion.current=e.matches;e.addListener(i),i()}else prefersReducedMotion.current=!1}const valueTypes=[...dimensionValueTypes,color,complex],findValueType=e=>valueTypes.find(testValueType(e)),visualElementStore=new WeakMap;function updateMotionValuesFromProps(e,i,c){for(const b in i){const $=i[b],it=c[b];if(isMotionValue($))e.addValue(b,$);else if(isMotionValue(it))e.addValue(b,motionValue($,{owner:e}));else if(it!==$)if(e.hasValue(b)){const at=e.getValue(b);at.liveStyle===!0?at.jump($):at.hasAnimated||at.set($)}else{const at=e.getStaticValue(b);e.addValue(b,motionValue(at!==void 0?at:$,{owner:e}))}}for(const b in c)i[b]===void 0&&e.removeValue(b);return i}const propEventHandlers=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class VisualElement{scrapeMotionValuesFromProps(i,c,b){return{}}constructor({parent:i,props:c,presenceContext:b,reducedMotionConfig:$,blockInitialAnimation:it,visualState:at},h={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=KeyframeResolver,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const kt=time.now();this.renderScheduledAt<kt&&(this.renderScheduledAt=kt,frame.render(this.render,!1,!0))};const{latestValues:dt,renderState:ft,onUpdate:xt}=at;this.onUpdate=xt,this.latestValues=dt,this.baseTarget={...dt},this.initialValues=c.initial?{...dt}:{},this.renderState=ft,this.parent=i,this.props=c,this.presenceContext=b,this.depth=i?i.depth+1:0,this.reducedMotionConfig=$,this.options=h,this.blockInitialAnimation=!!it,this.isControllingVariants=isControllingVariants(c),this.isVariantNode=isVariantNode(c),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(i&&i.current);const{willChange:Ct,...bt}=this.scrapeMotionValuesFromProps(c,{},this);for(const kt in bt){const Dt=bt[kt];dt[kt]!==void 0&&isMotionValue(Dt)&&Dt.set(dt[kt],!1)}}mount(i){this.current=i,visualElementStore.set(i,this),this.projection&&!this.projection.instance&&this.projection.mount(i),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((c,b)=>this.bindToMotionValue(b,c)),hasReducedMotionListener.current||initPrefersReducedMotion(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:prefersReducedMotion.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){visualElementStore.delete(this.current),this.projection&&this.projection.unmount(),cancelFrame(this.notifyUpdate),cancelFrame(this.render),this.valueSubscriptions.forEach(i=>i()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const i in this.events)this.events[i].clear();for(const i in this.features){const c=this.features[i];c&&(c.unmount(),c.isMounted=!1)}this.current=null}bindToMotionValue(i,c){this.valueSubscriptions.has(i)&&this.valueSubscriptions.get(i)();const b=transformProps.has(i),$=c.on("change",h=>{this.latestValues[i]=h,this.props.onUpdate&&frame.preRender(this.notifyUpdate),b&&this.projection&&(this.projection.isTransformDirty=!0)}),it=c.on("renderRequest",this.scheduleRender);let at;window.MotionCheckAppearSync&&(at=window.MotionCheckAppearSync(this,i,c)),this.valueSubscriptions.set(i,()=>{$(),it(),at&&at(),c.owner&&c.stop()})}sortNodePosition(i){return!this.current||!this.sortInstanceNodePosition||this.type!==i.type?0:this.sortInstanceNodePosition(this.current,i.current)}updateFeatures(){let i="animation";for(i in featureDefinitions){const c=featureDefinitions[i];if(!c)continue;const{isEnabled:b,Feature:$}=c;if(!this.features[i]&&$&&b(this.props)&&(this.features[i]=new $(this)),this.features[i]){const it=this.features[i];it.isMounted?it.update():(it.mount(),it.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):createBox()}getStaticValue(i){return this.latestValues[i]}setStaticValue(i,c){this.latestValues[i]=c}update(i,c){(i.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=i,this.prevPresenceContext=this.presenceContext,this.presenceContext=c;for(let b=0;b<propEventHandlers.length;b++){const $=propEventHandlers[b];this.propEventSubscriptions[$]&&(this.propEventSubscriptions[$](),delete this.propEventSubscriptions[$]);const it="on"+$,at=i[it];at&&(this.propEventSubscriptions[$]=this.on($,at))}this.prevMotionValues=updateMotionValuesFromProps(this,this.scrapeMotionValuesFromProps(i,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(i){return this.props.variants?this.props.variants[i]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(i){const c=this.getClosestVariantNode();if(c)return c.variantChildren&&c.variantChildren.add(i),()=>c.variantChildren.delete(i)}addValue(i,c){const b=this.values.get(i);c!==b&&(b&&this.removeValue(i),this.bindToMotionValue(i,c),this.values.set(i,c),this.latestValues[i]=c.get())}removeValue(i){this.values.delete(i);const c=this.valueSubscriptions.get(i);c&&(c(),this.valueSubscriptions.delete(i)),delete this.latestValues[i],this.removeValueFromRenderState(i,this.renderState)}hasValue(i){return this.values.has(i)}getValue(i,c){if(this.props.values&&this.props.values[i])return this.props.values[i];let b=this.values.get(i);return b===void 0&&c!==void 0&&(b=motionValue(c===null?void 0:c,{owner:this}),this.addValue(i,b)),b}readValue(i,c){var b;let $=this.latestValues[i]!==void 0||!this.current?this.latestValues[i]:(b=this.getBaseTargetFromProps(this.props,i))!==null&&b!==void 0?b:this.readValueFromInstance(this.current,i,this.options);return $!=null&&(typeof $=="string"&&(isNumericalString($)||isZeroValueString($))?$=parseFloat($):!findValueType($)&&complex.test(c)&&($=getAnimatableNone(i,c)),this.setBaseTarget(i,isMotionValue($)?$.get():$)),isMotionValue($)?$.get():$}setBaseTarget(i,c){this.baseTarget[i]=c}getBaseTarget(i){var c;const{initial:b}=this.props;let $;if(typeof b=="string"||typeof b=="object"){const at=resolveVariantFromProps(this.props,b,(c=this.presenceContext)===null||c===void 0?void 0:c.custom);at&&($=at[i])}if(b&&$!==void 0)return $;const it=this.getBaseTargetFromProps(this.props,i);return it!==void 0&&!isMotionValue(it)?it:this.initialValues[i]!==void 0&&$===void 0?void 0:this.baseTarget[i]}on(i,c){return this.events[i]||(this.events[i]=new SubscriptionManager),this.events[i].add(c)}notify(i,...c){this.events[i]&&this.events[i].notify(...c)}}class DOMVisualElement extends VisualElement{constructor(){super(...arguments),this.KeyframeResolver=DOMKeyframesResolver}sortInstanceNodePosition(i,c){return i.compareDocumentPosition(c)&2?1:-1}getBaseTargetFromProps(i,c){return i.style?i.style[c]:void 0}removeValueFromRenderState(i,{vars:c,style:b}){delete c[i],delete b[i]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:i}=this.props;isMotionValue(i)&&(this.childSubscription=i.on("change",c=>{this.current&&(this.current.textContent=`${c}`)}))}}function getComputedStyle$1(e){return window.getComputedStyle(e)}class HTMLVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="html",this.renderInstance=renderHTML}readValueFromInstance(i,c){if(transformProps.has(c)){const b=getDefaultValueType(c);return b&&b.default||0}else{const b=getComputedStyle$1(i),$=(isCSSVariableName(c)?b.getPropertyValue(c):b[c])||0;return typeof $=="string"?$.trim():$}}measureInstanceViewportBox(i,{transformPagePoint:c}){return measureViewportBox(i,c)}build(i,c,b){buildHTMLStyles(i,c,b.transformTemplate)}scrapeMotionValuesFromProps(i,c,b){return scrapeMotionValuesFromProps$1(i,c,b)}}class SVGVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=createBox}getBaseTargetFromProps(i,c){return i[c]}readValueFromInstance(i,c){if(transformProps.has(c)){const b=getDefaultValueType(c);return b&&b.default||0}return c=camelCaseAttributes.has(c)?c:camelToDash(c),i.getAttribute(c)}scrapeMotionValuesFromProps(i,c,b){return scrapeMotionValuesFromProps(i,c,b)}build(i,c,b){buildSVGAttrs(i,c,this.isSVGTag,b.transformTemplate)}renderInstance(i,c,b,$){renderSVG(i,c,b,$)}mount(i){this.isSVGTag=isSVGTag(i.tagName),super.mount(i)}}const createDomVisualElement=(e,i)=>isSVGComponent(e)?new SVGVisualElement(i):new HTMLVisualElement(i,{allowProjection:e!==reactExports.Fragment}),createMotionComponent=createMotionComponentFactory({...animations,...gestureAnimations,...drag,...layout},createDomVisualElement),motion=createDOMMotionComponentProxy(createMotionComponent);function useMotionValue(e){const i=useConstant(()=>motionValue(e)),{isStatic:c}=reactExports.useContext(MotionConfigContext);if(c){const[,b]=reactExports.useState(e);reactExports.useEffect(()=>i.on("change",b),[])}return i}function useCombineMotionValues(e,i){const c=useMotionValue(i()),b=()=>c.set(i());return b(),useIsomorphicLayoutEffect$1(()=>{const $=()=>frame.preRender(b,!1,!0),it=e.map(at=>at.on("change",$));return()=>{it.forEach(at=>at()),cancelFrame(b)}}),c}function toNumber(e){return typeof e=="number"?e:parseFloat(e)}function useSpring(e,i={}){const{isStatic:c}=reactExports.useContext(MotionConfigContext),b=reactExports.useRef(null),$=useMotionValue(isMotionValue(e)?toNumber(e.get()):e),it=reactExports.useRef($.get()),at=reactExports.useRef(()=>{}),h=()=>{const ft=b.current;ft&&ft.time===0&&ft.sample(frameData.delta),dt(),b.current=animateValue({keyframes:[$.get(),it.current],velocity:$.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...i,onUpdate:at.current})},dt=()=>{b.current&&b.current.stop()};return reactExports.useInsertionEffect(()=>$.attach((ft,xt)=>c?xt(ft):(it.current=ft,at.current=xt,frame.update(h),$.get()),dt),[JSON.stringify(i)]),useIsomorphicLayoutEffect$1(()=>{if(isMotionValue(e))return e.on("change",ft=>$.set(toNumber(ft)))},[$]),$}const isCustomValueType=e=>e&&typeof e=="object"&&e.mix,getMixer=e=>isCustomValueType(e)?e.mix:void 0;function transform(...e){const i=!Array.isArray(e[0]),c=i?0:-1,b=e[0+c],$=e[1+c],it=e[2+c],at=e[3+c],h=interpolate($,it,{mixer:getMixer(it[0]),...at});return i?h(b):h}function useComputed(e){collectMotionValues.current=[],e();const i=useCombineMotionValues(collectMotionValues.current,e);return collectMotionValues.current=void 0,i}function useTransform(e,i,c,b){if(typeof e=="function")return useComputed(e);const $=typeof i=="function"?i:transform(i,c,b);return Array.isArray(e)?useListTransform(e,$):useListTransform([e],([it])=>$(it))}function useListTransform(e,i){const c=useConstant(()=>[]);return useCombineMotionValues(e,()=>{c.length=0;const b=e.length;for(let $=0;$<b;$++)c[$]=e[$].get();return i(c)})}function AnimatedCounter({value:e,duration:i=1,className:c="",suffix:b=""}){const $=useSpring(0,{mass:.8,stiffness:75,damping:15,duration:i*1e3}),it=useTransform($,at=>Math.round(at).toLocaleString());return reactExports.useEffect(()=>{$.set(e)},[$,e]),jsxRuntimeExports.jsxs(motion.span,{className:c,children:[jsxRuntimeExports.jsx(motion.span,{children:it}),b&&jsxRuntimeExports.jsx("span",{children:b})]})}const pageVariants={initial:{opacity:0,y:24,filter:"blur(6px)"},in:{opacity:1,y:0,filter:"blur(0px)"},out:{opacity:0,y:-24,filter:"blur(6px)"}},pageTransition={type:"spring",stiffness:220,damping:28,mass:.9,delay:.02};function PageTransition({children:e}){return jsxRuntimeExports.jsx(motion.div,{initial:"initial",animate:"in",exit:"out",variants:pageVariants,transition:pageTransition,children:e})}function Skeleton({className:e=""}){return jsxRuntimeExports.jsx(motion.div,{className:`bg-gray-200 dark:bg-gray-700 rounded ${e}`,animate:{opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}})}function CardSkeleton(){return jsxRuntimeExports.jsxs("div",{className:"neuropad-card p-4 shadow-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-3",children:[jsxRuntimeExports.jsx(Skeleton,{className:"w-10 h-10 rounded-full"}),jsxRuntimeExports.jsx(Skeleton,{className:"w-8 h-8 rounded-full"})]}),jsxRuntimeExports.jsx(Skeleton,{className:"h-4 w-20 mb-1"}),jsxRuntimeExports.jsx(Skeleton,{className:"h-6 w-24 mb-3"}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx(Skeleton,{className:"w-16 h-1 rounded-full"}),jsxRuntimeExports.jsx(Skeleton,{className:"w-16 h-8 rounded-full"})]})]})}function ArticleSkeleton(){return jsxRuntimeExports.jsx("div",{className:"neuropad-card p-4 shadow-sm",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx(Skeleton,{className:"w-20 h-20 rounded-lg flex-shrink-0"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx(Skeleton,{className:"h-5 w-full mb-2"}),jsxRuntimeExports.jsx(Skeleton,{className:"h-4 w-full mb-1"}),jsxRuntimeExports.jsx(Skeleton,{className:"h-4 w-3/4 mb-2"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Skeleton,{className:"h-5 w-16 rounded"}),jsxRuntimeExports.jsx(Skeleton,{className:"h-5 w-12 rounded"})]})]})]})})}const badgeVariants=cva("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Badge({className:e,variant:i,...c}){return jsxRuntimeExports.jsx("div",{className:cn(badgeVariants({variant:i}),e),...c})}var AUTOFOCUS_ON_MOUNT="focusScope.autoFocusOnMount",AUTOFOCUS_ON_UNMOUNT="focusScope.autoFocusOnUnmount",EVENT_OPTIONS={bubbles:!1,cancelable:!0},FOCUS_SCOPE_NAME="FocusScope",FocusScope=reactExports.forwardRef((e,i)=>{const{loop:c=!1,trapped:b=!1,onMountAutoFocus:$,onUnmountAutoFocus:it,...at}=e,[h,dt]=reactExports.useState(null),ft=useCallbackRef$1($),xt=useCallbackRef$1(it),Ct=reactExports.useRef(null),bt=useComposedRefs(i,At=>dt(At)),kt=reactExports.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;reactExports.useEffect(()=>{if(b){let At=function(St){if(kt.paused||!h)return;const jt=St.target;h.contains(jt)?Ct.current=jt:focus(Ct.current,{select:!0})},Bt=function(St){if(kt.paused||!h)return;const jt=St.relatedTarget;jt!==null&&(h.contains(jt)||focus(Ct.current,{select:!0}))},Tt=function(St){if(document.activeElement===document.body)for(const Ht of St)Ht.removedNodes.length>0&&focus(h)};document.addEventListener("focusin",At),document.addEventListener("focusout",Bt);const It=new MutationObserver(Tt);return h&&It.observe(h,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",At),document.removeEventListener("focusout",Bt),It.disconnect()}}},[b,h,kt.paused]),reactExports.useEffect(()=>{if(h){focusScopesStack.add(kt);const At=document.activeElement;if(!h.contains(At)){const Tt=new CustomEvent(AUTOFOCUS_ON_MOUNT,EVENT_OPTIONS);h.addEventListener(AUTOFOCUS_ON_MOUNT,ft),h.dispatchEvent(Tt),Tt.defaultPrevented||(focusFirst(removeLinks(getTabbableCandidates(h)),{select:!0}),document.activeElement===At&&focus(h))}return()=>{h.removeEventListener(AUTOFOCUS_ON_MOUNT,ft),setTimeout(()=>{const Tt=new CustomEvent(AUTOFOCUS_ON_UNMOUNT,EVENT_OPTIONS);h.addEventListener(AUTOFOCUS_ON_UNMOUNT,xt),h.dispatchEvent(Tt),Tt.defaultPrevented||focus(At??document.body,{select:!0}),h.removeEventListener(AUTOFOCUS_ON_UNMOUNT,xt),focusScopesStack.remove(kt)},0)}}},[h,ft,xt,kt]);const Dt=reactExports.useCallback(At=>{if(!c&&!b||kt.paused)return;const Bt=At.key==="Tab"&&!At.altKey&&!At.ctrlKey&&!At.metaKey,Tt=document.activeElement;if(Bt&&Tt){const It=At.currentTarget,[St,jt]=getTabbableEdges(It);St&&jt?!At.shiftKey&&Tt===jt?(At.preventDefault(),c&&focus(St,{select:!0})):At.shiftKey&&Tt===St&&(At.preventDefault(),c&&focus(jt,{select:!0})):Tt===It&&At.preventDefault()}},[c,b,kt.paused]);return jsxRuntimeExports.jsx(Primitive.div,{tabIndex:-1,...at,ref:bt,onKeyDown:Dt})});FocusScope.displayName=FOCUS_SCOPE_NAME;function focusFirst(e,{select:i=!1}={}){const c=document.activeElement;for(const b of e)if(focus(b,{select:i}),document.activeElement!==c)return}function getTabbableEdges(e){const i=getTabbableCandidates(e),c=findVisible(i,e),b=findVisible(i.reverse(),e);return[c,b]}function getTabbableCandidates(e){const i=[],c=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:b=>{const $=b.tagName==="INPUT"&&b.type==="hidden";return b.disabled||b.hidden||$?NodeFilter.FILTER_SKIP:b.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;c.nextNode();)i.push(c.currentNode);return i}function findVisible(e,i){for(const c of e)if(!isHidden(c,{upTo:i}))return c}function isHidden(e,{upTo:i}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(i!==void 0&&e===i)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function isSelectableInput(e){return e instanceof HTMLInputElement&&"select"in e}function focus(e,{select:i=!1}={}){if(e&&e.focus){const c=document.activeElement;e.focus({preventScroll:!0}),e!==c&&isSelectableInput(e)&&i&&e.select()}}var focusScopesStack=createFocusScopesStack();function createFocusScopesStack(){let e=[];return{add(i){const c=e[0];i!==c&&(c==null||c.pause()),e=arrayRemove(e,i),e.unshift(i)},remove(i){var c;e=arrayRemove(e,i),(c=e[0])==null||c.resume()}}}function arrayRemove(e,i){const c=[...e],b=c.indexOf(i);return b!==-1&&c.splice(b,1),c}function removeLinks(e){return e.filter(i=>i.tagName!=="A")}var count=0;function useFocusGuards(){reactExports.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??createFocusGuard()),document.body.insertAdjacentElement("beforeend",e[1]??createFocusGuard()),count++,()=>{count===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(i=>i.remove()),count--}},[])}function createFocusGuard(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var __assign=function(){return __assign=Object.assign||function(i){for(var c,b=1,$=arguments.length;b<$;b++){c=arguments[b];for(var it in c)Object.prototype.hasOwnProperty.call(c,it)&&(i[it]=c[it])}return i},__assign.apply(this,arguments)};function __rest(e,i){var c={};for(var b in e)Object.prototype.hasOwnProperty.call(e,b)&&i.indexOf(b)<0&&(c[b]=e[b]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var $=0,b=Object.getOwnPropertySymbols(e);$<b.length;$++)i.indexOf(b[$])<0&&Object.prototype.propertyIsEnumerable.call(e,b[$])&&(c[b[$]]=e[b[$]]);return c}function __spreadArray(e,i,c){if(c||arguments.length===2)for(var b=0,$=i.length,it;b<$;b++)(it||!(b in i))&&(it||(it=Array.prototype.slice.call(i,0,b)),it[b]=i[b]);return e.concat(it||Array.prototype.slice.call(i))}typeof SuppressedError=="function"&&SuppressedError;var zeroRightClassName="right-scroll-bar-position",fullWidthClassName="width-before-scroll-bar",noScrollbarsClassName="with-scroll-bars-hidden",removedBarSizeVariable="--removed-body-scroll-bar-size";function assignRef(e,i){return typeof e=="function"?e(i):e&&(e.current=i),e}function useCallbackRef(e,i){var c=reactExports.useState(function(){return{value:e,callback:i,facade:{get current(){return c.value},set current(b){var $=c.value;$!==b&&(c.value=b,c.callback(b,$))}}}})[0];return c.callback=i,c.facade}var useIsomorphicLayoutEffect=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect,currentValues=new WeakMap;function useMergeRefs(e,i){var c=useCallbackRef(i||null,function(b){return e.forEach(function($){return assignRef($,b)})});return useIsomorphicLayoutEffect(function(){var b=currentValues.get(c);if(b){var $=new Set(b),it=new Set(e),at=c.current;$.forEach(function(h){it.has(h)||assignRef(h,null)}),it.forEach(function(h){$.has(h)||assignRef(h,at)})}currentValues.set(c,e)},[e]),c}function ItoI(e){return e}function innerCreateMedium(e,i){i===void 0&&(i=ItoI);var c=[],b=!1,$={read:function(){if(b)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return c.length?c[c.length-1]:e},useMedium:function(it){var at=i(it,b);return c.push(at),function(){c=c.filter(function(h){return h!==at})}},assignSyncMedium:function(it){for(b=!0;c.length;){var at=c;c=[],at.forEach(it)}c={push:function(h){return it(h)},filter:function(){return c}}},assignMedium:function(it){b=!0;var at=[];if(c.length){var h=c;c=[],h.forEach(it),at=c}var dt=function(){var xt=at;at=[],xt.forEach(it)},ft=function(){return Promise.resolve().then(dt)};ft(),c={push:function(xt){at.push(xt),ft()},filter:function(xt){return at=at.filter(xt),c}}}};return $}function createSidecarMedium(e){e===void 0&&(e={});var i=innerCreateMedium(null);return i.options=__assign({async:!0,ssr:!1},e),i}var SideCar$1=function(e){var i=e.sideCar,c=__rest(e,["sideCar"]);if(!i)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var b=i.read();if(!b)throw new Error("Sidecar medium not found");return reactExports.createElement(b,__assign({},c))};SideCar$1.isSideCarExport=!0;function exportSidecar(e,i){return e.useMedium(i),SideCar$1}var effectCar=createSidecarMedium(),nothing=function(){},RemoveScroll$1=reactExports.forwardRef(function(e,i){var c=reactExports.useRef(null),b=reactExports.useState({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),$=b[0],it=b[1],at=e.forwardProps,h=e.children,dt=e.className,ft=e.removeScrollBar,xt=e.enabled,Ct=e.shards,bt=e.sideCar,kt=e.noRelative,Dt=e.noIsolation,At=e.inert,Bt=e.allowPinchZoom,Tt=e.as,It=Tt===void 0?"div":Tt,St=e.gapMode,jt=__rest(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),Ht=bt,Kt=useMergeRefs([c,i]),ir=__assign(__assign({},jt),$);return reactExports.createElement(reactExports.Fragment,null,xt&&reactExports.createElement(Ht,{sideCar:effectCar,removeScrollBar:ft,shards:Ct,noRelative:kt,noIsolation:Dt,inert:At,setCallbacks:it,allowPinchZoom:!!Bt,lockRef:c,gapMode:St}),at?reactExports.cloneElement(reactExports.Children.only(h),__assign(__assign({},ir),{ref:Kt})):reactExports.createElement(It,__assign({},ir,{className:dt,ref:Kt}),h))});RemoveScroll$1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};RemoveScroll$1.classNames={fullWidth:fullWidthClassName,zeroRight:zeroRightClassName};var currentNonce,getNonce=function(){if(currentNonce)return currentNonce;if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function makeStyleTag(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var i=getNonce();return i&&e.setAttribute("nonce",i),e}function injectStyles(e,i){e.styleSheet?e.styleSheet.cssText=i:e.appendChild(document.createTextNode(i))}function insertStyleTag(e){var i=document.head||document.getElementsByTagName("head")[0];i.appendChild(e)}var stylesheetSingleton=function(){var e=0,i=null;return{add:function(c){e==0&&(i=makeStyleTag())&&(injectStyles(i,c),insertStyleTag(i)),e++},remove:function(){e--,!e&&i&&(i.parentNode&&i.parentNode.removeChild(i),i=null)}}},styleHookSingleton=function(){var e=stylesheetSingleton();return function(i,c){reactExports.useEffect(function(){return e.add(i),function(){e.remove()}},[i&&c])}},styleSingleton=function(){var e=styleHookSingleton(),i=function(c){var b=c.styles,$=c.dynamic;return e(b,$),null};return i},zeroGap={left:0,top:0,right:0,gap:0},parse=function(e){return parseInt(e||"",10)||0},getOffset=function(e){var i=window.getComputedStyle(document.body),c=i[e==="padding"?"paddingLeft":"marginLeft"],b=i[e==="padding"?"paddingTop":"marginTop"],$=i[e==="padding"?"paddingRight":"marginRight"];return[parse(c),parse(b),parse($)]},getGapWidth=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return zeroGap;var i=getOffset(e),c=document.documentElement.clientWidth,b=window.innerWidth;return{left:i[0],top:i[1],right:i[2],gap:Math.max(0,b-c+i[2]-i[0])}},Style=styleSingleton(),lockAttribute="data-scroll-locked",getStyles=function(e,i,c,b){var $=e.left,it=e.top,at=e.right,h=e.gap;return c===void 0&&(c="margin"),`
  .`.concat(noScrollbarsClassName,` {
   overflow: hidden `).concat(b,`;
   padding-right: `).concat(h,"px ").concat(b,`;
  }
  body[`).concat(lockAttribute,`] {
    overflow: hidden `).concat(b,`;
    overscroll-behavior: contain;
    `).concat([i&&"position: relative ".concat(b,";"),c==="margin"&&`
    padding-left: `.concat($,`px;
    padding-top: `).concat(it,`px;
    padding-right: `).concat(at,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(h,"px ").concat(b,`;
    `),c==="padding"&&"padding-right: ".concat(h,"px ").concat(b,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zeroRightClassName,` {
    right: `).concat(h,"px ").concat(b,`;
  }
  
  .`).concat(fullWidthClassName,` {
    margin-right: `).concat(h,"px ").concat(b,`;
  }
  
  .`).concat(zeroRightClassName," .").concat(zeroRightClassName,` {
    right: 0 `).concat(b,`;
  }
  
  .`).concat(fullWidthClassName," .").concat(fullWidthClassName,` {
    margin-right: 0 `).concat(b,`;
  }
  
  body[`).concat(lockAttribute,`] {
    `).concat(removedBarSizeVariable,": ").concat(h,`px;
  }
`)},getCurrentUseCounter=function(){var e=parseInt(document.body.getAttribute(lockAttribute)||"0",10);return isFinite(e)?e:0},useLockAttribute=function(){reactExports.useEffect(function(){return document.body.setAttribute(lockAttribute,(getCurrentUseCounter()+1).toString()),function(){var e=getCurrentUseCounter()-1;e<=0?document.body.removeAttribute(lockAttribute):document.body.setAttribute(lockAttribute,e.toString())}},[])},RemoveScrollBar=function(e){var i=e.noRelative,c=e.noImportant,b=e.gapMode,$=b===void 0?"margin":b;useLockAttribute();var it=reactExports.useMemo(function(){return getGapWidth($)},[$]);return reactExports.createElement(Style,{styles:getStyles(it,!i,$,c?"":"!important")})},passiveSupported=!1;if(typeof window<"u")try{var options=Object.defineProperty({},"passive",{get:function(){return passiveSupported=!0,!0}});window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch{passiveSupported=!1}var nonPassive=passiveSupported?{passive:!1}:!1,alwaysContainsScroll=function(e){return e.tagName==="TEXTAREA"},elementCanBeScrolled=function(e,i){if(!(e instanceof Element))return!1;var c=window.getComputedStyle(e);return c[i]!=="hidden"&&!(c.overflowY===c.overflowX&&!alwaysContainsScroll(e)&&c[i]==="visible")},elementCouldBeVScrolled=function(e){return elementCanBeScrolled(e,"overflowY")},elementCouldBeHScrolled=function(e){return elementCanBeScrolled(e,"overflowX")},locationCouldBeScrolled=function(e,i){var c=i.ownerDocument,b=i;do{typeof ShadowRoot<"u"&&b instanceof ShadowRoot&&(b=b.host);var $=elementCouldBeScrolled(e,b);if($){var it=getScrollVariables(e,b),at=it[1],h=it[2];if(at>h)return!0}b=b.parentNode}while(b&&b!==c.body);return!1},getVScrollVariables=function(e){var i=e.scrollTop,c=e.scrollHeight,b=e.clientHeight;return[i,c,b]},getHScrollVariables=function(e){var i=e.scrollLeft,c=e.scrollWidth,b=e.clientWidth;return[i,c,b]},elementCouldBeScrolled=function(e,i){return e==="v"?elementCouldBeVScrolled(i):elementCouldBeHScrolled(i)},getScrollVariables=function(e,i){return e==="v"?getVScrollVariables(i):getHScrollVariables(i)},getDirectionFactor=function(e,i){return e==="h"&&i==="rtl"?-1:1},handleScroll=function(e,i,c,b,$){var it=getDirectionFactor(e,window.getComputedStyle(i).direction),at=it*b,h=c.target,dt=i.contains(h),ft=!1,xt=at>0,Ct=0,bt=0;do{if(!h)break;var kt=getScrollVariables(e,h),Dt=kt[0],At=kt[1],Bt=kt[2],Tt=At-Bt-it*Dt;(Dt||Tt)&&elementCouldBeScrolled(e,h)&&(Ct+=Tt,bt+=Dt);var It=h.parentNode;h=It&&It.nodeType===Node.DOCUMENT_FRAGMENT_NODE?It.host:It}while(!dt&&h!==document.body||dt&&(i.contains(h)||i===h));return(xt&&($&&Math.abs(Ct)<1||!$&&at>Ct)||!xt&&($&&Math.abs(bt)<1||!$&&-at>bt))&&(ft=!0),ft},getTouchXY=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},getDeltaXY=function(e){return[e.deltaX,e.deltaY]},extractRef=function(e){return e&&"current"in e?e.current:e},deltaCompare=function(e,i){return e[0]===i[0]&&e[1]===i[1]},generateStyle=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},idCounter=0,lockStack=[];function RemoveScrollSideCar(e){var i=reactExports.useRef([]),c=reactExports.useRef([0,0]),b=reactExports.useRef(),$=reactExports.useState(idCounter++)[0],it=reactExports.useState(styleSingleton)[0],at=reactExports.useRef(e);reactExports.useEffect(function(){at.current=e},[e]),reactExports.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat($));var At=__spreadArray([e.lockRef.current],(e.shards||[]).map(extractRef),!0).filter(Boolean);return At.forEach(function(Bt){return Bt.classList.add("allow-interactivity-".concat($))}),function(){document.body.classList.remove("block-interactivity-".concat($)),At.forEach(function(Bt){return Bt.classList.remove("allow-interactivity-".concat($))})}}},[e.inert,e.lockRef.current,e.shards]);var h=reactExports.useCallback(function(At,Bt){if("touches"in At&&At.touches.length===2||At.type==="wheel"&&At.ctrlKey)return!at.current.allowPinchZoom;var Tt=getTouchXY(At),It=c.current,St="deltaX"in At?At.deltaX:It[0]-Tt[0],jt="deltaY"in At?At.deltaY:It[1]-Tt[1],Ht,Kt=At.target,ir=Math.abs(St)>Math.abs(jt)?"h":"v";if("touches"in At&&ir==="h"&&Kt.type==="range")return!1;var nr=locationCouldBeScrolled(ir,Kt);if(!nr)return!0;if(nr?Ht=ir:(Ht=ir==="v"?"h":"v",nr=locationCouldBeScrolled(ir,Kt)),!nr)return!1;if(!b.current&&"changedTouches"in At&&(St||jt)&&(b.current=Ht),!Ht)return!0;var kr=b.current||Ht;return handleScroll(kr,Bt,At,kr==="h"?St:jt,!0)},[]),dt=reactExports.useCallback(function(At){var Bt=At;if(!(!lockStack.length||lockStack[lockStack.length-1]!==it)){var Tt="deltaY"in Bt?getDeltaXY(Bt):getTouchXY(Bt),It=i.current.filter(function(Ht){return Ht.name===Bt.type&&(Ht.target===Bt.target||Bt.target===Ht.shadowParent)&&deltaCompare(Ht.delta,Tt)})[0];if(It&&It.should){Bt.cancelable&&Bt.preventDefault();return}if(!It){var St=(at.current.shards||[]).map(extractRef).filter(Boolean).filter(function(Ht){return Ht.contains(Bt.target)}),jt=St.length>0?h(Bt,St[0]):!at.current.noIsolation;jt&&Bt.cancelable&&Bt.preventDefault()}}},[]),ft=reactExports.useCallback(function(At,Bt,Tt,It){var St={name:At,delta:Bt,target:Tt,should:It,shadowParent:getOutermostShadowParent(Tt)};i.current.push(St),setTimeout(function(){i.current=i.current.filter(function(jt){return jt!==St})},1)},[]),xt=reactExports.useCallback(function(At){c.current=getTouchXY(At),b.current=void 0},[]),Ct=reactExports.useCallback(function(At){ft(At.type,getDeltaXY(At),At.target,h(At,e.lockRef.current))},[]),bt=reactExports.useCallback(function(At){ft(At.type,getTouchXY(At),At.target,h(At,e.lockRef.current))},[]);reactExports.useEffect(function(){return lockStack.push(it),e.setCallbacks({onScrollCapture:Ct,onWheelCapture:Ct,onTouchMoveCapture:bt}),document.addEventListener("wheel",dt,nonPassive),document.addEventListener("touchmove",dt,nonPassive),document.addEventListener("touchstart",xt,nonPassive),function(){lockStack=lockStack.filter(function(At){return At!==it}),document.removeEventListener("wheel",dt,nonPassive),document.removeEventListener("touchmove",dt,nonPassive),document.removeEventListener("touchstart",xt,nonPassive)}},[]);var kt=e.removeScrollBar,Dt=e.inert;return reactExports.createElement(reactExports.Fragment,null,Dt?reactExports.createElement(it,{styles:generateStyle($)}):null,kt?reactExports.createElement(RemoveScrollBar,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function getOutermostShadowParent(e){for(var i=null;e!==null;)e instanceof ShadowRoot&&(i=e.host,e=e.host),e=e.parentNode;return i}const SideCar=exportSidecar(effectCar,RemoveScrollSideCar);var ReactRemoveScroll=reactExports.forwardRef(function(e,i){return reactExports.createElement(RemoveScroll$1,__assign({},e,{ref:i,sideCar:SideCar}))});ReactRemoveScroll.classNames=RemoveScroll$1.classNames;const RemoveScroll=ReactRemoveScroll;var getDefaultParent=function(e){if(typeof document>"u")return null;var i=Array.isArray(e)?e[0]:e;return i.ownerDocument.body},counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={},lockCount=0,unwrapHost=function(e){return e&&(e.host||unwrapHost(e.parentNode))},correctTargets=function(e,i){return i.map(function(c){if(e.contains(c))return c;var b=unwrapHost(c);return b&&e.contains(b)?b:(console.error("aria-hidden",c,"in not contained inside",e,". Doing nothing"),null)}).filter(function(c){return!!c})},applyAttributeToOthers=function(e,i,c,b){var $=correctTargets(i,Array.isArray(e)?e:[e]);markerMap[c]||(markerMap[c]=new WeakMap);var it=markerMap[c],at=[],h=new Set,dt=new Set($),ft=function(Ct){!Ct||h.has(Ct)||(h.add(Ct),ft(Ct.parentNode))};$.forEach(ft);var xt=function(Ct){!Ct||dt.has(Ct)||Array.prototype.forEach.call(Ct.children,function(bt){if(h.has(bt))xt(bt);else try{var kt=bt.getAttribute(b),Dt=kt!==null&&kt!=="false",At=(counterMap.get(bt)||0)+1,Bt=(it.get(bt)||0)+1;counterMap.set(bt,At),it.set(bt,Bt),at.push(bt),At===1&&Dt&&uncontrolledNodes.set(bt,!0),Bt===1&&bt.setAttribute(c,"true"),Dt||bt.setAttribute(b,"true")}catch(Tt){console.error("aria-hidden: cannot operate on ",bt,Tt)}})};return xt(i),h.clear(),lockCount++,function(){at.forEach(function(Ct){var bt=counterMap.get(Ct)-1,kt=it.get(Ct)-1;counterMap.set(Ct,bt),it.set(Ct,kt),bt||(uncontrolledNodes.has(Ct)||Ct.removeAttribute(b),uncontrolledNodes.delete(Ct)),kt||Ct.removeAttribute(c)}),lockCount--,lockCount||(counterMap=new WeakMap,counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={})}},hideOthers=function(e,i,c){c===void 0&&(c="data-aria-hidden");var b=Array.from(Array.isArray(e)?e:[e]),$=i||getDefaultParent(e);return $?(b.push.apply(b,Array.from($.querySelectorAll("[aria-live], script"))),applyAttributeToOthers(b,$,c,"aria-hidden")):function(){return null}},DIALOG_NAME="Dialog",[createDialogContext,createDialogScope]=createContextScope(DIALOG_NAME),[DialogProvider,useDialogContext]=createDialogContext(DIALOG_NAME),Dialog$1=e=>{const{__scopeDialog:i,children:c,open:b,defaultOpen:$,onOpenChange:it,modal:at=!0}=e,h=reactExports.useRef(null),dt=reactExports.useRef(null),[ft,xt]=useControllableState({prop:b,defaultProp:$??!1,onChange:it,caller:DIALOG_NAME});return jsxRuntimeExports.jsx(DialogProvider,{scope:i,triggerRef:h,contentRef:dt,contentId:useId(),titleId:useId(),descriptionId:useId(),open:ft,onOpenChange:xt,onOpenToggle:reactExports.useCallback(()=>xt(Ct=>!Ct),[xt]),modal:at,children:c})};Dialog$1.displayName=DIALOG_NAME;var TRIGGER_NAME="DialogTrigger",DialogTrigger=reactExports.forwardRef((e,i)=>{const{__scopeDialog:c,...b}=e,$=useDialogContext(TRIGGER_NAME,c),it=useComposedRefs(i,$.triggerRef);return jsxRuntimeExports.jsx(Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":$.open,"aria-controls":$.contentId,"data-state":getState($.open),...b,ref:it,onClick:composeEventHandlers(e.onClick,$.onOpenToggle)})});DialogTrigger.displayName=TRIGGER_NAME;var PORTAL_NAME="DialogPortal",[PortalProvider,usePortalContext]=createDialogContext(PORTAL_NAME,{forceMount:void 0}),DialogPortal$1=e=>{const{__scopeDialog:i,forceMount:c,children:b,container:$}=e,it=useDialogContext(PORTAL_NAME,i);return jsxRuntimeExports.jsx(PortalProvider,{scope:i,forceMount:c,children:reactExports.Children.map(b,at=>jsxRuntimeExports.jsx(Presence,{present:c||it.open,children:jsxRuntimeExports.jsx(Portal$1,{asChild:!0,container:$,children:at})}))})};DialogPortal$1.displayName=PORTAL_NAME;var OVERLAY_NAME="DialogOverlay",DialogOverlay$1=reactExports.forwardRef((e,i)=>{const c=usePortalContext(OVERLAY_NAME,e.__scopeDialog),{forceMount:b=c.forceMount,...$}=e,it=useDialogContext(OVERLAY_NAME,e.__scopeDialog);return it.modal?jsxRuntimeExports.jsx(Presence,{present:b||it.open,children:jsxRuntimeExports.jsx(DialogOverlayImpl,{...$,ref:i})}):null});DialogOverlay$1.displayName=OVERLAY_NAME;var Slot=createSlot("DialogOverlay.RemoveScroll"),DialogOverlayImpl=reactExports.forwardRef((e,i)=>{const{__scopeDialog:c,...b}=e,$=useDialogContext(OVERLAY_NAME,c);return jsxRuntimeExports.jsx(RemoveScroll,{as:Slot,allowPinchZoom:!0,shards:[$.contentRef],children:jsxRuntimeExports.jsx(Primitive.div,{"data-state":getState($.open),...b,ref:i,style:{pointerEvents:"auto",...b.style}})})}),CONTENT_NAME="DialogContent",DialogContent$1=reactExports.forwardRef((e,i)=>{const c=usePortalContext(CONTENT_NAME,e.__scopeDialog),{forceMount:b=c.forceMount,...$}=e,it=useDialogContext(CONTENT_NAME,e.__scopeDialog);return jsxRuntimeExports.jsx(Presence,{present:b||it.open,children:it.modal?jsxRuntimeExports.jsx(DialogContentModal,{...$,ref:i}):jsxRuntimeExports.jsx(DialogContentNonModal,{...$,ref:i})})});DialogContent$1.displayName=CONTENT_NAME;var DialogContentModal=reactExports.forwardRef((e,i)=>{const c=useDialogContext(CONTENT_NAME,e.__scopeDialog),b=reactExports.useRef(null),$=useComposedRefs(i,c.contentRef,b);return reactExports.useEffect(()=>{const it=b.current;if(it)return hideOthers(it)},[]),jsxRuntimeExports.jsx(DialogContentImpl,{...e,ref:$,trapFocus:c.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:composeEventHandlers(e.onCloseAutoFocus,it=>{var at;it.preventDefault(),(at=c.triggerRef.current)==null||at.focus()}),onPointerDownOutside:composeEventHandlers(e.onPointerDownOutside,it=>{const at=it.detail.originalEvent,h=at.button===0&&at.ctrlKey===!0;(at.button===2||h)&&it.preventDefault()}),onFocusOutside:composeEventHandlers(e.onFocusOutside,it=>it.preventDefault())})}),DialogContentNonModal=reactExports.forwardRef((e,i)=>{const c=useDialogContext(CONTENT_NAME,e.__scopeDialog),b=reactExports.useRef(!1),$=reactExports.useRef(!1);return jsxRuntimeExports.jsx(DialogContentImpl,{...e,ref:i,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:it=>{var at,h;(at=e.onCloseAutoFocus)==null||at.call(e,it),it.defaultPrevented||(b.current||(h=c.triggerRef.current)==null||h.focus(),it.preventDefault()),b.current=!1,$.current=!1},onInteractOutside:it=>{var dt,ft;(dt=e.onInteractOutside)==null||dt.call(e,it),it.defaultPrevented||(b.current=!0,it.detail.originalEvent.type==="pointerdown"&&($.current=!0));const at=it.target;((ft=c.triggerRef.current)==null?void 0:ft.contains(at))&&it.preventDefault(),it.detail.originalEvent.type==="focusin"&&$.current&&it.preventDefault()}})}),DialogContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeDialog:c,trapFocus:b,onOpenAutoFocus:$,onCloseAutoFocus:it,...at}=e,h=useDialogContext(CONTENT_NAME,c),dt=reactExports.useRef(null),ft=useComposedRefs(i,dt);return useFocusGuards(),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(FocusScope,{asChild:!0,loop:!0,trapped:b,onMountAutoFocus:$,onUnmountAutoFocus:it,children:jsxRuntimeExports.jsx(DismissableLayer,{role:"dialog",id:h.contentId,"aria-describedby":h.descriptionId,"aria-labelledby":h.titleId,"data-state":getState(h.open),...at,ref:ft,onDismiss:()=>h.onOpenChange(!1)})}),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(TitleWarning,{titleId:h.titleId}),jsxRuntimeExports.jsx(DescriptionWarning,{contentRef:dt,descriptionId:h.descriptionId})]})]})}),TITLE_NAME="DialogTitle",DialogTitle$1=reactExports.forwardRef((e,i)=>{const{__scopeDialog:c,...b}=e,$=useDialogContext(TITLE_NAME,c);return jsxRuntimeExports.jsx(Primitive.h2,{id:$.titleId,...b,ref:i})});DialogTitle$1.displayName=TITLE_NAME;var DESCRIPTION_NAME="DialogDescription",DialogDescription$1=reactExports.forwardRef((e,i)=>{const{__scopeDialog:c,...b}=e,$=useDialogContext(DESCRIPTION_NAME,c);return jsxRuntimeExports.jsx(Primitive.p,{id:$.descriptionId,...b,ref:i})});DialogDescription$1.displayName=DESCRIPTION_NAME;var CLOSE_NAME="DialogClose",DialogClose=reactExports.forwardRef((e,i)=>{const{__scopeDialog:c,...b}=e,$=useDialogContext(CLOSE_NAME,c);return jsxRuntimeExports.jsx(Primitive.button,{type:"button",...b,ref:i,onClick:composeEventHandlers(e.onClick,()=>$.onOpenChange(!1))})});DialogClose.displayName=CLOSE_NAME;function getState(e){return e?"open":"closed"}var TITLE_WARNING_NAME="DialogTitleWarning",[WarningProvider,useWarningContext]=createContext2(TITLE_WARNING_NAME,{contentName:CONTENT_NAME,titleName:TITLE_NAME,docsSlug:"dialog"}),TitleWarning=({titleId:e})=>{const i=useWarningContext(TITLE_WARNING_NAME),c=`\`${i.contentName}\` requires a \`${i.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${i.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${i.docsSlug}`;return reactExports.useEffect(()=>{e&&(document.getElementById(e)||console.error(c))},[c,e]),null},DESCRIPTION_WARNING_NAME="DialogDescriptionWarning",DescriptionWarning=({contentRef:e,descriptionId:i})=>{const b=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${useWarningContext(DESCRIPTION_WARNING_NAME).contentName}}.`;return reactExports.useEffect(()=>{var it;const $=(it=e.current)==null?void 0:it.getAttribute("aria-describedby");i&&$&&(document.getElementById(i)||console.warn(b))},[b,e,i]),null},Root=Dialog$1,Portal=DialogPortal$1,Overlay=DialogOverlay$1,Content=DialogContent$1,Title=DialogTitle$1,Description=DialogDescription$1,Close=DialogClose;const Dialog=Root,DialogPortal=Portal,DialogOverlay=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx(Overlay,{ref:c,className:cn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...i}));DialogOverlay.displayName=Overlay.displayName;const DialogContent=reactExports.forwardRef(({className:e,children:i,...c},b)=>jsxRuntimeExports.jsxs(DialogPortal,{children:[jsxRuntimeExports.jsx(DialogOverlay,{}),jsxRuntimeExports.jsxs(Content,{ref:b,className:cn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...c,children:[i,jsxRuntimeExports.jsxs(Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[jsxRuntimeExports.jsx(X,{className:"h-4 w-4"}),jsxRuntimeExports.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));DialogContent.displayName=Content.displayName;const DialogHeader=({className:e,...i})=>jsxRuntimeExports.jsx("div",{className:cn("flex flex-col space-y-1.5 text-center sm:text-left",e),...i});DialogHeader.displayName="DialogHeader";const DialogTitle=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx(Title,{ref:c,className:cn("text-lg font-semibold leading-none tracking-tight",e),...i}));DialogTitle.displayName=Title.displayName;const DialogDescription=reactExports.forwardRef(({className:e,...i},c)=>jsxRuntimeExports.jsx(Description,{ref:c,className:cn("text-sm text-muted-foreground",e),...i}));DialogDescription.displayName=Description.displayName;function InfoDialog({open:e,onOpenChange:i,title:c,description:b,content:$,icon:it}){return jsxRuntimeExports.jsx(Dialog,{open:e,onOpenChange:i,children:jsxRuntimeExports.jsx(DialogContent,{className:"sm:max-w-md neuropad-card",children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",duration:.3},children:[jsxRuntimeExports.jsxs(DialogHeader,{children:[it&&jsxRuntimeExports.jsx(motion.div,{className:"mx-auto mb-4 w-16 h-16 rounded-full neuropad-primary flex items-center justify-center",initial:{scale:0},animate:{scale:1,rotate:360},transition:{delay:.1,type:"spring",stiffness:200},children:it}),jsxRuntimeExports.jsx(DialogTitle,{className:"text-xl font-bold neuropad-text-primary text-center",children:c}),b&&jsxRuntimeExports.jsx(DialogDescription,{className:"neuropad-text-secondary text-center",children:b})]}),jsxRuntimeExports.jsx("div",{className:"mt-4 neuropad-text-secondary",children:$})]})})})}function BottomNavigation({currentPage:e}){const i=$=>e===$,c=[{path:"/",icon:House,testId:"nav-home",side:"left"},{path:"/prevention-tips",icon:Calendar,testId:"nav-calendar",side:"left"},{path:"/caregiver-network",icon:Clipboard,testId:"nav-clipboard",side:"right"},{path:"/health-tracker",icon:Settings,testId:"nav-settings",side:"right"}],b={path:"/bluetooth-device",icon:Bluetooth,testId:"nav-bluetooth"};return jsxRuntimeExports.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 pointer-events-none",children:jsxRuntimeExports.jsx("div",{className:"max-w-md mx-auto relative pointer-events-auto",children:jsxRuntimeExports.jsxs("div",{className:"relative h-20",children:[jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 w-full h-16 bg-white dark:bg-gray-900 shadow-[0_-2px_10px_rgba(0,0,0,0.1)]",children:jsxRuntimeExports.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-8 w-24 h-16 bg-transparent",children:jsxRuntimeExports.jsx("svg",{className:"w-full h-full",viewBox:"0 0 100 70",preserveAspectRatio:"none",children:jsxRuntimeExports.jsx("path",{d:"M 0,70 Q 0,20 30,10 Q 50,0 70,10 Q 100,20 100,70 Z",className:"fill-white dark:fill-gray-900"})})})}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-16 flex items-center",children:jsxRuntimeExports.jsxs("div",{className:"w-full flex justify-around items-center px-4",children:[jsxRuntimeExports.jsx("div",{className:"flex-1 flex justify-around",children:c.filter($=>$.side==="left").map(({path:$,icon:it,testId:at})=>{const h=i($);return jsxRuntimeExports.jsx(Link,{to:$,children:jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.1},whileTap:{scale:.9},className:"flex flex-col items-center gap-1 p-2","data-testid":at,"aria-current":h?"page":void 0,children:[jsxRuntimeExports.jsx(motion.div,{animate:{y:h?-3:0},transition:{type:"spring",stiffness:300,damping:20},children:jsxRuntimeExports.jsx(it,{className:`w-6 h-6 transition-colors ${h?"text-primary":"text-gray-400"}`,strokeWidth:h?2.5:2})}),h&&jsxRuntimeExports.jsx(motion.div,{layoutId:"activeIndicator",className:"w-1 h-1 rounded-full bg-primary",transition:{type:"spring",stiffness:500,damping:30}})]})},$)})}),jsxRuntimeExports.jsx("div",{className:"mx-4",children:jsxRuntimeExports.jsx(Link,{to:b.path,children:jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},className:"relative","data-testid":b.testId,"aria-current":i(b.path)?"page":void 0,children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 rounded-full bg-primary/20 blur-xl scale-110"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-b from-primary/40 to-transparent translate-y-1"}),jsxRuntimeExports.jsxs(motion.div,{className:"relative w-16 h-16 rounded-full bg-gradient-to-br from-[#FDD835] via-[#FDD835] to-[#F9A825] shadow-2xl flex items-center justify-center",animate:{boxShadow:i(b.path)?"0 10px 35px rgba(253, 216, 53, 0.6), 0 5px 15px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.5)":"0 6px 25px rgba(253, 216, 53, 0.5), 0 3px 12px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.5)"},children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-1 rounded-full bg-gradient-to-br from-white/40 via-transparent to-transparent"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-1 rounded-full bg-gradient-to-b from-transparent via-transparent to-black/10"}),jsxRuntimeExports.jsx(b.icon,{className:`w-7 h-7 relative z-10 ${i(b.path)?"text-gray-900":"text-gray-800"}`,strokeWidth:2.5})]}),i(b.path)&&jsxRuntimeExports.jsx(motion.div,{className:"absolute inset-0 rounded-full border-2 border-primary",initial:{scale:1,opacity:.5},animate:{scale:1.3,opacity:0},transition:{duration:1.5,repeat:1/0,ease:"easeOut"}})]})})}),jsxRuntimeExports.jsx("div",{className:"flex-1 flex justify-around",children:c.filter($=>$.side==="right").map(({path:$,icon:it,testId:at})=>{const h=i($);return jsxRuntimeExports.jsx(Link,{to:$,children:jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.1},whileTap:{scale:.9},className:"flex flex-col items-center gap-1 p-2","data-testid":at,"aria-current":h?"page":void 0,children:[jsxRuntimeExports.jsx(motion.div,{animate:{y:h?-3:0},transition:{type:"spring",stiffness:300,damping:20},children:jsxRuntimeExports.jsx(it,{className:`w-6 h-6 transition-colors ${h?"text-primary":"text-gray-400"}`,strokeWidth:h?2.5:2})}),h&&jsxRuntimeExports.jsx(motion.div,{layoutId:"activeIndicator",className:"w-1 h-1 rounded-full bg-primary",transition:{type:"spring",stiffness:500,damping:30}})]})},$)})})]})})]})})})}function DailyGoalsCompact({hydrationProgress:e=0,walkingProgress:i=0,saltProgress:c=0}){const b=[{label:"Hydration",progress:e,color:"bg-blue-500",bgColor:"bg-blue-100",icon:Droplets,iconColor:"text-blue-600"},{label:"Walking",progress:i,color:"bg-[#FDD835]",bgColor:"bg-yellow-100",icon:Footprints,iconColor:"text-yellow-600"},{label:"Salt",progress:c,color:"bg-gray-400",bgColor:"bg-gray-100",icon:Utensils,iconColor:"text-gray-600"}];return jsxRuntimeExports.jsx("div",{className:"space-y-2",children:b.map(($,it)=>{const at=$.icon;return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:it*.1},className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:`w-6 h-6 rounded-full ${$.bgColor} flex items-center justify-center flex-shrink-0`,children:jsxRuntimeExports.jsx(at,{className:`w-3.5 h-3.5 ${$.iconColor}`})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-[hsl(45,15%,15%)]",children:$.label}),jsxRuntimeExports.jsxs("span",{className:"text-xs font-bold text-[hsl(45,15%,15%)] tabular-nums",children:[$.progress,"%"]})]}),jsxRuntimeExports.jsx("div",{className:`h-1.5 ${$.bgColor} rounded-full overflow-hidden`,children:jsxRuntimeExports.jsx(motion.div,{initial:{width:0},animate:{width:`${$.progress}%`},transition:{duration:.8,delay:it*.1+.2,ease:"easeOut"},className:`h-full ${$.color} rounded-full`})})]})]},$.label)})})}function isUnauthorizedError(e){return/^401: .*Unauthorized/.test(e.message)}function Dashboard(){var It;const{user:e}=useAuth(),{toast:i}=useToast(),c=useQueryClient(),[b,$]=reactExports.useState(!1),[it,at]=reactExports.useState({title:""}),{data:h,isLoading:dt}=useQuery({queryKey:["/api/health-metrics"],retry:!1}),{data:ft,isLoading:xt}=useQuery({queryKey:["/api/health-articles"],retry:!1}),{data:Ct}=useQuery({queryKey:["/api/daily-goals"],retry:!1}),bt=useMutation({mutationFn:async()=>{const jt=Math.round((Math.random()-.5)*8);await apiRequest("POST","/api/health-metrics",{heartRate:Math.max(55,Math.min(110,72+jt)),footPressure:"85.5",bluetoothConnected:!0,batteryLevel:85,anomaliesDetected:2})},onSuccess:()=>{c.invalidateQueries({queryKey:["/api/health-metrics"]})},onError:St=>{if(isUnauthorizedError(St)){i({title:"Unauthorized",description:"Session missing in dev. Continuing without redirect.",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}console.error("Error creating sample metrics:",St)}});reactExports.useEffect(()=>{!dt&&!h&&bt.mutate()},[h,dt]);const kt=()=>{window.location.href="/api/logout"},Dt=(St,jt,Ht,Kt)=>{at({title:St,description:jt,content:Ht,icon:Kt}),$(!0)},At=(e==null?void 0:e.firstName)||((It=e==null?void 0:e.email)==null?void 0:It.split("@")[0])||"User",Bt={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},Tt={hidden:{y:20,opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",stiffness:100}}};return jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen neuropad-bg pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-6 sm:mb-8 px-5 sm:px-6 pt-6 sm:pt-8",children:[jsxRuntimeExports.jsx("h2",{className:"text-title sm:text-headline neuropad-text-primary",children:"Dashboard"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(Link,{to:"/health-tracker",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-11 h-11 rounded-2xl bg-white shadow-native flex items-center justify-center native-active","data-testid":"button-search",children:jsxRuntimeExports.jsx(Search,{className:"w-5 h-5 text-gray-700"})})}),jsxRuntimeExports.jsx(motion.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-11 h-11 rounded-2xl neuropad-secondary shadow-native flex items-center justify-center text-white font-bold text-lg native-active",children:At.charAt(0).toUpperCase()})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-5 sm:px-6 mb-6 sm:mb-8",children:[jsxRuntimeExports.jsxs("h1",{className:"text-3xl sm:text-display leading-tight mb-5 sm:mb-6 neuropad-text-primary tracking-tighter",children:["Welcome to ",jsxRuntimeExports.jsx("br",{className:"hidden sm:block"})," Health"]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-4 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Overview"})}),jsxRuntimeExports.jsx(Link,{to:"/dashboard/articles",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-4 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Articles"})})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-8",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.2,type:"spring",stiffness:100},className:"native-card-elevated p-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-title mb-4",children:"Daily Goals"}),jsxRuntimeExports.jsx(DailyGoalsCompact,{hydrationProgress:(Ct==null?void 0:Ct.hydrationProgress)||0,walkingProgress:(Ct==null?void 0:Ct.walkingProgress)||0,saltProgress:(Ct==null?void 0:Ct.saltProgress)||0})]})}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-8",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.3,type:"spring",stiffness:100},className:"native-card-elevated p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-title mb-1",children:"Daily Health"}),jsxRuntimeExports.jsx("p",{className:"neuropad-text-secondary text-sm font-medium",children:"Monitor your health in real-time"})]}),jsxRuntimeExports.jsxs(motion.div,{className:"flex -space-x-2",animate:{y:[0,-5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:[jsxRuntimeExports.jsx(motion.div,{className:"w-9 h-9 rounded-full neuropad-secondary border-2 border-white shadow-md",whileHover:{scale:1.2,rotate:10},transition:{type:"spring",stiffness:300}}),jsxRuntimeExports.jsx(motion.div,{className:"w-9 h-9 rounded-full neuropad-primary border-2 border-white shadow-md",whileHover:{scale:1.2,rotate:-10},transition:{type:"spring",stiffness:300}})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-bold mb-3 neuropad-text-primary",children:"Risk Level"}),jsxRuntimeExports.jsx(motion.div,{className:"w-full bg-gray-100 rounded-full h-3 cursor-pointer shadow-inner","data-testid":"progress-risk",whileTap:{scale:.98,height:16},transition:{type:"spring",stiffness:400,damping:20},onClick:()=>Dt("Health Risk Level","Risk analysis based on your health data",jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm",children:["Current risk level: ",jsxRuntimeExports.jsx("strong",{children:"65%"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm",children:"Influencing factors: Heart rate, foot pressure, and detected anomalies."}),jsxRuntimeExports.jsx("p",{className:"text-sm",children:"Recommendation: Perform regular check-ups and follow doctor's advice."})]}),jsxRuntimeExports.jsx(TriangleAlert,{className:"w-8 h-8 text-white"})),children:jsxRuntimeExports.jsx(motion.div,{className:"neuropad-primary h-3 rounded-full pointer-events-none shadow-sm",initial:{width:0},animate:{width:"65%"},transition:{delay:.5,duration:.8,ease:"easeOut"}})})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-6 mb-8",children:[jsxRuntimeExports.jsx("h2",{className:"text-headline mb-5",children:"Health Metrics"}),dt?jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsx(CardSkeleton,{}),jsxRuntimeExports.jsx(CardSkeleton,{}),jsxRuntimeExports.jsx(CardSkeleton,{}),jsxRuntimeExports.jsx(CardSkeleton,{})]}):jsxRuntimeExports.jsxs(motion.div,{className:"grid grid-cols-2 gap-4",variants:Bt,initial:"hidden",animate:"visible",children:[jsxRuntimeExports.jsxs(motion.div,{variants:Tt,className:"native-card p-5 cursor-pointer native-active","data-testid":"card-heart-rate",whileHover:{y:-4,shadow:"0 10px 30px rgba(0,0,0,0.12)"},whileTap:{scale:.97},onClick:()=>Dt("Heart Rate","Detailed information about your heart rate",jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm",children:["Your current heart rate: ",jsxRuntimeExports.jsxs("strong",{children:[(h==null?void 0:h.heartRate)||"--"," BPM"]})]}),jsxRuntimeExports.jsx("p",{className:"text-sm",children:"Normal heart rate for adults is 60-100 BPM at rest."}),jsxRuntimeExports.jsx("p",{className:"text-sm",children:"Tips: Monitor your heart rate regularly and consult a doctor if there are significant changes."})]}),jsxRuntimeExports.jsx(Heart,{className:"w-8 h-8 text-white"})),children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-2xl bg-red-50 flex items-center justify-center shadow-sm",children:jsxRuntimeExports.jsx(Heart,{className:"w-6 h-6 text-red-500"})}),jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400 shadow-sm shadow-green-400/50"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary mb-1 font-medium",children:"Heart Rate:"}),jsxRuntimeExports.jsx("p",{className:"font-bold text-lg mb-3 neuropad-text-primary",children:h!=null&&h.heartRate?jsxRuntimeExports.jsx(AnimatedCounter,{value:h.heartRate,suffix:" BPM"}):"--"}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("div",{className:"flex-1 neuropad-primary h-1.5 rounded-full mr-3","data-testid":"progress-heart-rate"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-gray-500",children:"Connect"})]})]}),jsxRuntimeExports.jsx(Link,{to:"/footpad-tracking",children:jsxRuntimeExports.jsxs(motion.div,{variants:Tt,className:"native-card p-5 cursor-pointer native-active","data-testid":"card-pressure",whileHover:{y:-4,shadow:"0 10px 30px rgba(0,0,0,0.12)"},whileTap:{scale:.97},children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-2xl bg-pink-50 flex items-center justify-center shadow-sm",children:jsxRuntimeExports.jsx(Activity,{className:"w-6 h-6 text-pink-500"})}),jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-400 shadow-sm shadow-orange-400/50"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary mb-1 font-medium",children:"Pressure:"}),jsxRuntimeExports.jsx("p",{className:"font-bold text-lg mb-3 neuropad-text-primary",children:"Footpad"}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("div",{className:"flex-1 neuropad-primary h-1.5 rounded-full mr-3","data-testid":"progress-pressure"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-gray-500",children:"Track"})]})]})}),jsxRuntimeExports.jsx(Link,{to:"/imu-sensor",children:jsxRuntimeExports.jsxs(motion.div,{variants:Tt,className:"native-card p-5 cursor-pointer native-active","data-testid":"card-imu-sensor",whileHover:{y:-4,shadow:"0 10px 30px rgba(0,0,0,0.12)"},whileTap:{scale:.97},children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-2xl bg-purple-50 flex items-center justify-center shadow-sm",children:jsxRuntimeExports.jsx(Activity,{className:"w-6 h-6 text-purple-500"})}),jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-400 shadow-sm shadow-blue-400/50"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary mb-1 font-medium",children:"Motion Tracking"}),jsxRuntimeExports.jsx("p",{className:"font-bold text-lg mb-3 neuropad-text-primary",children:"IMU Sensor"}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("div",{className:"flex-1 neuropad-primary h-1.5 rounded-full mr-3","data-testid":"progress-imu"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-gray-500",children:"Connect"})]})]})}),jsxRuntimeExports.jsx(Link,{to:"/bluetooth-device",children:jsxRuntimeExports.jsxs(motion.div,{variants:Tt,className:"native-card p-5 cursor-pointer native-active","data-testid":"card-bluetooth",whileHover:{y:-4,shadow:"0 10px 30px rgba(0,0,0,0.12)"},whileTap:{scale:.97},children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-2xl bg-blue-50 flex items-center justify-center shadow-sm",children:jsxRuntimeExports.jsx(Bluetooth,{className:"w-6 h-6 text-blue-500"})}),jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400 shadow-sm shadow-green-400/50"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary mb-1 font-medium",children:"Connect"}),jsxRuntimeExports.jsx("p",{className:"font-bold text-lg mb-3 neuropad-text-primary",children:"Bluetooth"}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("div",{className:"flex-1 neuropad-primary h-1.5 rounded-full mr-3","data-testid":"progress-bluetooth"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-gray-500",children:"Connect"})]})]})})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 mb-8",children:[jsxRuntimeExports.jsx("h2",{className:"text-headline mb-5",children:"Daily Health Articles"}),xt?jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(ArticleSkeleton,{}),jsxRuntimeExports.jsx(ArticleSkeleton,{}),jsxRuntimeExports.jsx(ArticleSkeleton,{})]}):jsxRuntimeExports.jsx(motion.div,{className:"space-y-3",variants:Bt,initial:"hidden",animate:"visible",children:ft&&ft.slice(0,3).map(St=>jsxRuntimeExports.jsx(motion.div,{variants:Tt,className:"native-card p-5 cursor-pointer native-active",whileHover:{x:4,shadow:"0 10px 30px rgba(0,0,0,0.12)"},whileTap:{scale:.98},onClick:()=>Dt(St.title,St.excerpt,jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm neuropad-text-secondary font-medium",children:[jsxRuntimeExports.jsx(Clock,{className:"w-4 h-4"}),jsxRuntimeExports.jsxs("span",{children:[St.readTime," min read"]})]}),St.imageUrl&&jsxRuntimeExports.jsx("img",{src:St.imageUrl,alt:St.title,className:"w-full h-48 object-cover rounded-2xl shadow-md"}),jsxRuntimeExports.jsx("p",{className:"text-sm whitespace-pre-line leading-relaxed",children:St.content})]}),jsxRuntimeExports.jsx(BookOpen,{className:"w-8 h-8 text-white"})),"data-testid":`article-${St.id}`,children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[St.imageUrl&&jsxRuntimeExports.jsx("img",{src:St.imageUrl,alt:St.title,className:"w-24 h-24 object-cover rounded-2xl flex-shrink-0 shadow-sm"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-base mb-1.5 neuropad-text-primary line-clamp-2 leading-snug",children:St.title}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary line-clamp-2 mb-3 leading-relaxed",children:St.excerpt}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Badge,{variant:"secondary",className:"text-xs font-semibold px-2.5 py-0.5",children:St.category}),jsxRuntimeExports.jsxs("span",{className:"text-xs neuropad-text-secondary flex items-center gap-1 font-medium",children:[jsxRuntimeExports.jsx(Clock,{className:"w-3.5 h-3.5"}),St.readTime," min"]})]})]})]})},St.id))})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-8",children:jsxRuntimeExports.jsx(motion.button,{onClick:kt,whileHover:{scale:1.01},whileTap:{scale:.99},className:"w-full py-4 rounded-2xl border-2 border-gray-200 bg-white neuropad-text-primary font-bold shadow-native native-active","data-testid":"button-logout",children:"Logout"})})]}),jsxRuntimeExports.jsx(InfoDialog,{open:b,onOpenChange:$,title:it.title,description:it.description,content:it.content,icon:it.icon}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/"})]})})}function DashboardArticles(){const{data:e}=useQuery({queryKey:["/api/health-articles"],retry:!1});return jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen neuropad-bg pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6 px-6 pt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Settings,{className:"w-6 h-6 neuropad-text-primary"}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold neuropad-text-primary",children:"Articles"})]}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx("button",{className:"w-11 h-11 rounded-2xl bg-white shadow-native flex items-center justify-center native-active","aria-label":"Back to Home",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 neuropad-text-primary"})})})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Overview"})}),jsxRuntimeExports.jsx(Link,{to:"/dashboard/articles",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Articles"})})]})}),jsxRuntimeExports.jsxs("div",{className:"px-6 space-y-3",children:[(e||[]).map(i=>jsxRuntimeExports.jsxs("div",{className:"native-card-elevated p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx(BookOpen,{className:"w-4 h-4 neuropad-text-primary"}),jsxRuntimeExports.jsx("p",{className:"font-semibold neuropad-text-primary",children:i.title})]}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary",children:i.category})]},i.id)),!e&&jsxRuntimeExports.jsxs("div",{className:"native-card-elevated p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx(BookOpen,{className:"w-4 h-4 neuropad-text-primary"}),jsxRuntimeExports.jsx("p",{className:"font-semibold neuropad-text-primary",children:"Understanding Foot Health"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary",children:"General"})]})]})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/"})]})})}function CircularProgress({progress:e,color:i="#FDD835",size:c=120,strokeWidth:b=12,showCheckmark:$=!1}){const it=(c-b)/2,at=it*2*Math.PI,h=at-e/100*at;return jsxRuntimeExports.jsxs("div",{className:"circular-progress relative",style:{width:c,height:c},children:[jsxRuntimeExports.jsxs("svg",{width:c,height:c,className:"transform -rotate-90",children:[jsxRuntimeExports.jsx("circle",{cx:c/2,cy:c/2,r:it,stroke:"#E5E5E5",strokeWidth:b,fill:"none"}),jsxRuntimeExports.jsx("circle",{cx:c/2,cy:c/2,r:it,stroke:i,strokeWidth:b,fill:"none",strokeDasharray:at,strokeDashoffset:h,strokeLinecap:"round",className:"transition-all duration-500 ease-in-out"})]}),jsxRuntimeExports.jsxs("div",{className:"circular-progress-text neuropad-text-primary",children:[e,"%"]}),$&&e>=75&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-2 right-2 w-6 h-6 rounded-full neuropad-primary flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{width:"16",height:"16",fill:"white",children:jsxRuntimeExports.jsx("path",{d:"M5 10l3 3 7-7",stroke:"white",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})})]})}function HealthTracker(){const{user:e}=useAuth(),[i,c]=reactExports.useState("tips"),[b,$]=reactExports.useState(""),it=(e==null?void 0:e.firstName)||"User",{data:at}=useQuery({queryKey:["/api/daily-goals"],retry:!1});useQuery({queryKey:["/api/prevention-tips"],retry:!1});const h=(at==null?void 0:at.hydrationProgress)||75,dt=(at==null?void 0:at.walkingProgress)||50,ft=(at==null?void 0:at.saltProgress)||30,xt=[{id:1,title:"Walk 10,000 steps every day",category:"Walking Goal",image:"https://images.unsplash.com/photo-1490645935967-10de6ba17061?w=400&h=300&fit=crop",rating:4.8},{id:2,title:"Drink 8 glasses of water",category:"Health",image:"https://images.unsplash.com/photo-1559839734-2b71ea197ec2?w=400&h=300&fit=crop",rating:4.9}],Ct=[{title:"Stay Active",subtitle:"Daily Movement",image:"https://images.unsplash.com/photo-1610348725531-843dff563e2c?w=200&h=200&fit=crop"},{title:"Hydration",subtitle:"Drink Water",image:"https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=200&h=200&fit=crop"}],bt=[{name:"Hydration",icon:Droplets},{name:"Exercise",icon:Clock},{name:"Nutrition",icon:Utensils},{name:"Health",icon:Heart}];return jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"h-screen neuropad-bg pb-16 overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto h-full flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4 px-6 pt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-xl bg-blue-50 shadow-sm flex items-center justify-center",children:jsxRuntimeExports.jsx(Settings,{className:"w-4 h-4 text-blue-500"})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold neuropad-text-primary",children:"Health Tracker"})]}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-11 h-11 rounded-2xl bg-white shadow-native flex items-center justify-center native-active","aria-label":"Back to Home","data-testid":"button-back-home",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 neuropad-text-primary"})})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-4 px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl neuropad-primary shadow-native flex items-center justify-center",children:jsxRuntimeExports.jsx(Heart,{className:"w-5 h-5 text-white fill-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h2",{className:"text-sm font-bold neuropad-text-primary",children:["Hello, ",it,"!"]}),jsxRuntimeExports.jsx("p",{className:"text-xs neuropad-text-secondary font-medium",children:"Stay Hydrated!"})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Link,{to:"/health-tracker",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Overview"})}),jsxRuntimeExports.jsx(Link,{to:"/health-tracker/tips",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Tips"})}),jsxRuntimeExports.jsx(Link,{to:"/health-tracker/goals",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Goals"})})]})}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"native-card-elevated p-3 border-2 border-text-primary",children:[jsxRuntimeExports.jsx("p",{className:"text-xs mb-1 neuropad-text-primary font-medium",children:"You have reached 60% of your target"}),jsxRuntimeExports.jsx("p",{className:"text-xs mb-3 neuropad-text-primary font-medium",children:"Keep it up for better health."}),jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-2xl h-3 overflow-hidden",children:jsxRuntimeExports.jsx(motion.div,{initial:{width:0},animate:{width:"60%"},transition:{duration:1,ease:"easeOut"},className:"neuropad-primary h-3 rounded-2xl"})})]})}),jsxRuntimeExports.jsxs("div",{className:"flex justify-around border-b border-gray-200 mb-4 px-6",children:[jsxRuntimeExports.jsx(motion.button,{onClick:()=>c("tips"),whileTap:{scale:.95},className:`pb-3 border-b-3 font-bold transition-colors ${i==="tips"?"border-primary neuropad-text-primary":"neuropad-text-secondary border-transparent"}`,"data-testid":"tab-tips",children:"Tips"}),jsxRuntimeExports.jsx(Link,{to:"/prevention-tips",children:jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.95},className:"pb-3 neuropad-text-secondary font-bold","data-testid":"tab-reminders",children:"Reminders"})}),jsxRuntimeExports.jsx(motion.button,{onClick:()=>c("goals"),whileTap:{scale:.95},className:`pb-3 border-b-3 font-bold transition-colors ${i==="goals"?"border-primary neuropad-text-primary":"neuropad-text-secondary border-transparent"}`,"data-testid":"tab-goals",children:"My Goals"})]}),i==="tips"&&jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto px-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{type:"text",placeholder:"Search tips",value:b,onChange:kt=>$(kt.target.value),className:"w-full pl-11 pr-16 py-3.5 rounded-2xl native-card shadow-native focus:outline-none focus:ring-2 focus:ring-primary","data-testid":"input-search-tips"}),jsxRuntimeExports.jsx(Search,{className:"absolute left-9 top-4 w-5 h-5 neuropad-text-secondary"}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1},whileTap:{scale:.9},className:"absolute right-9 top-3.5 w-9 h-9 rounded-2xl neuropad-text-primary bg-text-primary text-white flex items-center justify-center shadow-sm native-active",children:jsxRuntimeExports.jsx(Grid3x3,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-3",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-bold neuropad-text-primary",children:"Daily Health Goals"}),jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.95},className:"text-sm neuropad-text-secondary font-bold",children:"View all"})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-3 overflow-x-auto pb-4",children:xt.map(kt=>jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.97},className:"flex-shrink-0 w-64 rounded-2xl overflow-hidden relative native-card-elevated",children:[jsxRuntimeExports.jsx("img",{src:kt.image,alt:kt.title,className:"w-full h-40 object-cover"}),jsxRuntimeExports.jsx("div",{className:"absolute top-3 right-3 bg-white/90 backdrop-blur-sm rounded-2xl px-3 py-1.5 flex items-center shadow-sm",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-bold",children:kt.rating})}),jsxRuntimeExports.jsxs("div",{className:"p-5",children:[jsxRuntimeExports.jsx("p",{className:"font-bold mb-1 neuropad-text-primary",children:kt.title}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary font-medium",children:kt.category})]})]},kt.id))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-bold mb-3 neuropad-text-primary",children:"Quick Tips"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 gap-3",children:Ct.map((kt,Dt)=>jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.97},className:"rounded-2xl overflow-hidden native-card-elevated",children:[jsxRuntimeExports.jsx("img",{src:kt.image,alt:kt.title,className:"w-full h-32 object-cover"}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("p",{className:"font-bold neuropad-text-primary",children:kt.title}),jsxRuntimeExports.jsx("p",{className:"text-xs neuropad-text-secondary font-medium",children:kt.subtitle})]})]},Dt))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-bold mb-3 neuropad-text-primary",children:"Categories"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-4 gap-3",children:bt.map((kt,Dt)=>jsxRuntimeExports.jsxs(motion.button,{whileHover:{y:-4},whileTap:{scale:.95},className:"flex flex-col items-center gap-2 native-active",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-2xl border-2 border-text-primary shadow-native flex items-center justify-center",children:jsxRuntimeExports.jsx(kt.icon,{className:"w-8 h-8 neuropad-text-primary"})}),jsxRuntimeExports.jsx("span",{className:"text-sm neuropad-text-primary font-medium",children:kt.name})]},Dt))})]})]})}),i==="goals"&&jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto px-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold mb-4 neuropad-text-primary",children:"Your Daily Goals"}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-around",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(CircularProgress,{progress:h,color:"#D4C5A9",size:120,strokeWidth:12}),jsxRuntimeExports.jsx("p",{className:"font-bold mt-3 neuropad-text-primary",children:"Hydration"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(CircularProgress,{progress:dt,color:"#FDD835",size:120,strokeWidth:12}),jsxRuntimeExports.jsx("p",{className:"font-bold mt-3 neuropad-text-primary",children:"Walking"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(CircularProgress,{progress:ft,color:"#D4C5A9",size:120,strokeWidth:12}),jsxRuntimeExports.jsx("p",{className:"font-bold mt-3 neuropad-text-primary",children:"Salt"})]})]})]})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/health-tracker"})]})})}function HealthTrackerTips(){const{user:e}=useAuth(),i=(e==null?void 0:e.firstName)||"User",{data:c}=useQuery({queryKey:["/api/prevention-tips"],retry:!1});return jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen neuropad-bg pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6 px-6 pt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Settings,{className:"w-6 h-6 neuropad-text-primary"}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold neuropad-text-primary",children:"Health Tips"})]}),jsxRuntimeExports.jsx(Link,{to:"/health-tracker",children:jsxRuntimeExports.jsx("button",{className:"w-11 h-11 rounded-2xl bg-white shadow-native flex items-center justify-center native-active","aria-label":"Back to Health Tracker",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 neuropad-text-primary"})})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-4 px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl neuropad-primary shadow-native flex items-center justify-center",children:jsxRuntimeExports.jsx(Heart,{className:"w-5 h-5 text-white fill-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h2",{className:"text-sm font-bold neuropad-text-primary",children:["Hello, ",i,"!"]}),jsxRuntimeExports.jsx("p",{className:"text-xs neuropad-text-secondary font-medium",children:"Browse simple health tips"})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Link,{to:"/health-tracker",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Overview"})}),jsxRuntimeExports.jsx(Link,{to:"/health-tracker/tips",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Tips"})}),jsxRuntimeExports.jsx(Link,{to:"/health-tracker/goals",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Goals"})})]})}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsx(Input,{type:"text",placeholder:"Search tips",className:"w-full rounded-2xl"})}),jsxRuntimeExports.jsxs("div",{className:"px-6 space-y-3",children:[(c||[]).map((b,$)=>jsxRuntimeExports.jsxs("div",{className:"native-card-elevated p-4",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold neuropad-text-primary",children:b.title||"Healthy Habit"}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary",children:b.category||"General"})]},$)),!c&&jsxRuntimeExports.jsxs("div",{className:"native-card-elevated p-4",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold neuropad-text-primary",children:"Walk daily"}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary",children:"Keep moving for better health"})]})]})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/health-tracker"})]})})}function HealthTrackerGoals(){const{user:e}=useAuth(),i=(e==null?void 0:e.firstName)||"User",{data:c}=useQuery({queryKey:["/api/daily-goals"],retry:!1}),b=(c==null?void 0:c.hydrationProgress)||0,$=(c==null?void 0:c.walkingProgress)||0,it=(c==null?void 0:c.saltProgress)||0;return jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen neuropad-bg pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6 px-6 pt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Settings,{className:"w-6 h-6 neuropad-text-primary"}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold neuropad-text-primary",children:"Daily Goals"})]}),jsxRuntimeExports.jsx(Link,{to:"/health-tracker",children:jsxRuntimeExports.jsx("button",{className:"w-11 h-11 rounded-2xl bg-white shadow-native flex items-center justify-center native-active","aria-label":"Back to Health Tracker",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 neuropad-text-primary"})})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-4 px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl neuropad-primary shadow-native flex items-center justify-center",children:jsxRuntimeExports.jsx(Heart,{className:"w-5 h-5 text-white fill-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h2",{className:"text-sm font-bold neuropad-text-primary",children:["Hello, ",i,"!"]}),jsxRuntimeExports.jsx("p",{className:"text-xs neuropad-text-secondary font-medium",children:"Track your progress"})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Link,{to:"/health-tracker",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Overview"})}),jsxRuntimeExports.jsx(Link,{to:"/health-tracker/tips",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Tips"})}),jsxRuntimeExports.jsx(Link,{to:"/health-tracker/goals",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Goals"})})]})}),jsxRuntimeExports.jsx("div",{className:"px-6",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-around",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(CircularProgress,{progress:b,color:"#D4C5A9",size:120,strokeWidth:12}),jsxRuntimeExports.jsx("p",{className:"font-semibold mt-2 neuropad-text-primary",children:"Hydration"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(CircularProgress,{progress:$,color:"#FDD835",size:120,strokeWidth:12}),jsxRuntimeExports.jsx("p",{className:"font-semibold mt-2 neuropad-text-primary",children:"Walking"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(CircularProgress,{progress:it,color:"#D4C5A9",size:120,strokeWidth:12}),jsxRuntimeExports.jsx("p",{className:"font-semibold mt-2 neuropad-text-primary",children:"Salt"})]})]})})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/health-tracker"})]})})}function ToggleSwitch({checked:e,onChange:i,disabled:c=!1,"data-testid":b}){const $=it=>{c||i(it.target.checked)};return jsxRuntimeExports.jsxs("label",{className:`toggle-switch ${c?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:e,onChange:$,disabled:c,"data-testid":b}),jsxRuntimeExports.jsx("span",{className:"slider"})]})}function PreventionTips(){const{toast:e}=useToast(),i=useQueryClient(),{data:c}=useQuery({queryKey:["/api/prevention-tips"],retry:!1}),b=useMutation({mutationFn:async it=>{await apiRequest("PUT","/api/prevention-tips",it)},onSuccess:()=>{i.invalidateQueries({queryKey:["/api/prevention-tips"]})},onError:it=>{if(isUnauthorizedError(it)){e({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}e({title:"Error",description:"Failed to update prevention tips",variant:"destructive"})}}),$=(it,at)=>{const h={};it==="hydrationEnabled"?h.hydrationEnabled=at:it==="walkingGoalsEnabled"?h.walkingGoalsEnabled=at:it==="saltReductionEnabled"&&(h.saltReductionEnabled=at),b.mutate(h)};return jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen neuropad-bg pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6 px-6 pt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Settings,{className:"w-6 h-6 neuropad-text-primary"}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold neuropad-text-primary",children:"Prevention Tips"})]}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-11 h-11 rounded-2xl bg-white shadow-native flex items-center justify-center native-active","aria-label":"Back to Home","data-testid":"button-back-home",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 neuropad-text-primary"})})})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Link,{to:"/prevention-tips",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Overview"})}),jsxRuntimeExports.jsx(Link,{to:"/prevention-tips/goals",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Goals"})}),jsxRuntimeExports.jsx(Link,{to:"/prevention-tips/reminders",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Reminders"})})]})}),jsxRuntimeExports.jsxs("div",{className:"mb-6 px-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-3xl font-serif font-bold mb-6 neuropad-text-primary",children:"AI-Based Prevention Tips"}),jsxRuntimeExports.jsxs("div",{className:"neuropad-card p-4 mb-4 shadow-sm flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:jsxRuntimeExports.jsx(Droplets,{className:"w-6 h-6 text-blue-500"})}),jsxRuntimeExports.jsx("span",{className:"text-lg font-semibold neuropad-text-primary",children:"Hydration"})]}),jsxRuntimeExports.jsx(ToggleSwitch,{checked:(c==null?void 0:c.hydrationEnabled)??!0,onChange:it=>$("hydrationEnabled",it),"data-testid":"toggle-hydration"})]}),jsxRuntimeExports.jsxs("div",{className:"neuropad-card p-4 mb-4 shadow-sm flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:jsxRuntimeExports.jsx(Clock,{className:"w-6 h-6 text-green-500"})}),jsxRuntimeExports.jsx("span",{className:"text-lg font-semibold neuropad-text-primary",children:"Walking Goals"})]}),jsxRuntimeExports.jsx(ToggleSwitch,{checked:(c==null?void 0:c.walkingGoalsEnabled)??!0,onChange:it=>$("walkingGoalsEnabled",it),"data-testid":"toggle-walking"})]}),jsxRuntimeExports.jsxs("div",{className:"neuropad-card p-4 mb-6 shadow-sm flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center",children:jsxRuntimeExports.jsx(Utensils,{className:"w-6 h-6 text-orange-500"})}),jsxRuntimeExports.jsx("span",{className:"text-lg font-semibold neuropad-text-primary",children:"Salt Reduction"})]}),jsxRuntimeExports.jsx(ToggleSwitch,{checked:(c==null?void 0:c.saltReductionEnabled)??!1,onChange:it=>$("saltReductionEnabled",it),"data-testid":"toggle-salt"})]})]})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/prevention-tips"})]})})}function PreventionTipsGoals(){const{data:e}=useQuery({queryKey:["/api/daily-goals"],retry:!1}),i=(e==null?void 0:e.hydrationProgress)||75,c=(e==null?void 0:e.walkingProgress)||50,b=(e==null?void 0:e.saltProgress)||30;return jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen neuropad-bg pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6 px-6 pt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Settings,{className:"w-6 h-6 neuropad-text-primary"}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold neuropad-text-primary",children:"Daily Goals"})]}),jsxRuntimeExports.jsx(Link,{to:"/prevention-tips",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-11 h-11 rounded-2xl bg-white shadow-native flex items-center justify-center native-active","aria-label":"Back to Overview",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 neuropad-text-primary"})})})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Link,{to:"/prevention-tips",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Overview"})}),jsxRuntimeExports.jsx(Link,{to:"/prevention-tips/goals",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Goals"})}),jsxRuntimeExports.jsx(Link,{to:"/prevention-tips/reminders",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Reminders"})})]})}),jsxRuntimeExports.jsxs("div",{className:"mb-6 px-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-3xl font-serif font-bold mb-6 neuropad-text-primary",children:"Daily Goal Tracking"}),jsxRuntimeExports.jsxs("div",{className:"flex justify-around",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(CircularProgress,{progress:i,color:"#D4C5A9",size:120,strokeWidth:12}),jsxRuntimeExports.jsx("p",{className:"font-semibold mt-2 neuropad-text-primary",children:"Hydration"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(CircularProgress,{progress:c,color:"#FDD835",size:120,strokeWidth:12}),jsxRuntimeExports.jsx("p",{className:"font-semibold mt-2 neuropad-text-primary",children:"Walking"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(CircularProgress,{progress:b,color:"#D4C5A9",size:120,strokeWidth:12}),jsxRuntimeExports.jsx("p",{className:"font-semibold mt-2 neuropad-text-primary",children:"Salt"})]})]})]})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/prevention-tips"})]})})}function PreventionTipsReminders(){const{toast:e}=useToast(),i=useQueryClient(),[c,b]=reactExports.useState(""),[$,it]=reactExports.useState(!1),{data:at}=useQuery({queryKey:["/api/reminders"],retry:!1}),h=useMutation({mutationFn:async xt=>{await apiRequest("POST","/api/reminders",xt)},onSuccess:()=>{i.invalidateQueries({queryKey:["/api/reminders"]}),b(""),it(!1),e({title:"Success",description:"Reminder successfully added"})},onError:xt=>{if(isUnauthorizedError(xt)){e({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}e({title:"Error",description:"Failed to add reminder",variant:"destructive"})}}),dt=useMutation({mutationFn:async xt=>{await apiRequest("DELETE",`/api/reminders/${xt}`)},onSuccess:()=>{i.invalidateQueries({queryKey:["/api/reminders"]}),e({title:"Success",description:"Reminder successfully deleted"})},onError:xt=>{if(isUnauthorizedError(xt)){e({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}e({title:"Error",description:"Failed to delete reminder",variant:"destructive"})}}),ft=()=>{if(!c.trim()){e({title:"Error",description:"Please enter reminder text",variant:"destructive"});return}const xt=c.split(" - "),Ct=xt[0]||c,bt=xt[1]||"08:00 AM";h.mutate({title:Ct,scheduledTime:bt})};return jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen neuropad-bg pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6 px-6 pt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Settings,{className:"w-6 h-6 neuropad-text-primary"}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold neuropad-text-primary",children:"Reminders"})]}),jsxRuntimeExports.jsx(Link,{to:"/prevention-tips",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-11 h-11 rounded-2xl bg-white shadow-native flex items-center justify-center native-active","aria-label":"Back to Overview",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 neuropad-text-primary"})})})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Link,{to:"/prevention-tips",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Overview"})}),jsxRuntimeExports.jsx(Link,{to:"/prevention-tips/goals",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Goals"})}),jsxRuntimeExports.jsx(Link,{to:"/prevention-tips/reminders",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Reminders"})})]})}),jsxRuntimeExports.jsxs("div",{className:"mb-6 px-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-3xl font-serif font-bold mb-6 neuropad-text-primary",children:"Upcoming Reminders"}),jsxRuntimeExports.jsxs("div",{className:"neuropad-card p-4 shadow-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold neuropad-text-primary",children:"Add Reminder"}),jsxRuntimeExports.jsxs("button",{onClick:()=>it(!0),className:"px-4 py-1 rounded-full neuropad-secondary text-sm font-semibold",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4 mr-1 inline"})," Add"]})]}),$&&jsxRuntimeExports.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:[jsxRuntimeExports.jsx(Input,{type:"text",placeholder:"Example: Drink Water - 08:00 AM",value:c,onChange:xt=>b(xt.target.value),className:"mb-3"}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-2",children:[jsxRuntimeExports.jsx("button",{onClick:ft,className:"px-3 py-2 rounded-full neuropad-primary text-sm font-semibold",children:"Save"}),jsxRuntimeExports.jsx("button",{onClick:()=>it(!1),className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold",children:"Cancel"})]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:(at==null?void 0:at.length)===0?jsxRuntimeExports.jsx("p",{className:"text-center neuropad-text-secondary",children:"No reminders yet"}):at==null?void 0:at.map((xt,Ct)=>jsxRuntimeExports.jsxs("div",{className:`flex justify-between items-center py-3 ${Ct<((at==null?void 0:at.length)||0)-1?"border-b border-gray-200":""}`,children:[jsxRuntimeExports.jsxs("span",{className:"neuropad-text-primary",children:[xt.title," - ",xt.scheduledTime]}),jsxRuntimeExports.jsx("button",{onClick:()=>dt.mutate(xt.id),className:"text-red-500","aria-label":`Delete reminder ${xt.id}`,children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 inline"})})]},xt.id))})]})]})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/prevention-tips"})]})})}function UrgentAlertsHistory(){const{toast:e}=useToast(),{data:i,error:c}=useQuery({queryKey:["/api/urgent-alerts"],retry:!1});return c&&isUnauthorizedError(c)&&(e({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500)),jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen neuropad-bg pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6 px-6 pt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Settings,{className:"w-6 h-6 neuropad-text-primary"}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold neuropad-text-primary",children:"Alerts History"})]}),jsxRuntimeExports.jsx(Link,{to:"/urgent-alerts",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-11 h-11 rounded-2xl bg-white shadow-native flex items-center justify-center native-active","aria-label":"Back to Overview",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 neuropad-text-primary"})})})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Link,{to:"/urgent-alerts",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Overview"})}),jsxRuntimeExports.jsx(Link,{to:"/urgent-alerts/history",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"History"})})]})}),jsxRuntimeExports.jsx("div",{className:"px-6 space-y-4",children:!i||i.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-8",children:[jsxRuntimeExports.jsx(Clock,{className:"w-12 h-12 mx-auto mb-4 neuropad-text-secondary"}),jsxRuntimeExports.jsx("p",{className:"neuropad-text-secondary",children:"No history yet"})]}):i.map(b=>jsxRuntimeExports.jsx("div",{className:"neuropad-card p-4 shadow-sm",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-semibold neuropad-text-primary",children:b.title}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary",children:b.description})]}),jsxRuntimeExports.jsx("p",{className:"text-xs neuropad-text-secondary",children:b.createdAt?new Date(b.createdAt).toLocaleString("en-US"):"Just now"})]})},b.id))})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/urgent-alerts"})]})})}function CaregiverNetwork(){const{toast:e}=useToast(),i=useQueryClient(),{data:c}=useQuery({queryKey:["/api/caregivers"],retry:!1}),b=useMutation({mutationFn:async({id:it,emergencyNotifications:at})=>{await apiRequest("PATCH",`/api/caregivers/${it}/emergency`,{emergencyNotifications:at})},onSuccess:()=>{i.invalidateQueries({queryKey:["/api/caregivers"]})},onError:it=>{if(isUnauthorizedError(it)){e({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}e({title:"Error",description:"Failed to update emergency notifications",variant:"destructive"})}}),$=(it,at)=>{b.mutate({id:it.id,emergencyNotifications:at}),e({title:"Notification updated",description:`Emergency notification for ${it.name} ${at?"enabled":"disabled"}`})};return reactExports.useEffect(()=>{},[]),jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen neuropad-bg pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6 px-6 pt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Heart,{className:"w-7 h-7 text-primary"}),jsxRuntimeExports.jsxs("h1",{className:"text-3xl font-serif font-bold neuropad-text-primary",children:["Neuropad",jsxRuntimeExports.jsx("br",{}),"Caregiver Network"]})]}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-11 h-11 rounded-2xl bg-white shadow-native flex items-center justify-center native-active","aria-label":"Back to Home","data-testid":"button-back-home",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 neuropad-text-primary"})})})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Link,{to:"/caregiver-network",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Overview"})}),jsxRuntimeExports.jsx(Link,{to:"/caregiver-network/manage",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Manage"})})]})}),jsxRuntimeExports.jsxs("div",{className:"neuropad-card p-6 mb-6 shadow-sm mx-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold mb-4 neuropad-text-primary",children:"Emergency Notifications"}),(c==null?void 0:c.length)===0?jsxRuntimeExports.jsx("p",{className:"text-center neuropad-text-secondary",children:"No caregivers registered yet"}):jsxRuntimeExports.jsx("div",{className:"space-y-4",children:c==null?void 0:c.map((it,at)=>jsxRuntimeExports.jsxs("div",{className:`flex justify-between items-center ${at<((c==null?void 0:c.length)||0)-1?"pb-4 border-b border-gray-200":""}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full neuropad-primary flex items-center justify-center",children:jsxRuntimeExports.jsx(User,{className:"w-6 h-6 text-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-semibold neuropad-text-primary",children:it.name}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary",children:it.relationship}),jsxRuntimeExports.jsx("p",{className:"text-xs neuropad-text-secondary",children:it.contactInfo})]})]}),jsxRuntimeExports.jsx(ToggleSwitch,{checked:it.emergencyNotifications??!1,onChange:h=>$(it,h),"data-testid":`toggle-emergency-${it.id}`})]},it.id))})]})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/caregiver-network"})]})})}var mapboxGl$1={exports:{}};(function(e,i){(function(c,b){e.exports=b()})(commonjsGlobal,function(){var c,b,$;function it(h,dt){if(!c)c=dt;else if(!b)b=dt;else{var ft="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+b+")(sharedChunk); self.onerror = null;",xt={};c(xt),$=dt(xt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&($.workerUrl=window.URL.createObjectURL(new Blob([ft],{type:"text/javascript"})))}}it(["exports"],function(h){var dt=1e-6,ft=typeof Float32Array<"u"?Float32Array:Array;function xt(d,s){var a=s[0],_=s[1],j=s[2],tt=s[3],rt=a*tt-j*_;return rt?(d[0]=tt*(rt=1/rt),d[1]=-_*rt,d[2]=-j*rt,d[3]=a*rt,d):null}function Ct(){var d=new ft(9);return ft!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[5]=0,d[6]=0,d[7]=0),d[0]=1,d[4]=1,d[8]=1,d}function bt(d,s){var a=s[0],_=s[1],j=s[2],tt=s[3],rt=s[4],ot=s[5],ct=s[6],ht=s[7],mt=s[8];return d[0]=rt*mt-ot*ht,d[1]=j*ht-_*mt,d[2]=_*ot-j*rt,d[3]=ot*ct-tt*mt,d[4]=a*mt-j*ct,d[5]=j*tt-a*ot,d[6]=tt*ht-rt*ct,d[7]=_*ct-a*ht,d[8]=a*rt-_*tt,d}function kt(d,s,a){var _=s[0],j=s[1],tt=s[2],rt=s[3],ot=s[4],ct=s[5],ht=s[6],mt=s[7],gt=s[8],_t=a[0],Rt=a[1],Pt=a[2],zt=a[3],Vt=a[4],Gt=a[5],_i=a[6],er=a[7],rr=a[8];return d[0]=_t*_+Rt*rt+Pt*ht,d[1]=_t*j+Rt*ot+Pt*mt,d[2]=_t*tt+Rt*ct+Pt*gt,d[3]=zt*_+Vt*rt+Gt*ht,d[4]=zt*j+Vt*ot+Gt*mt,d[5]=zt*tt+Vt*ct+Gt*gt,d[6]=_i*_+er*rt+rr*ht,d[7]=_i*j+er*ot+rr*mt,d[8]=_i*tt+er*ct+rr*gt,d}function Dt(){var d=new ft(16);return ft!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0),d[0]=1,d[5]=1,d[10]=1,d[15]=1,d}function At(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}function Bt(d,s){var a=s[0],_=s[1],j=s[2],tt=s[3],rt=s[4],ot=s[5],ct=s[6],ht=s[7],mt=s[8],gt=s[9],_t=s[10],Rt=s[11],Pt=s[12],zt=s[13],Vt=s[14],Gt=s[15],_i=a*ot-_*rt,er=a*ct-j*rt,rr=a*ht-tt*rt,_r=_*ct-j*ot,xr=_*ht-tt*ot,Er=j*ht-tt*ct,Ar=mt*zt-gt*Pt,Pr=mt*Vt-_t*Pt,sn=mt*Gt-Rt*Pt,Fr=gt*Vt-_t*zt,on=gt*Gt-Rt*zt,gn=_t*Gt-Rt*Vt,an=_i*gn-er*on+rr*Fr+_r*sn-xr*Pr+Er*Ar;return an?(d[0]=(ot*gn-ct*on+ht*Fr)*(an=1/an),d[1]=(j*on-_*gn-tt*Fr)*an,d[2]=(zt*Er-Vt*xr+Gt*_r)*an,d[3]=(_t*xr-gt*Er-Rt*_r)*an,d[4]=(ct*sn-rt*gn-ht*Pr)*an,d[5]=(a*gn-j*sn+tt*Pr)*an,d[6]=(Vt*rr-Pt*Er-Gt*er)*an,d[7]=(mt*Er-_t*rr+Rt*er)*an,d[8]=(rt*on-ot*sn+ht*Ar)*an,d[9]=(_*sn-a*on-tt*Ar)*an,d[10]=(Pt*xr-zt*rr+Gt*_i)*an,d[11]=(gt*rr-mt*xr-Rt*_i)*an,d[12]=(ot*Pr-rt*Fr-ct*Ar)*an,d[13]=(a*Fr-_*Pr+j*Ar)*an,d[14]=(zt*er-Pt*_r-Vt*_i)*an,d[15]=(mt*_r-gt*er+_t*_i)*an,d):null}function Tt(d,s,a){var _=s[0],j=s[1],tt=s[2],rt=s[3],ot=s[4],ct=s[5],ht=s[6],mt=s[7],gt=s[8],_t=s[9],Rt=s[10],Pt=s[11],zt=s[12],Vt=s[13],Gt=s[14],_i=s[15],er=a[0],rr=a[1],_r=a[2],xr=a[3];return d[0]=er*_+rr*ot+_r*gt+xr*zt,d[1]=er*j+rr*ct+_r*_t+xr*Vt,d[2]=er*tt+rr*ht+_r*Rt+xr*Gt,d[3]=er*rt+rr*mt+_r*Pt+xr*_i,d[4]=(er=a[4])*_+(rr=a[5])*ot+(_r=a[6])*gt+(xr=a[7])*zt,d[5]=er*j+rr*ct+_r*_t+xr*Vt,d[6]=er*tt+rr*ht+_r*Rt+xr*Gt,d[7]=er*rt+rr*mt+_r*Pt+xr*_i,d[8]=(er=a[8])*_+(rr=a[9])*ot+(_r=a[10])*gt+(xr=a[11])*zt,d[9]=er*j+rr*ct+_r*_t+xr*Vt,d[10]=er*tt+rr*ht+_r*Rt+xr*Gt,d[11]=er*rt+rr*mt+_r*Pt+xr*_i,d[12]=(er=a[12])*_+(rr=a[13])*ot+(_r=a[14])*gt+(xr=a[15])*zt,d[13]=er*j+rr*ct+_r*_t+xr*Vt,d[14]=er*tt+rr*ht+_r*Rt+xr*Gt,d[15]=er*rt+rr*mt+_r*Pt+xr*_i,d}function It(d,s,a){var _,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt=a[0],Vt=a[1],Gt=a[2];return s===d?(d[12]=s[0]*zt+s[4]*Vt+s[8]*Gt+s[12],d[13]=s[1]*zt+s[5]*Vt+s[9]*Gt+s[13],d[14]=s[2]*zt+s[6]*Vt+s[10]*Gt+s[14],d[15]=s[3]*zt+s[7]*Vt+s[11]*Gt+s[15]):(j=s[1],tt=s[2],rt=s[3],ot=s[4],ct=s[5],ht=s[6],mt=s[7],gt=s[8],_t=s[9],Rt=s[10],Pt=s[11],d[0]=_=s[0],d[1]=j,d[2]=tt,d[3]=rt,d[4]=ot,d[5]=ct,d[6]=ht,d[7]=mt,d[8]=gt,d[9]=_t,d[10]=Rt,d[11]=Pt,d[12]=_*zt+ot*Vt+gt*Gt+s[12],d[13]=j*zt+ct*Vt+_t*Gt+s[13],d[14]=tt*zt+ht*Vt+Rt*Gt+s[14],d[15]=rt*zt+mt*Vt+Pt*Gt+s[15]),d}function St(d,s,a){var _=a[0],j=a[1],tt=a[2];return d[0]=s[0]*_,d[1]=s[1]*_,d[2]=s[2]*_,d[3]=s[3]*_,d[4]=s[4]*j,d[5]=s[5]*j,d[6]=s[6]*j,d[7]=s[7]*j,d[8]=s[8]*tt,d[9]=s[9]*tt,d[10]=s[10]*tt,d[11]=s[11]*tt,d[12]=s[12],d[13]=s[13],d[14]=s[14],d[15]=s[15],d}function jt(d,s,a){var _=Math.sin(a),j=Math.cos(a),tt=s[4],rt=s[5],ot=s[6],ct=s[7],ht=s[8],mt=s[9],gt=s[10],_t=s[11];return s!==d&&(d[0]=s[0],d[1]=s[1],d[2]=s[2],d[3]=s[3],d[12]=s[12],d[13]=s[13],d[14]=s[14],d[15]=s[15]),d[4]=tt*j+ht*_,d[5]=rt*j+mt*_,d[6]=ot*j+gt*_,d[7]=ct*j+_t*_,d[8]=ht*j-tt*_,d[9]=mt*j-rt*_,d[10]=gt*j-ot*_,d[11]=_t*j-ct*_,d}function Ht(d,s,a){var _=Math.sin(a),j=Math.cos(a),tt=s[0],rt=s[1],ot=s[2],ct=s[3],ht=s[8],mt=s[9],gt=s[10],_t=s[11];return s!==d&&(d[4]=s[4],d[5]=s[5],d[6]=s[6],d[7]=s[7],d[12]=s[12],d[13]=s[13],d[14]=s[14],d[15]=s[15]),d[0]=tt*j-ht*_,d[1]=rt*j-mt*_,d[2]=ot*j-gt*_,d[3]=ct*j-_t*_,d[8]=tt*_+ht*j,d[9]=rt*_+mt*j,d[10]=ot*_+gt*j,d[11]=ct*_+_t*j,d}function Kt(d,s,a){var _=Math.sin(a),j=Math.cos(a),tt=s[0],rt=s[1],ot=s[2],ct=s[3],ht=s[4],mt=s[5],gt=s[6],_t=s[7];return s!==d&&(d[8]=s[8],d[9]=s[9],d[10]=s[10],d[11]=s[11],d[12]=s[12],d[13]=s[13],d[14]=s[14],d[15]=s[15]),d[0]=tt*j+ht*_,d[1]=rt*j+mt*_,d[2]=ot*j+gt*_,d[3]=ct*j+_t*_,d[4]=ht*j-tt*_,d[5]=mt*j-rt*_,d[6]=gt*j-ot*_,d[7]=_t*j-ct*_,d}function ir(d,s){return d[0]=s[0],d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=s[1],d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=s[2],d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}function nr(d,s,a){var _,j,tt,rt=a[0],ot=a[1],ct=a[2],ht=Math.sqrt(rt*rt+ot*ot+ct*ct);return ht<dt?null:(rt*=ht=1/ht,ot*=ht,ct*=ht,_=Math.sin(s),j=Math.cos(s),d[0]=rt*rt*(tt=1-j)+j,d[1]=ot*rt*tt+ct*_,d[2]=ct*rt*tt-ot*_,d[3]=0,d[4]=rt*ot*tt-ct*_,d[5]=ot*ot*tt+j,d[6]=ct*ot*tt+rt*_,d[7]=0,d[8]=rt*ct*tt+ot*_,d[9]=ot*ct*tt-rt*_,d[10]=ct*ct*tt+j,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d)}function kr(d,s){var a=s[0],_=s[1],j=s[2],tt=s[3],rt=a+a,ot=_+_,ct=j+j,ht=a*rt,mt=_*rt,gt=_*ot,_t=j*rt,Rt=j*ot,Pt=j*ct,zt=tt*rt,Vt=tt*ot,Gt=tt*ct;return d[0]=1-gt-Pt,d[1]=mt+Gt,d[2]=_t-Vt,d[3]=0,d[4]=mt-Gt,d[5]=1-ht-Pt,d[6]=Rt+zt,d[7]=0,d[8]=_t+Vt,d[9]=Rt-zt,d[10]=1-ht-gt,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}var br=Tt;function Sr(){var d=new ft(3);return ft!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0),d}function $r(d){var s=new ft(3);return s[0]=d[0],s[1]=d[1],s[2]=d[2],s}function rn(d){var s=d[0],a=d[1],_=d[2];return Math.sqrt(s*s+a*a+_*_)}function Zr(d,s,a){var _=new ft(3);return _[0]=d,_[1]=s,_[2]=a,_}function Kr(d,s,a,_){return d[0]=s,d[1]=a,d[2]=_,d}function Xt(d,s,a){return d[0]=s[0]+a[0],d[1]=s[1]+a[1],d[2]=s[2]+a[2],d}function mr(d,s,a){return d[0]=s[0]-a[0],d[1]=s[1]-a[1],d[2]=s[2]-a[2],d}function Ut(d,s,a){return d[0]=s[0]*a[0],d[1]=s[1]*a[1],d[2]=s[2]*a[2],d}function Jt(d,s,a){return d[0]=Math.min(s[0],a[0]),d[1]=Math.min(s[1],a[1]),d[2]=Math.min(s[2],a[2]),d}function Or(d,s,a){return d[0]=Math.max(s[0],a[0]),d[1]=Math.max(s[1],a[1]),d[2]=Math.max(s[2],a[2]),d}function Cr(d,s,a){return d[0]=s[0]*a,d[1]=s[1]*a,d[2]=s[2]*a,d}function pn(d,s,a,_){return d[0]=s[0]+a[0]*_,d[1]=s[1]+a[1]*_,d[2]=s[2]+a[2]*_,d}function On(d,s){var a=s[0]-d[0],_=s[1]-d[1],j=s[2]-d[2];return a*a+_*_+j*j}function Zn(d){var s=d[0],a=d[1],_=d[2];return s*s+a*a+_*_}function As(d,s){return d[0]=-s[0],d[1]=-s[1],d[2]=-s[2],d}function ss(d,s){var a=s[0],_=s[1],j=s[2],tt=a*a+_*_+j*j;return tt>0&&(tt=1/Math.sqrt(tt)),d[0]=s[0]*tt,d[1]=s[1]*tt,d[2]=s[2]*tt,d}function Ls(d,s){return d[0]*s[0]+d[1]*s[1]+d[2]*s[2]}function $s(d,s,a){var _=s[0],j=s[1],tt=s[2],rt=a[0],ot=a[1],ct=a[2];return d[0]=j*ct-tt*ot,d[1]=tt*rt-_*ct,d[2]=_*ot-j*rt,d}function vo(d,s,a,_){var j=s[0],tt=s[1],rt=s[2];return d[0]=j+_*(a[0]-j),d[1]=tt+_*(a[1]-tt),d[2]=rt+_*(a[2]-rt),d}function Vs(d,s,a){var _=s[0],j=s[1],tt=s[2],rt=a[3]*_+a[7]*j+a[11]*tt+a[15];return d[0]=(a[0]*_+a[4]*j+a[8]*tt+a[12])/(rt=rt||1),d[1]=(a[1]*_+a[5]*j+a[9]*tt+a[13])/rt,d[2]=(a[2]*_+a[6]*j+a[10]*tt+a[14])/rt,d}function bo(d,s,a){var _=s[0],j=s[1],tt=s[2];return d[0]=_*a[0]+j*a[3]+tt*a[6],d[1]=_*a[1]+j*a[4]+tt*a[7],d[2]=_*a[2]+j*a[5]+tt*a[8],d}function Po(d,s,a){var _=a[0],j=a[1],tt=a[2],rt=a[3],ot=s[0],ct=s[1],ht=s[2],mt=j*ht-tt*ct,gt=tt*ot-_*ht,_t=_*ct-j*ot;return d[0]=ot+rt*(mt+=mt)+j*(_t+=_t)-tt*(gt+=gt),d[1]=ct+rt*gt+tt*mt-_*_t,d[2]=ht+rt*_t+_*gt-j*mt,d}function ws(d){return d[0]=0,d[1]=0,d[2]=0,d}function Jn(d,s){return d[0]===s[0]&&d[1]===s[1]&&d[2]===s[2]}var Hs=mr,El=Ut,Xo=rn;function _l(){var d=new ft(4);return ft!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0,d[3]=0),d}function Io(d,s,a){return d[0]=s[0]*a,d[1]=s[1]*a,d[2]=s[2]*a,d[3]=s[3]*a,d}function Pl(d,s){var a=s[0],_=s[1],j=s[2],tt=s[3],rt=a*a+_*_+j*j+tt*tt;return rt>0&&(rt=1/Math.sqrt(rt)),d[0]=a*rt,d[1]=_*rt,d[2]=j*rt,d[3]=tt*rt,d}function Uo(d,s,a){var _=s[0],j=s[1],tt=s[2],rt=s[3];return d[0]=a[0]*_+a[4]*j+a[8]*tt+a[12]*rt,d[1]=a[1]*_+a[5]*j+a[9]*tt+a[13]*rt,d[2]=a[2]*_+a[6]*j+a[10]*tt+a[14]*rt,d[3]=a[3]*_+a[7]*j+a[11]*tt+a[15]*rt,d}function Fl(){var d=new ft(4);return ft!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0),d[3]=1,d}function Vl(d){return d[0]=0,d[1]=0,d[2]=0,d[3]=1,d}function _a(d,s,a){a*=.5;var _=s[0],j=s[1],tt=s[2],rt=s[3],ot=Math.sin(a),ct=Math.cos(a);return d[0]=_*ct+rt*ot,d[1]=j*ct+tt*ot,d[2]=tt*ct-j*ot,d[3]=rt*ct-_*ot,d}function Xl(d,s,a){a*=.5;var _=s[0],j=s[1],tt=s[2],rt=s[3],ot=Math.sin(a),ct=Math.cos(a);return d[0]=_*ct-tt*ot,d[1]=j*ct+rt*ot,d[2]=tt*ct+_*ot,d[3]=rt*ct-j*ot,d}Sr(),_l();var Go,xl,$u,su=Pl,Mu=(Go=Sr(),xl=Zr(1,0,0),$u=Zr(0,1,0),function(d,s,a){var _=Ls(s,a);return _<-.999999?($s(Go,xl,s),Xo(Go)<1e-6&&$s(Go,$u,s),ss(Go,Go),function(j,tt,rt){rt*=.5;var ot=Math.sin(rt);j[0]=ot*tt[0],j[1]=ot*tt[1],j[2]=ot*tt[2],j[3]=Math.cos(rt)}(d,Go,Math.PI),d):_>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):($s(Go,s,a),d[0]=Go[0],d[1]=Go[1],d[2]=Go[2],d[3]=1+_,su(d,d))});function Ol(){var d=new ft(2);return ft!=Float32Array&&(d[0]=0,d[1]=0),d}function bu(d,s){var a=new ft(2);return a[0]=d,a[1]=s,a}function _h(d,s,a){return d[0]=s,d[1]=a,d}function Hu(d,s,a){return d[0]=s[0]+a[0],d[1]=s[1]+a[1],d}function ku(d,s,a){return d[0]=s[0]-a[0],d[1]=s[1]-a[1],d}function _d(d,s,a){return d[0]=s[0]*a,d[1]=s[1]*a,d}function dp(d){var s=d[0],a=d[1];return Math.sqrt(s*s+a*a)}function So(d,s){var a=s[0],_=s[1],j=a*a+_*_;return j>0&&(j=1/Math.sqrt(j)),d[0]=s[0]*j,d[1]=s[1]*j,d}function Qo(d,s){return d[0]*s[0]+d[1]*s[1]}Fl(),Fl(),Ct();var ep,pp,wu=ku;function Ap(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}Ol();var Wp=function(){if(pp)return ep;function d(s,a,_,j){this.cx=3*s,this.bx=3*(_-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(j-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=a,this.p2x=_,this.p2y=j}return pp=1,ep=d,d.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,a){if(a===void 0&&(a=1e-6),s<0)return 0;if(s>1)return 1;for(var _=s,j=0;j<8;j++){var tt=this.sampleCurveX(_)-s;if(Math.abs(tt)<a)return _;var rt=this.sampleCurveDerivativeX(_);if(Math.abs(rt)<1e-6)break;_-=tt/rt}var ot=0,ct=1;for(_=s,j=0;j<20&&(tt=this.sampleCurveX(_),!(Math.abs(tt-s)<a));j++)s>tt?ot=_:ct=_,_=.5*(ct-ot)+ot;return _},solve:function(s,a){return this.sampleCurveY(this.solveCurveX(s,a))}},ep}(),Wu=Ap(Wp);function yn(d,s){this.x=d,this.y=s}function qu(d,s){if(Array.isArray(d)){if(!Array.isArray(s)||d.length!==s.length)return!1;for(let a=0;a<d.length;a++)if(!qu(d[a],s[a]))return!1;return!0}if(typeof d=="object"&&d!==null&&s!==null){if(typeof s!="object"||Object.keys(d).length!==Object.keys(s).length)return!1;for(const a in d)if(!qu(d[a],s[a]))return!1;return!0}return d===s}yn.prototype={clone(){return new yn(this.x,this.y)},add(d){return this.clone()._add(d)},sub(d){return this.clone()._sub(d)},multByPoint(d){return this.clone()._multByPoint(d)},divByPoint(d){return this.clone()._divByPoint(d)},mult(d){return this.clone()._mult(d)},div(d){return this.clone()._div(d)},rotate(d){return this.clone()._rotate(d)},rotateAround(d,s){return this.clone()._rotateAround(d,s)},matMult(d){return this.clone()._matMult(d)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(d){return this.x===d.x&&this.y===d.y},dist(d){return Math.sqrt(this.distSqr(d))},distSqr(d){const s=d.x-this.x,a=d.y-this.y;return s*s+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(d){return Math.atan2(this.y-d.y,this.x-d.x)},angleWith(d){return this.angleWithSep(d.x,d.y)},angleWithSep(d,s){return Math.atan2(this.x*s-this.y*d,this.x*d+this.y*s)},_matMult(d){const s=d[2]*this.x+d[3]*this.y;return this.x=d[0]*this.x+d[1]*this.y,this.y=s,this},_add(d){return this.x+=d.x,this.y+=d.y,this},_sub(d){return this.x-=d.x,this.y-=d.y,this},_mult(d){return this.x*=d,this.y*=d,this},_div(d){return this.x/=d,this.y/=d,this},_multByPoint(d){return this.x*=d.x,this.y*=d.y,this},_divByPoint(d){return this.x/=d.x,this.y/=d.y,this},_unit(){return this._div(this.mag()),this},_perp(){const d=this.y;return this.y=this.x,this.x=-d,this},_rotate(d){const s=Math.cos(d),a=Math.sin(d),_=a*this.x+s*this.y;return this.x=s*this.x-a*this.y,this.y=_,this},_rotateAround(d,s){const a=Math.cos(d),_=Math.sin(d),j=s.y+_*(this.x-s.x)+a*(this.y-s.y);return this.x=s.x+a*(this.x-s.x)-_*(this.y-s.y),this.y=j,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:yn},yn.convert=function(d){if(d instanceof yn)return d;if(Array.isArray(d))return new yn(+d[0],+d[1]);if(d.x!==void 0&&d.y!==void 0)return new yn(+d.x,+d.y);throw new Error("Expected [x, y] or {x, y} point format")};const qp=Math.PI/180,tp=180/Math.PI;function Lr(d){return d*qp}function Wt(d){return d*tp}const Qt=[[0,0],[1,0],[1,1],[0,1]];function lr(d){if(d<=0)return 0;if(d>=1)return 1;const s=d*d,a=s*d;return 4*(d<.5?a:3*(d-s)+a-.75)}function wr(d,s,a,_){const j=new Wu(d,s,a,_);return function(tt){return j.solve(tt)}}const vr=wr(.25,.1,.25,1);function fr(d,s,a){return Math.min(a,Math.max(s,d))}function Ur(d,s,a){return(a=fr((a-d)/(s-d),0,1))*a*(3-2*a)}function Rr(d,s,a){const _=a-s,j=((d-s)%_+_)%_+s;return j===s?a:j}function Xr(d,s,a){if(!d.length)return a(null,[]);let _=d.length;const j=new Array(d.length);let tt=null;d.forEach((rt,ot)=>{s(rt,(ct,ht)=>{ct&&(tt=ct),j[ot]=ht,--_==0&&a(tt,j)})})}let Sn=1;function ln(){return Sn++}function Hn(d){return d<=1?1:Math.pow(2,Math.ceil(Math.log2(d)))}function rs(d,s){d.forEach(a=>{s[a]&&(s[a]=s[a].bind(s))})}function ds(d,s,a){const _={};for(const j in d)_[j]=s.call(this,d[j],j,d);return _}function js(d,s,a){const _={};for(const j in d)s.call(this,d[j],j,d)&&(_[j]=d[j]);return _}function Rs(d){return Array.isArray(d)?d.map(Rs):typeof d=="object"&&d?ds(d,Rs):d}function Fs(d,s){for(let a=0;a<d.length;a++)if(s.indexOf(d[a])>=0)return!0;return!1}const Gs={};function Es(d){Gs[d]||(typeof console<"u"&&console.warn(d),Gs[d]=!0)}function Mo(d,s,a){return(a.y-d.y)*(s.x-d.x)>(s.y-d.y)*(a.x-d.x)}function Jo(d){let s=0;for(let a,_,j=0,tt=d.length,rt=tt-1;j<tt;rt=j++)a=d[j],_=d[rt],s+=(_.x-a.x)*(a.y+_.y);return s}function na([d,s,a]){const _=Lr(s+90),j=Lr(a);return{x:d*Math.cos(_)*Math.sin(j),y:d*Math.sin(_)*Math.sin(j),z:d*Math.cos(j),azimuthal:s,polar:a}}function ao(d){return(typeof self<"u"||d!==void 0)&&typeof WorkerGlobalScope<"u"&&(d!==void 0?d:self)instanceof WorkerGlobalScope}function Ws(d){const s={};if(d.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,_,j,tt)=>{const rt=j||tt;return s[_]=!rt||rt.toLowerCase(),""}),s["max-age"]){const a=parseInt(s["max-age"],10);isNaN(a)?delete s["max-age"]:s["max-age"]=a}return s}let ho=null;function zo(d,s){return[d[4*s],d[4*s+1],d[4*s+2],d[4*s+3]]}function po(d,s,a,_){for(;s<a;){const j=s+a>>1;d[j]<_?s=j+1:a=j}return s}function qo(d,s,a,_){for(;s<a;){const j=s+a>>1;d[j]<=_?s=j+1:a=j}return s}function Ul(d){return d>0?1/(1.001-d):1+d}function mu(d){return d>0?1-1/(1.001-d):-d}function Zu(d,s,a){return(d-s.min)*(a.max-a.min)/(s.max-s.min)+a.min}const Gl={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Gl.API_URL)return null;try{const d=new URL(Gl.API_URL);return d.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":d.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Zp(d){return Gl.API_URL_REGEX.test(d)}function P_(d){return Gl.API_SPRITE_REGEX.test(d)}let ip,Rp,Xp,Kp,Il,Yp;function ey(){return ip==null&&(ip=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ip}const gu={now:()=>Kp!==void 0?Kp:performance.now(),setNow(d){Kp=d},restoreNow(){Kp=void 0},frame(d){const s=requestAnimationFrame(d);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(d,s=0){const{width:a,height:_}=d;Il||(Il=document.createElement("canvas"));const j=Il.getContext("2d",{willReadFrequently:!0});if(!j)throw new Error("failed to create canvas 2d context");return(a>Il.width||_>Il.height)&&(Il.width=a,Il.height=_),j.clearRect(-s,-s,a+2*s,_+2*s),j.drawImage(d,0,0,a,_),j.getImageData(-s,-s,a+2*s,_+2*s)},resolveURL:d=>(Rp||(Rp=document.createElement("a")),Rp.href=d,Rp.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Xp==null&&(Xp=window.matchMedia("(prefers-reduced-motion: reduce)")),Xp.matches)},hasCanvasFingerprintNoise(){if(Yp!==void 0)return Yp;if(!ey())return Yp=!1,!1;const d=new OffscreenCanvas(85,1),s=d.getContext("2d",{willReadFrequently:!0});let a=0;for(let j=0;j<d.width;++j)s.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,s.fillRect(j,0,1,1);const _=s.getImageData(0,0,d.width,d.height);a=0;for(let j=0;j<_.data.length;++j)if(j%4!=3&&a++!==_.data[j])return Yp=!0,!0;return Yp=!1,!1}};function ty(d,s){const a=d.indexOf("?");if(a<0)return`${d}?${new URLSearchParams(s).toString()}`;const _=new URLSearchParams(d.slice(a));for(const j in s)_.set(j,s[j]);return`${d.slice(0,a)}?${_.toString()}`}function Cm(d,s={persistentParams:[]}){const a=d.indexOf("?");if(a<0)return d;const _=new URLSearchParams,j=new URLSearchParams(d.slice(a));for(const rt of s.persistentParams){const ot=j.get(rt);ot&&_.set(rt,ot)}const tt=_.toString();return`${d.slice(0,a)}${tt.length>0?`?${tt}`:""}`}const yu="mapbox-tiles";let Du=500,Xu=50;const Eu=["language","worldview","jobid"];let $l,fp;function iy(){try{return caches}catch{}}function rp(){const d=iy();d&&$l==null&&($l=d.open(yu))}let mp=1/0;const Am={supported:!1,testSupport:function(d){!ou&&Qp&&(Pp?Jp(d):Rm=d)}};let Rm,Qp,ou=!1,Pp=!1;const ry=typeof self<"u"?self:{};function Jp(d){const s=d.createTexture();d.bindTexture(d.TEXTURE_2D,s);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,Qp),d.isContextLost())return;Am.supported=!0}catch{}d.deleteTexture(s),ou=!0}ry.document&&(Qp=ry.document.createElement("img"),Qp.onload=function(){Rm&&Jp(Rm),Rm=null,Pp=!0},Qp.onerror=function(){ou=!0,Rm=null},Qp.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ny={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ny);class Zy extends Error{constructor(s,a,_){a===401&&Zp(_)&&(s+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(s),this.status=a,this.url=_}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const _f=ao()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ns=function(d,s){if(!(/^file:/.test(a=d.url)||/^file:/.test(_f())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(_,j){const tt=new AbortController,rt=new Request(_.url,{method:_.method||"GET",body:_.body,credentials:_.credentials,headers:_.headers,referrer:_f(),referrerPolicy:_.referrerPolicy,signal:tt.signal});let ot=!1,ct=!1;const ht=(mt=rt.url).indexOf("sku=")>0&&Zp(mt);var mt;_.type==="json"&&rt.headers.set("Accept","application/json");const gt=(Rt,Pt,zt)=>{if(ct)return;if(Rt&&Rt.message!=="SecurityError"&&Es(Rt.toString()),Pt&&zt)return _t(Pt);const Vt=Date.now();fetch(rt).then(Gt=>{if(Gt.ok){const _i=ht?Gt.clone():null;return _t(Gt,_i,Vt)}return j(new Zy(Gt.statusText,Gt.status,_.url))}).catch(Gt=>{Gt.name!=="AbortError"&&j(new Error(`${Gt.message} ${_.url}`))})},_t=(Rt,Pt,zt)=>{(_.type==="arrayBuffer"?Rt.arrayBuffer():_.type==="json"?Rt.json():Rt.text()).then(Vt=>{ct||(Pt&&zt&&function(Gt,_i,er){if(rp(),$l==null)return;const rr=Ws(_i.headers.get("Cache-Control")||"");if(rr["no-store"])return;const _r={status:_i.status,statusText:_i.statusText,headers:new Headers};_i.headers.forEach((Ar,Pr)=>_r.headers.set(Pr,Ar)),rr["max-age"]&&_r.headers.set("Expires",new Date(er+1e3*rr["max-age"]).toUTCString());const xr=_r.headers.get("Expires");if(!xr||new Date(xr).getTime()-er<42e4)return;let Er=Cm(Gt.url,{persistentParams:Eu});if(_i.status===206){const Ar=Gt.headers.get("Range");if(!Ar)return;_r.status=200,Er=ty(Er,{range:Ar})}(function(Ar,Pr){if(fp===void 0)try{new Response(new ReadableStream),fp=!0}catch{fp=!1}fp?Pr(Ar.body):Ar.blob().then(Pr).catch(sn=>Es(sn.message))})(_i,Ar=>{const Pr=new Response((sn=_i.status)!==200&&sn!==404&&[101,103,204,205,304].includes(sn)?null:Ar,_r);var sn;rp(),$l!=null&&$l.then(Fr=>Fr.put(Er,Pr)).catch(Fr=>Es(Fr.message))})}(rt,Pt,zt),ot=!0,j(null,Vt,Rt.headers.get("Cache-Control"),Rt.headers.get("Expires")))}).catch(Vt=>{ct||j(new Error(Vt.message))})};return ht?function(Rt,Pt){if(rp(),$l==null)return Pt(null);$l.then(zt=>{let Vt=Cm(Rt.url,{persistentParams:Eu});const Gt=Rt.headers.get("Range");Gt&&(Vt=ty(Vt,{range:Gt})),zt.match(Vt).then(_i=>{const er=function(rr){if(!rr)return!1;const _r=new Date(rr.headers.get("Expires")||0),xr=Ws(rr.headers.get("Cache-Control")||"");return Number(_r)>Date.now()&&!xr["no-cache"]}(_i);zt.delete(Vt).catch(Pt),er&&zt.put(Vt,_i.clone()).catch(Pt),Pt(null,_i,er)}).catch(Pt)}).catch(Pt)}(rt,gt):gt(null,null),{cancel:()=>{ct=!0,ot||tt.abort()}}}(d,s);if(ao(self)&&self.worker.actor)return self.worker.actor.send("getResource",d,s,void 0,!0)}var a;return function(_,j){const tt=new XMLHttpRequest;tt.open(_.method||"GET",_.url,!0),_.type==="arrayBuffer"&&(tt.responseType="arraybuffer");for(const rt in _.headers)tt.setRequestHeader(rt,_.headers[rt]);return _.type==="json"&&(tt.responseType="text",tt.setRequestHeader("Accept","application/json")),tt.withCredentials=_.credentials==="include",tt.onerror=()=>{j(new Error(tt.statusText))},tt.onload=()=>{if((tt.status>=200&&tt.status<300||tt.status===0)&&tt.response!==null){let rt=tt.response;if(_.type==="json")try{rt=JSON.parse(tt.response)}catch(ot){return j(ot)}j(null,rt,tt.getResponseHeader("Cache-Control"),tt.getResponseHeader("Expires"))}else j(new Zy(tt.statusText,tt.status,_.url))},tt.send(_.body),{cancel:()=>tt.abort()}}(d,s)},Ip=function(d,s){return Ns(Object.assign(d,{type:"arrayBuffer"}),s)};function em(d){const s=document.createElement("a");return s.href=d,s.protocol===location.protocol&&s.host===location.host}const Tu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let sy,gp;sy=[],gp=0;const Mp=function(d,s){if(Am.supported&&(d.headers||(d.headers={}),d.headers.accept="image/webp,*/*"),gp>=Gl.MAX_PARALLEL_IMAGE_REQUESTS){const tt={requestParameters:d,callback:s,cancelled:!1,cancel(){this.cancelled=!0}};return sy.push(tt),tt}gp++;let a=!1;const _=()=>{if(!a)for(a=!0,gp--;sy.length&&gp<Gl.MAX_PARALLEL_IMAGE_REQUESTS;){const tt=sy.shift(),{requestParameters:rt,callback:ot,cancelled:ct}=tt;ct||(tt.cancel=Mp(rt,ot).cancel)}},j=Ip(d,(tt,rt,ot,ct)=>{_(),tt?s(tt):rt&&(self.createImageBitmap?function(ht,mt){const gt=new Blob([new Uint8Array(ht)],{type:"image/png"});createImageBitmap(gt).then(_t=>{mt(null,_t)}).catch(_t=>{mt(new Error(`Could not load image because of ${_t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(rt,(ht,mt)=>s(ht,mt,ot,ct)):function(ht,mt){const gt=new Image;gt.onload=()=>{mt(null,gt),URL.revokeObjectURL(gt.src),gt.onload=null,requestAnimationFrame(()=>{gt.src=Tu})},gt.onerror=()=>mt(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _t=new Blob([new Uint8Array(ht)],{type:"image/png"});gt.src=ht.byteLength?URL.createObjectURL(_t):Tu}(rt,(ht,mt)=>s(ht,mt,ot,ct)))});return{cancel:()=>{j.cancel(),_()}}};var tm,im,oy,Su={exports:{}},Xy={exports:{}},Pm={exports:{}},rm=function(){if(oy)return Su.exports;oy=1;var d=(tm||(tm=1,Xy.exports=function(a,_){var j,tt,rt,ot,ct,ht,mt,gt;for(tt=a.length-(j=3&a.length),rt=_,ct=3432918353,ht=461845907,gt=0;gt<tt;)mt=255&a.charCodeAt(gt)|(255&a.charCodeAt(++gt))<<8|(255&a.charCodeAt(++gt))<<16|(255&a.charCodeAt(++gt))<<24,++gt,rt=27492+(65535&(ot=5*(65535&(rt=(rt^=mt=(65535&(mt=(mt=(65535&mt)*ct+(((mt>>>16)*ct&65535)<<16)&4294967295)<<15|mt>>>17))*ht+(((mt>>>16)*ht&65535)<<16)&4294967295)<<13|rt>>>19))+((5*(rt>>>16)&65535)<<16)&4294967295))+((58964+(ot>>>16)&65535)<<16);switch(mt=0,j){case 3:mt^=(255&a.charCodeAt(gt+2))<<16;case 2:mt^=(255&a.charCodeAt(gt+1))<<8;case 1:rt^=mt=(65535&(mt=(mt=(65535&(mt^=255&a.charCodeAt(gt)))*ct+(((mt>>>16)*ct&65535)<<16)&4294967295)<<15|mt>>>17))*ht+(((mt>>>16)*ht&65535)<<16)&4294967295}return rt^=a.length,rt=2246822507*(65535&(rt^=rt>>>16))+((2246822507*(rt>>>16)&65535)<<16)&4294967295,rt=3266489909*(65535&(rt^=rt>>>13))+((3266489909*(rt>>>16)&65535)<<16)&4294967295,(rt^=rt>>>16)>>>0}),Xy.exports),s=(im||(im=1,Pm.exports=function(a,_){for(var j,tt=a.length,rt=_^tt,ot=0;tt>=4;)j=1540483477*(65535&(j=255&a.charCodeAt(ot)|(255&a.charCodeAt(++ot))<<8|(255&a.charCodeAt(++ot))<<16|(255&a.charCodeAt(++ot))<<24))+((1540483477*(j>>>16)&65535)<<16),rt=1540483477*(65535&rt)+((1540483477*(rt>>>16)&65535)<<16)^(j=1540483477*(65535&(j^=j>>>24))+((1540483477*(j>>>16)&65535)<<16)),tt-=4,++ot;switch(tt){case 3:rt^=(255&a.charCodeAt(ot+2))<<16;case 2:rt^=(255&a.charCodeAt(ot+1))<<8;case 1:rt=1540483477*(65535&(rt^=255&a.charCodeAt(ot)))+((1540483477*(rt>>>16)&65535)<<16)}return rt=1540483477*(65535&(rt^=rt>>>13))+((1540483477*(rt>>>16)&65535)<<16),(rt^=rt>>>15)>>>0}),Pm.exports);return Su.exports=d,Su.exports.murmur3=d,Su.exports.murmur2=s,Su.exports}(),ay=Ap(rm);class au{constructor(s,...a){Object.assign(this,a[0]||{}),this.type=s}}class nm extends au{constructor(s,a={}){super("error",Object.assign({error:s},a))}}function Im(d,s,a){a[d]&&a[d].indexOf(s)!==-1||(a[d]=a[d]||[],a[d].push(s))}function _u(d,s,a){if(a&&a[d]){const _=a[d].indexOf(s);_!==-1&&a[d].splice(_,1)}}class kp{on(s,a){return this._listeners=this._listeners||{},Im(s,a,this._listeners),this}off(s,a){return _u(s,a,this._listeners),_u(s,a,this._oneTimeListeners),this}once(s,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Im(s,a,this._oneTimeListeners),this):new Promise(_=>{this.once(s,_)})}fire(s,a){const _=typeof s=="string"?new au(s,a):s,j=_.type;if(this.listens(j)){_.target=this;const tt=this._listeners&&this._listeners[j]?this._listeners[j].slice():[];for(const ct of tt)ct.call(this,_);const rt=this._oneTimeListeners&&this._oneTimeListeners[j]?this._oneTimeListeners[j].slice():[];for(const ct of rt)_u(j,ct,this._oneTimeListeners),ct.call(this,_);const ot=this._eventedParent;if(ot){const ct=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(_,ct),ot.fire(_)}}else _ instanceof nm&&console.error(_.error);return this}listens(s){return!!(this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s))}setEventedParent(s,a){return this._eventedParent=s,this._eventedParentData=a,this}}class Jl{constructor(s){typeof s=="string"?this.name=s:(this.name=s.name,this.iconsetId=s.iconsetId)}static from(s){return new Jl(s)}static toString(s){return s.iconsetId?`${s.name}${s.iconsetId}`:s.name}static parse(s){const[a,_]=s.split("");return new Jl({name:a,iconsetId:_})}static isEqual(s,a){return s.name===a.name&&s.iconsetId===a.iconsetId}toString(){return Jl.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var ly,cy={},uy=function(){if(ly)return cy;ly=1;var d={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(tt){return(tt=Math.round(tt))<0?0:tt>255?255:tt}function a(tt){return s(tt[tt.length-1]==="%"?parseFloat(tt)/100*255:parseInt(tt))}function _(tt){return(rt=tt[tt.length-1]==="%"?parseFloat(tt)/100:parseFloat(tt))<0?0:rt>1?1:rt;var rt}function j(tt,rt,ot){return ot<0?ot+=1:ot>1&&(ot-=1),6*ot<1?tt+(rt-tt)*ot*6:2*ot<1?rt:3*ot<2?tt+(rt-tt)*(2/3-ot)*6:tt}try{cy.parseCSSColor=function(tt){var rt,ot=tt.replace(/ /g,"").toLowerCase();if(ot in d)return d[ot].slice();if(ot[0]==="#")return ot.length===4?(rt=parseInt(ot.substr(1),16))>=0&&rt<=4095?[(3840&rt)>>4|(3840&rt)>>8,240&rt|(240&rt)>>4,15&rt|(15&rt)<<4,1]:null:ot.length===7&&(rt=parseInt(ot.substr(1),16))>=0&&rt<=16777215?[(16711680&rt)>>16,(65280&rt)>>8,255&rt,1]:null;var ct=ot.indexOf("("),ht=ot.indexOf(")");if(ct!==-1&&ht+1===ot.length){var mt=ot.substr(0,ct),gt=ot.substr(ct+1,ht-(ct+1)).split(","),_t=1;switch(mt){case"rgba":if(gt.length!==4)return null;_t=_(gt.pop());case"rgb":return gt.length!==3?null:[a(gt[0]),a(gt[1]),a(gt[2]),_t];case"hsla":if(gt.length!==4)return null;_t=_(gt.pop());case"hsl":if(gt.length!==3)return null;var Rt=(parseFloat(gt[0])%360+360)%360/360,Pt=_(gt[1]),zt=_(gt[2]),Vt=zt<=.5?zt*(Pt+1):zt+Pt-zt*Pt,Gt=2*zt-Vt;return[s(255*j(Gt,Vt,Rt+1/3)),s(255*j(Gt,Vt,Rt)),s(255*j(Gt,Vt,Rt-1/3)),_t];default:return null}}return null}}catch{}return cy}();class Js{constructor(s,a,_,j=1){this.r=s,this.g=a,this.b=_,this.a=j}static parse(s){if(!s)return;if(s instanceof Js)return s;if(typeof s!="string")return;const a=uy.parseCSSColor(s);return a?new Js(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[s,a,_,j]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*s)},${Math.round(255*a)},${Math.round(255*_)},${j})`}toNonPremultipliedRenderColor(s){const{r:a,g:_,b:j,a:tt}=this;return new hy(s,a,_,j,tt)}toPremultipliedRenderColor(s){const{r:a,g:_,b:j,a:tt}=this;return new sm(s,a*tt,_*tt,j*tt,tt)}clone(){return new Js(this.r,this.g,this.b,this.a)}}class Ky{constructor(s,a,_,j,tt,rt=!1){if(this.premultiplied=!1,this.premultiplied=rt,s){const ot=s.image.height,ct=ot*ot;this.premultiplied?(a=tt===0?0:a/tt*(ot-1),_=tt===0?0:_/tt*(ot-1),j=tt===0?0:j/tt*(ot-1)):(a*=ot-1,_*=ot-1,j*=ot-1);const ht=Math.floor(a),mt=Math.floor(_),gt=Math.floor(j),_t=Math.ceil(a),Rt=Math.ceil(_),Pt=Math.ceil(j),zt=a-ht,Vt=_-mt,Gt=j-gt,_i=s.image.data,er=4*(ht+mt*ct+gt*ot),rr=4*(ht+mt*ct+Pt*ot),_r=4*(ht+Rt*ct+gt*ot),xr=4*(ht+Rt*ct+Pt*ot),Er=4*(_t+mt*ct+gt*ot),Ar=4*(_t+mt*ct+Pt*ot),Pr=4*(_t+Rt*ct+gt*ot),sn=4*(_t+Rt*ct+Pt*ot);if(er<0||sn>=_i.length)throw new Error("out of range");this.r=ns(ns(ns(_i[er],_i[rr],Gt),ns(_i[_r],_i[xr],Gt),Vt),ns(ns(_i[Er],_i[Ar],Gt),ns(_i[Pr],_i[sn],Gt),Vt),zt)/255*(this.premultiplied?tt:1),this.g=ns(ns(ns(_i[er+1],_i[rr+1],Gt),ns(_i[_r+1],_i[xr+1],Gt),Vt),ns(ns(_i[Er+1],_i[Ar+1],Gt),ns(_i[Pr+1],_i[sn+1],Gt),Vt),zt)/255*(this.premultiplied?tt:1),this.b=ns(ns(ns(_i[er+2],_i[rr+2],Gt),ns(_i[_r+2],_i[xr+2],Gt),Vt),ns(ns(_i[Er+2],_i[Ar+2],Gt),ns(_i[Pr+2],_i[sn+2],Gt),Vt),zt)/255*(this.premultiplied?tt:1),this.a=tt}else this.r=a,this.g=_,this.b=j,this.a=tt}toArray(){const{r:s,g:a,b:_,a:j}=this;return[255*s,255*a,255*_,j]}toHslaArray(){let{r:s,g:a,b:_,a:j}=this;if(this.premultiplied){if(j===0)return[0,0,0,0];const Pt=1/j;s*=Pt,a*=Pt,_*=Pt}const tt=Math.min(Math.max(s,0),1),rt=Math.min(Math.max(a,0),1),ot=Math.min(Math.max(_,0),1),ct=Math.min(tt,rt,ot),ht=Math.max(tt,rt,ot),mt=ht-ct,gt=.5*(ct+ht);if(mt===0)return[0,0,100*gt,j];const _t=gt>.5?mt/(2-ht-ct):mt/(ht+ct);let Rt;switch(ht){case tt:Rt=60*((rt-ot)/mt+(rt<ot?6:0));break;case rt:Rt=60*((ot-tt)/mt+2);break;default:Rt=60*((tt-rt)/mt+4)}return[Rt,100*_t,100*gt,j]}toArray01(){const{r:s,g:a,b:_,a:j}=this;return[s,a,_,j]}toArray01Scaled(s){const{r:a,g:_,b:j}=this;return[a*s,_*s,j*s]}toArray01Linear(){const{r:s,g:a,b:_,a:j}=this;return[Math.pow(s,2.2),Math.pow(a,2.2),Math.pow(_,2.2),j]}}class hy extends Ky{constructor(s,a,_,j,tt){super(s,a,_,j,tt,!1)}}class sm extends Ky{constructor(s,a,_,j,tt){super(s,a,_,j,tt,!0)}}function ns(d,s,a){return d*(1-a)+s*a}function Yy(d,s,a){return d.map((_,j)=>ns(_,s[j],a))}Js.black=new Js(0,0,0,1),Js.white=new Js(1,1,1,1),Js.transparent=new Js(0,0,0,0),Js.red=new Js(1,0,0,1),Js.blue=new Js(0,0,1,1);var xu=Object.freeze({__proto__:null,array:Yy,color:function(d,s,a){return new Js(ns(d.r,s.r,a),ns(d.g,s.g,a),ns(d.b,s.b,a),ns(d.a,s.a,a))},number:ns});class Lu extends Error{constructor(s,a){super(a),this.message=a,this.key=s}}class dy{constructor(s,a=[]){this.parent=s,this.bindings={};for(const[_,j]of a)this.bindings[_]=j}concat(s){return new dy(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const ju={kind:"null"},qn={kind:"number"},eo={kind:"string"},Ys={kind:"boolean"},uu={kind:"color"},Dp={kind:"object"},Zs={kind:"value"},Lp={kind:"collator"},yp={kind:"formatted"},Mm={kind:"resolvedImage"};function Kl(d,s){return{kind:"array",itemType:d,N:s}}function xa(d){if(d.kind==="array"){const s=xa(d.itemType);return typeof d.N=="number"?`array<${s}, ${d.N}>`:d.itemType.kind==="value"?"array":`array<${s}>`}return d.kind}const I_=[ju,qn,eo,Ys,uu,yp,Dp,Kl(Zs),Mm];function wt(d,s){if(s.kind==="error")return null;if(d.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!wt(d.itemType,s.itemType))&&(typeof d.N!="number"||d.N===s.N))return null}else{if(d.kind===s.kind)return null;if(d.kind==="value"){for(const a of I_)if(!wt(a,s))return null}}return`Expected ${xa(d)} but found ${xa(s)} instead.`}function Nt(d,s){return s.some(a=>a.kind===d.kind)}function Zt(d,s){return s.some(a=>a==="null"?d===null:a==="array"?Array.isArray(d):a==="object"?d&&!Array.isArray(d)&&typeof d=="object":a===typeof d)}function cr(d,s){return d.kind==="array"&&s.kind==="array"?d.N===s.N&&cr(d.itemType,s.itemType):d.kind===s.kind}class Mr{constructor(s,a,_){this.sensitivity=s?a?"variant":"case":a?"accent":"base",this.locale=_,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,a){return this.collator.compare(s,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class zr{constructor(s,a,_,j,tt){this.text=s.normalize?s.normalize():s,this.image=a,this.scale=_,this.fontStack=j,this.textColor=tt}}class Dr{constructor(s){this.sections=s}static fromString(s){return new Dr([new zr(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||!!s.image&&s.image.hasPrimary())}static factory(s){return s instanceof Dr?s:Dr.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}serialize(){const s=["format"];for(const a of this.sections){if(a.image){const j=a.image.getPrimary().id.toString();s.push(["image",j]);continue}s.push(a.text);const _={};a.fontStack&&(_["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(_["font-scale"]=a.scale),a.textColor&&(_["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),s.push(_)}return s}}class Jr{constructor(s,a={}){if(this.id=Jl.from(s),this.options=Object.assign({},a),a.transform){const{a:_,b:j,c:tt,d:rt,e:ot,f:ct}=a.transform;this.options.transform=new DOMMatrix([_,j,tt,rt,ot,ct])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:s,b:a,c:_,d:j,e:tt,f:rt}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:s,b:a,c:_,d:j,e:tt,f:rt}})}static parse(s){let a,_,j,tt;try{({name:a,iconsetId:_,params:j,transform:tt}=JSON.parse(s)||{})}catch{return null}if(!a)return null;const{a:rt,b:ot,c:ct,d:ht,e:mt,f:gt}=tt||{};return new Jr({name:a,iconsetId:_},{params:j,transform:new DOMMatrix([rt,ot,ct,ht,mt,gt])})}scaleSelf(s,a){return this.options.transform.scaleSelf(s,a),this}}class bn{constructor(s,a,_,j,tt=!1){this.primaryId=Jl.from(s),this.primaryOptions=a,_&&(this.secondaryId=Jl.from(_)),this.secondaryOptions=j,this.available=tt}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Jr(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Jr(this.secondaryId,this.secondaryOptions):null}static from(s){return typeof s=="string"?bn.build({name:s}):s}static build(s,a,_,j){return!s||typeof s=="object"&&!("name"in s)?null:new bn(s,_,a,j)}}function Qn(d,s,a,_){return typeof d=="number"&&d>=0&&d<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof a=="number"&&a>=0&&a<=255?_===void 0||typeof _=="number"&&_>=0&&_<=1?null:`Invalid rgba value [${[d,s,a,_].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof _=="number"?[d,s,a,_]:[d,s,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function as(d){if(d===null||typeof d=="string"||typeof d=="boolean"||typeof d=="number"||d instanceof Js||d instanceof Mr||d instanceof Dr||d instanceof bn)return!0;if(Array.isArray(d)){for(const s of d)if(!as(s))return!1;return!0}if(typeof d=="object"){for(const s in d)if(!as(d[s]))return!1;return!0}return!1}function _s(d){if(d===null)return ju;if(typeof d=="string")return eo;if(typeof d=="boolean")return Ys;if(typeof d=="number")return qn;if(d instanceof Js)return uu;if(d instanceof Mr)return Lp;if(d instanceof Dr)return yp;if(d instanceof bn)return Mm;if(Array.isArray(d)){const s=d.length;let a;for(const _ of d){const j=_s(_);if(a){if(a===j)continue;a=Zs;break}a=j}return Kl(a||Zs,s)}return Dp}function gs(d){const s=typeof d;return d===null?"":s==="string"||s==="number"||s==="boolean"?String(d):d instanceof Dr||d instanceof bn||d instanceof Js?d.toString():JSON.stringify(d)}class Pn{constructor(s,a){this.type=s,this.value=a}static parse(s,a){if(s.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!as(s[1]))return a.error("invalid value");const _=s[1];let j=_s(_);const tt=a.expectedType;return j.kind!=="array"||j.N!==0||!tt||tt.kind!=="array"||typeof tt.N=="number"&&tt.N!==0||(j=tt),new Pn(j,_)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Js?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Dr?this.value.serialize():this.value}}class fn{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const ro={string:eo,number:qn,boolean:Ys,object:Dp};class Vn{constructor(s,a){this.type=s,this.args=a}static parse(s,a){if(s.length<2)return a.error("Expected at least one argument.");let _,j=1;const tt=s[0];if(tt==="array"){let ot,ct;if(s.length>2){const ht=s[1];if(typeof ht!="string"||!(ht in ro)||ht==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);ot=ro[ht],j++}else ot=Zs;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return a.error('The length argument to "array" must be a positive integer literal',2);ct=s[2],j++}_=Kl(ot,ct)}else _=ro[tt];const rt=[];for(;j<s.length;j++){const ot=a.parse(s[j],j,Zs);if(!ot)return null;rt.push(ot)}return new Vn(_,rt)}evaluate(s){for(let a=0;a<this.args.length;a++){const _=this.args[a].evaluate(s);if(!wt(this.type,_s(_)))return _;if(a===this.args.length-1)throw new fn(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${xa(_s(_))} but was expected to be of type ${xa(this.type)}.`)}return null}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=this.type,a=[s.kind];if(s.kind==="array"){const _=s.itemType;if(_.kind==="string"||_.kind==="number"||_.kind==="boolean"){a.push(_.kind);const j=s.N;(typeof j=="number"||this.args.length>1)&&a.push(j)}}return a.concat(this.args.map(_=>_.serialize()))}}class jo{constructor(s){this.type=yp,this.sections=s}static parse(s,a){if(s.length<2)return a.error("Expected at least one argument.");const _=s[1];if(!Array.isArray(_)&&typeof _=="object")return a.error("First argument must be an image or text section.");const j=[];let tt=!1;for(let rt=1;rt<=s.length-1;++rt){const ot=s[rt];if(tt&&typeof ot=="object"&&!Array.isArray(ot)){tt=!1;let ct=null;if(ot["font-scale"]&&(ct=a.parseObjectValue(ot["font-scale"],rt,"font-scale",qn),!ct))return null;let ht=null;if(ot["text-font"]&&(ht=a.parseObjectValue(ot["text-font"],rt,"text-font",Kl(eo)),!ht))return null;let mt=null;if(ot["text-color"]&&(mt=a.parseObjectValue(ot["text-color"],rt,"text-color",uu),!mt))return null;const gt=j[j.length-1];gt.scale=ct,gt.font=ht,gt.textColor=mt}else{const ct=a.parse(s[rt],rt,Zs);if(!ct)return null;const ht=ct.type.kind;if(ht!=="string"&&ht!=="value"&&ht!=="null"&&ht!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");tt=!0,j.push({content:ct,scale:null,font:null,textColor:null})}}return new jo(j)}evaluate(s){return new Dr(this.sections.map(a=>{const _=a.content.evaluate(s);return cr(_s(_),Mm)?new zr("",_,null,null,null):new zr(gs(_),null,a.scale?a.scale.evaluate(s):null,a.font?a.font.evaluate(s).join(","):null,a.textColor?a.textColor.evaluate(s):null)}))}eachChild(s){for(const a of this.sections)s(a.content),a.scale&&s(a.scale),a.font&&s(a.font),a.textColor&&s(a.textColor)}outputDefined(){return!1}serialize(){const s=["format"];for(const a of this.sections){s.push(a.content.serialize());const _={};a.scale&&(_["font-scale"]=a.scale.serialize()),a.font&&(_["text-font"]=a.font.serialize()),a.textColor&&(_["text-color"]=a.textColor.serialize()),s.push(_)}return s}}class Tl{constructor(s,a,_,j){this._imageWarnHistory={},this.type=Mm,this.namePrimary=s,this.nameSecondary=a,_&&(this.paramsPrimary=_.params,this.iconsetIdPrimary=_.iconset?_.iconset.id:void 0),j&&(this.paramsSecondary=j.params,this.iconsetIdSecondary=j.iconset?j.iconset.id:void 0)}static parse(s,a){if(s.length<2)return a.error("Expected two or more arguments.");let _=1;const j=[];function tt(){if(_<s.length){const ot=a.parse(s[_],_++,eo);return ot?(j.push({image:ot,options:{}}),!0):(a.error(j.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function rt(){if(_<s.length){const ct=s[_];if((ot=ct)===null||typeof ot!="object"||Array.isArray(ot))return!0;const ht=ct.params,mt=ct.iconset,gt=a.concat(_);if(!ht&&!mt)return _++,!0;if(ht){if(typeof ht!="object"||ht.constructor!==Object)return gt.error('Image options "params" should be an object'),!1;const _t={},Rt=gt.concat(void 0,"params");for(const Pt in ht){if(!Pt)return Rt.error("Image parameter name should be non-empty"),!1;const zt=Rt.concat(void 0,Pt).parse(ht[Pt],void 0,uu,void 0,{typeAnnotation:"coerce"});if(!zt)return!1;_t[Pt]=zt}j[j.length-1].options.params=_t}if(mt){if(typeof mt!="object"||mt.constructor!==Object)return gt.error('Image options "iconset" should be an object'),!1;if(!mt.id)return gt.error('Image options "iconset" should have an "id" property'),!1;j[j.length-1].options.iconset=mt}return _++,!0}var ot;return!0}for(let ot=0;ot<2;ot++)if(!tt()||!rt())return;return new Tl(j[0].image,j[1]?j[1].image:void 0,j[0].options,j[1]?j[1].options:void 0)}evaluateParams(s,a){const _={};if(a){for(const j in a)if(a[j])try{_[j]=a[j].evaluate(s)}catch{continue}if(Object.keys(_).length!==0)return{params:_}}}evaluate(s){const a={name:this.namePrimary.evaluate(s),iconsetId:this.iconsetIdPrimary},_=this.nameSecondary?{name:this.nameSecondary.evaluate(s),iconsetId:this.iconsetIdSecondary}:void 0,j=bn.build(a,_,this.paramsPrimary?this.evaluateParams(s,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(s,this.paramsSecondary):void 0);if(j&&s.availableImages){const tt=j.getPrimary().id;if(j.available=s.availableImages.some(rt=>Jl.isEqual(rt,tt)),j.available){const rt=j.getSecondary()?j.getSecondary().id:null;rt&&(j.available=s.availableImages.some(ot=>Jl.isEqual(ot,rt)))}}return j}eachChild(s){if(s(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&s(this.paramsPrimary[a]);if(this.nameSecondary&&(s(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&s(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(s,a){const _={};if(a&&(_.iconset={id:a}),s){_.params={};for(const j in s)s[j]&&(_.params[j]=s[j].serialize())}return Object.keys(_).length>0?_:void 0}serialize(){const s=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&s.push(a)}if(this.nameSecondary&&(s.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&s.push(a)}return s}}function ts(d){return go(d)?"string":Ml(d)?"number":Ku(d)?"boolean":Array.isArray(d)?"array":d===null?"null":_c(d)?"object":typeof d}function _c(d){return d!=null&&!Array.isArray(d)&&typeof d!="function"&&!(d instanceof String||d instanceof Number||d instanceof Boolean)&&typeof d=="object"}function go(d){return typeof d=="string"||d instanceof String}function Ml(d){return typeof d=="number"||d instanceof Number}function Ku(d){return typeof d=="boolean"||d instanceof Boolean}const py={"to-boolean":Ys,"to-color":uu,"to-number":qn,"to-string":eo};class ga{constructor(s,a){this.type=s,this.args=a}static parse(s,a){if(s.length<2)return a.error("Expected at least one argument.");const _=s[0],j=[];let tt=ju;if(_==="to-array"){if(!Array.isArray(s[1]))return null;const rt=s[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);tt=Kl(a.expectedType.itemType,rt)}else{if(!(rt>0&&as(s[1][0])))return null;tt=Kl(_s(s[1][0]),rt)}for(let ot=0;ot<rt;ot++){const ct=s[1][ot];let ht;if(Array.isArray(ct))ht=a.parse(ct,void 0,tt.itemType);else{const mt=ts(ct);if(mt!==tt.itemType.kind)return a.error(`Expected ${tt.itemType.kind} but found ${mt}.`);ht=a.registry.literal.parse(["literal",ct===void 0?null:ct],a)}if(!ht)return null;j.push(ht)}}else{if((_==="to-boolean"||_==="to-string")&&s.length!==2)return a.error("Expected one argument.");tt=py[_];for(let rt=1;rt<s.length;rt++){const ot=a.parse(s[rt],rt,Zs);if(!ot)return null;j.push(ot)}}return new ga(tt,j)}evaluate(s){if(this.type.kind==="boolean")return!!this.args[0].evaluate(s);if(this.type.kind==="color"){let a,_;for(const j of this.args){if(a=j.evaluate(s),_=null,a instanceof Js)return a;if(typeof a=="string"){const tt=s.parseColor(a);if(tt)return tt}else if(Array.isArray(a)&&(_=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Qn(a[0],a[1],a[2],a[3]),!_))return new Js(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new fn(_||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const _ of this.args){if(a=_.evaluate(s),a===null)return 0;const j=Number(a);if(!isNaN(j))return j}throw new fn(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?Dr.fromString(gs(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?bn.build(gs(this.args[0].evaluate(s))):this.type.kind==="array"?this.args.map(a=>a.evaluate(s)):gs(this.args[0].evaluate(s))}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){if(this.type.kind==="formatted")return new jo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Tl(this.args[0]).serialize();const s=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{s.push(a.serialize())}),s}}const Qy=["Unknown","Point","LineString","Polygon"];class np{constructor(s,a,_){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=s,this.options=a,this.iconImageUseTheme=_}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qy[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(s){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:_,y:j}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(_*a-s[0])+this.featureDistanceData.bearing[1]*(j*a-s[1])}return 0}parseColor(s){let a=this._parseColorCache[s];return a||(a=this._parseColorCache[s]=Js.parse(s)),a}getConfig(s){return this.options?this.options.get(s):null}}class eu{constructor(s,a,_,j,tt){this.name=s,this.type=a,this._evaluate=_,this.args=j,this._overloadIndex=tt}evaluate(s){if(!this._evaluate){const a=eu.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(s=>s.serialize()))}static parse(s,a){const _=s[0],j=eu.definitions[_];if(!j)return a.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0);const tt=Array.isArray(j)?j[0]:j.type,rt=Array.isArray(j)?[[j[1],j[2]]]:j.overloads,ot=[];let ct=null,ht=-1;for(const[mt,gt]of rt){if(Array.isArray(mt)&&mt.length!==s.length-1)continue;ot.push(mt),ht++,ct=new H_(a.registry,a.path,null,a.scope,void 0,a._scope,a.options,a.iconImageUseTheme);const _t=[];let Rt=!1;for(let Pt=1;Pt<s.length;Pt++){const zt=s[Pt],Vt=Array.isArray(mt)?mt[Pt-1]:mt.type,Gt=ct.parse(zt,1+_t.length,Vt);if(!Gt){Rt=!0;break}_t.push(Gt)}if(!Rt)if(Array.isArray(mt)&&mt.length!==_t.length)ct.error(`Expected ${mt.length} arguments, but found ${_t.length} instead.`);else{for(let Pt=0;Pt<_t.length;Pt++){const zt=Array.isArray(mt)?mt[Pt]:mt.type,Vt=_t[Pt];ct.concat(Pt+1).checkSubtype(zt,Vt.type)}if(ct.errors.length===0)return new eu(_,tt,gt,_t,ht)}}if(ot.length===1)a.errors.push(...ct.errors);else{const mt=(ot.length?ot:rt.map(([_t])=>_t)).map(Fu).join(" | "),gt=[];for(let _t=1;_t<s.length;_t++){const Rt=a.parse(s[_t],1+gt.length);if(!Rt)return null;gt.push(xa(Rt.type))}a.error(`Expected arguments of type ${mt}, but found (${gt.join(", ")}) instead.`)}return null}static register(s,a){eu.definitions=a;for(const _ in a)s[_]=eu}}function Fu(d){return Array.isArray(d)?`(${d.map(xa).join(", ")})`:`(${xa(d.type)}...)`}class Yl{constructor(s,a,_){this.type=Lp,this.locale=_,this.caseSensitive=s,this.diacriticSensitive=a}static parse(s,a){if(s.length!==2)return a.error("Expected one argument.");const _=s[1];if(typeof _!="object"||Array.isArray(_))return a.error("Collator options argument must be an object.");const j=_["case-sensitive"]===void 0?a.parse(!1,1,Ys):a.parseObjectValue(_["case-sensitive"],1,"case-sensitive",Ys);if(!j)return null;const tt=_["diacritic-sensitive"]===void 0?a.parse(!1,1,Ys):a.parseObjectValue(_["diacritic-sensitive"],1,"diacritic-sensitive",Ys);if(!tt)return null;let rt=null;return _.locale&&(rt=a.parseObjectValue(_.locale,1,"locale",eo),!rt)?null:new Yl(j,tt,rt)}evaluate(s){return new Mr(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}serialize(){const s={};return s["case-sensitive"]=this.caseSensitive.serialize(),s["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(s.locale=this.locale.serialize()),["collator",s]}}function R0(d,s,a=0,_=d.length-1,j=pw){for(;_>a;){if(_-a>600){const ct=_-a+1,ht=s-a+1,mt=Math.log(ct),gt=.5*Math.exp(2*mt/3),_t=.5*Math.sqrt(mt*gt*(ct-gt)/ct)*(ht-ct/2<0?-1:1);R0(d,s,Math.max(a,Math.floor(s-ht*gt/ct+_t)),Math.min(_,Math.floor(s+(ct-ht)*gt/ct+_t)),j)}const tt=d[s];let rt=a,ot=_;for(Jy(d,a,s),j(d[_],tt)>0&&Jy(d,a,_);rt<ot;){for(Jy(d,rt,ot),rt++,ot--;j(d[rt],tt)<0;)rt++;for(;j(d[ot],tt)>0;)ot--}j(d[a],tt)===0?Jy(d,a,ot):(ot++,Jy(d,ot,_)),ot<=s&&(a=ot+1),s<=ot&&(_=ot-1)}}function Jy(d,s,a){const _=d[s];d[s]=d[a],d[a]=_}function pw(d,s){return d<s?-1:d>s?1:0}function M_(d){let s=0;for(let a,_,j=0,tt=d.length,rt=tt-1;j<tt;rt=j++)a=d[j],_=d[rt],s+=(_.x-a.x)*(a.y+_.y);return s}function fy(d,s){d[0]=Math.min(d[0],s[0]),d[1]=Math.min(d[1],s[1]),d[2]=Math.max(d[2],s[0]),d[3]=Math.max(d[3],s[1])}function sp(d,s){return!(d[0]<=s[0]||d[2]>=s[2]||d[1]<=s[1]||d[3]>=s[3])}function fw(d,s,a){const _=d[0]-s[0],j=d[1]-s[1],tt=d[0]-a[0],rt=d[1]-a[1];return _*rt-tt*j==0&&_*tt<=0&&j*rt<=0}function my(d,s,a=!1){let _=!1;for(let ot=0,ct=s.length;ot<ct;ot++){const ht=s[ot];for(let mt=0,gt=ht.length,_t=gt-1;mt<gt;_t=mt++){const Rt=ht[_t],Pt=ht[mt];if(fw(d,Rt,Pt))return a;(tt=Rt)[1]>(j=d)[1]!=(rt=Pt)[1]>j[1]&&j[0]<(rt[0]-tt[0])*(j[1]-tt[1])/(rt[1]-tt[1])+tt[0]&&(_=!_)}}var j,tt,rt;return _}function P0(d,s,a,_){const j=_[0]-a[0],tt=_[1]-a[1],rt=(d[0]-a[0])*tt-j*(d[1]-a[1]),ot=(s[0]-a[0])*tt-j*(s[1]-a[1]);return rt>0&&ot<0||rt<0&&ot>0}function k_(d,s,a,_){return(j=[_[0]-a[0],_[1]-a[1]])[0]*(tt=[s[0]-d[0],s[1]-d[1]])[1]-j[1]*tt[0]!=0&&!(!P0(d,s,a,_)||!P0(a,_,d,s));var j,tt}function D_(d){const s=new yn(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new yn(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const _ of d[0])s.x>_.x&&(s.x=_.x),s.y>_.y&&(s.y=_.y),a.x<_.x&&(a.x=_.x),a.y<_.y&&(a.y=_.y);return{min:s,max:a}}const om=8192;function km(d,s){const a=(180+d[0])/360,_=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d[1]*Math.PI/360)))/360,j=Math.pow(2,s.z);return[Math.round(a*j*om),Math.round(_*j*om)]}function mw(d,s){for(let a=0;a<s.length;a++)if(my(d,s[a]))return!0;return!1}function gw(d,s,a){for(const _ of a)for(let j=0,tt=_.length,rt=tt-1;j<tt;rt=j++)if(k_(d,s,_[rt],_[j]))return!0;return!1}function L_(d,s){for(let a=0;a<d.length;++a)if(!my(d[a],s))return!1;for(let a=0;a<d.length-1;++a)if(gw(d[a],d[a+1],s))return!1;return!0}function I0(d,s){for(let a=0;a<s.length;a++)if(L_(d,s[a]))return!0;return!1}function j_(d,s,a){const _=[];for(let j=0;j<d.length;j++){const tt=[];for(let rt=0;rt<d[j].length;rt++){const ot=km(d[j][rt],a);fy(s,ot),tt.push(ot)}_.push(tt)}return _}function Yu(d,s,a){const _=[];for(let j=0;j<d.length;j++){const tt=j_(d[j],s,a);_.push(tt)}return _}function M0(d,s,a,_){if(d[0]<a[0]||d[0]>a[2]){const j=.5*_;let tt=d[0]-a[0]>j?-_:a[0]-d[0]>j?_:0;tt===0&&(tt=d[0]-a[2]>j?-_:a[2]-d[0]>j?_:0),d[0]+=tt}fy(s,d)}function k0(d,s,a,_){const j=Math.pow(2,_.z)*om,tt=[_.x*om,_.y*om],rt=[];if(!d)return rt;for(const ot of d)for(const ct of ot){const ht=[ct.x+tt[0],ct.y+tt[1]];M0(ht,s,a,j),rt.push(ht)}return rt}function D0(d,s,a,_){const j=Math.pow(2,_.z)*om,tt=[_.x*om,_.y*om],rt=[];if(!d)return rt;for(const ct of d){const ht=[];for(const mt of ct){const gt=[mt.x+tt[0],mt.y+tt[1]];fy(s,gt),ht.push(gt)}rt.push(ht)}if(s[2]-s[0]<=j/2){(ot=s)[0]=ot[1]=1/0,ot[2]=ot[3]=-1/0;for(const ct of rt)for(const ht of ct)M0(ht,s,a,j)}var ot;return rt}class Dm{constructor(s,a){this.type=Ys,this.geojson=s,this.geometries=a}static parse(s,a){if(s.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(as(s[1])){const _=s[1];if(_.type==="FeatureCollection")for(let j=0;j<_.features.length;++j){const tt=_.features[j].geometry.type;if(tt==="Polygon"||tt==="MultiPolygon")return new Dm(_,_.features[j].geometry)}else if(_.type==="Feature"){const j=_.geometry.type;if(j==="Polygon"||j==="MultiPolygon")return new Dm(_,_.geometry)}else if(_.type==="Polygon"||_.type==="MultiPolygon")return new Dm(_,_)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(a,_){const j=[1/0,1/0,-1/0,-1/0],tt=[1/0,1/0,-1/0,-1/0],rt=a.canonicalID();if(!rt)return!1;if(_.type==="Polygon"){const ot=j_(_.coordinates,tt,rt),ct=k0(a.geometry(),j,tt,rt);if(!sp(j,tt))return!1;for(const ht of ct)if(!my(ht,ot))return!1}if(_.type==="MultiPolygon"){const ot=Yu(_.coordinates,tt,rt),ct=k0(a.geometry(),j,tt,rt);if(!sp(j,tt))return!1;for(const ht of ct)if(!mw(ht,ot))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(a,_){const j=[1/0,1/0,-1/0,-1/0],tt=[1/0,1/0,-1/0,-1/0],rt=a.canonicalID();if(!rt)return!1;if(_.type==="Polygon"){const ot=j_(_.coordinates,tt,rt),ct=D0(a.geometry(),j,tt,rt);if(!sp(j,tt))return!1;for(const ht of ct)if(!L_(ht,ot))return!1}if(_.type==="MultiPolygon"){const ot=Yu(_.coordinates,tt,rt),ct=D0(a.geometry(),j,tt,rt);if(!sp(j,tt))return!1;for(const ht of ct)if(!I0(ht,ot))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const e_={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Zx=1/298.257223563,Xx=Zx*(2-Zx),gy=Math.PI/180;class yy{static fromTile(s,a,_){const j=Math.PI*(1-2*(s+.5)/Math.pow(2,a)),tt=Math.atan(.5*(Math.exp(j)-Math.exp(-j)))/gy;return new yy(tt,_)}static get units(){return e_}constructor(s,a){if(s===void 0)throw new Error("No latitude given.");if(a&&!e_[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(e_).join(", ")}`);const _=6378.137*gy*(a?e_[a]:1),j=Math.cos(s*gy),tt=1/(1-Xx*(1-j*j)),rt=Math.sqrt(tt);this.kx=_*rt*j,this.ky=_*rt*tt*(1-Xx)}distance(s,a){const _=Ou(s[0]-a[0])*this.kx,j=(s[1]-a[1])*this.ky;return Math.sqrt(_*_+j*j)}bearing(s,a){const _=Ou(a[0]-s[0])*this.kx;return Math.atan2(_,(a[1]-s[1])*this.ky)/gy}destination(s,a,_){const j=_*gy;return this.offset(s,Math.sin(j)*a,Math.cos(j)*a)}offset(s,a,_){return[s[0]+a/this.kx,s[1]+_/this.ky]}lineDistance(s){let a=0;for(let _=0;_<s.length-1;_++)a+=this.distance(s[_],s[_+1]);return a}area(s){let a=0;for(let _=0;_<s.length;_++){const j=s[_];for(let tt=0,rt=j.length,ot=rt-1;tt<rt;ot=tt++)a+=Ou(j[tt][0]-j[ot][0])*(j[tt][1]+j[ot][1])*(_?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(s,a){let _=0;if(a<=0)return s[0];for(let j=0;j<s.length-1;j++){const tt=s[j],rt=s[j+1],ot=this.distance(tt,rt);if(_+=ot,_>a)return F_(tt,rt,(a-(_-ot))/ot)}return s[s.length-1]}pointToSegmentDistance(s,a,_){let[j,tt]=a,rt=Ou(_[0]-j)*this.kx,ot=(_[1]-tt)*this.ky;if(rt!==0||ot!==0){const ct=(Ou(s[0]-j)*this.kx*rt+(s[1]-tt)*this.ky*ot)/(rt*rt+ot*ot);ct>1?(j=_[0],tt=_[1]):ct>0&&(j+=rt/this.kx*ct,tt+=ot/this.ky*ct)}return rt=Ou(s[0]-j)*this.kx,ot=(s[1]-tt)*this.ky,Math.sqrt(rt*rt+ot*ot)}pointOnLine(s,a){let _=1/0,j=s[0][0],tt=s[0][1],rt=0,ot=0;for(let ct=0;ct<s.length-1;ct++){let ht=s[ct][0],mt=s[ct][1],gt=Ou(s[ct+1][0]-ht)*this.kx,_t=(s[ct+1][1]-mt)*this.ky,Rt=0;gt===0&&_t===0||(Rt=(Ou(a[0]-ht)*this.kx*gt+(a[1]-mt)*this.ky*_t)/(gt*gt+_t*_t),Rt>1?(ht=s[ct+1][0],mt=s[ct+1][1]):Rt>0&&(ht+=gt/this.kx*Rt,mt+=_t/this.ky*Rt)),gt=Ou(a[0]-ht)*this.kx,_t=(a[1]-mt)*this.ky;const Pt=gt*gt+_t*_t;Pt<_&&(_=Pt,j=ht,tt=mt,rt=ct,ot=Rt)}return{point:[j,tt],index:rt,t:Math.max(0,Math.min(1,ot))}}lineSlice(s,a,_){let j=this.pointOnLine(_,s),tt=this.pointOnLine(_,a);if(j.index>tt.index||j.index===tt.index&&j.t>tt.t){const ht=j;j=tt,tt=ht}const rt=[j.point],ot=j.index+1,ct=tt.index;!Kx(_[ot],rt[0])&&ot<=ct&&rt.push(_[ot]);for(let ht=ot+1;ht<=ct;ht++)rt.push(_[ht]);return Kx(_[ct],tt.point)||rt.push(tt.point),rt}lineSliceAlong(s,a,_){let j=0;const tt=[];for(let rt=0;rt<_.length-1;rt++){const ot=_[rt],ct=_[rt+1],ht=this.distance(ot,ct);if(j+=ht,j>s&&tt.length===0&&tt.push(F_(ot,ct,(s-(j-ht))/ht)),j>=a)return tt.push(F_(ot,ct,(a-(j-ht))/ht)),tt;j>s&&tt.push(ct)}return tt}bufferPoint(s,a){const _=a/this.ky,j=a/this.kx;return[s[0]-j,s[1]-_,s[0]+j,s[1]+_]}bufferBBox(s,a){const _=a/this.ky,j=a/this.kx;return[s[0]-j,s[1]-_,s[2]+j,s[3]+_]}insideBBox(s,a){return Ou(s[0]-a[0])>=0&&Ou(s[0]-a[2])<=0&&s[1]>=a[1]&&s[1]<=a[3]}}function Kx(d,s){return d[0]===s[0]&&d[1]===s[1]}function F_(d,s,a){const _=Ou(s[0]-d[0]);return[d[0]+_*a,d[1]+(s[1]-d[1])*a]}function Ou(d){for(;d<-180;)d+=360;for(;d>180;)d-=360;return d}class O_{constructor(s=[],a=(_,j)=>_<j?-1:_>j?1:0){if(this.data=s,this.length=this.data.length,this.compare=a,this.length>0)for(let _=(this.length>>1)-1;_>=0;_--)this._down(_)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:a,compare:_}=this,j=a[s];for(;s>0;){const tt=s-1>>1,rt=a[tt];if(_(j,rt)>=0)break;a[s]=rt,s=tt}a[s]=j}_down(s){const{data:a,compare:_}=this,j=this.length>>1,tt=a[s];for(;s<j;){let rt=1+(s<<1);const ot=rt+1;if(ot<this.length&&_(a[ot],a[rt])<0&&(rt=ot),_(a[rt],tt)>=0)break;a[s]=a[rt],s=rt}a[s]=tt}}var Rn=8192;function Yx(d,s){return s.dist-d.dist}const _y=100,xy=50;function t_(d){const s=[1/0,1/0,-1/0,-1/0];if(s.length!==d.length)return!1;for(let a=0;a<s.length;a++)if(s[a]!==d[a])return!1;return!0}function i_(d){return d[1]-d[0]+1}function _p(d,s){const a=d[1]>=d[0]&&d[1]<s;return a||console.warn("Distance Expression: Index is out of range"),a}function z_(d,s){if(d[0]>d[1])return[null,null];const a=i_(d);if(s){if(a===2)return[d,null];const _=Math.floor(a/2);return[[d[0],d[0]+_],[d[0]+_,d[1]]]}{if(a===1)return[d,null];const _=Math.floor(a/2)-1;return[[d[0],d[0]+_],[d[0]+_+1,d[1]]]}}function Qu(d,s){const a=[1/0,1/0,-1/0,-1/0];if(!_p(s,d.length))return a;for(let _=s[0];_<=s[1];++_)fy(a,d[_]);return a}function Os(d){const s=[1/0,1/0,-1/0,-1/0];for(let a=0;a<d.length;++a)for(let _=0;_<d[a].length;++_)fy(s,d[a][_]);return s}function vy(d,s,a){if(t_(d)||t_(s))return NaN;let _=0,j=0;return d[2]<s[0]&&(_=s[0]-d[2]),d[0]>s[2]&&(_=d[0]-s[2]),d[1]>s[3]&&(j=d[1]-s[3]),d[3]<s[1]&&(j=s[1]-d[3]),a.distance([0,0],[_,j])}function yw(d){return 360*d-180}function _w(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function N_(d,s){const a=Math.pow(2,s.z),_=(d.y/Rn+s.y)/a;return[yw((d.x/Rn+s.x)/a),_w(_)]}function xw(d,s){const a=[];for(let _=0;_<d.length;++_)a.push(N_(d[_],s));return a}function No(d,s,a){const _=a.pointOnLine(s,d).point;return a.distance(d,_)}function L0(d,s,a,_,j){const tt=a.slice(_[0],_[1]+1);let rt=1/0;for(let ot=s[0];ot<=s[1];++ot)if((rt=Math.min(rt,No(d[ot],tt,j)))===0)return 0;return rt}function Qx(d,s,a,_,j){const tt=Math.min(j.pointToSegmentDistance(d,a,_),j.pointToSegmentDistance(s,a,_)),rt=Math.min(j.pointToSegmentDistance(a,d,s),j.pointToSegmentDistance(_,d,s));return Math.min(tt,rt)}function bw(d,s,a,_,j){if(!_p(s,d.length)||!_p(_,a.length))return NaN;let tt=1/0;for(let rt=s[0];rt<s[1];++rt)for(let ot=_[0];ot<_[1];++ot){if(k_(d[rt],d[rt+1],a[ot],a[ot+1]))return 0;tt=Math.min(tt,Qx(d[rt],d[rt+1],a[ot],a[ot+1],j))}return tt}function ww(d,s,a,_,j){if(!_p(s,d.length)||!_p(_,a.length))return NaN;let tt=1/0;for(let rt=s[0];rt<=s[1];++rt)for(let ot=_[0];ot<=_[1];++ot)if((tt=Math.min(tt,j.distance(d[rt],a[ot])))===0)return tt;return tt}function Ew(d,s,a){if(my(d,s,!0))return 0;let _=1/0;for(const j of s){const tt=j.length;if(tt<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(j[0]!==j[tt-1]&&(_=Math.min(_,a.pointToSegmentDistance(d,j[tt-1],j[0])))===0||(_=Math.min(_,No(d,j,a)))===0)return _}return _}function Tw(d,s,a,_){if(!_p(s,d.length))return NaN;for(let tt=s[0];tt<=s[1];++tt)if(my(d[tt],a,!0))return 0;let j=1/0;for(let tt=s[0];tt<s[1];++tt)for(const rt of a)for(let ot=0,ct=rt.length,ht=ct-1;ot<ct;ht=ot++){if(k_(d[tt],d[tt+1],rt[ht],rt[ot]))return 0;j=Math.min(j,Qx(d[tt],d[tt+1],rt[ht],rt[ot],_))}return j}function j0(d,s){for(const a of d)for(let _=0;_<=a.length-1;++_)if(my(a[_],s,!0))return!0;return!1}function Sw(d,s,a,_=1/0){const j=Os(d),tt=Os(s);if(_!==1/0&&vy(j,tt,a)>=_)return _;if(sp(j,tt)){if(j0(d,s))return 0}else if(j0(s,d))return 0;let rt=_;for(const ot of d)for(let ct=0,ht=ot.length,mt=ht-1;ct<ht;mt=ct++)for(const gt of s)for(let _t=0,Rt=gt.length,Pt=Rt-1;_t<Rt;Pt=_t++){if(k_(ot[mt],ot[ct],gt[Pt],gt[_t]))return 0;rt=Math.min(rt,Qx(ot[mt],ot[ct],gt[Pt],gt[_t],a))}return rt}function B_(d,s,a,_,j,tt,rt){if(tt===null||rt===null)return;const ot=vy(Qu(_,tt),Qu(j,rt),a);ot<s&&d.push({dist:ot,range1:tt,range2:rt})}function Cw(d,s,a,_,j=1/0){let tt=Math.min(_.distance(d[0],a[0][0]),j);if(tt===0)return tt;const rt=new O_([{dist:0,range1:[0,d.length-1],range2:[0,0]}],Yx),ot=s?xy:_y,ct=Os(a);for(;rt.length;){const ht=rt.pop();if(ht.dist>=tt)continue;const mt=ht.range1;if(i_(mt)<=ot){if(!_p(mt,d.length))return NaN;if(s){const gt=Tw(d,mt,a,_);if((tt=Math.min(tt,gt))===0)return tt}else for(let gt=mt[0];gt<=mt[1];++gt){const _t=Ew(d[gt],a,_);if((tt=Math.min(tt,_t))===0)return tt}}else{const gt=z_(mt,s);if(gt[0]!==null){const _t=vy(Qu(d,gt[0]),ct,_);_t<tt&&rt.push({dist:_t,range1:gt[0],range2:[0,0]})}if(gt[1]!==null){const _t=vy(Qu(d,gt[1]),ct,_);_t<tt&&rt.push({dist:_t,range1:gt[1],range2:[0,0]})}}}return tt}function F0(d,s,a,_,j,tt=1/0){let rt=Math.min(tt,j.distance(d[0],a[0]));if(rt===0)return rt;const ot=new O_([{dist:0,range1:[0,d.length-1],range2:[0,a.length-1]}],Yx),ct=s?xy:_y,ht=_?xy:_y;for(;ot.length;){const mt=ot.pop();if(mt.dist>=rt)continue;const gt=mt.range1,_t=mt.range2;if(i_(gt)<=ct&&i_(_t)<=ht){if(!_p(gt,d.length)||!_p(_t,a.length))return NaN;if(s&&_?rt=Math.min(rt,bw(d,gt,a,_t,j)):s||_?s&&!_?rt=Math.min(rt,L0(a,_t,d,gt,j)):!s&&_&&(rt=Math.min(rt,L0(d,gt,a,_t,j))):rt=Math.min(rt,ww(d,gt,a,_t,j)),rt===0)return rt}else{const Rt=z_(gt,s),Pt=z_(_t,_);B_(ot,rt,j,d,a,Rt[0],Pt[0]),B_(ot,rt,j,d,a,Rt[0],Pt[1]),B_(ot,rt,j,d,a,Rt[1],Pt[0]),B_(ot,rt,j,d,a,Rt[1],Pt[1])}}return rt}function Jx(d,s,a,_,j=1/0){let tt=j;const rt=Qu(d,[0,d.length-1]);for(const ot of a)if(!(tt!==1/0&&vy(rt,Qu(ot,[0,ot.length-1]),_)>=tt)&&(tt=Math.min(tt,F0(d,s,ot,!0,_,tt)),tt===0))return tt;return tt}function V_(d,s,a,_,j=1/0){let tt=j;const rt=Qu(d,[0,d.length-1]);for(const ot of a){if(tt!==1/0&&vy(rt,Os(ot),_)>=tt)continue;const ct=Cw(d,s,ot,_,tt);if(isNaN(ct))return ct;if((tt=Math.min(tt,ct))===0)return tt}return tt}function ev(d){return d==="Point"||d==="MultiPoint"||d==="LineString"||d==="MultiLineString"||d==="Polygon"||d==="MultiPolygon"}class Lm{constructor(s,a){this.type=qn,this.geojson=s,this.geometries=a}static parse(s,a){if(s.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${s.length-1} instead.`);if(as(s[1])){const _=s[1];if(_.type==="FeatureCollection"){for(let j=0;j<_.features.length;++j)if(ev(_.features[j].geometry.type))return new Lm(_,_.features[j].geometry)}else if(_.type==="Feature"){if(ev(_.geometry.type))return new Lm(_,_.geometry)}else if(ev(_.type))return new Lm(_,_)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(s){const a=s.geometry(),_=s.canonicalID();if(a!=null&&_!=null){if(s.geometryType()==="Point")return function(j,tt,rt){const ot=[];for(const ht of j)for(const mt of ht)ot.push(N_(mt,tt));const ct=new yy(ot[0][1],"meters");return rt.type==="Point"||rt.type==="MultiPoint"||rt.type==="LineString"?F0(ot,!1,rt.type==="Point"?[rt.coordinates]:rt.coordinates,rt.type==="LineString",ct):rt.type==="MultiLineString"?Jx(ot,!1,rt.coordinates,ct):rt.type==="Polygon"||rt.type==="MultiPolygon"?V_(ot,!1,rt.type==="Polygon"?[rt.coordinates]:rt.coordinates,ct):null}(a,_,this.geometries);if(s.geometryType()==="LineString")return function(j,tt,rt){const ot=[];for(const ht of j){const mt=[];for(const gt of ht)mt.push(N_(gt,tt));ot.push(mt)}const ct=new yy(ot[0][0][1],"meters");if(rt.type==="Point"||rt.type==="MultiPoint"||rt.type==="LineString")return Jx(rt.type==="Point"?[rt.coordinates]:rt.coordinates,rt.type==="LineString",ot,ct);if(rt.type==="MultiLineString"){let ht=1/0;for(let mt=0;mt<rt.coordinates.length;mt++){const gt=Jx(rt.coordinates[mt],!0,ot,ct,ht);if(isNaN(gt))return gt;if((ht=Math.min(ht,gt))===0)return ht}return ht}if(rt.type==="Polygon"||rt.type==="MultiPolygon"){let ht=1/0;for(let mt=0;mt<ot.length;mt++){const gt=V_(ot[mt],!0,rt.type==="Polygon"?[rt.coordinates]:rt.coordinates,ct,ht);if(isNaN(gt))return gt;if((ht=Math.min(ht,gt))===0)return ht}return ht}return null}(a,_,this.geometries);if(s.geometryType()==="Polygon")return function(j,tt,rt){const ot=[];for(const ht of function(mt,gt){const _t=mt.length;if(_t<=1)return[mt];const Rt=[];let Pt,zt;for(let Vt=0;Vt<_t;Vt++){const Gt=M_(mt[Vt]);Gt!==0&&(mt[Vt].area=Math.abs(Gt),zt===void 0&&(zt=Gt<0),zt===Gt<0?(Pt&&Rt.push(Pt),Pt=[mt[Vt]]):Pt.push(mt[Vt]))}return Pt&&Rt.push(Pt),Rt}(j)){const mt=[];for(let gt=0;gt<ht.length;++gt)mt.push(xw(ht[gt],tt));ot.push(mt)}const ct=new yy(ot[0][0][0][1],"meters");if(rt.type==="Point"||rt.type==="MultiPoint"||rt.type==="LineString")return V_(rt.type==="Point"?[rt.coordinates]:rt.coordinates,rt.type==="LineString",ot,ct);if(rt.type==="MultiLineString"){let ht=1/0;for(let mt=0;mt<rt.coordinates.length;mt++){const gt=V_(rt.coordinates[mt],!0,ot,ct,ht);if(isNaN(gt))return gt;if((ht=Math.min(ht,gt))===0)return ht}return ht}return rt.type==="Polygon"||rt.type==="MultiPolygon"?function(ht,mt,gt){let _t=1/0;for(const Rt of ht)for(const Pt of mt){const zt=Sw(Rt,Pt,gt,_t);if(isNaN(zt))return zt;if((_t=Math.min(_t,zt))===0)return _t}return _t}(rt.type==="Polygon"?[rt.coordinates]:rt.coordinates,ot,ct):null}(a,_,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function by(d){if(d instanceof eu&&(d.name==="get"&&d.args.length===1||d.name==="feature-state"||d.name==="has"&&d.args.length===1||d.name==="properties"||d.name==="geometry-type"||d.name==="id"||/^filter-/.test(d.name))||d instanceof Dm||d instanceof Lm)return!1;if(d instanceof Ey)return d.featureConstant;let s=!0;return d.eachChild(a=>{s&&!by(a)&&(s=!1)}),s}function U_(d){if(d instanceof eu&&d.name==="feature-state")return!1;let s=!0;return d.eachChild(a=>{s&&!U_(a)&&(s=!1)}),s}function G_(d){if(d instanceof Ey)return new Set([d.key]);let s=new Set;return d.eachChild(a=>{s=new Set([...s,...G_(a)])}),s}function wy(d,s){if(d instanceof eu&&s.indexOf(d.name)>=0)return!1;let a=!0;return d.eachChild(_=>{a&&!wy(_,s)&&(a=!1)}),a}function O0(d,s,a){return[d,s,a].filter(Boolean).join("")}function tv(d,s){switch(d){case"string":return gs(s);case"number":return+s;case"boolean":return!!s;case"color":return Js.parse(s);case"formatted":return Dr.fromString(gs(s));case"resolvedImage":return bn.build(gs(s))}return s}function z0(d,s,a,_){return _!==void 0&&(d=_*Math.round(d/_)),s!==void 0&&d<s&&(d=s),a!==void 0&&d>a&&(d=a),d}class Ey{constructor(s,a,_,j=!1){this.type=s,this.key=a,this.scope=_,this.featureConstant=j}static parse(s,a){let _=a.expectedType;if(_==null&&(_=Zs),s.length<2||s.length>3)return a.error("Invalid number of arguments for 'config' expression.");const j=a.parse(s[1],1);if(!(j instanceof Pn))return a.error("Key name of 'config' expression must be a string literal.");let tt,rt=!0;const ot=gs(j.value);if(s.length>=3){const ct=a.parse(s[2],2);if(!(ct instanceof Pn))return a.error("Scope of 'config' expression must be a string literal.");tt=gs(ct.value)}if(a.options){const ct=O0(ot,tt,a._scope),ht=a.options.get(ct);ht&&(rt=by(ht.value||ht.default))}return new Ey(_,ot,tt,rt)}evaluate(s){const a=O0(this.key,this.scope,s.scope),_=s.getConfig(a);if(!_)return null;const{type:j,value:tt,values:rt,minValue:ot,maxValue:ct,stepValue:ht}=_,mt=_.default.evaluate(s);let gt=mt;if(tt){const _t=s.scope;s.scope=(_t||"").split("").slice(1).join(""),gt=tt.evaluate(s),s.scope=_t}return j&&(gt=tv(j,gt)),gt===void 0||ot===void 0&&ct===void 0&&ht===void 0||(typeof gt=="number"?gt=z0(gt,ot,ct,ht):Array.isArray(gt)&&(gt=gt.map(_t=>typeof _t=="number"?z0(_t,ot,ct,ht):_t))),tt!==void 0&&gt!==void 0&&rt&&!rt.includes(gt)&&(gt=mt,j&&(gt=tv(j,gt))),(j&&j!==this.type||gt!==void 0&&!cr(_s(gt),this.type))&&(gt=tv(this.type.kind,gt)),gt}eachChild(){}outputDefined(){return!1}serialize(){const s=["config",this.key];return this.scope&&s.concat(this.scope),s}}class $_{constructor(s,a){this.type=a.type,this.name=s,this.boundExpression=a}static parse(s,a){if(s.length!==2||typeof s[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const _=s[1];return a.scope.has(_)?new $_(_,a.scope.get(_)):a.error(`Unknown variable "${_}". Make sure "${_}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class H_{constructor(s,a=[],_,j=new dy,tt=[],rt,ot,ct){this.registry=s,this.path=a,this.key=a.map(ht=>typeof ht=="string"?`['${ht}']`:`[${ht}]`).join(""),this.scope=j,this.errors=tt,this.expectedType=_,this._scope=rt,this.options=ot,this.iconImageUseTheme=ct}parse(s,a,_,j,tt={}){return a||_?this.concat(a,null,_,j)._parse(s,tt):this._parse(s,tt)}parseObjectValue(s,a,_,j,tt,rt={}){return this.concat(a,_,j,tt)._parse(s,rt)}_parse(s,a){function _(j,tt,rt){return rt==="assert"?new Vn(tt,[j]):rt==="coerce"?new ga(tt,[j]):j}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const j=typeof s[0]=="string"?this.registry[s[0]]:void 0;if(j){let tt=j.parse(s,this);if(!tt)return null;if(this.expectedType){const rt=this.expectedType,ot=tt.type;if(rt.kind!=="string"&&rt.kind!=="number"&&rt.kind!=="boolean"&&rt.kind!=="object"&&rt.kind!=="array"||ot.kind!=="value")if(rt.kind!=="color"&&rt.kind!=="formatted"&&rt.kind!=="resolvedImage"||ot.kind!=="value"&&ot.kind!=="string"){if(this.checkSubtype(rt,ot))return null}else tt=_(tt,rt,a.typeAnnotation||"coerce");else tt=_(tt,rt,a.typeAnnotation||"assert")}if(!(tt instanceof Pn)&&tt.type.kind!=="resolvedImage"&&iv(tt)){const rt=new np(this._scope,this.options,this.iconImageUseTheme);try{tt=new Pn(tt.type,tt.evaluate(rt))}catch(ot){return this.error(ot.message),null}}return tt}return ga.parse(["to-array",s],this)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,a,_,j){let tt=typeof s=="number"?this.path.concat(s):this.path;tt=typeof a=="string"?tt.concat(a):tt;const rt=j?this.scope.concat(j):this.scope;return new H_(this.registry,tt,_||null,rt,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(s,...a){const _=`${this.key}${a.map(j=>`[${j}]`).join("")}`;this.errors.push(new Lu(_,s))}checkSubtype(s,a){const _=wt(s,a);return _&&this.error(_),_}}function iv(d){if(d instanceof $_)return iv(d.boundExpression);if(d instanceof eu&&d.name==="error"||d instanceof Yl||d instanceof Dm||d instanceof Lm||d instanceof Ey)return!1;const s=d instanceof ga||d instanceof Vn;let a=!0;return d.eachChild(_=>{a=s?a&&iv(_):a&&_ instanceof Pn}),!!a&&by(d)&&wy(d,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function W_(d,s){const a=d.length-1;let _,j,tt=0,rt=a,ot=0;for(;tt<=rt;)if(ot=Math.floor((tt+rt)/2),_=d[ot],j=d[ot+1],_<=s){if(ot===a||s<j)return ot;tt=ot+1}else{if(!(_>s))throw new fn("Input is not a number.");rt=ot-1}return 0}class r_{constructor(s,a,_){this.type=s,this.input=a,this.labels=[],this.outputs=[];for(const[j,tt]of _)this.labels.push(j),this.outputs.push(tt)}static parse(s,a){if(s.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return a.error("Expected an even number of arguments.");const _=a.parse(s[1],1,qn);if(!_)return null;const j=[];let tt=null;a.expectedType&&a.expectedType.kind!=="value"&&(tt=a.expectedType);for(let rt=1;rt<s.length;rt+=2){const ot=rt===1?-1/0:s[rt],ct=s[rt+1],ht=rt,mt=rt+1;if(typeof ot!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ht);if(j.length&&j[j.length-1][0]>=ot)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ht);const gt=a.parse(ct,mt,tt);if(!gt)return null;tt=tt||gt.type,j.push([ot,gt])}return new r_(tt,_,j)}evaluate(s){const a=this.labels,_=this.outputs;if(a.length===1)return _[0].evaluate(s);const j=this.input.evaluate(s);if(j<=a[0])return _[0].evaluate(s);const tt=a.length;return j>=a[tt-1]?_[tt-1].evaluate(s):_[W_(a,j)].evaluate(s)}eachChild(s){s(this.input);for(const a of this.outputs)s(a)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){const s=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&s.push(this.labels[a]),s.push(this.outputs[a].serialize());return s}}const N0=.95047,B0=1.08883,V0=4/29,am=6/29,U0=3*am*am,G0=am*am*am,Aw=Math.PI/180,Rw=180/Math.PI;function rv(d){return d>G0?Math.pow(d,1/3):d/U0+V0}function q_(d){return d>am?d*d*d:U0*(d-V0)}function Z_(d){return 255*(d<=.0031308?12.92*d:1.055*Math.pow(d,1/2.4)-.055)}function lm(d){return(d/=255)<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4)}function nv(d){const s=lm(d.r),a=lm(d.g),_=lm(d.b),j=rv((.4124564*s+.3575761*a+.1804375*_)/N0),tt=rv((.2126729*s+.7151522*a+.072175*_)/1);return{l:116*tt-16,a:500*(j-tt),b:200*(tt-rv((.0193339*s+.119192*a+.9503041*_)/B0)),alpha:d.a}}function sv(d){let s=(d.l+16)/116,a=isNaN(d.a)?s:s+d.a/500,_=isNaN(d.b)?s:s-d.b/200;return s=1*q_(s),a=N0*q_(a),_=B0*q_(_),new Js(Z_(3.2404542*a-1.5371385*s-.4985314*_),Z_(-.969266*a+1.8760108*s+.041556*_),Z_(.0556434*a-.2040259*s+1.0572252*_),d.alpha)}function Pw(d,s,a){const _=s-d;return d+a*(_>180||_<-180?_-360*Math.round(_/360):_)}const jm={forward:nv,reverse:sv,interpolate:function(d,s,a){return{l:ns(d.l,s.l,a),a:ns(d.a,s.a,a),b:ns(d.b,s.b,a),alpha:ns(d.alpha,s.alpha,a)}}},Fm={forward:function(d){const{l:s,a,b:_}=nv(d),j=Math.atan2(_,a)*Rw;return{h:j<0?j+360:j,c:Math.sqrt(a*a+_*_),l:s,alpha:d.a}},reverse:function(d){const s=d.h*Aw,a=d.c;return sv({l:d.l,a:Math.cos(s)*a,b:Math.sin(s)*a,alpha:d.alpha})},interpolate:function(d,s,a){return{h:Pw(d.h,s.h,a),c:ns(d.c,s.c,a),l:ns(d.l,s.l,a),alpha:ns(d.alpha,s.alpha,a)}}};var $0=Object.freeze({__proto__:null,hcl:Fm,lab:jm});class zu{constructor(s,a,_,j,tt){this.type=s,this.operator=a,this.interpolation=_,this.input=j,this.labels=[],this.outputs=[];for(const[rt,ot]of tt)this.labels.push(rt),this.outputs.push(ot)}static interpolationFactor(s,a,_,j){let tt=0;if(s.name==="exponential")tt=X_(a,s.base,_,j);else if(s.name==="linear")tt=X_(a,1,_,j);else if(s.name==="cubic-bezier"){const rt=s.controlPoints;tt=new Wu(rt[0],rt[1],rt[2],rt[3]).solve(X_(a,1,_,j))}return tt}static parse(s,a){let[_,j,tt,...rt]=s;if(!Array.isArray(j)||j.length===0)return a.error("Expected an interpolation type expression.",1);if(j[0]==="linear")j={name:"linear"};else if(j[0]==="exponential"){const ht=j[1];if(typeof ht!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);j={name:"exponential",base:ht}}else{if(j[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(j[0])}`,1,0);{const ht=j.slice(1);if(ht.length!==4||ht.some(mt=>typeof mt!="number"||mt<0||mt>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);j={name:"cubic-bezier",controlPoints:ht}}}if(s.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length-1>3&&(s.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(tt=a.parse(tt,2,qn),!tt)return null;const ot=[];let ct=null;_==="interpolate-hcl"||_==="interpolate-lab"?ct=uu:a.expectedType&&a.expectedType.kind!=="value"&&(ct=a.expectedType);for(let ht=0;ht<rt.length;ht+=2){const mt=rt[ht],gt=rt[ht+1],_t=ht+3,Rt=ht+4;if(typeof mt!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_t);if(ot.length&&ot[ot.length-1][0]>=mt)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',_t);const Pt=a.parse(gt,Rt,ct);if(!Pt)return null;ct=ct||Pt.type,ot.push([mt,Pt])}return ct.kind==="number"||ct.kind==="color"||ct.kind==="array"&&ct.itemType.kind==="number"&&typeof ct.N=="number"?new zu(ct,_,j,tt,ot):a.error(`Type ${xa(ct)} is not interpolatable.`)}evaluate(s){const a=this.labels,_=this.outputs;if(a.length===1)return _[0].evaluate(s);const j=this.input.evaluate(s);if(j<=a[0])return _[0].evaluate(s);const tt=a.length;if(j>=a[tt-1])return _[tt-1].evaluate(s);const rt=W_(a,j),ot=zu.interpolationFactor(this.interpolation,j,a[rt],a[rt+1]),ct=_[rt].evaluate(s),ht=_[rt+1].evaluate(s);return this.operator==="interpolate"?xu[this.type.kind.toLowerCase()](ct,ht,ot):this.operator==="interpolate-hcl"?Fm.reverse(Fm.interpolate(Fm.forward(ct),Fm.forward(ht),ot)):jm.reverse(jm.interpolate(jm.forward(ct),jm.forward(ht),ot))}eachChild(s){s(this.input);for(const a of this.outputs)s(a)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){let s;s=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,s,this.input.serialize()];for(let _=0;_<this.labels.length;_++)a.push(this.labels[_],this.outputs[_].serialize());return a}}function X_(d,s,a,_){const j=_-a,tt=d-a;return j===0?0:s===1?tt/j:(Math.pow(s,tt)-1)/(Math.pow(s,j)-1)}class n_{constructor(s,a){this.type=s,this.args=a}static parse(s,a){if(s.length<2)return a.error("Expectected at least one argument.");let _=null;const j=a.expectedType;j&&j.kind!=="value"&&(_=j);const tt=[];for(const ot of s.slice(1)){const ct=a.parse(ot,1+tt.length,_,void 0,{typeAnnotation:"omit"});if(!ct)return null;_=_||ct.type,tt.push(ct)}const rt=j&&tt.some(ot=>wt(j,ot.type));return new n_(rt?Zs:_,tt)}evaluate(s){let a,_=null,j=0;for(const tt of this.args){if(j++,_=tt.evaluate(s),_&&_ instanceof bn&&!_.available&&(a||(a=_),_=null,j===this.args.length))return a;if(_!==null)break}return _}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=["coalesce"];return this.eachChild(a=>{s.push(a.serialize())}),s}}class K_{constructor(s,a){this.type=a.type,this.bindings=[].concat(s),this.result=a}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const a of this.bindings)s(a[1]);s(this.result)}static parse(s,a){if(s.length<4)return a.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const _=[];for(let tt=1;tt<s.length-1;tt+=2){const rt=s[tt];if(typeof rt!="string")return a.error(`Expected string, but found ${typeof rt} instead.`,tt);if(/[^a-zA-Z0-9_]/.test(rt))return a.error("Variable names must contain only alphanumeric characters or '_'.",tt);const ot=a.parse(s[tt+1],tt+1);if(!ot)return null;_.push([rt,ot])}const j=a.parse(s[s.length-1],s.length-1,a.expectedType,_);return j?new K_(_,j):null}outputDefined(){return this.result.outputDefined()}serialize(){const s=["let"];for(const[a,_]of this.bindings)s.push(a,_.serialize());return s.push(this.result.serialize()),s}}class ov{constructor(s,a,_){this.type=s,this.index=a,this.input=_}static parse(s,a){if(s.length!==3)return a.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const _=a.parse(s[1],1,qn),j=a.parse(s[2],2,Kl(a.expectedType||Zs));return _&&j?new ov(j.type.itemType,_,j):null}evaluate(s){const a=this.index.evaluate(s),_=this.input.evaluate(s);if(a<0)throw new fn("Array index out of bounds: negative index");if(a>=_.length)throw new fn("Array index out of bounds: index exceeds array size");if(a!==Math.floor(a))throw new fn("Array index must be an integer. Use at-interpolated for fractional indices");return _[a]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class av{constructor(s,a,_){this.type=s,this.index=a,this.input=_}static parse(s,a){if(s.length!==3)return a.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const _=a.parse(s[1],1,qn),j=a.parse(s[2],2,Kl(a.expectedType||Zs));return _&&j?new av(j.type.itemType,_,j):null}evaluate(s){const a=this.index.evaluate(s),_=this.input.evaluate(s);if(a<0)throw new fn(`Array index out of bounds: ${a} < 0.`);if(a>_.length-1)throw new fn(`Array index out of bounds: ${a} > ${_.length-1}.`);if(a===Math.floor(a))return _[a];const j=Math.floor(a),tt=Math.ceil(a),rt=_[j],ot=_[tt];if(typeof rt!="number"||typeof ot!="number")throw new fn(`Cannot interpolate between non-number values at index ${a}.`);const ct=a-j;return rt*(1-ct)+ot*ct}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Y_{constructor(s,a){this.type=Ys,this.needle=s,this.haystack=a}static parse(s,a){if(s.length!==3)return a.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const _=a.parse(s[1],1,Zs),j=a.parse(s[2],2,Zs);return _&&j?Nt(_.type,[Ys,eo,qn,ju,Zs])?new Y_(_,j):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${xa(_.type)} instead`):null}evaluate(s){const a=this.needle.evaluate(s),_=this.haystack.evaluate(s);if(_==null)return!1;if(!Zt(a,["boolean","string","number","null"]))throw new fn(`Expected first argument to be of type boolean, string, number or null, but found ${xa(_s(a))} instead.`);if(!Zt(_,["string","array"]))throw new fn(`Expected second argument to be of type array or string, but found ${xa(_s(_))} instead.`);return _.indexOf(a)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class s_{constructor(s,a,_){this.type=qn,this.needle=s,this.haystack=a,this.fromIndex=_}static parse(s,a){if(s.length<=2||s.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const _=a.parse(s[1],1,Zs),j=a.parse(s[2],2,Zs);if(!_||!j)return null;if(!Nt(_.type,[Ys,eo,qn,ju,Zs]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${xa(_.type)} instead`);if(s.length===4){const tt=a.parse(s[3],3,qn);return tt?new s_(_,j,tt):null}return new s_(_,j)}evaluate(s){const a=this.needle.evaluate(s),_=this.haystack.evaluate(s);if(!Zt(a,["boolean","string","number","null"]))throw new fn(`Expected first argument to be of type boolean, string, number or null, but found ${xa(_s(a))} instead.`);if(!Zt(_,["string","array"]))throw new fn(`Expected second argument to be of type array or string, but found ${xa(_s(_))} instead.`);if(this.fromIndex){const j=this.fromIndex.evaluate(s);return _.indexOf(a,j)}return _.indexOf(a)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const s=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),s]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ty{constructor(s,a,_,j,tt,rt){this.inputType=s,this.type=a,this.input=_,this.cases=j,this.outputs=tt,this.otherwise=rt}static parse(s,a){if(s.length<5)return a.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return a.error("Expected an even number of arguments.");let _,j;a.expectedType&&a.expectedType.kind!=="value"&&(j=a.expectedType);const tt={},rt=[];for(let ht=2;ht<s.length-1;ht+=2){let mt=s[ht];const gt=s[ht+1];Array.isArray(mt)||(mt=[mt]);const _t=a.concat(ht);if(mt.length===0)return _t.error("Expected at least one branch label.");for(const Pt of mt){if(typeof Pt!="number"&&typeof Pt!="string")return _t.error("Branch labels must be numbers or strings.");if(typeof Pt=="number"&&Math.abs(Pt)>Number.MAX_SAFE_INTEGER)return _t.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Pt=="number"&&Math.floor(Pt)!==Pt)return _t.error("Numeric branch labels must be integer values.");if(_){if(_t.checkSubtype(_,_s(Pt)))return null}else _=_s(Pt);if(tt[String(Pt)]!==void 0)return _t.error("Branch labels must be unique.");tt[String(Pt)]=rt.length}const Rt=a.parse(gt,ht,j);if(!Rt)return null;j=j||Rt.type,rt.push(Rt)}const ot=a.parse(s[1],1,Zs);if(!ot)return null;const ct=a.parse(s[s.length-1],s.length-1,j);return ct?ot.type.kind!=="value"&&a.concat(1).checkSubtype(_,ot.type)?null:new Ty(_,j,ot,tt,rt,ct):null}evaluate(s){const a=this.input.evaluate(s);return(cr(_s(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),_=[],j={};for(const rt of a){const ot=j[this.cases[rt]];ot===void 0?(j[this.cases[rt]]=_.length,_.push([this.cases[rt],[rt]])):_[ot][1].push(rt)}const tt=rt=>this.inputType.kind==="number"?Number(rt):rt;for(const[rt,ot]of _)s.push(ot.length===1?tt(ot[0]):ot.map(tt)),s.push(this.outputs[rt].serialize());return s.push(this.otherwise.serialize()),s}}class lv{constructor(s,a,_){this.type=s,this.branches=a,this.otherwise=_}static parse(s,a){if(s.length<4)return a.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return a.error("Expected an odd number of arguments.");let _;a.expectedType&&a.expectedType.kind!=="value"&&(_=a.expectedType);const j=[];for(let rt=1;rt<s.length-1;rt+=2){const ot=a.parse(s[rt],rt,Ys);if(!ot)return null;const ct=a.parse(s[rt+1],rt+1,_);if(!ct)return null;j.push([ot,ct]),_=_||ct.type}const tt=a.parse(s[s.length-1],s.length-1,_);return tt?new lv(_,j,tt):null}evaluate(s){for(const[a,_]of this.branches)if(a.evaluate(s))return _.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[a,_]of this.branches)s(a),s(_);s(this.otherwise)}outputDefined(){return this.branches.every(([s,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["case"];return this.eachChild(a=>{s.push(a.serialize())}),s}}class o_{constructor(s,a,_,j){this.type=s,this.input=a,this.beginIndex=_,this.endIndex=j}static parse(s,a){if(s.length<=2||s.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const _=a.parse(s[1],1,Zs),j=a.parse(s[2],2,qn);if(!_||!j)return null;if(!Nt(_.type,[Kl(Zs),eo,Zs]))return a.error(`Expected first argument to be of type array or string, but found ${xa(_.type)} instead`);if(s.length===4){const tt=a.parse(s[3],3,qn);return tt?new o_(_.type,_,j,tt):null}return new o_(_.type,_,j)}evaluate(s){const a=this.input.evaluate(s),_=this.beginIndex.evaluate(s);if(!Zt(a,["string","array"]))throw new fn(`Expected first argument to be of type array or string, but found ${xa(_s(a))} instead.`);if(this.endIndex){const j=this.endIndex.evaluate(s);return a.slice(_,j)}return a.slice(_)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const s=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),s]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class cv{constructor(s,a){this.type=Kl(eo),this.str=s,this.delimiter=a}static parse(s,a){if(s.length!==3)return a.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const _=a.parse(s[1],1,eo),j=a.parse(s[2],2,eo);return _&&j?new cv(_,j):void 0}evaluate(s){const a=this.str.evaluate(s),_=this.delimiter.evaluate(s);return a.split(_)}eachChild(s){s(this.str),s(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function H0(d,s){return d==="=="||d==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function uv(d,s,a,_){return _.compare(s,a)===0}function Om(d,s,a){const _=d!=="=="&&d!=="!=";return class nA{constructor(tt,rt,ot){this.type=Ys,this.lhs=tt,this.rhs=rt,this.collator=ot,this.hasUntypedArgument=tt.type.kind==="value"||rt.type.kind==="value"}static parse(tt,rt){if(tt.length!==3&&tt.length!==4)return rt.error("Expected two or three arguments.");const ot=tt[0];let ct=rt.parse(tt[1],1,Zs);if(!ct)return null;if(!H0(ot,ct.type))return rt.concat(1).error(`"${ot}" comparisons are not supported for type '${xa(ct.type)}'.`);let ht=rt.parse(tt[2],2,Zs);if(!ht)return null;if(!H0(ot,ht.type))return rt.concat(2).error(`"${ot}" comparisons are not supported for type '${xa(ht.type)}'.`);if(ct.type.kind!==ht.type.kind&&ct.type.kind!=="value"&&ht.type.kind!=="value")return rt.error(`Cannot compare types '${xa(ct.type)}' and '${xa(ht.type)}'.`);_&&(ct.type.kind==="value"&&ht.type.kind!=="value"?ct=new Vn(ht.type,[ct]):ct.type.kind!=="value"&&ht.type.kind==="value"&&(ht=new Vn(ct.type,[ht])));let mt=null;if(tt.length===4){if(ct.type.kind!=="string"&&ht.type.kind!=="string"&&ct.type.kind!=="value"&&ht.type.kind!=="value")return rt.error("Cannot use collator to compare non-string types.");if(mt=rt.parse(tt[3],3,Lp),!mt)return null}return new nA(ct,ht,mt)}evaluate(tt){const rt=this.lhs.evaluate(tt),ot=this.rhs.evaluate(tt);if(_&&this.hasUntypedArgument){const ct=_s(rt),ht=_s(ot);if(ct.kind!==ht.kind||ct.kind!=="string"&&ct.kind!=="number")throw new fn(`Expected arguments for "${d}" to be (string, string) or (number, number), but found (${ct.kind}, ${ht.kind}) instead.`)}if(this.collator&&!_&&this.hasUntypedArgument){const ct=_s(rt),ht=_s(ot);if(ct.kind!=="string"||ht.kind!=="string")return s(tt,rt,ot)}return this.collator?a(tt,rt,ot,this.collator.evaluate(tt)):s(tt,rt,ot)}eachChild(tt){tt(this.lhs),tt(this.rhs),this.collator&&tt(this.collator)}outputDefined(){return!0}serialize(){const tt=[d];return this.eachChild(rt=>{tt.push(rt.serialize())}),tt}}}const Iw=Om("==",function(d,s,a){return s===a},uv),Mw=Om("!=",function(d,s,a){return s!==a},function(d,s,a,_){return!uv(0,s,a,_)}),kw=Om("<",function(d,s,a){return s<a},function(d,s,a,_){return _.compare(s,a)<0}),Q_=Om(">",function(d,s,a){return s>a},function(d,s,a,_){return _.compare(s,a)>0}),Dw=Om("<=",function(d,s,a){return s<=a},function(d,s,a,_){return _.compare(s,a)<=0}),Lw=Om(">=",function(d,s,a){return s>=a},function(d,s,a,_){return _.compare(s,a)>=0});class hv{constructor(s,a,_,j,tt,rt){this.type=eo,this.number=s,this.locale=a,this.currency=_,this.unit=j,this.minFractionDigits=tt,this.maxFractionDigits=rt}static parse(s,a){if(s.length!==3)return a.error("Expected two arguments.");const _=a.parse(s[1],1,qn);if(!_)return null;const j=s[2];if(typeof j!="object"||Array.isArray(j))return a.error("NumberFormat options argument must be an object.");let tt=null;if(j.locale&&(tt=a.parseObjectValue(j.locale,2,"locale",eo),!tt))return null;let rt=null;if(j.currency&&(rt=a.parseObjectValue(j.currency,2,"currency",eo),!rt))return null;let ot=null;if(j.unit&&(ot=a.parseObjectValue(j.unit,2,"unit",eo),!ot))return null;let ct=null;if(j["min-fraction-digits"]&&(ct=a.parseObjectValue(j["min-fraction-digits"],2,"min-fraction-digits",qn),!ct))return null;let ht=null;return j["max-fraction-digits"]&&(ht=a.parseObjectValue(j["max-fraction-digits"],2,"max-fraction-digits",qn),!ht)?null:new hv(_,tt,rt,ot,ct,ht)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(s):void 0,unit:this.unit?this.unit.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.unit&&s(this.unit),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const s={};return this.locale&&(s.locale=this.locale.serialize()),this.currency&&(s.currency=this.currency.serialize()),this.unit&&(s.unit=this.unit.serialize()),this.minFractionDigits&&(s["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(s["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),s]}}class dv{constructor(s){this.type=qn,this.input=s}static parse(s,a){if(s.length!==2)return a.error(`Expected 1 argument, but found ${s.length-1} instead.`);const _=a.parse(s[1],1);return _?_.type.kind!=="array"&&_.type.kind!=="string"&&_.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${xa(_.type)} instead.`):new dv(_):null}evaluate(s){const a=this.input.evaluate(s);if(typeof a=="string"||Array.isArray(a))return a.length;throw new fn(`Expected value to be of type string or array, but found ${xa(_s(a))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}serialize(){const s=["length"];return this.eachChild(a=>{s.push(a.serialize())}),s}}function pv(d){return function(){d=1831565813+(d|=0)|0;let s=Math.imul(d^d>>>15,1|d);return s=s+Math.imul(s^s>>>7,61|s)^s,((s^s>>>14)>>>0)/4294967296}}const Sy={"==":Iw,"!=":Mw,">":Q_,"<":kw,">=":Lw,"<=":Dw,array:Vn,at:ov,"at-interpolated":av,boolean:Vn,case:lv,coalesce:n_,collator:Yl,format:jo,image:Tl,in:Y_,"index-of":s_,interpolate:zu,"interpolate-hcl":zu,"interpolate-lab":zu,length:dv,let:K_,literal:Pn,match:Ty,number:Vn,"number-format":hv,object:Vn,slice:o_,step:r_,string:Vn,"to-boolean":ga,"to-color":ga,"to-number":ga,"to-string":ga,var:$_,within:Dm,distance:Lm,config:Ey,split:cv};function W0(d,[s,a,_,j]){s=s.evaluate(d),a=a.evaluate(d),_=_.evaluate(d);const tt=j?j.evaluate(d):1,rt=Qn(s,a,_,tt);if(rt)throw new fn(rt);return new Js(s/255,a/255,_/255,tt)}function fv(d,[s,a,_,j]){s=s.evaluate(d),a=a.evaluate(d),_=_.evaluate(d);const tt=j?j.evaluate(d):1,rt=function(ht,mt,gt,_t){return typeof ht=="number"&&ht>=0&&ht<=360?typeof mt=="number"&&mt>=0&&mt<=100&&typeof gt=="number"&&gt>=0&&gt<=100?_t===void 0||typeof _t=="number"&&_t>=0&&_t<=1?null:`Invalid hsla value [${[ht,mt,gt,_t].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof _t=="number"?[ht,mt,gt,_t]:[ht,mt,gt]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof _t=="number"?[ht,mt,gt,_t]:[ht,mt,gt]).join(", ")}]: 'h' must be between 0 and 360.`}(s,a,_,tt);if(rt)throw new fn(rt);const ot=`hsla(${s}, ${a}%, ${_}%, ${tt})`,ct=Js.parse(ot);if(!ct)throw new fn(`Failed to parse HSLA color: ${ot}`);return ct}function mv(d,s){return d in s}function J_(d,s){const a=s[d];return a===void 0?null:a}function zm(d){return{type:d}}function Nm(d){return{result:"success",value:d}}function cm(d){return{result:"error",value:d}}function gv(d,s){return!!d&&!!d.parameters&&d.parameters.indexOf(s)>-1}function ex(d){return d["property-type"]==="data-driven"}function yv(d){return gv(d.expression,"measure-light")}function _v(d){return gv(d.expression,"zoom")}function tx(d){return!!d.expression&&d.expression.interpolated}function ix(d){return typeof d=="object"&&d!==null&&!Array.isArray(d)}function xv(d){return d}function rx(d,s){const a=s.type==="color",_=d.stops&&typeof d.stops[0][0]=="object",j=_||!(_||d.property!==void 0),tt=d.type||(tx(s)?"exponential":"interval");if(a&&((d=Object.assign({},d)).stops&&(d.stops=d.stops.map(ht=>[ht[0],Js.parse(ht[1])])),d.default=Js.parse(d.default?d.default:s.default)),d.colorSpace&&d.colorSpace!=="rgb"&&!$0[d.colorSpace])throw new Error(`Unknown color space: ${d.colorSpace}`);let rt,ot,ct;if(tt==="exponential")rt=q0;else if(tt==="interval")rt=um;else if(tt==="categorical"){rt=jw,ot=Object.create(null);for(const ht of d.stops)ot[ht[0]]=ht[1];ct=typeof d.stops[0][0]}else{if(tt!=="identity")throw new Error(`Unknown function type "${tt}"`);rt=Fw}if(_){const ht={},mt=[];for(let Rt=0;Rt<d.stops.length;Rt++){const Pt=d.stops[Rt],zt=Pt[0].zoom;ht[zt]===void 0&&(ht[zt]={zoom:zt,type:d.type,property:d.property,default:d.default,stops:[]},mt.push(zt)),ht[zt].stops.push([Pt[0].value,Pt[1]])}const gt=[];for(const Rt of mt)gt.push([ht[Rt].zoom,rx(ht[Rt],s)]);const _t={name:"linear"};return{kind:"composite",interpolationType:_t,interpolationFactor:zu.interpolationFactor.bind(void 0,_t),zoomStops:gt.map(Rt=>Rt[0]),evaluate:({zoom:Rt},Pt)=>q0({stops:gt,base:d.base},s,Rt).evaluate(Rt,Pt)}}if(j){const ht=tt==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:ht,interpolationFactor:zu.interpolationFactor.bind(void 0,ht),zoomStops:d.stops.map(mt=>mt[0]),evaluate:({zoom:mt})=>rt(d,s,mt,ot,ct)}}return{kind:"source",evaluate(ht,mt){const gt=mt&&mt.properties?mt.properties[d.property]:void 0;return gt===void 0?Cy(d.default,s.default):rt(d,s,gt,ot,ct)}}}function Cy(d,s,a){return d!==void 0?d:s!==void 0?s:a!==void 0?a:void 0}function jw(d,s,a,_,j){return Cy(typeof a===j?_[a]:void 0,d.default,s.default)}function um(d,s,a){if(!Ml(a))return Cy(d.default,s.default);const _=d.stops.length;if(_===1||a<=d.stops[0][0])return d.stops[0][1];if(a>=d.stops[_-1][0])return d.stops[_-1][1];const j=W_(d.stops.map(tt=>tt[0]),a);return d.stops[j][1]}function q0(d,s,a){const _=d.base!==void 0?d.base:1;if(!Ml(a))return Cy(d.default,s.default);const j=d.stops.length;if(j===1||a<=d.stops[0][0])return d.stops[0][1];if(a>=d.stops[j-1][0])return d.stops[j-1][1];const tt=W_(d.stops.map(mt=>mt[0]),a),rt=function(mt,gt,_t,Rt){const Pt=Rt-_t,zt=mt-_t;return Pt===0?0:gt===1?zt/Pt:(Math.pow(gt,zt)-1)/(Math.pow(gt,Pt)-1)}(a,_,d.stops[tt][0],d.stops[tt+1][0]),ot=d.stops[tt][1],ct=d.stops[tt+1][1];let ht=xu[s.type]||xv;if(d.colorSpace&&d.colorSpace!=="rgb"){const mt=$0[d.colorSpace];ht=(gt,_t)=>mt.reverse(mt.interpolate(mt.forward(gt),mt.forward(_t),rt))}return typeof ot.evaluate=="function"?{evaluate(...mt){const gt=ot.evaluate.apply(void 0,mt),_t=ct.evaluate.apply(void 0,mt);if(gt!==void 0&&_t!==void 0)return ht(gt,_t,rt)}}:ht(ot,ct,rt)}function Fw(d,s,a){return s.type==="color"?a=Js.parse(a):s.type==="formatted"?a=Dr.fromString(a.toString()):s.type==="resolvedImage"?a=bn.build(a.toString()):ts(a)===s.type||s.type==="enum"&&s.values[a]||(a=void 0),Cy(a,d.default,s.default)}eu.register(Sy,{error:[{kind:"error"},[eo],(d,[s])=>{throw new fn(s.evaluate(d))}],typeof:[eo,[Zs],(d,[s])=>xa(_s(s.evaluate(d)))],"to-rgba":[Kl(qn,4),[uu],(d,[s])=>s.evaluate(d).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Kl(qn,4),[uu],(d,[s])=>s.evaluate(d).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[uu,[qn,qn,qn],W0],rgba:[uu,[qn,qn,qn,qn],W0],hsl:[uu,[qn,qn,qn],fv],hsla:[uu,[qn,qn,qn,qn],fv],has:{type:Ys,overloads:[[[eo],(d,[s])=>mv(s.evaluate(d),d.properties())],[[eo,Dp],(d,[s,a])=>mv(s.evaluate(d),a.evaluate(d))]]},get:{type:Zs,overloads:[[[eo],(d,[s])=>J_(s.evaluate(d),d.properties())],[[eo,Dp],(d,[s,a])=>J_(s.evaluate(d),a.evaluate(d))]]},"feature-state":[Zs,[eo],(d,[s])=>J_(s.evaluate(d),d.featureState||{})],properties:[Dp,[],d=>d.properties()],"geometry-type":[eo,[],d=>d.geometryType()],worldview:[eo,[],d=>d.globals.worldview||""],id:[Zs,[],d=>d.id()],zoom:[qn,[],d=>d.globals.zoom],pitch:[qn,[],d=>d.globals.pitch||0],"distance-from-center":[qn,[],d=>d.distanceFromCenter()],"measure-light":[qn,[eo],(d,[s])=>d.measureLight(s.evaluate(d))],"heatmap-density":[qn,[],d=>d.globals.heatmapDensity||0],"line-progress":[qn,[],d=>d.globals.lineProgress||0],"raster-value":[qn,[],d=>d.globals.rasterValue||0],"raster-particle-speed":[qn,[],d=>d.globals.rasterParticleSpeed||0],"sky-radial-progress":[qn,[],d=>d.globals.skyRadialProgress||0],accumulated:[Zs,[],d=>d.globals.accumulated===void 0?null:d.globals.accumulated],"+":[qn,zm(qn),(d,s)=>{let a=0;for(const _ of s)a+=_.evaluate(d);return a}],"*":[qn,zm(qn),(d,s)=>{let a=1;for(const _ of s)a*=_.evaluate(d);return a}],"-":{type:qn,overloads:[[[qn,qn],(d,[s,a])=>s.evaluate(d)-a.evaluate(d)],[[qn],(d,[s])=>-s.evaluate(d)]]},"/":[qn,[qn,qn],(d,[s,a])=>s.evaluate(d)/a.evaluate(d)],"%":[qn,[qn,qn],(d,[s,a])=>s.evaluate(d)%a.evaluate(d)],ln2:[qn,[],()=>Math.LN2],pi:[qn,[],()=>Math.PI],e:[qn,[],()=>Math.E],"^":[qn,[qn,qn],(d,[s,a])=>Math.pow(s.evaluate(d),a.evaluate(d))],sqrt:[qn,[qn],(d,[s])=>Math.sqrt(s.evaluate(d))],log10:[qn,[qn],(d,[s])=>Math.log(s.evaluate(d))/Math.LN10],ln:[qn,[qn],(d,[s])=>Math.log(s.evaluate(d))],log2:[qn,[qn],(d,[s])=>Math.log2(s.evaluate(d))],sin:[qn,[qn],(d,[s])=>Math.sin(s.evaluate(d))],cos:[qn,[qn],(d,[s])=>Math.cos(s.evaluate(d))],tan:[qn,[qn],(d,[s])=>Math.tan(s.evaluate(d))],asin:[qn,[qn],(d,[s])=>Math.asin(s.evaluate(d))],acos:[qn,[qn],(d,[s])=>Math.acos(s.evaluate(d))],atan:[qn,[qn],(d,[s])=>Math.atan(s.evaluate(d))],min:[qn,zm(qn),(d,s)=>Math.min(...s.map(a=>a.evaluate(d)))],max:[qn,zm(qn),(d,s)=>Math.max(...s.map(a=>a.evaluate(d)))],abs:[qn,[qn],(d,[s])=>Math.abs(s.evaluate(d))],round:[qn,[qn],(d,[s])=>{const a=s.evaluate(d);return a<0?-Math.round(-a):Math.round(a)}],floor:[qn,[qn],(d,[s])=>Math.floor(s.evaluate(d))],ceil:[qn,[qn],(d,[s])=>Math.ceil(s.evaluate(d))],"filter-==":[Ys,[eo,Zs],(d,[s,a])=>d.properties()[s.value]===a.value],"filter-id-==":[Ys,[Zs],(d,[s])=>d.id()===s.value],"filter-type-==":[Ys,[eo],(d,[s])=>d.geometryType()===s.value],"filter-<":[Ys,[eo,Zs],(d,[s,a])=>{const _=d.properties()[s.value],j=a.value;return typeof _==typeof j&&_<j}],"filter-id-<":[Ys,[Zs],(d,[s])=>{const a=d.id(),_=s.value;return typeof a==typeof _&&a<_}],"filter->":[Ys,[eo,Zs],(d,[s,a])=>{const _=d.properties()[s.value],j=a.value;return typeof _==typeof j&&_>j}],"filter-id->":[Ys,[Zs],(d,[s])=>{const a=d.id(),_=s.value;return typeof a==typeof _&&a>_}],"filter-<=":[Ys,[eo,Zs],(d,[s,a])=>{const _=d.properties()[s.value],j=a.value;return typeof _==typeof j&&_<=j}],"filter-id-<=":[Ys,[Zs],(d,[s])=>{const a=d.id(),_=s.value;return typeof a==typeof _&&a<=_}],"filter->=":[Ys,[eo,Zs],(d,[s,a])=>{const _=d.properties()[s.value],j=a.value;return typeof _==typeof j&&_>=j}],"filter-id->=":[Ys,[Zs],(d,[s])=>{const a=d.id(),_=s.value;return typeof a==typeof _&&a>=_}],"filter-has":[Ys,[Zs],(d,[s])=>s.value in d.properties()],"filter-has-id":[Ys,[],d=>d.id()!==null&&d.id()!==void 0],"filter-type-in":[Ys,[Kl(eo)],(d,[s])=>s.value.indexOf(d.geometryType())>=0],"filter-id-in":[Ys,[Kl(Zs)],(d,[s])=>s.value.indexOf(d.id())>=0],"filter-in-small":[Ys,[eo,Kl(Zs)],(d,[s,a])=>a.value.indexOf(d.properties()[s.value])>=0],"filter-in-large":[Ys,[eo,Kl(Zs)],(d,[s,a])=>function(_,j,tt,rt){for(;tt<=rt;){const ot=tt+rt>>1;if(j[ot]===_)return!0;j[ot]>_?rt=ot-1:tt=ot+1}return!1}(d.properties()[s.value],a.value,0,a.value.length-1)],all:{type:Ys,overloads:[[[Ys,Ys],(d,[s,a])=>s.evaluate(d)&&a.evaluate(d)],[zm(Ys),(d,s)=>{for(const a of s)if(!a.evaluate(d))return!1;return!0}]]},any:{type:Ys,overloads:[[[Ys,Ys],(d,[s,a])=>s.evaluate(d)||a.evaluate(d)],[zm(Ys),(d,s)=>{for(const a of s)if(a.evaluate(d))return!0;return!1}]]},"!":[Ys,[Ys],(d,[s])=>!s.evaluate(d)],"is-supported-script":[Ys,[eo],(d,[s])=>{const a=d.globals&&d.globals.isSupportedScript;return!a||a(s.evaluate(d))}],upcase:[eo,[eo],(d,[s])=>s.evaluate(d).toUpperCase()],downcase:[eo,[eo],(d,[s])=>s.evaluate(d).toLowerCase()],concat:[eo,zm(Zs),(d,s)=>s.map(a=>gs(a.evaluate(d))).join("")],"resolved-locale":[eo,[Lp],(d,[s])=>s.evaluate(d).resolvedLocale()],random:[qn,[qn,qn,Zs],(d,s)=>{const[a,_,j]=s.map(rt=>rt.evaluate(d));if(a>_||a===_)return a;let tt;if(typeof j=="string")tt=function(rt){let ot=0;if(rt.length===0)return ot;for(let ct=0;ct<rt.length;ct++)ot=(ot<<5)-ot+rt.charCodeAt(ct),ot|=0;return ot}(j);else{if(typeof j!="number")throw new fn(`Invalid seed input: ${j}`);tt=j}return a+pv(tt)()*(_-a)}]});class nx{constructor(s,a,_,j,tt){this.expression=s,this._warningHistory={},this._evaluator=new np(_,j,tt),this._defaultValue=a?function(rt){return rt.type==="color"&&(ix(rt.default)||Array.isArray(rt.default))?new Js(0,0,0,0):rt.type==="color"?Js.parse(rt.default)||null:rt.default===void 0?null:rt.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=G_(s)}evaluateWithoutErrorHandling(s,a,_,j,tt,rt,ot,ct){return this._evaluator.globals=s,this._evaluator.feature=a,this._evaluator.featureState=_,this._evaluator.canonical=j||null,this._evaluator.availableImages=tt||null,this._evaluator.formattedSection=rt,this._evaluator.featureTileCoord=ot||null,this._evaluator.featureDistanceData=ct||null,this.expression.evaluate(this._evaluator)}evaluate(s,a,_,j,tt,rt,ot,ct,ht){this._evaluator.globals=s,this._evaluator.feature=a||null,this._evaluator.featureState=_||null,this._evaluator.canonical=j||null,this._evaluator.availableImages=tt||null,this._evaluator.formattedSection=rt||null,this._evaluator.featureTileCoord=ot||null,this._evaluator.featureDistanceData=ct||null,this._evaluator.iconImageUseTheme=ht||null;try{const mt=this.expression.evaluate(this._evaluator);if(mt==null||typeof mt=="number"&&mt!=mt)return this._defaultValue;if(this._enumValues&&!(mt in this._enumValues))throw new fn(`Expected value to be one of ${Object.keys(this._enumValues).map(gt=>JSON.stringify(gt)).join(", ")}, but found ${JSON.stringify(mt)} instead.`);return mt}catch(mt){return this._warningHistory[mt.message]||(this._warningHistory[mt.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${mt.message}`)),this._defaultValue}}}function vv(d){return Array.isArray(d)&&d.length>0&&typeof d[0]=="string"&&d[0]in Sy}function xp(d,s,a,_,j){const tt=new H_(Sy,[],s?function(ot){const ct={color:uu,string:eo,number:qn,enum:eo,boolean:Ys,formatted:yp,resolvedImage:Mm};return ot.type==="array"?Kl(ct[ot.value]||Zs,ot.length):ct[ot.type]}(s):void 0,void 0,void 0,a,_,j),rt=tt.parse(d,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return rt?Nm(new nx(rt,s,a,_,j)):cm(tt.errors)}class a_{constructor(s,a,_,j){this.kind=s,this._styleExpression=a,this.isLightConstant=_,this.isLineProgressConstant=j,this.isStateDependent=s!=="constant"&&!U_(a.expression),this.configDependencies=G_(a.expression)}evaluateWithoutErrorHandling(s,a,_,j,tt,rt){return this._styleExpression.evaluateWithoutErrorHandling(s,a,_,j,tt,rt)}evaluate(s,a,_,j,tt,rt,ot){return this._styleExpression.evaluate(s,a,_,j,tt,rt,void 0,void 0,ot)}}class hm{constructor(s,a,_,j,tt,rt){this.kind=s,this.zoomStops=_,this._styleExpression=a,this.isStateDependent=s!=="camera"&&!U_(a.expression),this.isLightConstant=tt,this.isLineProgressConstant=rt,this.configDependencies=G_(a.expression),this.interpolationType=j}evaluateWithoutErrorHandling(s,a,_,j,tt,rt){return this._styleExpression.evaluateWithoutErrorHandling(s,a,_,j,tt,rt)}evaluate(s,a,_,j,tt,rt){return this._styleExpression.evaluate(s,a,_,j,tt,rt)}interpolationFactor(s,a,_){return this.interpolationType?zu.interpolationFactor(this.interpolationType,s,a,_):0}}function bv(d,s,a,_,j){if((d=xp(d,s,a,_,j)).result==="error")return d;const tt=d.value.expression,rt=by(tt);if(!rt&&!ex(s))return cm([new Lu("","data expressions not supported")]);const ot=wy(tt,["zoom","pitch","distance-from-center"]);if(!ot&&!_v(s))return cm([new Lu("","zoom expressions not supported")]);const ct=wy(tt,["measure-light"]);if(!ct&&!yv(s))return cm([new Lu("","measure-light expression not supported")]);const ht=wy(tt,["line-progress"]);if(!ht&&!function(_t){return gv(_t.expression,"line-progress")}(s))return cm([new Lu("","line-progress expression not supported")]);const mt=s.expression&&s.expression.relaxZoomRestriction,gt=ox(tt);return gt||ot||mt?gt instanceof Lu?cm([gt]):gt instanceof zu&&!tx(s)?cm([new Lu("",'"interpolate" expressions cannot be used with this property')]):Nm(gt?new hm(rt&&ht?"camera":"composite",d.value,gt.labels,gt instanceof zu?gt.interpolation:void 0,ct,ht):new a_(rt&&ht?"constant":"source",d.value,ct,ht)):cm([new Lu("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class sx{constructor(s,a){this._parameters=s,this._specification=a,Object.assign(this,rx(this._parameters,this._specification))}static deserialize(s){return new sx(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function ox(d){let s=null;if(d instanceof K_)s=ox(d.result);else if(d instanceof n_){for(const a of d.args)if(s=ox(a),s)break}else(d instanceof r_||d instanceof zu)&&d.input instanceof eu&&d.input.name==="zoom"&&(s=d);return s instanceof Lu||d.eachChild(a=>{const _=ox(a);_ instanceof Lu?s=_:s&&_&&s!==_&&(s=new Lu("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}var l_,ax,Z0=function(){if(ax)return l_;ax=1,l_=s;var d=3;function s(a,_,j){var tt=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var rt=new Int32Array(this.arrayBuffer);a=rt[0],this.d=(_=rt[1])+2*(j=rt[2]);for(var ot=0;ot<this.d*this.d;ot++){var ct=rt[d+ot],ht=rt[d+ot+1];tt.push(ct===ht?null:rt.subarray(ct,ht))}var mt=rt[d+tt.length+1];this.keys=rt.subarray(rt[d+tt.length],mt),this.bboxes=rt.subarray(mt),this.insert=this._insertReadonly}else{this.d=_+2*j;for(var gt=0;gt<this.d*this.d;gt++)tt.push([]);this.keys=[],this.bboxes=[]}this.n=_,this.extent=a,this.padding=j,this.scale=_/a,this.uid=0;var _t=j/_*a;this.min=-_t,this.max=a+_t}return s.prototype.insert=function(a,_,j,tt,rt){this._forEachCell(_,j,tt,rt,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(_),this.bboxes.push(j),this.bboxes.push(tt),this.bboxes.push(rt)},s.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},s.prototype._insertCell=function(a,_,j,tt,rt,ot){this.cells[rt].push(ot)},s.prototype.query=function(a,_,j,tt,rt){var ot=this.min,ct=this.max;if(a<=ot&&_<=ot&&ct<=j&&ct<=tt&&!rt)return Array.prototype.slice.call(this.keys);var ht=[];return this._forEachCell(a,_,j,tt,this._queryCell,ht,{},rt),ht},s.prototype._queryCell=function(a,_,j,tt,rt,ot,ct,ht){var mt=this.cells[rt];if(mt!==null)for(var gt=this.keys,_t=this.bboxes,Rt=0;Rt<mt.length;Rt++){var Pt=mt[Rt];if(ct[Pt]===void 0){var zt=4*Pt;(ht?ht(_t[zt+0],_t[zt+1],_t[zt+2],_t[zt+3]):a<=_t[zt+2]&&_<=_t[zt+3]&&j>=_t[zt+0]&&tt>=_t[zt+1])?(ct[Pt]=!0,ot.push(gt[Pt])):ct[Pt]=!1}}},s.prototype._forEachCell=function(a,_,j,tt,rt,ot,ct,ht){for(var mt=this._convertToCellCoord(a),gt=this._convertToCellCoord(_),_t=this._convertToCellCoord(j),Rt=this._convertToCellCoord(tt),Pt=mt;Pt<=_t;Pt++)for(var zt=gt;zt<=Rt;zt++){var Vt=this.d*zt+Pt;if((!ht||ht(this._convertFromCellCoord(Pt),this._convertFromCellCoord(zt),this._convertFromCellCoord(Pt+1),this._convertFromCellCoord(zt+1)))&&rt.call(this,a,_,j,tt,Vt,ot,ct,ht))return}},s.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},s.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},s.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,_=d+this.cells.length+1+1,j=0,tt=0;tt<this.cells.length;tt++)j+=this.cells[tt].length;var rt=new Int32Array(_+j+this.keys.length+this.bboxes.length);rt[0]=this.extent,rt[1]=this.n,rt[2]=this.padding;for(var ot=_,ct=0;ct<a.length;ct++){var ht=a[ct];rt[d+ct]=ot,rt.set(ht,ot),ot+=ht.length}return rt[d+a.length]=ot,rt.set(this.keys,ot),rt[d+a.length+1]=ot+=this.keys.length,rt.set(this.bboxes,ot),ot+=this.bboxes.length,rt.buffer},l_}(),Bm=Ap(Z0);const Ay={};function Fn(d,s,a={}){Object.defineProperty(d,"_classRegistryKey",{value:s,writable:!1}),Ay[s]={klass:d,omit:a.omit||[]}}Fn(Object,"Object"),Bm.serialize=function(d,s){const a=d.toArrayBuffer();return s&&s.add(a),{buffer:a}},Bm.deserialize=function(d){return new Bm(d.buffer)},Object.defineProperty(Bm,"name",{value:"Grid"}),Fn(Bm,"Grid"),delete yn.prototype.constructor,typeof DOMMatrix<"u"&&Fn(DOMMatrix,"DOMMatrix"),Fn(Js,"Color"),Fn(Error,"Error"),Fn(Dr,"Formatted"),Fn(zr,"FormattedSection"),Fn(Zy,"AJAXError"),Fn(bn,"ResolvedImage"),Fn(sx,"StylePropertyFunction"),Fn(nx,"StyleExpression",{omit:["_evaluator"]}),Fn(Jl,"ImageId"),Fn(Jr,"ImageVariant"),Fn(hm,"ZoomDependentExpression"),Fn(a_,"ZoomConstantExpression"),Fn(eu,"CompoundExpression",{omit:["_evaluate"]});for(const d in Sy)Ay[Sy[d]._classRegistryKey]||Fn(Sy[d],`Expression${d}`);function wv(d){return d&&typeof ArrayBuffer<"u"&&(d instanceof ArrayBuffer||d.constructor&&d.constructor.name==="ArrayBuffer")}function jp(d){return self.ImageBitmap&&d instanceof ImageBitmap}function dm(d,s){if(d==null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp)return d;if(wv(d)||jp(d))return s&&s.add(d),d;if(ArrayBuffer.isView(d))return s&&s.add(d.buffer),d;if(d instanceof ImageData)return s&&s.add(d.data.buffer),d;if(Array.isArray(d)){const a=[];for(const _ of d)a.push(dm(_,s));return a}if(d instanceof Map){const a={$name:"Map",entries:[]};for(const[_,j]of d.entries())a.entries.push(dm(_),dm(j,s));return a}if(d instanceof Set){const a={$name:"Set"};let _=0;for(const j of d.values())a[++_]=dm(j);return a}if(d instanceof DOMMatrix){const a={$name:"DOMMatrix"},_=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const j of _)a[j]=d[j];return a}if(typeof d=="bigint")return{$name:"BigInt",value:d.toString()};if(typeof d=="object"){const a=d.constructor,_=a._classRegistryKey;if(!_)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const j=a.serialize?a.serialize(d,s):{};if(!a.serialize){for(const tt in d)d.hasOwnProperty(tt)&&(Ay[_].omit.indexOf(tt)>=0||(j[tt]=dm(d[tt],s)));d instanceof Error&&(j.message=d.message)}if(j.$name)throw new Error("$name property is reserved for worker serialization logic.");return _!=="Object"&&(j.$name=_),j}throw new Error("can't serialize object of type "+typeof d)}function pm(d){if(d==null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp||wv(d)||jp(d)||ArrayBuffer.isView(d)||d instanceof ImageData)return d;if(Array.isArray(d))return d.map(pm);if(typeof d=="object"){const s=d.$name||"Object";if(s==="Map"){const j=d.entries||[],tt=new Map;for(let rt=0;rt<j.length;rt+=2)tt.set(pm(j[rt]),pm(j[rt+1]));return tt}if(s==="Set"){const j=new Set;for(const tt of Object.keys(d))tt!=="$name"&&j.add(pm(d[tt]));return j}if(s==="DOMMatrix"){let j;return j=d.is2D?[d.a,d.b,d.c,d.d,d.e,d.f]:[d.m11,d.m12,d.m13,d.m14,d.m21,d.m22,d.m23,d.m24,d.m31,d.m32,d.m33,d.m34,d.m41,d.m42,d.m43,d.m44],new DOMMatrix(j)}if(s==="BigInt")return BigInt(d.value);const{klass:a}=Ay[s];if(!a)throw new Error(`Can't deserialize unregistered class "${s}".`);if(a.deserialize)return a.deserialize(d);const _=Object.create(a.prototype);for(const j of Object.keys(d))j!=="$name"&&(_[j]=pm(d[j]));return _}throw new Error("can't deserialize object of type "+typeof d)}const os={"Latin-1 Supplement":d=>d>=128&&d<=255,Arabic:d=>d>=1536&&d<=1791,"Arabic Supplement":d=>d>=1872&&d<=1919,"Arabic Extended-A":d=>d>=2208&&d<=2303,"Hangul Jamo":d=>d>=4352&&d<=4607,"Unified Canadian Aboriginal Syllabics":d=>d>=5120&&d<=5759,Khmer:d=>d>=6016&&d<=6143,"Unified Canadian Aboriginal Syllabics Extended":d=>d>=6320&&d<=6399,"General Punctuation":d=>d>=8192&&d<=8303,"Letterlike Symbols":d=>d>=8448&&d<=8527,"Number Forms":d=>d>=8528&&d<=8591,"Miscellaneous Technical":d=>d>=8960&&d<=9215,"Control Pictures":d=>d>=9216&&d<=9279,"Optical Character Recognition":d=>d>=9280&&d<=9311,"Enclosed Alphanumerics":d=>d>=9312&&d<=9471,"Geometric Shapes":d=>d>=9632&&d<=9727,"Miscellaneous Symbols":d=>d>=9728&&d<=9983,"Miscellaneous Symbols and Arrows":d=>d>=11008&&d<=11263,"CJK Radicals Supplement":d=>d>=11904&&d<=12031,"Kangxi Radicals":d=>d>=12032&&d<=12255,"Ideographic Description Characters":d=>d>=12272&&d<=12287,"CJK Symbols and Punctuation":d=>d>=12288&&d<=12351,Hiragana:d=>d>=12352&&d<=12447,Katakana:d=>d>=12448&&d<=12543,Bopomofo:d=>d>=12544&&d<=12591,"Hangul Compatibility Jamo":d=>d>=12592&&d<=12687,Kanbun:d=>d>=12688&&d<=12703,"Bopomofo Extended":d=>d>=12704&&d<=12735,"CJK Strokes":d=>d>=12736&&d<=12783,"Katakana Phonetic Extensions":d=>d>=12784&&d<=12799,"Enclosed CJK Letters and Months":d=>d>=12800&&d<=13055,"CJK Compatibility":d=>d>=13056&&d<=13311,"CJK Unified Ideographs Extension A":d=>d>=13312&&d<=19903,"Yijing Hexagram Symbols":d=>d>=19904&&d<=19967,"CJK Unified Ideographs":d=>d>=19968&&d<=40959,"Yi Syllables":d=>d>=40960&&d<=42127,"Yi Radicals":d=>d>=42128&&d<=42191,"Hangul Jamo Extended-A":d=>d>=43360&&d<=43391,"Hangul Syllables":d=>d>=44032&&d<=55215,"Hangul Jamo Extended-B":d=>d>=55216&&d<=55295,"Private Use Area":d=>d>=57344&&d<=63743,"CJK Compatibility Ideographs":d=>d>=63744&&d<=64255,"Arabic Presentation Forms-A":d=>d>=64336&&d<=65023,"Vertical Forms":d=>d>=65040&&d<=65055,"CJK Compatibility Forms":d=>d>=65072&&d<=65103,"Small Form Variants":d=>d>=65104&&d<=65135,"Arabic Presentation Forms-B":d=>d>=65136&&d<=65279,"Halfwidth and Fullwidth Forms":d=>d>=65280&&d<=65519,Osage:d=>d>=66736&&d<=66815,"CJK Unified Ideographs Extension B":d=>d>=131072&&d<=173791};function Ev(d){for(const s of d)if(ux(s.charCodeAt(0)))return!0;return!1}function X0(d){for(const s of d)if(!lx(s.charCodeAt(0)))return!1;return!0}function lx(d){return!(os.Arabic(d)||os["Arabic Supplement"](d)||os["Arabic Extended-A"](d)||os["Arabic Presentation Forms-A"](d)||os["Arabic Presentation Forms-B"](d))}function ux(d){return!(d!==746&&d!==747&&(d<4352||!(os["Bopomofo Extended"](d)||os.Bopomofo(d)||os["CJK Compatibility Forms"](d)&&!(d>=65097&&d<=65103)||os["CJK Compatibility Ideographs"](d)||os["CJK Compatibility"](d)||os["CJK Radicals Supplement"](d)||os["CJK Strokes"](d)||!(!os["CJK Symbols and Punctuation"](d)||d>=12296&&d<=12305||d>=12308&&d<=12319||d===12336)||os["CJK Unified Ideographs Extension A"](d)||os["CJK Unified Ideographs"](d)||os["Enclosed CJK Letters and Months"](d)||os["Hangul Compatibility Jamo"](d)||os["Hangul Jamo Extended-A"](d)||os["Hangul Jamo Extended-B"](d)||os["Hangul Jamo"](d)||os["Hangul Syllables"](d)||os.Hiragana(d)||os["Ideographic Description Characters"](d)||os.Kanbun(d)||os["Kangxi Radicals"](d)||os["Katakana Phonetic Extensions"](d)||os.Katakana(d)&&d!==12540||!(!os["Halfwidth and Fullwidth Forms"](d)||d===65288||d===65289||d===65293||d>=65306&&d<=65310||d===65339||d===65341||d===65343||d>=65371&&d<=65503||d===65507||d>=65512&&d<=65519)||!(!os["Small Form Variants"](d)||d>=65112&&d<=65118||d>=65123&&d<=65126)||os["Unified Canadian Aboriginal Syllabics"](d)||os["Unified Canadian Aboriginal Syllabics Extended"](d)||os["Vertical Forms"](d)||os["Yijing Hexagram Symbols"](d)||os["Yi Syllables"](d)||os["Yi Radicals"](d))))}function hx(d){return!(ux(d)||function(s){return!!(os["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||os["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||os["Letterlike Symbols"](s)||os["Number Forms"](s)||os["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||os["Control Pictures"](s)&&s!==9251||os["Optical Character Recognition"](s)||os["Enclosed Alphanumerics"](s)||os["Geometric Shapes"](s)||os["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||os["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||os["CJK Symbols and Punctuation"](s)||os.Katakana(s)||os["Private Use Area"](s)||os["CJK Compatibility Forms"](s)||os["Small Form Variants"](s)||os["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(d))}function Ow(d){return os.Arabic(d)||os["Arabic Supplement"](d)||os["Arabic Extended-A"](d)||os["Arabic Presentation Forms-A"](d)||os["Arabic Presentation Forms-B"](d)}function K0(d){return d>=1424&&d<=2303||os["Arabic Presentation Forms-A"](d)||os["Arabic Presentation Forms-B"](d)}function zw(d,s){return!(!s&&K0(d)||d>=2304&&d<=3583||d>=3840&&d<=4255||os.Khmer(d))}function Nw(d){for(const s of d)if(K0(s.charCodeAt(0)))return!0;return!1}const Cu={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Tv=null,hu=Cu.unavailable,fm=null;const Y0=function(d){d&&typeof d=="string"&&d.indexOf("NetworkError")>-1&&(hu=Cu.error),Tv&&Tv(d)};function Sv(){Cv.fire(new au("pluginStateChange",{pluginStatus:hu,pluginURL:fm}))}const Cv=new kp,dx=function(){return hu},Vm=function(){if(hu!==Cu.deferred||!fm)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");hu=Cu.loading,Sv(),fm&&Ip({url:fm},d=>{d?Y0(d):(hu=Cu.loaded,Sv())})},vp={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>hu===Cu.loaded||vp.applyArabicShaping!=null,isLoading:()=>hu===Cu.loading,setState(d){hu=d.pluginStatus,fm=d.pluginURL},isParsing:()=>hu===Cu.parsing,isParsed:()=>hu===Cu.parsed,getPluginURL:()=>fm};class yo{constructor(s,a){this.zoom=s,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(s){return function(a,_){for(const j of a)if(!zw(j.charCodeAt(0),_))return!1;return!0}(s,vp.isLoaded())}}class Um{constructor(s,a,_,j,tt){this.property=s,this.value=a,this.expression=function(rt,ot,ct,ht,mt){if(ix(rt))return new sx(rt,ot);if(vv(rt)||Array.isArray(rt)&&rt.length>0){const gt=bv(rt,ot,ct,ht,mt);if(gt.result==="error")throw new Error(gt.value.map(_t=>`${_t.key}: ${_t.message}`).join(", "));return gt.value}{let gt=rt;return typeof rt=="string"&&ot.type==="color"&&(gt=Js.parse(rt)),{kind:"constant",configDependencies:new Set,evaluate:()=>gt}}}(a===void 0?s.specification.default:a,s.specification,_,j,tt)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,a,_,j){return this.property.possiblyEvaluate(this,s,a,_,j)}}class Av{constructor(s,a,_,j){this.property=s,this.value=new Um(s,void 0,a,_,j)}transitioned(s,a){return new Fp(this.property,this.value,a,Object.assign({},s.transition,this.transition),s.now)}untransitioned(){return new Fp(this.property,this.value,null,{},0)}}class Q0{constructor(s,a,_,j){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues),this._scope=a,this._options=_,this._iconImageUseTheme=j,this.configDependencies=new Set}getValue(s){return Rs(this._values[s].value.value)}setValue(s,a){this._values.hasOwnProperty(s)||(this._values[s]=new Av(this._values[s].property,this._scope,this._options,this._iconImageUseTheme)),this._values[s].value=new Um(this._values[s].property,a===null?void 0:Rs(a),this._scope,this._options,this._iconImageUseTheme),this._values[s].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].value.expression.configDependencies]))}setTransitionOrValue(s,a){a&&(this._options=a);const _=this._properties.properties;if(s)for(const j in s){const tt=s[j];if(j.endsWith("-transition")){const rt=j.slice(0,-11);_[rt]&&this.setTransition(rt,tt)}else _.hasOwnProperty(j)&&this.setValue(j,tt)}}getTransition(s){return Rs(this._values[s].transition)}setTransition(s,a){this._values.hasOwnProperty(s)||(this._values[s]=new Av(this._values[s].property)),this._values[s].transition=Rs(a)||void 0}serialize(){const s={};for(const a of Object.keys(this._values)){const _=this.getValue(a);_!==void 0&&(s[a]=_);const j=this.getTransition(a);j!==void 0&&(s[`${a}-transition`]=j)}return s}transitioned(s,a){const _=new Rv(this._properties);for(const j of Object.keys(this._values))_._values[j]=this._values[j].transitioned(s,a._values[j]);return _}untransitioned(){const s=new Rv(this._properties);for(const a of Object.keys(this._values))s._values[a]=this._values[a].untransitioned();return s}}class Fp{constructor(s,a,_,j,tt){const rt=j.delay||0,ot=j.duration||0;tt=tt||0,this.property=s,this.value=a,this.begin=tt+rt,this.end=this.begin+ot,s.specification.transition&&(j.delay||j.duration)&&(this.prior=_)}possiblyEvaluate(s,a,_){const j=s.now||0,tt=this.value.possiblyEvaluate(s,a,_),rt=this.prior;if(rt){if(j>this.end)return this.prior=null,tt;if(this.value.isDataDriven())return this.prior=null,tt;if(j<this.begin)return rt.possiblyEvaluate(s,a,_);{const ot=(j-this.begin)/(this.end-this.begin);return this.property.interpolate(rt.possiblyEvaluate(s,a,_),tt,lr(ot))}}return tt}}class Rv{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,a,_){const j=new Hm(this._properties);for(const tt of Object.keys(this._values))j._values[tt]=this._values[tt].possiblyEvaluate(s,a,_);return j}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class Gm{constructor(s,a,_,j){this._properties=s,this._values=Object.create(s.defaultPropertyValues),this._scope=a,this._options=_,this._iconImageUseTheme=j,this.configDependencies=new Set}getValue(s){return Rs(this._values[s].value)}setValue(s,a){this._values[s]=new Um(this._values[s].property,a===null?void 0:Rs(a),this._scope,this._options,this._iconImageUseTheme),this._values[s].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].expression.configDependencies]))}serialize(){const s={};for(const a of Object.keys(this._values)){const _=this.getValue(a);_!==void 0&&(s[a]=_)}return s}possiblyEvaluate(s,a,_,j){const tt=new Hm(this._properties);for(const rt of Object.keys(this._values))tt._values[rt]=this._values[rt].possiblyEvaluate(s,a,_,j);return tt}}class $m{constructor(s,a,_,j){this.property=s,this.value=a,this.parameters=_,this.iconImageUseTheme=j}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,a,_,j){return this.property.evaluate(this.value,this.parameters,s,a,_,j,this.iconImageUseTheme)}}class Hm{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class En{constructor(s){this.specification=s}possiblyEvaluate(s,a){return s.expression.evaluate(a)}interpolate(s,a,_){const j=xu[this.specification.type];return j?j(s,a,_):s}}class Dn{constructor(s,a){this.specification=s,this.overrides=a}possiblyEvaluate(s,a,_,j,tt){return s.expression.kind==="constant"||s.expression.kind==="camera"?new $m(this,{kind:"constant",value:s.expression.evaluate(a,null,{},_,j,void 0,tt)},a):new $m(this,s.expression,a,tt)}interpolate(s,a,_){if(s.value.kind!=="constant"||a.value.kind!=="constant")return s;if(s.value.value===void 0||a.value.value===void 0)return new $m(this,{kind:"constant",value:void 0},s.parameters);const j=xu[this.specification.type];return j?new $m(this,{kind:"constant",value:j(s.value.value,a.value.value,_)},s.parameters):s}evaluate(s,a,_,j,tt,rt,ot){return s.kind==="constant"?s.value:s.evaluate(a,_,j,tt,rt,void 0,ot)}}class Ry{constructor(s){this.specification=s}possiblyEvaluate(s,a,_,j){return!!s.expression.evaluate(a,null,{},_,j)}interpolate(){return!1}}class $o{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new yo(0,{});for(const _ in s){const j=s[_];j.specification.overridable&&this.overridableProperties.push(_);const tt=this.defaultPropertyValues[_]=new Um(j,void 0),rt=this.defaultTransitionablePropertyValues[_]=new Av(j);this.defaultTransitioningPropertyValues[_]=rt.untransitioned(),this.defaultPossiblyEvaluatedValues[_]=tt.possiblyEvaluate(a)}}}Fn(Dn,"DataDrivenProperty"),Fn(En,"DataConstantProperty"),Fn(Ry,"ColorRampProperty");var jr=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function fx(d){return d instanceof Number||d instanceof String||d instanceof Boolean?d.valueOf():d}function Wm(d){if(Array.isArray(d))return d.map(Wm);if(d instanceof Object&&!(d instanceof Number||d instanceof String||d instanceof Boolean)){const s={};for(const a in d)s[a]=Wm(d[a]);return s}return fx(d)}function mx(d){if(d===!0||d===!1)return!0;if(!Array.isArray(d)||d.length===0)return!1;switch(d[0]){case"has":return d.length>=2&&d[1]!=="$id"&&d[1]!=="$type";case"in":return d.length>=3&&(typeof d[1]!="string"||Array.isArray(d[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return d.length!==3||Array.isArray(d[1])||Array.isArray(d[2]);case"any":case"all":for(const s of d.slice(1))if(!mx(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}function c_(d,s="",a=null,_="fill"){if(d==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};mx(d)||(d=gx(d));const j=d;let tt=!0;try{tt=function(mt){if(!Py(mt))return mt;let gt=Wm(mt);return op(gt),gt=J0(gt),gt}(j)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(j,null,2)}
        `)}let rt=null,ot=null;if(_!=="background"&&_!=="sky"&&_!=="slot"){ot=jr[`filter_${_}`];const mt=xp(tt,ot,s,a);if(mt.result==="error")throw new Error(mt.value.map(gt=>`${gt.key}: ${gt.message}`).join(", "));rt=(gt,_t,Rt)=>mt.value.evaluate(gt,_t,{},Rt)}let ct=null,ht=null;if(tt!==j){const mt=xp(j,ot,s,a);if(mt.result==="error")throw new Error(mt.value.map(gt=>`${gt.key}: ${gt.message}`).join(", "));ct=(gt,_t,Rt,Pt,zt)=>mt.value.evaluate(gt,_t,{},Rt,void 0,void 0,Pt,zt),ht=!by(mt.value.expression)}return{filter:rt,dynamicFilter:ct||void 0,needGeometry:t1(tt),needFeature:!!ht}}function J0(d){if(!Array.isArray(d))return d;const s=function(a){if(e1.has(a[0])){for(let _=1;_<a.length;_++)if(Py(a[_]))return!0}return a}(d);return s===!0?s:s.map(a=>J0(a))}function op(d){let s=!1;const a=[];if(d[0]==="case"){for(let _=1;_<d.length-1;_+=2)s=s||Py(d[_]),a.push(d[_+1]);a.push(d[d.length-1])}else if(d[0]==="match"){s=s||Py(d[1]);for(let _=2;_<d.length-1;_+=2)a.push(d[_+1]);a.push(d[d.length-1])}else if(d[0]==="step"){s=s||Py(d[1]);for(let _=1;_<d.length-1;_+=2)a.push(d[_+1])}s&&(d.length=0,d.push("any",...a));for(let _=1;_<d.length;_++)op(d[_])}function Py(d){if(!Array.isArray(d))return!1;if((s=d[0])==="pitch"||s==="distance-from-center")return!0;var s;for(let a=1;a<d.length;a++)if(Py(d[a]))return!0;return!1}const e1=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Bw(d,s){return d<s?-1:d>s?1:0}function t1(d){if(!Array.isArray(d))return!1;if(d[0]==="within"||d[0]==="distance")return!0;for(let s=1;s<d.length;s++)if(t1(d[s]))return!0;return!1}function gx(d){if(!d)return!0;const s=d[0];return d.length<=1?s!=="any":s==="=="?Pv(d[1],d[2],"=="):s==="!="?yx(Pv(d[1],d[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Pv(d[1],d[2],s):s==="any"?(a=d.slice(1),["any"].concat(a.map(gx))):s==="all"?["all"].concat(d.slice(1).map(gx)):s==="none"?["all"].concat(d.slice(1).map(gx).map(yx)):s==="in"?i1(d[1],d.slice(2)):s==="!in"?yx(i1(d[1],d.slice(2))):s==="has"?r1(d[1]):s!=="!has"||yx(r1(d[1]));var a}function Pv(d,s,a){switch(d){case"$type":return[`filter-type-${a}`,s];case"$id":return[`filter-id-${a}`,s];default:return[`filter-${a}`,d,s]}}function i1(d,s){if(s.length===0)return!1;switch(d){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(a=>typeof a!=typeof s[0])?["filter-in-large",d,["literal",s.sort(Bw)]]:["filter-in-small",d,["literal",s]]}}function r1(d){switch(d){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",d]}}function yx(d){return["!",d]}const u_="";function Iy(d,s){return s?`${d}${u_}${s}`:d}let Iv;const n1=()=>Iv||(Iv=new $o({"icon-size":new Dn(jr.layout_symbol["icon-size"]),"icon-image":new Dn(jr.layout_symbol["icon-image"]),"icon-rotate":new Dn(jr.layout_symbol["icon-rotate"]),"icon-offset":new Dn(jr.layout_symbol["icon-offset"])}));class Vw{constructor(s,a,_,j,tt,rt){const ot=xp(s,jr.appearance.condition);if(ot.result==="success"&&(this.condition=ot.value),this.name=a,_){this.properties=new Hm(n1()),this.unevaluatedLayout=new Gm(n1(),j,tt,rt);for(const ct in _)this.unevaluatedLayout.setValue(ct,_[ct])}}isActive(s){return!(this.condition||!s.isHidden||this.name!=="hidden")||this.condition.evaluate(s.globals,s.feature,s.featureState,s.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(s){return this.properties.get(s)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const s={};return s.condition=this.condition.expression.serialize(),this.name&&(s.name=this.name),this.properties&&(s.properties=this.properties),s}}const s1="-transition",o1=new Set(["fill","line","background","hillshade","raster"]);class lu extends kp{constructor(s,a,_,j,tt,rt){if(super(),this.id=s.id,this.fqid=Iy(this.id,_),this.type=s.type,this.scope=_,this.lut=j,this.options=tt,this.iconImageUseTheme=rt,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,s.type!=="custom"){if(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type&&s.type!=="background"&&s.type!=="sky"&&s.type!=="slot"){this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter;const ot=xp(this.filter,jr[`filter_${s.type}`]);ot.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...ot.value.configDependencies]))}if(s.slot&&(this.slot=s.slot),s.appearances&&s.appearances.forEach(ot=>{this.appearances.push(new Vw(ot.condition,ot.name,ot.properties,this.scope,tt,this.iconImageUseTheme))}),a.layout&&(this._unevaluatedLayout=new Gm(a.layout,this.scope,tt,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint){this._transitionablePaint=new Q0(a.paint,this.scope,tt);for(const ot in s.paint)this.setPaintProperty(ot,s.paint[ot]);for(const ot in s.layout)this.setLayoutProperty(ot,s.layout[ot]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Hm(a.paint)}}}onAdd(s){}onRemove(s){}isDraped(s){return!this.is3D(!0)&&o1.has(this.type)}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,a){if(this.type==="custom"&&s==="visibility")return void(this.visibility=a);const _=this._unevaluatedLayout;_._properties.properties[s]&&(_.setValue(s,a),this.configDependencies=new Set([...this.configDependencies,..._.configDependencies]),s==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(s){return s.endsWith(s1)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,a){const _=this._transitionablePaint,j=_._properties.properties;if(s.endsWith(s1)){const gt=s.slice(0,-11);return j[gt]&&_.setTransition(gt,a||void 0),!1}if(!j[s])return!1;const tt=_._values[s],rt=tt.value.isDataDriven(),ot=tt.value;_.setValue(s,a),this.configDependencies=new Set([...this.configDependencies,..._.configDependencies]),this._handleSpecialPaintPropertyUpdate(s);const ct=_._values[s].value,ht=ct.isDataDriven(),mt=s.endsWith("pattern")||s==="line-dasharray";return ht||rt||mt||this._handleOverridablePaintPropertyUpdate(s,ot,ct)}_handleSpecialPaintPropertyUpdate(s){}getProgramIds(){return null}getDefaultProgramParams(s,a,_){return null}_handleOverridablePaintPropertyUpdate(s,a,_){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,a,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,a)}serialize(){const s={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(s.appearances=this.appearances.map(a=>a.serialize())),js(s,(a,_)=>!(a===void 0||_==="layout"&&!Object.keys(a).length||_==="paint"&&!Object.keys(a).length))}is3D(s){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const s in this.paint._values){const a=this.paint.get(s);if(a instanceof $m&&ex(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(s){this._filterCompiled||(this._featureFilter=c_(this.filter,this.scope,s),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(s){this._stats&&(s.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(s){}queryIntersectsFeature(s,a,_,j,tt,rt,ot,ct,ht){}}const mm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class My{constructor(s,a){this._structArray=s,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Co{constructor(){this.capacity=-1,this.resize(0)}static serialize(s,a){return s._trim(),a&&a.add(s.arrayBuffer),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const a=Object.create(this.prototype);return a.arrayBuffer=s.arrayBuffer,a.length=s.length,a.capacity=s.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...s){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...s){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function zs(d,s=1){let a=0,_=0;return{members:d.map(j=>{const tt=mm[j.type].BYTES_PER_ELEMENT,rt=a=a1(a,Math.max(s,tt)),ot=j.components||1;return _=Math.max(_,tt),a+=tt*ot,{name:j.name,type:j.type,components:ot,offset:rt}}),size:a1(a,Math.max(_,s)),alignment:s}}function a1(d,s){return Math.ceil(d/s)*s}class gm extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a){const _=this.length;return this.resize(_+1),this.emplace(_,s,a)}emplace(s,a,_){const j=2*s;return this.int16[j+0]=a,this.int16[j+1]=_,s}}gm.prototype.bytesPerElement=4,Fn(gm,"StructArrayLayout2i4");class qm extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,_){const j=this.length;return this.resize(j+1),this.emplace(j,s,a,_)}emplace(s,a,_,j){const tt=3*s;return this.int16[tt+0]=a,this.int16[tt+1]=_,this.int16[tt+2]=j,s}}qm.prototype.bytesPerElement=6,Fn(qm,"StructArrayLayout3i6");class Zm extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,_,j){const tt=this.length;return this.resize(tt+1),this.emplace(tt,s,a,_,j)}emplace(s,a,_,j,tt){const rt=4*s;return this.int16[rt+0]=a,this.int16[rt+1]=_,this.int16[rt+2]=j,this.int16[rt+3]=tt,s}}Zm.prototype.bytesPerElement=8,Fn(Zm,"StructArrayLayout4i8");class ym extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.float32[1*s+0]=a,s}}ym.prototype.bytesPerElement=4,Fn(ym,"StructArrayLayout1f4");class Mv extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_){const j=this.length;return this.resize(j+1),this.emplace(j,s,a,_)}emplace(s,a,_,j){const tt=4*s,rt=2*s;return this.int16[tt+0]=a,this.int16[tt+1]=_,this.float32[rt+1]=j,s}}Mv.prototype.bytesPerElement=8,Fn(Mv,"StructArrayLayout2i1f8");class _x extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,_){const j=this.length;return this.resize(j+1),this.emplace(j,s,a,_)}emplace(s,a,_,j){const tt=4*s;return this.int16[tt+0]=a,this.int16[tt+1]=_,this.int16[tt+2]=j,s}}_x.prototype.bytesPerElement=8,Fn(_x,"StructArrayLayout3i8");class kv extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt){const rt=this.length;return this.resize(rt+1),this.emplace(rt,s,a,_,j,tt)}emplace(s,a,_,j,tt,rt){const ot=5*s;return this.int16[ot+0]=a,this.int16[ot+1]=_,this.int16[ot+2]=j,this.int16[ot+3]=tt,this.int16[ot+4]=rt,s}}kv.prototype.bytesPerElement=10,Fn(kv,"StructArrayLayout5i10");class xx extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt,ot){const ct=this.length;return this.resize(ct+1),this.emplace(ct,s,a,_,j,tt,rt,ot)}emplace(s,a,_,j,tt,rt,ot,ct){const ht=6*s,mt=12*s,gt=3*s;return this.int16[ht+0]=a,this.int16[ht+1]=_,this.uint8[mt+4]=j,this.uint8[mt+5]=tt,this.uint8[mt+6]=rt,this.uint8[mt+7]=ot,this.float32[gt+2]=ct,s}}xx.prototype.bytesPerElement=12,Fn(xx,"StructArrayLayout2i4ub1f12");class vu extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_){const j=this.length;return this.resize(j+1),this.emplace(j,s,a,_)}emplace(s,a,_,j){const tt=3*s;return this.float32[tt+0]=a,this.float32[tt+1]=_,this.float32[tt+2]=j,s}}vu.prototype.bytesPerElement=12,Fn(vu,"StructArrayLayout3f12");class _m extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt){const rt=this.length;return this.resize(rt+1),this.emplace(rt,s,a,_,j,tt)}emplace(s,a,_,j,tt,rt){const ot=6*s,ct=3*s;return this.uint16[ot+0]=a,this.uint16[ot+1]=_,this.uint16[ot+2]=j,this.uint16[ot+3]=tt,this.float32[ct+2]=rt,s}}_m.prototype.bytesPerElement=12,Fn(_m,"StructArrayLayout4ui1f12");class ky extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,_,j){const tt=this.length;return this.resize(tt+1),this.emplace(tt,s,a,_,j)}emplace(s,a,_,j,tt){const rt=4*s;return this.uint16[rt+0]=a,this.uint16[rt+1]=_,this.uint16[rt+2]=j,this.uint16[rt+3]=tt,s}}ky.prototype.bytesPerElement=8,Fn(ky,"StructArrayLayout4ui8");class vx extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,s,a,_,j,tt,rt)}emplace(s,a,_,j,tt,rt,ot){const ct=6*s;return this.int16[ct+0]=a,this.int16[ct+1]=_,this.int16[ct+2]=j,this.int16[ct+3]=tt,this.int16[ct+4]=rt,this.int16[ct+5]=ot,s}}vx.prototype.bytesPerElement=12,Fn(vx,"StructArrayLayout6i12");class Dv extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t){const Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t)}emplace(s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt){const Pt=12*s;return this.int16[Pt+0]=a,this.int16[Pt+1]=_,this.int16[Pt+2]=j,this.int16[Pt+3]=tt,this.uint16[Pt+4]=rt,this.uint16[Pt+5]=ot,this.uint16[Pt+6]=ct,this.uint16[Pt+7]=ht,this.int16[Pt+8]=mt,this.int16[Pt+9]=gt,this.int16[Pt+10]=_t,this.int16[Pt+11]=Rt,s}}Dv.prototype.bytesPerElement=24,Fn(Dv,"StructArrayLayout4i4ui4i24");class Lv extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,s,a,_,j,tt,rt)}emplace(s,a,_,j,tt,rt,ot){const ct=10*s,ht=5*s;return this.int16[ct+0]=a,this.int16[ct+1]=_,this.int16[ct+2]=j,this.float32[ht+2]=tt,this.float32[ht+3]=rt,this.float32[ht+4]=ot,s}}Lv.prototype.bytesPerElement=20,Fn(Lv,"StructArrayLayout3i3f20");class ap extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_,j){const tt=this.length;return this.resize(tt+1),this.emplace(tt,s,a,_,j)}emplace(s,a,_,j,tt){const rt=4*s;return this.float32[rt+0]=a,this.float32[rt+1]=_,this.float32[rt+2]=j,this.float32[rt+3]=tt,s}}ap.prototype.bytesPerElement=16,Fn(ap,"StructArrayLayout4f16");class Dy extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.uint32[1*s+0]=a,s}}Dy.prototype.bytesPerElement=4,Fn(Dy,"StructArrayLayout1ul4");class Sl extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a){const _=this.length;return this.resize(_+1),this.emplace(_,s,a)}emplace(s,a,_){const j=2*s;return this.uint16[j+0]=a,this.uint16[j+1]=_,s}}Sl.prototype.bytesPerElement=4,Fn(Sl,"StructArrayLayout2ui4");class Ly extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt){const Pt=this.length;return this.resize(Pt+1),this.emplace(Pt,s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt)}emplace(s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt){const zt=20*s,Vt=10*s;return this.int16[zt+0]=a,this.int16[zt+1]=_,this.int16[zt+2]=j,this.int16[zt+3]=tt,this.int16[zt+4]=rt,this.float32[Vt+3]=ot,this.float32[Vt+4]=ct,this.float32[Vt+5]=ht,this.float32[Vt+6]=mt,this.int16[zt+14]=gt,this.uint32[Vt+8]=_t,this.uint16[zt+18]=Rt,this.uint16[zt+19]=Pt,s}}Ly.prototype.bytesPerElement=40,Fn(Ly,"StructArrayLayout5i4f1i1ul2ui40");class bx extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt,ot){const ct=this.length;return this.resize(ct+1),this.emplace(ct,s,a,_,j,tt,rt,ot)}emplace(s,a,_,j,tt,rt,ot,ct){const ht=8*s;return this.int16[ht+0]=a,this.int16[ht+1]=_,this.int16[ht+2]=j,this.int16[ht+4]=tt,this.int16[ht+5]=rt,this.int16[ht+6]=ot,this.int16[ht+7]=ct,s}}bx.prototype.bytesPerElement=16,Fn(bx,"StructArrayLayout3i2i2i16");class jv extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt){const rt=this.length;return this.resize(rt+1),this.emplace(rt,s,a,_,j,tt)}emplace(s,a,_,j,tt,rt){const ot=4*s,ct=8*s;return this.float32[ot+0]=a,this.float32[ot+1]=_,this.float32[ot+2]=j,this.int16[ct+6]=tt,this.int16[ct+7]=rt,s}}jv.prototype.bytesPerElement=16,Fn(jv,"StructArrayLayout2f1f2i16");class Fv extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,s,a,_,j,tt,rt)}emplace(s,a,_,j,tt,rt,ot){const ct=20*s,ht=5*s;return this.uint8[ct+0]=a,this.uint8[ct+1]=_,this.float32[ht+1]=j,this.float32[ht+2]=tt,this.float32[ht+3]=rt,this.float32[ht+4]=ot,s}}Fv.prototype.bytesPerElement=20,Fn(Fv,"StructArrayLayout2ub4f20");class Dl extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,_){const j=this.length;return this.resize(j+1),this.emplace(j,s,a,_)}emplace(s,a,_,j){const tt=3*s;return this.uint16[tt+0]=a,this.uint16[tt+1]=_,this.uint16[tt+2]=j,s}}Dl.prototype.bytesPerElement=6,Fn(Dl,"StructArrayLayout3ui6");class h_ extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt,Vt,Gt,_i,er,rr,_r){const xr=this.length;return this.resize(xr+1),this.emplace(xr,s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt,Vt,Gt,_i,er,rr,_r)}emplace(s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt,Vt,Gt,_i,er,rr,_r,xr){const Er=30*s,Ar=15*s,Pr=60*s;return this.int16[Er+0]=a,this.int16[Er+1]=_,this.int16[Er+2]=j,this.float32[Ar+2]=tt,this.float32[Ar+3]=rt,this.uint16[Er+8]=ot,this.uint16[Er+9]=ct,this.uint32[Ar+5]=ht,this.uint32[Ar+6]=mt,this.uint32[Ar+7]=gt,this.uint16[Er+16]=_t,this.uint16[Er+17]=Rt,this.uint16[Er+18]=Pt,this.float32[Ar+10]=zt,this.float32[Ar+11]=Vt,this.uint8[Pr+48]=Gt,this.uint8[Pr+49]=_i,this.uint8[Pr+50]=er,this.uint32[Ar+13]=rr,this.int16[Er+28]=_r,this.uint8[Pr+58]=xr,s}}h_.prototype.bytesPerElement=60,Fn(h_,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ov extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt,Vt,Gt,_i,er,rr,_r,xr,Er,Ar,Pr,sn,Fr,on,gn,an,hn,vn,tn){const dn=this.length;return this.resize(dn+1),this.emplace(dn,s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt,Vt,Gt,_i,er,rr,_r,xr,Er,Ar,Pr,sn,Fr,on,gn,an,hn,vn,tn)}emplace(s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt,Vt,Gt,_i,er,rr,_r,xr,Er,Ar,Pr,sn,Fr,on,gn,an,hn,vn,tn,dn){const qr=20*s,Gr=40*s,wn=80*s;return this.float32[qr+0]=a,this.float32[qr+1]=_,this.int16[Gr+4]=j,this.int16[Gr+5]=tt,this.int16[Gr+6]=rt,this.int16[Gr+7]=ot,this.int16[Gr+8]=ct,this.int16[Gr+9]=ht,this.int16[Gr+10]=mt,this.int16[Gr+11]=gt,this.int16[Gr+12]=_t,this.uint16[Gr+13]=Rt,this.uint16[Gr+14]=Pt,this.uint16[Gr+15]=zt,this.uint16[Gr+16]=Vt,this.uint16[Gr+17]=Gt,this.uint16[Gr+18]=_i,this.uint16[Gr+19]=er,this.uint16[Gr+20]=rr,this.uint16[Gr+21]=_r,this.uint16[Gr+22]=xr,this.uint16[Gr+23]=Er,this.uint16[Gr+24]=Ar,this.uint16[Gr+25]=Pr,this.uint16[Gr+26]=sn,this.uint16[Gr+27]=Fr,this.uint32[qr+14]=on,this.float32[qr+15]=gn,this.float32[qr+16]=an,this.float32[qr+17]=hn,this.float32[qr+18]=vn,this.uint8[wn+76]=tn,this.uint16[Gr+39]=dn,s}}Ov.prototype.bytesPerElement=80,Fn(Ov,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class d_ extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,s,a,_,j,tt,rt)}emplace(s,a,_,j,tt,rt,ot){const ct=6*s;return this.float32[ct+0]=a,this.float32[ct+1]=_,this.float32[ct+2]=j,this.float32[ct+3]=tt,this.float32[ct+4]=rt,this.float32[ct+5]=ot,s}}d_.prototype.bytesPerElement=24,Fn(d_,"StructArrayLayout6f24");class Xm extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt){const rt=this.length;return this.resize(rt+1),this.emplace(rt,s,a,_,j,tt)}emplace(s,a,_,j,tt,rt){const ot=5*s;return this.float32[ot+0]=a,this.float32[ot+1]=_,this.float32[ot+2]=j,this.float32[ot+3]=tt,this.float32[ot+4]=rt,s}}Xm.prototype.bytesPerElement=20,Fn(Xm,"StructArrayLayout5f20");class zv extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt,ot){const ct=this.length;return this.resize(ct+1),this.emplace(ct,s,a,_,j,tt,rt,ot)}emplace(s,a,_,j,tt,rt,ot,ct){const ht=7*s;return this.float32[ht+0]=a,this.float32[ht+1]=_,this.float32[ht+2]=j,this.float32[ht+3]=tt,this.float32[ht+4]=rt,this.float32[ht+5]=ot,this.float32[ht+6]=ct,s}}zv.prototype.bytesPerElement=28,Fn(zv,"StructArrayLayout7f28");class wx extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt,ot,ct,ht,mt,gt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,s,a,_,j,tt,rt,ot,ct,ht,mt,gt)}emplace(s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t){const Rt=11*s;return this.float32[Rt+0]=a,this.float32[Rt+1]=_,this.float32[Rt+2]=j,this.float32[Rt+3]=tt,this.float32[Rt+4]=rt,this.float32[Rt+5]=ot,this.float32[Rt+6]=ct,this.float32[Rt+7]=ht,this.float32[Rt+8]=mt,this.float32[Rt+9]=gt,this.float32[Rt+10]=_t,s}}wx.prototype.bytesPerElement=44,Fn(wx,"StructArrayLayout11f44");class p_ extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt,ot,ct,ht){const mt=this.length;return this.resize(mt+1),this.emplace(mt,s,a,_,j,tt,rt,ot,ct,ht)}emplace(s,a,_,j,tt,rt,ot,ct,ht,mt){const gt=9*s;return this.float32[gt+0]=a,this.float32[gt+1]=_,this.float32[gt+2]=j,this.float32[gt+3]=tt,this.float32[gt+4]=rt,this.float32[gt+5]=ot,this.float32[gt+6]=ct,this.float32[gt+7]=ht,this.float32[gt+8]=mt,s}}p_.prototype.bytesPerElement=36,Fn(p_,"StructArrayLayout9f36");class jy extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a){const _=this.length;return this.resize(_+1),this.emplace(_,s,a)}emplace(s,a,_){const j=2*s;return this.float32[j+0]=a,this.float32[j+1]=_,s}}jy.prototype.bytesPerElement=8,Fn(jy,"StructArrayLayout2f8");class Ex extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,_,j){const tt=this.length;return this.resize(tt+1),this.emplace(tt,s,a,_,j)}emplace(s,a,_,j,tt){const rt=6*s;return this.uint32[3*s+0]=a,this.uint16[rt+2]=_,this.uint16[rt+3]=j,this.uint16[rt+4]=tt,s}}Ex.prototype.bytesPerElement=12,Fn(Ex,"StructArrayLayout1ul3ui12");class Tx extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.uint16[1*s+0]=a,s}}Tx.prototype.bytesPerElement=2,Fn(Tx,"StructArrayLayout1ui2");class Nv extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt,Vt){const Gt=this.length;return this.resize(Gt+1),this.emplace(Gt,s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt,Vt)}emplace(s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt,Vt,Gt){const _i=16*s;return this.float32[_i+0]=a,this.float32[_i+1]=_,this.float32[_i+2]=j,this.float32[_i+3]=tt,this.float32[_i+4]=rt,this.float32[_i+5]=ot,this.float32[_i+6]=ct,this.float32[_i+7]=ht,this.float32[_i+8]=mt,this.float32[_i+9]=gt,this.float32[_i+10]=_t,this.float32[_i+11]=Rt,this.float32[_i+12]=Pt,this.float32[_i+13]=zt,this.float32[_i+14]=Vt,this.float32[_i+15]=Gt,s}}Nv.prototype.bytesPerElement=64,Fn(Nv,"StructArrayLayout16f64");class Fy extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,_,j,tt,rt,ot){const ct=this.length;return this.resize(ct+1),this.emplace(ct,s,a,_,j,tt,rt,ot)}emplace(s,a,_,j,tt,rt,ot,ct){const ht=10*s,mt=5*s;return this.uint16[ht+0]=a,this.uint16[ht+1]=_,this.uint16[ht+2]=j,this.uint16[ht+3]=tt,this.float32[mt+2]=rt,this.float32[mt+3]=ot,this.float32[mt+4]=ct,s}}Fy.prototype.bytesPerElement=20,Fn(Fy,"StructArrayLayout4ui3f20");class Oy extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.int16[1*s+0]=a,s}}Oy.prototype.bytesPerElement=2,Fn(Oy,"StructArrayLayout1i2");class Sx extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.uint8[1*s+0]=a,s}}Sx.prototype.bytesPerElement=1,Fn(Sx,"StructArrayLayout1ub1");class l1 extends My{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}l1.prototype.size=40;class Bv extends Ly{get(s){return new l1(this,s)}}Fn(Bv,"CollisionBoxArray");class c1 extends My{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(s){this._structArray.uint8[this._pos1+49]=s}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(s){this._structArray.uint8[this._pos1+50]=s}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(s){this._structArray.uint32[this._pos4+13]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(s){this._structArray.uint8[this._pos1+58]=s}}c1.prototype.size=60;class Cx extends h_{get(s){return new c1(this,s)}}Fn(Cx,"PlacedSymbolArray");class u1 extends My{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(s){this._structArray.uint32[this._pos4+14]=s}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(s){this._structArray.float32[this._pos4+18]=s}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}u1.prototype.size=80;class h1 extends Ov{get(s){return new u1(this,s)}}Fn(h1,"SymbolInstanceArray");class d1 extends ym{getoffsetX(s){return this.float32[1*s+0]}}Fn(d1,"GlyphOffsetArray");class p1 extends gm{getx(s){return this.int16[2*s+0]}gety(s){return this.int16[2*s+1]}}Fn(p1,"SymbolLineVertexArray");class Vv extends My{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Vv.prototype.size=12;class f1 extends Ex{get(s){return new Vv(this,s)}}Fn(f1,"FeatureIndexArray");class m1 extends Sl{geta_centroid_pos0(s){return this.uint16[2*s+0]}geta_centroid_pos1(s){return this.uint16[2*s+1]}}Fn(m1,"FillExtrusionCentroidArray");class g1 extends My{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}g1.prototype.size=6;class y1 extends qm{get(s){return new g1(this,s)}}Fn(y1,"FillExtrusionWallArray");const Uw=zs([{name:"a_pos",components:2,type:"Int16"}],4),Gw=zs([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),$w=zs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Bo{constructor(s=[]){this.segments=s}_prepareSegment(s,a,_,j){let tt=this.segments[this.segments.length-1];return s>Bo.MAX_VERTEX_ARRAY_LENGTH&&Es(`Max vertices per segment is ${Bo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!tt||tt.vertexLength+s>Bo.MAX_VERTEX_ARRAY_LENGTH||tt.sortKey!==j)&&(tt={vertexOffset:a,primitiveOffset:_,vertexLength:0,primitiveLength:0},j!==void 0&&(tt.sortKey=j),this.segments.push(tt)),tt}prepareSegment(s,a,_,j){return this._prepareSegment(s,a.length,_.length,j)}get(){return this.segments}destroy(){for(const s of this.segments)for(const a in s.vaos)s.vaos[a].destroy()}static simpleSegment(s,a,_,j){return new Bo([{vertexOffset:s,primitiveOffset:a,vertexLength:_,primitiveLength:j,vaos:{},sortKey:0}])}}function f_(d,s){return 256*(d=fr(Math.floor(d),0,255))+fr(Math.floor(s),0,255)}Bo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fn(Bo,"SegmentVector");const Hw=zs([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ww=zs([{name:"a_pattern_b",components:4,type:"Uint16"}]),Ax=zs([{name:"a_dash",components:4,type:"Uint16"}]);class m_{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(s,a,_,j){this.ids.push(Uv(s)),this.positions.push(a,_,j)}eachPosition(s,a){const _=Uv(s);let j=0,tt=this.ids.length-1;for(;j<tt;){const rt=j+tt>>1;this.ids[rt]>=_?tt=rt:j=rt+1}for(;this.ids[j]===_;)a(this.positions[3*j],this.positions[3*j+1],this.positions[3*j+2]),j++}static serialize(s,a){const _=new Float64Array(s.ids),j=new Uint32Array(s.positions);return Gv(_,j,0,_.length-1),a&&(a.add(_.buffer),a.add(j.buffer)),{ids:_,positions:j}}static deserialize(s){const a=new m_;let _;a.ids=s.ids,a.positions=s.positions;for(const j of a.ids)j!==_&&a.uniqueIds.push(j),_=j;return a.indexed=!0,a}}function Uv(d){const s=+d;return Number.isSafeInteger(s)?s:ay(String(d))}function Gv(d,s,a,_){for(;a<_;){const j=d[a+_>>1];let tt=a-1,rt=_+1;for(;;){do tt++;while(d[tt]<j);do rt--;while(d[rt]>j);if(tt>=rt)break;g_(d,tt,rt),g_(s,3*tt,3*rt),g_(s,3*tt+1,3*rt+1),g_(s,3*tt+2,3*rt+2)}rt-a<_-rt?(Gv(d,s,a,rt),a=rt+1):(Gv(d,s,rt+1,_),_=rt)}}function g_(d,s,a){const _=d[s];d[s]=d[a],d[a]=_}Fn(m_,"FeaturePositionMap");class bp{constructor(s){this.gl=s.gl,this.initialized=!1}fetchUniformLocation(s,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(s,a),this.initialized=!0),!!this.location}set(s,a,_){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class y_ extends bp{constructor(s){super(s),this.current=0}set(s,a,_){this.fetchUniformLocation(s,a)&&this.current!==_&&(this.current=_,this.gl.uniform1i(this.location,_))}}class ba extends bp{constructor(s){super(s),this.current=0}set(s,a,_){this.fetchUniformLocation(s,a)&&this.current!==_&&(this.current=_,this.gl.uniform1f(this.location,_))}}class wp extends bp{constructor(s){super(s),this.current=[0,0]}set(s,a,_){this.fetchUniformLocation(s,a)&&(_[0]===this.current[0]&&_[1]===this.current[1]||(this.current=_,this.gl.uniform2f(this.location,_[0],_[1])))}}class __ extends bp{constructor(s){super(s),this.current=[0,0,0]}set(s,a,_){this.fetchUniformLocation(s,a)&&(_[0]===this.current[0]&&_[1]===this.current[1]&&_[2]===this.current[2]||(this.current=_,this.gl.uniform3f(this.location,_[0],_[1],_[2])))}}class x_ extends bp{constructor(s){super(s),this.current=[0,0,0,0]}set(s,a,_){this.fetchUniformLocation(s,a)&&(_[0]===this.current[0]&&_[1]===this.current[1]&&_[2]===this.current[2]&&_[3]===this.current[3]||(this.current=_,this.gl.uniform4f(this.location,_[0],_[1],_[2],_[3])))}}class _1 extends bp{constructor(s){super(s),this.current=Js.transparent.toPremultipliedRenderColor(null)}set(s,a,_){this.fetchUniformLocation(s,a)&&(_.r===this.current.r&&_.g===this.current.g&&_.b===this.current.b&&_.a===this.current.a||(this.current=_,this.gl.uniform4f(this.location,_.r,_.g,_.b,_.a)))}}const qw=new Float32Array(16);class v_ extends bp{constructor(s){super(s),this.current=qw}set(s,a,_){if(this.fetchUniformLocation(s,a)){if(_[12]!==this.current[12]||_[0]!==this.current[0])return this.current=_,void this.gl.uniformMatrix4fv(this.location,!1,_);for(let j=1;j<16;j++)if(_[j]!==this.current[j]){this.current=_,this.gl.uniformMatrix4fv(this.location,!1,_);break}}}}const Zw=new Float32Array(9),Xw=new Float32Array(4);class Rx extends bp{constructor(s){super(s),this.current=Xw}set(s,a,_){if(this.fetchUniformLocation(s,a)){for(let j=0;j<4;j++)if(_[j]!==this.current[j]){this.current=_,this.gl.uniformMatrix2fv(this.location,!1,_);break}}}}function b_(d){return[f_(255*d.r,255*d.g),f_(255*d.b,255*d.a)]}class Nu{constructor(s,a,_,j){this.value=s,this.uniformNames=a.map(tt=>`u_${tt}`),this.type=_,this.context=j}setUniform(s,a,_,j,tt){const rt=j.constantOr(this.value);a.set(s,tt,rt instanceof Js?rt.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):rt)}getBinding(s,a){return this.type==="color"?new _1(s):new ba(s)}}class Km{constructor(s,a){this.uniformNames=a.map(_=>`u_${_}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(s,a){this.pixelRatio=s.pixelRatio||1,this.pattern=s.tl.concat(s.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(s,a,_,j,tt){let rt=null;tt!=="u_pattern"&&tt!=="u_dash"||(rt=this.pattern),tt==="u_pattern_b"&&(rt=this.patternTransition),tt==="u_pixel_ratio"&&(rt=this.pixelRatio),rt&&a.set(s,tt,rt)}getBinding(s,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new x_(s):new ba(s)}}class xm{constructor(s,a,_,j){this.expression=s,this.type=_,this.maxValue=0,this.paintVertexAttributes=a.map(tt=>({name:`a_${tt}`,type:"Float32",components:_==="color"?2:1,offset:0})),this.paintVertexArray=new j}populatePaintArray(s,a,_,j,tt,rt,ot,ct){const ht=this.paintVertexArray.length,mt=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new yo(0,{brightness:rt,worldview:ct}),a,{},tt,j,ot):this.expression.kind==="constant"&&this.expression.value,gt=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new yo(0,{brightness:rt,worldview:ct}),a,{},tt,j,ot):this.lutExpression.value)==="none";this.paintVertexArray.resize(s),this._setPaintValue(ht,s,mt,gt?null:this.context.lut)}updatePaintArray(s,a,_,j,tt,rt,ot,ct){const ht=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:ot,worldview:ct},_,j,void 0,tt):this.expression.kind==="constant"&&this.expression.value,mt=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new yo(0,{brightness:ot,worldview:ct}),_,j,void 0,tt):this.lutExpression.value)==="none";this._setPaintValue(s,a,ht,mt?null:this.context.lut)}_setPaintValue(s,a,_,j){if(this.type==="color"){const tt=b_(_.toPremultipliedRenderColor(j));for(let rt=s;rt<a;rt++)this.paintVertexArray.emplace(rt,tt[0],tt[1])}else{for(let tt=s;tt<a;tt++)this.paintVertexArray.emplace(tt,_);this.maxValue=Math.max(this.maxValue,Math.abs(_))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Op{constructor(s,a,_,j,tt,rt){this.expression=s,this.uniformNames=a.map(ot=>`u_${ot}_t`),this.type=_,this.useIntegerZoom=j,this.context=tt,this.maxValue=0,this.paintVertexAttributes=a.map(ot=>({name:`a_${ot}`,type:"Float32",components:_==="color"?4:2,offset:0})),this.paintVertexArray=new rt}populatePaintArray(s,a,_,j,tt,rt,ot,ct){const ht=this.expression.evaluate(new yo(this.context.zoom,{brightness:rt,worldview:ct}),a,{},tt,j,ot),mt=this.expression.evaluate(new yo(this.context.zoom+1,{brightness:rt,worldview:ct}),a,{},tt,j,ot),gt=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new yo(0,{brightness:rt,worldview:ct}),a,{},tt,j,ot):this.lutExpression.value)==="none",_t=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(_t,s,ht,mt,gt?null:this.context.lut)}updatePaintArray(s,a,_,j,tt,rt,ot,ct){const ht=this.expression.evaluate({zoom:this.context.zoom,brightness:ot,worldview:ct},_,j,void 0,tt),mt=this.expression.evaluate({zoom:this.context.zoom+1,brightness:ot,worldview:ct},_,j,void 0,tt),gt=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new yo(0,{brightness:ot,worldview:ct}),_,j,void 0,tt):this.lutExpression.value)==="none";this._setPaintValue(s,a,ht,mt,gt?null:this.context.lut)}_setPaintValue(s,a,_,j,tt){if(this.type==="color"){const rt=b_(_.toPremultipliedRenderColor(tt)),ot=b_(_.toPremultipliedRenderColor(tt));for(let ct=s;ct<a;ct++)this.paintVertexArray.emplace(ct,rt[0],rt[1],ot[0],ot[1])}else{for(let rt=s;rt<a;rt++)this.paintVertexArray.emplace(rt,_,j);this.maxValue=Math.max(this.maxValue,Math.abs(_),Math.abs(j))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,a,_,j,tt){const rt=this.useIntegerZoom?Math.floor(_.zoom):_.zoom,ot=fr(this.expression.interpolationFactor(rt,this.context.zoom,this.context.zoom+1),0,1);a.set(s,tt,ot)}getBinding(s,a){return new ba(s)}}class zp{constructor(s,a,_,j,tt){this.expression=s,this.layerId=tt,this.paintVertexAttributes=(_==="array"?Ax:Hw).members;for(let rt=0;rt<a.length;++rt);this.paintVertexArray=new j,this.paintTransitionVertexArray=new ky}populatePaintArray(s,a,_,j){const tt=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValues(tt,s,a.patterns&&a.patterns[this.layerId],_)}updatePaintArray(s,a,_,j,tt,rt,ot){this._setPaintValues(s,a,_.patterns&&_.patterns[this.layerId],rt)}_setPaintValues(s,a,_,j){if(!j||!_)return;const tt=j[_[0]],rt=j[_[1]];if(tt){if(tt){const{tl:ot,br:ct,pixelRatio:ht}=tt;for(let mt=s;mt<a;mt++)this.paintVertexArray.emplace(mt,ot[0],ot[1],ct[0],ct[1],ht)}if(rt){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:ot,br:ct}=rt;for(let ht=s;ht<a;ht++)this.paintTransitionVertexArray.emplace(ht,ot[0],ot[1],ct[0],ct[1])}}}upload(s){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=s.createVertexBuffer(this.paintTransitionVertexArray,Ww.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Ym{constructor(s,a,_=()=>!0){this.binders={},this._buffers=[],this.context=a;const j=[];for(const tt in s.paint._values){const rt=s.paint.get(tt);if(tt.endsWith("-use-theme")||!_(tt)||!(rt instanceof $m&&ex(rt.property.specification)))continue;const ot=dT(tt,s.type),ct=rt.value,ht=rt.property.specification.type,mt=!!rt.property.useIntegerZoom,gt=tt==="line-dasharray"||tt.endsWith("pattern"),_t=s.paint.get(`${tt}-use-theme`),Rt=tt==="line-dasharray"&&s.layout.get("line-cap").value.kind!=="constant"||_t&&_t.value.kind!=="constant";if(ct.kind!=="constant"||Rt)if(ct.kind==="source"||Rt||gt){const Pt=g(tt,ht,"source");this.binders[tt]=gt?new zp(ct,ot,ht,Pt,s.id):new xm(ct,ot,ht,Pt),j.push(`/a_${tt}`)}else{const Pt=g(tt,ht,"composite");this.binders[tt]=new Op(ct,ot,ht,mt,a,Pt),j.push(`/z_${tt}`)}else this.binders[tt]=gt?new Km(ct.value,ot):new Nu(ct.value,ot,ht,a),j.push(`/u_${tt}`);_t&&(this.binders[tt].lutExpression=_t.value)}this.cacheKey=j.sort().join("")}getMaxValue(s){const a=this.binders[s];return a instanceof xm||a instanceof Op?a.maxValue:0}populatePaintArrays(s,a,_,j,tt,rt,ot,ct){for(const ht in this.binders){const mt=this.binders[ht];mt.context=this.context,(mt instanceof xm||mt instanceof Op||mt instanceof zp)&&mt.populatePaintArray(s,a,_,j,tt,rt,ot,ct)}}setConstantPatternPositions(s,a){for(const _ in this.binders){const j=this.binders[_];j instanceof Km&&j.setConstantPatternPositions(s,a)}}getPatternTransitionVertexBuffer(s){const a=this.binders[s];return a instanceof zp?a.paintTransitionVertexBuffer:null}updatePaintArrays(s,a,_,j,tt,rt,ot,ct,ht,mt){let gt=!1;const _t=Object.keys(s),Rt=_t.length!==0&&!ct,Pt=Rt?_t:a.uniqueIds;this.context.lut=tt.lut;for(const zt in this.binders){const Vt=this.binders[zt];if(Vt.context=this.context,(Vt instanceof xm||Vt instanceof Op||Vt instanceof zp)&&Vt.expression&&Vt.expression.kind&&Vt.expression.kind!=="constant"&&(Vt.expression.isStateDependent===!0||Vt.expression.isLightConstant===!1)){const Gt=tt.paint.get(zt);Vt.expression=Gt.value;for(const _i of Pt){const er=s[_i.toString()];a.eachPosition(_i,(rr,_r,xr)=>{const Er=j.feature(rr);Vt.updatePaintArray(_r,xr,Er,er,rt,ot,ht,mt)})}if(!Rt)for(const _i of _.uniqueIds){const er=s[_i.toString()];_.eachPosition(_i,(rr,_r,xr)=>{const Er=j.feature(rr);Vt.updatePaintArray(_r,xr,Er,er,rt,ot,ht,mt)})}gt=!0}}return gt}defines(){const s=[];for(const a in this.binders){const _=this.binders[a];(_ instanceof Nu||_ instanceof Km)&&s.push(..._.uniformNames.map(j=>`#define HAS_UNIFORM_${j}`))}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s){const a=[];for(const _ in this.binders){const j=this.binders[_];if(j instanceof Nu||j instanceof Km||j instanceof Op)for(const tt of j.uniformNames)a.push({name:tt,property:_,binding:j.getBinding(s,tt)})}return a}setUniforms(s,a,_,j,tt){for(const{name:rt,property:ot,binding:ct}of _)this.binders[ot].setUniform(s,ct,tt,j.get(ot),rt)}updatePaintBuffers(){this._buffers=[];for(const s in this.binders){const a=this.binders[s];(a instanceof xm||a instanceof Op||a instanceof zp)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof zp&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(s){for(const a in this.binders){const _=this.binders[a];(_ instanceof xm||_ instanceof Op||_ instanceof zp)&&_.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const a=this.binders[s];(a instanceof xm||a instanceof Op||a instanceof zp)&&a.destroy()}}}class lp{constructor(s,a,_=()=>!0){this.programConfigurations={};for(const j of s)this.programConfigurations[j.id]=new Ym(j,a,_);this.needsUpload=!1,this._featureMap=new m_,this._featureMapWithoutIds=new m_,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(s,a,_,j,tt,rt,ot,ct,ht){for(const mt in this.programConfigurations)this.programConfigurations[mt].populatePaintArrays(s,a,j,tt,rt,ot,ct,ht);a.id!==void 0?this._featureMap.add(a.id,_,this._bufferOffset,s):(this._featureMapWithoutIds.add(this._idlessCounter,_,this._bufferOffset,s),this._idlessCounter+=1),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,a,_,j,tt,rt,ot,ct){for(const ht of _)this.needsUpload=this.programConfigurations[ht.id].updatePaintArrays(s,this._featureMap,this._featureMapWithoutIds,a,ht,j,tt,rt,ot||0,ct)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}const x1={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function dT(d,s){return x1[d]||[d.replace(`${s}-`,"").replace(/-/g,"_")]}const et={"line-pattern":{source:_m,composite:_m},"fill-pattern":{source:_m,composite:_m},"fill-extrusion-pattern":{source:_m,composite:_m},"line-dasharray":{source:ky,composite:ky}},o={color:{source:jy,composite:ap},number:{source:ym,composite:jy}};function g(d,s,a){const _=et[d];return _&&_[a]||o[s][a]}Fn(Nu,"ConstantBinder"),Fn(Km,"PatternConstantBinder"),Fn(xm,"SourceExpressionBinder"),Fn(zp,"PatternCompositeBinder"),Fn(Op,"CompositeExpressionBinder"),Fn(Ym,"ProgramConfiguration",{omit:["_buffers"]}),Fn(lp,"ProgramConfigurationSet");const _e=Rn/Math.PI/2,nt=5,st=6,lt=16383,ut=64,pt=[ut,32,16],yt=-_e,vt=_e;function Mt(d,s,a,_=_e){return a=Lr(a),[d*Math.sin(a)*_,-s*_,d*Math.cos(a)*_]}function Et(d,s,a){return Mt(Math.cos(Lr(d)),Math.sin(Lr(d)),s,a)}const Lt=63710088e-1,Ft=2*Math.PI*Lt;class Ot{constructor(s,a){if(isNaN(s)||isNaN(a))throw new Error(`Invalid LngLat object: (${s}, ${a})`);if(this.lng=+s,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ot(Rr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const a=Math.PI/180,_=this.lat*a,j=s.lat*a,tt=Math.sin(_)*Math.sin(j)+Math.cos(_)*Math.cos(j)*Math.cos((s.lng-this.lng)*a);return Lt*Math.acos(Math.min(tt,1))}toBounds(s=0){const a=360*s/40075017,_=a/Math.cos(Math.PI/180*this.lat);return new qt({lng:this.lng-_,lat:this.lat-a},{lng:this.lng+_,lat:this.lat+a})}toEcef(s){return Et(this.lat,this.lng,_e+s*_e/Lt)}static convert(s){if(s instanceof Ot)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new Ot(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new Ot(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class qt{constructor(s,a){s&&(a?this.setSouthWest(s).setNorthEast(a):Array.isArray(s)&&s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1]))}setNorthEast(s){return this._ne=s instanceof Ot?new Ot(s.lng,s.lat):Ot.convert(s),this}setSouthWest(s){return this._sw=s instanceof Ot?new Ot(s.lng,s.lat):Ot.convert(s),this}extend(s){const a=this._sw,_=this._ne;let j,tt;if(s instanceof Ot)j=s,tt=s;else{if(!(s instanceof qt))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(qt.convert(s)):this.extend(Ot.convert(s)):typeof s=="object"&&s!==null&&s.hasOwnProperty("lat")&&(s.hasOwnProperty("lon")||s.hasOwnProperty("lng"))?this.extend(Ot.convert(s)):this;if(j=s._sw,tt=s._ne,!j||!tt)return this}return a||_?(a.lng=Math.min(j.lng,a.lng),a.lat=Math.min(j.lat,a.lat),_.lng=Math.max(tt.lng,_.lng),_.lat=Math.max(tt.lat,_.lat)):(this._sw=new Ot(j.lng,j.lat),this._ne=new Ot(tt.lng,tt.lat)),this}getCenter(){return new Ot((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ot(this.getWest(),this.getNorth())}getSouthEast(){return new Ot(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:a,lat:_}=Ot.convert(s);let j=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(j=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&j}static convert(s){if(s)return s instanceof qt?s:new qt(s)}}const $t=0,Yt=25.5;function tr(d){return Ft*Math.cos(d*Math.PI/180)}function sr(d){return(180+d)/360}function pr(d){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d*Math.PI/360)))/360}function hr(d,s){return d/tr(s)}function gr(d){return 360*d-180}function dr(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function ur(d,s){return d*tr(dr(s))}const yr=85.051129;function Vr(d){return Math.cos(Lr(fr(d,-yr,yr)))}function Ir(d,s){const a=fr(s,$t,Yt),_=Math.pow(2,a);return Vr(d)*Ft/(512*_)}function Qr(d){return 1/Math.cos(d*Math.PI/180)}function Nr(d,s=0){const a=Math.exp(Math.PI*(1-(d.y+s/Rn)/(1<<d.z)*2));return 80150034*a/(a*a+1)/Rn/(1<<d.z)}class Yr{constructor(s,a,_=0){this.x=+s,this.y=+a,this.z=+_}static fromLngLat(s,a=0){const _=Ot.convert(s);return new Yr(sr(_.lng),pr(_.lat),hr(a,_.lat))}toLngLat(){return new Ot(gr(this.x),dr(this.y))}toAltitude(){return ur(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ft*Qr(dr(this.y))}}function Cn(d,s,a,_,j,tt,rt,ot,ct){const ht=(s+_)/2,mt=(a+j)/2,gt=new yn(ht,mt);ot(gt),function(_t,Rt,Pt,zt,Vt,Gt){const _i=Pt-Vt,er=zt-Gt;return Math.abs((zt-Rt)*_i-(Pt-_t)*er)/Math.hypot(_i,er)}(gt.x,gt.y,tt.x,tt.y,rt.x,rt.y)>=ct?(Cn(d,s,a,ht,mt,tt,gt,ot,ct),Cn(d,ht,mt,_,j,gt,rt,ot,ct)):d.push(rt)}function Br(d,s,a){let _=d[0],j=_.x,tt=_.y;s(_);const rt=[_];for(let ot=1;ot<d.length;ot++){const ct=d[ot],{x:ht,y:mt}=ct;s(ct),Cn(rt,j,tt,ht,mt,_,ct,s,a),j=ht,tt=mt,_=ct}return rt}function Tr(d,s,a,_){if(_(s,a)){const j=s.add(a)._mult(.5);Tr(d,s,j,_),Tr(d,j,a,_)}else d.push(a)}function en(d,s){let a=d[0];const _=[a];for(let j=1;j<d.length;j++){const tt=d[j];Tr(_,a,tt,s),a=tt}return _}const Hr=Math.pow(2,14)-1,un=-Hr-1;function Tn(d,s){const a=Math.round(d.x*s),_=Math.round(d.y*s);return d.x=fr(a,un,Hr),d.y=fr(_,un,Hr),(a<d.x||a>d.x+1||_<d.y||_>d.y+1)&&Es("Geometry exceeds allowed extent, reduce your vector tile buffer size"),d}function Ln(d,s,a){const _=d.loadGeometry(),j=d.extent,tt=Rn/j;if(s&&a&&a.projection.isReprojectedInTileSpace){const rt=1<<s.z,{scale:ot,x:ct,y:ht,projection:mt}=a,gt=_t=>{const Rt=gr((s.x+_t.x/j)/rt),Pt=dr((s.y+_t.y/j)/rt),zt=mt.project(Rt,Pt);_t.x=(zt.x*ot-ct)*j,_t.y=(zt.y*ot-ht)*j};for(let _t=0;_t<_.length;_t++)if(d.type!==1)_[_t]=Br(_[_t],gt,1);else{const Rt=[];for(const Pt of _[_t])Pt.x<0||Pt.x>=j||Pt.y<0||Pt.y>=j||(gt(Pt),Rt.push(Pt));_[_t]=Rt}}for(const rt of _)for(const ot of rt)Tn(ot,tt);return _}function xn(d,s){return{type:d.type,id:d.id,properties:d.properties,geometry:s?Ln(d):[]}}class mn{constructor(s,a,_,j,tt){this.properties={},this.extent=_,this.type=0,this.id=void 0,this._pbf=s,this._geometry=-1,this._keys=j,this._values=tt,s.readFields(Xn,this,a)}loadGeometry(){const s=this._pbf;s.pos=this._geometry;const a=s.readVarint()+s.pos,_=[];let j,tt=1,rt=0,ot=0,ct=0;for(;s.pos<a;){if(rt<=0){const ht=s.readVarint();tt=7&ht,rt=ht>>3}if(rt--,tt===1||tt===2)ot+=s.readSVarint(),ct+=s.readSVarint(),tt===1&&(j&&_.push(j),j=[]),j&&j.push(new yn(ot,ct));else{if(tt!==7)throw new Error(`unknown command ${tt}`);j&&j.push(j[0].clone())}}return j&&_.push(j),_}bbox(){const s=this._pbf;s.pos=this._geometry;const a=s.readVarint()+s.pos;let _=1,j=0,tt=0,rt=0,ot=1/0,ct=-1/0,ht=1/0,mt=-1/0;for(;s.pos<a;){if(j<=0){const gt=s.readVarint();_=7&gt,j=gt>>3}if(j--,_===1||_===2)tt+=s.readSVarint(),rt+=s.readSVarint(),tt<ot&&(ot=tt),tt>ct&&(ct=tt),rt<ht&&(ht=rt),rt>mt&&(mt=rt);else if(_!==7)throw new Error(`unknown command ${_}`)}return[ot,ht,ct,mt]}toGeoJSON(s,a,_){const j=this.extent*Math.pow(2,_),tt=this.extent*s,rt=this.extent*a,ot=this.loadGeometry();function ct(_t){return[360*(_t.x+tt)/j-180,360/Math.PI*Math.atan(Math.exp((1-2*(_t.y+rt)/j)*Math.PI))-90]}function ht(_t){return _t.map(ct)}let mt;if(this.type===1){const _t=[];for(const Pt of ot)_t.push(Pt[0]);const Rt=ht(_t);mt=_t.length===1?{type:"Point",coordinates:Rt[0]}:{type:"MultiPoint",coordinates:Rt}}else if(this.type===2){const _t=ot.map(ht);mt=_t.length===1?{type:"LineString",coordinates:_t[0]}:{type:"MultiLineString",coordinates:_t}}else{if(this.type!==3)throw new Error("unknown feature type");{const _t=function(Pt){const zt=Pt.length;if(zt<=1)return[Pt];const Vt=[];let Gt,_i;for(let er=0;er<zt;er++){const rr=Gn(Pt[er]);rr!==0&&(_i===void 0&&(_i=rr<0),_i===rr<0?(Gt&&Vt.push(Gt),Gt=[Pt[er]]):Gt&&Gt.push(Pt[er]))}return Gt&&Vt.push(Gt),Vt}(ot),Rt=[];for(const Pt of _t)Rt.push(Pt.map(ht));mt=Rt.length===1?{type:"Polygon",coordinates:Rt[0]}:{type:"MultiPolygon",coordinates:Rt}}}const gt={type:"Feature",geometry:mt,properties:this.properties};return this.id!=null&&(gt.id=this.id),gt}}function Xn(d,s,a){d===1?s.id=a.readVarint():d===2?function(_,j){const tt=_.readVarint()+_.pos;for(;_.pos<tt;){const rt=j._keys[_.readVarint()],ot=j._values[_.readVarint()];j.properties[rt]=ot}}(a,s):d===3?s.type=a.readVarint():d===4&&(s._geometry=a.pos)}function Gn(d){let s=0;for(let a,_,j=0,tt=d.length,rt=tt-1;j<tt;rt=j++)a=d[j],_=d[rt],s+=(_.x-a.x)*(a.y+_.y);return s}mn.types=["Unknown","Point","LineString","Polygon"];class Wn{constructor(s,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Un,this,a),this.length=this._features.length}feature(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];const a=this._pbf.readVarint()+this._pbf.pos;return new mn(this._pbf,a,this.extent,this._keys,this._values)}}function Un(d,s,a){d===15?s.version=a.readVarint():d===1?s.name=a.readString():d===5?s.extent=a.readVarint():d===2?s._features.push(a.pos):d===3?s._keys.push(a.readString()):d===4&&s._values.push(function(_){let j=null;const tt=_.readVarint()+_.pos;for(;_.pos<tt;){const rt=_.readVarint()>>3;j=rt===1?_.readString():rt===2?_.readFloat():rt===3?_.readDouble():rt===4?_.readVarint64():rt===5?_.readVarint():rt===6?_.readSVarint():rt===7?_.readBoolean():null}if(j==null)throw new Error("unknown feature value");return j}(a))}class hs{constructor(s,a){this.layers=s.readFields(vs,{},a)}}function vs(d,s,a){if(d===3){const _=new Wn(a,a.readVarint()+a.pos);_.length&&(s[_.name]=_)}}const Ts="3d_elevation_id",no="level";class fs{constructor(){this._valid=!1}reset(s){return this.feature=s,this._valid=!0,this._geometry=s.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(s,a){return this._valid&&s(a(this._geometry)),this}require(s,a,_){return this.get(s,!0,a,_)}optional(s,a,_){return this.get(s,!1,a,_)}success(){return this._valid}get(s,a,_,j){const tt=this.feature.properties.hasOwnProperty(s)?+this.feature.properties[s]:void 0;return this._valid&&tt!==void 0&&!Number.isNaN(tt)?_(j?j(tt):tt):a&&(this._valid=!1),this}}class qs{constructor(s,a){this.featureFunc=s,this.vertexFunc=a}parseFeature(s,a,_){return this.featureFunc(s,a,_)}parseVertex(s,a,_){return this.vertexFunc(s,a,_)}}const io=new qs((d,s,a)=>d.reset(s).require(Ts,_=>{a.id=_}).optional("fixed_height_relative",_=>{a.constantHeight=_},bs.decodeRelativeHeight).geometry(_=>{a.bounds=_},D_).success(),(d,s,a)=>d.reset(s).require(Ts,_=>{a.id=_}).require("elevation_idx",_=>{a.idx=_}).require("extent",_=>{a.extent=_}).require("height_relative",_=>{a.height=_},bs.decodeRelativeHeight).geometry(_=>{a.position=_},bs.getPoint).success()),Ao=new qs((d,s,a)=>d.reset(s).require(Ts,_=>{a.id=_}).optional("fixed_height",_=>{a.constantHeight=_},bs.decodeMetricHeight).geometry(_=>{a.bounds=_},D_).success(),(d,s,a)=>d.reset(s).require(Ts,_=>{a.id=_}).require("elevation_idx",_=>{a.idx=_}).require("extent",_=>{a.extent=_}).require("height",_=>{a.height=_},bs.decodeMetricHeight).geometry(_=>{a.position=_},bs.getPoint).success());class bs{static getPoint(s){return bu(s[0][0].x,s[0][0].y)}static decodeRelativeHeight(s){return 1e-4*s*5}static decodeMetricHeight(s){return 1e-4*s}static getVersionSchema(s){return s?s==="1.0.1"?Ao:void 0:io}static parse(s){const a=[],_=[],j=s.length,tt=new fs;for(let rt=0;rt<j;rt++){const ot=s.feature(rt),ct=ot.properties.version,ht=bs.getVersionSchema(ct);if(ht===void 0){Es(`Unknown elevation feature version number ${ct||"(unknown)"}`);continue}const mt=ot.properties.type;if(!mt)continue;const gt=mn.types[ot.type];if(gt==="Point"&&mt==="curve_point"){const _t={};ht.parseVertex(tt,ot,_t)&&a.push(_t)}else if(gt==="Polygon"&&mt==="curve_meta"){const _t={};ht.parseFeature(tt,ot,_t)&&_.push(_t)}}return{vertices:a,features:_}}}class Qs{constructor(s,a){this.pos=s,this.dir=a}intersectsPlane(s,a,_){const j=Qo(a,this.dir);if(Math.abs(j)<1e-6)return!1;const tt=((s[0]-this.pos[0])*a[0]+(s[1]-this.pos[1])*a[1])/j;return _[0]=this.pos[0]+this.dir[0]*tt,_[1]=this.pos[1]+this.dir[1]*tt,!0}}class Xs{constructor(s,a){this.pos=s,this.dir=a}intersectsPlane(s,a,_){const j=Ls(a,this.dir);if(Math.abs(j)<1e-6)return!1;const tt=((s[0]-this.pos[0])*a[0]+(s[1]-this.pos[1])*a[1]+(s[2]-this.pos[2])*a[2])/j;return _[0]=this.pos[0]+this.dir[0]*tt,_[1]=this.pos[1]+this.dir[1]*tt,_[2]=this.pos[2]+this.dir[2]*tt,!0}closestPointOnSphere(s,a,_){if(function(Rt,Pt){var zt=Rt[0],Vt=Rt[1],Gt=Rt[2],_i=Pt[0],er=Pt[1],rr=Pt[2];return Math.abs(zt-_i)<=dt*Math.max(1,Math.abs(zt),Math.abs(_i))&&Math.abs(Vt-er)<=dt*Math.max(1,Math.abs(Vt),Math.abs(er))&&Math.abs(Gt-rr)<=dt*Math.max(1,Math.abs(Gt),Math.abs(rr))}(this.pos,s)||a===0)return _[0]=_[1]=_[2]=0,!1;const[j,tt,rt]=this.dir,ot=this.pos[0]-s[0],ct=this.pos[1]-s[1],ht=this.pos[2]-s[2],mt=j*j+tt*tt+rt*rt,gt=2*(ot*j+ct*tt+ht*rt),_t=gt*gt-4*mt*(ot*ot+ct*ct+ht*ht-a*a);if(_t<0){const Rt=Math.max(-gt/2,0),Pt=ot+j*Rt,zt=ct+tt*Rt,Vt=ht+rt*Rt,Gt=Math.hypot(Pt,zt,Vt);return _[0]=Pt*a/Gt,_[1]=zt*a/Gt,_[2]=Vt*a/Gt,!1}{const Rt=(-gt-Math.sqrt(_t))/(2*mt);if(Rt<0){const Pt=Math.hypot(ot,ct,ht);return _[0]=ot*a/Pt,_[1]=ct*a/Pt,_[2]=ht*a/Pt,!1}return _[0]=ot+j*Rt,_[1]=ct+tt*Rt,_[2]=ht+rt*Rt,!0}}}class to{constructor(s,a,_,j,tt){this.TL=s,this.TR=a,this.BR=_,this.BL=j,this.horizon=tt}static fromInvProjectionMatrix(s,a,_){const j=[-1,1,1],tt=[1,1,1],rt=[1,-1,1],ot=[-1,-1,1],ct=Vs(j,j,s),ht=Vs(tt,tt,s),mt=Vs(rt,rt,s),gt=Vs(ot,ot,s);return new to(ct,ht,mt,gt,a/_)}}function ko(d,s,a){let _=1/0,j=-1/0;const tt=[];for(const rt of d){Hs(tt,rt,s);const ot=Ls(tt,a);_=Math.min(_,ot),j=Math.max(j,ot)}return[_,j]}function Ko(d,s){let a=!0;for(let _=0;_<d.planes.length;_++){const j=d.planes[_];let tt=0;for(let rt=0;rt<s.length;rt++)tt+=+(Ls(j,s[rt])+j[3]>=0);if(tt===0)return 0;tt!==s.length&&(a=!1)}return a?2:1}function zl(d,s){for(const a of d.projections){const _=ko(s,d.points[0],a.axis);if(a.projection[1]<_[0]||a.projection[0]>_[1])return 0}return 1}function Do(d,s){let a=0;const _=[0,0,0,0];for(let rt=0;rt<d.length;rt++)_[0]=d[rt][0],_[1]=d[rt][1],_[2]=d[rt][2],_[3]=1,(j=_)[0]*(tt=s)[0]+j[1]*tt[1]+j[2]*tt[2]+j[3]*tt[3]>=0&&a++;var j,tt;return a}class Ss{constructor(s,a){this.points=s||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=cs.fromPoints(this.points),this.projections=[],this.frustumEdges=[Hs([],this.points[2],this.points[3]),Hs([],this.points[0],this.points[3]),Hs([],this.points[4],this.points[0]),Hs([],this.points[5],this.points[1]),Hs([],this.points[6],this.points[2]),Hs([],this.points[7],this.points[3])];for(const _ of this.frustumEdges){const j=[0,-_[2],_[1]],tt=[_[2],0,-_[0]];this.projections.push({axis:j,projection:ko(this.points,this.points[0],j)}),this.projections.push({axis:tt,projection:ko(this.points,this.points[0],tt)})}}static fromInvProjectionMatrix(s,a,_,j){const tt=Math.pow(2,_),rt=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(ht=>{const mt=Uo([],ht,s),gt=1/mt[3]/a*tt;return(_t=mt)[0]=(Rt=mt)[0]*(Pt=[gt,gt,j?1/mt[3]:gt,gt])[0],_t[1]=Rt[1]*Pt[1],_t[2]=Rt[2]*Pt[2],_t[3]=Rt[3]*Pt[3],_t;var _t,Rt,Pt}),ot=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(ht=>{const mt=ss([],$s([],Hs([],rt[ht[0]],rt[ht[1]]),Hs([],rt[ht[2]],rt[ht[1]]))),gt=-Ls(mt,rt[ht[1]]);return mt.concat(gt)}),ct=[];for(let ht=0;ht<rt.length;ht++)ct.push([rt[ht][0],rt[ht][1],rt[ht][2]]);return new Ss(ct,ot)}intersectsPrecise(s,a,_){for(let j=0;j<a.length;j++)if(!Do(s,a[j]))return 0;for(let j=0;j<this.planes.length;j++)if(!Do(s,this.planes[j]))return 0;for(const j of _)for(const tt of this.frustumEdges){const rt=$s([],j,tt),ot=rn(rt);if(ot===0)continue;Cr(rt,rt,1/ot);const ct=ko(this.points,this.points[0],rt),ht=ko(s,this.points[0],rt);if(ct[0]>ht[1]||ht[0]>ct[1])return 0}return 1}containsPoint(s){for(const a of this.planes){const _=a[3];if(Ls([a[0],a[1],a[2]],s)+_<0)return!1}return!0}}class cs{static fromPoints(s){const a=[1/0,1/0,1/0],_=[-1/0,-1/0,-1/0];for(const j of s)Jt(a,a,j),Or(_,_,j);return new cs(a,_)}static fromTileIdAndHeight(s,a,_){const j=1<<s.canonical.z,tt=s.canonical.x,rt=s.canonical.y;return new cs([tt/j,rt/j,a],[(tt+1)/j,(rt+1)/j,_])}static applyTransform(s,a){const _=s.getCorners();for(let j=0;j<_.length;++j)Vs(_[j],_[j],a);return cs.fromPoints(_)}static applyTransformFast(s,a){const _=[a[12],a[13],a[14]],j=[..._];for(let tt=0;tt<3;tt++)for(let rt=0;rt<3;rt++){const ot=a[4*rt+tt],ct=ot*s.min[rt],ht=ot*s.max[rt];_[tt]+=Math.min(ct,ht),j[tt]+=Math.max(ct,ht)}return new cs(_,j)}static projectAabbCorners(s,a){const _=s.getCorners();for(let j=0;j<_.length;++j)Vs(_[j],_[j],a);return _}constructor(s,a){this.min=s,this.max=a,this.center=Cr([],Xt([],this.min,this.max),.5)}quadrant(s){const a=[s%2==0,s<2],_=$r(this.min),j=$r(this.max);for(let tt=0;tt<a.length;tt++)_[tt]=a[tt]?this.min[tt]:this.center[tt],j[tt]=a[tt]?this.center[tt]:this.max[tt];return j[2]=this.max[2],new cs(_,j)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}distanceZ(s){return Math.max(Math.min(this.max[2],s[2]),this.min[2])-s[2]}getCorners(){const s=this.min,a=this.max;return[[s[0],s[1],s[2]],[a[0],s[1],s[2]],[a[0],a[1],s[2]],[s[0],a[1],s[2]],[s[0],s[1],a[2]],[a[0],s[1],a[2]],[a[0],a[1],a[2]],[s[0],a[1],a[2]]]}intersects(s){return this.intersectsAabb(s.bounds)?Ko(s,this.getCorners()):0}intersectsFlat(s){return this.intersectsAabb(s.bounds)?Ko(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(s,a){return a||this.intersects(s)?zl(s,this.getCorners()):0}intersectsPreciseFlat(s,a){return a||this.intersectsFlat(s)?zl(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(s){for(let a=0;a<3;++a)if(this.min[a]>s.max[a]||s.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(s){return!(this.min[0]>s.max[0]||s.min[0]>this.max[0]||this.min[1]>s.max[1]||s.min[1]>this.max[1])}encapsulate(s){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],s.min[a]),this.max[a]=Math.max(this.max[a],s.max[a])}encapsulatePoint(s){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],s[a]),this.max[a]=Math.max(this.max[a],s[a])}closestPoint(s){return[Math.max(Math.min(this.max[0],s[0]),this.min[0]),Math.max(Math.min(this.max[1],s[1]),this.min[1]),Math.max(Math.min(this.max[2],s[2]),this.min[2])]}}Fn(cs,"Aabb");class so{constructor(s,a){this.feature=s,this.metersToTile=a,this.index=0}get(){const s=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,_=a[1],j=-a[0],tt=(s.extent+1)*this.metersToTile;return[new yn(Math.trunc(s.position[0]+_*tt),Math.trunc(s.position[1]+j*tt)),new yn(Math.trunc(s.position[0]-_*tt),Math.trunc(s.position[1]-j*tt))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Ho{constructor(s,a,_,j,tt,rt){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Ol(),Ol(),Ol(),Ol(),Ol(),Ol(),Ol()],this.id=s,this.heightRange={min:_,max:_},this.safeArea=a,this.constantHeight=_,this.constantHeight==null&&(this.constantHeight!=null||j.length!==0)){this.vertices=j,this.edges=tt,this.edges=this.edges.filter(ot=>{return ot.a<this.vertices.length&&ot.b<this.vertices.length&&!((ct=this.vertices[ot.a].position)[0]===(ht=this.vertices[ot.b].position)[0]&&ct[1]===ht[1]);var ct,ht}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const ot of this.vertices)this.vertexProps.push({dir:bu(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,ot.height),this.heightRange.max=Math.max(this.heightRange.max,ot.height);for(const ot of this.edges){const ct=this.vertices[ot.a].position,ht=this.vertices[ot.b].position,mt=ku(Ol(),ht,ct),gt=dp(mt),_t=_d(Ol(),mt,1/gt);this.edgeProps.push({vec:mt,dir:_t,len:gt});const Rt=this.vertexProps[ot.a].dir,Pt=this.vertexProps[ot.b].dir;Hu(Rt,Rt,_t),Hu(Pt,Pt,_t)}for(const ot of this.vertexProps)ot.dir[0]===0&&ot.dir[1]===0||So(ot.dir,ot.dir);this.tessellate(rt)}}pointElevation(s){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(s);if(a==null)return 0;const[_,j]=a;return ns(this.vertices[this.edges[_].a].height,this.vertices[this.edges[_].b].height,j)}computeSlopeNormal(s,a){const _=this.getClosestEdge(s);if(!_)return Zr(0,0,1);const j=_[0],tt=this.edges[j],rt=this.edgeProps[j].vec,ot=Zr(rt[0],rt[1],(this.vertices[tt.b].height-this.vertices[tt.a].height)*a),ct=Zr(ot[1],-ot[0],0);$s(ct,ct,ot);const ht=rn(ct);return ht>0?Cr(ct,ct,1/ht):Kr(ct,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(s){if(this.edges.length===0)return;let a=0,_=Number.POSITIVE_INFINITY,j=0;const[tt,rt,ot,ct,ht,mt,gt]=this._tmpVec2;_h(gt,s.x,s.y);const _t=new Qs(gt,null);for(let Rt=0;Rt<this.edges.length;Rt++){const Pt=this.edges[Rt],zt=this.edgeProps[Rt].dir;_t.dir=zt;const Vt=this.vertices[Pt.a].position,Gt=this.vertices[Pt.b].position,_i=_t.intersectsPlane(Vt,this.vertexProps[Pt.a].dir,tt),er=_t.intersectsPlane(Gt,this.vertexProps[Pt.b].dir,rt);if(!_i||!er)continue;ku(ot,rt,tt),ku(ct,gt,tt);const rr=Qo(ot,ot),_r=rr>0?Qo(ct,ot)/rr:0,xr=fr(_r,0,1),Er=Math.abs((_r-xr)*this.edgeProps[Rt].len);ku(ht,gt,Vt),_h(mt,zt[1],-zt[0]);const Ar=Er+Math.abs(Qo(ht,mt));Ar<_&&(a=Rt,_=Ar,j=xr)}return[a,j]}tessellate(s){const a=Sr(),_=Sr(),j=Sr(),tt=Sr();for(let rt=this.edges.length-1;rt>=0;--rt){const ot=this.edges[rt].a,ct=this.edges[rt].b,{position:ht,height:mt,extent:gt}=this.vertices[ot],{position:_t,height:Rt,extent:Pt}=this.vertices[ct],zt=this.vertexProps[ot].dir,Vt=this.vertexProps[ct].dir;if(Kr(a,ht[0]/s,ht[1]/s,mt),Kr(_,_t[0]/s,_t[1]/s,Rt),Kr(j,zt[1],-zt[0],0),Cr(j,j,gt),Kr(tt,Vt[1],-Vt[0],0),Cr(tt,tt,Pt),this.distSqLines(Zr(a[0]+.5*j[0],a[1]+.5*j[1],a[2]+.5*j[2]),Zr(_[0]-.5*tt[0],_[1]-.5*tt[1],_[2]-.5*tt[2]),Zr(a[0]-.5*j[0],a[1]-.5*j[1],a[2]-.5*j[2]),Zr(_[0]+.5*tt[0],_[1]+.5*tt[1],_[2]+.5*tt[2]))<=.0025000000000000005)continue;const Gt=this.vertices.length,_i=Hu(Ol(),ht,_t);this.vertices.push({position:_d(_i,_i,.5),height:.5*(mt+Rt),extent:.5*(gt+Pt)});const er=Hu(Ol(),zt,Vt);this.vertexProps.push({dir:So(er,er)}),this.edges.splice(rt,1),this.edgeProps.splice(rt,1),this.edges.push({a:ot,b:Gt}),this.edges.push({a:Gt,b:ct});const rr=ku(Ol(),this.vertices[Gt].position,ht),_r=dp(rr),xr={vec:rr,dir:_d(Ol(),rr,1/_r),len:_r};this.edgeProps.push(xr),this.edgeProps.push(xr)}}distSqLines(s,a,_,j){const tt=mr(Sr(),a,s),rt=mr(Sr(),j,_),ot=mr(Sr(),s,_),ct=Ls(tt,tt),ht=Ls(tt,rt),mt=Ls(tt,ot),gt=Ls(rt,rt),_t=Ls(rt,ot),Rt=ct*gt-ht*ht;if(Rt===0)return On(vo(tt,_,j,Ls(ot,rt)/Ls(rt,rt)),s);const Pt=(ct*_t-ht*mt)/Rt;return On(vo(tt,s,a,(ht*_t-mt*gt)/Rt),vo(rt,_,j,Pt))}}class Fo{static parseFrom(s,a){const _=bs.parse(s);if(!_)return[];let{vertices:j,features:tt}=_;const rt=1/Nr(a);tt.sort((mt,gt)=>mt.id-gt.id),j.sort((mt,gt)=>mt.id-gt.id||mt.idx-gt.idx),j=j.filter((mt,gt,_t)=>gt===_t.findIndex(Rt=>Rt.id===mt.id&&Rt.idx===mt.idx));const ot=new Array;let ct=0;const ht=j.length;for(const mt of tt){if(mt.constantHeight){ot.push(new Ho(mt.id,mt.bounds,mt.constantHeight));continue}for(;ct!==ht&&j[ct].id<mt.id;)ct++;if(ct===ht||j[ct].id!==mt.id)continue;const gt=new Array,_t=new Array,Rt=ct;for(;ct!==ht&&j[ct].id===mt.id;){const Pt=j[ct];if(gt.push({position:Pt.position,height:Pt.height,extent:Pt.extent}),ct!==Rt&&j[ct-1].idx===Pt.idx-1){const zt=ct-Rt;_t.push({a:zt-1,b:zt})}ct++}ot.push(new Ho(mt.id,mt.bounds,void 0,gt,_t,rt))}return ot}static getElevationFeature(s,a){if(!a)return;const _=+s.properties[Ts];return Number.isNaN(_)?void 0:a.find(j=>j.id===_)}}class yl{constructor(s,a){this.zScale=1,this.xOffset=0,this.yOffset=0,s.equals(a)||(this.zScale=Math.pow(2,a.z-s.z),this.xOffset=(s.x*this.zScale-a.x)*Rn,this.yOffset=(s.y*this.zScale-a.y)*Rn)}constantElevation(s,a){if(s.constantHeight!=null)return this.computeBiasedHeight(s.constantHeight,a)}pointElevation(s,a,_){const j=this.constantElevation(a,_);return j??(s.x=s.x*this.zScale+this.xOffset,s.y=s.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(s),_))}computeBiasedHeight(s,a){return a<=0?s:s+a*Ur(0,a,s>=0?s:Math.abs(.5*s))}}Fn(Ho,"ElevationFeature");class Wl{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.projection=s.projection,this.layoutVertexArray=new gm,this.indexArray=new Dl,this.segments=new Bo,this.programConfigurations=new lp(s.layers,{zoom:s.zoom,lut:s.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new ym),this.worldview=s.worldview}updateFootprints(s,a){}populate(s,a,_,j){const tt=this.layers[0],rt=[];let ot=null;tt.type==="circle"&&(ot=tt.layout.get("circle-sort-key"));for(const{feature:ht,id:mt,index:gt,sourceLayerIndex:_t}of s){const Rt=this.layers[0]._featureFilter.needGeometry,Pt=xn(ht,Rt);if(!this.layers[0]._featureFilter.filter(new yo(this.zoom,{worldview:this.worldview}),Pt,_))continue;const zt=ot?ot.evaluate(Pt,{},_):void 0,Vt={id:mt,properties:ht.properties,type:ht.type,sourceLayerIndex:_t,index:gt,geometry:Rt?Pt.geometry:Ln(ht,_,j),patterns:{},sortKey:zt};rt.push(Vt)}ot&&rt.sort((ht,mt)=>ht.sortKey-mt.sortKey);let ct=null;j.projection.name==="globe"&&(this.globeExtVertexArray=new vx,ct=j.projection);for(const ht of rt){const{geometry:mt,index:gt,sourceLayerIndex:_t}=ht,Rt=s[gt].feature;this.addFeature(ht,mt,gt,a.availableImages,_,ct,a.brightness,a.elevationFeatures),a.featureIndex.insert(Rt,mt,gt,_t,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(s,a,_,j,tt,rt,ot){this.programConfigurations.updatePaintArrays(s,a,tt,_,j,rt,ot,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Uw.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,$w.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=s.createVertexBuffer(this.elevatedLayoutVertexArray,Gw.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(s,a,_,j,tt,rt,ot,ct){let ht;this.elevationMode!=="none"&&(ht=Fo.getElevationFeature(s,ct));for(const mt of a)for(const gt of mt){const _t=gt.x,Rt=gt.y;if(_t<0||_t>=Rn||Rt<0||Rt>=Rn)continue;if(rt){const Vt=rt.projectTilePoint(_t,Rt,tt),Gt=rt.upVector(tt,_t,Rt);this.addGlobeExtVertex(Vt,Gt),this.addGlobeExtVertex(Vt,Gt),this.addGlobeExtVertex(Vt,Gt),this.addGlobeExtVertex(Vt,Gt)}const Pt=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),zt=Pt.vertexLength;if(this.addCircleVertex(_t,Rt,-1,-1),this.addCircleVertex(_t,Rt,1,-1),this.addCircleVertex(_t,Rt,1,1),this.addCircleVertex(_t,Rt,-1,1),this.elevationMode!=="none"){const Vt=ht?ht.pointElevation(new yn(_t,Rt)):0;this.hasElevation=this.hasElevation||Vt!==0;for(let Gt=0;Gt<4;Gt++)this.elevatedLayoutVertexArray.emplaceBack(Vt)}this.indexArray.emplaceBack(zt,zt+1,zt+2),this.indexArray.emplaceBack(zt,zt+2,zt+3),Pt.vertexLength+=4,Pt.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,_,{},j,tt,ot,void 0,this.worldview)}addCircleVertex(s,a,_,j){this.layoutVertexArray.emplaceBack(2*s+(_+1)/2,2*a+(j+1)/2)}addGlobeExtVertex(s,a){this.globeExtVertexArray.emplaceBack(s.x,s.y,s.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function Bu(d,s){for(let a=0;a<d.length;a++)if(Nl(s,d[a]))return!0;for(let a=0;a<s.length;a++)if(Nl(d,s[a]))return!0;return!!du(d,s)}function Vu(d,s,a){return!!Nl(d,s)||!!Yo(s,d,a)}function Au(d,s){if(d.length===1)return Cl(s,d[0]);for(let a=0;a<s.length;a++){const _=s[a];for(let j=0;j<_.length;j++)if(Nl(d,_[j]))return!0}for(let a=0;a<d.length;a++)if(Cl(s,d[a]))return!0;for(let a=0;a<s.length;a++)if(du(d,s[a]))return!0;return!1}function Ru(d,s,a){if(d.length>1){if(du(d,s))return!0;for(let _=0;_<s.length;_++)if(Yo(s[_],d,a))return!0}for(let _=0;_<d.length;_++)if(Yo(d[_],s,a))return!0;return!1}function du(d,s){if(d.length===0||s.length===0)return!1;for(let a=0;a<d.length-1;a++){const _=d[a],j=d[a+1];for(let tt=0;tt<s.length-1;tt++)if(Ju(_,j,s[tt],s[tt+1]))return!0}return!1}function Ju(d,s,a,_){return Mo(d,a,_)!==Mo(s,a,_)&&Mo(d,s,a)!==Mo(d,s,_)}function cp(d,s,a){return(d.x-a.x)*(s.y-a.y)-(d.y-a.y)*(s.x-a.x)}function Zo(d,s,a,_){const j=cp(d,s,_),tt=cp(d,s,a);if(Math.sign(j)===Math.sign(tt))return;const rt=cp(a,_,d),ot=rt+tt-j;return Math.sign(rt)!==Math.sign(ot)?[rt/(rt-ot),tt/(tt-j)]:void 0}function Yo(d,s,a){const _=a*a;if(s.length===1)return d.distSqr(s[0])<_;for(let j=1;j<s.length;j++)if(Oo(d,s[j-1],s[j])<_)return!0;return!1}function Oo(d,s,a){const _=s.distSqr(a);if(_===0)return d.distSqr(s);const j=((d.x-s.x)*(a.x-s.x)+(d.y-s.y)*(a.y-s.y))/_;return d.distSqr(j<0?s:j>1?a:a.sub(s)._mult(j)._add(s))}function Cl(d,s){let a,_,j,tt=!1;for(let rt=0;rt<d.length;rt++){a=d[rt];for(let ot=0,ct=a.length-1;ot<a.length;ct=ot++)_=a[ot],j=a[ct],_.y>s.y!=j.y>s.y&&s.x<(j.x-_.x)*(s.y-_.y)/(j.y-_.y)+_.x&&(tt=!tt)}return tt}function Nl(d,s){let a=!1;for(let _=0,j=d.length-1;_<d.length;j=_++){const tt=d[_],rt=d[j];tt.y>s.y!=rt.y>s.y&&s.x<(rt.x-tt.x)*(s.y-tt.y)/(rt.y-tt.y)+tt.x&&(a=!a)}return a}function $a(d,s,a,_,j){for(const rt of d)if(s<=rt.x&&a<=rt.y&&_>=rt.x&&j>=rt.y)return!0;const tt=[new yn(s,a),new yn(s,j),new yn(_,j),new yn(_,a)];if(d.length>2){for(const rt of tt)if(Nl(d,rt))return!0}for(let rt=0;rt<d.length-1;rt++)if(tu(d[rt],d[rt+1],tt))return!0;return!1}function tu(d,s,a){const _=a[0],j=a[2];if(d.x<_.x&&s.x<_.x||d.x>j.x&&s.x>j.x||d.y<_.y&&s.y<_.y||d.y>j.y&&s.y>j.y)return!1;const tt=Mo(d,s,a[0]);return tt!==Mo(d,s,a[1])||tt!==Mo(d,s,a[2])||tt!==Mo(d,s,a[3])}function Ep(d,s,a,_,j,tt){let rt=s.y-d.y,ot=d.x-s.x;if(tt=tt||0){const ct=rt*rt+ot*ot;if(ct===0)return!0;const ht=Math.sqrt(ct);rt/=ht,ot/=ht}return!((a.x-d.x)*rt+(a.y-d.y)*ot-tt<0||(_.x-d.x)*rt+(_.y-d.y)*ot-tt<0||(j.x-d.x)*rt+(j.y-d.y)*ot-tt<0)}function Np(d,s,a,_,j,tt,rt){return!(Ep(d,s,_,j,tt,rt)||Ep(s,a,_,j,tt,rt)||Ep(a,d,_,j,tt,rt)||Ep(_,j,d,s,a,rt)||Ep(j,tt,d,s,a,rt)||Ep(tt,_,d,s,a,rt))}function up(d,s,a){const _=s.paint.get(d).value;return _.kind==="constant"?_.value:a.programConfigurations.get(s.id).getMaxValue(d)}function vm(d){return Math.sqrt(d[0]*d[0]+d[1]*d[1])}function bm(d,s,a,_,j){if(!s[0]&&!s[1])return d;const tt=yn.convert(s)._mult(j);a==="viewport"&&tt._rotate(-_);const rt=[];for(let ot=0;ot<d.length;ot++)rt.push(d[ot].sub(tt));return rt}function Tp(d,s,a,_){const j=yn.convert(d)._mult(_);return s==="viewport"&&j._rotate(-a),j}let zy,Bp;function Sp(d,s,a){var _=2*Math.PI*6378137/256/Math.pow(2,a);return[d*_-2*Math.PI*6378137/2,s*_-2*Math.PI*6378137/2]}Fn(Wl,"CircleBucket",{omit:["layers"]});class Vp{constructor(s,a,_){this.z=s,this.x=a,this.y=_,this.key=Ix(0,s,s,a,_)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}isChildOf(s){const a=this.z-s.z;return s.z===0||s.z<this.z&&s.x===this.x>>a&&s.y===this.y>>a}url(s,a){const _=function(tt,rt,ot){var ct=Sp(256*tt,256*(rt=Math.pow(2,ot)-rt-1),ot),ht=Sp(256*(tt+1),256*(rt+1),ot);return ct[0]+","+ct[1]+","+ht[0]+","+ht[1]}(this.x,this.y,this.z),j=function(tt,rt,ot){let ct,ht="";for(let mt=tt;mt>0;mt--)ct=1<<mt-1,ht+=(rt&ct?1:0)+(ot&ct?2:0);return ht}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",j).replace("{bbox-epsg-3857}",_)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Px{constructor(s,a){this.wrap=s,this.canonical=a,this.key=Ix(s,a.z,a.z,a.x,a.y)}}class pu{constructor(s,a,_,j,tt){this.overscaledZ=s,this.wrap=a,this.canonical=new Vp(_,+j,+tt),this.key=a===0&&s===_?this.canonical.key:Ix(a,s,_,j,tt)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){const a=this.canonical.z-s;return s>this.canonical.z?new pu(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new pu(s,this.wrap,s,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(s,a=!0){if(this.overscaledZ===s&&a)return this.key;if(s>this.canonical.z)return Ix(this.wrap*+a,s,this.canonical.z,this.canonical.x,this.canonical.y);{const _=this.canonical.z-s;return Ix(this.wrap*+a,s,s,this.canonical.x>>_,this.canonical.y>>_)}}isChildOf(s){if(s.wrap!==this.wrap)return!1;const a=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.z<this.canonical.z&&s.canonical.x===this.canonical.x>>a&&s.canonical.y===this.canonical.y>>a}children(s){if(this.overscaledZ>=s)return[new pu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,_=2*this.canonical.x,j=2*this.canonical.y;return[new pu(a,this.wrap,a,_,j),new pu(a,this.wrap,a,_+1,j),new pu(a,this.wrap,a,_,j+1),new pu(a,this.wrap,a,_+1,j+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new pu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new pu(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Px(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ix(d,s,a,_,j){const tt=1<<Math.min(a,22);let rt=tt*(j%tt)+_%tt;return d&&a<22&&(rt+=tt*tt*((d<0?-2*d-1:2*d)%(1<<2*(22-a)))),16*(32*rt+a)+(s-a)}const sA=[d=>{let s=d.canonical.x-1,a=d.wrap;return s<0&&(s=(1<<d.canonical.z)-1,a--),new pu(d.overscaledZ,a,d.canonical.z,s,d.canonical.y)},d=>{let s=d.canonical.x+1,a=d.wrap;return s===1<<d.canonical.z&&(s=0,a++),new pu(d.overscaledZ,a,d.canonical.z,s,d.canonical.y)},d=>new pu(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,(d.canonical.y===0?1<<d.canonical.z:d.canonical.y)-1),d=>new pu(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,d.canonical.y===(1<<d.canonical.z)-1?0:d.canonical.y+1)];Fn(Vp,"CanonicalTileID"),Fn(pu,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const oA=zs([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:v1}=oA,aA=zs([{name:"a_pos_3",components:3,type:"Int16"}]);var pT=zs([{name:"a_pos",type:"Int16",components:2}]);function b1(d){return d*_e/Lt}const lA=[new cs([yt,yt,yt],[vt,vt,vt]),new cs([yt,yt,yt],[0,0,vt]),new cs([0,yt,yt],[vt,0,vt]),new cs([yt,0,yt],[0,vt,vt]),new cs([0,0,yt],[vt,vt,vt])];function fT(d,s,a,_=!0){const j=Cr([],d._camera.position,d.worldSize),tt=[s,a,1,1];Uo(tt,tt,d.pixelMatrixInverse),Io(tt,tt,1/tt[3]);const rt=ss([],Hs([],tt,j)),ot=d.globeMatrix,ct=[ot[12],ot[13],ot[14]],ht=Hs([],ct,j),mt=rn(ht),gt=ss([],ht),_t=d.worldSize/(2*Math.PI),Rt=Ls(gt,rt),Pt=Math.asin(_t/mt);if(Pt<Math.acos(Rt)){if(!_)return null;const sn=[],Fr=[];Cr(sn,rt,mt/Rt),ss(Fr,Hs(Fr,sn,ht)),ss(rt,Xt(rt,ht,Cr(rt,Fr,Math.tan(Pt)*mt)))}const zt=[];new Xs(j,rt).closestPointOnSphere(ct,_t,zt);const Vt=ss([],zo(ot,0)),Gt=ss([],zo(ot,1)),_i=ss([],zo(ot,2)),er=Ls(Vt,zt),rr=Ls(Gt,zt),_r=Ls(_i,zt),xr=Wt(Math.asin(-rr/_t));let Er=Wt(Math.atan2(er,_r));Er=d.center.lng+function(sn,Fr){const on=(Fr-sn+180)%360-180;return on<-180?on+360:on}(d.center.lng,Er);const Ar=sr(Er),Pr=fr(pr(xr),0,1);return new Yr(Ar,Pr)}class cA{constructor(s,a,_){this.a=Hs([],s,_),this.b=Hs([],a,_),this.center=_;const j=ss([],this.a),tt=ss([],this.b);this.angle=Math.acos(Ls(j,tt))}}function Kw(d,s){if(d.angle===0)return null;let a;return a=d.a[s]===0?1/d.angle*.5*Math.PI:1/d.angle*Math.atan(d.b[s]/d.a[s]/Math.sin(d.angle)-1/Math.tan(d.angle)),a<0||a>1?null:function(_,j,tt,rt){const ot=Math.sin(tt);return _*(Math.sin((1-rt)*tt)/ot)+j*(Math.sin(rt*tt)/ot)}(d.a[s],d.b[s],d.angle,fr(a,0,1))+d.center[s]}function wm(d){if(d.z<=1)return lA[d.z+2*d.y+d.x];const s=Yw(w1(d));return cs.fromPoints(s)}function Qm(d,s,a){return Cr(d,d,1-a),pn(d,d,s,a)}function mT(d,s,a){for(const _ of d)Vs(_,_,s),Cr(_,_,a)}function gT(d,s,a,_){const j=s/d.worldSize,tt=d.globeMatrix;if(a.z<=1){const Pr=wm(a).getCorners();return mT(Pr,tt,j),cs.fromPoints(Pr)}const rt=w1(a,_),ot=Yw(rt,_e+b1(d._tileCoverLift));mT(ot,tt,j);const ct=Number.MAX_VALUE,ht=[-ct,-ct,-ct],mt=[ct,ct,ct];if(rt.contains(d.center)){for(const Fr of ot)Jt(mt,mt,Fr),Or(ht,ht,Fr);ht[2]=0;const Pr=d.point,sn=[Pr.x*j,Pr.y*j,0];return Jt(mt,mt,sn),Or(ht,ht,sn),new cs(mt,ht)}if(d._tileCoverLift>0){for(const Pr of ot)Jt(mt,mt,Pr),Or(ht,ht,Pr);return new cs(mt,ht)}const gt=[tt[12]*j,tt[13]*j,tt[14]*j],_t=rt.getCenter(),Rt=fr(d.center.lat,-yr,yr),Pt=fr(_t.lat,-yr,yr),zt=sr(d.center.lng),Vt=pr(Rt);let Gt=zt-sr(_t.lng);const _i=Vt-pr(Pt);Gt>.5?Gt-=1:Gt<-.5&&(Gt+=1);let er=0;Math.abs(Gt)>Math.abs(_i)?er=Gt>=0?1:3:(er=_i>=0?0:2,pn(gt,gt,[tt[4]*j,tt[5]*j,tt[6]*j],-Math.sin(Lr(_i>=0?rt.getSouth():rt.getNorth()))*_e));const rr=ot[er],_r=ot[(er+1)%4],xr=new cA(rr,_r,gt),Er=[Kw(xr,0)||rr[0],Kw(xr,1)||rr[1],Kw(xr,2)||rr[2]],Ar=Ny(d.zoom);if(Ar>0){const Pr=function({x:Fr,y:on,z:gn},an,hn,vn,tn){const dn=1/(1<<gn);let qr=Fr*dn,Gr=qr+dn,wn=on*dn,_n=wn+dn,Yn=0;const jn=(qr+Gr)/2-vn;return jn>.5?Yn=-1:jn<-.5&&(Yn=1),qr=((qr+Yn)*an-(vn*=an))*hn+vn,Gr=((Gr+Yn)*an-vn)*hn+vn,wn=(wn*an-(tn*=an))*hn+tn,_n=(_n*an-tn)*hn+tn,[[qr,_n,0],[Gr,_n,0],[Gr,wn,0],[qr,wn,0]]}(a,s,d._pixelsPerMercatorPixel,zt,Vt);for(let Fr=0;Fr<ot.length;Fr++)Qm(ot[Fr],Pr[Fr],Ar);const sn=Xt([],Pr[er],Pr[(er+1)%4]);Cr(sn,sn,.5),Qm(Er,sn,Ar)}for(const Pr of ot)Jt(mt,mt,Pr),Or(ht,ht,Pr);return mt[2]=Math.min(rr[2],_r[2]),Jt(mt,mt,Er),Or(ht,ht,Er),new cs(mt,ht)}function w1({x:d,y:s,z:a},_=!1){const j=1/(1<<a),tt=new Ot(gr(d*j),s===(1<<a)-1&&_?-90:dr((s+1)*j)),rt=new Ot(gr((d+1)*j),s===0&&_?90:dr(s*j));return new qt(tt,rt)}function Yw(d,s=_e){const a=Lr(d.getNorth()),_=Lr(d.getSouth()),j=Math.cos(a),tt=Math.cos(_),rt=Math.sin(a),ot=Math.sin(_),ct=d.getWest(),ht=d.getEast();return[Mt(tt,ot,ct,s),Mt(tt,ot,ht,s),Mt(j,rt,ht,s),Mt(j,rt,ct,s)]}function $v(d,s,a,_){const j=1<<a.z,tt=(d/Rn+a.x)/j;return Et(dr((s/Rn+a.y)/j),gr(tt),_)}function E1({min:d,max:s}){return lt/Math.max(s[0]-d[0],s[1]-d[1],s[2]-d[2])}const yT=new Float64Array(16);function T1(d){const s=E1(d),a=ir(yT,[s,s,s]);return It(a,a,As([],d.min))}function Qw(d){const s=(_=d.min,(a=yT)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=_[0],a[13]=_[1],a[14]=_[2],a[15]=1,a);var a,_;const j=1/E1(d);return St(s,s,[j,j,j])}function Jw(d){const s=Rn/(2*Math.PI);return d/(2*Math.PI)/s}function _T(d,s){return Rn/(512*Math.pow(2,d))*E1(wm(s))}function xT(d,s,a,_,j){const tt=Jw(a),rt=[d,s,-a/(2*Math.PI)],ot=At(new Float64Array(16));return It(ot,ot,rt),St(ot,ot,[tt,tt,tt]),jt(ot,ot,Lr(-j)),Ht(ot,ot,Lr(-_)),ot}function Ny(d){return Ur(nt,st,d)}function vT(d,s){const a=Et(s.lat,s.lng),_=function(Pt){const zt=Et(Pt._center.lat,Pt._center.lng);let Vt=$s([],Zr(0,1,0),zt);const Gt=nr([],-Pt.angle,zt);Vt=Vs(Vt,Vt,Gt),nr(Gt,-Pt._pitch,Vt);const _i=ss([],zt);return Cr(_i,_i,b1(Pt.cameraToCenterDistance/Pt.pixelsPerMeter)),Vs(_i,_i,Gt),Xt([],zt,_i)}(d);return rt=(j=mr([],_,a))[0],ot=j[1],ct=j[2],ht=(tt=a)[0],mt=tt[1],gt=tt[2],Rt=(_t=Math.sqrt((rt*rt+ot*ot+ct*ct)*(ht*ht+mt*mt+gt*gt)))&&Ls(j,tt)/_t,Math.acos(Math.min(Math.max(Rt,-1),1));var j,tt,rt,ot,ct,ht,mt,gt,_t,Rt}function eE(d,s){return vT(d,s)>Math.PI/2*1.01}const bT=Lr(85),uA=Math.cos(bT),hA=Math.sin(bT),dA=Dt(),wT=d=>{const s=[];return d.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s};function ET(d,s,a,_,j,tt,rt,ot,ct){if(tt&&d.queryGeometry.isAboveHorizon)return!1;tt&&(ct*=d.pixelToTileUnitsFactor);const ht=d.tileID.canonical,mt=a.projection.upVectorScale(ht,a.center.lat,a.worldSize).metersToTile;for(const gt of s)for(const _t of gt){const Rt=_t.add(ot),Pt=j&&a.elevation?a.elevation.exaggeration()*j.getElevationAt(Rt.x,Rt.y,!0):0,zt=a.projection.projectTilePoint(Rt.x,Rt.y,ht);if(Pt>0){const er=a.projection.upVector(ht,Rt.x,Rt.y);zt.x+=er[0]*mt*Pt,zt.y+=er[1]*mt*Pt,zt.z+=er[2]*mt*Pt}const Vt=tt?Rt:pA(zt.x,zt.y,zt.z,_),Gt=tt?d.tilespaceRays.map(er=>mA(er,Pt)):d.queryGeometry.screenGeometry,_i=Uo([],[zt.x,zt.y,zt.z,1],_);if(!rt&&tt?ct*=_i[3]/a.cameraToCenterDistance:rt&&!tt&&(ct*=a.cameraToCenterDistance/_i[3]),tt){const er=dr((_t.y/Rn+ht.y)/(1<<ht.z));ct/=a.projection.pixelsPerMeter(er,1)/hr(1,er)}if(Vu(Gt,Vt,ct))return!0}return!1}function pA(d,s,a,_){const j=Uo([],[d,s,a,1],_);return new yn(j[0]/j[3],j[1]/j[3])}const TT=Zr(0,0,0),fA=Zr(0,0,1);function mA(d,s){const a=Sr();return TT[2]=s,d.intersectsPlane(TT,fA,a),new yn(a[0],a[1])}class ST extends Wl{}let CT,AT,RT,PT;function IT(d,{width:s,height:a},_,j){if(j){if(j instanceof Uint8ClampedArray)j=new Uint8Array(j.buffer);else if(j.length!==s*a*_)throw new RangeError("mismatched image size")}else j=new Uint8Array(s*a*_);return d.width=s,d.height=a,d.data=j,d}function MT(d,s,a){const{width:_,height:j}=s;_===d.width&&j===d.height||(tE(d,s,{x:0,y:0},{x:0,y:0},{width:Math.min(d.width,_),height:Math.min(d.height,j)},a,null),d.width=_,d.height=j,d.data=s.data)}function tE(d,s,a,_,j,tt,rt,ot){if(j.width===0||j.height===0)return s;if(j.width>d.width||j.height>d.height||a.x>d.width-j.width||a.y>d.height-j.height)throw new RangeError("out of range source coordinates for image copy");if(j.width>s.width||j.height>s.height||_.x>s.width-j.width||_.y>s.height-j.height)throw new RangeError("out of range destination coordinates for image copy");const ct=d.data,ht=s.data,mt=tt===4&&ot;for(let gt=0;gt<j.height;gt++){const _t=((a.y+gt)*d.width+a.x)*tt,Rt=((_.y+gt)*s.width+_.x)*tt;if(mt)for(let Pt=0;Pt<j.width;Pt++){const zt=_t+Pt*tt+3,Vt=Rt+Pt*tt;ht[Vt+0]=255,ht[Vt+1]=255,ht[Vt+2]=255,ht[Vt+3]=ct[zt]}else if(rt)for(let Pt=0;Pt<j.width;Pt++){const zt=_t+Pt*tt,Vt=Rt+Pt*tt,Gt=new Js(ct[zt+0]/255,ct[zt+1]/255,ct[zt+2]/255,ct[zt+3]).toNonPremultipliedRenderColor(rt).toArray();ht[Vt+0]=Gt[0],ht[Vt+1]=Gt[1],ht[Vt+2]=Gt[2],ht[Vt+3]=Gt[3]}else for(let Pt=0;Pt<j.width*tt;Pt++)ht[Rt+Pt]=ct[_t+Pt]}return s}Fn(ST,"HeatmapBucket",{omit:["layers"]});class By{constructor(s,a){IT(this,s,1,a)}resize(s){MT(this,new By(s),1)}clone(){return new By({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,a,_,j,tt){tE(s,a,_,j,tt,1,null)}}class iu{constructor(s,a){IT(this,s,4,a)}resize(s){MT(this,new iu(s),4)}replace(s,a){a?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new iu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,a,_,j,tt,rt,ot){tE(s,a,_,j,tt,4,rt,ot)}}class kT{constructor(s,a){this.width=s.width,this.height=s.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function Hv(d){const s={},a=d.resolution||256,_=d.clips?d.clips.length:1,j=d.image||new iu({width:a,height:_}),tt=(rt,ot,ct)=>{s[d.evaluationKey]=ct;const ht=d.expression.evaluate(s),mt=ht?ht.toNonPremultipliedRenderColor(null):null;mt&&(j.data[rt+ot+0]=Math.floor(255*mt.r),j.data[rt+ot+1]=Math.floor(255*mt.g),j.data[rt+ot+2]=Math.floor(255*mt.b),j.data[rt+ot+3]=Math.floor(255*mt.a))};if(d.clips)for(let rt=0,ot=0;rt<_;++rt,ot+=4*a)for(let ct=0,ht=0;ct<a;ct++,ht+=4){const mt=ct/(a-1),{start:gt,end:_t}=d.clips[rt];tt(ot,ht,gt*(1-mt)+_t*mt)}else for(let rt=0,ot=0;rt<a;rt++,ot+=4)tt(0,ot,rt/(a-1));return j}Fn(By,"AlphaImage"),Fn(iu,"RGBAImage");const gA=zs([{name:"a_pos",components:2,type:"Int16"}],4),yA=zs([{name:"a_road_z_offset",components:1,type:"Float32"}],4),_A=zs([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),xA=zs([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Mx(d,s,a=2){const _=s&&s.length,j=_?s[0]*a:d.length;let tt=DT(d,0,j,a,!0);const rt=[];if(!tt||tt.next===tt.prev)return rt;let ot,ct,ht;if(_&&(tt=function(mt,gt,_t,Rt){const Pt=[];for(let zt=0,Vt=gt.length;zt<Vt;zt++){const Gt=DT(mt,gt[zt]*Rt,zt<Vt-1?gt[zt+1]*Rt:mt.length,Rt,!1);Gt===Gt.next&&(Gt.steiner=!0),Pt.push(AA(Gt))}Pt.sort(TA);for(let zt=0;zt<Pt.length;zt++)_t=SA(Pt[zt],_t);return _t}(d,s,tt,a)),d.length>80*a){ot=d[0],ct=d[1];let mt=ot,gt=ct;for(let _t=a;_t<j;_t+=a){const Rt=d[_t],Pt=d[_t+1];Rt<ot&&(ot=Rt),Pt<ct&&(ct=Pt),Rt>mt&&(mt=Rt),Pt>gt&&(gt=Pt)}ht=Math.max(mt-ot,gt-ct),ht=ht!==0?32767/ht:0}return Wv(tt,rt,a,ot,ct,ht,0),rt}function DT(d,s,a,_,j){let tt;if(j===function(rt,ot,ct,ht){let mt=0;for(let gt=ot,_t=ct-ht;gt<ct;gt+=ht)mt+=(rt[_t]-rt[gt])*(rt[gt+1]+rt[_t+1]),_t=gt;return mt}(d,s,a,_)>0)for(let rt=s;rt<a;rt+=_)tt=OT(rt/_|0,d[rt],d[rt+1],tt);else for(let rt=a-_;rt>=s;rt-=_)tt=OT(rt/_|0,d[rt],d[rt+1],tt);return tt&&kx(tt,tt.next)&&(Xv(tt),tt=tt.next),tt}function w_(d,s){if(!d)return d;s||(s=d);let a,_=d;do if(a=!1,_.steiner||!kx(_,_.next)&&Hl(_.prev,_,_.next)!==0)_=_.next;else{if(Xv(_),_=s=_.prev,_===_.next)break;a=!0}while(a||_!==s);return s}function Wv(d,s,a,_,j,tt,rt){if(!d)return;!rt&&tt&&function(ct,ht,mt,gt){let _t=ct;do _t.z===0&&(_t.z=iE(_t.x,_t.y,ht,mt,gt)),_t.prevZ=_t.prev,_t.nextZ=_t.next,_t=_t.next;while(_t!==ct);_t.prevZ.nextZ=null,_t.prevZ=null,function(Rt){let Pt,zt=1;do{let Vt,Gt=Rt;Rt=null;let _i=null;for(Pt=0;Gt;){Pt++;let er=Gt,rr=0;for(let xr=0;xr<zt&&(rr++,er=er.nextZ,er);xr++);let _r=zt;for(;rr>0||_r>0&&er;)rr!==0&&(_r===0||!er||Gt.z<=er.z)?(Vt=Gt,Gt=Gt.nextZ,rr--):(Vt=er,er=er.nextZ,_r--),_i?_i.nextZ=Vt:Rt=Vt,Vt.prevZ=_i,_i=Vt;Gt=er}_i.nextZ=null,zt*=2}while(Pt>1)}(_t)}(d,_,j,tt);let ot=d;for(;d.prev!==d.next;){const ct=d.prev,ht=d.next;if(tt?bA(d,_,j,tt):vA(d))s.push(ct.i,d.i,ht.i),Xv(d),d=ht.next,ot=ht.next;else if((d=ht)===ot){rt?rt===1?Wv(d=wA(w_(d),s),s,a,_,j,tt,2):rt===2&&EA(d,s,a,_,j,tt):Wv(w_(d),s,a,_,j,tt,1);break}}}function vA(d){const s=d.prev,a=d,_=d.next;if(Hl(s,a,_)>=0)return!1;const j=s.x,tt=a.x,rt=_.x,ot=s.y,ct=a.y,ht=_.y,mt=Math.min(j,tt,rt),gt=Math.min(ot,ct,ht),_t=Math.max(j,tt,rt),Rt=Math.max(ot,ct,ht);let Pt=_.next;for(;Pt!==s;){if(Pt.x>=mt&&Pt.x<=_t&&Pt.y>=gt&&Pt.y<=Rt&&qv(j,ot,tt,ct,rt,ht,Pt.x,Pt.y)&&Hl(Pt.prev,Pt,Pt.next)>=0)return!1;Pt=Pt.next}return!0}function bA(d,s,a,_){const j=d.prev,tt=d,rt=d.next;if(Hl(j,tt,rt)>=0)return!1;const ot=j.x,ct=tt.x,ht=rt.x,mt=j.y,gt=tt.y,_t=rt.y,Rt=Math.min(ot,ct,ht),Pt=Math.min(mt,gt,_t),zt=Math.max(ot,ct,ht),Vt=Math.max(mt,gt,_t),Gt=iE(Rt,Pt,s,a,_),_i=iE(zt,Vt,s,a,_);let er=d.prevZ,rr=d.nextZ;for(;er&&er.z>=Gt&&rr&&rr.z<=_i;){if(er.x>=Rt&&er.x<=zt&&er.y>=Pt&&er.y<=Vt&&er!==j&&er!==rt&&qv(ot,mt,ct,gt,ht,_t,er.x,er.y)&&Hl(er.prev,er,er.next)>=0||(er=er.prevZ,rr.x>=Rt&&rr.x<=zt&&rr.y>=Pt&&rr.y<=Vt&&rr!==j&&rr!==rt&&qv(ot,mt,ct,gt,ht,_t,rr.x,rr.y)&&Hl(rr.prev,rr,rr.next)>=0))return!1;rr=rr.nextZ}for(;er&&er.z>=Gt;){if(er.x>=Rt&&er.x<=zt&&er.y>=Pt&&er.y<=Vt&&er!==j&&er!==rt&&qv(ot,mt,ct,gt,ht,_t,er.x,er.y)&&Hl(er.prev,er,er.next)>=0)return!1;er=er.prevZ}for(;rr&&rr.z<=_i;){if(rr.x>=Rt&&rr.x<=zt&&rr.y>=Pt&&rr.y<=Vt&&rr!==j&&rr!==rt&&qv(ot,mt,ct,gt,ht,_t,rr.x,rr.y)&&Hl(rr.prev,rr,rr.next)>=0)return!1;rr=rr.nextZ}return!0}function wA(d,s){let a=d;do{const _=a.prev,j=a.next.next;!kx(_,j)&&jT(_,a,a.next,j)&&Zv(_,j)&&Zv(j,_)&&(s.push(_.i,a.i,j.i),Xv(a),Xv(a.next),a=d=j),a=a.next}while(a!==d);return w_(a)}function EA(d,s,a,_,j,tt){let rt=d;do{let ot=rt.next.next;for(;ot!==rt.prev;){if(rt.i!==ot.i&&RA(rt,ot)){let ct=FT(rt,ot);return rt=w_(rt,rt.next),ct=w_(ct,ct.next),Wv(rt,s,a,_,j,tt,0),void Wv(ct,s,a,_,j,tt,0)}ot=ot.next}rt=rt.next}while(rt!==d)}function TA(d,s){let a=d.x-s.x;return a===0&&(a=d.y-s.y,a===0)&&(a=(d.next.y-d.y)/(d.next.x-d.x)-(s.next.y-s.y)/(s.next.x-s.x)),a}function SA(d,s){const a=function(j,tt){let rt=tt;const ot=j.x,ct=j.y;let ht,mt=-1/0;if(kx(j,rt))return rt;do{if(kx(j,rt.next))return rt.next;if(ct<=rt.y&&ct>=rt.next.y&&rt.next.y!==rt.y){const zt=rt.x+(ct-rt.y)*(rt.next.x-rt.x)/(rt.next.y-rt.y);if(zt<=ot&&zt>mt&&(mt=zt,ht=rt.x<rt.next.x?rt:rt.next,zt===ot))return ht}rt=rt.next}while(rt!==tt);if(!ht)return null;const gt=ht,_t=ht.x,Rt=ht.y;let Pt=1/0;rt=ht;do{if(ot>=rt.x&&rt.x>=_t&&ot!==rt.x&&LT(ct<Rt?ot:mt,ct,_t,Rt,ct<Rt?mt:ot,ct,rt.x,rt.y)){const zt=Math.abs(ct-rt.y)/(ot-rt.x);Zv(rt,j)&&(zt<Pt||zt===Pt&&(rt.x>ht.x||rt.x===ht.x&&CA(ht,rt)))&&(ht=rt,Pt=zt)}rt=rt.next}while(rt!==gt);return ht}(d,s);if(!a)return s;const _=FT(a,d);return w_(_,_.next),w_(a,a.next)}function CA(d,s){return Hl(d.prev,d,s.prev)<0&&Hl(s.next,d,d.next)<0}function iE(d,s,a,_,j){return(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d=(d-a)*j|0)|d<<8))|d<<4))|d<<2))|d<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-_)*j|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function AA(d){let s=d,a=d;do(s.x<a.x||s.x===a.x&&s.y<a.y)&&(a=s),s=s.next;while(s!==d);return a}function LT(d,s,a,_,j,tt,rt,ot){return(j-rt)*(s-ot)>=(d-rt)*(tt-ot)&&(d-rt)*(_-ot)>=(a-rt)*(s-ot)&&(a-rt)*(tt-ot)>=(j-rt)*(_-ot)}function qv(d,s,a,_,j,tt,rt,ot){return!(d===rt&&s===ot)&&LT(d,s,a,_,j,tt,rt,ot)}function RA(d,s){return d.next.i!==s.i&&d.prev.i!==s.i&&!function(a,_){let j=a;do{if(j.i!==a.i&&j.next.i!==a.i&&j.i!==_.i&&j.next.i!==_.i&&jT(j,j.next,a,_))return!0;j=j.next}while(j!==a);return!1}(d,s)&&(Zv(d,s)&&Zv(s,d)&&function(a,_){let j=a,tt=!1;const rt=(a.x+_.x)/2,ot=(a.y+_.y)/2;do j.y>ot!=j.next.y>ot&&j.next.y!==j.y&&rt<(j.next.x-j.x)*(ot-j.y)/(j.next.y-j.y)+j.x&&(tt=!tt),j=j.next;while(j!==a);return tt}(d,s)&&(Hl(d.prev,d,s.prev)||Hl(d,s.prev,s))||kx(d,s)&&Hl(d.prev,d,d.next)>0&&Hl(s.prev,s,s.next)>0)}function Hl(d,s,a){return(s.y-d.y)*(a.x-s.x)-(s.x-d.x)*(a.y-s.y)}function kx(d,s){return d.x===s.x&&d.y===s.y}function jT(d,s,a,_){const j=C1(Hl(d,s,a)),tt=C1(Hl(d,s,_)),rt=C1(Hl(a,_,d)),ot=C1(Hl(a,_,s));return j!==tt&&rt!==ot||!(j!==0||!S1(d,a,s))||!(tt!==0||!S1(d,_,s))||!(rt!==0||!S1(a,d,_))||!(ot!==0||!S1(a,s,_))}function S1(d,s,a){return s.x<=Math.max(d.x,a.x)&&s.x>=Math.min(d.x,a.x)&&s.y<=Math.max(d.y,a.y)&&s.y>=Math.min(d.y,a.y)}function C1(d){return d>0?1:d<0?-1:0}function Zv(d,s){return Hl(d.prev,d,d.next)<0?Hl(d,s,d.next)>=0&&Hl(d,d.prev,s)>=0:Hl(d,s,d.prev)<0||Hl(d,d.next,s)<0}function FT(d,s){const a=rE(d.i,d.x,d.y),_=rE(s.i,s.x,s.y),j=d.next,tt=s.prev;return d.next=s,s.prev=d,a.next=j,j.prev=a,_.next=a,a.prev=_,tt.next=_,_.prev=tt,_}function OT(d,s,a,_){const j=rE(d,s,a);return _?(j.next=_.next,j.prev=_,_.next.prev=j,_.next=j):(j.prev=j,j.next=j),j}function Xv(d){d.next.prev=d.prev,d.prev.next=d.next,d.prevZ&&(d.prevZ.nextZ=d.nextZ),d.nextZ&&(d.nextZ.prevZ=d.prevZ)}function rE(d,s,a){return{i:d,x:s,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Kv(d,s){const a=d.length;if(a<=1)return[d];const _=[];let j,tt;for(let rt=0;rt<a;rt++){const ot=Jo(d[rt]);ot!==0&&(d[rt].area=Math.abs(ot),tt===void 0&&(tt=ot<0),tt===ot<0?(j&&_.push(j),j=[d[rt]]):j.push(d[rt]))}if(j&&_.push(j),s>1)for(let rt=0;rt<_.length;rt++)_[rt].length<=s||(R0(_[rt],s,1,_[rt].length-1,PA),_[rt]=_[rt].slice(0,s));return _}function PA(d,s){return s.area-d.area}function zT(d,s,a=1){if(!d)return null;const _=typeof d=="string"?bn.from(d).getPrimary():d.getPrimary(),j=typeof d=="string"?null:d.getSecondary();for(const tt of[_,j]){if(!tt)continue;const rt=tt.id.toString();s.has(rt)||s.set(rt,[]),tt.scaleSelf(a),s.get(rt).push(tt)}return{primary:_.toString(),secondary:j?j.toString():null}}function nE(d,s,a,_){const j=_.patternDependencies;let tt=!1;for(const rt of s){const ot=rt.paint.get(`${d}-pattern`);ot.isConstant()||(tt=!0),zT(ot.constantOr(null),j,a)&&(tt=!0)}return tt}function sE(d,s,a,_,j,tt){const rt=tt.patternDependencies;for(const ot of s){const ct=ot.paint.get(`${d}-pattern`).value;if(ct.kind!=="constant"){let ht=ct.evaluate({zoom:_},a,{},tt.availableImages);ht=ht&&ht.name?ht.name:ht;const mt=zT(ht,rt,j);if(!mt)continue;const{primary:gt,secondary:_t}=mt;gt&&(a.patterns[ot.id]=[gt,_t].filter(Boolean))}}return a}class NT{constructor(){this.polygons=new Map}add(s,...a){const _=this.polygons.get(s);_?_.push(...a):this.polygons.set(s,a)}merge(s){for(const[a,_]of s.polygons)this.add(a,..._)}}class Jm{constructor(){this.portals=[]}static isOnBorder(s,a){return s<=0&&a<=0||s>=Rn&&a>=Rn}static evaluate(s){if(s.length===0)return new Jm;let a=[];for(const ct of s)a.push(...ct.portals);if(a.length===0)return new Jm;for(const ct of a){const ht=ct.va,mt=ct.vb;(Jm.isOnBorder(ht.x,mt.x)||Jm.isOnBorder(ht.y,mt.y))&&(ct.type="border")}const _=a.filter(ct=>ct.type!=="unevaluated"),j=a.filter(ct=>ct.type==="unevaluated");if(j.length===0)return new Jm;j.sort((ct,ht)=>ct.hash===ht.hash?ct.isTunnel===ht.isTunnel?0:ct.isTunnel?-1:1:ct.hash<ht.hash?1:-1),a=_.concat(j);let tt=_.length,rt=tt,ot=tt;do if(rt++,rt===a.length||a[tt].hash!==a[rt].hash){if(rt-tt==2){ot<tt&&(a[ot]=a[tt],a[tt]=null);const ct=a[ot],ht=a[rt-1];ct.type=ct.isTunnel!==ht.isTunnel?"tunnel":"polygon",ct.connection={a:ct.connection.a,b:ht.connection.a},ot++}tt=rt}while(tt!==a.length);return a.splice(ot),a.sort((ct,ht)=>ct.hash<ht.hash?1:-1),{portals:a}}}Fn(Jm,"ElevationPortalGraph"),Fn(NT,"ElevationPolygons");class IA{constructor(s,a,_){this.outPositions=s,this.outNormals=a,this.outIndices=_,this.vertexLookup=new Map}addVertex(s,a,_){let j=s[2];_!=null&&(j*=_);const tt=`${s[0]},${s[1]},${s[2]},${a[0]},${a[1]},${a[2]}`,rt=this.vertexLookup.get(tt);if(rt!=null)return rt;const ot=this.outPositions.length;this.vertexLookup.set(tt,ot);const ct=Math.trunc(16384*a[0]),ht=Math.trunc(16384*a[1]),mt=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(s[0],s[1],j),this.outNormals.emplaceBack(ct,ht,mt),ot}addTriangle(s,a,_){this.outIndices.emplaceBack(s,a,_)}addTriangles(s,a,_){if(s.length===0)return;const j=_.length===1,tt=Sr(),rt=Sr();for(let ot=0;ot<s.length;ot+=3){const ct=a[s[ot+0]],ht=a[s[ot+1]],mt=a[s[ot+2]],gt=j?_[0]:_[s[ot+1]],_t=j?_[0]:_[s[ot+2]];Kr(tt,ct.x,ct.y,j?_[0]:_[s[ot+0]]);const Rt=this.addVertex(tt,rt);Kr(tt,ht.x,ht.y,gt);const Pt=this.addVertex(tt,rt);Kr(tt,mt.x,mt.y,_t);const zt=this.addVertex(tt,rt);this.outIndices.emplaceBack(Rt,Pt,zt)}}addQuad(s,a,_,j,tt,rt){const ot=this.addVertex(s,tt,rt),ct=this.addVertex(a,tt,rt),ht=this.addVertex(_,tt,rt),mt=this.addVertex(j,tt,rt);this.addTriangle(ot,ct,ht),this.addTriangle(ht,mt,ot)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Uu{constructor(s,a,_,j){this.unevaluatedPortals=new Jm,this.portalPolygons=new NT,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Mv,this.vertexNormals=new _x,this.indexArray=new Dl,this.tileToMeters=Nr(s),this.bridgeProgramConfigurations=new lp(a,{zoom:_,lut:j},tt=>tt!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new lp(a,{zoom:_,lut:j},tt=>tt!=="fill-bridge-guard-rail-color")}addVertices(s,a){const _=this.unevalVertices.length;for(let j=0;j<s.length;j++)this.unevalVertices.push(s[j]),this.unevalHeights.push(a[j]);return _}addTriangles(s,a,_){const j=_?this.unevalTunnelTriangles:this.unevalTriangles;for(const tt of s)j.push(tt+a)}addRenderableRing(s,a,_,j,tt,rt){const ot=[new yn(tt.min.x,tt.min.y),new yn(tt.max.x,tt.min.y),new yn(tt.max.x,tt.max.y),new yn(tt.min.x,tt.max.y)];for(let ct=0;ct<_-1;ct++){const ht=a+ct,mt=ht+1,gt=this.unevalVertices[ht],_t=this.unevalVertices[mt];if(!(gt.x>=tt.min.x&&gt.x<=tt.max.x&&gt.y>=tt.min.y&&gt.y<=tt.max.y||_t.x>=tt.min.x&&_t.x<=tt.max.x&&_t.y>=tt.min.y&&_t.y<=tt.max.y||tu(gt,_t,ot))||this.isOnBorder(gt.x,_t.x)||this.isOnBorder(gt.y,_t.y))continue;const Rt=Uu.computeEdgeHash(this.unevalVertices[ht],this.unevalVertices[mt]);let Pt,zt=this.vertexHashLookup.get(Uu.computePosHash(gt));zt!=null?Pt=zt.next:(zt=this.vertexHashLookup.get(Uu.computePosHash(_t)),Pt=zt!=null?zt.prev:Rt),this.unevalEdges.push({polygonIdx:s,a:ht,b:mt,hash:Rt,portalHash:Pt,isTunnel:j,type:"unevaluated",featureInfo:rt})}}addPortalCandidates(s,a,_,j,tt){if(a.length===0)return;this.portalPolygons.add(s,{geometry:a,zLevel:tt});const rt=a[0];this.vertexHashLookup.clear();let ot=Uu.computeEdgeHash(rt[rt.length-2],rt[rt.length-1]);for(let ct=0;ct<rt.length-1;ct++){const ht=rt[ct+0],mt=rt[ct+1],gt=bu(mt.x-ht.x,mt.y-ht.y),_t=dp(gt);if(_t===0)continue;let Rt="unevaluated";const Pt=j.pointElevation(ht),zt=j.pointElevation(mt);Math.abs(Pt)<.01&&Math.abs(zt)<.01?Rt="entrance":(this.isOnBorder(ht.x,mt.x)||this.isOnBorder(ht.y,mt.y))&&(Rt="border");const Vt=Uu.computeEdgeHash(ht,mt);this.unevaluatedPortals.portals.push({connection:{a:s,b:void 0},va:ht,vb:mt,vab:gt,length:_t,hash:Vt,isTunnel:_,type:Rt});const Gt=Uu.computePosHash(ht);this.vertexHashLookup.set(Gt,{prev:ot,next:Vt}),ot=Vt}}construct(s){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),_=_t=>{_t.primitiveLength=this.indexArray.length-_t.primitiveOffset},j=new IA(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(s.portals,this.unevalEdges);const tt=a(),rt=a(),ot=a(),ct=(_t,Rt)=>{_t.sort((zt,Vt)=>zt.type===Rt&&Vt.type!==Rt?-1:zt.type!==Rt&&Vt.type===Rt?1:0);const Pt=_t.findIndex(zt=>zt.type!==Rt);return Pt>=0?Pt:_t.length};let ht=0;this.unevalEdges.length>0&&(ht=ct(this.unevalEdges,"none"),this.constructBridgeStructures(j,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:ht},this.tileToMeters)),_(ot);const mt=a(),gt=a();if(this.unevalEdges.length>0){const _t=this.unevalEdges.splice(ht),Rt=ct(_t,"tunnel")+ht;this.unevalEdges.push(..._t),this.constructTunnelStructures(j,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:ht},{min:ht,max:Rt})}_(mt),j.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),_(gt),j.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),_(rt),j.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),_(tt),this.maskSegments=Bo.simpleSegment(0,gt.primitiveOffset,0,gt.primitiveLength),this.depthSegments=Bo.simpleSegment(0,rt.primitiveOffset,0,rt.primitiveLength),this.renderableBridgeSegments=Bo.simpleSegment(0,ot.primitiveOffset,0,ot.primitiveLength),this.renderableTunnelSegments=Bo.simpleSegment(0,mt.primitiveOffset,0,mt.primitiveLength),this.shadowCasterSegments=Bo.simpleSegment(0,tt.primitiveOffset,0,tt.primitiveLength)}update(s,a,_,j,tt,rt,ot,ct){this.bridgeProgramConfigurations.updatePaintArrays(s,a,tt,_,j,rt,ot,ct),this.tunnelProgramConfigurations.updatePaintArrays(s,a,tt,_,j,rt,ot,ct)}upload(s){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=s.createVertexBuffer(this.vertexPositions,_A.members),this.vertexBufferNormal=s.createVertexBuffer(this.vertexNormals,xA.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(s),this.tunnelProgramConfigurations.upload(s))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(s,a,_,j,tt){const rt=(ot,ct)=>{for(let ht=0;ht<ct.length-1;ht++){const mt=ct[ht].featureIndex,gt=ct[ht+1].vertexStart,_t=s.feature(mt);ot.populatePaintArrays(gt,_t,mt,{},_,a,j,void 0,tt)}};rt(this.bridgeProgramConfigurations,this.bridgeFeatureSections),rt(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(s,a,_,j,tt){const rt=new Map;for(let ot=j;ot<tt;ot++){const ct=_[ot],ht=ct.a,mt=ct.b,gt=Uu.computePosHash(s[ht]),_t=Uu.computePosHash(s[mt]);let Rt=rt.get(gt);Rt||(Rt={},rt.set(gt,Rt));let Pt=rt.get(_t);Pt||(Pt={},rt.set(_t,Pt)),a[ht]<=0&&a[mt]<=0||(Rt.to=mt,Pt.from=ht)}return rt}isTerminalVertex(s,a){const _=Uu.computePosHash(this.unevalVertices[s]),j=a.get(_);return!j||!j.from||!j.to}constructBridgeStructures(s,a,_,j,tt,rt){s.clearVertexLookup();const ot=this.computeVertexConnections(a,_,j,tt.min,tt.max),ct=1/rt,ht=.5*ct,mt=(hn,vn)=>Kr(hn,a[vn].x,a[vn].y,_[vn]*ct),gt=Sr(),_t=Sr(),Rt=Sr(),Pt=Sr(),zt=Sr(),Vt=(hn,vn)=>{const tn=ot.get(Uu.computePosHash(a[vn])),dn=tn.from,qr=tn.to;if(!dn||!qr)return;mt(gt,dn),mt(_t,vn),mt(Rt,qr),ws(Pt),Jn(gt,_t)||(Hs(zt,_t,gt),ss(Pt,zt)),Jn(Rt,_t)||(Hs(zt,Rt,_t),Xt(Pt,Pt,ss(zt,zt)));const Gr=Xo(Pt);return Gr>0?Cr(hn,Pt,1/Gr):void 0};let Gt=Number.POSITIVE_INFINITY;this.sortSubarray(j,tt.min,tt.max,(hn,vn)=>hn.featureInfo.featureIndex-vn.featureInfo.featureIndex);const _i=Sr(),er=Sr(),rr=Sr(),_r=Sr(),xr=Sr(),Er=Sr(),Ar=Sr(),Pr=Sr(),sn=Sr(),Fr=[Sr(),Sr(),Sr(),Sr()],on=[Sr(),Sr(),Sr(),Sr()],gn=[{coord:new yn(0,0),height:0},{coord:new yn(0,0),height:0}],an=(hn,vn)=>hn>vn;for(let hn=tt.min;hn<tt.max;hn++){const vn=j[hn];if(!vn.featureInfo.guardRailEnabled||!this.prepareEdgePoints(gn,a,_,vn,an))continue;const[tn,dn]=gn;if(Kr(_i,tn.coord.x,tn.coord.y,ct*tn.height),Kr(er,dn.coord.x,dn.coord.y,ct*dn.height),Jn(_i,er))continue;Hs(rr,er,_i),ss(rr,rr);const qr=Vt(Pr,vn.a)||rr,Gr=Vt(sn,vn.b)||rr;Kr(_r,qr[1],-qr[0],0),ss(_r,_r),Kr(xr,Gr[1],-Gr[0],0),ss(xr,xr),$s(Pr,_r,qr),ss(Er,Pr),$s(Pr,xr,Gr),ss(Ar,Pr),Xt(Fr[0],_i,Cr(Pr,Hs(Pr,_r,Er),ht)),Xt(Fr[1],_i,Cr(Pr,Xt(Pr,_r,Er),ht)),Xt(Fr[2],_i,Cr(Pr,Er,ht)),Fr[3]=_i,Xt(on[0],er,Cr(Pr,Hs(Pr,xr,Ar),ht)),Xt(on[1],er,Cr(Pr,Xt(Pr,xr,Ar),ht)),Xt(on[2],er,Cr(Pr,Ar,ht)),on[3]=er,Gt=this.addFeatureSection(vn.featureInfo.featureIndex,Gt,this.bridgeFeatureSections,s);const wn=s.addVertex(Fr[0],_r,rt),_n=s.addVertex(Fr[1],_r,rt),Yn=s.addVertex(on[0],xr,rt),jn=s.addVertex(on[1],xr,rt);s.addTriangle(wn,_n,Yn),s.addTriangle(_n,jn,Yn);const Bn=s.addVertex(Fr[1],Er,rt),An=s.addVertex(Fr[2],Er,rt),Kn=s.addVertex(on[1],Ar,rt),ps=s.addVertex(on[2],Ar,rt);s.addTriangle(Bn,An,Kn),s.addTriangle(An,ps,Kn),As(_r,_r),As(xr,xr);const kn=s.addVertex(Fr[2],_r,rt),$n=s.addVertex(Fr[3],_r,rt),ls=s.addVertex(on[2],xr,rt),ms=s.addVertex(on[3],xr,rt);s.addTriangle(kn,$n,ls),s.addTriangle($n,ms,ls);const Is=this.isTerminalVertex(vn.a,ot),xs=this.isTerminalVertex(vn.b,ot);tn.height<.01&&Is&&s.addQuad(Fr[3],Fr[2],Fr[1],Fr[0],As(qr,qr),rt),dn.height<.01&&xs&&s.addQuad(on[0],on[1],on[2],on[3],Gr,rt)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:s.getVertexCount()})}constructTunnelStructures(s,a,_,j,tt,rt){s.clearVertexLookup();let ot=Number.POSITIVE_INFINITY;const ct=(Gt,_i)=>Gt.featureInfo.featureIndex-_i.featureInfo.featureIndex;this.sortSubarray(j,tt.min,tt.max,ct),this.sortSubarray(j,rt.min,rt.max,ct);const ht=Gt=>ss(Gt,Gt),mt=[{coord:new yn(0,0),height:0},{coord:new yn(0,0),height:0}],gt=(Gt,_i)=>Gt<_i,_t=Sr(),Rt=Sr(),Pt=Sr(),zt=Sr(),Vt=Sr();for(let Gt=tt.min;Gt<tt.max;Gt++){if(!this.prepareEdgePoints(mt,a,_,j[Gt],gt))continue;const[_i,er]=mt,rr=ht(Kr(Vt,-(er.coord.y-_i.coord.y),er.coord.x-_i.coord.x,0));ot=this.addFeatureSection(j[Gt].featureInfo.featureIndex,ot,this.tunnelFeatureSections,s),s.addQuad(Kr(_t,_i.coord.x,_i.coord.y,_i.height),Kr(Rt,er.coord.x,er.coord.y,er.height),Kr(Pt,er.coord.x,er.coord.y,j[Gt].isTunnel?-.1:0),Kr(zt,_i.coord.x,_i.coord.y,j[Gt].isTunnel?-.1:0),rr)}for(let Gt=rt.min;Gt<rt.max;Gt++){const _i=j[Gt];_i.isTunnel&&([_i.a,_i.b]=[_i.b,_i.a]);const er=a[_i.a],rr=a[_i.b],_r=ht(Kr(Vt,-(rr.y-er.y),rr.x-er.x,0));ot=this.addFeatureSection(_i.featureInfo.featureIndex,ot,this.tunnelFeatureSections,s),s.addQuad(Kr(_t,rr.x,rr.y,0),Kr(Rt,er.x,er.y,0),Kr(Pt,er.x,er.y,_[_i.a]+4),Kr(zt,rr.x,rr.y,_[_i.b]+4),_r),s.addQuad(Kr(_t,er.x,er.y,0),Kr(Rt,rr.x,rr.y,0),Kr(Pt,rr.x,rr.y,_[_i.b]+4),Kr(zt,er.x,er.y,_[_i.a]+4),_r)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:s.getVertexCount()})}setElevatedPoint(s,a,_,j){s.coord.x=a,s.coord.y=_,s.height=j}prepareEdgePoints(s,a,_,j,tt){let rt=a[j.a].x,ot=a[j.a].y,ct=a[j.b].x,ht=a[j.b].y,mt=_[j.a],gt=_[j.b];const _t=tt(mt,0),Rt=tt(gt,0);if(_t&&Rt)return this.setElevatedPoint(s[0],rt,ot,mt),this.setElevatedPoint(s[1],ct,ht,gt),!0;if(!_t&&!Rt)return!1;if(_t){if(!Rt){const Pt=gt/(gt-mt);ct=ns(ct,rt,Pt),ht=ns(ht,ot,Pt),gt=ns(gt,mt,Pt)}}else{const Pt=mt/(mt-gt);rt=ns(rt,ct,Pt),ot=ns(ot,ht,Pt),mt=ns(mt,gt,Pt)}return this.setElevatedPoint(s[0],rt,ot,mt),this.setElevatedPoint(s[1],ct,ht,gt),!0}prepareEdges(s,a){if(a.length===0)return;a.sort((ot,ct)=>ot.hash===ct.hash?ct.polygonIdx-ot.polygonIdx:ct.hash>ot.hash?1:-1);let _=0,j=0,tt=0,rt=a[_].polygonIdx;do j++,(j===a.length||a[_].hash!==a[j].hash)&&((j-_==1||a[j-1].polygonIdx!==rt)&&(tt<_&&(a[tt]=a[_],a[_]=null),a[tt].type="none",tt++),_=j,_!==a.length&&(rt=a[_].polygonIdx));while(_!==a.length);if(a.splice(tt),a.length!==0&&s.length!==0){a.sort((ht,mt)=>ht.portalHash<mt.portalHash?1:-1);let ot=0,ct=0;for(;ot!==a.length&&ct!==s.length;){const ht=a[ot],mt=s[ct];ht.portalHash>mt.hash?ot++:mt.hash>ht.portalHash?ct++:(ht.type=mt.type,ot++)}}}isOnBorder(s,a){return s<=0&&a<=0||s>=Rn&&a>=Rn}addFeatureSection(s,a,_,j){return s!==a&&(a=s,_.push({featureIndex:s,vertexStart:j.getVertexCount()}),j.clearVertexLookup()),a}sortSubarray(s,a,_,j){const tt=s.slice(a,_);tt.sort(j),s.splice(a,tt.length,...tt)}static computeEdgeHash(s,a){return(s.y===a.y&&s.x>a.x||s.y>a.y)&&([s,a]=[a,s]),BigInt(Uu.computePosHash(s))<<32n|BigInt(Uu.computePosHash(a))}static computePosHash(s){return((65535&s.x)<<16|65535&s.y)>>>0}}var BT,VT={exports:{}},UT=(BT||(BT=1,function(d,s){(function(a){function _(or,ar){return or>ar?1:or<ar?-1:0}var j=function(or,ar){or===void 0&&(or=_),ar===void 0&&(ar=!1),this._compare=or,this._root=null,this._size=0,this._noDuplicates=!!ar},tt={size:{configurable:!0}};function rt(or,ar,Wr,nn,Mn){var In=Mn-nn;if(In>0){var zn=nn+Math.floor(In/2),es={key:ar[zn],data:Wr[zn],parent:or};return es.left=rt(es,ar,Wr,nn,zn),es.right=rt(es,ar,Wr,zn+1,Mn),es}return null}function ot(or,ar,Wr,nn,Mn){if(!(Wr>=nn)){for(var In=or[Wr+nn>>1],zn=Wr-1,es=nn+1;;){do zn++;while(Mn(or[zn],In)<0);do es--;while(Mn(or[es],In)>0);if(zn>=es)break;var Ms=or[zn];or[zn]=or[es],or[es]=Ms,Ms=ar[zn],ar[zn]=ar[es],ar[es]=Ms}ot(or,ar,Wr,es,Mn),ot(or,ar,es+1,nn,Mn)}}j.prototype.rotateLeft=function(or){var ar=or.right;ar&&(or.right=ar.left,ar.left&&(ar.left.parent=or),ar.parent=or.parent),or.parent?or===or.parent.left?or.parent.left=ar:or.parent.right=ar:this._root=ar,ar&&(ar.left=or),or.parent=ar},j.prototype.rotateRight=function(or){var ar=or.left;ar&&(or.left=ar.right,ar.right&&(ar.right.parent=or),ar.parent=or.parent),or.parent?or===or.parent.left?or.parent.left=ar:or.parent.right=ar:this._root=ar,ar&&(ar.right=or),or.parent=ar},j.prototype._splay=function(or){for(;or.parent;){var ar=or.parent;ar.parent?ar.left===or&&ar.parent.left===ar?(this.rotateRight(ar.parent),this.rotateRight(ar)):ar.right===or&&ar.parent.right===ar?(this.rotateLeft(ar.parent),this.rotateLeft(ar)):ar.left===or&&ar.parent.right===ar?(this.rotateRight(ar),this.rotateLeft(ar)):(this.rotateLeft(ar),this.rotateRight(ar)):ar.left===or?this.rotateRight(ar):this.rotateLeft(ar)}},j.prototype.splay=function(or){for(var ar,Wr,nn,Mn,In;or.parent;)(Wr=(ar=or.parent).parent)&&Wr.parent?((nn=Wr.parent).left===Wr?nn.left=or:nn.right=or,or.parent=nn):(or.parent=null,this._root=or),Mn=or.left,In=or.right,or===ar.left?(Wr&&(Wr.left===ar?(ar.right?(Wr.left=ar.right,Wr.left.parent=Wr):Wr.left=null,ar.right=Wr,Wr.parent=ar):(Mn?(Wr.right=Mn,Mn.parent=Wr):Wr.right=null,or.left=Wr,Wr.parent=or)),In?(ar.left=In,In.parent=ar):ar.left=null,or.right=ar,ar.parent=or):(Wr&&(Wr.right===ar?(ar.left?(Wr.right=ar.left,Wr.right.parent=Wr):Wr.right=null,ar.left=Wr,Wr.parent=ar):(In?(Wr.left=In,In.parent=Wr):Wr.left=null,or.right=Wr,Wr.parent=or)),Mn?(ar.right=Mn,Mn.parent=ar):ar.right=null,or.left=ar,ar.parent=or)},j.prototype.replace=function(or,ar){or.parent?or===or.parent.left?or.parent.left=ar:or.parent.right=ar:this._root=ar,ar&&(ar.parent=or.parent)},j.prototype.minNode=function(or){if(or===void 0&&(or=this._root),or)for(;or.left;)or=or.left;return or},j.prototype.maxNode=function(or){if(or===void 0&&(or=this._root),or)for(;or.right;)or=or.right;return or},j.prototype.insert=function(or,ar){var Wr=this._root,nn=null,Mn=this._compare;if(this._noDuplicates)for(;Wr;){if(nn=Wr,Mn(Wr.key,or)===0)return;Wr=Mn(Wr.key,or)<0?Wr.right:Wr.left}else for(;Wr;)nn=Wr,Wr=Mn(Wr.key,or)<0?Wr.right:Wr.left;return Wr={key:or,data:ar,left:null,right:null,parent:nn},nn?Mn(nn.key,Wr.key)<0?nn.right=Wr:nn.left=Wr:this._root=Wr,this.splay(Wr),this._size++,Wr},j.prototype.find=function(or){for(var ar=this._root,Wr=this._compare;ar;){var nn=Wr(ar.key,or);if(nn<0)ar=ar.right;else{if(!(nn>0))return ar;ar=ar.left}}return null},j.prototype.contains=function(or){for(var ar=this._root,Wr=this._compare;ar;){var nn=Wr(or,ar.key);if(nn===0)return!0;ar=nn<0?ar.left:ar.right}return!1},j.prototype.remove=function(or){var ar=this.find(or);if(!ar)return!1;if(this.splay(ar),ar.left)if(ar.right){var Wr=this.minNode(ar.right);Wr.parent!==ar&&(this.replace(Wr,Wr.right),Wr.right=ar.right,Wr.right.parent=Wr),this.replace(ar,Wr),Wr.left=ar.left,Wr.left.parent=Wr}else this.replace(ar,ar.left);else this.replace(ar,ar.right);return this._size--,!0},j.prototype.removeNode=function(or){if(!or)return!1;if(this.splay(or),or.left)if(or.right){var ar=this.minNode(or.right);ar.parent!==or&&(this.replace(ar,ar.right),ar.right=or.right,ar.right.parent=ar),this.replace(or,ar),ar.left=or.left,ar.left.parent=ar}else this.replace(or,or.left);else this.replace(or,or.right);return this._size--,!0},j.prototype.erase=function(or){var ar=this.find(or);if(ar){this.splay(ar);var Wr=ar.left,nn=ar.right,Mn=null;Wr&&(Wr.parent=null,Mn=this.maxNode(Wr),this.splay(Mn),this._root=Mn),nn&&(Wr?Mn.right=nn:this._root=nn,nn.parent=Mn),this._size--}},j.prototype.pop=function(){var or=this._root,ar=null;if(or){for(;or.left;)or=or.left;ar={key:or.key,data:or.data},this.remove(or.key)}return ar},j.prototype.next=function(or){var ar=or;if(ar)if(ar.right)for(ar=ar.right;ar&&ar.left;)ar=ar.left;else for(ar=or.parent;ar&&ar.right===or;)or=ar,ar=ar.parent;return ar},j.prototype.prev=function(or){var ar=or;if(ar)if(ar.left)for(ar=ar.left;ar&&ar.right;)ar=ar.right;else for(ar=or.parent;ar&&ar.left===or;)or=ar,ar=ar.parent;return ar},j.prototype.forEach=function(or){for(var ar=this._root,Wr=[],nn=!1,Mn=0;!nn;)ar?(Wr.push(ar),ar=ar.left):Wr.length>0?(or(ar=Wr.pop(),Mn++),ar=ar.right):nn=!0;return this},j.prototype.range=function(or,ar,Wr,nn){for(var Mn=[],In=this._compare,zn=this._root;Mn.length!==0||zn;)if(zn)Mn.push(zn),zn=zn.left;else{if(In((zn=Mn.pop()).key,ar)>0)break;if(In(zn.key,or)>=0&&Wr.call(nn,zn))return this;zn=zn.right}return this},j.prototype.keys=function(){for(var or=this._root,ar=[],Wr=[],nn=!1;!nn;)or?(ar.push(or),or=or.left):ar.length>0?(or=ar.pop(),Wr.push(or.key),or=or.right):nn=!0;return Wr},j.prototype.values=function(){for(var or=this._root,ar=[],Wr=[],nn=!1;!nn;)or?(ar.push(or),or=or.left):ar.length>0?(or=ar.pop(),Wr.push(or.data),or=or.right):nn=!0;return Wr},j.prototype.at=function(or){for(var ar=this._root,Wr=[],nn=!1,Mn=0;!nn;)if(ar)Wr.push(ar),ar=ar.left;else if(Wr.length>0){if(ar=Wr.pop(),Mn===or)return ar;Mn++,ar=ar.right}else nn=!0;return null},j.prototype.load=function(or,ar,Wr){if(or===void 0&&(or=[]),ar===void 0&&(ar=[]),Wr===void 0&&(Wr=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var nn=or.length;return Wr&&ot(or,ar,0,nn-1,this._compare),this._root=rt(null,or,ar,0,nn),this._size=nn,this},j.prototype.min=function(){var or=this.minNode(this._root);return or?or.key:null},j.prototype.max=function(){var or=this.maxNode(this._root);return or?or.key:null},j.prototype.isEmpty=function(){return this._root===null},tt.size.get=function(){return this._size},j.createTree=function(or,ar,Wr,nn,Mn){return new j(Wr,Mn).load(or,ar,nn)},Object.defineProperties(j.prototype,tt);var ct=0,ht=1,mt=2,gt=3,_t=0,Rt=1,Pt=2,zt=3;function Vt(or,ar,Wr){ar===null?(or.inOut=!1,or.otherInOut=!0):(or.isSubject===ar.isSubject?(or.inOut=!ar.inOut,or.otherInOut=ar.otherInOut):(or.inOut=!ar.otherInOut,or.otherInOut=ar.isVertical()?!ar.inOut:ar.inOut),ar&&(or.prevInResult=!Gt(ar,Wr)||ar.isVertical()?ar.prevInResult:ar));var nn=Gt(or,Wr);or.resultTransition=nn?function(Mn,In){var zn,es=!Mn.inOut,Ms=!Mn.otherInOut;switch(In){case _t:zn=es&&Ms;break;case Rt:zn=es||Ms;break;case zt:zn=es^Ms;break;case Pt:zn=Mn.isSubject?es&&!Ms:Ms&&!es}return zn?1:-1}(or,Wr):0}function Gt(or,ar){switch(or.type){case ct:switch(ar){case _t:return!or.otherInOut;case Rt:return or.otherInOut;case Pt:return or.isSubject&&or.otherInOut||!or.isSubject&&!or.otherInOut;case zt:return!0}break;case mt:return ar===_t||ar===Rt;case gt:return ar===Pt;case ht:return!1}return!1}var _i=function(or,ar,Wr,nn,Mn){this.left=ar,this.point=or,this.otherEvent=Wr,this.isSubject=nn,this.type=Mn||ct,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},er={inResult:{configurable:!0}};function rr(or,ar){return or[0]===ar[0]&&or[1]===ar[1]}_i.prototype.isBelow=function(or){var ar=this.point,Wr=this.otherEvent.point;return this.left?(ar[0]-or[0])*(Wr[1]-or[1])-(Wr[0]-or[0])*(ar[1]-or[1])>0:(Wr[0]-or[0])*(ar[1]-or[1])-(ar[0]-or[0])*(Wr[1]-or[1])>0},_i.prototype.isAbove=function(or){return!this.isBelow(or)},_i.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},er.inResult.get=function(){return this.resultTransition!==0},_i.prototype.clone=function(){var or=new _i(this.point,this.left,this.otherEvent,this.isSubject,this.type);return or.contourId=this.contourId,or.resultTransition=this.resultTransition,or.prevInResult=this.prevInResult,or.isExteriorRing=this.isExteriorRing,or.inOut=this.inOut,or.otherInOut=this.otherInOut,or},Object.defineProperties(_i.prototype,er);var _r=11102230246251565e-32,xr=134217729,Er=(3+8*_r)*_r;function Ar(or,ar,Wr,nn,Mn){var In,zn,es,Ms,ks=ar[0],Ps=nn[0],oo=0,Lo=0;Ps>ks==Ps>-ks?(In=ks,ks=ar[++oo]):(In=Ps,Ps=nn[++Lo]);var Cs=0;if(oo<or&&Lo<Wr)for(Ps>ks==Ps>-ks?(es=In-((zn=ks+In)-ks),ks=ar[++oo]):(es=In-((zn=Ps+In)-Ps),Ps=nn[++Lo]),In=zn,es!==0&&(Mn[Cs++]=es);oo<or&&Lo<Wr;)Ps>ks==Ps>-ks?(es=In-((zn=In+ks)-(Ms=zn-In))+(ks-Ms),ks=ar[++oo]):(es=In-((zn=In+Ps)-(Ms=zn-In))+(Ps-Ms),Ps=nn[++Lo]),In=zn,es!==0&&(Mn[Cs++]=es);for(;oo<or;)es=In-((zn=In+ks)-(Ms=zn-In))+(ks-Ms),ks=ar[++oo],In=zn,es!==0&&(Mn[Cs++]=es);for(;Lo<Wr;)es=In-((zn=In+Ps)-(Ms=zn-In))+(Ps-Ms),Ps=nn[++Lo],In=zn,es!==0&&(Mn[Cs++]=es);return In===0&&Cs!==0||(Mn[Cs++]=In),Cs}function Pr(or){return new Float64Array(or)}var sn=33306690738754716e-32,Fr=22204460492503146e-32,on=11093356479670487e-47,gn=Pr(4),an=Pr(8),hn=Pr(12),vn=Pr(16),tn=Pr(4);function dn(or,ar,Wr){var nn=function(Mn,In,zn,es,Ms,ks){var Ps=(In-ks)*(zn-Ms),oo=(Mn-Ms)*(es-ks),Lo=Ps-oo;if(Ps===0||oo===0||Ps>0!=oo>0)return Lo;var Cs=Math.abs(Ps+oo);return Math.abs(Lo)>=sn*Cs?Lo:-function(_o,lo,Ks,wo,Eo,mo,xo){var co,Ds,uo,Vo,us,Us,To,Wo,Ro,Al,fo,wl,Pu,ru,Ql,Iu,Sm,Rl,Bl=_o-Eo,nu=Ks-Eo,fu=lo-mo,cu=wo-mo;gn[0]=(Ql=(Wo=Bl-(To=(Us=xr*Bl)-(Us-Bl)))*(Al=cu-(Ro=(Us=xr*cu)-(Us-cu)))-((ru=Bl*cu)-To*Ro-Wo*Ro-To*Al))-((fo=Ql-(Sm=(Wo=fu-(To=(Us=xr*fu)-(Us-fu)))*(Al=nu-(Ro=(Us=xr*nu)-(Us-nu)))-((Iu=fu*nu)-To*Ro-Wo*Ro-To*Al)))+(us=Ql-fo))+(us-Sm),gn[1]=(Pu=ru-((wl=ru+fo)-(us=wl-ru))+(fo-us))-((fo=Pu-Iu)+(us=Pu-fo))+(us-Iu),gn[2]=wl-((Rl=wl+fo)-(us=Rl-wl))+(fo-us),gn[3]=Rl;var qy=function(OI,iA){for(var rA=iA[0],hT=1;hT<4;hT++)rA+=iA[hT];return rA}(0,gn),A0=Fr*xo;if(qy>=A0||-qy>=A0||(co=_o-(Bl+(us=_o-Bl))+(us-Eo),uo=Ks-(nu+(us=Ks-nu))+(us-Eo),Ds=lo-(fu+(us=lo-fu))+(us-mo),Vo=wo-(cu+(us=wo-cu))+(us-mo),co===0&&Ds===0&&uo===0&&Vo===0)||(A0=on*xo+Er*Math.abs(qy),(qy+=Bl*Vo+cu*co-(fu*uo+nu*Ds))>=A0||-qy>=A0))return qy;tn[0]=(Ql=(Wo=co-(To=(Us=xr*co)-(Us-co)))*(Al=cu-(Ro=(Us=xr*cu)-(Us-cu)))-((ru=co*cu)-To*Ro-Wo*Ro-To*Al))-((fo=Ql-(Sm=(Wo=Ds-(To=(Us=xr*Ds)-(Us-Ds)))*(Al=nu-(Ro=(Us=xr*nu)-(Us-nu)))-((Iu=Ds*nu)-To*Ro-Wo*Ro-To*Al)))+(us=Ql-fo))+(us-Sm),tn[1]=(Pu=ru-((wl=ru+fo)-(us=wl-ru))+(fo-us))-((fo=Pu-Iu)+(us=Pu-fo))+(us-Iu),tn[2]=wl-((Rl=wl+fo)-(us=Rl-wl))+(fo-us),tn[3]=Rl;var LI=Ar(4,gn,4,tn,an);tn[0]=(Ql=(Wo=Bl-(To=(Us=xr*Bl)-(Us-Bl)))*(Al=Vo-(Ro=(Us=xr*Vo)-(Us-Vo)))-((ru=Bl*Vo)-To*Ro-Wo*Ro-To*Al))-((fo=Ql-(Sm=(Wo=fu-(To=(Us=xr*fu)-(Us-fu)))*(Al=uo-(Ro=(Us=xr*uo)-(Us-uo)))-((Iu=fu*uo)-To*Ro-Wo*Ro-To*Al)))+(us=Ql-fo))+(us-Sm),tn[1]=(Pu=ru-((wl=ru+fo)-(us=wl-ru))+(fo-us))-((fo=Pu-Iu)+(us=Pu-fo))+(us-Iu),tn[2]=wl-((Rl=wl+fo)-(us=Rl-wl))+(fo-us),tn[3]=Rl;var jI=Ar(LI,an,4,tn,hn);tn[0]=(Ql=(Wo=co-(To=(Us=xr*co)-(Us-co)))*(Al=Vo-(Ro=(Us=xr*Vo)-(Us-Vo)))-((ru=co*Vo)-To*Ro-Wo*Ro-To*Al))-((fo=Ql-(Sm=(Wo=Ds-(To=(Us=xr*Ds)-(Us-Ds)))*(Al=uo-(Ro=(Us=xr*uo)-(Us-uo)))-((Iu=Ds*uo)-To*Ro-Wo*Ro-To*Al)))+(us=Ql-fo))+(us-Sm),tn[1]=(Pu=ru-((wl=ru+fo)-(us=wl-ru))+(fo-us))-((fo=Pu-Iu)+(us=Pu-fo))+(us-Iu),tn[2]=wl-((Rl=wl+fo)-(us=Rl-wl))+(fo-us),tn[3]=Rl;var FI=Ar(jI,hn,4,tn,vn);return vn[FI-1]}(Mn,In,zn,es,Ms,ks,Cs)}(or[0],or[1],ar[0],ar[1],Wr[0],Wr[1]);return nn>0?-1:nn<0?1:0}function qr(or,ar){var Wr=or.point,nn=ar.point;return Wr[0]>nn[0]?1:Wr[0]<nn[0]?-1:Wr[1]!==nn[1]?Wr[1]>nn[1]?1:-1:function(Mn,In,zn,es){return Mn.left!==In.left?Mn.left?1:-1:dn(zn,Mn.otherEvent.point,In.otherEvent.point)!==0?Mn.isBelow(In.otherEvent.point)?-1:1:!Mn.isSubject&&In.isSubject?1:-1}(or,ar,Wr)}function Gr(or,ar,Wr){var nn=new _i(ar,!1,or,or.isSubject),Mn=new _i(ar,!0,or.otherEvent,or.isSubject);return rr(or.point,or.otherEvent.point)&&console.warn("what is that, a collapsed segment?",or),nn.contourId=Mn.contourId=or.contourId,qr(Mn,or.otherEvent)>0&&(or.otherEvent.left=!0,Mn.left=!1),or.otherEvent.otherEvent=Mn,or.otherEvent=nn,Wr.push(Mn),Wr.push(nn),Wr}function wn(or,ar){return or[0]*ar[1]-or[1]*ar[0]}function _n(or,ar){return or[0]*ar[0]+or[1]*ar[1]}function Yn(or,ar,Wr){var nn=function(Ms,ks,Ps,oo,Lo){var Cs=[ks[0]-Ms[0],ks[1]-Ms[1]],_o=[oo[0]-Ps[0],oo[1]-Ps[1]];function lo(Us,To,Wo){return[Us[0]+To*Wo[0],Us[1]+To*Wo[1]]}var Ks=[Ps[0]-Ms[0],Ps[1]-Ms[1]],wo=wn(Cs,_o),Eo=wo*wo,mo=_n(Cs,Cs);if(Eo>0){var xo=wn(Ks,_o)/wo;if(xo<0||xo>1)return null;var co=wn(Ks,Cs)/wo;return co<0||co>1?null:xo===0||xo===1?[lo(Ms,xo,Cs)]:co===0||co===1?[lo(Ps,co,_o)]:[lo(Ms,xo,Cs)]}if((Eo=(wo=wn(Ks,Cs))*wo)>0)return null;var Ds=_n(Cs,Ks)/mo,uo=Ds+_n(Cs,_o)/mo,Vo=Math.min(Ds,uo),us=Math.max(Ds,uo);return Vo<=1&&us>=0?Vo===1?[lo(Ms,Vo>0?Vo:0,Cs)]:us===0?[lo(Ms,us<1?us:1,Cs)]:[lo(Ms,Vo>0?Vo:0,Cs),lo(Ms,us<1?us:1,Cs)]:null}(or.point,or.otherEvent.point,ar.point,ar.otherEvent.point),Mn=nn?nn.length:0;if(Mn===0||Mn===1&&(rr(or.point,ar.point)||rr(or.otherEvent.point,ar.otherEvent.point))||Mn===2&&or.isSubject===ar.isSubject)return 0;if(Mn===1)return rr(or.point,nn[0])||rr(or.otherEvent.point,nn[0])||Gr(or,nn[0],Wr),rr(ar.point,nn[0])||rr(ar.otherEvent.point,nn[0])||Gr(ar,nn[0],Wr),1;var In=[],zn=!1,es=!1;return rr(or.point,ar.point)?zn=!0:qr(or,ar)===1?In.push(ar,or):In.push(or,ar),rr(or.otherEvent.point,ar.otherEvent.point)?es=!0:qr(or.otherEvent,ar.otherEvent)===1?In.push(ar.otherEvent,or.otherEvent):In.push(or.otherEvent,ar.otherEvent),zn&&es||zn?(ar.type=ht,or.type=ar.inOut===or.inOut?mt:gt,zn&&!es&&Gr(In[1].otherEvent,In[0].point,Wr),2):es?(Gr(In[0],In[1].point,Wr),3):In[0]!==In[3].otherEvent?(Gr(In[0],In[1].point,Wr),Gr(In[1],In[2].point,Wr),3):(Gr(In[0],In[1].point,Wr),Gr(In[3].otherEvent,In[2].point,Wr),3)}function jn(or,ar){if(or===ar)return 0;if(dn(or.point,or.otherEvent.point,ar.point)!==0||dn(or.point,or.otherEvent.point,ar.otherEvent.point)!==0)return rr(or.point,ar.point)?or.isBelow(ar.otherEvent.point)?-1:1:or.point[0]===ar.point[0]?or.point[1]<ar.point[1]?-1:1:qr(or,ar)===1?ar.isAbove(or.point)?-1:1:or.isBelow(ar.point)?-1:1;if(or.isSubject!==ar.isSubject)return or.isSubject?-1:1;var Wr=or.point,nn=ar.point;return Wr[0]===nn[0]&&Wr[1]===nn[1]?(Wr=or.otherEvent.point)[0]===(nn=ar.otherEvent.point)[0]&&Wr[1]===nn[1]?0:or.contourId>ar.contourId?1:-1:qr(or,ar)===1?1:-1}var Bn=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function An(or,ar,Wr,nn){var Mn,In=or+1,zn=ar[or].point,es=ar.length;for(In<es&&(Mn=ar[In].point);In<es&&Mn[0]===zn[0]&&Mn[1]===zn[1];){if(!Wr[In])return In;++In<es&&(Mn=ar[In].point)}for(In=or-1;Wr[In]&&In>nn;)In--;return In}Bn.prototype.isExterior=function(){return this.holeOf==null};var Kn=kn,ps=kn;function kn(or,ar){if(!(this instanceof kn))return new kn(or,ar);if(this.data=or||[],this.length=this.data.length,this.compare=ar||$n,this.length>0)for(var Wr=(this.length>>1)-1;Wr>=0;Wr--)this._down(Wr)}function $n(or,ar){return or<ar?-1:or>ar?1:0}kn.prototype={push:function(or){this.data.push(or),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var or=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),or}},peek:function(){return this.data[0]},_up:function(or){for(var ar=this.data,Wr=this.compare,nn=ar[or];or>0;){var Mn=or-1>>1,In=ar[Mn];if(Wr(nn,In)>=0)break;ar[or]=In,or=Mn}ar[or]=nn},_down:function(or){for(var ar=this.data,Wr=this.compare,nn=this.length>>1,Mn=ar[or];or<nn;){var In=1+(or<<1),zn=In+1,es=ar[In];if(zn<this.length&&Wr(ar[zn],es)<0&&(In=zn,es=ar[zn]),Wr(es,Mn)>=0)break;ar[or]=es,or=In}ar[or]=Mn}},Kn.default=ps;var ls=Math.max,ms=Math.min,Is=0;function xs(or,ar,Wr,nn,Mn,In){var zn,es,Ms,ks,Ps,oo;for(zn=0,es=or.length-1;zn<es;zn++)if(ks=or[zn+1],Ps=new _i(Ms=or[zn],!1,void 0,ar),oo=new _i(ks,!1,Ps,ar),Ps.otherEvent=oo,Ms[0]!==ks[0]||Ms[1]!==ks[1]){Ps.contourId=oo.contourId=Wr,In||(Ps.isExteriorRing=!1,oo.isExteriorRing=!1),qr(Ps,oo)>0?oo.left=!0:Ps.left=!0;var Lo=Ms[0],Cs=Ms[1];Mn[0]=ms(Mn[0],Lo),Mn[1]=ms(Mn[1],Cs),Mn[2]=ls(Mn[2],Lo),Mn[3]=ls(Mn[3],Cs),nn.push(Ps),nn.push(oo)}}var Nn=[];function ys(or,ar,Wr){typeof or[0][0][0]=="number"&&(or=[or]),typeof ar[0][0][0]=="number"&&(ar=[ar]);var nn=function(Cs,_o,lo){var Ks=null;return Cs.length*_o.length==0&&(lo===_t?Ks=Nn:lo===Pt?Ks=Cs:lo!==Rt&&lo!==zt||(Ks=Cs.length===0?_o:Cs)),Ks}(or,ar,Wr);if(nn)return nn===Nn?null:nn;var Mn=[1/0,1/0,-1/0,-1/0],In=[1/0,1/0,-1/0,-1/0],zn=function(Cs,_o,lo,Ks,wo){var Eo,mo,xo,co,Ds,uo,Vo=new Kn(null,qr);for(xo=0,co=Cs.length;xo<co;xo++)for(Ds=0,uo=(Eo=Cs[xo]).length;Ds<uo;Ds++)(mo=Ds===0)&&Is++,xs(Eo[Ds],!0,Is,Vo,lo,mo);for(xo=0,co=_o.length;xo<co;xo++)for(Ds=0,uo=(Eo=_o[xo]).length;Ds<uo;Ds++)mo=Ds===0,wo===Pt&&(mo=!1),mo&&Is++,xs(Eo[Ds],!1,Is,Vo,Ks,mo);return Vo}(or,ar,Mn,In,Wr);if(nn=function(Cs,_o,lo,Ks,wo){var Eo=null;return(lo[0]>Ks[2]||Ks[0]>lo[2]||lo[1]>Ks[3]||Ks[1]>lo[3])&&(wo===_t?Eo=Nn:wo===Pt?Eo=Cs:wo!==Rt&&wo!==zt||(Eo=Cs.concat(_o))),Eo}(or,ar,Mn,In,Wr))return nn===Nn?null:nn;for(var es=function(Cs){var _o,lo,Ks=function(xo){var co,Ds,uo,Vo,us=[];for(Ds=0,uo=xo.length;Ds<uo;Ds++)((co=xo[Ds]).left&&co.inResult||!co.left&&co.otherEvent.inResult)&&us.push(co);for(var Us=!1;!Us;)for(Us=!0,Ds=0,uo=us.length;Ds<uo;Ds++)Ds+1<uo&&qr(us[Ds],us[Ds+1])===1&&(Vo=us[Ds],us[Ds]=us[Ds+1],us[Ds+1]=Vo,Us=!1);for(Ds=0,uo=us.length;Ds<uo;Ds++)(co=us[Ds]).otherPos=Ds;for(Ds=0,uo=us.length;Ds<uo;Ds++)(co=us[Ds]).left||(Vo=co.otherPos,co.otherPos=co.otherEvent.otherPos,co.otherEvent.otherPos=Vo);return us}(Cs),wo={},Eo=[],mo=function(){if(!wo[_o]){var xo=Eo.length,co=function(us,Us,To){var Wo=new Bn;if(us.prevInResult!=null){var Ro=us.prevInResult,Al=Ro.outputContourId;if(Ro.resultTransition>0){var fo=Us[Al];if(fo.holeOf!=null){var wl=fo.holeOf;Us[wl].holeIds.push(To),Wo.holeOf=wl,Wo.depth=Us[Al].depth}else Us[Al].holeIds.push(To),Wo.holeOf=Al,Wo.depth=Us[Al].depth+1}else Wo.holeOf=null,Wo.depth=Us[Al].depth}else Wo.holeOf=null,Wo.depth=0;return Wo}(Ks[_o],Eo,xo),Ds=function(us){wo[us]=!0,us<Ks.length&&Ks[us]&&(Ks[us].outputContourId=xo)},uo=_o,Vo=_o;for(co.points.push(Ks[_o].point);Ds(uo),Ds(uo=Ks[uo].otherPos),co.points.push(Ks[uo].point),!((uo=An(uo,Ks,wo,Vo))==Vo||uo>=Ks.length)&&Ks[uo];);Eo.push(co)}};for(_o=0,lo=Ks.length;_o<lo;_o++)mo();return Eo}(function(Cs,_o,lo,Ks,wo,Eo){for(var mo,xo,co,Ds=new j(jn),uo=[],Vo=Math.min(Ks[2],wo[2]);Cs.length!==0;){var us=Cs.pop();if(uo.push(us),Eo===_t&&us.point[0]>Vo||Eo===Pt&&us.point[0]>Ks[2])break;if(us.left){xo=mo=Ds.insert(us),mo=mo!==(co=Ds.minNode())?Ds.prev(mo):null,xo=Ds.next(xo);var Us=mo?mo.key:null;if(Vt(us,Us,Eo),xo&&Yn(us,xo.key,Cs)===2&&(Vt(us,Us,Eo),Vt(xo.key,us,Eo)),mo&&Yn(mo.key,us,Cs)===2){var To=mo;Vt(Us,(To=To!==co?Ds.prev(To):null)?To.key:null,Eo),Vt(us,Us,Eo)}}else xo=mo=Ds.find(us=us.otherEvent),mo&&xo&&(mo=mo!==co?Ds.prev(mo):null,xo=Ds.next(xo),Ds.remove(us),xo&&mo&&Yn(mo.key,xo.key,Cs))}return uo}(zn,0,0,Mn,In,Wr)),Ms=[],ks=0;ks<es.length;ks++){var Ps=es[ks];if(Ps.isExterior()){for(var oo=[Ps.points],Lo=0;Lo<Ps.holeIds.length;Lo++)oo.push(es[Ps.holeIds[Lo]].points);Ms.push(oo)}}return Ms}var Bs={UNION:Rt,DIFFERENCE:Pt,INTERSECTION:_t,XOR:zt};a.diff=function(or,ar){return ys(or,ar,Pt)},a.intersection=function(or,ar){return ys(or,ar,_t)},a.operations=Bs,a.union=function(or,ar){return ys(or,ar,Rt)},a.xor=function(or,ar){return ys(or,ar,zt)},Object.defineProperty(a,"__esModule",{value:!0})})(s)}(0,VT.exports)),VT.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function A1(d,s,a,_){const j=[],tt=_===0?(rt,ot,ct,ht,mt,gt)=>{rt.push(new yn(gt,ct+(gt-ot)/(ht-ot)*(mt-ct)))}:(rt,ot,ct,ht,mt,gt)=>{rt.push(new yn(ot+(gt-ct)/(mt-ct)*(ht-ot),gt))};for(const rt of d){const ot=[];for(const ct of rt){if(ct.length<=2)continue;const ht=[];for(let _t=0;_t<ct.length-1;_t++){const Rt=ct[_t].x,Pt=ct[_t].y,zt=ct[_t+1].x,Vt=ct[_t+1].y,Gt=_===0?Rt:Pt,_i=_===0?zt:Vt;Gt<s?_i>s&&tt(ht,Rt,Pt,zt,Vt,s):Gt>a?_i<a&&tt(ht,Rt,Pt,zt,Vt,a):ht.push(ct[_t]),_i<s&&Gt>=s&&tt(ht,Rt,Pt,zt,Vt,s),_i>a&&Gt<=a&&tt(ht,Rt,Pt,zt,Vt,a)}let mt=ct[ct.length-1];const gt=_===0?mt.x:mt.y;gt>=s&&gt<=a&&ht.push(mt),ht.length&&(mt=ht[ht.length-1],ht[0].x===mt.x&&ht[0].y===mt.y||ht.push(ht[0]),ot.push(ht))}ot.length&&j.push(ot)}return j}function MA(d,s){const a=oE(d),_=oE([s]),j=UT.intersection(a,_);return j==null?[]:GT(j)}function kA(d,s){let _=oE(d,65536);const j=[];for(;s.valid();s.next()){const[tt,rt]=s.get(),ot=tt.x*65536,ct=tt.y*65536,ht=rt.x*65536,mt=rt.y*65536,gt=ht-ot,_t=mt-ct,Rt=Math.hypot(gt,_t);if(Rt===0)continue;const Pt=Math.trunc(_t/Rt*3),zt=-Math.trunc(gt/Rt*3);j.push([[[ot,ct],[ht,mt],[ht+Pt,mt+zt],[ot+Pt,ct+zt],[ot,ct]]])}return j.length>0&&(_=UT.diff(_,j)),GT(_,1/65536)}function oE(d,s=1){return[d.map(a=>a.map(_=>[_.x*s,_.y*s]))]}function GT(d,s=1){return d.map(a=>a.map((_,j)=>{const tt=_.map(rt=>new yn(rt[0]*s,rt[1]*s).round());return j>0&&tt.reverse(),tt}))}class aE{constructor(s,a){this.layoutVertexArray=new gm,this.indexArray=new Dl,this.lineIndexArray=new Sl,this.triangleSegments=new Bo,this.lineSegments=new Bo,this.programConfigurations=new lp(s.layers,{zoom:s.zoom,lut:s.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new ym)}update(s,a,_,j,tt,rt,ot,ct){this.programConfigurations.updatePaintArrays(s,a,tt,_,j,rt,ot,ct)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,gA.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.lineIndexBuffer=s.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=s.createVertexBuffer(this.elevatedLayoutVertexArray,yA.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(s,a,_,j,tt,rt,ot){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,a,_,j,tt,rt,void 0,ot)}}class lE{constructor(s){this.zoom=s.zoom,this.pixelRatio=s.pixelRatio,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=s.lut,this.bufferData=new aE(s,!1),this.elevationBufferData=new aE(s,!0),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=s.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=s.sourceLayerIndex,this.worldview=s.worldview}updateFootprints(s,a){}populate(s,a,_,j){this.hasPattern=nE("fill",this.layers,this.pixelRatio,a);const tt=this.layers[0].layout.get("fill-sort-key"),rt=[];for(const{feature:ot,id:ct,index:ht,sourceLayerIndex:mt}of s){const gt=this.layers[0]._featureFilter.needGeometry,_t=xn(ot,gt);if(!this.layers[0]._featureFilter.filter(new yo(this.zoom,{worldview:this.worldview}),_t,_))continue;const Rt=tt?tt.evaluate(_t,{},_,a.availableImages):void 0,Pt={id:ct,properties:ot.properties,type:ot.type,sourceLayerIndex:mt,index:ht,geometry:gt?_t.geometry:Ln(ot,_,j),patterns:{},sortKey:Rt};rt.push(Pt)}tt&&rt.sort((ot,ct)=>ot.sortKey-ct.sortKey);for(const ot of rt){const{geometry:ct,index:ht,sourceLayerIndex:mt}=ot;if(this.hasPattern){const gt=sE("fill",this.layers,ot,this.zoom,this.pixelRatio,a);this.patternFeatures.push(gt)}else this.addFeature(ot,ct,ht,_,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(s[ht].feature,ct,ht,mt,this.index)}}update(s,a,_,j,tt,rt,ot){this.bufferData.update(s,a,_,j,tt,rt,ot,this.worldview),this.elevationBufferData.update(s,a,_,j,tt,rt,ot,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(s,a,_,j,tt,rt,ot,this.worldview)}addFeatures(s,a,_,j,tt,rt){for(const ot of this.patternFeatures)this.addFeature(ot,ot.geometry,ot.index,a,_,j,rt,s.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(s){this.bufferData.upload(s),this.elevationBufferData.upload(s),this.elevatedStructures&&this.elevatedStructures.upload(s)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(s,a,_,j,tt,rt=[],ot,ct){const ht=Kv(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(s,ht,j,_,ct):this.addGeometry(ht,this.bufferData),this.bufferData.populatePaintArrays(s,_,tt,rt,j,ot,this.worldview),this.elevationBufferData.populatePaintArrays(s,_,tt,rt,j,ot,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(s,a,_,j,tt){this.elevatedStructures&&(this.elevatedStructures.construct(s),this.elevatedStructures.populatePaintArrays(a,_,j,tt,this.worldview))}addElevatedRoadFeature(s,a,_,j,tt){const rt=new Array,ot=Fo.getElevationFeature(s,tt);if(!ot)return void this.addGeometry(a,this.bufferData);{const ht=this.clipPolygonsToTile(a,1);ht.length>0&&rt.push({polygons:ht,elevationFeature:ot,elevationTileID:_})}const ct={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(s,{},_),featureIndex:j};for(const ht of rt)if(ht.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Uu(ht.elevationTileID,this.layers,this.zoom,this.lut));const gt=ht.elevationFeature.isTunnel();let _t=0;s.properties.hasOwnProperty(no)&&(_t=+s.properties[no]);for(const Rt of ht.polygons)this.elevatedStructures.addPortalCandidates(ht.elevationFeature.id,Rt,gt,ht.elevationFeature,_t)}ht.elevationFeature.constantHeight==null&&(ht.polygons=this.prepareElevatedPolygons(ht.polygons,ht.elevationFeature,ht.elevationTileID));const mt=new yl(_,ht.elevationTileID);this.addElevatedGeometry(ht.polygons,mt,ht.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,j,ct)}}addElevatedGeometry(s,a,_,j,tt,rt){const ot={elevation:_,elevationSampler:a,bias:j,index:tt,featureInfo:rt},[ct,ht]=this.addGeometry(s,this.elevationBufferData,ot);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:ct,max:ht}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,ct),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,ht))}addGeometry(s,a,_){let j=Number.POSITIVE_INFINITY,tt=Number.NEGATIVE_INFINITY,rt=null;_&&(rt=_.elevationSampler.constantElevation(_.elevation,_.bias),rt!=null&&(j=rt,tt=rt));const ot=(ct,ht,mt)=>{if(_!=null)if(ht.push(ct),rt!=null)a.elevatedLayoutVertexArray.emplaceBack(rt),mt.push(rt);else{const gt=_.elevationSampler.pointElevation(ct,_.elevation,_.bias);a.elevatedLayoutVertexArray.emplaceBack(gt),mt.push(gt),j=Math.min(j,gt),tt=Math.max(tt,gt)}};for(const ct of s){let ht=0;for(const er of ct)ht+=er.length;const mt=a.triangleSegments.prepareSegment(ht,a.layoutVertexArray,a.indexArray),gt=mt.vertexLength,_t=[],Rt=[],Pt=[],zt=[],Vt=[],Gt=a.layoutVertexArray.length;for(const er of ct){if(er.length===0)continue;er!==ct[0]&&Rt.push(_t.length/2);const rr=a.lineSegments.prepareSegment(er.length,a.layoutVertexArray,a.lineIndexArray),_r=rr.vertexLength;_&&Vt.push(a.layoutVertexArray.length-Gt),ot(er[0],Pt,zt),a.layoutVertexArray.emplaceBack(er[0].x,er[0].y),a.lineIndexArray.emplaceBack(_r+er.length-1,_r),_t.push(er[0].x),_t.push(er[0].y);for(let xr=1;xr<er.length;xr++)ot(er[xr],Pt,zt),a.layoutVertexArray.emplaceBack(er[xr].x,er[xr].y),a.lineIndexArray.emplaceBack(_r+xr-1,_r+xr),_t.push(er[xr].x),_t.push(er[xr].y);rr.vertexLength+=er.length,rr.primitiveLength+=er.length}const _i=Mx(_t,Rt);for(let er=0;er<_i.length;er+=3)a.indexArray.emplaceBack(gt+_i[er],gt+_i[er+1],gt+_i[er+2]);if(_i.length>0&&_&&this.elevationMode==="hd-road-base"){const er=_.elevation.isTunnel(),rr=_.elevation.safeArea,_r=this.elevatedStructures.addVertices(Pt,zt);this.elevatedStructures.addTriangles(_i,_r,er);const xr=Vt.length;if(xr>0){for(let Er=0;Er<xr-1;Er++)this.elevatedStructures.addRenderableRing(_.index,Vt[Er]+_r,Vt[Er+1]-Vt[Er],er,rr,_.featureInfo);this.elevatedStructures.addRenderableRing(_.index,Vt[xr-1]+_r,Pt.length-Vt[xr-1],er,rr,_.featureInfo)}}mt.vertexLength+=ht,mt.primitiveLength+=_i.length/3}return[j,tt]}prepareElevatedPolygons(s,a,_){const j=1/Nr(_),tt=[];for(const rt of s){const ot=kA(rt,new so(a,j));tt.push(...ot)}return tt}clipPolygonsToTile(s,a){const _=-a,j=-a,tt=Rn+a,rt=Rn+a;let ot=0;const ct=[],ht=[];for(;ot<s.length;ot++){const _t=s[ot],Rt=D_(_t);(Rt.min.x>=_&&Rt.max.x<=tt&&Rt.min.y>=j&&Rt.max.y<=rt?ct:ht).push(_t)}if(ct.length===s.length)return s;const mt=[new yn(_,j),new yn(tt,j),new yn(tt,rt),new yn(_,rt),new yn(_,j)],gt=ct;for(const _t of ht)gt.push(...MA(_t,mt));return gt}}let $T,HT,WT,qT;Fn(lE,"FillBucket",{omit:["layers","patternFeatures"]}),Fn(aE,"FillBufferData"),Fn(Uu,"ElevatedStructures");class R1{constructor(s,a,_,j){if(this.triangleCount=a.length/3,this.min=new yn(0,0),this.max=new yn(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||s.length===0)return;const[tt,rt]=[s[0].clone(),s[0].clone()];for(let gt=1;gt<s.length;++gt){const _t=s[gt];tt.x=Math.min(tt.x,_t.x),tt.y=Math.min(tt.y,_t.y),rt.x=Math.max(rt.x,_t.x),rt.y=Math.max(rt.y,_t.y)}if(j){const gt=Math.ceil(Math.max(rt.x-tt.x,rt.y-tt.y)/j);_=Math.max(_,gt)}if(_===0)return;this.min=tt,this.max=rt;const ot=this.max.sub(this.min);ot.x=Math.max(ot.x,1),ot.y=Math.max(ot.y,1);const ct=Math.max(ot.x,ot.y)/_;this.cellsX=Math.max(1,Math.ceil(ot.x/ct)),this.cellsY=Math.max(1,Math.ceil(ot.y/ct)),this.xScale=1/ct,this.yScale=1/ct;const ht=[];for(let gt=0;gt<this.triangleCount;gt++){const _t=s[a[3*gt+0]].sub(this.min),Rt=s[a[3*gt+1]].sub(this.min),Pt=s[a[3*gt+2]].sub(this.min),zt=Em(Math.floor(Math.min(_t.x,Rt.x,Pt.x)),this.xScale,this.cellsX),Vt=Em(Math.floor(Math.max(_t.x,Rt.x,Pt.x)),this.xScale,this.cellsX),Gt=Em(Math.floor(Math.min(_t.y,Rt.y,Pt.y)),this.yScale,this.cellsY),_i=Em(Math.floor(Math.max(_t.y,Rt.y,Pt.y)),this.yScale,this.cellsY),er=new yn(0,0),rr=new yn(0,0),_r=new yn(0,0),xr=new yn(0,0);for(let Er=Gt;Er<=_i;++Er){er.y=rr.y=Er*ct,_r.y=xr.y=(Er+1)*ct;for(let Ar=zt;Ar<=Vt;++Ar)er.x=_r.x=Ar*ct,rr.x=xr.x=(Ar+1)*ct,(Np(_t,Rt,Pt,er,rr,xr)||Np(_t,Rt,Pt,er,xr,_r))&&ht.push({cellIdx:Er*this.cellsX+Ar,triIdx:gt})}}if(ht.length===0)return;ht.sort((gt,_t)=>gt.cellIdx-_t.cellIdx||gt.triIdx-_t.triIdx);let mt=0;for(;mt<ht.length;){const gt=ht[mt].cellIdx,_t={start:this.payload.length,len:0};for(;mt<ht.length&&ht[mt].cellIdx===gt;)++_t.len,this.payload.push(ht[mt++].triIdx);this.cells[gt]=_t}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(s,a){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>s.x||s.y>this.max.y||this.min.y>s.y)return;const _=Em(s.x-this.min.x,this.xScale,this.cellsX),j=Em(s.y-this.min.y,this.yScale,this.cellsY),tt=this.cells[j*this.cellsX+_];if(tt){this._lazyInitLookup();for(let rt=0;rt<tt.len;rt++){const ot=this.payload[tt.start+rt],ct=Math.floor(ot/8),ht=1<<ot%8;if(!(this.lookup[ct]&ht)&&(this.lookup[ct]|=ht,a.push(ot),a.length===this.triangleCount))return}}}query(s,a,_){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>a.x||s.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const j=Em(s.x-this.min.x,this.xScale,this.cellsX),tt=Em(a.x-this.min.x,this.xScale,this.cellsX),rt=Em(s.y-this.min.y,this.yScale,this.cellsY),ot=Em(a.y-this.min.y,this.yScale,this.cellsY);for(let ct=rt;ct<=ot;ct++)for(let ht=j;ht<=tt;ht++){const mt=this.cells[ct*this.cellsX+ht];if(mt)for(let gt=0;gt<mt.len;gt++){const _t=this.payload[mt.start+gt],Rt=Math.floor(_t/8),Pt=1<<_t%8;if(!(this.lookup[Rt]&Pt)&&(this.lookup[Rt]|=Pt,_.push(_t),_.length===this.triangleCount))return}}}}function Em(d,s,a){return Math.max(0,Math.min(a-1,Math.floor(d*s)))}Fn(R1,"TriangleGridIndex");class ZT{constructor(s){this.zoom=s.zoom,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[],this.worldview=s.worldview}updateFootprints(s,a){for(const _ of this.footprints)a.push({footprint:_,id:s})}populate(s,a,_,j){const tt=[];for(const{feature:rt,id:ot,index:ct,sourceLayerIndex:ht}of s){const mt=this.layers[0]._featureFilter.needGeometry,gt=xn(rt,mt);if(!this.layers[0]._featureFilter.filter(new yo(this.zoom,{worldview:this.worldview}),gt,_))continue;const _t={id:ot,properties:rt.properties,type:rt.type,sourceLayerIndex:ht,index:ct,geometry:mt?gt.geometry:Ln(rt,_,j),patterns:{}};tt.push(_t)}for(const rt of tt){const{geometry:ot,index:ct,sourceLayerIndex:ht}=rt;this.addFeature(rt,ot,ct,_,{},a.availableImages,a.brightness),a.featureIndex.insert(s[ct].feature,ot,ct,ht,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(s){}update(s,a,_,j,tt,rt,ot){}destroy(){}addFeature(s,a,_,j,tt,rt=[],ot){for(const ct of Kv(a,2)){const ht=[],mt=[],gt=[],_t=new yn(1/0,1/0),Rt=new yn(-1/0,-1/0);for(const Vt of ct)if(Vt.length!==0){Vt!==ct[0]&&gt.push(mt.length/2);for(let Gt=0;Gt<Vt.length;Gt++)mt.push(Vt[Gt].x),mt.push(Vt[Gt].y),ht.push(Vt[Gt]),_t.x=Math.min(_t.x,Vt[Gt].x),_t.y=Math.min(_t.y,Vt[Gt].y),Rt.x=Math.max(Rt.x,Vt[Gt].x),Rt.y=Math.max(Rt.y,Vt[Gt].y)}const Pt=Mx(mt,gt),zt=new R1(ht,Pt,8,256);this.footprints.push({vertices:ht,indices:Pt,grid:zt,min:_t,max:Rt})}}}Fn(ZT,"ClipBucket",{omit:["layers"]});const DA=zs([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),LA=zs([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),jA=zs([{name:"a_centroid_pos",components:2,type:"Uint16"}]),FA=zs([{name:"a_join_normal_inside",components:3,type:"Int16"}]),OA=zs([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),zA=zs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:NA}=DA,Yv=Number.MAX_SAFE_INTEGER,XT=Yv-1;function KT(d,s,a,_){return d.order<s||d.order===Yv||!(d.clipMask&a)||function(j,tt){return tt.length!==0&&tt.find(rt=>rt===j)===void 0}(_,d.clipScope)}function P1(d,s){return d.x-s.x||d.y-s.y}function YT(d,s){return P1(d.min,s.min)===0&&P1(d.max,s.max)===0}function cE(d,s){return!(d.min.x>s.max.x||d.max.x<s.min.x||d.min.y>s.max.y||d.max.y<s.min.y)}function I1(d,s){if(d.length!==s.length)return!1;for(let a=0;a<d.length;a++)if(d[a].sourceId!==s[a].sourceId||!YT(d[a],s[a])||d[a].order!==s[a].order||d[a].clipMask!==s[a].clipMask||!qu(d[a].clipScope,s[a].clipScope))return!1;return!0}function QT(d,s,a){const _=1/Rn,j=1/(1<<a.canonical.z),tt=(s.x*_+a.canonical.x)*j+a.wrap,rt=(s.y*_+a.canonical.y)*j;return{min:new yn((d.x*_+a.canonical.x)*j+a.wrap,(d.y*_+a.canonical.y)*j),max:new yn(tt,rt)}}function BA(d,s,a){const _=1<<a.canonical.z,j=((s.x-a.wrap)*_-a.canonical.x)*Rn,tt=(s.y*_-a.canonical.y)*Rn;return{min:new yn(((d.x-a.wrap)*_-a.canonical.x)*Rn,(d.y*_-a.canonical.y)*Rn),max:new yn(j,tt)}}function uE(d,s,a,_,j,tt,rt){const ot=d.indices,ct=d.vertices,ht=[];for(let mt=_;mt<_+j;mt+=3){const gt=s[a[mt+0]+tt],_t=s[a[mt+1]+tt],Rt=s[a[mt+2]+tt],Pt=Math.min(gt.x,_t.x,Rt.x),zt=Math.max(gt.x,_t.x,Rt.x),Vt=Math.min(gt.y,_t.y,Rt.y),Gt=Math.max(gt.y,_t.y,Rt.y);ht.length=0,d.grid.query(new yn(Pt,Vt),new yn(zt,Gt),ht);for(let _i=0;_i<ht.length;_i++){const er=ht[_i];if(Np(ct[ot[3*er+0]],ct[ot[3*er+1]],ct[ot[3*er+2]],gt,_t,Rt,rt))return!0}}return!1}function JT(d,s,a,_){if(!d||!a)return!1;let j=d.vertices;if(!s.canonical.equals(_.canonical)||s.wrap!==_.wrap){if(a.vertices.length<d.vertices.length)return JT(a,_,d,s);const tt=s.canonical,rt=_.canonical,ot=Math.pow(2,rt.z-tt.z);j=d.vertices.map(ct=>new yn((ct.x+tt.x*Rn)*ot-rt.x*Rn,(ct.y+tt.y*Rn)*ot-rt.y*Rn))}return uE(a,j,d.indices,0,d.indices.length,0,0)}function eS(d,s,a,_){const j=Math.pow(2,_.z-a.z);return new yn((d+a.x*Rn)*j-_.x*Rn,(s+a.y*Rn)*j-_.y*Rn)}function hE(d,s){const a=[];s.grid.queryPoint(d,a);const _=s.indices,j=s.vertices;for(let tt=0;tt<a.length;tt++){const rt=a[tt];if(Nl([j[_[3*rt+0]],j[_[3*rt+1]],j[_[3*rt+2]]],d))return!0}return!1}const dE=[new yn(0,0),new yn(Rn,0),new yn(Rn,Rn),new yn(0,Rn)];function tS(d,s){const a=[];let _=[];if(!s||d.length<2)return[d];if(d.length===2)return tu(d[0],d[1],dE)?[d]:[];for(let j=0;j<d.length+2;j++){const tt=d[j%d.length],rt=d[(j+1)%d.length],ot=tu(j===0?d[d.length-1]:d[(j-1)%d.length],tt,dE),ct=tu(tt,rt,dE),ht=ot||ct;ht&&_.push(tt),ht&&ct||_.length>0&&(_.length>1&&a.push(_),_=[])}return _.length>1&&a.push(_),a}const pE=mn.types,VA=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],UA=["fill-extrusion-flood-light-ground-radius"],GA=Math.pow(2,13),$A=Math.pow(2,15)-1,iS=new yn(0,1),Vy=2147483648;function Qv(d,s,a,_,j,tt,rt,ot){d.emplaceBack((s<<1)+rt,(a<<1)+tt,(Math.floor(_*GA)<<1)+j,Math.round(ot))}function Jv(d,s,a){d.emplaceBack(s.x*Rn,s.y*Rn,a?1:0)}function M1(d,s,a,_,j,tt){d.emplaceBack(s.x,s.y,(a.x<<1)+_,(a.y<<1)+j,tt)}function e0(d,s,a){d.emplaceBack(s.x,s.y,s.z,a[0]*16384,a[1]*16384,a[2]*16384)}class rS{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class nS{constructor(){this.centroidXY=new yn(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new yn(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new yn(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new yn(this.max.x-this.min.x,this.max.y-this.min.y)}}class sS{constructor(){this.acc=new yn(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(s,a){s.min.x===Number.MAX_VALUE&&(s.min.x=s.max.x=a.x,s.min.y=s.max.y=a.y)}appendEdge(s,a,_){this.accCount++,this.acc._add(a);let j=!!this.borders;a.x<s.min.x?(s.min.x=a.x,j=!0):a.x>s.max.x&&(s.max.x=a.x,j=!0),a.y<s.min.y?(s.min.y=a.y,j=!0):a.y>s.max.y&&(s.max.y=a.y,j=!0),((a.x===0||a.x===Rn)&&a.x===_.x)!=((a.y===0||a.y===Rn)&&a.y===_.y)&&this.processBorderOverlap(a,_),j&&this.checkBorderIntersection(a,_)}checkBorderIntersection(s,a){a.x<0!=s.x<0&&this.addBorderIntersection(0,ns(a.y,s.y,(0-a.x)/(s.x-a.x))),a.x>Rn!=s.x>Rn&&this.addBorderIntersection(1,ns(a.y,s.y,(Rn-a.x)/(s.x-a.x))),a.y<0!=s.y<0&&this.addBorderIntersection(2,ns(a.x,s.x,(0-a.y)/(s.y-a.y))),a.y>Rn!=s.y>Rn&&this.addBorderIntersection(3,ns(a.x,s.x,(Rn-a.y)/(s.y-a.y)))}addBorderIntersection(s,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const _=this.borders[s];a<_[0]&&(_[0]=a),a>_[1]&&(_[1]=a)}processBorderOverlap(s,a){if(s.x===a.x){if(s.y===a.y)return;const _=s.x===0?0:1;this.addBorderIntersection(_,a.y),this.addBorderIntersection(_,s.y)}else{const _=s.y===0?2:3;this.addBorderIntersection(_,a.x),this.addBorderIntersection(_,s.x)}}centroid(){return this.accCount===0?new yn(0,0):new yn(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((s,a)=>s+ +(a[0]!==Number.MAX_VALUE),0):0}}function oS(d,s){const a=d.add(s)._unit(),_=fr(d.x*a.x+d.y*a.y,-1,1);var j,tt,rt;return j=Math.acos(_),Math.min(4,Math.max(-4,Math.tan(j)))/4*$A*((tt=d).x*(rt=s).y-tt.y*rt.x<0?-1:1)}const HA=[d=>d.x<0,d=>d.x>Rn,d=>d.y<0,d=>d.y>Rn];function WA(d,s,a,_){const j=[4];if(_===0)return j;a._mult(_);const tt=d.sub(a),rt=s.sub(a),ot=[d,s,tt,rt];for(let ct=0;ct<4;ct++)for(const ht of ot)if(HA[ct](ht)){j.push(ct);break}return j}class fE{constructor(s){this.vertexArray=new kv,this.indexArray=new Dl,this.programConfigurations=new lp(s.layers,{zoom:s.zoom,lut:s.lut},a=>UA.includes(a)),this._segments=new Bo,this.hiddenByLandmarkVertexArray=new Sx,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Bo}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(s,a,_,j=!1){const tt=s.length;if(tt>2){let rt=Math.max(0,this._segments.get().length-1);const ot=this._segments._prepareSegment(4*tt,this.vertexArray.length,2*this._segmentToGroundQuads[rt].length);let ct;rt!==this._segments.get().length-1&&(rt++,this._segmentToGroundQuads[rt]=[],this._segmentToRegionTriCounts[rt]=[0,0,0,0,0]);{const ht=s[0],mt=s[1];ct=oS(ht.sub(s[tt-1])._perp()._unit(),mt.sub(ht)._perp()._unit())}for(let ht=0;ht<tt;ht++){const mt=ht===tt-1?0:ht+1,gt=s[ht],_t=s[mt],Rt=s[mt===tt-1?0:mt+1],Pt=_t.sub(gt)._perp()._unit(),zt=oS(Pt,Rt.sub(_t)._perp()._unit()),Vt=ct,Gt=zt;if(mE(gt,_t,a)||j&&cS(gt,a)&&cS(_t,a)){ct=zt;continue}const _i=ot.vertexLength;M1(this.vertexArray,gt,_t,1,1,Vt),M1(this.vertexArray,gt,_t,1,0,Vt),M1(this.vertexArray,gt,_t,0,1,Gt),M1(this.vertexArray,gt,_t,0,0,Gt),ot.vertexLength+=4;const er=WA(gt,_t,Pt,_);for(const rr of er)this._segmentToGroundQuads[rt].push({id:_i,region:rr}),this._segmentToRegionTriCounts[rt][rr]+=2,ot.primitiveLength+=2;ct=zt}}}prepareBorderSegments(){if(!this.hasData())return;const s=this._segments.get(),a=s.length;for(let _=0;_<a;_++)this._segmentToGroundQuads[_].sort((j,tt)=>j.region-tt.region);for(let _=0;_<a;_++){const j=this._segmentToGroundQuads[_],tt=s[_],rt=this._segmentToRegionTriCounts[_];rt.reduce((ct,ht)=>ct+ht,0);let ot=0;for(let ct=0;ct<=4;ct++){const ht=rt[ct];if(ht!==0){let mt=this.regionSegments[ct];mt||(mt=this.regionSegments[ct]=new Bo);const gt={vertexOffset:tt.vertexOffset,primitiveOffset:tt.primitiveOffset+ot,vertexLength:tt.vertexLength,primitiveLength:ht};mt.get().push(gt)}ot+=ht}for(let ct=0;ct<j.length;ct++){const ht=j[ct].id;this.indexArray.emplaceBack(ht,ht+1,ht+3),this.indexArray.emplaceBack(ht,ht+3,ht+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(s,a,_,j,tt,rt,ot){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,s,a,_,j,tt,rt,void 0,ot)}upload(s){this.hasData()&&(this.vertexBuffer=s.createVertexBuffer(this.vertexArray,LA.members),this.indexBuffer=s.createIndexBuffer(this.indexArray))}uploadPaintProperties(s){this.hasData()&&this.programConfigurations.upload(s)}update(s,a,_,j,tt,rt,ot,ct){this.hasData()&&this.programConfigurations.updatePaintArrays(s,a,_,j,tt,rt,ot,ct)}updateHiddenByLandmark(s){this.updateHiddenByLandmarkRange(s.groundVertexArrayOffset,s.groundVertexCount,!!(s.flags&Vy))}updateHiddenByLandmarkRange(s,a,_){if(!this.hasData())return;const j=a+s;if(a!==0){for(let tt=s;tt<j;++tt)this.hiddenByLandmarkVertexArray.emplace(tt,_?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(s){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=s.createVertexBuffer(this.hiddenByLandmarkVertexArray,OA.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let s=0;s<=4;s++){const a=this.regionSegments[s];a&&a.destroy()}}}}class k1{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.overscaling=s.overscaling,this.layers=s.layers,this.pixelRatio=s.pixelRatio,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=s.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Dl,this.footprintVertices=new gm,this.footprintSegments=[],this.layoutVertexArray=new Zm,this.centroidVertexArray=new m1,this.wallVertexArray=new y1,this.indexArray=new Dl,this.programConfigurations=new lp(s.layers,{zoom:s.zoom,lut:s.lut},a=>VA.includes(a)),this.segments=new Bo,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new fE(s),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=s.worldview}updateFootprints(s,a){}populate(s,a,_,j){this.features=[],this.hasPattern=nE("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Nr(_),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:tt,id:rt,index:ot,sourceLayerIndex:ct}of s){const ht=this.layers[0]._featureFilter.needGeometry,mt=xn(tt,ht);if(!this.layers[0]._featureFilter.filter(new yo(this.zoom,{worldview:this.worldview}),mt,_))continue;const gt={id:rt,sourceLayerIndex:ct,index:ot,geometry:ht?mt.geometry:Ln(tt,_,j),properties:tt.properties,type:tt.type,patterns:{}},_t=this.layoutVertexArray.length,Rt=pE[gt.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:tt.id,feature:sE("fill-extrusion",this.layers,gt,this.zoom,this.pixelRatio,a)});else if(this.wallMode)for(const Pt of gt.geometry)for(const zt of tS(Pt,Rt))this.addFeature(tt.id,gt,[zt],ot,_,{},a.availableImages,j,a.brightness);else this.addFeature(tt.id,gt,gt.geometry,ot,_,{},a.availableImages,j,a.brightness);a.featureIndex.insert(tt,gt.geometry,ot,ct,this.index,_t)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(s,a,_,j,tt,rt){for(const{featureId:ot,feature:ct}of this.features){const ht=pE[ct.type]==="Polygon",{geometry:mt}=ct;if(this.wallMode)for(const gt of mt)for(const _t of tS(gt,ht))this.addFeature(ot,ct,[_t],ct.index,a,_,j,tt,rt);else this.addFeature(ot,ct,mt,ct.index,a,_,j,tt,rt)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(s,a,_,j,tt,rt,ot){this.programConfigurations.updatePaintArrays(s,a,tt,_,j,rt,ot,this.worldview),this.groundEffect.update(s,a,tt,_,j,rt,ot,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,NA),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.wallVertexBuffer=s.createVertexBuffer(this.wallVertexArray,FA.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=s.createVertexBuffer(this.layoutVertexExtArray,zA.members,!0)),this.groundEffect.upload(s)),this.groundEffect.uploadPaintProperties(s),this.programConfigurations.upload(s),this.uploaded=!0}uploadCentroid(s){this.groundEffect.uploadHiddenByLandmark(s),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,jA.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,a,_,j,tt,rt,ot,ct,ht){const mt=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,gt=[new yn(0,0),new yn(Rn,Rn)],_t=ct.projection,Rt=_t.name==="globe",Pt=this.wallMode||pE[a.type]==="Polygon",zt=new sS;zt.centroidDataIndex=this.centroidData.length;const Vt=new nS;Vt.buildingId=s,a.properties&&a.properties.hasOwnProperty("building_id")&&(Vt.buildingId=a.properties.building_id);const Gt=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},tt)<=0,_i=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},tt);let er;if(Vt.height=_i,Vt.vertexArrayOffset=this.layoutVertexArray.length,Vt.groundVertexArrayOffset=this.groundEffect.vertexArray.length,Rt&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new vx),this.wallMode){if(Rt)return void Es("Non zero fill-extrusion-line-width is not yet supported on globe.");if(_.length!==1)return;er=function(Fr){const on=Fr[0].x===Fr[Fr.length-1].x&&Fr[0].y===Fr[Fr.length-1].y;(function(An){let Kn=0;const ps=An.length;for(let kn=0;kn<ps;kn++)Kn+=(An[(kn+1)%ps].x-An[kn].x)*(An[(kn+1)%ps].y+An[kn].y);return Kn>=0})(Fr)||(Fr=Fr.reverse());const an={geometry:[],joinNormals:[],indices:[]},hn=[],vn=[],tn=[];let dn=Fr.length;for(;dn>=2&&Fr[dn-1].equals(Fr[dn-2]);)dn--;if(dn<(on?3:2))return an;let qr,Gr,wn,_n,Yn,jn=0;for(;jn<dn-1&&Fr[jn].equals(Fr[jn+1]);)jn++;on&&(qr=Fr[dn-2],Yn=Fr[jn].sub(qr)._unit()._perp());for(let An=jn;An<dn;An++){if(wn=An===dn-1?on?Fr[jn+1]:void 0:Fr[An+1],wn&&Fr[An].equals(wn))continue;Yn&&(_n=Yn),qr&&(Gr=qr),qr=Fr[An],Yn=wn?wn.sub(qr)._unit()._perp():_n,_n=_n||Yn;let Kn=_n.add(Yn);Kn.x===0&&Kn.y===0||Kn._unit();const ps=Kn.x*Yn.x+Kn.y*Yn.y,kn=ps!==0?1/ps:1/0,$n=_n.x*Yn.y-_n.y*Yn.x>0;let ls="miter";const ms=2;ls==="miter"&&kn>ms&&(ls="bevel"),ls==="bevel"&&(kn>100&&(ls="flipbevel"),kn<ms&&(ls="miter"));const Is=(xs,Nn,ys,Bs)=>{const or=new yn(xs.x,xs.y),ar=new yn(xs.x,xs.y);or.x+=Nn.x*Bs,or.y+=Nn.y*Bs,ar.x-=Nn.x*Math.max(ys,1),ar.y-=Nn.y*Math.max(ys,1),tn.push(Nn),hn.push(or),vn.push(ar)};if(ls==="miter")Kn._mult(kn),Is(qr,Kn,0,0);else if(ls==="flipbevel")Kn=Yn.mult(-1),Is(qr,Kn,0,0),Is(qr,Kn.mult(-1),0,0);else{const xs=-Math.sqrt(kn*kn-1),Nn=$n?xs:0,ys=$n?0:xs;Gr&&Is(qr,_n,Nn,ys),wn&&Is(qr,Yn,Nn,ys)}}an.geometry=[...hn,...vn.reverse(),hn[0]],an.joinNormals=[...tn,...tn.reverse(),tn[tn.length-1]];const Bn=an.geometry.length-1;for(let An=0;An<Bn/2;An++)if(An+1<Bn/2){let Kn=An,ps=An+1,kn=Bn-1-An,$n=Bn-2-An;Kn=Kn===0?Bn-1:Kn-1,ps=ps===0?Bn-1:ps-1,kn=kn===0?Bn-1:kn-1,$n=$n===0?Bn-1:$n-1,an.indices.push(kn),an.indices.push(ps),an.indices.push(Kn),an.indices.push(kn),an.indices.push($n),an.indices.push(ps)}return an}(_[0]),_=[er.geometry]}const rr=(Fr,on)=>Fr<(on.length-1)/2||Fr===on.length-1,_r=this.wallMode?[_]:Kv(_,500);for(let Fr=_r.length-1;Fr>=0;Fr--){const on=_r[Fr];(on.length===0||(xr=on[0]).every(gn=>gn.x<=0)||xr.every(gn=>gn.x>=Rn)||xr.every(gn=>gn.y<=0)||xr.every(gn=>gn.y>=Rn))&&_r.splice(Fr,1)}var xr;let Er;if(Rt)Er=pS(_r,gt,tt);else{Er=[];for(const Fr of _r)Er.push({polygon:Fr,bounds:gt})}const Ar=Pt?this.edgeRadius:0,Pr=Ar>0&&this.zoom<17,sn=(Fr,on)=>{if(Fr.length===0)return!1;const gn=Fr[Fr.length-1];return on.x===gn.x&&on.y===gn.y};for(const{polygon:Fr,bounds:on}of Er){let gn=0,an=0;for(const dn of Fr)Pt&&!dn[0].equals(dn[dn.length-1])&&dn.push(dn[0]),an+=Pt?dn.length-1:dn.length;const hn=this.segments.prepareSegment((Pt?5:4)*an,this.layoutVertexArray,this.indexArray);Vt.footprintSegIdx<0&&(Vt.footprintSegIdx=this.footprintSegments.length),Vt.polygonSegIdx<0&&(Vt.polygonSegIdx=this.polygonSegments.length);const vn={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},tn=new rS;if(tn.vertexOffset=this.footprintVertices.length,tn.indexOffset=3*this.footprintIndices.length,tn.ringIndices=[],Pt){const dn=[],qr=[];gn=hn.vertexLength;for(let wn=0;wn<Fr.length;wn++){const _n=Fr[wn];_n.length&&wn!==0&&qr.push(dn.length/2);const Yn=[];let jn,Bn;jn=_n[1].sub(_n[0])._perp()._unit(),tn.ringIndices.push(_n.length-1);for(let An=1;An<_n.length;An++){const Kn=_n[An],ps=_n[An===_n.length-1?1:An+1],kn=Kn.clone();if(Ar){Bn=ps.sub(Kn)._perp()._unit();const $n=jn.add(Bn)._unit(),ls=Ar*Math.min(4,1/(jn.x*$n.x+jn.y*$n.y));kn.x+=ls*$n.x,kn.y+=ls*$n.y,kn.x=Math.round(kn.x),kn.y=Math.round(kn.y),jn=Bn}if(!Gt||Ar!==0&&!Pr||sn(Yn,kn)||Yn.push(kn),Qv(this.layoutVertexArray,kn.x,kn.y,0,0,1,1,0),this.wallMode){const $n=rr(An,_n);Jv(this.wallVertexArray,er.joinNormals[An],!$n)}hn.vertexLength++,this.footprintVertices.emplaceBack(Kn.x,Kn.y),dn.push(Kn.x,Kn.y),Rt&&e0(this.layoutVertexExtArray,_t.projectTilePoint(kn.x,kn.y,tt),_t.upVector(tt,kn.x,kn.y))}Gt&&(Ar===0||Pr)&&(Yn.length!==0&&sn(Yn,Yn[0])&&Yn.pop(),this.groundEffect.addData(Yn,on,mt))}const Gr=this.wallMode?er.indices:Mx(dn,qr);for(let wn=0;wn<Gr.length;wn+=3)this.footprintIndices.emplaceBack(tn.vertexOffset+Gr[wn+0],tn.vertexOffset+Gr[wn+1],tn.vertexOffset+Gr[wn+2]),this.indexArray.emplaceBack(gn+Gr[wn],gn+Gr[wn+2],gn+Gr[wn+1]),hn.primitiveLength++;tn.indexCount+=Gr.length,tn.vertexCount+=this.footprintVertices.length-tn.vertexOffset}for(let dn=0;dn<Fr.length;dn++){const qr=Fr[dn];zt.startRing(Vt,qr[0]);let Gr=qr.length>4&&uS(qr[qr.length-2],qr[0],qr[1]),wn=Ar?qA(qr[qr.length-2],qr[0],qr[1],Ar):0;const _n=[];let Yn,jn,Bn;jn=qr[1].sub(qr[0])._perp()._unit();let An=!0;for(let Kn=1,ps=0;Kn<qr.length;Kn++){let kn=qr[Kn-1],$n=qr[Kn];const ls=qr[Kn===qr.length-1?1:Kn+1];if(zt.appendEdge(Vt,$n,kn),mE($n,kn,on)){Ar&&(jn=ls.sub($n)._perp()._unit(),An=!An);continue}const ms=$n.sub(kn)._perp(),Is=ms.x/(Math.abs(ms.x)+Math.abs(ms.y)),xs=ms.y>0?1:0,Nn=kn.dist($n);if(ps+Nn>32768&&(ps=0),Ar){Bn=ls.sub($n)._perp()._unit();let ar=lS(kn,$n,ls,aS(jn,Bn),Ar);isNaN(ar)&&(ar=0);const Wr=$n.sub(kn)._unit();kn=kn.add(Wr.mult(wn))._round(),$n=$n.add(Wr.mult(-ar))._round(),wn=ar,jn=Bn,Gt&&this.zoom>=17&&(sn(_n,kn)||_n.push(kn),sn(_n,$n)||_n.push($n))}const ys=hn.vertexLength,Bs=qr.length>4&&uS(kn,$n,ls);let or=hS(ps,Gr,An);if(Qv(this.layoutVertexArray,kn.x,kn.y,Is,xs,0,0,or),Qv(this.layoutVertexArray,kn.x,kn.y,Is,xs,0,1,or),this.wallMode){const ar=rr(Kn-1,qr),Wr=er.joinNormals[Kn-1];Jv(this.wallVertexArray,Wr,ar),Jv(this.wallVertexArray,Wr,ar)}if(ps+=Nn,or=hS(ps,Bs,!An),Gr=Bs,Qv(this.layoutVertexArray,$n.x,$n.y,Is,xs,0,0,or),Qv(this.layoutVertexArray,$n.x,$n.y,Is,xs,0,1,or),this.wallMode){const ar=rr(Kn,qr),Wr=er.joinNormals[Kn];Jv(this.wallVertexArray,Wr,ar),Jv(this.wallVertexArray,Wr,ar)}if(hn.vertexLength+=4,this.indexArray.emplaceBack(ys+0,ys+1,ys+2),this.indexArray.emplaceBack(ys+1,ys+3,ys+2),hn.primitiveLength+=2,Ar){const ar=gn+(Kn===1?qr.length-2:Kn-2),Wr=Kn===1?gn:ar+1;if(this.indexArray.emplaceBack(ys+1,ar,ys+3),this.indexArray.emplaceBack(ar,Wr,ys+3),hn.primitiveLength+=2,Yn===void 0&&(Yn=ys),!mE(ls,qr[Kn],on)){const nn=Kn===qr.length-1?Yn:hn.vertexLength;this.indexArray.emplaceBack(ys+2,ys+3,nn),this.indexArray.emplaceBack(ys+3,nn+1,nn),this.indexArray.emplaceBack(ys+3,Wr,nn+1),hn.primitiveLength+=3}An=!An}if(Rt){const ar=this.layoutVertexExtArray,Wr=_t.projectTilePoint(kn.x,kn.y,tt),nn=_t.projectTilePoint($n.x,$n.y,tt),Mn=_t.upVector(tt,kn.x,kn.y),In=_t.upVector(tt,$n.x,$n.y);e0(ar,Wr,Mn),e0(ar,Wr,Mn),e0(ar,nn,In),e0(ar,nn,In)}}Pt&&(gn+=qr.length-1),Gt&&Ar&&this.zoom>=17&&(_n.length!==0&&sn(_n,_n[0])&&_n.pop(),this.groundEffect.addData(_n,on,mt,Ar>0))}this.footprintSegments.push(tn),vn.triangleCount=this.indexArray.length-vn.triangleArrayOffset,this.polygonSegments.push(vn),++Vt.footprintSegLen,++Vt.polygonSegLen}if(Vt.vertexCount=this.layoutVertexArray.length-Vt.vertexArrayOffset,Vt.groundVertexCount=this.groundEffect.vertexArray.length-Vt.groundVertexArrayOffset,Vt.vertexCount!==0){if(Vt.centroidXY=zt.borders?iS:this.encodeCentroid(zt,Vt),this.centroidData.push(Vt),zt.borders){this.featuresOnBorder.push(zt);const Fr=this.featuresOnBorder.length-1;for(let on=0;on<zt.borders.length;on++)zt.borders[on][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[on].push(Fr)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,j,rt,ot,tt,ht,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(a,j,rt,ot,tt,ht,this.worldview),this.maxHeight=Math.max(this.maxHeight,_i)}}sortBorders(){for(let s=0;s<this.borderFeatureIndices.length;s++)this.borderFeatureIndices[s].sort((a,_)=>this.featuresOnBorder[a].borders[s][0]-this.featuresOnBorder[_].borders[s][0])}splitToSubtiles(){const s=[];for(let ot=0;ot<this.centroidData.length;ot++){const ct=this.centroidData[ot],ht=+(ct.min.y+ct.max.y>Rn),mt=2*ht+(+(ct.min.x+ct.max.x>Rn)^ht);for(let gt=0;gt<ct.polygonSegLen;gt++){const _t=ct.polygonSegIdx+gt;s.push({centroidIdx:ot,subtile:mt,polygonSegmentIdx:_t,triangleSegmentIdx:this.polygonSegments[_t].triangleSegIdx})}}const a=new Dl;s.sort((ot,ct)=>ot.triangleSegmentIdx===ct.triangleSegmentIdx?ot.subtile-ct.subtile:ot.triangleSegmentIdx-ct.triangleSegmentIdx);let _=0,j=0,tt=0;for(const ot of s){if(ot.triangleSegmentIdx!==_)break;tt++}const rt=s.length;for(;j!==s.length;){_=s[j].triangleSegmentIdx;let ot=0,ct=j,ht=j;for(let mt=ct;mt<tt&&s[mt].subtile===ot;mt++)ht++;for(;ct!==tt;){const mt=s[ct];ot=mt.subtile;const gt=this.centroidData[mt.centroidIdx].min.clone(),_t=this.centroidData[mt.centroidIdx].max.clone(),Rt={vertexOffset:this.segments.segments[_].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[_].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let Pt=ct;Pt<ht;Pt++){const zt=s[Pt],Vt=this.polygonSegments[zt.polygonSegmentIdx],Gt=this.centroidData[zt.centroidIdx].min,_i=this.centroidData[zt.centroidIdx].max,er=this.indexArray.uint16;for(let rr=Vt.triangleArrayOffset;rr<Vt.triangleArrayOffset+Vt.triangleCount;rr++)a.emplaceBack(er[3*rr],er[3*rr+1],er[3*rr+2]);Rt.primitiveLength+=Vt.triangleCount,gt.x=Math.min(gt.x,Gt.x),gt.y=Math.min(gt.y,Gt.y),_t.x=Math.max(_t.x,_i.x),_t.y=Math.max(_t.y,_i.y)}Rt.primitiveLength>0&&this.triangleSubSegments.push({segment:Rt,min:gt,max:_t}),ct=ht;for(let Pt=ct;Pt<tt&&s[Pt].subtile===s[ct].subtile;Pt++)ht++}j=tt;for(let mt=j;mt<rt&&s[mt].triangleSegmentIdx===s[j].triangleSegmentIdx;mt++)tt++}a._trim(),this.indexArray=a}getVisibleSegments(s,a,_){const j=new Bo;if(this.wallMode){for(const zt of this.triangleSubSegments)j.segments.push(zt.segment);return j}let tt=0,rt=0;const ot=1<<s.canonical.z;if(a){const zt=a.getMinMaxForTile(s);zt&&(tt=zt.min,rt=zt.max)}rt+=this.maxHeight;const ct=s.toUnwrapped();let ht;const mt=[ct.canonical.x/ot+ct.wrap,ct.canonical.y/ot],gt=[(ct.canonical.x+1)/ot+ct.wrap,(ct.canonical.y+1)/ot],_t=(zt,Vt,Gt)=>[zt[0]*(1-Gt[0])+Vt[0]*Gt[0],zt[1]*(1-Gt[1])+Vt[1]*Gt[1]],Rt=[],Pt=[];for(const zt of this.triangleSubSegments){Rt[0]=zt.min.x/Rn,Rt[1]=zt.min.y/Rn,Pt[0]=zt.max.x/Rn,Pt[1]=zt.max.y/Rn;const Vt=_t(mt,gt,Rt),Gt=_t(mt,gt,Pt);if(new cs([Vt[0],Vt[1],tt],[Gt[0],Gt[1],rt]).intersectsPrecise(_)===0){ht&&(j.segments.push(ht),ht=void 0);continue}const _i=zt.segment;ht&&ht.vertexOffset!==_i.vertexOffset&&(j.segments.push(ht),ht=void 0),ht?(ht.vertexLength+=_i.vertexLength,ht.primitiveLength+=_i.primitiveLength):ht={vertexOffset:_i.vertexOffset,primitiveLength:_i.primitiveLength,vertexLength:_i.vertexLength,primitiveOffset:_i.primitiveOffset,sortKey:void 0,vaos:{}}}return ht&&j.segments.push(ht),j}encodeCentroid(s,a){const _=s.centroid(),j=a.span(),tt=Math.min(7,Math.round(j.x*this.tileToMeter/10)),rt=Math.min(7,Math.round(j.y*this.tileToMeter/10));return new yn(fr(_.x,1,Rn-1)<<3|tt,fr(_.y,1,Rn-1)<<3|rt)}encodeBorderCentroid(s){if(!s.borders)return new yn(0,0);const a=s.borders,_=Number.MAX_VALUE;if(a[0][0]!==_||a[1][0]!==_){const j=a[0][0]!==_?0:1;return new yn(6|(a[0][0]!==_?0:65528),(a[j][0]+a[j][1])/2<<3|6)}{const j=a[2][0]!==_?2:3;return new yn((a[j][0]+a[j][1])/2<<3|6,6|(a[2][0]!==_?0:65528))}}showCentroid(s){const a=this.centroidData[s.centroidDataIndex];a.flags&=2147483647,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(s){this.groundEffect.updateHiddenByLandmark(s);const a=s.vertexArrayOffset,_=s.vertexCount+s.vertexArrayOffset,j=s.flags&Vy?iS:s.centroidXY,tt=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==j.y||tt!==j.x){for(let rt=a;rt<_;++rt)this.centroidVertexArray.emplace(rt,j.x,j.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const s of this.centroidData)this.writeCentroidToBuffer(s)}updateReplacement(s,a,_){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const j=a.getReplacementRegionsForTile(s.toUnwrapped());if(I1(this.activeReplacements,j))return;if(this.activeReplacements=j,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const rt of this.centroidData)rt.flags&=2147483647;const tt=[];for(const rt of this.activeReplacements){if(rt.order<_)continue;const ot=Math.max(1,Math.pow(2,rt.footprintTileId.canonical.z-s.canonical.z));if(rt.footprint.buildingId){const ct=rt.footprint.buildingId;for(const ht of this.centroidData)ht.buildingId===ct&&(ht.flags|=Vy)}else for(const ct of this.centroidData)if(!(ct.flags&Vy||rt.min.x>ct.max.x||ct.min.x>rt.max.x||rt.min.y>ct.max.y||ct.min.y>rt.max.y))for(let ht=0;ht<ct.footprintSegLen;ht++){const mt=this.footprintSegments[ct.footprintSegIdx+ht];if(tt.length=0,ZA(this.footprintVertices,mt.vertexOffset,mt.vertexCount,rt.footprintTileId.canonical,s.canonical,tt),uE(rt.footprint,tt,this.footprintIndices.uint16,mt.indexOffset,mt.indexCount,-mt.vertexOffset,-ot)){ct.flags|=Vy;break}}}for(const rt of this.centroidData)this.writeCentroidToBuffer(rt);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(s,a,_){let j=!1;for(let tt=0;tt<_.footprintSegLen;tt++){const rt=this.footprintSegments[_.footprintSegIdx+tt];let ot=0;for(const ct of rt.ringIndices){for(let ht=ot,mt=ct+ot-1;ht<ct+ot;mt=ht++){const gt=this.footprintVertices.int16[2*(ht+rt.vertexOffset)+0],_t=this.footprintVertices.int16[2*(ht+rt.vertexOffset)+1],Rt=this.footprintVertices.int16[2*(mt+rt.vertexOffset)+1];_t>a!=Rt>a&&s<(this.footprintVertices.int16[2*(mt+rt.vertexOffset)+0]-gt)*(a-_t)/(Rt-_t)+gt&&(j=!j)}ot=ct}}return j}getHeightAtTileCoord(s,a){let _=Number.NEGATIVE_INFINITY,j=!0;const tt=4*(s+Rn)*Rn+(a+Rn);if(this.partLookup.hasOwnProperty(tt)){const rt=this.partLookup[tt];return rt?{height:rt.height,hidden:!!(rt.flags&Vy)}:void 0}for(const rt of this.centroidData)s>rt.max.x||rt.min.x>s||a>rt.max.y||rt.min.y>a||rt.height<=_||this.footprintContainsPoint(s,a,rt)&&(_=rt.height,this.partLookup[tt]=rt,j=!!(rt.flags&Vy));if(_!==Number.NEGATIVE_INFINITY)return{height:_,hidden:j};this.partLookup[tt]=void 0}}function aS(d,s){const a=d.add(s)._unit();return d.x*a.x+d.y*a.y}function qA(d,s,a,_){const j=s.sub(d)._perp()._unit(),tt=a.sub(s)._perp()._unit();return lS(d,s,a,aS(j,tt),_)}function lS(d,s,a,_,j){const tt=Math.sqrt(1-_*_);return Math.min(d.dist(s)/3,s.dist(a)/3,j*tt/_)}function mE(d,s,a){return d.x<a[0].x&&s.x<a[0].x||d.x>a[1].x&&s.x>a[1].x||d.y<a[0].y&&s.y<a[0].y||d.y>a[1].y&&s.y>a[1].y}function cS(d,s){return d.x<s[0].x||d.x>s[1].x||d.y<s[0].y||d.y>s[1].y}function uS(d,s,a){if(d.x<0||d.x>=Rn||s.x<0||s.x>=Rn||a.x<0||a.x>=Rn)return!1;const _=a.sub(s),j=_.perp(),tt=d.sub(s);return(_.x*tt.x+_.y*tt.y)/Math.sqrt((_.x*_.x+_.y*_.y)*(tt.x*tt.x+tt.y*tt.y))>-.866&&j.x*tt.x+j.y*tt.y<0}function hS(d,s,a){const _=s?2|d:-3&d;return a?1|_:-2&_}function dS(){const d=Math.PI/32,s=Math.tan(d),a=Lt;return a*Math.sqrt(1+2*s*s)-a}function pS(d,s,a){const _=1<<a.z,j=gr(a.x/_),tt=gr((a.x+1)/_),rt=dr(a.y/_),ot=dr((a.y+1)/_);return function(ct,ht,mt,gt,_t=0,Rt){const Pt=[];if(!ct.length||!mt||!gt)return Pt;const zt=(xr,Er)=>{for(const Ar of xr)Pt.push({polygon:Ar,bounds:Er})},Vt=Math.ceil(Math.log2(mt)),Gt=Math.ceil(Math.log2(gt)),_i=Vt-Gt,er=[];for(let xr=0;xr<Math.abs(_i);xr++)er.push(_i>0?0:1);for(let xr=0;xr<Math.min(Vt,Gt);xr++)er.push(0),er.push(1);let rr=ct;if(rr=A1(rr,ht[0].y-_t,ht[1].y+_t,1),rr=A1(rr,ht[0].x-_t,ht[1].x+_t,0),!rr.length)return Pt;const _r=[];for(er.length?_r.push({polygons:rr,bounds:ht,depth:0}):zt(rr,ht);_r.length;){const xr=_r.pop(),Er=xr.depth,Ar=er[Er],Pr=xr.bounds[0],sn=xr.bounds[1],Fr=Ar===0?Pr.x:Pr.y,on=Ar===0?sn.x:sn.y,gn=Rt?Rt(Ar,Fr,on):.5*(Fr+on),an=A1(xr.polygons,Fr-_t,gn+_t,Ar),hn=A1(xr.polygons,gn-_t,on+_t,Ar);if(an.length){const vn=[Pr,new yn(Ar===0?gn:sn.x,Ar===1?gn:sn.y)];er.length>Er+1?_r.push({polygons:an,bounds:vn,depth:Er+1}):zt(an,vn)}if(hn.length){const vn=[new yn(Ar===0?gn:Pr.x,Ar===1?gn:Pr.y),sn];er.length>Er+1?_r.push({polygons:hn,bounds:vn,depth:Er+1}):zt(hn,vn)}}return Pt}(d,s,Math.ceil((tt-j)/11.25),Math.ceil((rt-ot)/11.25),1,(ct,ht,mt)=>{if(ct===0)return .5*(ht+mt);{const gt=dr((a.y+ht/Rn)/_);return(pr(.5*(dr((a.y+mt/Rn)/_)+gt))*_-a.y)*Rn}})}function ZA(d,s,a,_,j,tt){const rt=Math.pow(2,_.z-j.z);for(let ot=0;ot<a;ot++){let ct=d.int16[2*(ot+s)+0],ht=d.int16[2*(ot+s)+1];ct=(ct+j.x*Rn)*rt-_.x*Rn,ht=(ht+j.y*Rn)*rt-_.y*Rn,tt.push(new yn(ct,ht))}}let fS,mS;Fn(k1,"FillExtrusionBucket",{omit:["layers","features"]}),Fn(nS,"PartData"),Fn(rS,"FootprintSegment"),Fn(sS,"BorderCentroidData"),Fn(fE,"GroundEffect");class E_ extends yn{constructor(s,a,_){super(s,a),this.z=_}}class gS extends E_{constructor(s,a,_,j){super(s,a,_),this.w=j}}function yS(d,s,a,_){const j=a==="x"?"y":"x",tt=(_-d[a])/(s[a]-d[a]);d[j]=Math.round(d[j]+(s[j]-d[j])*tt),d[a]=_,d.hasOwnProperty("z")&&(d.z=ns(d.z,s.z,tt)),d.hasOwnProperty("w")&&(d.w=ns(d.w,s.w,tt))}function _S(d,s,a,_){const j=a,tt=_;for(const rt of["x","y"]){let ot=d,ct=s;ot[rt]>=ct[rt]&&(ot=s,ct=d),ot[rt]<j&&ct[rt]>j&&yS(ot,ct,rt,j),ot[rt]<tt&&ct[rt]>tt&&yS(ct,ot,rt,tt)}}function D1(d,s,a,_,j,tt){const rt=[];for(let ot=0;ot<d.length;ot++){const ct=d[ot];let ht;const mt=rt.length;let gt=0;for(let _t=0;_t<ct.length-1;_t++){let Rt=ct[_t],Pt=ct[_t+1],zt=0;const Vt=gt;let Gt,_i;tt&&(zt=Math.hypot(Pt.x-Rt.x,Pt.y-Rt.y),gt+=zt,Gt=Rt,_i=Pt),Rt.x<s&&Pt.x<s||(Rt.x<s?Rt=new yn(s,Rt.y+(s-Rt.x)/(Pt.x-Rt.x)*(Pt.y-Rt.y))._round():Pt.x<s&&(Pt=new yn(s,Rt.y+(s-Rt.x)/(Pt.x-Rt.x)*(Pt.y-Rt.y))._round()),Rt.y<a&&Pt.y<a||(Rt.y<a?Rt=new yn(Rt.x+(a-Rt.y)/(Pt.y-Rt.y)*(Pt.x-Rt.x),a)._round():Pt.y<a&&(Pt=new yn(Rt.x+(a-Rt.y)/(Pt.y-Rt.y)*(Pt.x-Rt.x),a)._round()),Rt.x>=_&&Pt.x>=_||(Rt.x>=_?Rt=new yn(_,Rt.y+(_-Rt.x)/(Pt.x-Rt.x)*(Pt.y-Rt.y))._round():Pt.x>=_&&(Pt=new yn(_,Rt.y+(_-Rt.x)/(Pt.x-Rt.x)*(Pt.y-Rt.y))._round()),Rt.y>=j&&Pt.y>=j||(Rt.y>=j?Rt=new yn(Rt.x+(j-Rt.y)/(Pt.y-Rt.y)*(Pt.x-Rt.x),j)._round():Pt.y>=j&&(Pt=new yn(Rt.x+(j-Rt.y)/(Pt.y-Rt.y)*(Pt.x-Rt.x),j)._round()),ht&&Rt.equals(ht[ht.length-1])||(ht=[Rt],rt.push(ht),tt&&tt.push({progress:{min:Vt+xS(Gt,_i,Rt)*zt,max:1},parentIndex:ot,prevPoint:Gt,nextPoint:_i})),ht.push(Pt),tt&&(tt[tt.length-1].progress.max=Vt+xS(Gt,_i,Pt)*zt,tt[tt.length-1].nextPoint=_i)))))}if(tt&&gt>0)for(let _t=mt;_t<rt.length;_t++)tt[_t].progress.min/=gt,tt[_t].progress.max/=gt}return rt}function XA(d,s,a,_,j){if(d.length<2)return void _.push(d);const tt=[];for(;s.valid();){const[ht,mt]=s.get();for(let gt=0;gt<d.length-1;gt++){const _t=d[gt],Rt=d[gt+1],Pt=Zo(_t,Rt,ht,mt);if(Pt){const[zt]=Pt,Vt=new yn(ns(_t.x,Rt.x,zt),ns(_t.y,Rt.y,zt));tt.push({t:gt+zt,distance:0,point:Vt})}}s.next()}if(tt.length===0)return void _.push(d);tt.sort((ht,mt)=>ht.t-mt.t);let rt=0,ot=0,ct=[];for(_.push(ct);rt!==d.length;){if(ot===tt.length){for(;rt!==d.length;)ct.length!==0&&ct[ct.length-1].equals(d[rt])||ct.push(d[rt]),rt++;break}tt[ot].t<=rt?(ct.length!==0&&ct[ct.length-1].equals(tt[ot].point)||ct.push(tt[ot].point),Math.trunc(tt[ot].t),ot++):(ct.length!==0&&ct[ct.length-1].equals(d[rt])||ct.push(d[rt]),rt++)}}function xS(d,s,a){return d.x!==s.x?(a.x-d.x)/(s.x-d.x):d.y!==s.y?(a.y-d.y)/(s.y-d.y):0}function t0(d,s){return d.x*s.x+d.y*s.y}function vS(d,s){if(d.length===1){let a=0;const _=s[a++];let j;for(;!j||_.equals(j);)if(j=s[a++],!j)return 1/0;for(;a<s.length;a++){const tt=s[a],rt=d[0],ot=j.sub(_),ct=tt.sub(_),ht=rt.sub(_),mt=t0(ot,ot),gt=t0(ot,ct),_t=t0(ct,ct),Rt=t0(ht,ot),Pt=t0(ht,ct),zt=mt*_t-gt*gt,Vt=(_t*Rt-gt*Pt)/zt,Gt=(mt*Pt-gt*Rt)/zt,_i=_.z*(1-Vt-Gt)+j.z*Vt+tt.z*Gt;if(isFinite(_i))return _i}return 1/0}{let a=1/0;for(const _ of s)a=Math.min(a,_.z);return a}}function bS(d,s,a,_,j,tt,rt,ot){const ct=rt*j.getElevationAt(d,s,!0,!0),ht=tt[0]!==0,mt=ht?tt[1]===0?rt*(tt[0]/7-450):rt*function(gt,_t,Rt){const Pt=Math.floor(_t[0]/8),zt=Math.floor(_t[1]/8),Vt=10*(_t[0]-8*Pt),Gt=10*(_t[1]-8*zt),_i=gt.getElevationAt(Pt,zt,!0,!0),er=gt.getMeterToDEM(Rt),rr=Math.floor(.5*(Vt*er-1)),_r=Math.floor(.5*(Gt*er-1)),xr=gt.tileCoordToPixel(Pt,zt),Er=2*rr+1,Ar=2*_r+1,Pr=function(hn,vn,tn,dn,qr){return[hn.getElevationAtPixel(vn,tn,!0),hn.getElevationAtPixel(vn+qr,tn,!0),hn.getElevationAtPixel(vn,tn+qr,!0),hn.getElevationAtPixel(vn+dn,tn+qr,!0)]}(gt,xr.x-rr,xr.y-_r,Er,Ar),sn=Math.abs(Pr[0]-Pr[1]),Fr=Math.abs(Pr[2]-Pr[3]),on=Math.abs(Pr[0]-Pr[2])+Math.abs(Pr[1]-Pr[3]),gn=Math.min(.25,.5*er*(sn+Fr)/Er),an=Math.min(.25,.5*er*on/Ar);return _i+Math.max(gn*Vt,an*Gt)}(j,tt,ot):ct;return{base:ct+(a===0?-1:a),top:ht?Math.max(mt+_,ct+a+2):ct+_}}class KA{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class YA{constructor(){this.tasks={},this.taskQueue=[],rs(["process"],this),this.invoker=new KA(this.process),this.nextId=0}add(s,a){const _=this.nextId++,j=function({type:tt,isSymbolTile:rt,zoom:ot}){return ot=ot||0,tt==="message"?0:tt!=="maybePrepare"||rt?tt!=="parseTile"||rt?tt==="parseTile"&&rt?300-ot:tt==="maybePrepare"&&rt?400-ot:500:200-ot:100-ot}(a);if(j===0){try{s()}finally{}return null}return this.tasks[_]={fn:s,metadata:a,priority:j,id:_},this.taskQueue.push(_),this.invoker.trigger(),{cancel:()=>{delete this.tasks[_]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(_=>!!this.tasks[_]),!this.taskQueue.length)return;const s=this.pick();if(s===null)return;const a=this.tasks[s];if(delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let s=null,a=1/0;for(let j=0;j<this.taskQueue.length;j++){const tt=this.tasks[this.taskQueue[j]];tt.priority<a&&(a=tt.priority,s=j)}if(s===null)return null;const _=this.taskQueue[s];return this.taskQueue.splice(s,1),_}remove(){this.invoker.remove()}}class wS{constructor(s,a,_){this.target=s,this.parent=a,this.mapId=_,this.callbacks={},this.cancelCallbacks={},rs(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new YA}send(s,a,_,j,tt=!1,rt){const ot=Math.round(1e18*Math.random()).toString(36).substring(0,10);_&&(_.metadata=rt,this.callbacks[ot]=_);const ct=new Set;return this.target.postMessage({id:ot,type:s,hasCallback:!!_,targetMapId:j,mustQueue:tt,sourceMapId:this.mapId,data:dm(a,ct)},ct),{cancel:()=>{_&&delete this.callbacks[ot],this.target.postMessage({id:ot,type:"<cancel>",targetMapId:j,sourceMapId:this.mapId})}}}receive(s){const a=s.data;if(!a)return;const _=a.id;if(_&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const j=this.cancelCallbacks[_];delete this.cancelCallbacks[_],j&&j.cancel()}else if(a.mustQueue||ao(self)){const j=this.callbacks[_],tt=this.scheduler.add(()=>this.processTask(_,a),j&&j.metadata||{type:"message"});tt&&(this.cancelCallbacks[_]=tt)}else this.processTask(_,a)}processTask(s,a){if(delete this.cancelCallbacks[s],a.type==="<response>"){const _=this.callbacks[s];delete this.callbacks[s],_&&(a.error?_(pm(a.error)):_(null,pm(a.data)))}else{const _=new Set,j=a.hasCallback?(rt,ot)=>{this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:rt?dm(rt):null,data:dm(ot,_)},_)}:()=>{},tt=pm(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,tt,j);else if(this.parent.getWorkerSource){const rt=a.type.split("."),{source:ot,scope:ct}=tt;this.parent.getWorkerSource(a.sourceMapId,rt[0],ot,ct)[rt[1]](tt,j)}else j(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var i0={workerUrl:"",workerClass:null,workerParams:void 0};const gE="mapboxgl_preloaded_worker_pool";class T_{constructor(){this.active={}}acquire(s,a=T_.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;)this.workers.push(i0.workerClass!=null?new i0.workerClass:new self.Worker(i0.workerUrl,i0.workerParams));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[gE]}numActive(){return Object.keys(this.active).length}}T_.workerCount=2;class Dx{constructor(s,a,_="Worker",j=T_.workerCount){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=ln();const tt=this.workerPool.acquire(this.id,j);for(let rt=0;rt<tt.length;rt++){const ot=new Dx.Actor(tt[rt],a,this.id);ot.name=`${_} ${rt}`,this.actors.push(ot)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,a,_){Xr(this.actors,(j,tt)=>{j.send(s,a,tt)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}let r0,yE;function L1(){return r0||(r0=new T_),r0}Dx.Actor=wS;class QA{constructor(s){this.module=s}createIntArray(s){const a=new Int32Array(s),_=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heap32.set(a,_/a.BYTES_PER_ELEMENT),_}createFloatArray(s){const a=new Float32Array(s),_=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heapF32.set(a,_/a.BYTES_PER_ELEMENT),_}createStringBuffer(s){const a=this.module.malloc(s.length+1);for(let _=0;_<s.length;++_)this.module.heapU8[a+_]=s.charCodeAt(_);return this.module.heapU8[a+s.length]=0,a}readStringBuffer(s){let a="";for(;this.module.heapU8[s]!==0;)a+=String.fromCharCode(this.module.heapU8[s]),++s;return a}setStyle(s){const a=s.entranceColorRgb,_=s.facadeGlazingColorRgb,j=s.roofColorRgb,tt=s.wallColorRgb,rt=s.normalScale;this.module.setStyle(a[0],a[1],a[2],_[0],_[1],_[2],j[0],j[1],j[2],tt[0],tt[1],tt[2],rt[0],rt[1],rt[2],s.tileToMeters)}setAOOptions(s,a){this.module.setAOOptions(s?1:0,a)}setMetricOptions(s,a){this.module.setMetricOptions(s?1:0,a)}setStructuralOptions(s){this.module.setStructuralOptions(s?1:0)}setFacadeOptions(s,a){this.module.setFacadeOptions(s,a?1:0)}setFauxFacadeOptions(s,a,_){this.module.setFauxFacadeOptions(s?1:0,a?1:0,_)}setFacadeClassifierOptions(s){this.module.setFacadeClassifierOptions(s)}generateMesh(s,a){for(const ot of s){const ct=this.createStringBuffer(ot.roofType),ht=[0],mt=[];for(const Rt of ot.coordinates)if(Array.isArray(Rt)){for(const Pt of Rt)mt.push(Pt.x),mt.push(Pt.y);ht.push(mt.length)}const gt=this.createIntArray(ht),_t=this.createFloatArray(mt);this.module.addFeature(ot.id,ot.sourceId,ot.minHeight,ot.height,ct,ot.roofType.length,_t,gt,ht.length-1),this.module.free(ct),this.module.free(gt),this.module.free(_t)}for(const ot of a){let ct;ct=ot.entrances?JSON.parse(ot.entrances):[];const ht=this.createFloatArray(ct),mt=[];for(const _t of ot.coordinates)mt.push(_t.x),mt.push(_t.y);const gt=this.createFloatArray(mt);this.module.addFacade(ot.sourceId,ot.crossPerc,ot.distanceToRoad,ht,ct.length,gt,mt.length),this.module.free(ht),this.module.free(gt)}if(!this.module.generateMesh()){const ot=this.module.getLastError();return this.readStringBuffer(ot)}const _=this.module.getMeshCount(),j=new Array(_);for(let ot=0;ot<_;ot++){const ct=this.module.getPositionsPtr(ot),ht=this.module.getPositionsLength(ot),mt=new Float32Array(this.module.heapF32.buffer,ct,ht),gt=this.module.getNormalsPtr(ot),_t=this.module.getNormalsLength(ot),Rt=new Float32Array(this.module.heapF32.buffer,gt,_t),Pt=this.module.getColorsPtr(ot),zt=this.module.getColorsLength(ot),Vt=new Uint8Array(this.module.heapU8.buffer,Pt,zt),Gt=this.module.getAOPtr(ot),_i=this.module.getAOLength(ot),er=new Float32Array(this.module.heapF32.buffer,Gt,_i),rr=this.module.getUVPtr(ot),_r=this.module.getUVLength(ot),xr=new Float32Array(this.module.heapF32.buffer,rr,_r),Er=this.module.getFauxFacadePtr(ot),Ar=this.module.getFauxFacadeLength(ot),Pr=new Uint8Array(this.module.heapU8.buffer,Er,Ar),sn=this.module.getIndicesPtr(ot),Fr=this.module.getIndicesLength(ot),on=new Int32Array(this.module.heap32.buffer,sn,Fr),gn=this.module.getBuildingPart(ot),an=this.readStringBuffer(gn);j[ot]={positions:mt,normals:Rt,colors:Vt,ao:er,uv:xr,isFauxFacade:Pr,indices:on,buildingPart:an}}const tt=this.module.getRingCount(),rt=[];for(let ot=0;ot<tt;ot++){const ct=this.module.getRingPtr(ot),ht=this.module.getRingLength(ot),mt=new Float32Array(this.module.heapF32.buffer,ct,ht);rt.push(mt)}return{meshes:j,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:rt}}}let n0,_E,Up,Lx,xE,jx=null,Fx=null,ES=null,j1=null;function TS(){return ao(self)&&self.worker.dracoUrl?self.worker.dracoUrl:_E||Gl.DRACO_URL}function SS(){if(ao(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Lx)return Lx;const d=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Lx=WebAssembly.validate(d)?Gl.MESHOPT_SIMD_URL:Gl.MESHOPT_URL,Lx}function JA(){return j1}const F1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},eR={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},s0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function CS(d,s,a){const _=a.json.bufferViews.length,j=a.buffers.length;s.bufferView=_,a.json.bufferViews[_]={buffer:j,byteLength:d.byteLength},a.buffers[j]=d}const vE="KHR_draco_mesh_compression";function tR(d,s){const a=d.extensions&&d.extensions[vE];if(!a)return;const _=new Up.Decoder,j=IS(s,a.bufferView),tt=new Up.Mesh;if(!_.DecodeArrayToMesh(j,j.byteLength,tt))throw new Error("Failed to decode Draco mesh");const rt=s.json.accessors[d.indices],ot=F1[rt.componentType],ct=rt.count*ot.BYTES_PER_ELEMENT,ht=Up._malloc(ct);ot===Uint16Array?_.GetTrianglesUInt16Array(tt,ct,ht):_.GetTrianglesUInt32Array(tt,ct,ht),CS(Up.memory.buffer.slice(ht,ht+ct),rt,s),Up._free(ht);for(const mt of Object.keys(a.attributes)){const gt=_.GetAttributeByUniqueId(tt,a.attributes[mt]),_t=s.json.accessors[d.attributes[mt]],Rt=eR[_t.componentType],Pt=_t.count*s0[_t.type]*F1[_t.componentType].BYTES_PER_ELEMENT,zt=Up._malloc(Pt);_.GetAttributeDataArrayForAllPoints(tt,gt,Up[Rt],Pt,zt),CS(Up.memory.buffer.slice(zt,zt+Pt),_t,s),Up._free(zt)}_.destroy(),tt.destroy(),delete d.extensions[vE]}const O1="EXT_meshopt_compression";function iR(d,s){if(!d.extensions||!d.extensions[O1])return;const a=d.extensions[O1],_=new Uint8Array(s.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),j=new Uint8Array(a.count*a.byteStride);xE.decodeGltfBuffer(j,a.count,a.byteStride,_,a.mode,a.filter),d.buffer=s.buffers.length,d.byteOffset=0,s.buffers[d.buffer]=j.buffer,delete d.extensions[O1]}const AS=1179937895,RS=new TextDecoder("utf8");function PS(d,s){return new URL(d,s).href}function rR(d,s,a,_){return fetch(PS(d.uri,_)).then(j=>j.arrayBuffer()).then(j=>{s.buffers[a]=j})}function IS(d,s){const a=d.json.bufferViews[s];return new Uint8Array(d.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function nR(d,s,a,_){if(d.uri){const j=PS(d.uri,_);return fetch(j).then(tt=>tt.blob()).then(tt=>createImageBitmap(tt)).then(tt=>{s.images[a]=tt})}if(d.bufferView!==void 0){const j=IS(s,d.bufferView),tt=new Blob([j],{type:d.mimeType});return createImageBitmap(tt).then(rt=>{s.images[a]=rt})}}function MS(d,s=0,a){const _={json:null,images:[],buffers:[]};if(new Uint32Array(d,s,1)[0]===AS){const mt=new Uint32Array(d,s);let gt=2;const _t=(mt[gt++]>>2)-3,Rt=mt[gt++]>>2;if(gt++,_.json=JSON.parse(RS.decode(mt.subarray(gt,gt+Rt))),gt+=Rt,gt<_t){const Pt=mt[gt++];gt++;const zt=s+(gt<<2);_.buffers[0]=d.slice(zt,zt+Pt)}}else _.json=JSON.parse(RS.decode(new Uint8Array(d,s)));const{buffers:j,images:tt,meshes:rt,extensionsUsed:ot,bufferViews:ct}=_.json;let ht=Promise.resolve();if(j){const mt=[];for(let gt=0;gt<j.length;gt++){const _t=j[gt];_t.uri?mt.push(rR(_t,_,gt,a)):_.buffers[gt]||(_.buffers[gt]=null)}ht=Promise.all(mt)}return ht.then(()=>{const mt=[],gt=ot&&ot.includes(vE),_t=ot&&ot.includes(O1);if(gt&&mt.push(function(){if(!Up)return n0??(n0=function(Rt){let Pt,zt=null;function Vt(){Pt=new Uint8Array(zt.buffer)}function Gt(){throw new Error("Unexpected Draco error.")}const _i={a:{a:Gt,d:function(er,rr,_r){return Pt.copyWithin(er,rr,rr+_r)},c:function(er){const rr=Pt.length,_r=Math.max(er>>>0,Math.ceil(1.2*rr)),xr=Math.ceil((_r-rr)/65536);try{return zt.grow(xr),Vt(),!0}catch{return!1}},b:Gt}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(Rt,_i):Rt.then(er=>er.arrayBuffer()).then(er=>WebAssembly.instantiate(er,_i))).then(er=>{const{Rb:rr,Qb:_r,P:xr,T:Er,X:Ar,Ja:Pr,La:sn,Qa:Fr,Va:on,Wa:gn,eb:an,jb:hn,f:vn,e:tn,yb:dn,zb:qr,Ab:Gr,Bb:wn,Db:_n,Gb:Yn}=er.instance.exports;zt=tn;const jn=(()=>{let Bn=0,An=0,Kn=0,ps=0;return kn=>{Kn&&(rr(ps),rr(Bn),An+=Kn,Kn=Bn=0),Bn||(An+=128,Bn=_r(An));const $n=kn.length+7&-8;let ls=Bn;$n>=An&&(Kn=$n,ls=ps=_r($n));for(let ms=0;ms<kn.length;ms++)Pt[ls+ms]=kn[ms];return ls}})();return Vt(),vn(),{memory:tn,_free:rr,_malloc:_r,Mesh:class{constructor(){this.ptr=xr()}destroy(){Er(this.ptr)}},Decoder:class{constructor(){this.ptr=Pr()}destroy(){hn(this.ptr)}DecodeArrayToMesh(Bn,An,Kn){const ps=jn(Bn),kn=sn(this.ptr,ps,An,Kn.ptr);return!!Ar(kn)}GetAttributeByUniqueId(Bn,An){return{ptr:Fr(this.ptr,Bn.ptr,An)}}GetTrianglesUInt16Array(Bn,An,Kn){on(this.ptr,Bn.ptr,An,Kn)}GetTrianglesUInt32Array(Bn,An,Kn){gn(this.ptr,Bn.ptr,An,Kn)}GetAttributeDataArrayForAllPoints(Bn,An,Kn,ps,kn){an(this.ptr,Bn.ptr,An.ptr,Kn,ps,kn)}},DT_INT8:dn(),DT_UINT8:qr(),DT_INT16:Gr(),DT_UINT16:wn(),DT_UINT32:_n(),DT_FLOAT32:Yn()}})}(fetch(TS())),n0.then(Rt=>{Up=Rt,n0=void 0}))}()),_t&&mt.push(function(){if(xE)return;const Rt=function(Pt){let zt;const Vt=WebAssembly.instantiateStreaming(Pt,{}).then(er=>{zt=er.instance,zt.exports.__wasm_call_ctors()}),Gt={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},_i={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Vt,supported:!0,decodeGltfBuffer(er,rr,_r,xr,Er,Ar){(function(Pr,sn,Fr,on,gn,an,hn){const vn=Pr.exports.sbrk,tn=on+3&-4,dn=vn(tn*gn),qr=vn(an.length),Gr=new Uint8Array(Pr.exports.memory.buffer);Gr.set(an,qr);const wn=sn(dn,on,gn,qr,an.length);if(wn===0&&hn&&hn(dn,tn,gn),Fr.set(Gr.subarray(dn,dn+on*gn)),vn(dn-vn(0)),wn!==0)throw new Error(`Malformed buffer data: ${wn}`)})(zt,zt.exports[_i[Er]],er,rr,_r,xr,zt.exports[Gt[Ar]])}}}(fetch(SS()));return Rt.ready.then(()=>{xE=Rt})}()),tt)for(let Rt=0;Rt<tt.length;Rt++)mt.push(nR(tt[Rt],_,Rt,a));return(mt.length?Promise.all(mt):Promise.resolve()).then(()=>{if(gt&&rt)for(const{primitives:Rt}of rt)for(const Pt of Rt)tR(Pt,_);if(_t&&rt&&ct)for(const Rt of ct)iR(Rt,_);return _})})}function bE(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function wE(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class EE{constructor(s,a,_,j){this.context=s,this.format=_,this.useMipmap=j&&j.useMipmap,this.texture=s.gl.createTexture(),this.update(a,{premultiply:j&&j.premultiply})}update(s,a){const _=s&&s instanceof HTMLVideoElement&&s.width===0?s.videoWidth:s.width,j=s&&s instanceof HTMLVideoElement&&s.height===0?s.videoHeight:s.height,{context:tt}=this,{gl:rt}=tt,{x:ot,y:ct}=a&&a.position?a.position:{x:0,y:0},ht=ot+_,mt=ct+j;!this.size||this.size[0]===ht&&this.size[1]===mt||(rt.bindTexture(rt.TEXTURE_2D,null),rt.deleteTexture(this.texture),this.texture=rt.createTexture(),this.size=null),rt.bindTexture(rt.TEXTURE_2D,this.texture),tt.pixelStoreUnpackFlipY.set(!1),tt.pixelStoreUnpack.set(1),tt.pixelStoreUnpackPremultiplyAlpha.set(this.format===rt.RGBA8&&(!a||a.premultiply!==!1));const gt=s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||ImageBitmap&&s instanceof ImageBitmap;if(!this.size&&ht>0&&mt>0){const _t=this.useMipmap?Math.floor(Math.log2(Math.max(ht,mt)))+1:1;rt.texStorage2D(rt.TEXTURE_2D,_t,this.format,ht,mt),this.size=[ht,mt]}this.size&&(gt?rt.texSubImage2D(rt.TEXTURE_2D,0,ot,ct,bE(this.format),wE(this.format),s):"data"in s&&s.data&&rt.texSubImage2D(rt.TEXTURE_2D,0,ot,ct,_,j,bE(this.format),wE(this.format),s.data)),this.useMipmap&&rt.generateMipmap(rt.TEXTURE_2D)}bind(s,a,_=!1){const{context:j}=this,{gl:tt}=j;tt.bindTexture(tt.TEXTURE_2D,this.texture),s!==this.minFilter&&(tt.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_MAG_FILTER,s),tt.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_MIN_FILTER,this.useMipmap&&!_?s===tt.NEAREST?tt.NEAREST_MIPMAP_NEAREST:tt.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),a!==this.wrapS&&(tt.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_WRAP_S,a),tt.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(s,a,_,j,tt){const{context:rt}=this,{gl:ot}=rt;ot.bindTexture(ot.TEXTURE_2D,this.texture),a!==this.magFilter&&(ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MAG_FILTER,a),this.magFilter=a),s!==this.minFilter&&(ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MIN_FILTER,this.useMipmap?s===ot.NEAREST?ot.NEAREST_MIPMAP_NEAREST:ot.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),_!==this.wrapS&&(ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_S,_),this.wrapS=_),j!==this.wrapT&&(ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_T,j),this.wrapT=j),tt!==this.compareMode&&(tt?(ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_COMPARE_MODE,ot.COMPARE_REF_TO_TEXTURE),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_COMPARE_FUNC,tt)):ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_COMPARE_MODE,ot.NONE),this.compareMode=tt)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}class o0{constructor(s,a){this.context=s,this.texture=a}bind(s,a){const{context:_}=this,{gl:j}=_;j.bindTexture(j.TEXTURE_2D,this.texture),s!==this.minFilter&&(j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,s),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,s),this.minFilter=s),a!==this.wrapS&&(j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,a),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,a),this.wrapS=a)}}const sR=zs([{name:"a_pos_3f",components:3,type:"Float32"}]),oR=zs([{name:"a_color_3f",components:3,type:"Float32"}]),aR=zs([{name:"a_color_4f",components:4,type:"Float32"}]),lR=zs([{name:"a_uv_2f",components:2,type:"Float32"}]),cR=zs([{name:"a_normal_3f",components:3,type:"Float32"}]),uR=zs([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),hR=zs([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function kS(d,s){const a=z1(d.projection,d.zoom,d.width,d.height),_=function(tt,rt,ot,ct,ht){const mt=new Ot(ot.lng-180*Uy,ot.lat),gt=new Ot(ot.lng+180*Uy,ot.lat),_t=tt.project(mt.lng,mt.lat),Rt=tt.project(gt.lng,gt.lat),Pt=-Math.atan2(Rt.y-_t.y,Rt.x-_t.x),zt=Yr.fromLngLat(ot);zt.y=fr(zt.y,-1+Uy,1-Uy);const Vt=zt.toLngLat(),Gt=tt.project(Vt.lng,Vt.lat),_i=Yr.fromLngLat(Vt);_i.x+=Uy;const er=_i.toLngLat(),rr=tt.project(er.lng,er.lat),_r=LS(rr.x-Gt.x,rr.y-Gt.y,Pt),xr=Yr.fromLngLat(Vt);xr.y+=Uy;const Er=xr.toLngLat(),Ar=tt.project(Er.lng,Er.lat),Pr=LS(Ar.x-Gt.x,Ar.y-Gt.y,Pt),sn=Math.abs(_r.x)/Math.abs(Pr.y),Fr=At([]);Kt(Fr,Fr,-Pt*(1-(ht?0:ct)));const on=At([]);return St(on,on,[1,1-(1-sn)*ct,1]),on[4]=-Pr.x/Pr.y*ct,Kt(on,on,Pt),Tt(on,Fr,on),on}(d.projection,0,d.center,a,s),j=DS(d);return St(_,_,[j,j,1]),_}function DS(d){const s=d.projection,a=z1(d.projection,d.zoom,d.width,d.height),_=TE(s,d.center),j=TE(s,Ot.convert(s.center));return Math.pow(2,_*a+(1-a)*j)}function z1(d,s,a,_,j=1/0){const tt=d.range;if(!tt)return 0;const rt=Math.min(j,Math.max(a,_)),ot=Math.log2(rt/1024);return Ur(tt[0]+ot,tt[1]+ot,s)}const Uy=1/4e4;function TE(d,s){const a=fr(s.lat,-yr,yr),_=new Ot(s.lng-180*Uy,a),j=new Ot(s.lng+180*Uy,a),tt=d.project(_.lng,a),rt=d.project(j.lng,a),ot=Yr.fromLngLat(_),ct=Yr.fromLngLat(j),ht=rt.x-tt.x,mt=rt.y-tt.y,gt=ct.x-ot.x,_t=ct.y-ot.y,Rt=Math.sqrt((gt*gt+_t*_t)/(ht*ht+mt*mt));return Math.log2(Rt)}function LS(d,s,a){const _=Math.cos(a),j=Math.sin(a);return{x:d*_-s*j,y:d*j+s*_}}function jS(d,s,a){At(d),Kt(d,d,Lr(s[2])),jt(d,d,Lr(s[0])),Ht(d,d,Lr(s[1])),St(d,d,a),Tt(d,d,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function N1(d,s,a,_,j,tt,rt,ot){const ct=[a[0]-s[0],a[1]-s[1],0],ht=[_[0]-s[0],_[1]-s[1],0];if(rn(ct)<1e-12||rn(ht)<1e-12)return Vl(d);const mt=$s([],ct,ht);ss(mt,mt),mr(ht,_,s),ct[2]=(tt-j)*ot,ht[2]=(rt-j)*ot;const gt=ct;return $s(gt,ct,ht),ss(gt,gt),Mu(d,mt,gt)}function SE(d,s,a=!1){const _=Ny(s.zoom),j=function(tt,rt,ot){const ct=rt.worldSize,ht=[tt[12],tt[13],tt[14]],mt=dr(ht[1]/ct),gt=gr(ht[0]/ct),_t=At([]),Rt=hr(1,mt)*ct,Pt=hr(1,0)*ct*Ir(mt,rt.zoom),zt=1/Jw(ct);let Vt=Pt*zt;if(ot){const rr=z1(rt.projection,rt.zoom,rt.width,rt.height,1024);Vt=zt*rt.projection.pixelSpaceConversion(rt.center.lat,ct,rr)}const Gt=Et(mt,gt);Xt(Gt,Gt,Cr([],ss([],Gt),Rt*Vt*ht[2]));const _i=function(rr){const _r=[rr[0],rr[1],rr[2]];let xr=[0,1,0];const Er=$s([],xr,_r);return $s(xr,_r,Er),Zn(xr)===0&&(xr=[0,1,0],$s(Er,_r,xr)),ss(Er,Er),ss(xr,xr),ss(_r,_r),[Er[0],Er[1],Er[2],0,xr[0],xr[1],xr[2],0,_r[0],_r[1],_r[2],0,rr[0],rr[1],rr[2],1]}(Gt);St(_t,_t,[Vt,Vt,Vt*Rt]),It(_t,_t,[-ht[0],-ht[1],-ht[2]]);const er=Tt([],rt.globeMatrix,_i);return Tt(er,er,_t),Tt(er,er,tt),er}(d,s,a);if(_>0){const tt=function(rt,ot){const ct=ot.worldSize,ht=hr(1,0)*ct*Ir(ot.center.lat,ot.zoom)/Jw(ct),mt=hr(1,ot.center.lat)*ct,gt=At([]);Ht(gt,gt,Lr(ot.center.lng)),jt(gt,gt,Lr(ot.center.lat)),It(gt,gt,[0,0,_e]),St(gt,gt,[ht,ht,ht*mt]);const _t=ot.point;return It(gt,gt,[-_t.x,-_t.y,0]),Tt(gt,gt,rt),Tt(gt,ot.globeMatrix,gt)}(d,s);return function(rt,ot,ct){const ht=(Pt,zt,Vt)=>{const Gt=rn(Pt),_i=rn(zt),er=Qm(Pt,zt,Vt);return Cr(er,er,1/rn(er)*ns(Gt,_i,Vt))},mt=ht([rt[0],rt[1],rt[2]],[ot[0],ot[1],ot[2]],ct),gt=ht([rt[4],rt[5],rt[6]],[ot[4],ot[5],ot[6]],ct),_t=ht([rt[8],rt[9],rt[10]],[ot[8],ot[9],ot[10]],ct),Rt=Qm([rt[12],rt[13],rt[14]],[ot[12],ot[13],ot[14]],ct);return[mt[0],mt[1],mt[2],0,gt[0],gt[1],gt[2],0,_t[0],_t[1],_t[2],0,Rt[0],Rt[1],Rt[2],1]}(j,tt,_)}return j}function FS(d,s,a,_){const j=cs.projectAabbCorners(_,a);let tt=Number.MAX_VALUE,rt=-1;for(let ht=0;ht<j.length;++ht){const mt=j[ht];mt[0]=(.5*mt[0]+.5)*s.width,mt[1]=(.5-.5*mt[1])*s.height,mt[2]<tt&&(rt=ht,tt=mt[2])}const ot=ht=>new yn(j[ht][0],j[ht][1]);let ct;switch(rt){case 0:case 6:ct=[ot(1),ot(5),ot(4),ot(7),ot(3),ot(2),ot(1)];break;case 1:case 7:ct=[ot(0),ot(4),ot(5),ot(6),ot(2),ot(3),ot(0)];break;case 3:case 5:ct=[ot(1),ot(0),ot(4),ot(7),ot(6),ot(2),ot(1)];break;default:ct=[ot(1),ot(5),ot(6),ot(7),ot(3),ot(0),ot(1)]}if(Bu(d,ct))return tt}const S_=64,Ox={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function OS(d,s,a,_,j,tt,rt,ot,ct,ht=!1){const mt=a.zoom,gt=a.project(_),_t=Ir(_.lat,mt),Rt=1/_t;At(d),It(d,d,[gt.x+rt[0]*Rt,gt.y+rt[1]*Rt,rt[2]]);let Pt=1,zt=1;const Vt=a.worldSize;if(ht){if(a.projection.name==="mercator"){let rr=0;a.elevation&&(rr=a.elevation.getAtPointOrZero(new Yr(gt.x/Vt,gt.y/Vt),0));const _r=Uo([],[gt.x,gt.y,rr,1],a.projMatrix)[3]/a.cameraToCenterDistance;Pt=_r,zt=_r*Ir(a.center.lat,mt)}else if(a.projection.name==="globe"){const rr=SE(d,a),_r=[0,0,0,1];Uo(_r,_r,Tt([],a.projMatrix,rr));const xr=_r[3]/a.cameraToCenterDistance,Er=Ny(mt),Ar=a.projection.pixelsPerMeter(_.lat,Vt)*Ir(_.lat,mt),Pr=a.projection.pixelsPerMeter(a.center.lat,Vt)*Ir(a.center.lat,mt);Pt=xr/ns(Ar,Vr(a.center.lat),Er),zt=xr*_t/Ar,Pt*=Pr,zt*=Pr}}else Pt=Rt;St(d,d,[Pt,Pt,zt]);const Gt=[...d],_i=s.orientation,er=[];if(jS(er,[_i[0]+j[0],_i[1]+j[1],_i[2]+j[2]],tt),Tt(d,Gt,er),ot&&a.elevation){let rr=0;const _r=[];if(ct&&a.elevation){rr=function(Er,Ar,Pr,sn,Fr){const on=Ar.elevation;if(!on)return 0;const gn=cs.projectAabbCorners(Pr,sn),an=hr(1,Fr.lat)*Ar.worldSize,hn=function(An,Kn){const ps=[0,0,1],kn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const $n of kn){const ls=An[$n.corners[0]],ms=An[$n.corners[1]],Is=An[$n.corners[2]],xs=[ms[0]-ls[0],ms[1]-ls[1],Kn*(ms[2]-ls[2])],Nn=$s(xs,xs,[Is[0]-ls[0],Is[1]-ls[1],Kn*(Is[2]-ls[2])]);ss(Nn,Nn),$n.dotProductWithUp=Ls(Nn,ps)}return kn.sort(($n,ls)=>$n.dotProductWithUp-ls.dotProductWithUp),kn[0].corners}(gn,an),vn=gn[hn[0]],tn=gn[hn[1]],dn=gn[hn[2]],qr=gn[hn[3]],Gr=on.getAtPointOrZero(new Yr(vn[0]/Ar.worldSize,vn[1]/Ar.worldSize),0),wn=on.getAtPointOrZero(new Yr(tn[0]/Ar.worldSize,tn[1]/Ar.worldSize),0),_n=on.getAtPointOrZero(new Yr(dn[0]/Ar.worldSize,dn[1]/Ar.worldSize),0),Yn=on.getAtPointOrZero(new Yr(qr[0]/Ar.worldSize,qr[1]/Ar.worldSize),0),jn=(Gr+Yn)/2,Bn=(wn+_n)/2;return jn>Bn?wn<_n?N1(Er,tn,qr,vn,wn,Yn,Gr,an):N1(Er,dn,vn,qr,_n,Gr,Yn,an):Gr<Yn?N1(Er,vn,tn,dn,Gr,wn,_n,an):N1(Er,qr,dn,tn,Yn,_n,wn,an),Math.max(jn,Bn)}(_r,a,s.aabb,d,_);const xr=Tt([],kr([],_r),er);Tt(d,Gt,xr)}else rr=a.elevation.getAtPointOrZero(new Yr(gt.x/Vt,gt.y/Vt),0);rr!==0&&(d[14]+=rr)}}function a0(d,s,a=!1){d.uploaded||(d.gfxTexture=new EE(s,d.image,a?s.gl.R8:s.gl.RGBA8,{useMipmap:d.sampler.minFilter>=s.gl.NEAREST_MIPMAP_NEAREST}),d.uploaded=!0,d.image=null)}function dR(d,s,a){d.indexBuffer=s.createIndexBuffer(d.indexArray,!1,!0),d.vertexBuffer=s.createVertexBuffer(d.vertexArray,sR.members,!1,!0),d.normalArray&&(d.normalBuffer=s.createVertexBuffer(d.normalArray,cR.members,!1,!0)),d.texcoordArray&&(d.texcoordBuffer=s.createVertexBuffer(d.texcoordArray,lR.members,!1,!0)),d.colorArray&&(d.colorBuffer=s.createVertexBuffer(d.colorArray,(d.colorArray.bytesPerElement===12?oR:aR).members,!1,!0)),d.featureArray&&(d.pbrBuffer=s.createVertexBuffer(d.featureArray,hR.members,!0)),d.segments=Bo.simpleSegment(0,0,d.vertexArray.length,d.indexArray.length);const _=d.material;_.pbrMetallicRoughness.baseColorTexture&&a0(_.pbrMetallicRoughness.baseColorTexture,s),_.pbrMetallicRoughness.metallicRoughnessTexture&&a0(_.pbrMetallicRoughness.metallicRoughnessTexture,s),_.normalTexture&&a0(_.normalTexture,s),_.occlusionTexture&&a0(_.occlusionTexture,s,a),_.emissionTexture&&a0(_.emissionTexture,s)}function CE(d,s,a){if(d.meshes)for(const _ of d.meshes)dR(_,s,a);if(d.children)for(const _ of d.children)CE(_,s,a)}function B1(d){if(d.meshes)for(const s of d.meshes)s.indexArray.destroy(),s.vertexArray.destroy(),s.colorArray&&s.colorArray.destroy(),s.normalArray&&s.normalArray.destroy(),s.texcoordArray&&s.texcoordArray.destroy(),s.featureArray&&s.featureArray.destroy();if(d.children)for(const s of d.children)B1(s)}function AE(d){if(d.meshes)for(const a of d.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((s=a.material).pbrMetallicRoughness.baseColorTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),s.pbrMetallicRoughness.metallicRoughnessTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),s.normalTexture&&s.normalTexture.gfxTexture&&s.normalTexture.gfxTexture.destroy(),s.emissionTexture&&s.emissionTexture.gfxTexture&&s.emissionTexture.gfxTexture.destroy(),s.occlusionTexture&&s.occlusionTexture.gfxTexture&&s.occlusionTexture.gfxTexture.destroy()));var s;if(d.children)for(const a of d.children)AE(a)}function C_(d,s){const a=d.json.bufferViews[s.bufferView],_=F1[s.componentType];return new _(d.buffers[a.buffer],(s.byteOffset||0)+(a.byteOffset||0),s.count*(a.byteStride&&a.byteStride!==s0[s.type]*_.BYTES_PER_ELEMENT?a.byteStride/_.BYTES_PER_ELEMENT:s0[s.type]))}function RE(d,s,a,_){const j=F1[s.componentType],tt=function(mt){switch(mt){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(j),rt=d.json.bufferViews[s.bufferView],ot=rt.byteStride?rt.byteStride/j.BYTES_PER_ELEMENT:s0[s.type],ct=a.float32,ht=ct.length/a.capacity;for(let mt=0,gt=0;mt<s.count*ot;mt+=ot,gt+=ht)for(let _t=0;_t<ht;_t++)ct[gt+_t]=_[mt+_t]*tt;a._trim()}function pR(d,s,a){const _=d.indices,j=d.attributes,tt={};tt.indexArray=new Dl;const rt=s.json.accessors[_],ot=rt.count/3;tt.indexArray.reserve(ot);const ct=C_(s,rt);for(let _t=0;_t<ot;_t++)tt.indexArray.emplaceBack(ct[3*_t],ct[3*_t+1],ct[3*_t+2]);tt.indexArray._trim(),tt.vertexArray=new vu;const ht=s.json.accessors[j.POSITION];tt.vertexArray.reserve(ht.count);const mt=C_(s,ht);for(let _t=0;_t<ht.count;_t++)tt.vertexArray.emplaceBack(mt[3*_t],mt[3*_t+1],mt[3*_t+2]);if(tt.vertexArray._trim(),tt.aabb=new cs(ht.min,ht.max),tt.centroid=function(_t,Rt){const Pt=[0,0,0],zt=_t.length;if(zt>0){for(let Vt=0;Vt<zt;Vt++){const Gt=3*_t[Vt];Pt[0]+=Rt[Gt],Pt[1]+=Rt[Gt+1],Pt[2]+=Rt[Gt+2]}Pt[0]/=zt,Pt[1]/=zt,Pt[2]/=zt}return Pt}(ct,mt),j.COLOR_0!==void 0){const _t=s.json.accessors[j.COLOR_0],Rt=s0[_t.type],Pt=C_(s,_t);tt.colorArray=Rt===3?new vu:new ap,tt.colorArray.resize(_t.count),RE(s,_t,tt.colorArray,Pt)}if(j.NORMAL!==void 0){tt.normalArray=new vu;const _t=s.json.accessors[j.NORMAL];tt.normalArray.resize(_t.count);const Rt=C_(s,_t);RE(s,_t,tt.normalArray,Rt)}if(j.TEXCOORD_0!==void 0&&a.length>0){tt.texcoordArray=new jy;const _t=s.json.accessors[j.TEXCOORD_0];tt.texcoordArray.resize(_t.count);const Rt=C_(s,_t);RE(s,_t,tt.texcoordArray,Rt)}if(j._FEATURE_ID_RGBA4444!==void 0){const _t=s.json.accessors[j._FEATURE_ID_RGBA4444];s.json.extensionsUsed&&s.json.extensionsUsed.includes("EXT_meshopt_compression")&&(tt.featureData=C_(s,_t))}j._FEATURE_RGBA4444!==void 0&&(tt.featureData=new Uint32Array(C_(s,s.json.accessors[j._FEATURE_RGBA4444]).buffer));const gt=d.material;return tt.material=function(_t,Rt){const{emissiveFactor:Pt=[0,0,0],alphaMode:zt="OPAQUE",alphaCutoff:Vt=.5,normalTexture:Gt,occlusionTexture:_i,emissiveTexture:er,doubleSided:rr}=_t,{baseColorFactor:_r=[1,1,1,1],metallicFactor:xr=1,roughnessFactor:Er=1,baseColorTexture:Ar,metallicRoughnessTexture:Pr}=_t.pbrMetallicRoughness||{},sn=_i?Rt[_i.index]:void 0;if(_i&&_i.extensions&&_i.extensions.KHR_texture_transform&&sn){const Fr=_i.extensions.KHR_texture_transform;sn.offsetScale=[Fr.offset[0],Fr.offset[1],Fr.scale[0],Fr.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Js(..._r),metallicFactor:xr,roughnessFactor:Er,baseColorTexture:Ar?Rt[Ar.index]:void 0,metallicRoughnessTexture:Pr?Rt[Pr.index]:void 0},doubleSided:rr,emissiveFactor:new Js(...Pt),alphaMode:zt,alphaCutoff:Vt,normalTexture:Gt?Rt[Gt.index]:void 0,occlusionTexture:sn,emissionTexture:er?Rt[er.index]:void 0,defined:_t.defined===void 0}}(gt!==void 0?s.json.materials[gt]:{defined:!1},a),tt}function zS(d,s,a){const{matrix:_,rotation:j,translation:tt,scale:rt,mesh:ot,extras:ct,children:ht}=d,mt={};if(mt.matrix=_||function(gt,_t,Rt,Pt){var zt=_t[0],Vt=_t[1],Gt=_t[2],_i=_t[3],er=zt+zt,rr=Vt+Vt,_r=Gt+Gt,xr=zt*er,Er=zt*rr,Ar=zt*_r,Pr=Vt*rr,sn=Vt*_r,Fr=Gt*_r,on=_i*er,gn=_i*rr,an=_i*_r,hn=Pt[0],vn=Pt[1],tn=Pt[2];return gt[0]=(1-(Pr+Fr))*hn,gt[1]=(Er+an)*hn,gt[2]=(Ar-gn)*hn,gt[3]=0,gt[4]=(Er-an)*vn,gt[5]=(1-(xr+Fr))*vn,gt[6]=(sn+on)*vn,gt[7]=0,gt[8]=(Ar+gn)*tn,gt[9]=(sn-on)*tn,gt[10]=(1-(xr+Pr))*tn,gt[11]=0,gt[12]=Rt[0],gt[13]=Rt[1],gt[14]=Rt[2],gt[15]=1,gt}([],j||[0,0,0,1],tt||[0,0,0],rt||[1,1,1]),ot!==void 0){mt.meshes=a[ot];const gt=mt.anchor=[0,0];for(const _t of mt.meshes){const{min:Rt,max:Pt}=_t.aabb;gt[0]+=Rt[0]+Pt[0],gt[1]+=Rt[1]+Pt[1]}gt[0]=Math.floor(gt[0]/mt.meshes.length/2),gt[1]=Math.floor(gt[1]/mt.meshes.length/2)}if(ct&&(ct.id&&(mt.id=ct.id),ct.lights&&(mt.lights=function(gt){if(!gt.length)return[];const _t=function(Gt){const _i=atob(Gt),er=new Uint8Array(_i.length);for(let rr=0;rr<_i.length;rr++)er[rr]=_i.codePointAt(rr);return er}(gt),Rt=[],Pt=_t.length/24,zt=new Uint16Array(_t.buffer),Vt=new Float32Array(_t.buffer);for(let Gt=0;Gt<Pt;Gt++){const _i=zt[2*Gt*6]/30,er=zt[2*Gt*6+1]/30,rr=zt[2*Gt*6+10]/100,_r=Vt[6*Gt+1],xr=Vt[6*Gt+2],Er=Vt[6*Gt+3],Ar=Vt[6*Gt+4],Pr=Er-_r,sn=Ar-xr,Fr=Math.hypot(Pr,sn);Rt.push({pos:[_r+.5*Pr,xr+.5*sn,er],normal:[sn/Fr,-Pr/Fr,0],width:Fr,height:_i,depth:rr,points:[_r,xr,Er,Ar]})}return Rt}(ct.lights))),ht){const gt=[];for(const _t of ht)gt.push(zS(s.json.nodes[_t],s,a));mt.children=gt}return mt}function fR(d){if(d.vertices.length===0||d.indices.length===0)return null;const s=new R1(d.vertices,d.indices,8,256),[a,_]=[s.min.clone(),s.max.clone()];return{vertices:d.vertices,indices:d.indices,grid:s,min:a,max:_}}function mR(d){if(!d.extras||!d.extras.ground)return null;const s=d.extras.ground;if(!s||!Array.isArray(s)||s.length===0)return null;const a=s[0];if(!a||!Array.isArray(a)||a.length===0)return null;const _=[];for(const rt of a){if(!Array.isArray(rt)||rt.length!==2)continue;const ot=rt[0],ct=rt[1];typeof ot=="number"&&typeof ct=="number"&&_.push(new yn(ot,ct))}if(_.length<3)return null;_.length>1&&_[_.length-1].equals(_[0])&&_.pop();let j=0;for(let rt=0;rt<_.length;rt++){const ot=_[rt],ct=_[(rt+1)%_.length],ht=_[(rt+2)%_.length];j+=(ot.x-ct.x)*(ht.y-ct.y)-(ht.x-ct.x)*(ot.y-ct.y)}j>0&&_.reverse();const tt=Mx(_.flatMap(rt=>[rt.x,rt.y]),[]);return tt.length===0?null:{vertices:_,indices:tt}}function gR(d,s){const a=[],_=[];let j=0;const tt=[];for(const rt of d){j=a.length;const ot=rt.vertexArray.float32,ct=rt.indexArray.uint16;for(let ht=0;ht<rt.vertexArray.length;ht++)tt[0]=ot[3*ht+0],tt[1]=ot[3*ht+1],tt[2]=ot[3*ht+2],Vs(tt,tt,s),a.push(new yn(tt[0],tt[1]));for(let ht=0;ht<3*rt.indexArray.length;ht++)_.push(ct[ht]+j)}if(_.length%3!=0)return null;for(let rt=0;rt<_.length;rt+=3){const ot=a[_[rt+0]],ct=a[_[rt+1]],ht=a[_[rt+2]];(ot.x-ct.x)*(ht.y-ct.y)-(ht.x-ct.x)*(ot.y-ct.y)>0&&([_[rt+1],_[rt+2]]=[_[rt+2],_[rt+1]])}return{vertices:a,indices:_}}function NS(d){const s=function(ct,ht){const mt=[],gt=WebGL2RenderingContext;if(ct.json.textures)for(const _t of ct.json.textures){const Rt={magFilter:gt.LINEAR,minFilter:gt.NEAREST,wrapS:gt.REPEAT,wrapT:gt.REPEAT};_t.sampler!==void 0&&Object.assign(Rt,ct.json.samplers[_t.sampler]),mt.push({image:ht[_t.source],sampler:Rt,uploaded:!1})}return mt}(d,d.images),a=function(ct,ht){const mt=[];for(const gt of ct.json.meshes){const _t=[];for(const Rt of gt.primitives)_t.push(pR(Rt,ct,ht));mt.push(_t)}return mt}(d,s),{scenes:_,scene:j,nodes:tt}=d.json,rt=_?_[j||0].nodes:[...tt.keys()],ot=[];for(const ct of rt)ot.push(zS(tt[ct],d,a));return function(ct,ht,mt){const gt={},_t=new Set;for(let Rt=0;Rt<ct.length;Rt++){const Pt=mt[ht[Rt]];if(!Pt.extras)continue;const zt=Pt.extras["mapbox:footprint:version"],Vt=Pt.extras["mapbox:footprint:id"];(zt||Vt)&&_t.add(Rt),zt==="1.0.0"&&Vt&&(gt[Vt]=Rt)}for(let Rt=0;Rt<ct.length;Rt++){if(_t.has(Rt))continue;const Pt=ct[Rt],zt=mt[ht[Rt]];if(!zt.extras)continue;let Vt=null;Pt.id in gt&&(Vt=gR(ct[gt[Pt.id]].meshes,Pt.matrix)),Vt||(Vt=mR(zt)),Vt&&(Pt.footprint=fR(Vt))}if(_t.size>0){const Rt=Array.from(_t.values()).sort((Pt,zt)=>Pt-zt);for(let Pt=Rt.length-1;Pt>=0;Pt--)ct.splice(Rt[Pt],1)}}(ot,rt,d.json.nodes),ot}function yR(d){d.heightmap=new Float32Array(4096),d.heightmap.fill(-1);const s=d.vertexArray.float32,a=d.aabb.min[0]-1,_=d.aabb.min[1]-1,j=S_/(d.aabb.max[0]-a+2),tt=S_/(d.aabb.max[1]-_+2);for(let rt=0;rt<s.length;rt+=3){const ot=s[rt+2],ct=(s[rt+0]-a)*j|0,ht=(s[rt+1]-_)*tt|0;ot>d.heightmap[ht*S_+ct]&&(d.heightmap[ht*S_+ct]=ot)}}function BS(d,s,a,_,j){a.reserve(a.length+4*d.length),_.reserve(_.length+10*d.length),j.reserve(j.length+10*d.length);let tt=_.length;for(const rt of d){const ot=Math.min(10,Math.max(4,1.3*rt.height))*s,ct=[-rt.normal[1],rt.normal[0],0],ht=Math.min(.29,.1*rt.width/rt.depth),mt=rt.width-2*rt.depth*s*(ht+.01),gt=pn([],rt.pos,ct,mt/2),_t=pn([],rt.pos,ct,-mt/2),Rt=[gt[0],gt[1],gt[2]+rt.height],Pt=[_t[0],_t[1],_t[2]+rt.height],zt=pn([],rt.normal,ct,ht);Cr(zt,zt,ot);const Vt=pn([],rt.normal,ct,-ht);Cr(Vt,Vt,ot),Xt(zt,gt,zt),Xt(Vt,_t,Vt),gt[2]+=.1,_t[2]+=.1,_.emplaceBack(zt[0],zt[1],zt[2]),_.emplaceBack(Vt[0],Vt[1],Vt[2]),_.emplaceBack(gt[0],gt[1],gt[2]),_.emplaceBack(_t[0],_t[1],_t[2]),_.emplaceBack(Rt[0],Rt[1],Rt[2]),_.emplaceBack(Pt[0],Pt[1],Pt[2]),_.emplaceBack(gt[0],gt[1],gt[2]),_.emplaceBack(_t[0],_t[1],_t[2]),_.emplaceBack(zt[0],zt[1],zt[2]),_.emplaceBack(Vt[0],Vt[1],Vt[2]);const Gt=mt/ot/2;j.emplaceBack(-Gt-ht,-1,Gt,.8),j.emplaceBack(Gt+ht,-1,Gt,.8),j.emplaceBack(-Gt,0,Gt,1.3),j.emplaceBack(Gt,0,Gt,1.3),j.emplaceBack(Gt+ht,-.8,Gt,.7),j.emplaceBack(Gt+ht,-.8,Gt,.7),j.emplaceBack(0,0,Gt,1.3),j.emplaceBack(0,0,Gt,1.3),j.emplaceBack(Gt+ht,-1.2,Gt,.8),j.emplaceBack(Gt+ht,-1.2,Gt,.8),a.emplaceBack(6+tt,4+tt,8+tt),a.emplaceBack(7+tt,9+tt,5+tt),a.emplaceBack(0+tt,1+tt,2+tt),a.emplaceBack(1+tt,3+tt,2+tt),tt+=10}}function _R(d,s){const a={};a.indexArray=new Dl,a.vertexArray=new vu,a.colorArray=new ap,BS(d,s,a.indexArray,a.vertexArray,a.colorArray);const _={defined:!0};_.emissiveFactor=Js.black;const j={};return j.baseColorFactor=Js.white,_.pbrMetallicRoughness=j,a.material=_,a.aabb=new cs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const VS=zs([{name:"a_pos_3f",components:3,type:"Float32"}]),xR=zs([{name:"a_normal_3",components:3,type:"Int16"}]),vR=zs([{name:"a_centroid_3",components:3,type:"Int16"}]),US=zs([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),bR=zs([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),wR=zs([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),ER=zs([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),TR=zs([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),GS=mn.types,PE=32767;function SR(d,s){const a=Rn+s;for(const _ of d)for(const j of _)if(j.x<-s||j.x>a||j.y<-s||j.y>a)return!1;return!0}class $S{constructor(){this.layoutVertexArray=new vu,this.layoutAttenuationArray=new ap,this.layoutColorArray=new Sl,this.indexArray=new Dl,this.indexArrayForConflation=new Dl,this.segmentsBucket=new Bo}}class IE{constructor(){this.layoutVertexArray=new vu,this.layoutNormalArray=new qm,this.layoutCentroidArray=new qm,this.layoutColorArray=new Sl,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new Dl,this.indexArrayForConflation=new Dl,this.segmentsBucket=new Bo,this.entranceBloom=new $S}}class HS{constructor(s){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new IE,this.buildingWithFacade=new IE,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=s.zoom,this.canonical=s.canonical,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.worldview=s.worldview,this.lut=s.lut,this.buildingWithFacade.layoutFacadePaintArray=new Sl,this.buildingWithFacade.layoutFacadeDataArray=new ky,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Sl,this.programConfigurations=new lp(s.layers,{zoom:s.zoom,lut:s.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=s.projection,this.groundEffect=new fE(s)}updateFootprints(s,a){for(const _ of this.footprints)a.push({footprint:_,id:s})}prepare(){return function(){if(j1!=null||ES!=null)return null;if(Fx!=null)return Fx;const s=fetch(Gl.BUILDING_GEN_URL);return Fx=function(a){let _,j,tt,rt;function ot(){_=new Uint8Array(rt.buffer),j=new Int32Array(rt.buffer),tt=new Float32Array(rt.buffer)}function ct(){throw new Error("Unexpected BuildingGen error.")}const ht=()=>{},mt={a:{a:ct,f:function(gt){const _t=_.length,Rt=Math.max(gt>>>0,Math.ceil(1.2*_t)),Pt=Math.ceil((Rt-_t)/65536);try{return rt.grow(Pt),ot(),!0}catch{return!1}},g:ct,b:ht,c:ht,d:ht,e:ht}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,mt):a.then(gt=>gt.arrayBuffer()).then(gt=>WebAssembly.instantiate(gt,mt))).then(gt=>{const _t=gt.instance.exports;return(0,_t.g)(),rt=_t.f,ot(),new QA({setStyle:_t.h,setAOOptions:_t.i,setMetricOptions:_t.j,setStructuralOptions:_t.k,setFacadeOptions:_t.l,setFauxFacadeOptions:_t.m,setFacadeClassifierOptions:_t.n,addFeature:_t.o,addFacade:_t.p,generateMesh:_t.q,getLastError:_t.r,getOuterRingLength:_t.s,getMeshCount:_t.t,getPositionsPtr:_t.u,getPositionsLength:_t.v,getNormalsPtr:_t.w,getNormalsLength:_t.x,getColorsPtr:_t.y,getColorsLength:_t.z,getAOPtr:_t.A,getAOLength:_t.B,getUVPtr:_t.C,getUVLength:_t.D,getFauxFacadePtr:_t.E,getFauxFacadeLength:_t.F,getIndicesPtr:_t.G,getIndicesLength:_t.H,getBuildingPart:_t.I,getRingCount:_t.J,getRingPtr:_t.K,getRingLength:_t.L,free:_t.M,malloc:_t.N,heapU8:_,heap32:j,heapF32:tt})})}(s).then(a=>(Fx=null,j1=a,j1)).catch(a=>{Es("Could not load building-gen"),Fx=null,ES=a}),Fx}()}populate(s,a,_,j){const tt=JA();if(!tt)return;const rt=Nr(_);this.tileToMeter=rt,this.brightness=a.brightness,tt.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,rt],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:rt,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),tt.setAOOptions(!1,.3),tt.setMetricOptions(!1,16),tt.setStructuralOptions(!0),tt.setFacadeClassifierOptions(3);const ot=new Map;for(const{feature:ct}of s){if(GS[ct.type]!=="LineString")continue;const ht=this.layers[0]._featureFilter.needGeometry,mt=xn(ct,ht);if(!this.layers[0]._featureFilter.filter(new yo(this.zoom),mt,_))continue;const gt=ht?mt.geometry:Ln(ct,_,j),_t=[];for(const Vt of gt)for(const Gt of Vt)_t.push({x:Gt.x,y:Gt.y});const Rt={coordinates:_t,crossPerc:ct.properties.cross_perc,distanceToRoad:ct.properties.distance_to_road,entrances:ct.properties.entrances,sourceId:0},Pt=ct.properties.source_id;let zt=ot.get(Pt);zt||(zt=[],ot.set(Pt,zt)),zt.push(Rt)}this.maxHeight=0;for(const{feature:ct,index:ht}of s){if(GS[ct.type]==="LineString")continue;const mt=this.layers[0]._featureFilter.needGeometry,gt=xn(ct,mt);if(!this.layers[0]._featureFilter.filter(new yo(this.zoom),gt,_))continue;const _t=mt?gt.geometry:Ln(ct,_,j),Rt=Kv(_t,500);if(!SR(_t,163))continue;const Pt=this.layers[0],zt=Pt.layout.get("building-base").evaluate(ct,{},_),Vt=Pt.layout.get("building-height").evaluate(ct,{},_),Gt=Pt.layout.get("building-roof-shape").evaluate(ct,{},_),_i=Pt.paint.get("building-ambient-occlusion-intensity"),er=Pt.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(Gt==="flat")continue;const rr=Pt.layout.get("building-facade").evaluate(ct,{},_);tt.setFacadeOptions(4,!0),tt.setFauxFacadeOptions(rr,!1,1);const _r=ct.properties.source_id;let xr;xr=ot.has(_r)?ot.get(_r):[];let Er=0,Ar=0,Pr=0,sn=0,Fr=0,on=0;if(rr){let Nn=Math.round(Pt.layout.get("building-facade-floors").evaluate(ct,{},_));if(zt===0){Nn=Math.max(1,Nn-(xr.length>0?1:0));let Bs=4;if(Vt>100){const or=[10,13,15];Bs=or[ct.id?ct.id%or.length:0],tt.setFacadeOptions(Bs,!0)}Fr=1.6803*Bs/rt}else Fr=zt/rt;on=Vt/rt,Fr=Math.min(Fr,on),Pr=Pt.layout.get("building-facade-unit-width").evaluate(ct,{},_)/rt,sn=(on-Fr)/Nn,tt.setFauxFacadeOptions(!0,!0,Pr);const ys=Pt.layout.get("building-facade-window").evaluate(ct,{},_);Er=ys[0],Ar=ys[1]}const gn=[],an=new yn(1/0,1/0),hn=new yn(-1/0,-1/0),vn=new yn(0,0);let tn=0;for(const Nn of Rt)if(Nn.length>0){const ys=[];for(const Bs of Nn){const or=[];for(let ar=Bs.length-1;ar>=0;ar--){const Wr=Bs[ar];or.push({x:Wr.x,y:Wr.y}),an.x=Math.min(an.x,Wr.x),an.y=Math.min(an.y,Wr.y),hn.x=Math.max(hn.x,Wr.x),hn.y=Math.max(hn.y,Wr.y),vn.x+=Wr.x,vn.y+=Wr.y,tn++}ys.push(or)}gn.push({id:ct.id?ct.id:0,height:Vt,minHeight:zt,sourceId:0,roofType:Gt,coordinates:ys})}vn.x/=tn||1,vn.y/=tn||1;const dn=tt.generateMesh(gn,xr);if(typeof dn=="string"){Es(`Unable to generate building ${ct.id}: ${dn}`);continue}if(dn.meshes.length===0||dn.modifiedPolygonRings.length===0)continue;let qr=0;for(const Nn of dn.meshes)qr+=Nn.positions.length/3;const Gr=rr?this.buildingWithFacade:this.buildingWithoutFacade,wn=Gr.segmentsBucket.prepareSegment(qr,Gr.layoutVertexArray,Gr.indexArray),_n=[];let Yn=null,jn=0,Bn=-1;const An=Gr.indexArray.length;let Kn=0;for(const Nn of dn.meshes){const ys=Gr.layoutVertexArray.length;if(Nn.buildingPart==="entrance"){const nn=new Array;for(let es=0;es<Nn.indices.length;es+=12){const Ms=Nn.positions[es+0],ks=Nn.positions[es+1],Ps=Nn.positions[es+3],oo=Nn.positions[es+4],Lo=Nn.positions[es+2],Cs=Nn.positions[es+8]-Lo,_o=1,lo=Ps-Ms,Ks=oo-ks,wo=Math.hypot(lo,Ks);nn.push({pos:[Ms+.5*lo,ks+.5*Ks,Lo],normal:[Ks/wo,-lo/wo,0],width:wo,height:Cs,depth:_o,points:[Ms,ks,Ps,oo]})}const Mn=Gr.entranceBloom.segmentsBucket.prepareSegment(10*nn.length,Gr.entranceBloom.layoutVertexArray,Gr.entranceBloom.indexArray),In=Gr.entranceBloom.layoutVertexArray.length;jn=Gr.entranceBloom.indexArray.length,BS(nn,.5/this.tileToMeter,Gr.entranceBloom.indexArray,Gr.entranceBloom.layoutVertexArray,Gr.entranceBloom.layoutAttenuationArray);const zn=Gr.entranceBloom.layoutVertexArray.length-In;Bn=Gr.entranceBloom.indexArray.length-jn;for(let es=0;es<zn;es++)Gr.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Mn.vertexLength+=zn,Mn.primitiveLength+=Bn,Yn={part:Nn.buildingPart,vertexOffset:In,vertexLength:zn}}for(let nn=0;nn<Nn.positions.length;nn+=3)Kn=Math.max(Kn,Nn.positions[nn+2]),Gr.layoutVertexArray.emplaceBack(Nn.positions[nn],Nn.positions[nn+1],Nn.positions[nn+2]);const Bs=Math.floor(vn.x),or=Math.floor(vn.y),ar=Math.floor(Kn);for(let nn=0;nn<Nn.positions.length;nn+=3)Gr.layoutCentroidArray.emplaceBack(Bs,or,ar);for(let nn=0;nn<Nn.normals.length;nn+=3)Gr.layoutNormalArray.emplaceBack(Nn.normals[nn+0]*PE,Nn.normals[nn+1]*PE,Nn.normals[nn+2]*PE);for(let nn=0;nn<Nn.ao.length;nn++)Gr.layoutAOArray.push(Nn.ao[nn]);for(let nn=0;nn<Nn.colors.length;nn+=3){const Mn=1+(Nn.ao[nn/3]-1)*_i;Gr.layoutColorArray.emplaceBack(Nn.colors[nn]*Mn<<8|Nn.colors[nn+1]*Mn,Nn.colors[nn+2]*Mn<<8)}if(rr){for(let nn=0;nn<Nn.positions.length;nn+=3)Gr.layoutFacadePaintArray.emplaceBack(65535,255);for(let nn=0;nn<Nn.isFauxFacade.length;nn++)if(Nn.isFauxFacade[nn]){const Mn=1|Math.min(65535,Math.floor(Nn.uv[2*nn]*dn.outerRingLength)),In=Math.floor(255*Er)<<8|Math.floor(255*Ar),zn=Math.floor(65535*Math.min(1,Pr/Rn)),es=Math.floor(65535*Math.min(1,sn/Rn));Gr.layoutFacadeDataArray.emplaceBack(Mn,In,zn,es);const Ms=Math.floor(65535*Math.min(1,Fr/Rn)),ks=Math.floor(65535*Math.min(1,on/Rn));Gr.layoutFacadeVerticalRangeArray.emplaceBack(Ms,ks)}else Gr.layoutFacadeDataArray.emplaceBack(0,0,0,0),Gr.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Wr=wn.vertexLength;for(let nn=0;nn<Nn.indices.length;nn+=3)Gr.indexArray.emplaceBack(Wr+Nn.indices[nn],Wr+Nn.indices[nn+1],Wr+Nn.indices[nn+2]);wn.vertexLength+=Nn.positions.length/3,wn.primitiveLength+=Nn.indices.length/3,(Nn.buildingPart==="roof"||Nn.buildingPart==="wall"||Nn.buildingPart==="facade_glazing"||Nn.buildingPart==="entrance")&&_n.push({part:Nn.buildingPart,vertexOffset:ys,vertexLength:Nn.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Kn),this.buildingFeatures.push({feature:gt,hasFauxFacade:rr,segment:wn,parts:_n,buildingBloom:Yn});const ps=Gr.indexArray.length-An,kn=[],$n=[],ls=new yn(1/0,1/0),ms=new yn(-1/0,-1/0),Is=this.groundEffect.vertexArray.length;for(const Nn of dn.modifiedPolygonRings){const ys=[],Bs=new yn(1/0,1/0),or=new yn(-1/0,-1/0);for(let ar=0;ar<Nn.length;ar+=2){const Wr=Nn.length-ar-2;Bs.x=Math.min(Bs.x,Nn[Wr]),Bs.y=Math.min(Bs.y,Nn[Wr+1]),or.x=Math.max(or.x,Nn[Wr]),or.y=Math.max(or.y,Nn[Wr+1]);const nn=new yn(Nn[Wr],Nn[Wr+1]);ys.push(nn),kn.push(nn.x,nn.y),$n.push(nn.clone())}ls.x=Math.min(ls.x,Bs.x),ls.y=Math.min(ls.y,Bs.y),ms.x=Math.max(ms.x,or.x),ms.y=Math.max(ms.y,or.y),this.groundEffect.addData(ys,[Bs,or],er)}const xs=this.groundEffect.vertexArray.length-Is;(an.x<0||hn.x>Rn||an.y<0||hn.y>Rn)&&this.featuresOnBorder.push({featureId:ct.id,footprintIndex:this.footprints.length});{const Nn=Mx(kn,null,2),ys=new R1($n,Nn,8,256);let Bs=ct.id;ct.properties&&ct.properties.hasOwnProperty("building_id")&&(Bs=ct.properties.building_id),this.footprints.push({vertices:$n,indices:Nn,grid:ys,min:ls,max:ms,buildingId:Bs,hiddenFlags:0,indicesOffset:An,indicesLength:ps,bloomIndicesOffset:jn,bloomIndicesLength:Bn,groundEffectVertexOffset:Is,groundEffectVertexLength:xs,hasFauxFacade:rr,segment:wn,height:Kn})}this.programConfigurations.populatePaintArrays(Gr.layoutVertexArray.length,ct,ht,{},a.availableImages,_,a.brightness),this.groundEffect.addPaintPropertiesData(ct,ht,{},a.availableImages,_,a.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(s,a,_,j,tt,rt,ot){this.programConfigurations.updatePaintArrays(s,a,tt,_,j,rt,ot),this.groundEffect.update(s,a,tt,_,j,rt,ot),this.evaluate(this.layers[0],s),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(s){const a=_=>{_.layoutVertexBuffer=s.createVertexBuffer(_.layoutVertexArray,VS.members),_.layoutNormalBuffer=s.createVertexBuffer(_.layoutNormalArray,xR.members),_.layoutCentroidBuffer=s.createVertexBuffer(_.layoutCentroidArray,vR.members),_.layoutFacadeDataArray&&_.layoutFacadeDataArray.length&&(_.layoutFacadeDataBuffer=s.createVertexBuffer(_.layoutFacadeDataArray,wR.members)),_.layoutFacadeVerticalRangeArray&&_.layoutFacadeVerticalRangeArray.length&&(_.layoutFacadeVerticalRangeBuffer=s.createVertexBuffer(_.layoutFacadeVerticalRangeArray,ER.members)),_.entranceBloom.layoutVertexArray.length&&(_.entranceBloom.layoutVertexBuffer=s.createVertexBuffer(_.entranceBloom.layoutVertexArray,VS.members),_.entranceBloom.layoutAttenuationBuffer=s.createVertexBuffer(_.entranceBloom.layoutAttenuationArray,TR.members)),this.uploadUpdatedColorBuffer(s),this.uploadUpdatedIndexBuffer(s)};this.uploaded||(a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.upload(s)),this.groundEffect.uploadPaintProperties(s),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){const s=a=>{a.layoutVertexBuffer&&(a.layoutVertexBuffer.destroy(),a.layoutNormalBuffer.destroy(),a.layoutColorBuffer.destroy(),a.segmentsBucket.destroy(),a.indexBuffer&&a.indexBuffer.destroy(),a.entranceBloom.layoutVertexBuffer&&(a.entranceBloom.layoutVertexBuffer.destroy(),a.entranceBloom.layoutColorBuffer.destroy(),a.entranceBloom.layoutAttenuationBuffer.destroy(),a.entranceBloom.indexBuffer.destroy(),a.entranceBloom.segmentsBucket.destroy()))};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(s,a,_=!0){let j=!1;const tt=_?a:0,rt=0|(_?-1:~a);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const ot of s){const ct=this.footprints[ot],ht=ct.hiddenFlags&rt|tt;ct.hiddenFlags!==ht&&(ct.hiddenFlags=ht,j=!0,this.groundEffect.updateHiddenByLandmarkRange(ct.groundEffectVertexOffset,ct.groundEffectVertexLength,ct.hiddenFlags!==0))}return j&&(this.indexArrayForConflationUploaded=!1),j}uploadUpdatedIndexBuffer(s){if(this.groundEffect.uploadHiddenByLandmark(s),this.indexArrayForConflationUploaded)return;const a=j=>{j.indexArray.length!==0&&(j.indexArrayForConflation.resize(j.indexArray.length),j.indexArrayForConflation.uint16.set(j.indexArray.uint16),j.entranceBloom.indexArrayForConflation.resize(j.entranceBloom.indexArray.length),j.entranceBloom.indexArrayForConflation.uint16.set(j.entranceBloom.indexArray.uint16))};a(this.buildingWithoutFacade),a(this.buildingWithFacade);for(const j of this.footprints){const tt=j.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,rt=j.indicesOffset+j.indicesLength;if(j.hiddenFlags!==0){for(let ct=j.indicesOffset;ct<rt;ct++)tt.indexArrayForConflation.uint16[3*ct+0]=0,tt.indexArrayForConflation.uint16[3*ct+1]=0,tt.indexArrayForConflation.uint16[3*ct+2]=0;const ot=j.bloomIndicesOffset+j.bloomIndicesLength;for(let ct=j.bloomIndicesOffset;ct<ot;ct++)tt.entranceBloom.indexArrayForConflation.uint16[3*ct+0]=0,tt.entranceBloom.indexArrayForConflation.uint16[3*ct+1]=0,tt.entranceBloom.indexArrayForConflation.uint16[3*ct+2]=0}}const _=j=>{j.indexArray.length!==0&&(j.indexBuffer?j.indexBuffer.updateData(j.indexArrayForConflation):j.indexBuffer=s.createIndexBuffer(j.indexArrayForConflation,!0),j.entranceBloom.indexBuffer?j.entranceBloom.indexBuffer.updateData(j.entranceBloom.indexArrayForConflation):j.entranceBloom.indexBuffer=s.createIndexBuffer(j.entranceBloom.indexArrayForConflation,!0))};_(this.buildingWithoutFacade),_(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(s){const a=_=>{_.layoutColorBuffer?_.layoutColorBuffer.updateData(_.layoutColorArray):_.layoutColorBuffer=s.createVertexBuffer(_.layoutColorArray,US.members,!0),_.layoutFacadePaintArray&&(_.layoutFacadePaintBuffer?_.layoutFacadePaintBuffer.updateData(_.layoutFacadePaintArray):_.layoutFacadePaintBuffer=s.createVertexBuffer(_.layoutFacadePaintArray,bR.members,!0)),_.entranceBloom.layoutColorBuffer?_.entranceBloom.layoutColorBuffer.updateData(_.entranceBloom.layoutColorArray):_.entranceBloom.layoutColorBuffer=s.createVertexBuffer(_.entranceBloom.layoutColorArray,US.members,!0)};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(s,a){const _=s.paint.get("building-ambient-occlusion-intensity");for(const j of this.buildingFeatures){const tt=a[j.feature.id],rt=j.feature;rt.properties["building-part"]="roof";const ot=s.paint.get("building-color").evaluate(rt,tt,this.canonical).toPremultipliedRenderColor(this.lut),ct=s.paint.get("building-emissive-strength").evaluate(rt,tt,this.canonical);rt.properties["building-part"]="wall";const ht=s.paint.get("building-color").evaluate(rt,tt,this.canonical).toPremultipliedRenderColor(this.lut),mt=s.paint.get("building-emissive-strength").evaluate(rt,tt,this.canonical);rt.properties["building-part"]="window";const gt=s.paint.get("building-color").evaluate(rt,tt,this.canonical).toPremultipliedRenderColor(this.lut),_t=s.paint.get("building-emissive-strength").evaluate(rt,tt,this.canonical);rt.properties["building-part"]="door";const Rt=s.paint.get("building-color").evaluate(rt,tt,this.canonical).toPremultipliedRenderColor(this.lut),Pt=s.paint.get("building-emissive-strength").evaluate(rt,tt,this.canonical),zt=j.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const Gt of j.parts){let _i,er=ot;Gt.part==="roof"?(er=ot,_i=ct):Gt.part==="wall"?(er=ht,_i=mt):Gt.part==="facade_glazing"?(er=gt,_i=_t):Gt.part==="entrance"&&(er=Rt,_i=Pt),_i=fr(_i,0,1);for(let rr=0;rr<Gt.vertexLength;rr++){const _r=Gt.vertexOffset+rr,xr=1+(zt.layoutAOArray[_r]-1)*_;zt.layoutColorArray.emplace(_r,er.r*xr*255<<8|er.g*xr*255,er.b*xr*255<<8|255*_i),j.hasFauxFacade&&zt.layoutFacadePaintArray.emplace(_r,255*gt.r<<8|255*gt.g,255*gt.b<<8|255*_t)}}const Vt=j.buildingBloom;if(Vt)for(let Gt=0;Gt<Vt.vertexLength;Gt++)zt.entranceBloom.layoutColorArray.emplace(Vt.vertexOffset+Gt,255*Rt.r<<8|255*Rt.g,255*Rt.b<<8|51*Pt)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(s,a,_){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const j=a.getReplacementRegionsForTile(s.toUnwrapped());if(I1(this.activeReplacements,j))return;this.activeReplacements=j;for(const rt of this.footprints)rt.hiddenFlags&=-2;const tt=[];for(const rt of this.activeReplacements){if(rt.order<=XT)continue;const ot=Math.max(1,Math.pow(2,rt.footprintTileId.canonical.z-s.canonical.z));for(const ct of this.footprints)ct.min.x>rt.max.x||ct.max.x<rt.min.x||ct.min.y>rt.max.y||ct.max.y<rt.min.y||(tt.length=0,CR(ct.vertices,0,ct.vertices.length,rt.footprintTileId.canonical,s.canonical,tt),uE(rt.footprint,tt,ct.indices,0,ct.indices.length,0,-ot)&&(ct.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const rt of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(rt.groundEffectVertexOffset,rt.groundEffectVertexLength,rt.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(s,a){let _=Number.NEGATIVE_INFINITY,j=!0;const tt=4*(s+Rn)*Rn+(a+Rn);if(this.footprintLookup.hasOwnProperty(tt)){const ot=this.footprintLookup[tt];return ot?{height:ot.height,hidden:ot.hiddenFlags!==0}:void 0}const rt=new yn(s,a);for(const ot of this.footprints)s>ot.max.x||ot.min.x>s||a>ot.max.y||ot.min.y>a||ot.height<=_||hE(rt,ot)&&(_=ot.height,this.footprintLookup[tt]=ot,j=ot.hiddenFlags!==0);if(_!==Number.NEGATIVE_INFINITY)return{height:_,hidden:j};this.footprintLookup[tt]=void 0}}function CR(d,s,a,_,j,tt){const rt=Math.pow(2,_.z-j.z);for(let ot=0;ot<a;ot++){let ct=d[ot+s].x,ht=d[ot+s].y;ct=(ct+j.x*Rn)*rt-_.x*Rn,ht=(ht+j.y*Rn)*rt-_.y*Rn,tt.push(new yn(ct,ht))}}let WS,qS;Fn(HS,"BuildingBucket",{omit:["layers"]}),Fn(IE,"BuildingGeometry"),Fn($S,"BuildingBloomGeometry");const AR=zs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),RR=zs([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:PR}=AR,IR=zs([{name:"a_packed",components:3,type:"Float32"}]),{members:MR}=IR,kR=zs([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:DR}=kR;class ZS{constructor(s,a){this.width=s,this.height=a,this.nextRow=0,this.image=new By({width:s,height:a}),this.positions={},this.uploaded=!1}getDash(s,a){const _=this.getKey(s,a);return this.positions[_]}trim(){const s=this.width,a=this.height=Hn(this.nextRow);this.image.resize({width:s,height:a})}getKey(s,a){return s.join(",")+a}getDashRanges(s,a,_){const j=[];let tt=s.length%2==1?-s[s.length-1]*_:0,rt=s[0]*_,ot=!0;j.push({left:tt,right:rt,isDash:ot,zeroLength:s[0]===0});let ct=s[0];for(let ht=1;ht<s.length;ht++){ot=!ot;const mt=s[ht];tt=ct*_,ct+=mt,rt=ct*_,j.push({left:tt,right:rt,isDash:ot,zeroLength:mt===0})}return j}addRoundDash(s,a,_){const j=a/2;for(let tt=-_;tt<=_;tt++){const rt=this.width*(this.nextRow+_+tt);let ot=0,ct=s[ot];for(let ht=0;ht<this.width;ht++){ht/ct.right>1&&(ct=s[++ot]);const mt=Math.abs(ht-ct.left),gt=Math.abs(ht-ct.right),_t=Math.min(mt,gt);let Rt;const Pt=tt/_*(j+1);if(ct.isDash){const zt=j-Math.abs(Pt);Rt=Math.sqrt(_t*_t+zt*zt)}else Rt=j-Math.sqrt(_t*_t+Pt*Pt);this.image.data[rt+ht]=Math.max(0,Math.min(255,Rt+128))}}}addRegularDash(s,a){for(let ct=s.length-1;ct>=0;--ct){const ht=s[ct],mt=s[ct+1];ht.zeroLength?s.splice(ct,1):mt&&mt.isDash===ht.isDash&&(mt.left=ht.left,s.splice(ct,1))}const _=s[0],j=s[s.length-1];_.isDash===j.isDash&&(_.left=j.left-this.width,j.right=_.right+this.width);const tt=this.width*this.nextRow;let rt=0,ot=s[rt];for(let ct=0;ct<this.width;ct++){ct/ot.right>1&&(ot=s[++rt]);const ht=Math.abs(ct-ot.left),mt=Math.abs(ct-ot.right),gt=Math.min(ht,mt);this.image.data[tt+ct]=Math.max(0,Math.min(255,(ot.isDash?gt:-gt)+a+128))}}addDash(s,a){const _=this.getKey(s,a);if(this.positions[_])return this.positions[_];const j=a==="round",tt=j?7:0,rt=2*tt+1;if(this.nextRow+rt>this.height)return Es("LineAtlas out of space"),null;s.length===0&&s.push(1);let ot=0;for(let mt=0;mt<s.length;mt++)s[mt]<0&&(Es("Negative value is found in line dasharray, replacing values with 0"),s[mt]=0),ot+=s[mt];if(ot!==0){const mt=this.width/ot,gt=this.getDashRanges(s,this.width,mt);j?this.addRoundDash(gt,mt,tt):this.addRegularDash(gt,a==="square"?.5*mt:0)}const ct=this.nextRow+tt;this.nextRow+=rt;const ht={tl:[ct,tt],br:[ot,0]};return this.positions[_]=ht,ht}}Fn(ZS,"LineAtlas");const LR=mn.types,jR=Math.cos(Math.PI/180*37.5),FR=Math.cos(Math.PI/180*5);class ME{constructor(s){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=s.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=s.overscaling,this.pixelRatio=s.pixelRatio,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.projection=s.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new xx,this.layoutVertexArray2=new vu,this.patternVertexArray=new vu,this.indexArray=new Dl,this.programConfigurations=new lp(s.layers,{zoom:s.zoom,lut:s.lut}),this.segments=new Bo,this.maxLineLength=0,this.zOffsetVertexArray=new vu,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=s.tessellationStep?s.tessellationStep:Rn/64,this.worldview=s.worldview}updateFootprints(s,a){}populate(s,a,_,j){this.hasPattern=nE("line",this.layers,this.pixelRatio,a);const tt=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Nr(_);const rt=this.layers[0].layout.get("line-elevation-reference");if(rt==="hd-road-markup")this.elevationType="road";else{const _t=this.layers[0].layout.get("line-z-offset"),Rt=_t.isConstant()&&!_t.constantOr(0);this.elevationType=rt!=="sea"&&rt!=="ground"&&Rt?"none":"offset",this.elevationType==="offset"&&rt==="none"&&Es(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const ot=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&ot!==void 0;const ct=[];for(const{feature:_t,id:Rt,index:Pt,sourceLayerIndex:zt}of s){const Vt=this.layers[0]._featureFilter.needGeometry,Gt=xn(_t,Vt);if(!this.layers[0]._featureFilter.filter(new yo(this.zoom,{worldview:this.worldview}),Gt,_))continue;const _i=tt?tt.evaluate(Gt,{},_):void 0,er={id:Rt,properties:_t.properties,type:_t.type,sourceLayerIndex:zt,index:Pt,geometry:Vt?Gt.geometry:Ln(_t,_,j),patterns:{},sortKey:_i};ct.push(er)}tt&&ct.sort((_t,Rt)=>_t.sortKey-Rt.sortKey);const{lineAtlas:ht,featureIndex:mt}=a,gt=this.addConstantDashes(ht);for(const _t of ct){const{geometry:Rt,index:Pt,sourceLayerIndex:zt}=_t;if(gt&&this.addFeatureDashes(_t,ht),this.hasPattern){const Vt=sE("line",this.layers,_t,this.zoom,this.pixelRatio,a);this.patternFeatures.push(Vt)}else this.addFeature(_t,Rt,Pt,_,ht.positions,a.availableImages,a.brightness,a.elevationFeatures);mt.insert(s[Pt].feature,Rt,Pt,zt,this.index)}}addConstantDashes(s){let a=!1;for(const _ of this.layers){const j=_.paint.get("line-dasharray").value,tt=_.layout.get("line-cap").value;if(j.kind!=="constant"||tt.kind!=="constant")a=!0;else{const rt=tt.value,ot=j.value;if(!ot)continue;s.addDash(ot,rt)}}return a}addFeatureDashes(s,a){const _=this.zoom;for(const j of this.layers){const tt=j.paint.get("line-dasharray").value,rt=j.layout.get("line-cap").value;if(tt.kind==="constant"&&rt.kind==="constant")continue;let ot,ct;if(tt.kind==="constant"){if(ot=tt.value,!ot)continue}else ot=tt.evaluate({zoom:_},s);ct=rt.kind==="constant"?rt.value:rt.evaluate({zoom:_},s),a.addDash(ot,ct),s.patterns[j.id]=[a.getKey(ot,ct)]}}update(s,a,_,j,tt,rt,ot,ct){this.programConfigurations.updatePaintArrays(s,a,tt,_,j,rt,ot,ct)}addFeatures(s,a,_,j,tt,rt){for(const ot of this.patternFeatures)this.addFeature(ot,ot.geometry,ot.index,a,_,j,rt)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,MR)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=s.createVertexBuffer(this.patternVertexArray,DR)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,RR.members,!0)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,PR),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s,a){let _,j;if(a&&a>0?(_=`mapbox_clip_start_${a}`,j=`mapbox_clip_end_${a}`):(_="mapbox_clip_start",j="mapbox_clip_end"),s.properties&&s.properties.hasOwnProperty(_)&&s.properties.hasOwnProperty(j))return{start:+s.properties[_],end:+s.properties[j]}}addFeature(s,a,_,j,tt,rt,ot,ct){const ht=this.layers[0].layout,mt=ht.get("line-join").evaluate(s,{}),gt=ht.get("line-cap").evaluate(s,{}),_t=ht.get("line-miter-limit"),Rt=ht.get("line-round-limit");this.lineClips=this.lineFeatureClips(s),this.lineFeature=s;const Pt=!(!s.properties||!s.properties.hasOwnProperty("mapbox_line_metrics"))&&s.properties.mapbox_line_metrics;this.zOffsetValue=ht.get("line-z-offset").value;const zt=this.layers[0].paint.get("line-width").value;if(zt.kind!=="constant"&&zt.isLineProgressConstant===!1&&(this.variableWidthValue=zt),this.elevationType==="road"){const Vt=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(s,a,j,ct,mt,gt,_t,Rt)){const[Gt,_i]=this.clipRuntimeLinesToTile(a,1);for(let er=0;er<Gt.length;er++){const rr=Gt[er],_r=_i[er],xr={progress:{min:_r.progress.min,max:_r.progress.max},nextDir:this.computeSegNextDir(_r,rr),prevDir:this.computeSegPrevDir(_r,rr)};this.addLine(rr,s,j,mt,gt,_t,Rt,xr,Pt&&_r.parentIndex>0?_r.parentIndex:null)}this.fillNonElevatedRoadSegment(Vt)}}else for(let Vt=0;Vt<a.length;Vt++)this.addLine(a[Vt],s,j,mt,gt,_t,Rt,void 0,Pt&&Vt>0?Vt:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,_,tt,rt,j,ot,void 0,this.worldview)}computeSegNextDir(s,a){return s.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(s,a){return a[1].sub(s.prevPoint).unit()}clipLinesToTile(s,a){return D1(s,-a,-a,Rn+a,Rn+a)}clipRuntimeLinesToTile(s,a){const _=[];return[D1(s,-a,-a,Rn+a,Rn+a,_),_]}addElevatedRoadFeature(s,a,_,j,tt,rt,ot,ct){const ht=[],mt=Fo.getElevationFeature(s,j);if(mt){const gt=this.clipLinesToTile(a,1),_t=this.prepareElevatedLines(gt,mt,_);for(const Rt of _t)ht.push({geometry:Rt,elevation:mt,elevationTileID:_,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(ht.length===0)return!1;for(const gt of ht){const _t=this.layoutVertexArray.length;this.addLine(gt.geometry,s,_,tt,rt,ot,ct);const Rt=new yl(_,gt.elevationTileID);if(gt.elevation)for(let Pt=_t;Pt<this.layoutVertexArray.length;Pt++){const zt=new yn(this.layoutVertexArray.int16[6*Pt]>>1,this.layoutVertexArray.int16[6*Pt+1]>>1),Vt=Rt.pointElevation(zt,gt.elevation,.05);this.updateHeightRange(Vt),this.zOffsetVertexArray.emplaceBack(Vt,0,0)}else this.fillNonElevatedRoadSegment(_t)}return!0}prepareElevatedLines(s,a,_){if(a.constantHeight!=null)return s;const j=[],tt=1/Nr(_);for(const rt of s)XA(rt,new so(a,tt),0,j);return j}fillNonElevatedRoadSegment(s){for(let a=s;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(s){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,s),this.heightRange.max=Math.max(this.heightRange.max,s)):this.heightRange={min:s,max:s}}addLine(s,a,_,j,tt,rt,ot,ct,ht){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=ht?this.lineFeatureClips(a,ht):this.lineClips;const mt=j==="none";this.patternJoinNone=this.hasPattern&&mt,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const gt=ct&&ct.progress.min>0,_t=ct&&ct.progress.max<1;if(this.lineClips){let Pr={min:this.lineClips.start,max:this.lineClips.end},sn=1;if(ct){const gn=this.lineClips.end-this.lineClips.start;Pr=function(an,hn,vn){return{min:Zu(an.min,hn,vn),max:Zu(an.max,hn,vn)}}(ct.progress,{min:0,max:1},Pr),gn>0&&(sn=(Pr.max-Pr.min)/gn)}const Fr=+a.properties.mapbox_clip_feature_len,on=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(Fr)||Number.isNaN(on)){for(let an=0;an<s.length-1;an++)this.totalDistance+=s[an].dist(s[an+1]);const gn=this.totalDistance/(Pr.max-Pr.min);this.totalFeatureLength=Number.isFinite(gn)?gn:0,this.lineClips.start=Pr.min,this.lineClips.end=Pr.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Fr,this.distance=on*sn,this.lineClips.start=Pr.min,this.lineClips.end=Pr.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const Rt=LR[a.type]==="Polygon";let Pt=s.length;for(;Pt>=2&&s[Pt-1].equals(s[Pt-2]);)Pt--;let zt=0;for(;zt<Pt-1&&s[zt].equals(s[zt+1]);)zt++;if(Pt<(Rt?3:2))return;j==="bevel"&&(rt=1.05);const Vt=this.segments.prepareSegment(10*Pt,this.layoutVertexArray,this.indexArray);let Gt,_i,er,rr,_r,xr,Er,Ar;ct&&ct.prevDir&&(xr=ct.prevDir.perp()),ct&&ct.nextDir&&(Er=ct.nextDir.perp()),this.e1=this.e2=-1,Rt&&(Gt=s[Pt-2],_r=s[zt].sub(Gt)._unit()._perp());for(let Pr=zt;Pr<Pt;Pr++){if(er=Pr===Pt-1?Rt?s[zt+1]:void 0:s[Pr+1],er&&s[Pr].equals(er))continue;_r&&(rr=_r),Gt&&(_i=Gt),Gt=s[Pr],Ar=this.evaluateLineProgressFeatures(_i?_i.dist(Gt):0),_r=er?er.sub(Gt)._unit()._perp():rr,rr=rr||_r;const sn=_i&&er;let Fr=sn?j:Rt||mt?"butt":tt;const on=rr.x*_r.x+rr.y*_r.y;if(mt){const Gr=function(wn){if(wn.patternJoinNone){const _n=wn.segmentPoints.length/2,Yn=wn.lineSoFar-wn.segmentStart;for(let jn=0;jn<_n;++jn){const Bn=wn.segmentPoints[2*jn+1],An=Math.round(wn.segmentPoints[2*jn])+.5+.25*Bn;wn.patternVertexArray.emplaceBack(An,Yn,wn.segmentStart),wn.patternVertexArray.emplaceBack(An,Yn,wn.segmentStart)}wn.segmentPoints.length=0}wn.e1=wn.e2=-1};if(sn&&on<FR){this.updateDistance(_i,Gt),this.addCurrentVertex(Gt,rr,1,1,Vt,Ar),Gr(this),this.addCurrentVertex(Gt,_r,-1,-1,Vt,Ar);continue}if(_i){if(!er){this.updateDistance(_i,Gt),this.addCurrentVertex(Gt,rr,1,1,Vt,Ar),Gr(this);continue}Fr="miter"}}let gn=rr.add(_r);gn.x===0&&gn.y===0||gn._unit();const an=gn.x*_r.x+gn.y*_r.y,hn=an!==0?1/an:1/0,vn=2*Math.sqrt(2-2*an),tn=an<jR&&_i&&er,dn=rr.x*_r.y-rr.y*_r.x>0,qr=this.overscaling<=16?15*Rn/(512*this.overscaling):0;if(sn&&Fr==="round"){if(hn<ot)Fr="miter";else if(hn<=2){const Gr=kE(Gt,-10,Rn+10);Fr=this.elevationType==="offset"&&(Gr||this.hasCrossSlope)?"miter":"fakeround"}}if(Fr==="miter"&&hn>rt&&(Fr="bevel"),Fr==="bevel"&&(hn>2&&(Fr="flipbevel"),hn<rt&&(Fr="miter")),_i&&!(Fr==="miter"&&tn)&&this.updateDistance(_i,Gt),Fr==="miter")if(tn){const Gr=Gt.dist(_i);if(Gr>2*qr){const _n=Gt.sub(Gt.sub(_i)._mult(qr/Gr)._round());this.updateDistance(_i,_n),this.addCurrentVertex(_n,rr,0,0,Vt,Ar),_i=_n}this.updateDistance(_i,Gt),gn._mult(hn),this.addCurrentVertex(Gt,gn,0,0,Vt,Ar);const wn=Gt.dist(er);if(wn>2*qr){const _n=Gt.add(er.sub(Gt)._mult(qr/wn)._round());this.updateDistance(Gt,_n),this.addCurrentVertex(_n,_r,0,0,Vt,Ar),Gt=_n}}else gn._mult(hn),this.addCurrentVertex(Gt,gn,0,0,Vt,Ar);else if(Fr==="flipbevel"){if(hn>100)gn=_r.mult(-1);else{const Gr=hn*rr.add(_r).mag()/rr.sub(_r).mag();gn._perp()._mult(Gr*(dn?-1:1))}this.addCurrentVertex(Gt,gn,0,0,Vt,Ar),this.addCurrentVertex(Gt,gn.mult(-1),0,0,Vt,Ar)}else if(Fr==="bevel"||Fr==="fakeround"){Ar!=null&&_i&&this.addCurrentVertex(Gt,Er||rr,-1,-1,Vt,Ar);const Gr=Gt.dist(_i)<=2*qr&&Fr!=="bevel",wn=gn.mult(dn?1:-1);wn._mult(hn);const _n=_r.mult(dn?-1:1),Yn=rr.mult(dn?-1:1),jn=this.evaluateLineProgressFeatures(this.distance);if(Ar==null&&(this.addHalfVertex(Gt,wn.x,wn.y,!1,!dn,0,Vt,jn),Gr||this.addHalfVertex(Gt,wn.x+2*Yn.x,wn.y+2*Yn.y,!1,dn,0,Vt,jn)),Fr==="fakeround"){const Bn=Math.round(180*vn/Math.PI/20);this.addHalfVertex(Gt,Yn.x,Yn.y,!1,dn,0,Vt,jn);for(let An=0;An<Bn;An++){let Kn=An/Bn;if(Kn!==.5){const kn=Kn-.5;Kn+=Kn*kn*(Kn-1)*((1.0904+on*(on*(3.55645-1.43519*on)-3.2452))*kn*kn+(.848013+on*(.215638*on-1.06021)))}const ps=_n.sub(Yn)._mult(Kn)._add(Yn)._unit();this.addHalfVertex(Gt,ps.x,ps.y,!1,dn,0,Vt,jn)}this.addHalfVertex(Gt,_n.x,_n.y,!1,dn,0,Vt,jn)}Gr||Ar!=null||this.addHalfVertex(Gt,wn.x+2*_n.x,wn.y+2*_n.y,!1,dn,0,Vt,jn),Ar!=null&&er&&this.addCurrentVertex(Gt,xr||_r,1,1,Vt,Ar)}else if(Fr==="butt")this.addCurrentVertex(Gt,gn,0,0,Vt,Ar);else if(Fr==="square"){if(!_i){const Gr=gt?0:-1;this.addCurrentVertex(Gt,gn,Gr,Gr,Vt,Ar)}if(this.addCurrentVertex(Gt,gn,0,0,Vt,Ar),_i){const Gr=_t?0:1;this.addCurrentVertex(Gt,gn,Gr,Gr,Vt,Ar)}}else if(Fr==="round"){if(_i){const Gr=!sn&&Er?Er:rr;this.addCurrentVertex(Gt,Gr,0,0,Vt,Ar),!sn&&_t||this.addCurrentVertex(Gt,Gr,1,1,Vt,Ar,!0)}if(er){const Gr=!sn&&xr?xr:_r;!sn&&gt||this.addCurrentVertex(Gt,Gr,-1,-1,Vt,Ar,!0),this.addCurrentVertex(Gt,Gr,0,0,Vt,Ar)}}}}addVerticesTo(s,a,_,j,tt,rt,ot,ct,ht,mt){const gt=(a.w-s.w)/this.tessellationStep|0;let _t=0;const Rt=this.scaledDistance;if(gt>1){this.lineSoFar=s.w;const zt=(a.x-s.x)/gt,Vt=(a.y-s.y)/gt,Gt=(a.z-s.z)/gt,_i=(a.w-s.w)/gt;for(let er=1;er<gt;++er){s.x+=zt,s.y+=Vt,s.z+=Gt,this.lineSoFar+=_i,_t+=_i;const rr=this.evaluateLineProgressFeatures(this.prevDistance+_t);this.scaledDistance=(this.prevDistance+_t)/this.totalDistance,this.addHalfVertex(s,_,j,mt,!1,ot,ht,rr),this.addHalfVertex(s,tt,rt,mt,!0,-ct,ht,rr)}}this.lineSoFar=a.w,this.scaledDistance=Rt;const Pt=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,_,j,mt,!1,ot,ht,Pt),this.addHalfVertex(a,tt,rt,mt,!0,-ct,ht,Pt)}evaluateLineProgressFeatures(s){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+s)/this.totalFeatureLength):Es(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(s,a,_,j,tt,rt,ot=!1){const ct=a.x+a.y*_,ht=a.y-a.x*_,mt=a.y*j-a.x,gt=-a.y-a.x*j;if(rt!=null){const _t=this.elevationType==="offset",Rt=-10,Pt=Rn+10,zt=rt.zOffset,Vt=new gS(s.x,s.y,zt,this.lineSoFar),Gt=!!_t&&kE(s,Rt,Pt),_i=this.lineSoFar,er=this.distance;if(this.currentVertex)if(Gt){const rr=this.currentVertexIsOutside,_r=this.currentVertex,xr=new gS(s.x,s.y,zt,this.lineSoFar);if(_S(_r,xr,Rt,Pt),!kE(xr,Rt,Pt)){if(rr){this.e1=this.e2=-1,this.distance-=_r.dist(Vt),this.lineSoFar=_r.w;const Er=this.evaluateLineProgressFeatures(_r.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(_r,ct,ht,ot,!1,_,tt,Er),this.addHalfVertex(_r,mt,gt,ot,!0,-j,tt,Er),this.prevDistance=this.distance}this.distance=this.prevDistance+_r.dist(xr),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(_r,xr,ct,ht,mt,gt,_,j,tt,ot),this.distance=er,this.scaledDistance=this.distance/this.totalDistance}}else{const rr=this.currentVertex;if(this.currentVertexIsOutside){_S(rr,Vt,Rt,Pt),this.e1=this.e2=-1,this.distance-=rr.dist(Vt),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=rr.w;const _r=this.evaluateLineProgressFeatures(rr.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(rr,ct,ht,ot,!1,_,tt,_r),this.addHalfVertex(rr,mt,gt,ot,!0,-j,tt,_r),this.prevDistance=this.distance,this.distance=er,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(rr,Vt,ct,ht,mt,gt,_,j,tt,ot)}else Gt||(this.addHalfVertex(s,ct,ht,ot,!1,_,tt,rt),this.addHalfVertex(s,mt,gt,ot,!0,-j,tt,rt));this.currentVertex=Vt,this.currentVertexIsOutside=Gt,this.lineSoFar=_i}else this.addHalfVertex(s,ct,ht,ot,!1,_,tt,rt),this.addHalfVertex(s,mt,gt,ot,!0,-j,tt,rt)}addHalfVertex({x:s,y:a},_,j,tt,rt,ot,ct,ht){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),rt||this.segmentPoints.push(this.lineSoFar-this.segmentStart,ot)),this.layoutVertexArray.emplaceBack((s<<1)+(tt?1:0),(a<<1)+(rt?1:0),Math.round(63*_)+128,Math.round(63*j)+128,1+(ot===0?0:ot<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const gt=ns(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,gt)}const mt=ct.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,mt),ct.primitiveLength++),rt?this.e2=mt:this.e1=mt,ht!=null&&this.zOffsetVertexArray.emplaceBack(ht.zOffset,ht.variableWidth,ht.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(s,a){this.prevDistance=this.distance,this.distance+=s.dist(a),this.updateScaledDistance()}}function kE(d,s,a){return d.x<s||d.x>a||d.y<s||d.y>a}let XS,KS;function YS(d,s,a){return s*(Rn/(d.tileSize*Math.pow(2,a-d.tileID.overscaledZ)))}Fn(ME,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const QS=(d,s,a)=>(1-a)*d+a*s;function JS(d,s){return 1/YS(d,1,s.tileZoom)}function e2(d,s,a,_){return d.translatePosMatrix(_||s.tileID.projMatrix,s,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const t2=d=>{const s=[];i2(d)&&s.push("RENDER_LINE_DASH"),d.paint.get("line-gradient")&&s.push("RENDER_LINE_GRADIENT");const a=d.paint.get("line-trim-offset");a[0]===0&&a[1]===0||s.push("RENDER_LINE_TRIM_OFFSET"),d.paint.get("line-border-width").constantOr(1)!==0&&s.push("RENDER_LINE_BORDER");const _=d.layout.get("line-join").constantOr("miter")==="none",j=!!d.paint.get("line-pattern").constantOr(1);return _&&j&&s.push("LINE_JOIN_NONE"),s};function i2(d){const s=d.paint.get("line-dasharray").value;return s.kind!=="constant"||s.value}let DE;const r2=()=>DE||(DE={layout:XS||(XS=new $o({"line-cap":new Dn(jr.layout_line["line-cap"]),"line-join":new Dn(jr.layout_line["line-join"]),"line-miter-limit":new En(jr.layout_line["line-miter-limit"]),"line-round-limit":new En(jr.layout_line["line-round-limit"]),"line-sort-key":new Dn(jr.layout_line["line-sort-key"]),"line-z-offset":new Dn(jr.layout_line["line-z-offset"]),"line-elevation-reference":new En(jr.layout_line["line-elevation-reference"]),"line-cross-slope":new En(jr.layout_line["line-cross-slope"]),visibility:new En(jr.layout_line.visibility),"line-width-unit":new En(jr.layout_line["line-width-unit"])})),paint:KS||(KS=new $o({"line-opacity":new Dn(jr.paint_line["line-opacity"]),"line-color":new Dn(jr.paint_line["line-color"]),"line-translate":new En(jr.paint_line["line-translate"]),"line-translate-anchor":new En(jr.paint_line["line-translate-anchor"]),"line-width":new Dn(jr.paint_line["line-width"]),"line-gap-width":new Dn(jr.paint_line["line-gap-width"]),"line-offset":new Dn(jr.paint_line["line-offset"]),"line-blur":new Dn(jr.paint_line["line-blur"]),"line-dasharray":new Dn(jr.paint_line["line-dasharray"]),"line-pattern":new Dn(jr.paint_line["line-pattern"]),"line-pattern-cross-fade":new En(jr.paint_line["line-pattern-cross-fade"]),"line-gradient":new Ry(jr.paint_line["line-gradient"]),"line-trim-offset":new En(jr.paint_line["line-trim-offset"]),"line-trim-fade-range":new En(jr.paint_line["line-trim-fade-range"]),"line-trim-color":new En(jr.paint_line["line-trim-color"]),"line-emissive-strength":new En(jr.paint_line["line-emissive-strength"]),"line-border-width":new Dn(jr.paint_line["line-border-width"]),"line-border-color":new Dn(jr.paint_line["line-border-color"]),"line-occlusion-opacity":new En(jr.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},DE);class OR extends Dn{possiblyEvaluate(s,a){return a=new yo(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(s,a)}evaluate(s,a,_,j){return a=Object.assign({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(s,a,_,j)}}let l0;function n2(d,s){return s>0?s+2*d:d}const zR=zs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),NR=zs([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),BR=zs([{name:"a_projected_pos",components:4,type:"Float32"}],4);zs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const VR=zs([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),UR=zs([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),GR=zs([{name:"a_texb",components:2,type:"Uint16"}]),$R=zs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),HR=zs([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);zs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const s2=zs([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),WR=zs([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);zs([{name:"triangle",components:3,type:"Uint16"}]),zs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),zs([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),zs([{type:"Float32",name:"offsetX"}]),zs([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Zl=24;function qR(d,s,a){return d.sections.forEach(_=>{_.text=function(j,tt,rt){const ot=tt.layout.get("text-transform").evaluate(rt,{});return ot==="uppercase"?j=j.toLocaleUpperCase():ot==="lowercase"&&(j=j.toLocaleLowerCase()),vp.applyArabicShaping&&(j=vp.applyArabicShaping(j)),j}(_.text,s,a)}),d}const c0={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function ZR(d){return d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""}function XR(d){return d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""}const LE=4294967296,o2=1/LE,a2=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let V1=class{constructor(d=new Uint8Array(16)){this.buf=ArrayBuffer.isView(d)?d:new Uint8Array(d),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(d,s,a=this.length){for(;this.pos<a;){const _=this.readVarint(),j=_>>3,tt=this.pos;this.type=7&_,d(j,s,this),this.pos===tt&&this.skip(_)}return s}readMessage(d,s){return this.readFields(d,s,this.readVarint()+this.pos)}readFixed32(){const d=this.dataView.getUint32(this.pos,!0);return this.pos+=4,d}readSFixed32(){const d=this.dataView.getInt32(this.pos,!0);return this.pos+=4,d}readFixed64(){const d=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*LE;return this.pos+=8,d}readSFixed64(){const d=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*LE;return this.pos+=8,d}readFloat(){const d=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,d}readDouble(){const d=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,d}readVarint(d){const s=this.buf;let a,_;return _=s[this.pos++],a=127&_,_<128?a:(_=s[this.pos++],a|=(127&_)<<7,_<128?a:(_=s[this.pos++],a|=(127&_)<<14,_<128?a:(_=s[this.pos++],a|=(127&_)<<21,_<128?a:(_=s[this.pos],a|=(15&_)<<28,function(j,tt,rt){const ot=rt.buf;let ct,ht;if(ht=ot[rt.pos++],ct=(112&ht)>>4,ht<128||(ht=ot[rt.pos++],ct|=(127&ht)<<3,ht<128)||(ht=ot[rt.pos++],ct|=(127&ht)<<10,ht<128)||(ht=ot[rt.pos++],ct|=(127&ht)<<17,ht<128)||(ht=ot[rt.pos++],ct|=(127&ht)<<24,ht<128)||(ht=ot[rt.pos++],ct|=(1&ht)<<31,ht<128))return zx(j,ct,tt);throw new Error("Expected varint not more than 10 bytes")}(a,d,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const d=this.readVarint();return d%2==1?(d+1)/-2:d/2}readBoolean(){return!!this.readVarint()}readString(){const d=this.readVarint()+this.pos,s=this.pos;return this.pos=d,d-s>=12&&a2?a2.decode(this.buf.subarray(s,d)):function(a,_,j){let tt="",rt=_;for(;rt<j;){const ot=a[rt];let ct,ht,mt,gt=null,_t=ot>239?4:ot>223?3:ot>191?2:1;if(rt+_t>j)break;_t===1?ot<128&&(gt=ot):_t===2?(ct=a[rt+1],(192&ct)==128&&(gt=(31&ot)<<6|63&ct,gt<=127&&(gt=null))):_t===3?(ct=a[rt+1],ht=a[rt+2],(192&ct)==128&&(192&ht)==128&&(gt=(15&ot)<<12|(63&ct)<<6|63&ht,(gt<=2047||gt>=55296&&gt<=57343)&&(gt=null))):_t===4&&(ct=a[rt+1],ht=a[rt+2],mt=a[rt+3],(192&ct)==128&&(192&ht)==128&&(192&mt)==128&&(gt=(15&ot)<<18|(63&ct)<<12|(63&ht)<<6|63&mt,(gt<=65535||gt>=1114112)&&(gt=null))),gt===null?(gt=65533,_t=1):gt>65535&&(gt-=65536,tt+=String.fromCharCode(gt>>>10&1023|55296),gt=56320|1023&gt),tt+=String.fromCharCode(gt),rt+=_t}return tt}(this.buf,s,d)}readBytes(){const d=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,d);return this.pos=d,s}readPackedVarint(d=[],s){const a=this.readPackedEnd();for(;this.pos<a;)d.push(this.readVarint(s));return d}readPackedSVarint(d=[]){const s=this.readPackedEnd();for(;this.pos<s;)d.push(this.readSVarint());return d}readPackedBoolean(d=[]){const s=this.readPackedEnd();for(;this.pos<s;)d.push(this.readBoolean());return d}readPackedFloat(d=[]){const s=this.readPackedEnd();for(;this.pos<s;)d.push(this.readFloat());return d}readPackedDouble(d=[]){const s=this.readPackedEnd();for(;this.pos<s;)d.push(this.readDouble());return d}readPackedFixed32(d=[]){const s=this.readPackedEnd();for(;this.pos<s;)d.push(this.readFixed32());return d}readPackedSFixed32(d=[]){const s=this.readPackedEnd();for(;this.pos<s;)d.push(this.readSFixed32());return d}readPackedFixed64(d=[]){const s=this.readPackedEnd();for(;this.pos<s;)d.push(this.readFixed64());return d}readPackedSFixed64(d=[]){const s=this.readPackedEnd();for(;this.pos<s;)d.push(this.readSFixed64());return d}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(d){const s=7&d;if(s===0)for(;this.buf[this.pos++]>127;);else if(s===2)this.pos=this.readVarint()+this.pos;else if(s===5)this.pos+=4;else{if(s!==1)throw new Error(`Unimplemented type: ${s}`);this.pos+=8}}writeTag(d,s){this.writeVarint(d<<3|s)}realloc(d){let s=this.length||16;for(;s<this.pos+d;)s*=2;if(s!==this.length){const a=new Uint8Array(s);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=s}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(d){this.realloc(4),this.dataView.setInt32(this.pos,d,!0),this.pos+=4}writeSFixed32(d){this.realloc(4),this.dataView.setInt32(this.pos,d,!0),this.pos+=4}writeFixed64(d){this.realloc(8),this.dataView.setInt32(this.pos,-1&d,!0),this.dataView.setInt32(this.pos+4,Math.floor(d*o2),!0),this.pos+=8}writeSFixed64(d){this.realloc(8),this.dataView.setInt32(this.pos,-1&d,!0),this.dataView.setInt32(this.pos+4,Math.floor(d*o2),!0),this.pos+=8}writeVarint(d){(d=+d||0)>268435455||d<0?function(s,a){let _,j;if(s>=0?(_=s%4294967296|0,j=s/4294967296|0):(_=~(-s%4294967296),j=~(-s/4294967296),4294967295^_?_=_+1|0:(_=0,j=j+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(tt,rt,ot){ot.buf[ot.pos++]=127&tt|128,tt>>>=7,ot.buf[ot.pos++]=127&tt|128,tt>>>=7,ot.buf[ot.pos++]=127&tt|128,tt>>>=7,ot.buf[ot.pos++]=127&tt|128,ot.buf[ot.pos]=127&(tt>>>=7)}(_,0,a),function(tt,rt){const ot=(7&tt)<<4;rt.buf[rt.pos++]|=ot|((tt>>>=3)?128:0),tt&&(rt.buf[rt.pos++]=127&tt|((tt>>>=7)?128:0),tt&&(rt.buf[rt.pos++]=127&tt|((tt>>>=7)?128:0),tt&&(rt.buf[rt.pos++]=127&tt|((tt>>>=7)?128:0),tt&&(rt.buf[rt.pos++]=127&tt|((tt>>>=7)?128:0),tt&&(rt.buf[rt.pos++]=127&tt)))))}(j,a)}(d,this):(this.realloc(4),this.buf[this.pos++]=127&d|(d>127?128:0),d<=127||(this.buf[this.pos++]=127&(d>>>=7)|(d>127?128:0),d<=127||(this.buf[this.pos++]=127&(d>>>=7)|(d>127?128:0),d<=127||(this.buf[this.pos++]=d>>>7&127))))}writeSVarint(d){this.writeVarint(d<0?2*-d-1:2*d)}writeBoolean(d){this.writeVarint(+d)}writeString(d){d=String(d),this.realloc(4*d.length),this.pos++;const s=this.pos;this.pos=function(_,j,tt){for(let rt,ot,ct=0;ct<j.length;ct++){if(rt=j.charCodeAt(ct),rt>55295&&rt<57344){if(!ot){rt>56319||ct+1===j.length?(_[tt++]=239,_[tt++]=191,_[tt++]=189):ot=rt;continue}if(rt<56320){_[tt++]=239,_[tt++]=191,_[tt++]=189,ot=rt;continue}rt=ot-55296<<10|rt-56320|65536,ot=null}else ot&&(_[tt++]=239,_[tt++]=191,_[tt++]=189,ot=null);rt<128?_[tt++]=rt:(rt<2048?_[tt++]=rt>>6|192:(rt<65536?_[tt++]=rt>>12|224:(_[tt++]=rt>>18|240,_[tt++]=rt>>12&63|128),_[tt++]=rt>>6&63|128),_[tt++]=63&rt|128)}return tt}(this.buf,d,this.pos);const a=this.pos-s;a>=128&&l2(s,a,this),this.pos=s-1,this.writeVarint(a),this.pos+=a}writeFloat(d){this.realloc(4),this.dataView.setFloat32(this.pos,d,!0),this.pos+=4}writeDouble(d){this.realloc(8),this.dataView.setFloat64(this.pos,d,!0),this.pos+=8}writeBytes(d){const s=d.length;this.writeVarint(s),this.realloc(s);for(let a=0;a<s;a++)this.buf[this.pos++]=d[a]}writeRawMessage(d,s){this.pos++;const a=this.pos;d(s,this);const _=this.pos-a;_>=128&&l2(a,_,this),this.pos=a-1,this.writeVarint(_),this.pos+=_}writeMessage(d,s,a){this.writeTag(d,2),this.writeRawMessage(s,a)}writePackedVarint(d,s){s.length&&this.writeMessage(d,KR,s)}writePackedSVarint(d,s){s.length&&this.writeMessage(d,YR,s)}writePackedBoolean(d,s){s.length&&this.writeMessage(d,eP,s)}writePackedFloat(d,s){s.length&&this.writeMessage(d,QR,s)}writePackedDouble(d,s){s.length&&this.writeMessage(d,JR,s)}writePackedFixed32(d,s){s.length&&this.writeMessage(d,tP,s)}writePackedSFixed32(d,s){s.length&&this.writeMessage(d,iP,s)}writePackedFixed64(d,s){s.length&&this.writeMessage(d,rP,s)}writePackedSFixed64(d,s){s.length&&this.writeMessage(d,nP,s)}writeBytesField(d,s){this.writeTag(d,2),this.writeBytes(s)}writeFixed32Field(d,s){this.writeTag(d,5),this.writeFixed32(s)}writeSFixed32Field(d,s){this.writeTag(d,5),this.writeSFixed32(s)}writeFixed64Field(d,s){this.writeTag(d,1),this.writeFixed64(s)}writeSFixed64Field(d,s){this.writeTag(d,1),this.writeSFixed64(s)}writeVarintField(d,s){this.writeTag(d,0),this.writeVarint(s)}writeSVarintField(d,s){this.writeTag(d,0),this.writeSVarint(s)}writeStringField(d,s){this.writeTag(d,2),this.writeString(s)}writeFloatField(d,s){this.writeTag(d,5),this.writeFloat(s)}writeDoubleField(d,s){this.writeTag(d,1),this.writeDouble(s)}writeBooleanField(d,s){this.writeVarintField(d,+s)}};function zx(d,s,a){return a?4294967296*s+(d>>>0):4294967296*(s>>>0)+(d>>>0)}function l2(d,s,a){const _=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));a.realloc(_);for(let j=a.pos-1;j>=d;j--)a.buf[j+_]=a.buf[j]}function KR(d,s){for(let a=0;a<d.length;a++)s.writeVarint(d[a])}function YR(d,s){for(let a=0;a<d.length;a++)s.writeSVarint(d[a])}function QR(d,s){for(let a=0;a<d.length;a++)s.writeFloat(d[a])}function JR(d,s){for(let a=0;a<d.length;a++)s.writeDouble(d[a])}function eP(d,s){for(let a=0;a<d.length;a++)s.writeBoolean(d[a])}function tP(d,s){for(let a=0;a<d.length;a++)s.writeFixed32(d[a])}function iP(d,s){for(let a=0;a<d.length;a++)s.writeSFixed32(d[a])}function rP(d,s){for(let a=0;a<d.length;a++)s.writeFixed64(d[a])}function nP(d,s){for(let a=0;a<d.length;a++)s.writeSFixed64(d[a])}const jE=3;function sP(d,s,a){s.glyphs=[],d===1&&a.readMessage(oP,s)}function oP(d,s,a){if(d===3){const{id:_,bitmap:j,width:tt,height:rt,left:ot,top:ct,advance:ht}=a.readMessage(aP,{});s.glyphs.push({id:_,bitmap:new By({width:tt+2*jE,height:rt+2*jE},j),metrics:{width:tt,height:rt,left:ot,top:ct,advance:ht}})}else d===4?s.ascender=a.readSVarint():d===5&&(s.descender=a.readSVarint())}function aP(d,s,a){d===1?s.id=a.readVarint():d===2?s.bitmap=a.readBytes():d===3?s.width=a.readVarint():d===4?s.height=a.readVarint():d===5?s.left=a.readSVarint():d===6?s.top=a.readSVarint():d===7&&(s.advance=a.readVarint())}const c2=jE,Gu={horizontal:1,vertical:2,horizontalOnly:3};class u0{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(s,a){const _=new u0;return _.scale=s||1,_.fontStack=a,_}static forImage(s){const a=new u0;return a.image=s,a}}class Nx{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,a,_){const j=new Nx;for(let tt=0;tt<s.sections.length;tt++){const rt=s.sections[tt];rt.image?j.addImageSection(rt,_):j.addTextSection(rt,a)}return j}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSections(){return this.sections}getSectionIndex(s){return this.sectionIndex[s]}getCodePoint(s){return this.text.codePointAt(s)}verticalizePunctuation(s){this.text=function(a,_){let j="";for(let tt=0;tt<a.length;tt++){const rt=a.charCodeAt(tt+1)||null,ot=a.charCodeAt(tt-1)||null;j+=!_&&(rt&&hx(rt)&&!c0[a[tt+1]]||ot&&hx(ot)&&!c0[a[tt-1]])||!c0[a[tt]]?a[tt]:c0[a[tt]]}return j}(this.text,s)}trim(){let s=0;for(let _=0;_<this.text.length&&U1[this.text.charCodeAt(_)];_++)s++;let a=this.text.length;for(let _=this.text.length-1;_>=0&&_>=s&&U1[this.text.charCodeAt(_)];_--)a--;this.text=this.text.substring(s,a),this.sectionIndex=this.sectionIndex.slice(s,a)}substring(s,a){const _=new Nx;return _.text=this.text.substring(s,a),_.sectionIndex=this.sectionIndex.slice(s,a),_.sections=this.sections,_}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,a)=>Math.max(s,this.sections[a].scale),0)}addTextSection(s,a){this.text+=s.text,this.sections.push(u0.forText(s.scale,s.fontStack||a));const _=this.sections.length-1;for(let j=0;j<s.text.length;++j)this.sectionIndex.push(_)}addImageSection(s,a){const _=s.image?s.image.getPrimary():null;if(!_)return void Es("Can't add FormattedSection with an empty image.");_.scaleSelf(a);const j=this.getNextImageSectionCharCode();j?(this.text+=String.fromCodePoint(j),this.sections.push(u0.forImage(_)),this.sectionIndex.push(this.sections.length-1)):Es("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function FE(d,s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt=1){const Vt=Nx.fromFeature(d,j,zt);gt===Gu.vertical&&Vt.verticalizePunctuation(_t);let Gt=[];const _i=function(Er,Ar,Pr,sn,Fr,on){if(!Er)return[];const gn=[],an=function(dn,qr,Gr,wn,_n,Yn){let jn=0;for(let Bn=0;Bn<dn.length();Bn++){const An=dn.getSection(Bn);jn+=u2(dn.getCodePoint(Bn),An,wn,_n,qr,Yn)}return jn/Math.max(1,Math.ceil(jn/Gr))}(Er,Ar,Pr,sn,Fr,on),hn=Er.text.indexOf("")>=0;let vn=0;for(let dn=0;dn<Er.length();dn++){const qr=Er.getSection(dn),Gr=Er.getCodePoint(dn);if(U1[Gr]||(vn+=u2(Gr,qr,sn,Fr,Ar,on)),dn<Er.length()-1){const wn=!((tn=Gr)<11904||!(os["Bopomofo Extended"](tn)||os.Bopomofo(tn)||os["CJK Compatibility Forms"](tn)||os["CJK Compatibility Ideographs"](tn)||os["CJK Compatibility"](tn)||os["CJK Radicals Supplement"](tn)||os["CJK Strokes"](tn)||os["CJK Symbols and Punctuation"](tn)||os["CJK Unified Ideographs Extension A"](tn)||os["CJK Unified Ideographs"](tn)||os["Enclosed CJK Letters and Months"](tn)||os["Halfwidth and Fullwidth Forms"](tn)||os.Hiragana(tn)||os["Ideographic Description Characters"](tn)||os["Kangxi Radicals"](tn)||os["Katakana Phonetic Extensions"](tn)||os.Katakana(tn)||os["Vertical Forms"](tn)||os["Yi Radicals"](tn)||os["Yi Syllables"](tn)));(lP[Gr]||wn||qr.image)&&gn.push(d2(dn+1,vn,an,gn,cP(Gr,Er.getCodePoint(dn+1),wn&&hn),!1))}}var tn;return p2(d2(Er.length(),vn,an,gn,0,!0))}(Vt,ht,tt,s,_,Rt),{processBidirectionalText:er,processStyledBidirectionalText:rr}=vp;if(er&&Vt.sections.length===1){const Er=er(Vt.toString(),_i);for(const Ar of Er){const Pr=new Nx;Pr.text=Ar,Pr.sections=Vt.sections;for(let sn=0;sn<Ar.length;sn++)Pr.sectionIndex.push(0);Gt.push(Pr)}}else if(rr){const Er=rr(Vt.text,Vt.sectionIndex,_i);for(const Ar of Er){const Pr=new Nx;Pr.text=Ar[0],Pr.sectionIndex=Ar[1],Pr.sections=Vt.sections,Gt.push(Pr)}}else Gt=function(Er,Ar){const Pr=[],sn=Er.text;let Fr=0;for(const on of Ar)Pr.push(Er.substring(Fr,on)),Fr=on;return Fr<sn.length&&Pr.push(Er.substring(Fr,sn.length)),Pr}(Vt,_i);const _r=[],xr={positionedLines:_r,text:Vt.toString(),top:mt[1],bottom:mt[1],left:mt[0],right:mt[0],writingMode:gt,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Er,Ar,Pr,sn,Fr,on,gn,an,hn,vn,tn,dn){let qr=0,Gr=0,wn=0;const _n=an==="right"?1:an==="left"?0:.5;let Yn=!1;for(const kn of Fr){const $n=kn.getSections();for(const ls of $n){if(ls.image)continue;const ms=Ar[ls.fontStack];if(ms&&(Yn=ms.ascender!==void 0&&ms.descender!==void 0,!Yn))break}if(!Yn)break}let jn=0;for(const kn of Fr){kn.trim();const $n=kn.getMaxScale(),ls=($n-1)*Zl,ms={positionedGlyphs:[],lineOffset:0};Er.positionedLines[jn]=ms;const Is=ms.positionedGlyphs;let xs=0;if(!kn.length()){Gr+=on,++jn;continue}let Nn=0,ys=0;for(let or=0;or<kn.length();or++){const ar=kn.getSection(or),Wr=kn.getSectionIndex(or),nn=kn.getCodePoint(or);let Mn=ar.scale,In=null,zn=null,es=null,Ms=Zl,ks=0,Ps=hn;Ps===Gu.vertical&&((Bn=nn)===12312||Bn===12313||Bn===12316||Bn===12540||Bn===12448)&&(Ps=Gu.horizontal);const oo=!(Ps===Gu.horizontal||!tn&&!ux(nn)||tn&&(U1[nn]||Ow(nn)));if(ar.image){const Lo=sn.get(ar.image.toString());if(!Lo)continue;es=ar.image,Er.iconsInText=Er.iconsInText||!0,zn=Lo.paddedRect;const Cs=Lo.displaySize;Mn=Mn*Zl/dn,In={width:Cs[0],height:Cs[1],left:0,top:-c2,advance:oo?Cs[1]:Cs[0],localGlyph:!1},ks=Yn?-In.height*Mn:$n*Zl-17-Cs[1]*Mn,Ms=In.advance;const _o=(oo?Cs[0]:Cs[1])*Mn-Zl*$n;_o>0&&_o>xs&&(xs=_o)}else{const Lo=Pr[ar.fontStack];if(!Lo)continue;Lo[nn]&&(zn=Lo[nn]);const Cs=Ar[ar.fontStack];if(!Cs)continue;const _o=Cs.glyphs[nn];if(!_o)continue;if(In=_o.metrics,Ms=nn!==8203?Zl:0,Yn){const lo=Cs.ascender!==void 0?Math.abs(Cs.ascender):0,Ks=Cs.descender!==void 0?Math.abs(Cs.descender):0,wo=(lo+Ks)*Mn;Nn<wo&&(Nn=wo,ys=(lo-Ks)/2*Mn),ks=-lo*Mn}else ks=($n-Mn)*Zl-17}oo?(Er.verticalizable=!0,Is.push({glyph:nn,image:es,x:qr,y:Gr+ks,vertical:oo,scale:Mn,localGlyph:In.localGlyph,fontStack:ar.fontStack,sectionIndex:Wr,metrics:In,rect:zn}),qr+=Ms*Mn+vn):(Is.push({glyph:nn,image:es,x:qr,y:Gr+ks,vertical:oo,scale:Mn,localGlyph:In.localGlyph,fontStack:ar.fontStack,sectionIndex:Wr,metrics:In,rect:zn}),qr+=In.advance*Mn+vn)}Is.length!==0&&(wn=Math.max(qr-vn,wn),Yn?f2(Is,_n,xs,ys,on*$n/2):f2(Is,_n,xs,0,on/2)),qr=0;const Bs=on*$n+xs;ms.lineOffset=Math.max(xs,ls),Gr+=Bs,++jn}var Bn;const An=Gr,{horizontalAlign:Kn,verticalAlign:ps}=OE(gn);(function(kn,$n,ls,ms,Is,xs){const Nn=($n-ls)*Is,ys=-xs*ms;for(const Bs of kn)for(const or of Bs.positionedGlyphs)or.x+=Nn,or.y+=ys})(Er.positionedLines,_n,Kn,ps,wn,An),Er.top+=-ps*An,Er.bottom=Er.top+An,Er.left+=-Kn*wn,Er.right=Er.left+wn,Er.hasBaseline=Yn}(xr,s,a,_,Gt,rt,ot,ct,gt,ht,_t,Pt),!function(Er){for(const Ar of Er)if(Ar.positionedGlyphs.length!==0)return!1;return!0}(_r))return xr}const U1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lP={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function u2(d,s,a,_,j,tt){if(s.image){const rt=_.get(s.image.toString());return rt?rt.displaySize[0]*s.scale*Zl/tt+j:0}{const rt=a[s.fontStack],ot=rt&&rt.glyphs[d];return ot?ot.metrics.advance*s.scale+j:0}}function h2(d,s,a,_){const j=Math.pow(d-s,2);return _?d<s?j/2:2*j:j+Math.abs(a)*a}function cP(d,s,a){let _=0;return d===10&&(_-=1e4),a&&(_+=150),d!==40&&d!==65288||(_+=50),s!==41&&s!==65289||(_+=50),_}function d2(d,s,a,_,j,tt){let rt=null,ot=h2(s,a,j,tt);for(const ct of _){const ht=h2(s-ct.x,a,j,tt)+ct.badness;ht<=ot&&(rt=ct,ot=ht)}return{index:d,x:s,priorBreak:rt,badness:ot}}function p2(d){return d?p2(d.priorBreak).concat(d.index):[]}function OE(d){let s=.5,a=.5;switch(d){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(d){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:s,verticalAlign:a}}function f2(d,s,a,_,j){if(!(s||a||_||j))return;const tt=d.length-1,rt=d[tt],ot=(rt.x+rt.metrics.advance*rt.scale)*s;for(let ct=0;ct<=tt;ct++)d[ct].x-=ot,d[ct].y+=a+_+j}function m2(d){return d.imagePrimary!==void 0&&d.top!==void 0&&d.bottom!==void 0&&d.left!==void 0&&d.right!==void 0}function uP(d,s,a,_){const{horizontalAlign:j,verticalAlign:tt}=OE(_),rt=a[0]-d.displaySize[0]*j,ot=a[1]-d.displaySize[1]*tt;return{imagePrimary:d,imageSecondary:s,top:ot,bottom:ot+d.displaySize[1],left:rt,right:rt+d.displaySize[0]}}function g2(d,s,a,_,j,tt){const rt=d.imagePrimary;let ot;if(rt.content){const Vt=rt.content,Gt=rt.pixelRatio||1;ot=[Vt[0]/Gt,Vt[1]/Gt,rt.displaySize[0]-Vt[2]/Gt,rt.displaySize[1]-Vt[3]/Gt]}const ct=s.left*tt,ht=s.right*tt;let mt,gt,_t,Rt;a==="width"||a==="both"?(Rt=j[0]+ct-_[3],gt=j[0]+ht+_[1]):(Rt=j[0]+(ct+ht-rt.displaySize[0])/2,gt=Rt+rt.displaySize[0]);const Pt=s.top*tt,zt=s.bottom*tt;return a==="height"||a==="both"?(mt=j[1]+Pt-_[0],_t=j[1]+zt+_[2]):(mt=j[1]+(Pt+zt-rt.displaySize[1])/2,_t=mt+rt.displaySize[1]),{imagePrimary:rt,imageSecondary:void 0,top:mt,right:gt,bottom:_t,left:Rt,collisionPadding:ot}}function y2(d){return!d.imagePrimary.stretchX}function _2(d){return!d.imagePrimary.stretchY}function x2(d){return{width:d.right-d.left,height:d.bottom-d.top}}const Tm=128;function v2(d,s,a){const{expression:_}=s;if(_.kind==="constant")return{kind:"constant",layoutSize:_.evaluate(new yo(d+1,{worldview:a}))};if(_.kind==="source")return{kind:"source"};{const{zoomStops:j,interpolationType:tt}=_;let rt=0;for(;rt<j.length&&j[rt]<=d;)rt++;rt=Math.max(0,rt-1);let ot=rt;for(;ot<j.length&&j[ot]<d+1;)ot++;ot=Math.min(j.length-1,ot);const ct=j[rt],ht=j[ot];return _.kind==="composite"?{kind:"composite",minZoom:ct,maxZoom:ht,interpolationType:tt}:{kind:"camera",minZoom:ct,maxZoom:ht,minSize:_.evaluate(new yo(ct,{worldview:a})),maxSize:_.evaluate(new yo(ht,{worldview:a})),interpolationType:tt}}}function zE(d,{uSize:s,uSizeT:a},{lowerSize:_,upperSize:j}){return d.kind==="source"?_/Tm:d.kind==="composite"?ns(_/Tm,j/Tm,a):s}function h0(d,s,a=1){let _=0,j=0;if(d.kind==="constant")j=d.layoutSize*a;else if(d.kind!=="source"){const{interpolationType:tt,minZoom:rt,maxZoom:ot}=d,ct=tt?fr(zu.interpolationFactor(tt,s,rt,ot),0,1):0;d.kind==="camera"?j=ns(d.minSize,d.maxSize,ct)*a:_=ct*a}return{uSizeT:_,uSize:j}}class _g extends yn{constructor(s,a,_,j,tt){super(s,a),this.angle=j,this.z=_,tt!==void 0&&(this.segment=tt)}clone(){return new _g(this.x,this.y,this.z,this.angle,this.segment)}}function b2(d,s,a,_,j){if(s.segment===void 0)return!0;let tt=s,rt=s.segment+1,ot=0;for(;ot>-a/2;){if(rt--,rt<0)return!1;ot-=d[rt].dist(tt),tt=d[rt]}ot+=d[rt].dist(d[rt+1]),rt++;const ct=[];let ht=0;for(;ot<a/2;){const mt=d[rt],gt=d[rt+1];if(!gt)return!1;let _t=d[rt-1].angleTo(mt)-mt.angleTo(gt);for(_t=Math.abs((_t+3*Math.PI)%(2*Math.PI)-Math.PI),ct.push({distance:ot,angleDelta:_t}),ht+=_t;ot-ct[0].distance>_;)ht-=ct.shift().angleDelta;if(ht>j)return!1;rt++,ot+=mt.dist(gt)}return!0}function w2(d){let s=0;for(let a=0;a<d.length-1;a++)s+=d[a].dist(d[a+1]);return s}function E2(d,s,a){return d?.6*s*a:0}function T2(d,s){return Math.max(d?d.right-d.left:0,s?s.right-s.left:0)}function hP(d,s,a,_,j,tt){const rt=E2(a,j,tt),ot=T2(a,_)*tt;let ct=0;const ht=w2(d)/2;for(let mt=0;mt<d.length-1;mt++){const gt=d[mt],_t=d[mt+1],Rt=gt.dist(_t);if(ct+Rt>ht){const Pt=(ht-ct)/Rt,zt=ns(gt.x,_t.x,Pt),Vt=ns(gt.y,_t.y,Pt),Gt=new _g(zt,Vt,0,_t.angleTo(gt),mt);return!rt||b2(d,Gt,ot,rt,s)?Gt:void 0}ct+=Rt}}function dP(d,s,a,_,j,tt,rt,ot,ct){const ht=E2(_,tt,rt),mt=T2(_,j),gt=mt*rt,_t=d[0].x===0||d[0].x===ct||d[0].y===0||d[0].y===ct;return s-gt<s/4&&(s=gt+s/4),S2(d,_t?s/2*ot%s:(mt/2+2*tt)*rt*ot%s,s,ht,a,gt,_t,!1,ct)}function S2(d,s,a,_,j,tt,rt,ot,ct){const ht=tt/2,mt=w2(d);let gt=0,_t=s-a,Rt=[];for(let Pt=0;Pt<d.length-1;Pt++){const zt=d[Pt],Vt=d[Pt+1],Gt=zt.dist(Vt),_i=Vt.angleTo(zt);for(;_t+a<gt+Gt;){_t+=a;const er=(_t-gt)/Gt,rr=ns(zt.x,Vt.x,er),_r=ns(zt.y,Vt.y,er);if(rr>=0&&rr<ct&&_r>=0&&_r<ct&&_t-ht>=0&&_t+ht<=mt){const xr=new _g(rr,_r,0,_i,Pt);_&&!b2(d,xr,tt,_,j)||Rt.push(xr)}}gt+=Gt}return ot||Rt.length||rt||(Rt=S2(d,gt/2,a,_,j,tt,rt,!0,ct)),Rt}function C2(d){let s=0,a=0;for(const rt of d)s+=rt.w*rt.h,a=Math.max(a,rt.w);d.sort((rt,ot)=>ot.h-rt.h);const _=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),a),h:1/0}];let j=0,tt=0;for(const rt of d)for(let ot=_.length-1;ot>=0;ot--){const ct=_[ot];if(!(rt.w>ct.w||rt.h>ct.h)){if(rt.x=ct.x,rt.y=ct.y,tt=Math.max(tt,rt.y+rt.h),j=Math.max(j,rt.x+rt.w),rt.w===ct.w&&rt.h===ct.h){const ht=_.pop();ht&&ot<_.length&&(_[ot]=ht)}else rt.h===ct.h?(ct.x+=rt.w,ct.w-=rt.w):rt.w===ct.w?(ct.y+=rt.h,ct.h-=rt.h):(_.push({x:ct.x+rt.w,y:ct.y,w:ct.w-rt.w,h:rt.h}),ct.y+=rt.h,ct.h-=rt.h);break}}return{w:j,h:tt,fill:s/(j*tt)||0}}Fn(_g,"Anchor");const A_=1;class d0{static getImagePositionScale(s,a,_){if(a&&s&&s.options&&s.options.transform){const j=s.options.transform;return{x:j.a,y:j.d}}return{x:_,y:_}}constructor(s,a,_,j){this.paddedRect=s;const{pixelRatio:tt,version:rt,stretchX:ot,stretchY:ct,content:ht,sdf:mt,usvg:gt}=a;this.pixelRatio=tt,this.stretchX=ot,this.stretchY=ct,this.content=ht,this.version=rt,this.padding=_,this.sdf=mt,this.usvg=gt,this.scale=d0.getImagePositionScale(j,gt,tt)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function NE(d,s,a){const _=Jr.parse(d),j=function(tt,rt,ot=[1,1]){return{x:0,y:0,w:(tt.data?tt.data.width:tt.width*ot[0])+2*rt,h:(tt.data?tt.data.height:tt.height*ot[1])+2*rt}}(s,a,[_.options.transform.a,_.options.transform.d]);return{bin:j,imagePosition:new d0(j,s,a,_),imageVariant:_}}class A2{constructor(s,a,_){const j=new Map,tt=new Map;this.haveRenderCallbacks=[];const rt=[];this.addImages(s,j,A_,rt),this.addImages(a,tt,2,rt);const{w:ot,h:ct}=C2(rt),ht=new iu({width:ot||1,height:ct||1});for(const[mt,gt]of s.entries()){const _t=j.get(mt).paddedRect;iu.copy(gt.data,ht,{x:0,y:0},{x:_t.x+A_,y:_t.y+A_},gt.data,null,gt.sdf)}for(const[mt,gt]of a.entries()){const _t=tt.get(mt),Rt=_t.paddedRect;let Pt=_t.padding;const zt=Rt.x+Pt,Vt=Rt.y+Pt,Gt=gt.data.width,_i=gt.data.height;Pt=Pt>1?Pt-1:Pt,iu.copy(gt.data,ht,{x:0,y:0},{x:zt,y:Vt},gt.data,_),iu.copy(gt.data,ht,{x:0,y:_i-Pt},{x:zt,y:Vt-Pt},{width:Gt,height:Pt},_),iu.copy(gt.data,ht,{x:0,y:0},{x:zt,y:Vt+_i},{width:Gt,height:Pt},_),iu.copy(gt.data,ht,{x:Gt-Pt,y:0},{x:zt-Pt,y:Vt},{width:Pt,height:_i},_),iu.copy(gt.data,ht,{x:0,y:0},{x:zt+Gt,y:Vt},{width:Pt,height:_i},_),iu.copy(gt.data,ht,{x:Gt-Pt,y:_i-Pt},{x:zt-Pt,y:Vt-Pt},{width:Pt,height:Pt},_),iu.copy(gt.data,ht,{x:0,y:_i-Pt},{x:zt+Gt,y:Vt-Pt},{width:Pt,height:Pt},_),iu.copy(gt.data,ht,{x:0,y:0},{x:zt+Gt,y:Vt+_i},{width:Pt,height:Pt},_),iu.copy(gt.data,ht,{x:Gt-Pt,y:0},{x:zt-Pt,y:Vt+_i},{width:Pt,height:Pt},_)}this.lut=_,this.image=ht,this.iconPositions=j,this.patternPositions=tt}addImages(s,a,_,j){for(const[tt,rt]of s.entries()){const{bin:ot,imagePosition:ct,imageVariant:ht}=NE(tt,rt,_);a.set(tt,ct),j.push(ot),rt.hasRenderCallback&&this.haveRenderCallbacks.push(ht.id)}}patchUpdatedImages(s,a,_){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(j=>s.hasImage(j,_)),s.dispatchRenderCallbacks(this.haveRenderCallbacks,_);for(const j of s.getUpdatedImages(_)){for(const tt of this.iconPositions.keys()){const rt=Jr.parse(tt);if(Jl.isEqual(rt.id,j)){const ot=s.getImage(j,_);this.patchUpdatedImage(this.iconPositions.get(tt),ot,a,null)}}for(const tt of this.patternPositions.keys()){const rt=Jr.parse(tt);if(Jl.isEqual(rt.id,j)){const ot=s.getImage(j,_);this.patchUpdatedImage(this.patternPositions.get(tt),ot,a,this.lut)}}}}patchUpdatedImage(s,a,_,j=null){if(!s||!a||s.version===a.version)return;s.version=a.version;const[tt,rt]=s.tl,ot=s.sdf;if(this.lut||ot){const ct={width:a.data.width,height:a.data.height},ht=new iu(ct);iu.copy(a.data,ht,{x:0,y:0},{x:0,y:0},ct,j,ot),_.update(ht,{position:{x:tt,y:rt}})}else _.update(a.data,{position:{x:tt,y:rt}})}}Fn(d0,"ImagePosition"),Fn(A2,"ImageAtlas");const p0=1e20;function R2(d,s,a,_,j,tt,rt,ot,ct){for(let ht=s;ht<s+_;ht++)P2(d,a*tt+ht,tt,j,rt,ot,ct);for(let ht=a;ht<a+j;ht++)P2(d,ht*tt+s,1,_,rt,ot,ct)}function P2(d,s,a,_,j,tt,rt){tt[0]=0,rt[0]=-p0,rt[1]=p0,j[0]=d[s];for(let ot=1,ct=0,ht=0;ot<_;ot++){j[ot]=d[s+ot*a];const mt=ot*ot;do{const gt=tt[ct];ht=(j[ot]-j[gt]+mt-gt*gt)/(ot-gt)/2}while(ht<=rt[ct]&&--ct>-1);ct++,tt[ct]=ot,rt[ct]=ht,rt[ct+1]=p0}for(let ot=0,ct=0;ot<_;ot++){for(;rt[ct+1]<ot;)ct++;const ht=tt[ct],mt=ot-ht;d[s+ot*a]=j[ht]+mt*mt}}const Gp=2,BE={none:0,ideographs:1,all:2};class Bx{constructor(s,a,_){this.requestManager=s,this.localGlyphMode=a,this.localFontFamily=_,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(s){this.url=s}getGlyphs(s,a){const _=[],j=this.url||Gl.GLYPHS_URL;for(const tt in s)for(const rt of s[tt])_.push({stack:tt,id:rt});Xr(_,({stack:tt,id:rt},ot)=>{let ct=this.entries[tt];ct||(ct=this.entries[tt]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let ht=ct.glyphs[rt];if(ht!==void 0)return void ot(null,{stack:tt,id:rt,glyph:ht});if(ht=this._tinySDF(ct,tt,rt),ht)return ct.glyphs[rt]=ht,void ot(null,{stack:tt,id:rt,glyph:ht});const mt=Math.floor(rt/256);if(256*mt>65535)return Es("glyphs > 65535 not supported"),void ot(null,{stack:tt,id:rt,glyph:ht});if(ct.ranges[mt])return void ot(null,{stack:tt,id:rt,glyph:ht});let gt=ct.requests[mt];gt||(gt=ct.requests[mt]=[],Bx.loadGlyphRange(tt,mt,j,this.requestManager,(_t,Rt)=>{if(Rt){ct.ascender=Rt.ascender,ct.descender=Rt.descender;for(const Pt in Rt.glyphs)this._doesCharSupportLocalGlyph(+Pt)||(ct.glyphs[+Pt]=Rt.glyphs[+Pt]);ct.ranges[mt]=!0}for(const Pt of gt)Pt(_t,Rt);delete ct.requests[mt]})),gt.push((_t,Rt)=>{_t?ot(_t):Rt&&ot(null,{stack:tt,id:rt,glyph:Rt.glyphs[rt]||null})})},(tt,rt)=>{if(tt)a(tt);else if(rt){const ot={};for(const{stack:ct,id:ht,glyph:mt}of rt)ot[ct]===void 0&&(ot[ct]={}),ot[ct].glyphs===void 0&&(ot[ct].glyphs={}),ot[ct].glyphs[ht]=mt&&{id:mt.id,bitmap:mt.bitmap.clone(),metrics:mt.metrics},ot[ct].ascender=this.entries[ct].ascender,ot[ct].descender=this.entries[ct].descender;a(null,ot)}})}_doesCharSupportLocalGlyph(s){return this.localGlyphMode!==BE.none&&(this.localGlyphMode===BE.all?!!this.localFontFamily:!!this.localFontFamily&&(os["CJK Unified Ideographs"](s)||os["Hangul Syllables"](s)||os.Hiragana(s)||os.Katakana(s)||os["CJK Symbols and Punctuation"](s)||os["CJK Unified Ideographs Extension A"](s)||os["CJK Unified Ideographs Extension B"](s)||os.Osage(s)))}_tinySDF(s,a,_){const j=this.localFontFamily;if(!j||!this._doesCharSupportLocalGlyph(_))return;let tt=s.tinySDF;if(!tt){let zt="400";/bold/i.test(a)?zt="900":/medium/i.test(a)?zt="500":/light/i.test(a)&&(zt="200"),tt=s.tinySDF=new Bx.TinySDF({fontFamily:j,fontWeight:zt,fontSize:24*Gp,buffer:3*Gp,radius:8*Gp}),tt.fontWeight=zt}if(this.localGlyphs[tt.fontWeight][_])return this.localGlyphs[tt.fontWeight][_];const rt=String.fromCodePoint(_),{data:ot,width:ct,height:ht,glyphWidth:mt,glyphHeight:gt,glyphLeft:_t,glyphTop:Rt,glyphAdvance:Pt}=tt.draw(rt);return this.localGlyphs[tt.fontWeight][_]={id:_,bitmap:new By({width:ct,height:ht},ot),metrics:{width:mt/Gp,height:gt/Gp,left:_t/Gp,top:Rt/Gp-27,advance:Pt/Gp,localGlyph:!0}}}}Bx.loadGlyphRange=function(d,s,a,_,j){const tt=256*s,rt=tt+255,ot=_.transformRequest(_.normalizeGlyphsURL(a).replace("{fontstack}",d).replace("{range}",`${tt}-${rt}`),ny.Glyphs);Ip(ot,(ct,ht)=>{if(ct)j(ct);else if(ht){const mt={},gt=function(_t){return new V1(_t).readFields(sP,{})}(ht);for(const _t of gt.glyphs)mt[_t.id]=_t;j(null,{glyphs:mt,ascender:gt.ascender,descender:gt.descender})}})},Bx.TinySDF=class{constructor({fontSize:d=24,buffer:s=3,radius:a=8,cutoff:_=.25,fontFamily:j="sans-serif",fontWeight:tt="normal",fontStyle:rt="normal",lang:ot=null}={}){this.buffer=s,this.cutoff=_,this.radius=a,this.lang=ot;const ct=this.size=d+4*s,ht=this._createCanvas(ct),mt=this.ctx=ht.getContext("2d",{willReadFrequently:!0});mt.font=`${rt} ${tt} ${d}px ${j}`,mt.textBaseline="alphabetic",mt.textAlign="left",mt.fillStyle="black",this.gridOuter=new Float64Array(ct*ct),this.gridInner=new Float64Array(ct*ct),this.f=new Float64Array(ct),this.z=new Float64Array(ct+1),this.v=new Uint16Array(ct)}_createCanvas(d){const s=document.createElement("canvas");return s.width=s.height=d,s}draw(d){const{width:s,actualBoundingBoxAscent:a,actualBoundingBoxDescent:_,actualBoundingBoxLeft:j,actualBoundingBoxRight:tt}=this.ctx.measureText(d),rt=Math.ceil(a),ot=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(tt-j))),ct=Math.min(this.size-this.buffer,rt+Math.ceil(_)),ht=ot+2*this.buffer,mt=ct+2*this.buffer,gt=Math.max(ht*mt,0),_t=new Uint8ClampedArray(gt),Rt={data:_t,width:ht,height:mt,glyphWidth:ot,glyphHeight:ct,glyphTop:rt,glyphLeft:0,glyphAdvance:s};if(ot===0||ct===0)return Rt;const{ctx:Pt,buffer:zt,gridInner:Vt,gridOuter:Gt}=this;this.lang&&(Pt.lang=this.lang),Pt.clearRect(zt,zt,ot,ct),Pt.fillText(d,zt,zt+rt);const _i=Pt.getImageData(zt,zt,ot,ct);Gt.fill(p0,0,gt),Vt.fill(0,0,gt);for(let er=0;er<ct;er++)for(let rr=0;rr<ot;rr++){const _r=_i.data[4*(er*ot+rr)+3]/255;if(_r===0)continue;const xr=(er+zt)*ht+rr+zt;if(_r===1)Gt[xr]=0,Vt[xr]=p0;else{const Er=.5-_r;Gt[xr]=Er>0?Er*Er:0,Vt[xr]=Er<0?Er*Er:0}}R2(Gt,0,0,ht,mt,ht,this.f,this.v,this.z),R2(Vt,zt,zt,ot,ct,ht,this.f,this.v,this.z);for(let er=0;er<gt;er++){const rr=Math.sqrt(Gt[er])-Math.sqrt(Vt[er]);_t[er]=Math.round(255-255*(rr/this.radius+this.cutoff))}return Rt}};const Gy=A_;function I2(d,s){return d+s[1]-s[0]}function M2(d,s,a,_,j=1){const tt=[],rt=d.imagePrimary,ot=rt.pixelRatio,ct=rt.paddedRect.w-2*Gy,ht=rt.paddedRect.h-2*Gy,mt=(d.right-d.left)*j,gt=(d.bottom-d.top)*j,_t=rt.stretchX||[[0,ct]],Rt=rt.stretchY||[[0,ht]],Pt=_t.reduce(I2,0),zt=Rt.reduce(I2,0),Vt=ct-Pt,Gt=ht-zt;let _i=0,er=Pt,rr=0,_r=zt,xr=0,Er=Vt,Ar=0,Pr=Gt;if(rt.content&&_){const Fr=rt.content;_i=G1(_t,0,Fr[0]),rr=G1(Rt,0,Fr[1]),er=G1(_t,Fr[0],Fr[2]),_r=G1(Rt,Fr[1],Fr[3]),xr=Fr[0]-_i,Ar=Fr[1]-rr,Er=Fr[2]-Fr[0]-er,Pr=Fr[3]-Fr[1]-_r}const sn=(Fr,on,gn,an)=>{const hn=$1(Fr.stretch-_i,er,mt,d.left*j),vn=H1(Fr.fixed-xr,Er,Fr.stretch,Pt),tn=$1(on.stretch-rr,_r,gt,d.top*j),dn=H1(on.fixed-Ar,Pr,on.stretch,zt),qr=$1(gn.stretch-_i,er,mt,d.left*j),Gr=H1(gn.fixed-xr,Er,gn.stretch,Pt),wn=$1(an.stretch-rr,_r,gt,d.top*j),_n=H1(an.fixed-Ar,Pr,an.stretch,zt),Yn=new yn(hn,tn),jn=new yn(qr,tn),Bn=new yn(qr,wn),An=new yn(hn,wn),Kn=new yn(vn/ot,dn/ot),ps=new yn(Gr/ot,_n/ot),kn=s*Math.PI/180;if(kn){const Nn=Math.sin(kn),ys=Math.cos(kn),Bs=[ys,-Nn,Nn,ys];Yn._matMult(Bs),jn._matMult(Bs),An._matMult(Bs),Bn._matMult(Bs)}const $n=Fr.stretch+Fr.fixed,ls=gn.stretch+gn.fixed,ms=on.stretch+on.fixed,Is=an.stretch+an.fixed,xs=d.imageSecondary;return{tl:Yn,tr:jn,bl:An,br:Bn,texPrimary:{x:rt.paddedRect.x+Gy+$n,y:rt.paddedRect.y+Gy+ms,w:ls-$n,h:Is-ms},texSecondary:xs?{x:xs.paddedRect.x+Gy+$n,y:xs.paddedRect.y+Gy+ms,w:ls-$n,h:Is-ms}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Kn,pixelOffsetBR:ps,minFontScaleX:Er/ot/mt,minFontScaleY:Pr/ot/gt,isSDF:a}};if(_&&(rt.stretchX||rt.stretchY)){const Fr=k2(_t,Vt,Pt),on=k2(Rt,Gt,zt);for(let gn=0;gn<Fr.length-1;gn++){const an=Fr[gn],hn=Fr[gn+1];for(let vn=0;vn<on.length-1;vn++)tt.push(sn(an,on[vn],hn,on[vn+1]))}}else tt.push(sn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:ct+1},{fixed:0,stretch:ht+1}));return tt}function G1(d,s,a){let _=0;for(const j of d)_+=Math.max(s,Math.min(a,j[1]))-Math.max(s,Math.min(a,j[0]));return _}function k2(d,s,a){const _=[{fixed:-Gy,stretch:0}];for(const[j,tt]of d){const rt=_[_.length-1];_.push({fixed:j-rt.stretch,stretch:rt.stretch}),_.push({fixed:j-rt.stretch,stretch:rt.stretch+(tt-j)})}return _.push({fixed:s+Gy,stretch:a}),_}function $1(d,s,a,_){return d/s*a+_}function H1(d,s,a,_){return d-s*a/_}function pP(d,s,a,_){const j=s+d.positionedLines[_].lineOffset;return _===0?a+j/2:a+(j+(s+d.positionedLines[_-1].lineOffset))/2}function fP(d,s=1,a=!1){let _=1/0,j=1/0,tt=-1/0,rt=-1/0;const ot=d[0];for(let Rt=0;Rt<ot.length;Rt++){const Pt=ot[Rt];(!Rt||Pt.x<_)&&(_=Pt.x),(!Rt||Pt.y<j)&&(j=Pt.y),(!Rt||Pt.x>tt)&&(tt=Pt.x),(!Rt||Pt.y>rt)&&(rt=Pt.y)}const ct=Math.min(tt-_,rt-j);let ht=ct/2;const mt=new O_([],mP);if(ct===0)return new yn(_,j);for(let Rt=_;Rt<tt;Rt+=ct)for(let Pt=j;Pt<rt;Pt+=ct)mt.push(new Vx(Rt+ht,Pt+ht,ht,d));let gt=function(Rt){let Pt=0,zt=0,Vt=0;const Gt=Rt[0];for(let _i=0,er=Gt.length,rr=er-1;_i<er;rr=_i++){const _r=Gt[_i],xr=Gt[rr],Er=_r.x*xr.y-xr.x*_r.y;zt+=(_r.x+xr.x)*Er,Vt+=(_r.y+xr.y)*Er,Pt+=3*Er}return new Vx(zt/Pt,Vt/Pt,0,Rt)}(d),_t=mt.length;for(;mt.length;){const Rt=mt.pop();(Rt.d>gt.d||!gt.d)&&(gt=Rt,a&&console.log("found best %d after %d probes",Math.round(1e4*Rt.d)/1e4,_t)),Rt.max-gt.d<=s||(ht=Rt.h/2,mt.push(new Vx(Rt.p.x-ht,Rt.p.y-ht,ht,d)),mt.push(new Vx(Rt.p.x+ht,Rt.p.y-ht,ht,d)),mt.push(new Vx(Rt.p.x-ht,Rt.p.y+ht,ht,d)),mt.push(new Vx(Rt.p.x+ht,Rt.p.y+ht,ht,d)),_t+=4)}return a&&(console.log(`num probes: ${_t}`),console.log(`best distance: ${gt.d}`)),gt.p}function mP(d,s){return s.max-d.max}class Vx{constructor(s,a,_,j){this.p=new yn(s,a),this.h=_,this.d=function(tt,rt){let ot=!1,ct=1/0;for(let ht=0;ht<rt.length;ht++){const mt=rt[ht];for(let gt=0,_t=mt.length,Rt=_t-1;gt<_t;Rt=gt++){const Pt=mt[gt],zt=mt[Rt];Pt.y>tt.y!=zt.y>tt.y&&tt.x<(zt.x-Pt.x)*(tt.y-Pt.y)/(zt.y-Pt.y)+Pt.x&&(ot=!ot),ct=Math.min(ct,Oo(tt,Pt,zt))}}return(ot?1:-1)*Math.sqrt(ct)}(this.p,j),this.max=this.d+this.h*Math.SQRT2}}const gP=Object.keys,VE=Number.POSITIVE_INFINITY,yP=Math.sqrt(2);function D2(d,[s,a]){let _=0,j=0;if(a===VE){s<0&&(s=0);const tt=s/yP;switch(d){case"top-right":case"top-left":j=tt-7;break;case"bottom-right":case"bottom-left":j=7-tt;break;case"bottom":j=7-s;break;case"top":j=s-7}switch(d){case"top-right":case"bottom-right":_=-tt;break;case"top-left":case"bottom-left":_=tt;break;case"left":_=s;break;case"right":_=-s}}else{switch(s=Math.abs(s),a=Math.abs(a),d){case"top-right":case"top-left":case"top":j=a-7;break;case"bottom-right":case"bottom-left":case"bottom":j=7-a}switch(d){case"top-right":case"bottom-right":case"right":_=-s;break;case"top-left":case"bottom-left":case"left":_=s}}return[_,j]}function W1(d,s,a,_,j,tt,rt,ot,ct){if(!s||!s.usvg)return;const ht=x2(_),mt=x2(j),gt=tt!=="both"&&tt!=="width"||!y2(_)?1:mt.width/ht.width,_t=tt!=="both"&&tt!=="height"||!_2(_)?1:mt.height/ht.height;a.scaleSelf(gt,_t);const Rt=a.toString();rt.set(Rt,a),ot.set(Rt,s);const{imagePosition:Pt}=NE(Rt,s,A_);ct.set(Rt,Pt)}function L2(d,s,a,_,j,tt,rt,ot,ct){if(!d)return;const ht=function(mt,gt,_t,Rt,Pt,zt){if(mt.kind==="camera")return mt.maxSize;if(mt.kind==="composite"){const Vt=gt.possiblyEvaluate(new yo(mt.maxZoom,{worldview:zt}),_t).evaluate(Pt,{},_t),Gt=gt.possiblyEvaluate(new yo(mt.minZoom,{worldview:zt}),_t).evaluate(Pt,{},_t);return Math.max(Vt,Gt)}return gt.possiblyEvaluate(new yo(Rt,{worldview:zt})).evaluate(Pt,{},_t)}(s,a,_,j,tt,ct);return d.scaleSelf(ht*ot*rt)}function j2(d,s,a,_,j,tt,rt,ot,ct){return{iconPrimary:L2(d.getPrimary(),s,a,_,j,tt,rt,ot,ct),iconSecondary:L2(d.getSecondary(),s,a,_,j,tt,rt,ot,ct)}}function _P(d,s,a){if(!s)return;const _=a.get(d.toString()),j=a.get(s.toString());_&&j&&(_.paddedRect.w===j.paddedRect.w&&_.paddedRect.h===j.paddedRect.h||Es(`Mismatch in icon variant sizes: ${d.toString()} and ${s.toString()}`),_.usvg!==j.usvg&&Es(`Mismatch in icon variant image types: ${d.id} and ${s.id}`))}function F2(d,s,a,_){if(!d)return;const j=s.get(a.toString());if(d.imagePrimary=j,_){const tt=s.get(_.toString());d.imageSecondary=tt}}function xP(d,s){for(const a in d.horizontal)O2(d.horizontal[a],s);O2(d.vertical,s)}function O2(d,s){if(d){for(const a of d.positionedLines)for(const _ of a.positionedGlyphs)if(_.image!==null){const j=_.image.toString();_.rect=s.get(j).paddedRect}}}function UE(d){switch(d){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function vP(d,s,a,_,j,tt,rt,ot,ct){const ht=GE(tt.horizontal)||tt.vertical,mt=a.get("icon-text-fit-padding").evaluate(_,{},j);let gt,_t=s;return s&&ct!=="none"&&(d.allowVerticalPlacement&&tt.vertical&&(gt=g2(s,tt.vertical,ct,mt,ot,rt)),ht&&(_t=g2(s,ht,ct,mt,ot,rt))),{defaultShapedIcon:_t,verticallyShapedIcon:gt}}function bP(d,s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt,Vt,Gt,_i,er){let rr=rt.textMaxSize.evaluate(s,{},_t);rr===void 0?rr=ot*rt.textScaleFactor:rr*=rt.textScaleFactor;const _r=d.layers[0].layout,xr=GE(a.horizontal)||a.vertical,Er=Rt.name==="globe",Ar=Zl,Pr=d.tilePixelRatio*rr/Ar,sn=(vn=d.overscaling,d.zoom>18&&vn>2&&(vn>>=1),Math.max(Rn/(512*vn),1)*_r.get("symbol-spacing")),Fr=_r.get("text-padding")*d.tilePixelRatio,on=_r.get("icon-padding")*d.tilePixelRatio,gn=Lr(_r.get("text-max-angle")),an=_r.get("icon-rotation-alignment")==="map"&&er!=="point",hn=sn/2;var vn;d.hasAnyIconTextFit===!1&&Vt!=="none"&&(d.hasAnyIconTextFit=!0);const tn=s.properties?+s.properties[Ts]:null,dn=tn&&d.elevationFeatureIdToIndex?d.elevationFeatureIdToIndex.get(tn):65535,qr=(Gr,wn,_n)=>{if(wn.x<0||wn.x>=Rn||wn.y<0||wn.y>=Rn)return;let Yn=null;if(Er){const{x:jn,y:Bn,z:An}=Rt.projectTilePoint(wn.x,wn.y,_n);Yn={anchor:new _g(jn,Bn,An,0,void 0),up:Rt.upVector(_n,wn.x,wn.y)}}(function(jn,Bn,An,Kn,ps,kn,$n,ls,ms,Is,xs,Nn,ys,Bs,or,ar,Wr,nn,Mn,In,zn,es,Ms,ks,Ps,oo,Lo,Cs,_o){const lo=jn.addToLineVertexArray(Bn,Kn);let Ks,wo,Eo,mo,xo,co,Ds,uo=0,Vo=0,us=0,Us=0,To=-1,Wo=-1;const Ro={};let Al=ay("");const fo=An?An.anchor:Bn,wl=Cs!=="none";let Pu=0,ru=0;if(ms._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Rl=ms.layout.get("text-offset").evaluate(zn,{},Ps);Pu=Rl[0]*Zl,ru=Rl[1]*Zl}else Pu=ms.layout.get("text-radial-offset").evaluate(zn,{},Ps)*Zl,ru=VE;if(jn.allowVerticalPlacement&&ps.vertical){const Rl=ps.vertical;if(or)co=$E(Rl),ls&&(Ds=$E(ls));else{const Bl=ms.layout.get("text-rotate").evaluate(zn,{},Ps)+90;Eo=q1(Is,fo,Bn,xs,Nn,ys,Rl,Bs,Bl,ar),ls&&(mo=q1(Is,fo,Bn,xs,Nn,ys,ls,nn,Bl))}}if(kn){const Rl=jn.iconSizeData,Bl=ms.layout.get("icon-rotate").evaluate(zn,{},Ps),nu=M2(kn,Bl,Ms,wl,es.iconScaleFactor),fu=ls?M2(ls,Bl,Ms,wl,es.iconScaleFactor):void 0;wo=q1(Is,fo,Bn,xs,Nn,ys,kn,nn,Bl,null),uo=4*nu.length;let cu=null;Rl.kind==="source"?(cu=[Tm*ms.layout.get("icon-size").evaluate(zn,{},Ps)*es.iconScaleFactor],cu[0]>$y&&Es(`${jn.layerIds[0]}: Value for "icon-size" is >= ${f0}. Reduce your "icon-size".`)):Rl.kind==="composite"&&(cu=[Tm*es.compositeIconSizes[0].evaluate(zn,{},Ps)*es.iconScaleFactor,Tm*es.compositeIconSizes[1].evaluate(zn,{},Ps)*es.iconScaleFactor],(cu[0]>$y||cu[1]>$y)&&Es(`${jn.layerIds[0]}: Value for "icon-size" is >= ${f0}. Reduce your "icon-size".`)),jn.addSymbols(jn.icon,nu,cu,In,Mn,zn,void 0,An,Bn,lo.lineStartIndex,lo.lineLength,-1,ks,Ps,oo,Lo),To=jn.icon.placedSymbolArray.length-1,fu&&(Vo=4*fu.length,jn.addSymbols(jn.icon,fu,cu,In,Mn,zn,Gu.vertical,An,Bn,lo.lineStartIndex,lo.lineLength,-1,ks,Ps,oo,Lo),Wo=jn.icon.placedSymbolArray.length-1)}for(const Rl in ps.horizontal){const Bl=Rl,nu=ps.horizontal[Bl];Ks||(Al=ay(nu.text),or?xo=$E(nu):Ks=q1(Is,fo,Bn,xs,Nn,ys,nu,Bs,ms.layout.get("text-rotate").evaluate(zn,{},Ps),ar));const fu=nu.positionedLines.length===1;if(us+=z2(jn,An,Bn,nu,$n,ms,or,zn,ar,lo,ps.vertical?Gu.horizontal:Gu.horizontalOnly,fu?gP(ps.horizontal):[Bl],Ro,To,es,ks,Ps,oo),fu)break}ps.vertical&&(Us+=z2(jn,An,Bn,ps.vertical,$n,ms,or,zn,ar,lo,Gu.vertical,["vertical"],Ro,Wo,es,ks,Ps,oo));let Ql=-1;const Iu=(Rl,Bl)=>Rl?Math.max(Rl,Bl):Bl;Ql=Iu(xo,Ql),Ql=Iu(co,Ql),Ql=Iu(Ds,Ql);const Sm=Ql>-1?1:0;jn.glyphOffsetArray.length>=65535&&Es("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),zn.sortKey!==void 0&&jn.addToSortKeyRanges(jn.symbolInstances.length,zn.sortKey),jn.symbolInstances.emplaceBack(Bn.x,Bn.y,fo.x,fo.y,fo.z,Ro.right>=0?Ro.right:-1,Ro.center>=0?Ro.center:-1,Ro.left>=0?Ro.left:-1,Ro.vertical>=0?Ro.vertical:-1,To,Wo,Al,Ks!==void 0?Ks:jn.collisionBoxArray.length,Ks!==void 0?Ks+1:jn.collisionBoxArray.length,Eo!==void 0?Eo:jn.collisionBoxArray.length,Eo!==void 0?Eo+1:jn.collisionBoxArray.length,wo!==void 0?wo:jn.collisionBoxArray.length,wo!==void 0?wo+1:jn.collisionBoxArray.length,mo||jn.collisionBoxArray.length,mo?mo+1:jn.collisionBoxArray.length,xs,us,Us,uo,Vo,Sm,0,Pu,ru,Ql,0,wl?1:0,_o)})(d,wn,Yn,Gr,a,_,tt,j,d.layers[0],d.collisionBoxArray,s.index,s.sourceLayerIndex,d.index,Fr,_i,ht,0,on,an,Gt,s,rt,mt,gt,_t,Pt,zt,Vt,dn)};if(er==="line")for(const Gr of D1(s.geometry,0,0,Rn,Rn)){const wn=dP(Gr,sn,gn,a.vertical||xr,_,Ar,Pr,d.overscaling,Rn);for(const _n of wn)xr&&wP(d,xr.text,hn,_n)||qr(Gr,_n,_t)}else if(er==="line-center"){for(const Gr of s.geometry)if(Gr.length>1){const wn=hP(Gr,gn,a.vertical||xr,_,Ar,Pr);wn&&qr(Gr,wn,_t)}}else if(s.type==="Polygon")for(const Gr of Kv(s.geometry,0)){const wn=fP(Gr,16);qr(Gr[0],new _g(wn.x,wn.y,0,0,void 0),_t)}else if(s.type==="LineString")for(const Gr of s.geometry)qr(Gr,new _g(Gr[0].x,Gr[0].y,0,0,void 0),_t);else if(s.type==="Point")for(const Gr of s.geometry)for(const wn of Gr)qr([wn],new _g(wn.x,wn.y,0,0,void 0),_t)}const f0=255,$y=f0*Tm;function z2(d,s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt,Vt,Gt){const _i=function(_r,xr,Er,Ar,Pr,sn,Fr,on){const gn=[];if(xr.positionedLines.length===0)return gn;const an=Ar.layout.get("text-rotate").evaluate(sn,{})*Math.PI/180,hn=function(Gr){const wn=Gr[0],_n=Gr[1],Yn=wn*_n;return Yn>0?[wn,-_n]:Yn<0?[-wn,_n]:wn===0?[_n,wn]:[_n,-wn]}(Er);let vn=Math.abs(xr.top-xr.bottom);for(const Gr of xr.positionedLines)vn-=Gr.lineOffset;const tn=xr.positionedLines.length,dn=vn/tn;let qr=xr.top-Er[1];for(let Gr=0;Gr<tn;++Gr){const wn=xr.positionedLines[Gr];qr=pP(xr,dn,qr,Gr);for(const _n of wn.positionedGlyphs){if(!_n.rect)continue;const Yn=_n.rect||{};let jn=c2+1,Bn=!0,An=1,Kn=0;if(_n.image){const zn=Fr.get(_n.image.toString());if(!zn)continue;if(zn.sdf){Es("SDF images are not supported in formatted text and will be ignored.");continue}Bn=!1,An=zn.pixelRatio,jn=A_/An}const ps=(Pr||on)&&_n.vertical,kn=_n.metrics.advance*_n.scale/2,$n=_n.metrics,ls=_n.rect;if(ls===null)continue;on&&xr.verticalizable&&(Kn=_n.image?kn-_n.metrics.width*_n.scale/2:0);const ms=Pr?[_n.x+kn,_n.y]:[0,0];let Is=[0,0],xs=[0,0],Nn=!1;Pr||(ps?(xs=[_n.x+kn+hn[0],_n.y+hn[1]-Kn],Nn=!0):Is=[_n.x+kn+Er[0],_n.y+Er[1]-Kn]);const ys=ls.w*_n.scale/(An*(_n.localGlyph?Gp:1)),Bs=ls.h*_n.scale/(An*(_n.localGlyph?Gp:1));let or,ar,Wr,nn;if(ps){const zn=_n.y-qr,es=new yn(-kn,kn-zn),Ms=-Math.PI/2,ks=new yn(...xs);or=new yn(-kn+Is[0],Is[1]),or._rotateAround(Ms,es)._add(ks),or.x+=-zn+kn,or.y-=($n.left-jn)*_n.scale;const Ps=_n.image?$n.advance*_n.scale:Zl*_n.scale,oo=String.fromCodePoint(_n.glyph);ZR(oo)?or.x+=(1-jn)*_n.scale:XR(oo)?or.x+=Ps-$n.height*_n.scale+(-jn-1)*_n.scale:or.x+=_n.image||$n.width+2*jn===ls.w&&$n.height+2*jn===ls.h?(Ps-Bs)/2:(Ps-($n.height+2*jn)*_n.scale)/2,ar=new yn(or.x,or.y-ys),Wr=new yn(or.x+Bs,or.y),nn=new yn(or.x+Bs,or.y-ys)}else{const zn=($n.left-jn)*_n.scale-kn+Is[0],es=(-$n.top-jn)*_n.scale+Is[1],Ms=zn+ys,ks=es+Bs;or=new yn(zn,es),ar=new yn(Ms,es),Wr=new yn(zn,ks),nn=new yn(Ms,ks)}if(an){let zn;zn=Pr?new yn(0,0):Nn?new yn(hn[0],hn[1]):new yn(Er[0],Er[1]),or._rotateAround(an,zn),ar._rotateAround(an,zn),Wr._rotateAround(an,zn),nn._rotateAround(an,zn)}const Mn=new yn(0,0),In=new yn(0,0);gn.push({tl:or,tr:ar,bl:Wr,br:nn,texPrimary:Yn,texSecondary:void 0,writingMode:xr.writingMode,glyphOffset:ms,sectionIndex:_n.sectionIndex,isSDF:Bn,pixelOffsetTL:Mn,pixelOffsetBR:In,minFontScaleX:0,minFontScaleY:0})}}return gn}(0,_,ct,tt,rt,ot,j,d.allowVerticalPlacement),er=d.textSizeData;let rr=null;er.kind==="source"?(rr=[Tm*tt.layout.get("text-size").evaluate(ot,{},Vt)*Pt.textScaleFactor],rr[0]>$y&&Es(`${d.layerIds[0]}: Value for "text-size" is >= ${f0}. Reduce your "text-size".`)):er.kind==="composite"&&(rr=[Tm*Pt.compositeTextSizes[0].evaluate(ot,{},Vt)*Pt.textScaleFactor,Tm*Pt.compositeTextSizes[1].evaluate(ot,{},Vt)*Pt.textScaleFactor],(rr[0]>$y||rr[1]>$y)&&Es(`${d.layerIds[0]}: Value for "text-size" is >= ${f0}. Reduce your "text-size".`)),d.addSymbols(d.text,_i,rr,ct,rt,ot,mt,s,a,ht.lineStartIndex,ht.lineLength,Rt,zt,Vt,Gt,!1);for(const _r of gt)_t[_r]=d.text.placedSymbolArray.length-1;return 4*_i.length}function GE(d){for(const s in d)return d[s];return null}function q1(d,s,a,_,j,tt,rt,ot,ct,ht){let mt=rt.top,gt=rt.bottom,_t=rt.left,Rt=rt.right;if(m2(rt)&&rt.collisionPadding){const Pt=rt.collisionPadding;_t-=Pt[0],mt-=Pt[1],Rt+=Pt[2],gt+=Pt[3]}if(ct){const Pt=new yn(_t,mt),zt=new yn(Rt,mt),Vt=new yn(_t,gt),Gt=new yn(Rt,gt),_i=Lr(ct);let er=new yn(0,0);ht&&(er=new yn(ht[0],ht[1])),Pt._rotateAround(_i,er),zt._rotateAround(_i,er),Vt._rotateAround(_i,er),Gt._rotateAround(_i,er),_t=Math.min(Pt.x,zt.x,Vt.x,Gt.x),Rt=Math.max(Pt.x,zt.x,Vt.x,Gt.x),mt=Math.min(Pt.y,zt.y,Vt.y,Gt.y),gt=Math.max(Pt.y,zt.y,Vt.y,Gt.y)}return d.emplaceBack(s.x,s.y,s.z,a.x,a.y,_t,mt,Rt,gt,ot,_,j,tt),d.length-1}function $E(d){m2(d)&&d.collisionPadding&&(d.top-=d.collisionPadding[1],d.bottom+=d.collisionPadding[3]);const s=d.bottom-d.top;return s>0?Math.max(10,s):null}function wP(d,s,a,_){const j=d.compareText;if(s in j){const tt=j[s];for(let rt=tt.length-1;rt>=0;rt--)if(_.dist(tt[rt])<a)return!0}else j[s]=[];return j[s].push(_),!1}function N2(d,s){const a=d.fovAboveCenter,_=d.elevation?d.elevation.getMinElevationBelowMSL()*s:0,j=(d._camera.position[2]*d.worldSize-_)/Math.cos(d._pitch),tt=Math.sin(a)*j/Math.sin(Math.max(Math.PI/2-d._pitch-a,.01));let rt=Math.sin(d._pitch)*tt+j;const ot=j*(1/d._horizonShift);if(!d.elevation||d.elevation.exaggeration()===0){let ct=Math.max(d.zoom-17,0);d.isOrthographic&&(ct/=10),rt*=1+ct}return Math.min(1.01*rt,ot)}function m0(d,s){if(!s.isReprojectedInTileSpace)return{scale:1<<d.z,x:d.x,y:d.y,x2:d.x+1,y2:d.y+1,projection:s};const a=Math.pow(2,-d.z),_=d.x*a,j=(d.x+1)*a,tt=d.y*a,rt=(d.y+1)*a,ot=gr(_),ct=gr(j),ht=dr(tt),mt=dr(rt),gt=s.project(ot,ht),_t=s.project(ct,ht),Rt=s.project(ct,mt),Pt=s.project(ot,mt);let zt=Math.min(gt.x,_t.x,Rt.x,Pt.x),Vt=Math.min(gt.y,_t.y,Rt.y,Pt.y),Gt=Math.max(gt.x,_t.x,Rt.x,Pt.x),_i=Math.max(gt.y,_t.y,Rt.y,Pt.y);const er=a/16;function rr(xr,Er,Ar,Pr,sn,Fr){const on=(Ar+sn)/2,gn=(Pr+Fr)/2,an=s.project(gr(on),dr(gn)),hn=Math.max(0,zt-an.x,Vt-an.y,an.x-Gt,an.y-_i);zt=Math.min(zt,an.x),Gt=Math.max(Gt,an.x),Vt=Math.min(Vt,an.y),_i=Math.max(_i,an.y),hn>er&&(rr(xr,an,Ar,Pr,on,gn),rr(an,Er,on,gn,sn,Fr))}rr(gt,_t,_,tt,j,tt),rr(_t,Rt,j,tt,j,rt),rr(Rt,Pt,j,rt,_,rt),rr(Pt,gt,_,rt,_,tt),zt-=er,Vt-=er,Gt+=er,_i+=er;const _r=1/Math.max(Gt-zt,_i-Vt);return{scale:_r,x:zt*_r,y:Vt*_r,x2:Gt*_r,y2:_i*_r,projection:s}}function B2(d,{x:s,y:a},_=0){return new yn(((s-_)*d.scale-d.x)*Rn,(a*d.scale-d.y)*Rn)}const EP=At(new Float32Array(16));class Hy{constructor(s){this.spec=s,this.name=s.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(s,a){return{x:0,y:0,z:0}}unproject(s,a){return new Ot(0,0)}projectTilePoint(s,a,_){return{x:s,y:a,z:0}}locationPoint(s,a,_,j=!0){return s._coordinatePoint(s.locationCoordinate(a,_),j)}pixelsPerMeter(s,a){return hr(1,s)*a}pixelSpaceConversion(s,a,_){return 1}farthestPixelDistance(s){return N2(s,s.pixelsPerMeter)}pointCoordinate(s,a,_,j){const tt=s.horizonLineFromTop(!1),rt=new yn(a,Math.max(tt,_));return s.rayIntersectionCoordinate(s.pointRayIntersection(rt,j))}pointCoordinate3D(s,a,_){const j=new yn(a,_);if(s.elevation)return s.elevation.pointCoordinate(j);{const tt=this.pointCoordinate(s,j.x,j.y,0);return[tt.x,tt.y,tt.z]}}isPointAboveHorizon(s,a){if(s.elevation&&s.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(s,a.x,a.y);const _=s.horizonLineFromTop();return a.y<_}createInversionMatrix(s,a){return EP}createTileMatrix(s,a,_){let j,tt,rt;const ot=_.canonical,ct=At(new Float64Array(16));if(this.isReprojectedInTileSpace){const ht=m0(ot,this);j=1,tt=ht.x+_.wrap*ht.scale,rt=ht.y,St(ct,ct,[j/ht.scale,j/ht.scale,s.pixelsPerMeter/a])}else j=a/s.zoomScale(ot.z),tt=(ot.x+Math.pow(2,ot.z)*_.wrap)*j,rt=ot.y*j;return It(ct,ct,[tt,rt,0]),St(ct,ct,[j/Rn,j/Rn,1]),ct}upVector(s,a,_){return[0,0,1]}upVectorScale(s,a,_){return{metersToTile:1}}}class TP extends Hy{constructor(s){super(s),this.range=[4,7],this.center=s.center||[-96,37.5];const[a,_]=this.parallels=s.parallels||[29.5,45.5],j=Math.sin(Lr(a));this.n=(j+Math.sin(Lr(_)))/2,this.c=1+j*(2*this.n-j),this.r0=Math.sqrt(this.c)/this.n}project(s,a){const{n:_,c:j,r0:tt}=this,rt=Lr(s-this.center[0]),ot=Lr(a),ct=Math.sqrt(j-2*_*Math.sin(ot))/_;return{x:ct*Math.sin(rt*_),y:ct*Math.cos(rt*_)-tt,z:0}}unproject(s,a){const{n:_,c:j,r0:tt}=this,rt=tt+a;let ot=Math.atan2(s,Math.abs(rt))*Math.sign(rt);rt*_<0&&(ot-=Math.PI*Math.sign(s)*Math.sign(rt));const ct=Lr(this.center[0])*_;ot=Rr(ot,-Math.PI-ct,Math.PI-ct);const ht=fr(Wt(ot/_)+this.center[0],-180,180),mt=Math.asin(fr((j-(s*s+rt*rt)*_*_)/(2*_),-1,1)),gt=fr(Wt(mt),-yr,yr);return new Ot(ht,gt)}}const g0=1.340264,y0=-.081106,_0=893e-6,x0=.003796,Z1=Math.sqrt(3)/2;class SP extends Hy{project(s,a){a=a/180*Math.PI,s=s/180*Math.PI;const _=Math.asin(Z1*Math.sin(a)),j=_*_,tt=j*j*j;return{x:.5*(s*Math.cos(_)/(Z1*(g0+3*y0*j+tt*(7*_0+9*x0*j)))/Math.PI+.5),y:1-.5*(_*(g0+y0*j+tt*(_0+x0*j))/Math.PI+1),z:0}}unproject(s,a){s=(2*s-.5)*Math.PI;let _=a=(2*(1-a)-1)*Math.PI,j=_*_,tt=j*j*j;for(let mt,gt,_t,Rt=0;Rt<12&&(gt=_*(g0+y0*j+tt*(_0+x0*j))-a,_t=g0+3*y0*j+tt*(7*_0+9*x0*j),mt=gt/_t,_=fr(_-mt,-Math.PI/3,Math.PI/3),j=_*_,tt=j*j*j,!(Math.abs(mt)<1e-12));++Rt);const rt=Z1*s*(g0+3*y0*j+tt*(7*_0+9*x0*j))/Math.cos(_),ot=Math.asin(Math.sin(_)/Z1),ct=fr(180*rt/Math.PI,-180,180),ht=fr(180*ot/Math.PI,-yr,yr);return new Ot(ct,ht)}}class CP extends Hy{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0}project(s,a){return{x:.5+s/360,y:.5-a/360,z:0}}unproject(s,a){const _=360*(s-.5),j=fr(360*(.5-a),-yr,yr);return new Ot(_,j)}}const Ux=Math.PI/2;function X1(d){return Math.tan((Ux+d)/2)}class AP extends Hy{constructor(s){super(s),this.center=s.center||[0,30];const[a,_]=this.parallels=s.parallels||[30,30];let j=Lr(a),tt=Lr(_);this.southernCenter=j+tt<0,this.southernCenter&&(j=-j,tt=-tt);const rt=Math.cos(j),ot=X1(j);this.n=j===tt?Math.sin(j):Math.log(rt/Math.cos(tt))/Math.log(X1(tt)/ot),this.f=rt*Math.pow(X1(j),this.n)/this.n}project(s,a){a=Lr(a),this.southernCenter&&(a=-a),s=Lr(s-this.center[0]);const _=1e-6,{n:j,f:tt}=this;tt>0?a<-Ux+_&&(a=-Ux+_):a>Ux-_&&(a=Ux-_);const rt=tt/Math.pow(X1(a),j);let ot=rt*Math.sin(j*s),ct=tt-rt*Math.cos(j*s);return ot=.5*(ot/Math.PI+.5),ct=.5*(ct/Math.PI+.5),{x:ot,y:this.southernCenter?ct:1-ct,z:0}}unproject(s,a){s=(2*s-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:_,f:j}=this,tt=j-a,rt=Math.sign(tt),ot=Math.sign(_)*Math.sqrt(s*s+tt*tt);let ct=Math.atan2(s,Math.abs(tt))*rt;tt*_<0&&(ct-=Math.PI*Math.sign(s)*rt);const ht=fr(Wt(ct/_)+this.center[0],-180,180),mt=fr(Wt(2*Math.atan(Math.pow(j/ot,1/_))-Ux),-yr,yr);return new Ot(ht,this.southernCenter?-mt:mt)}}class V2 extends Hy{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(s,a){return{x:sr(s),y:pr(a),z:0}}unproject(s,a){const _=gr(s),j=dr(a);return new Ot(_,j)}}const U2=Lr(yr);class RP extends Hy{project(s,a){const _=(a=Lr(a))*a,j=_*_;return{x:.5*((s=Lr(s))*(.8707-.131979*_+j*(j*(.003971*_-.001529*j)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+_*(.015085+j*(.028874*_-.044475-.005916*j)))/Math.PI+1),z:0}}unproject(s,a){s=(2*s-.5)*Math.PI;let _=a=(2*(1-a)-1)*Math.PI,j=25,tt=0,rt=_*_;do{rt=_*_;const ht=rt*rt;tt=(_*(1.007226+rt*(.015085+ht*(.028874*rt-.044475-.005916*ht)))-a)/(1.007226+rt*(.045255+ht*(.259866*rt-.311325-.005916*11*ht))),_=fr(_-tt,-U2,U2)}while(Math.abs(tt)>1e-6&&--j>0);rt=_*_;const ot=fr(Wt(s/(.8707+rt*(rt*(rt*rt*rt*(.003971-.001529*rt)-.013791)-.131979))),-180,180),ct=Wt(_);return new Ot(ot,ct)}}const G2=Lr(yr);class PP extends Hy{project(s,a){a=Lr(a),s=Lr(s);const _=Math.cos(a),j=2/Math.PI,tt=Math.acos(_*Math.cos(s/2)),rt=Math.sin(tt)/tt,ot=.5*(s*j+2*_*Math.sin(s/2)/rt)||0,ct=.5*(a+Math.sin(a)/rt)||0;return{x:.5*(ot/Math.PI+.5),y:1-.5*(ct/Math.PI+1),z:0}}unproject(s,a){let _=s=(2*s-.5)*Math.PI,j=a=(2*(1-a)-1)*Math.PI,tt=25;const rt=1e-6;let ot=0,ct=0;do{const ht=Math.cos(j),mt=Math.sin(j),gt=2*mt*ht,_t=mt*mt,Rt=ht*ht,Pt=Math.cos(_/2),zt=Math.sin(_/2),Vt=2*Pt*zt,Gt=zt*zt,_i=1-Rt*Pt*Pt,er=_i?1/_i:0,rr=_i?Math.acos(ht*Pt)*Math.sqrt(1/_i):0,_r=.5*(2*rr*ht*zt+2*_/Math.PI)-s,xr=.5*(rr*mt+j)-a,Er=.5*er*(Rt*Gt+rr*ht*Pt*_t)+1/Math.PI,Ar=er*(Vt*gt/4-rr*mt*zt),Pr=.125*er*(gt*zt-rr*mt*Rt*Vt),sn=.5*er*(_t*Pt+rr*Gt*ht)+.5,Fr=Ar*Pr-sn*Er;ot=(xr*Ar-_r*sn)/Fr,ct=(_r*Pr-xr*Er)/Fr,_=fr(_-ot,-Math.PI,Math.PI),j=fr(j-ct,-G2,G2)}while((Math.abs(ot)>rt||Math.abs(ct)>rt)&&--tt>0);return new Ot(Wt(_),Wt(j))}}class $2 extends Hy{constructor(s){super(s),this.center=s.center||[0,0],this.parallels=s.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Lr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(s,a){const{scale:_,cosPhi:j}=this;return{x:Lr(s)*j*_+.5,y:-Math.sin(Lr(a))/j*_+.5,z:0}}unproject(s,a){const{scale:_,cosPhi:j}=this,tt=-(a-.5)/_,rt=fr(Wt((s-.5)/_)/j,-180,180),ot=Math.asin(fr(tt*j,-1,1)),ct=fr(Wt(ot),-yr,yr);return new Ot(rt,ct)}}class IP extends V2{constructor(s){super(s),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(s,a,_){const j=$v(s,a,_);return Vs(j,j,T1(wm(_))),{x:j[0],y:j[1],z:j[2]}}locationPoint(s,a,_){const j=Et(a.lat,a.lng),tt=ss([],j),rt=_?s._centerAltitude+_:s.elevation?s.elevation.getAtPointOrZero(s.locationCoordinate(a),s._centerAltitude):s._centerAltitude;pn(j,j,tt,hr(1,0)*Rn*rt);const ot=At(new Float64Array(16));return Tt(ot,s.pixelMatrix,s.globeMatrix),Vs(j,j,ot),new yn(j[0],j[1])}pixelsPerMeter(s,a){return hr(1,0)*a}pixelSpaceConversion(s,a,_){const j=hr(1,s)*a,tt=ns(hr(1,45)*a,j,_);return this.pixelsPerMeter(s,a)/tt}createTileMatrix(s,a,_){const j=Qw(wm(_.canonical));return Tt(new Float64Array(16),s.globeMatrix,j)}createInversionMatrix(s,a){const{center:_}=s,j=T1(wm(a));return Ht(j,j,Lr(_.lng)),jt(j,j,Lr(_.lat)),St(j,j,[s._pixelsPerMercatorPixel,s._pixelsPerMercatorPixel,1]),Float32Array.from(j)}pointCoordinate(s,a,_,j){return fT(s,a,_,!0)||new Yr(0,0)}pointCoordinate3D(s,a,_){const j=this.pointCoordinate(s,a,_,0);return[j.x,j.y,j.z]}isPointAboveHorizon(s,a){return!fT(s,a.x,a.y,!1)}farthestPixelDistance(s){const a=function(j,tt){const rt=j.cameraToCenterDistance,ot=j._centerAltitude*tt,ct=j._camera,ht=j._camera.forward(),mt=Xt([],Cr([],ht,-rt),[0,0,ot]),gt=j.worldSize/(2*Math.PI),_t=[0,0,-gt],Rt=j.width/j.height,Pt=Math.tan(j.fovAboveCenter),zt=Cr([],ct.up(),Pt),Vt=Cr([],ct.right(),Pt*Rt),Gt=ss([],Xt([],Xt([],ht,zt),Vt)),_i=[];let er;if(new Xs(mt,Gt).closestPointOnSphere(_t,gt,_i)){const rr=Xt([],_i,_t),_r=Hs([],rr,mt);er=Math.cos(j.fovAboveCenter)*rn(_r)}else{const rr=Hs([],mt,_t),_r=Hs([],_t,mt);ss(_r,_r);const xr=rn(rr)-gt;er=Math.sqrt(xr*(xr+2*gt));const Er=Math.acos(er/(gt+xr))-Math.acos(Ls(ht,_r));er*=Math.cos(Er)}return 1.01*er}(s,this.pixelsPerMeter(s.center.lat,s.worldSize)),_=Ny(s.zoom);if(_>0){const j=N2(s,hr(1,s.center.lat)*s.worldSize),tt=s.worldSize/(2*Math.PI),rt=Math.max(s.width,s.height)/s.worldSize*Math.PI;return ns(a,j+tt*(1-Math.cos(rt)),Math.pow(_,10))}return a}upVector(s,a,_){return $v(a,_,s,1)}upVectorScale(s){return{metersToTile:b1(E1(wm(s)))}}}function H2(d){const s=d.parallels,a=!!s&&Math.abs(s[0]+s[1])<.01;switch(d.name){case"mercator":return new V2(d);case"equirectangular":return new CP(d);case"naturalEarth":return new RP(d);case"equalEarth":return new SP(d);case"winkelTripel":return new PP(d);case"albers":return a?new $2(d):new TP(d);case"lambertConformalConic":return a?new $2(d):new AP(d);case"globe":return new IP(d)}throw new Error(`Invalid projection name: ${d.name}`)}const MP=mn.types,kP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function K1(d,s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t){const Rt=ot?Math.min($y,Math.round(ot[0])):0,Pt=ot?Math.min($y,Math.round(ot[1])):0;d.emplaceBack(s,a,Math.round(32*_),Math.round(32*j),tt,rt,(Rt<<1)+(ct?1:0),Pt,16*ht,16*mt,256*gt,256*_t)}function Y1(d,s,a){d.emplaceBack(s,a)}function Q1(d,s,a,_,j,tt,rt){d.emplaceBack(s,a,_,j,tt,rt)}const J1=(d,s,a,_)=>{for(let j=0;j<s;j++)d.emplaceBack(a[0],a[1],a[2],_[0],_[1],_[2])};function _b(d,s,a,_,j){d.emplaceBack(s,a,_,j),d.emplaceBack(s,a,_,j),d.emplaceBack(s,a,_,j),d.emplaceBack(s,a,_,j)}function DP(d){for(const s of d.sections)if(Nw(s.text))return!0;return!1}class HE{constructor(s){this.layoutVertexArray=new Dv,this.indexArray=new Dl,this.programConfigurations=s,this.segments=new Bo,this.dynamicLayoutVertexArray=new ap,this.opacityVertexArray=new Dy,this.placedSymbolArray=new Cx,this.iconTransitioningVertexArray=new Sl,this.globeExtVertexArray=new Lv,this.zOffsetVertexArray=new ym,this.orientationVertexArray=new d_}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(s,a,_,j,tt){this.isEmpty()||(_&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,zR.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,BR.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,kP,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=s.createVertexBuffer(this.iconTransitioningVertexArray,GR.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,NR.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||tt)&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,VR.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=s.createVertexBuffer(this.orientationVertexArray,UR.members,!0)),this.opacityVertexBuffer.itemSize=1),(_||j)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Fn(HE,"SymbolBuffers");class WE{constructor(s,a,_){this.layoutVertexArray=new s,this.layoutAttributes=a,this.indexArray=new _,this.segments=new Bo,this.collisionVertexArray=new Fv,this.collisionVertexArrayExt=new ap}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,$R.members,!0),this.collisionVertexBufferExt=s.createVertexBuffer(this.collisionVertexArrayExt,HR.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Fn(WE,"CollisionBuffers");class ew{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(rt=>rt.fqid),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=At([]),this.placementViewportMatrix=At([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=s.worldview,this.textSizeData=v2(this.zoom,a["text-size"],this.worldview),this.iconSizeData=v2(this.zoom,a["icon-size"],this.worldview);const _=this.layers[0].layout,j=_.get("symbol-sort-key"),tt=_.get("symbol-z-order");this.lut=s.lut,this.canOverlap=_.get("text-allow-overlap")||_.get("icon-allow-overlap")||_.get("text-ignore-placement")||_.get("icon-ignore-placement"),this.sortFeaturesByKey=tt!=="viewport-y"&&j.constantOr(1)!==void 0,this.sortFeaturesByY=(tt==="viewport-y"||tt==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=_.get("text-writing-mode").map(rt=>Gu[rt]),this.stateDependentLayerIds=this.layers.filter(rt=>rt.isStateDependent()).map(rt=>rt.id),this.sourceID=s.sourceID,this.projection=s.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new HE(new lp(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("text")||s.startsWith("symbol"))),this.icon=new HE(new lp(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("icon")||s.startsWith("symbol"))),this.glyphOffsetArray=new d1,this.lineVertexArray=new p1,this.symbolInstances=new h1}calculateGlyphDependencies(s,a,_,j,tt){for(const rt of s){const ot=rt.codePointAt(0);if(ot===void 0)break;if(a[ot]=!0,j&&tt&&ot<=65535){const ct=c0[rt];ct&&(a[ct.charCodeAt(0)]=!0)}}}updateFootprints(s,a){}updateReplacement(s,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const _=a.getReplacementRegionsForTile(s.toUnwrapped(),!0);return!I1(this.activeReplacements,_)&&(this.activeReplacements=_,!0)}populate(s,a,_,j){const tt=this.layers[0],rt=tt.layout,ot=this.projection.name==="globe",ct=rt.get("text-font"),ht=rt.get("text-field"),mt=rt.get("icon-image"),[gt,_t]=rt.get("icon-size-scale-range"),Rt=fr(a.scaleFactor||1,gt,_t),Pt=(ht.value.kind!=="constant"||ht.value.value instanceof Dr&&!ht.value.value.isEmpty()||ht.value.value.toString().length>0)&&(ct.value.kind!=="constant"||ct.value.value.length>0),zt=mt.value.kind!=="constant"||!!mt.value.value||Object.keys(mt.parameters).length>0,Vt=rt.get("symbol-sort-key");if(this.features=[],!Pt&&!zt)return;const Gt=a.iconDependencies,_i=a.glyphDependencies,er=a.availableImages,rr=new yo(this.zoom,{worldview:this.worldview});for(const{feature:_r,id:xr,index:Er,sourceLayerIndex:Ar}of s){const Pr=tt._featureFilter.needGeometry,sn=xn(_r,Pr);if(!tt._featureFilter.filter(rr,sn,_))continue;if(Pr||(sn.geometry=Ln(_r,_,j)),ot&&_r.type!==1&&_.z<=5){const hn=sn.geometry,vn=.98078528056,tn=(dn,qr)=>Ls($v(dn.x,dn.y,_,1),$v(qr.x,qr.y,_,1))<vn;for(let dn=0;dn<hn.length;dn++)hn[dn]=en(hn[dn],tn)}let Fr,on;if(Pt){const hn=tt.getValueAndResolveTokens("text-field",sn,_,er),vn=Dr.factory(hn);DP(vn)&&(this.hasRTLText=!0),(!this.hasRTLText||dx()==="unavailable"||this.hasRTLText&&vp.isParsed())&&(Fr=qR(vn,tt,sn))}if(zt){const hn=tt.getValueAndResolveTokens("icon-image",sn,_,er);on=typeof hn=="string"?bn.build(hn):hn}if(!Fr&&!on)continue;const gn=this.sortFeaturesByKey?Vt.evaluate(sn,{},_):void 0,an={id:xr,text:Fr,icon:on,index:Er,sourceLayerIndex:Ar,geometry:sn.geometry,properties:_r.properties,type:MP[_r.type],sortKey:gn};if(this.features.push(an),on){const hn=this.layers[0]._unevaluatedLayout._values,{iconPrimary:vn,iconSecondary:tn}=j2(on,this.iconSizeData,hn["icon-size"],_,this.zoom,an,this.pixelRatio,Rt,this.worldview),dn=vn.id.toString();if(Gt.has(dn)?Gt.get(dn).push(vn):Gt.set(dn,[vn]),tn){this.hasAnySecondaryIcon=!0;const qr=tn.id.toString();Gt.has(qr)?Gt.get(qr).push(tn):Gt.set(qr,[tn])}}if(Fr){const hn=ct.evaluate(sn,{},_).join(","),vn=rt.get("text-rotation-alignment")==="map"&&rt.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Gu.vertical)>=0;for(const tn of Fr.sections)if(tn.image){const dn=tn.image.getPrimary().scaleSelf(this.pixelRatio),qr=dn.id.toString(),Gr=Gt.get(qr)||[];Gr.push(dn),Gt.set(qr,Gr)}else{const dn=Ev(Fr.toString()),qr=tn.fontStack||hn,Gr=_i[qr]=_i[qr]||{};this.calculateGlyphDependencies(tn.text,Gr,vn,this.allowVerticalPlacement,dn)}}}if(rt.get("symbol-placement")==="line"&&(this.features=function(_r){const xr={},Er={},Ar=[];let Pr=0;function sn(an){Ar.push(_r[an]),Pr++}function Fr(an,hn,vn){const tn=Er[an];return delete Er[an],Er[hn]=tn,Ar[tn].geometry[0].pop(),Ar[tn].geometry[0]=Ar[tn].geometry[0].concat(vn[0]),tn}function on(an,hn,vn){const tn=xr[hn];return delete xr[hn],xr[an]=tn,Ar[tn].geometry[0].shift(),Ar[tn].geometry[0]=vn[0].concat(Ar[tn].geometry[0]),tn}function gn(an,hn,vn){const tn=vn?hn[0][hn[0].length-1]:hn[0][0];return`${an}:${tn.x}:${tn.y}`}for(let an=0;an<_r.length;an++){const hn=_r[an],vn=hn.geometry,tn=hn.text?hn.text.toString():null;if(!tn){sn(an);continue}const dn=gn(tn,vn),qr=gn(tn,vn,!0);if(dn in Er&&qr in xr&&Er[dn]!==xr[qr]){const Gr=on(dn,qr,vn),wn=Fr(dn,qr,Ar[Gr].geometry);delete xr[dn],delete Er[qr],Er[gn(tn,Ar[wn].geometry,!0)]=wn,Ar[Gr].geometry=null}else dn in Er?Fr(dn,qr,vn):qr in xr?on(dn,qr,vn):(sn(an),xr[dn]=Pr-1,Er[qr]=Pr-1)}return Ar.filter(an=>an.geometry)}(this.features)),rt.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const _r of a.elevationFeatures)this.elevationFeatureIdToIndex.set(_r.id,this.elevationFeatures.length),this.elevationFeatures.push(_r)}}else rt.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((_r,xr)=>_r.sortKey-xr.sortKey)}update(s,a,_,j,tt,rt,ot){this.text.programConfigurations.updatePaintArrays(s,a,tt,_,j,rt,ot,this.worldview),this.icon.programConfigurations.updatePaintArrays(s,a,tt,_,j,rt,ot,this.worldview)}updateRoadElevation(s){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const _=Nr(s),j=1/_;let tt=!1,rt=!1;for(let ot=0;ot<this.symbolInstances.length;ot++){const ct=this.symbolInstances.get(ot),ht=Zr(1,0,0),mt=Zr(0,1,0),{numHorizontalGlyphVertices:gt,numVerticalGlyphVertices:_t,numIconVertices:Rt,numVerticalIconVertices:Pt}=ct,zt=gt>0||_t>0,Vt=Rt>0,Gt=this.elevationFeatures[ct.elevationFeatureIndex];if(Gt){const _i=new yn(ct.tileAnchorX,ct.tileAnchorY),er=.075+Gt.pointElevation(_i);ct.zOffset!==er&&(a=!0,ct.zOffset=er);const rr=Gt.computeSlopeNormal(_i,j),_r=Mu(Fl(),Zr(0,0,1),rr);Po(ht,ht,_r),Po(mt,mt,_r),ht[2]*=_,mt[2]*=_,ht[0]===1&&ht[1]===0&&ht[2]===0&&mt[0]===0&&mt[1]===1&&mt[2]===0||(tt=tt||zt,rt=rt||Vt)}if(zt&&(J1(this.text.orientationVertexArray,gt,ht,mt),J1(this.text.orientationVertexArray,_t,ht,mt)),Vt){const{placedIconSymbolIndex:_i,verticalPlacedIconSymbolIndex:er}=ct;_i>=0&&J1(this.icon.orientationVertexArray,Rt,ht,mt),er>=0&&J1(this.icon.orientationVertexArray,Pt,ht,mt)}}tt||(this.text.orientationVertexArray=void 0),rt||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const s=(tt,rt,ot)=>{_+=rt,_>tt.length&&tt.resize(_);for(let ct=-rt;ct<0;ct++)tt.emplace(ct+_,ot)},a=(tt,rt,ot)=>{j+=rt,j>tt.length&&tt.resize(j);for(let ct=-rt;ct<0;ct++)tt.emplace(ct+j,ot)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let _=0,j=0;for(let tt=0;tt<this.symbolInstances.length;tt++){const rt=this.symbolInstances.get(tt),{numHorizontalGlyphVertices:ot,numVerticalGlyphVertices:ct,numIconVertices:ht}=rt,mt=rt.zOffset,gt=ht>0;if((ot>0||ct>0)&&(s(this.text.zOffsetVertexArray,ot,mt),s(this.text.zOffsetVertexArray,ct,mt)),gt){const{placedIconSymbolIndex:_t,verticalPlacedIconSymbolIndex:Rt}=rt;_t>=0&&a(this.icon.zOffsetVertexArray,ht,mt),Rt>=0&&a(this.icon.zOffsetVertexArray,rt.numVerticalIconVertices,mt)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=H2(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,a){const _=this.lineVertexArray.length;if(s.segment!==void 0)for(const{x:j,y:tt}of a)this.lineVertexArray.emplaceBack(j,tt);return{lineStartIndex:_,lineLength:this.lineVertexArray.length-_}}addSymbols(s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt,Vt){const Gt=s.indexArray,_i=s.layoutVertexArray,er=s.globeExtVertexArray,rr=s.segments.prepareSegment(4*a.length,_i,Gt,this.canOverlap?rt.sortKey:void 0),_r=this.glyphOffsetArray.length,xr=rr.vertexLength,Er=this.allowVerticalPlacement&&ot===Gu.vertical?Math.PI/2:0,Ar=rt.text&&rt.text.sections;for(let sn=0;sn<a.length;sn++){const{tl:Fr,tr:on,bl:gn,br:an,texPrimary:hn,texSecondary:vn,pixelOffsetTL:tn,pixelOffsetBR:dn,minFontScaleX:qr,minFontScaleY:Gr,glyphOffset:wn,isSDF:_n,sectionIndex:Yn}=a[sn],jn=rr.vertexLength,Bn=wn[1];if(K1(_i,ht.x,ht.y,Fr.x,Bn+Fr.y,hn.x,hn.y,_,_n,tn.x,tn.y,qr,Gr),K1(_i,ht.x,ht.y,on.x,Bn+on.y,hn.x+hn.w,hn.y,_,_n,dn.x,tn.y,qr,Gr),K1(_i,ht.x,ht.y,gn.x,Bn+gn.y,hn.x,hn.y+hn.h,_,_n,tn.x,dn.y,qr,Gr),K1(_i,ht.x,ht.y,an.x,Bn+an.y,hn.x+hn.w,hn.y+hn.h,_,_n,dn.x,dn.y,qr,Gr),ct){const{x:An,y:Kn,z:ps}=ct.anchor,[kn,$n,ls]=ct.up;Q1(er,An,Kn,ps,kn,$n,ls),Q1(er,An,Kn,ps,kn,$n,ls),Q1(er,An,Kn,ps,kn,$n,ls),Q1(er,An,Kn,ps,kn,$n,ls),_b(s.dynamicLayoutVertexArray,An,Kn,ps,Er)}else _b(s.dynamicLayoutVertexArray,ht.x,ht.y,ht.z,Er);if(Vt){const An=vn||hn;Y1(s.iconTransitioningVertexArray,An.x,An.y),Y1(s.iconTransitioningVertexArray,An.x+An.w,An.y),Y1(s.iconTransitioningVertexArray,An.x,An.y+An.h),Y1(s.iconTransitioningVertexArray,An.x+An.w,An.y+An.h)}Gt.emplaceBack(jn,jn+1,jn+2),Gt.emplaceBack(jn+1,jn+2,jn+3),rr.vertexLength+=4,rr.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(wn[0]),sn!==a.length-1&&Yn===a[sn+1].sectionIndex||s.programConfigurations.populatePaintArrays(_i.length,rt,rt.index,{},Rt,Pt,zt,Ar&&Ar[Yn],this.worldview)}const Pr=ct?ct.anchor:ht;s.placedSymbolArray.emplaceBack(Pr.x,Pr.y,Pr.z,ht.x,ht.y,_r,this.glyphOffsetArray.length-_r,xr,mt,gt,ht.segment,_?_[0]:0,_?_[1]:0,j[0],j[1],ot,0,0,0,_t,0)}_commitLayoutVertex(s,a,_,j,tt,rt,ot){s.emplaceBack(a,_,j,tt,rt,Math.round(ot.x),Math.round(ot.y))}_addCollisionDebugVertices(s,a,_,j,tt,rt,ot){const ct=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),ht=ct.vertexLength,mt=ot.tileAnchorX,gt=ot.tileAnchorY;for(let Rt=0;Rt<4;Rt++)_.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(_.collisionVertexArrayExt,a,s.padding,ot.zOffset),this._commitLayoutVertex(_.layoutVertexArray,j,tt,rt,mt,gt,new yn(s.x1,s.y1)),this._commitLayoutVertex(_.layoutVertexArray,j,tt,rt,mt,gt,new yn(s.x2,s.y1)),this._commitLayoutVertex(_.layoutVertexArray,j,tt,rt,mt,gt,new yn(s.x2,s.y2)),this._commitLayoutVertex(_.layoutVertexArray,j,tt,rt,mt,gt,new yn(s.x1,s.y2)),ct.vertexLength+=4;const _t=_.indexArray;_t.emplaceBack(ht,ht+1),_t.emplaceBack(ht+1,ht+2),_t.emplaceBack(ht+2,ht+3),_t.emplaceBack(ht+3,ht),ct.primitiveLength+=4}_addTextDebugCollisionBoxes(s,a,_,j,tt,rt){for(let ot=j;ot<tt;ot++){const ct=_.get(ot),ht=this.getSymbolInstanceTextSize(s,rt,a,ot);this._addCollisionDebugVertices(ct,ht,this.textCollisionBox,ct.projectedAnchorX,ct.projectedAnchorY,ct.projectedAnchorZ,rt)}}_addIconDebugCollisionBoxes(s,a,_,j,tt,rt){for(let ot=j;ot<tt;ot++){const ct=_.get(ot),ht=this.getSymbolInstanceIconSize(s,a,rt.placedIconSymbolIndex);this._addCollisionDebugVertices(ct,ht,this.iconCollisionBox,ct.projectedAnchorX,ct.projectedAnchorY,ct.projectedAnchorZ,rt)}}generateCollisionDebugBuffers(s,a,_){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new WE(bx,s2.members,Sl),this.iconCollisionBox=new WE(bx,s2.members,Sl);const j=h0(this.iconSizeData,s),tt=h0(this.textSizeData,s,_);for(let rt=0;rt<this.symbolInstances.length;rt++){const ot=this.symbolInstances.get(rt);this._addTextDebugCollisionBoxes(tt,s,a,ot.textBoxStartIndex,ot.textBoxEndIndex,ot),this._addTextDebugCollisionBoxes(tt,s,a,ot.verticalTextBoxStartIndex,ot.verticalTextBoxEndIndex,ot),this._addIconDebugCollisionBoxes(j,s,a,ot.iconBoxStartIndex,ot.iconBoxEndIndex,ot),this._addIconDebugCollisionBoxes(j,s,a,ot.verticalIconBoxStartIndex,ot.verticalIconBoxEndIndex,ot)}}getSymbolInstanceTextSize(s,a,_,j){const tt=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:j),rt=zE(this.textSizeData,s,tt)/Zl;return this.tilePixelRatio*rt}getSymbolInstanceIconSize(s,a,_){const j=this.icon.placedSymbolArray.get(_),tt=zE(this.iconSizeData,s,j);return this.tilePixelRatio*tt}_commitDebugCollisionVertexUpdate(s,a,_,j){s.emplaceBack(a,-_,-_,j),s.emplaceBack(a,_,-_,j),s.emplaceBack(a,_,_,j),s.emplaceBack(a,-_,_,j)}_updateTextDebugCollisionBoxes(s,a,_,j,tt,rt,ot){for(let ct=j;ct<tt;ct++){const ht=_.get(ct),mt=this.getSymbolInstanceTextSize(s,rt,a,ct);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,mt,ht.padding,rt.zOffset)}}_updateIconDebugCollisionBoxes(s,a,_,j,tt,rt,ot){for(let ct=j;ct<tt;ct++){const ht=_.get(ct),mt=this.getSymbolInstanceIconSize(s,a,rt.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,mt,ht.padding,rt.zOffset)}}updateCollisionDebugBuffers(s,a,_,j){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const tt=h0(this.iconSizeData,s,j),rt=h0(this.textSizeData,s,_);for(let ot=0;ot<this.symbolInstances.length;ot++){const ct=this.symbolInstances.get(ot);this._updateTextDebugCollisionBoxes(rt,s,a,ct.textBoxStartIndex,ct.textBoxEndIndex,ct,_),this._updateTextDebugCollisionBoxes(rt,s,a,ct.verticalTextBoxStartIndex,ct.verticalTextBoxEndIndex,ct,_),this._updateIconDebugCollisionBoxes(tt,s,a,ct.iconBoxStartIndex,ct.iconBoxEndIndex,ct,j),this._updateIconDebugCollisionBoxes(tt,s,a,ct.verticalIconBoxStartIndex,ct.verticalIconBoxEndIndex,ct,j)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(s,a,_,j,tt,rt,ot,ct,ht){const mt={};if(a<_){const{x1:gt,y1:_t,x2:Rt,y2:Pt,padding:zt,projectedAnchorX:Vt,projectedAnchorY:Gt,projectedAnchorZ:_i,tileAnchorX:er,tileAnchorY:rr,featureIndex:_r}=s.get(a);mt.textBox={x1:gt,y1:_t,x2:Rt,y2:Pt,padding:zt,projectedAnchorX:Vt,projectedAnchorY:Gt,projectedAnchorZ:_i,tileAnchorX:er,tileAnchorY:rr},mt.textFeatureIndex=_r}if(j<tt){const{x1:gt,y1:_t,x2:Rt,y2:Pt,padding:zt,projectedAnchorX:Vt,projectedAnchorY:Gt,projectedAnchorZ:_i,tileAnchorX:er,tileAnchorY:rr,featureIndex:_r}=s.get(j);mt.verticalTextBox={x1:gt,y1:_t,x2:Rt,y2:Pt,padding:zt,projectedAnchorX:Vt,projectedAnchorY:Gt,projectedAnchorZ:_i,tileAnchorX:er,tileAnchorY:rr},mt.verticalTextFeatureIndex=_r}if(rt<ot){const{x1:gt,y1:_t,x2:Rt,y2:Pt,padding:zt,projectedAnchorX:Vt,projectedAnchorY:Gt,projectedAnchorZ:_i,tileAnchorX:er,tileAnchorY:rr,featureIndex:_r}=s.get(rt);mt.iconBox={x1:gt,y1:_t,x2:Rt,y2:Pt,padding:zt,projectedAnchorX:Vt,projectedAnchorY:Gt,projectedAnchorZ:_i,tileAnchorX:er,tileAnchorY:rr},mt.iconFeatureIndex=_r}if(ct<ht){const{x1:gt,y1:_t,x2:Rt,y2:Pt,padding:zt,projectedAnchorX:Vt,projectedAnchorY:Gt,projectedAnchorZ:_i,tileAnchorX:er,tileAnchorY:rr,featureIndex:_r}=s.get(ct);mt.verticalIconBox={x1:gt,y1:_t,x2:Rt,y2:Pt,padding:zt,projectedAnchorX:Vt,projectedAnchorY:Gt,projectedAnchorZ:_i,tileAnchorX:er,tileAnchorY:rr},mt.verticalIconFeatureIndex=_r}return mt}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const _=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,_.textBoxStartIndex,_.textBoxEndIndex,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_.iconBoxStartIndex,_.iconBoxEndIndex,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(s,a){const _=s.placedSymbolArray.get(a),j=_.vertexStartIndex+4*_.numGlyphs;for(let tt=_.vertexStartIndex;tt<j;tt+=4)s.indexArray.emplaceBack(tt,tt+1,tt+2),s.indexArray.emplaceBack(tt+1,tt+2,tt+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(s),_=Math.cos(s),j=[],tt=[],rt=[];for(let ot=0;ot<this.symbolInstances.length;++ot){rt.push(ot);const ct=this.symbolInstances.get(ot);j.push(0|Math.round(a*ct.tileAnchorX+_*ct.tileAnchorY)),tt.push(ct.featureIndex)}return rt.sort((ot,ct)=>j[ot]-j[ct]||tt[ct]-tt[ot]),rt}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let s=0;s<this.symbolInstances.length;++s)this.symbolInstanceIndexesSortedZOffset.push(s)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((s,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(s).zOffset)}addToSortKeyRanges(s,a){const _=this.sortKeyRanges[this.sortKeyRanges.length-1];_&&_.sortKey===a?_.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const _=this.symbolInstances.get(a);this.featureSortOrder.push(_.featureIndex);const{rightJustifiedTextSymbolIndex:j,centerJustifiedTextSymbolIndex:tt,leftJustifiedTextSymbolIndex:rt,verticalPlacedTextSymbolIndex:ot,placedIconSymbolIndex:ct,verticalPlacedIconSymbolIndex:ht}=_;j>=0&&this.addIndicesForPlacedSymbol(this.text,j),tt>=0&&tt!==j&&this.addIndicesForPlacedSymbol(this.text,tt),rt>=0&&rt!==tt&&rt!==j&&this.addIndicesForPlacedSymbol(this.text,rt),ot>=0&&this.addIndicesForPlacedSymbol(this.text,ot),ct>=0&&this.addIndicesForPlacedSymbol(this.icon,ct),ht>=0&&this.addIndicesForPlacedSymbol(this.icon,ht)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let W2,q2,qE;Fn(ew,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ew.addDynamicAttributes=_b;class Z2{constructor(s){this.type=s.property.overrides?s.property.overrides.runtimeType:ju,this.defaultValue=s}evaluate(s){if(s.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(s.formattedSection))return a.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Fn(Z2,"FormatSectionOverride",{omit:["defaultValue"]});const ZE=()=>qE||(qE={layout:W2||(W2=new $o({"symbol-placement":new En(jr.layout_symbol["symbol-placement"]),"symbol-spacing":new En(jr.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new En(jr.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Dn(jr.layout_symbol["symbol-sort-key"]),"symbol-z-order":new En(jr.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new En(jr.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new En(jr.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new En(jr.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new En(jr.layout_symbol["icon-ignore-placement"]),"icon-optional":new En(jr.layout_symbol["icon-optional"]),"icon-rotation-alignment":new En(jr.layout_symbol["icon-rotation-alignment"]),"icon-size":new Dn(jr.layout_symbol["icon-size"]),"icon-size-scale-range":new En(jr.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Dn(jr.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Dn(jr.layout_symbol["icon-text-fit-padding"]),"icon-image":new Dn(jr.layout_symbol["icon-image"]),"icon-image-use-theme":new En({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Dn(jr.layout_symbol["icon-rotate"]),"icon-padding":new En(jr.layout_symbol["icon-padding"]),"icon-keep-upright":new En(jr.layout_symbol["icon-keep-upright"]),"icon-offset":new Dn(jr.layout_symbol["icon-offset"]),"icon-anchor":new Dn(jr.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new En(jr.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new En(jr.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new En(jr.layout_symbol["text-rotation-alignment"]),"text-field":new Dn(jr.layout_symbol["text-field"]),"text-font":new Dn(jr.layout_symbol["text-font"]),"text-size":new Dn(jr.layout_symbol["text-size"]),"text-size-scale-range":new En(jr.layout_symbol["text-size-scale-range"]),"text-max-width":new Dn(jr.layout_symbol["text-max-width"]),"text-line-height":new Dn(jr.layout_symbol["text-line-height"]),"text-letter-spacing":new Dn(jr.layout_symbol["text-letter-spacing"]),"text-justify":new Dn(jr.layout_symbol["text-justify"]),"text-radial-offset":new Dn(jr.layout_symbol["text-radial-offset"]),"text-variable-anchor":new En(jr.layout_symbol["text-variable-anchor"]),"text-anchor":new Dn(jr.layout_symbol["text-anchor"]),"text-max-angle":new En(jr.layout_symbol["text-max-angle"]),"text-writing-mode":new En(jr.layout_symbol["text-writing-mode"]),"text-rotate":new Dn(jr.layout_symbol["text-rotate"]),"text-padding":new En(jr.layout_symbol["text-padding"]),"text-keep-upright":new En(jr.layout_symbol["text-keep-upright"]),"text-transform":new Dn(jr.layout_symbol["text-transform"]),"text-offset":new Dn(jr.layout_symbol["text-offset"]),"text-allow-overlap":new En(jr.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new En(jr.layout_symbol["text-ignore-placement"]),"text-optional":new En(jr.layout_symbol["text-optional"]),visibility:new En(jr.layout_symbol.visibility)})),paint:q2||(q2=new $o({"icon-opacity":new Dn(jr.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Dn(jr.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Dn(jr.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Dn(jr.paint_symbol["text-emissive-strength"]),"icon-color":new Dn(jr.paint_symbol["icon-color"]),"icon-halo-color":new Dn(jr.paint_symbol["icon-halo-color"]),"icon-halo-width":new Dn(jr.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Dn(jr.paint_symbol["icon-halo-blur"]),"icon-translate":new En(jr.paint_symbol["icon-translate"]),"icon-translate-anchor":new En(jr.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new En(jr.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Dn(jr.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Dn(jr.paint_symbol["text-occlusion-opacity"]),"text-color":new Dn(jr.paint_symbol["text-color"],{runtimeType:uu,getOverride:d=>d.textColor,hasOverride:d=>!!d.textColor}),"text-halo-color":new Dn(jr.paint_symbol["text-halo-color"]),"text-halo-width":new Dn(jr.paint_symbol["text-halo-width"]),"text-halo-blur":new Dn(jr.paint_symbol["text-halo-blur"]),"text-translate":new En(jr.paint_symbol["text-translate"]),"text-translate-anchor":new En(jr.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new En(jr.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new En(jr.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new En(jr.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new En(jr.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Dn(jr.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},qE);class tw extends lu{constructor(s,a,_,j){super(s,ZE(),a,_,j,s.layout?s.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=At([]),this.hasOcclusionOpacityProperties=s.paint!==void 0&&("icon-occlusion-opacity"in s.paint||"text-occlusion-opacity"in s.paint)}_handleSpecialPaintPropertyUpdate(s){s!=="icon-occlusion-opacity"&&s!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(s,a){super.recalculate(s,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const _=this.layout.get("text-writing-mode");if(_){const j=[];for(const tt of _)j.indexOf(tt)<0&&j.push(tt);this.layout._values["text-writing-mode"]=j}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(s,a,_,j){return this._saturation===s&&this._contrast===a&&this._brightnessMin===_&&this._brightnessMax===j||(this._colorAdjustmentMatrix=function(tt,rt,ot,ct){tt=mu(tt),rt=Ul(rt);const ht=Dt(),mt=tt/3,gt=1-2*mt,_t=[gt,mt,mt,0,mt,gt,mt,0,mt,mt,gt,0,0,0,0,1],Rt=.5-.5*rt,Pt=ct-ot;return Tt(ht,[Pt,0,0,0,0,Pt,0,0,0,0,Pt,0,ot,ot,ot,1],[rt,0,0,0,0,rt,0,0,0,0,rt,0,Rt,Rt,Rt,1]),Tt(ht,ht,_t),ht}(s,a,_,j),this._saturation=s,this._contrast=a,this._brightnessMin=_,this._brightnessMax=j),this._colorAdjustmentMatrix}getValueAndResolveTokens(s,a,_,j){const tt=this.layout.get(s).evaluate(a,{},_,j),rt=this._unevaluatedLayout._values[s];return rt.isDataDriven()||vv(rt.value)||!tt?tt:function(ot,ct){return ct.replace(/{([^{}]+)}/g,(ht,mt)=>mt in ot?String(ot[mt]):"")}(a.properties,tt)}createBucket(s){return new ew(s)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const s of ZE().paint.overridableProperties){if(!tw.hasPaintOverride(this.layout,s))continue;const a=this.paint.get(s),_=new Z2(a),j=new nx(_,a.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let tt=null;tt=a.value.kind==="constant"||a.value.kind==="source"?new a_("source",j):new hm("composite",j,a.value.zoomStops,a.value.interpolationType),this.paint._values[s]=new $m(a.property,tt,a.parameters)}}_handleOverridablePaintPropertyUpdate(s,a,_){return!(!this.layout||a.isDataDriven()||_.isDataDriven())&&tw.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,a){const _=s.get("text-field"),j=ZE().paint.properties[a];let tt=!1;const rt=ot=>{for(const ct of ot)if(j.overrides&&j.overrides.hasOverride(ct))return void(tt=!0)};if(_.value.kind==="constant"&&_.value.value instanceof Dr)rt(_.value.value.sections);else if(_.value.kind==="source"){const ot=ht=>{tt||(ht instanceof Pn&&_s(ht.value)===yp?rt(ht.value.sections):ht instanceof jo?rt(ht.sections):ht.eachChild(ot))},ct=_.value;ct._styleExpression&&ot(ct._styleExpression.expression)}return tt}getProgramIds(){return["symbol"]}getDefaultProgramParams(s,a,_){return{config:new Ym(this,{zoom:a,lut:_}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let X2,K2,Y2,Q2;var XE=zs([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function iw(d,s,a,_,j,tt,rt,ot){const ct=[d,s,1,a,_,1,j,tt,1],ht=[rt,ot,1],mt=bt([],ct),[gt,_t,Rt]=bo(ht,ht,mt);return kt(ct,ct,[gt,0,0,0,_t,0,0,0,Rt])}function J2(d,s,a,_,j,tt,rt,ot){const ct=function(ht,mt,gt,_t,Rt,Pt,zt,Vt){const Gt=iw(0,0,1,0,1,1,0,1),_i=iw(ht,mt,gt,_t,Rt,Pt,zt,Vt);return kt(_i,_i,bt([],Gt))}(d,s,a,_,j,tt,rt,ot);return[ct[2]/ct[8]/Rn,ct[5]/ct[8]/Rn]}function rw(d){return[d[0],Math.min(Math.max(d[1],-yr),yr)]}class eC extends kp{constructor(s,a,_,j){super(),this.id=s,this.dispatcher=_,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(j),this.options=a,this._dirty=!1}load(s,a){if(this._loaded=a||!1,this.fire(new au("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return s&&(this.coordinates=s),this._loaded=!0,void this._finishLoading();this._imageRequest=Mp(this.map._requestManager.transformRequest(this.url,ny.Image),(_,j)=>{this._imageRequest=null,this._loaded=!0,_?this.fire(new nm(_)):j&&(this.image=j instanceof HTMLImageElement?gu.getImageData(j):j,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}setTexture(s){if(!(s.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new o0(this.map.painter.context,s.handle),this.width=s.dimensions[0],this.height=s.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new au("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(s){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof o0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(s){if(this.coordinates=s,this._boundsArray=void 0,this._unsupportedCoords=!1,!s.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=s[0][1],_=s[0][1];for(const tt of s)tt[1]>_&&(_=tt[1]),tt[1]<a&&(a=tt[1]);const j=(_+a)/2;if(j>yr?this.onNorthPole=!0:j<-yr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const tt=s.map(Yr.fromLngLat);this.tileID=function(rt){let ot=1/0,ct=1/0,ht=-1/0,mt=-1/0;for(const zt of rt)ot=Math.min(ot,zt.x),ct=Math.min(ct,zt.y),ht=Math.max(ht,zt.x),mt=Math.max(mt,zt.y);const gt=Math.max(ht-ot,mt-ct),_t=Math.max(0,Math.floor(-Math.log2(gt))),Rt=Math.pow(2,_t);let Pt=Math.floor((ot+ht)/2*Rt);return Pt>1&&(Pt-=1),new Vp(_t,Pt,Math.floor((ct+mt)/2*Rt))}(tt),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new au("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof o0||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(s){for(const Gt in this.tiles){const _i=this.tiles[Gt];_i.state!=="loaded"&&(_i.state="loaded",_i.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=m0(new Vp(0,0,0),this.map.transform.projection),_=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(Gt){const _i=Gt[1].x-Gt[0].x,er=Gt[1].y-Gt[0].y,rr=Gt[2].x-Gt[1].x,_r=Gt[2].y-Gt[1].y,xr=Gt[3].x-Gt[2].x,Er=Gt[3].y-Gt[2].y,Ar=Gt[0].x-Gt[3].x,Pr=Gt[0].y-Gt[3].y,sn=_i*_r-rr*er,Fr=rr*Er-xr*_r,on=xr*Pr-Ar*Er,gn=Ar*er-_i*Pr;return sn>0&&Fr>0&&on>0&&gn>0||sn<0&&Fr<0&&on<0&&gn<0}(_))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const j=m0(this.tileID,this.map.transform.projection),[tt,rt,ot,ct]=this.coordinates.map(Gt=>{const _i=j.projection.project(Gt[0],Gt[1]);return B2(j,_i)._round()});this.perspectiveTransform=J2(tt.x,tt.y,rt.x,rt.y,ot.x,ot.y,ct.x,ct.y);const ht=this._boundsArray=new Zm;ht.emplaceBack(tt.x,tt.y,0,0),ht.emplaceBack(rt.x,rt.y,Rn,0),ht.emplaceBack(ct.x,ct.y,0,Rn),ht.emplaceBack(ot.x,ot.y,Rn,Rn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=s.createVertexBuffer(ht,XE.members),this.boundsSegments=Bo.simpleSegment(0,0,4,2);const mt=[],gt=[rw((_t=this.coordinates)[0]),rw(_t[1]),rw(_t[2]),rw(_t[3])];var _t;const[Rt,Pt,zt,Vt]=function(Gt){let _i=Gt[0][0],er=_i,rr=Gt[0][1],_r=rr;for(let xr=1;xr<Gt.length;xr++)Gt[xr][0]<_i?_i=Gt[xr][0]:Gt[xr][0]>er&&(er=Gt[xr][0]),Gt[xr][1]<rr?rr=Gt[xr][1]:Gt[xr][1]>_r&&(_r=Gt[xr][1]);return[_i,rr,er-_i,_r-rr]}(gt);{const Gt=new Zm,[_i,er,rr,_r]=function(tn){let dn=tn[0].x,qr=dn,Gr=tn[0].y,wn=Gr;for(let _n=1;_n<tn.length;_n++)tn[_n].x<dn?dn=tn[_n].x:tn[_n].x>qr&&(qr=tn[_n].x),tn[_n].y<Gr?Gr=tn[_n].y:tn[_n].y>wn&&(wn=tn[_n].y);return[dn,Gr,qr-dn,wn-Gr]}(_),xr=tn=>[(tn.x-_i)/rr,(tn.y-er)/_r],[Er,Ar,Pr,sn]=_.map(xr),Fr=function(tn,dn,qr,Gr,wn,_n,Yn,jn){const Bn=iw(0,0,1,0,1,1,0,1);return kt(Bn,Bn,bt([],iw(tn,dn,qr,Gr,wn,_n,Yn,jn)))}(Er[0],Er[1],Ar[0],Ar[1],Pr[0],Pr[1],sn[0],sn[1]);this.elevatedGlobePerspectiveTransform=J2(Er[0],Er[1],Ar[0],Ar[1],Pr[0],Pr[1],sn[0],sn[1]);const on=(tn,dn)=>{mt.push(tn.lng);const qr=Math.round((tn.lng-Rt)/zt*Rn),Gr=Math.round((tn.lat-Pt)/Vt*Rn),wn=xr(dn),_n=bo([],[wn[0],wn[1],1],Fr),Yn=Math.round(_n[0]/_n[2]*Rn),jn=Math.round(_n[1]/_n[2]*Rn);Gt.emplaceBack(qr,Gr,Yn,jn)},gn=_[3].x-_[0].x,an=_[3].y-_[0].y,hn=_[2].x-_[1].x,vn=_[2].y-_[1].y;for(let tn=0;tn<65;tn++){const dn=tn/64,qr=[_[0].x+dn*gn,_[0].y+dn*an],Gr=[_[1].x+dn*hn,_[1].y+dn*vn],wn=Gr[0]-qr[0],_n=Gr[1]-qr[1];for(let Yn=0;Yn<65;Yn++){const jn=Yn/64,Bn={x:qr[0]+wn*jn,y:qr[1]+_n*jn};on(a.projection.unproject(Bn.x,Bn.y),Bn)}}this.elevatedGlobeVertexBuffer=s.createVertexBuffer(Gt,XE.members)}{this.maxLongitudeTriangleSize=0;let Gt=[],_i=new Dl;const er=(rr,_r,xr)=>{_i.emplaceBack(rr,_r,xr);const Er=mt[rr],Ar=mt[_r],Pr=mt[xr],sn=Math.min(Math.min(Er,Ar),Pr),Fr=Math.max(Math.max(Er,Ar),Pr)-sn;Fr>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Fr),Gt.push(sn+Fr/2)};for(let rr=0;rr<64;rr++)for(let _r=0;_r<64;_r++){const xr=65*rr+_r,Er=xr+1,Ar=xr+65,Pr=Ar+1;er(xr,Ar,Er),er(Er,Ar,Pr)}[Gt,_i]=function(rr,_r){const xr=Array.from({length:rr.length},(Pr,sn)=>sn);xr.sort((Pr,sn)=>rr[Pr]-rr[sn]);const Er=[],Ar=new Dl;for(let Pr=0;Pr<xr.length;Pr++){const sn=xr[Pr];Er.push(rr[sn]);const Fr=3*sn,on=Fr+1;Ar.emplaceBack(_r.uint16[Fr],_r.uint16[on],_r.uint16[on+1])}return[Er,Ar]}(Gt,_i),this.elevatedGlobeTrianglesCenterLongitudes=Gt,this.elevatedGlobeIndexBuffer=s.createIndexBuffer(_i)}this.elevatedGlobeSegments=Bo.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,zt/Rn,0,Vt/Rn,0,0,Pt,Rt,0])}prepare(){const s=Object.keys(this.tiles).length!==0;if(this.tileID&&!s)return;const a=this.map.painter.context,_=a.gl;!this._dirty||this.texture instanceof o0||(this.texture?this.texture.update(this.image):(this.texture=new EE(a,this.image,_.RGBA8),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE)),this._dirty=!1),s&&this._prepareData(a)}loadTile(s,a){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},a(null)):(s.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(s){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const _=this.elevatedGlobeTrianglesCenterLongitudes;let j=(tt=s+180)+360*Math.round((_[0]-tt)/360);var tt;const rt=new Bo,ot=(gt,_t)=>{rt.segments.push({vertexOffset:0,primitiveOffset:gt,vertexLength:a.segments[0].vertexLength,primitiveLength:_t,sortKey:void 0,vaos:{}})},ct=.51*this.maxLongitudeTriangleSize;if(Math.abs(_[0]-j)<=ct){const gt=qo(_,0,_.length,j+ct);return gt===_.length||ot(gt,po(_,gt+1,_.length,j+360-ct)-gt),rt}j<_[0]&&(j+=360);const ht=po(_,0,_.length,j-ct);if(ht===_.length)return ot(0,_.length),rt;ot(0,ht-0);const mt=qo(_,ht+1,_.length,j+ct);return mt!==_.length&&ot(mt,_.length-mt),rt}}const LP=(Math.pow(256,2)-1)/16907520;class tC extends lu{constructor(s,a,_,j){super(s,{layout:Y2||(Y2=new $o({visibility:new En(jr.layout_raster.visibility)})),paint:Q2||(Q2=new $o({"raster-opacity":new En(jr.paint_raster["raster-opacity"]),"raster-color":new Ry(jr.paint_raster["raster-color"]),"raster-color-mix":new En(jr.paint_raster["raster-color-mix"]),"raster-color-range":new En(jr.paint_raster["raster-color-range"]),"raster-hue-rotate":new En(jr.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new En(jr.paint_raster["raster-brightness-min"]),"raster-brightness-max":new En(jr.paint_raster["raster-brightness-max"]),"raster-saturation":new En(jr.paint_raster["raster-saturation"]),"raster-contrast":new En(jr.paint_raster["raster-contrast"]),"raster-resampling":new En(jr.paint_raster["raster-resampling"]),"raster-fade-duration":new En(jr.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new En(jr.paint_raster["raster-emissive-strength"]),"raster-array-band":new En(jr.paint_raster["raster-array-band"]),"raster-elevation":new En(jr.paint_raster["raster-elevation"]),"raster-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},a,_,j),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(s){return!(s&&s._source instanceof eC&&(s._source.onNorthPole||s._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(s){s!=="raster-color"&&s!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(s){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[_,j]=s||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(_)&&isNaN(j)||_===this._curRampRange[0]&&j===this._curRampRange[1]||(this.colorRamp=Hv({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:_,end:j}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[_,j])}}let iC,rC,nC,sC,oC;class aC extends lu{constructor(s,a,_,j){super(s,{layout:iC||(iC=new $o({visibility:new En(jr["layout_raster-particle"].visibility)})),paint:rC||(rC=new $o({"raster-particle-array-band":new En(jr["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new En(jr["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ry(jr["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new En(jr["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new En(jr["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new En(jr["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new En(jr["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new En(jr["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},a,_,j),this._updateColorRamp(),this.lastInvalidatedAt=gu.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(s){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(s){return!1}_handleSpecialPaintPropertyUpdate(s){s!=="raster-particle-color"&&s!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),s==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const s=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Hv({expression:s,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=gu.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class jP extends lu{constructor(s,a){super(s,{},a,null),this.implementation=s,s.slot&&(this.slot=s.slot)}is3D(s){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(s){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)}onRemove(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)}}function KE(d,s,a){const _=[0,0,1],j=Vl([]);return Xl(j,j,a?-Lr(d)+Math.PI:Lr(d)),_a(j,j,-Lr(s)),Po(_,_,j),ss(_,_)}const lC={None:0,Model:1,Symbol:2,FillExtrusion:4};class nw{constructor(s,a,_,j){this.message=(s?`${s}: `:"")+_,j&&(this.identifier=j),a!=null&&a.__line__&&(this.line=a.__line__)}}function YE(d,s){const a=d.indexOf("://")===-1;try{return new URL(d,a&&s?"http://example.com":void 0),!0}catch{return!1}}class cC{constructor(s,a){this.feature=s,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class uC{constructor(){this.instancedDataArray=new Nv,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class QE{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=s.projection,this.index=s.index,this.worldview=s.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=s.styleDefinedModelURLs}updateFootprints(s,a){}populate(s,a,_,j){this.tileToMeter=Nr(_);const tt=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:rt,id:ot,index:ct,sourceLayerIndex:ht}of s){const mt=ot??(rt.properties&&rt.properties.hasOwnProperty("id")?rt.properties.id:void 0),gt=xn(rt,tt);if(!this.layers[0]._featureFilter.filter(new yo(this.zoom,{worldview:this.worldview}),gt,_))continue;const _t={id:mt,sourceLayerIndex:ht,index:ct,geometry:tt?gt.geometry:Ln(rt,_,j),properties:rt.properties,type:rt.type,patterns:{}},Rt=this.addFeature(_t,_t.geometry,gt);Rt&&a.featureIndex.insert(rt,_t.geometry,ct,ht,this.index,this.instancesPerModel[Rt].instancedDataArray.length,Rn/32)}this.lookup=null}update(s,a,_,j){for(const tt in this.instancesPerModel){const rt=this.instancesPerModel[tt];for(const ot in s)rt.idToFeaturesIndex.hasOwnProperty(ot)&&(this.evaluate(rt.features[rt.idToFeaturesIndex[ot]],s[ot],rt,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let s=!1;for(const a in this.instancesPerModel){const _=this.instancesPerModel[a];for(const j of _.features){const tt=this.layers[0],rt=j.feature,ot=this.canonical,ct=tt.paint.get("model-rotation").evaluate(rt,{},ot),ht=tt.paint.get("model-scale").evaluate(rt,{},ot),mt=tt.paint.get("model-translation").evaluate(rt,{},ot);Jn(j.rotation,ct)&&Jn(j.scale,ht)&&Jn(j.translation,mt)||(this.evaluate(j,j.featureStates,_,!0),s=!0)}}return s}updateReplacement(s,a,_,j){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const tt=a.getReplacementRegionsForTile(s.toUnwrapped(),!0);if(I1(this.activeReplacements,tt))return!1;this.activeReplacements=tt;let rt=!1;for(const ot in this.instancesPerModel){const ct=this.instancesPerModel[ot],ht=ct.instancedDataArray;for(const mt of ct.features){const gt=mt.instancedDataOffset,_t=mt.instancedDataCount;for(let Rt=0;Rt<_t;Rt++){const Pt=16*(Rt+gt);let zt=ht.float32[Pt+0];const Vt=zt>Rn;zt=Vt?zt-Rn:zt;const Gt=Math.floor(zt),_i=ht.float32[Pt+1];let er=!1;for(const rr of this.activeReplacements)if(!KT(rr,_,lC.Model,j)&&!(rr.min.x>Gt||Gt>rr.max.x||rr.min.y>_i||_i>rr.max.y)&&(er=hE(eS(Gt,_i,s.canonical,rr.footprintTileId.canonical),rr.footprint),er))break;ht.float32[Pt]=er?zt+Rn:zt,rt=rt||er!==Vt}}}return rt}isEmpty(){for(const s in this.instancesPerModel)if(this.instancesPerModel[s].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(s){if(!this.uploaded)for(const a in this.instancesPerModel){const _=this.instancesPerModel[a];_.instancedDataArray.length<0||_.instancedDataArray.length===0||(_.instancedDataBuffer?_.instancedDataBuffer.updateData(_.instancedDataArray):_.instancedDataBuffer=s.createVertexBuffer(_.instancedDataArray,uR.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const _=this.instancesPerModel[a];_.instancedDataArray.length!==0&&_.instancedDataBuffer&&_.instancedDataBuffer.destroy()}const s=this.layers[0].modelManager;if(s&&this.modelUris&&this.modelsRequested)for(const a of this.modelUris)s.removeModel(a,"",!0)}addFeature(s,a,_){const j=this.layers[0],tt=j.layout.get("model-id").evaluate(_,{},this.canonical);if(!tt)return Es(`modelId is not evaluated for layer ${j.id} and it is not going to get rendered.`),tt;(YE(tt,!1)||this.styleDefinedModelURLs[tt]!==void 0)&&(this.modelUris.includes(tt)||this.modelUris.push(tt)),this.instancesPerModel[tt]||(this.instancesPerModel[tt]=new uC);const rt=this.instancesPerModel[tt],ot=rt.instancedDataArray,ct=new cC(_,ot.length);for(const ht of a)for(const mt of ht){if(mt.x<0||mt.x>=Rn||mt.y<0||mt.y>=Rn)continue;if(this.lookupDim!==0){const _t=(this.lookupDim-1)/Rn,Rt=this.lookupDim*(mt.y*_t|0)+mt.x*_t|0;if(this.lookup){if(this.lookup[Rt]!==0)continue;this.lookup[Rt]=1}}this.instanceCount++;const gt=ot.length;ot.resize(gt+1),rt.instancesEvaluatedElevation.push(0),ot.float32[16*gt]=mt.x,ot.float32[16*gt+1]=mt.y}return ct.instancedDataCount=rt.instancedDataArray.length-ct.instancedDataOffset,ct.instancedDataCount>0&&(s.id&&(rt.idToFeaturesIndex[s.id]=rt.features.length),rt.features.push(ct),this.evaluate(ct,{},rt,!1)),tt}getModelUris(){return this.modelUris}evaluate(s,a,_,j){const tt=this.layers[0],rt=s.feature,ot=this.canonical,ct=s.rotation=tt.paint.get("model-rotation").evaluate(rt,a,ot),ht=s.scale=tt.paint.get("model-scale").evaluate(rt,a,ot),mt=s.translation=tt.paint.get("model-translation").evaluate(rt,a,ot),gt=tt.paint.get("model-color").evaluate(rt,a,ot);gt.a=tt.paint.get("model-color-mix-intensity").evaluate(rt,a,ot);const _t=[];this.maxVerticalOffset<mt[2]&&(this.maxVerticalOffset=mt[2]),this.maxScale=Math.max(Math.max(this.maxScale,ht[0]),Math.max(ht[1],ht[2])),jS(_t,ct,ht);const Rt=Math.round(100*gt.a)+gt.b/1.05;for(let Pt=0;Pt<s.instancedDataCount;++Pt){const zt=s.instancedDataOffset+Pt,Vt=16*zt,Gt=_.instancedDataArray.float32;let _i=0;j&&(_i=Gt[Vt+6]-_.instancesEvaluatedElevation[zt]);const er=0|Gt[Vt+1];Gt[Vt]=(0|Gt[Vt])+gt.r/1.05,Gt[Vt+1]=er+gt.g/1.05,Gt[Vt+2]=Rt,Gt[Vt+3]=1/(ot.z>10?this.tileToMeter:Nr(ot,er)),Gt[Vt+4]=mt[0],Gt[Vt+5]=mt[1],Gt[Vt+6]=mt[2]+_i,Gt[Vt+7]=_t[0],Gt[Vt+8]=_t[1],Gt[Vt+9]=_t[2],Gt[Vt+10]=_t[4],Gt[Vt+11]=_t[5],Gt[Vt+12]=_t[6],Gt[Vt+13]=_t[8],Gt[Vt+14]=_t[9],Gt[Vt+15]=_t[10],_.instancesEvaluatedElevation[zt]=mt[2]}}}let hC,dC;Fn(QE,"ModelBucket",{omit:["layers"]}),Fn(uC,"PerModelAttributes"),Fn(cC,"ModelFeature");class Gx{constructor(s,a,_){this._demTile=s,this._dem=this._demTile.dem,this._scale=a,this._offset=_}static create(s,a,_){const j=_||s.findDEMTileFor(a);if(!j||!j.dem)return;const tt=j.dem,rt=j.tileID,ot=1<<a.canonical.z-rt.canonical.z;return new Gx(j,tt.dim/Rn/ot,[(a.canonical.x/ot-rt.canonical.x)*tt.dim,(a.canonical.y/ot-rt.canonical.y)*tt.dim])}tileCoordToPixel(s,a){const _=a*this._scale+this._offset[1];return new yn(Math.floor(s*this._scale+this._offset[0]),Math.floor(_))}getElevationAt(s,a,_,j){const tt=s*this._scale+this._offset[0],rt=a*this._scale+this._offset[1],ot=Math.floor(tt),ct=Math.floor(rt),ht=this._dem;return j=!!j,_?ns(ns(ht.get(ot,ct,j),ht.get(ot,ct+1,j),rt-ct),ns(ht.get(ot+1,ct,j),ht.get(ot+1,ct+1,j),rt-ct),tt-ot):ht.get(ot,ct,j)}getElevationAtPixel(s,a,_){return this._dem.get(s,a,!!_)}getMeterToDEM(s){return(1<<this._demTile.tileID.canonical.z)*hr(1,s)*this._dem.stride}}const JE=new Float32Array(262144),R_=new Uint8Array(262144);function pC(d){let s=0;if(d.meshes)for(const a of d.meshes)s=Math.max(s,a.aabb.max[2]);if(d.children)for(const a of d.children)s=Math.max(s,pC(a));return s}function fC(d,s,a){if(d.meshes)for(const _ of d.meshes){if(_.aabb.min[0]===1/0)continue;const j=cs.applyTransform(_.aabb,d.matrix);a.insert(s,j.min[0],j.min[1],j.max[0],j.max[1])}if(d.children)for(const _ of d.children)fC(_,s,a)}const mC=["","wall","door","roof","window","lamp","logo"];class gC{constructor(s){this.node=s,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:s.id,geometry:[],properties:{height:pC(s)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new cs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let s=0;const a=new cs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const _ of this.node.meshes)this.node.lightMeshIndex!==s&&(_.transformedAabb=cs.applyTransformFast(_.aabb,this.node.matrix),a.encapsulate(_.transformedAabb)),s++;this.aabb=a}return this.aabb}}class sw{constructor(s,a,_,j,tt,rt,ot,ct){this.id=_,this.layers=s,this.layerIds=this.layers.map(ht=>ht.fqid),this.stateDependentLayerIds=this.layers.filter(ht=>ht.isStateDependent()).map(ht=>ht.id),this.modelTraits|=Ox.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,j&&(this.modelTraits|=Ox.HasMapboxMeshFeatures),tt&&(this.modelTraits|=Ox.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=rt,this.worldview=ct,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const ht of a)this.nodesInfo.push(new gC(ht)),fC(ht,ot.featureIndexArray.length,ot.grid),ot.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,ot.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(s,a){for(const _ of this.getNodesInfo()){const j=_.node;j.footprint&&a.push({footprint:j.footprint,id:s})}}update(s){const a=Object.keys(s).length!==0;if(a&&!this.stateDependentLayers.length)return;const _=a?this.stateDependentLayers:this.layers;if(!qu(s,this.states))for(const j of _)this.evaluate(j,s);this.states=structuredClone(s)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(s){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const _ of a){const j=_.node;this.uploaded?this.updatePbrBuffer(j):CE(j,s,!0)}for(const _ of a)B1(_.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(s){let a=!1;if(!s.meshes)return a;for(const _ of s.meshes)_.pbrBuffer&&(_.pbrBuffer.updateData(_.featureArray),a=!0);return a}needsReEvaluation(s,a,_){const j=s.transform.projectionOptions,tt=s.style.getBrightness(),rt=this.brightness!==tt;if(!this.uploaded||this.dirty||j.name!==this.projection.name||v0(_.paint.get("model-color").value,rt)||v0(_.paint.get("model-color-mix-intensity").value,rt)||v0(_.paint.get("model-roughness").value,rt)||v0(_.paint.get("model-emissive-strength").value,rt)||v0(_.paint.get("model-height-based-emissive-strength-multiplier").value,rt)){this.projection=j,this.brightness=tt;const ot=this.getNodesInfo();for(const ct of ot)ct.state=null;return!0}return!1}evaluateTransform(s,a){if(s.transform.zoom===this.zoom)return;this.zoom=s.transform.zoom;const _=this.getNodesInfo(),j=this.id.canonical;for(const tt of _){const rt=tt.feature;tt.evaluatedTranslation=a.paint.get("model-translation").evaluate(rt,{},j),tt.evaluatedScale=a.paint.get("model-scale").evaluate(rt,{},j)}}evaluate(s,a){const _=this.getNodesInfo();for(const j of _){if(!j.node.meshes)continue;const tt=j.feature,rt=a&&a[tt.id];if(qu(rt,j.state))continue;j.state=structuredClone(rt);const ot=j.node.meshes&&j.node.meshes[0].featureData,ct=j.evaluatedColor[2],ht=j.evaluatedRMEA[2],mt=this.id.canonical;if(j.hasTranslucentParts=!1,ot){for(let gt=0;gt<mC.length;gt++){const _t=mC[gt];_t.length&&(tt.properties.part=_t);const Rt=s.paint.get("model-color").evaluate(tt,rt,mt).toPremultipliedRenderColor(null),Pt=s.paint.get("model-color-mix-intensity").evaluate(tt,rt,mt);j.evaluatedColor[gt]=[Rt.r,Rt.g,Rt.b,Pt],j.evaluatedRMEA[gt][0]=s.paint.get("model-roughness").evaluate(tt,rt,mt),j.evaluatedRMEA[gt][2]=s.paint.get("model-emissive-strength").evaluate(tt,rt,mt),j.evaluatedRMEA[gt][3]=Rt.a,j.emissionHeightBasedParams[gt]=s.paint.get("model-height-based-emissive-strength-multiplier").evaluate(tt,rt,mt),!j.hasTranslucentParts&&Rt.a<1&&(j.hasTranslucentParts=!0)}delete tt.properties.part,OP(j,ct!==j.evaluatedColor[2]||ht!==j.evaluatedRMEA[2],this.modelTraits)}else j.evaluatedRMEA[0][2]=s.paint.get("model-emissive-strength").evaluate(tt,rt,mt);j.evaluatedTranslation=s.paint.get("model-translation").evaluate(tt,rt,mt),j.evaluatedScale=s.paint.get("model-scale").evaluate(tt,rt,mt),this.updatePbrBuffer(j.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(s,a,_,j){const tt=s.findDEMTileFor(_);if(tt&&(tt.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(tt.dem&&tt.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=tt.tileID.overscaledZ;const rt=Gx.create(s,_,tt);if(!rt)return;this.modelTraits&Ox.HasMapboxMeshFeatures&&this.updateDEM(s,rt,_,j);for(const ot of this.getNodesInfo()){const ct=ot.node;if(!ct.footprint||!ct.footprint.vertices||!ct.footprint.vertices.length)continue;const ht=ct.footprint.vertices;let mt=rt.getElevationAt(ht[0].x,ht[0].y,!0,!0);for(let gt=1;gt<ht.length;gt++)mt=Math.min(mt,rt.getElevationAt(ht[gt].x,ht[gt].y,!0,!0));ct.elevation=mt}}this.terrainTile=tt.tileID.canonical,this.terrainExaggeration=a}}updateDEM(s,a,_,j){let tt=a._dem._modifiedForSources[j];if(tt===void 0&&(a._dem._modifiedForSources[j]=[],tt=a._dem._modifiedForSources[j]),tt.includes(_.canonical))return;const rt=a._dem.dim;tt.push(_.canonical);let ot=!1;for(const ct of this.getNodesInfo()){const ht=ct.node;if(!ht.footprint||!ht.footprint.grid)continue;const mt=ht.footprint.grid,gt=a.tileCoordToPixel(mt.min.x,mt.min.y),_t=a.tileCoordToPixel(mt.max.x,mt.max.y),Rt=Math.min(Math.min(rt-_t.y,gt.x),Math.min(gt.y,rt-_t.x));if(Rt<0)continue;const Pt=fr(Rt,2,5);let zt=Math.max(0,gt.x-Pt),Vt=Math.max(0,gt.y-Pt),Gt=Math.min(_t.x+Pt,rt-1),_i=Math.min(_t.y+Pt,rt-1);for(let xr=Vt;xr<=_i;++xr)for(let Er=zt;Er<=Gt;++Er)R_[xr*rt+Er]=255;let er=0,rr=0;for(let xr=0;xr<mt.cellsY;++xr)for(let Er=0;Er<mt.cellsX;++Er){if(!mt.cells[xr*mt.cellsX+Er])continue;const Ar=a.tileCoordToPixel(mt.min.x+Er/mt.xScale,mt.min.y+xr/mt.yScale),Pr=a.tileCoordToPixel(mt.min.x+(Er+1)/mt.xScale,mt.min.y+(xr+1)/mt.yScale);for(let sn=Ar.y;sn<=Math.min(Pr.y+1,rt-1);++sn)for(let Fr=Ar.x;Fr<=Math.min(Pr.x+1,rt-1);++Fr)R_[sn*rt+Fr]===255&&(R_[sn*rt+Fr]=0,er+=a.getElevationAtPixel(Fr,sn),rr++)}const _r=er/rr;zt=Math.max(1,gt.x-Pt),Vt=Math.max(1,gt.y-Pt),Gt=Math.min(_t.x+Pt,rt-2),_i=Math.min(_t.y+Pt,rt-2),ot=!0;for(let xr=Vt;xr<=_i;++xr)for(let Er=zt;Er<=Gt;++Er)R_[xr*rt+Er]===0&&(JE[xr*rt+Er]=a._dem.set(Er,xr,_r));for(let xr=1;xr<Pt;++xr){zt=Math.max(1,gt.x-xr),Vt=Math.max(1,gt.y-xr),Gt=Math.min(_t.x+xr,rt-2),_i=Math.min(_t.y+xr,rt-2);for(let Er=Vt;Er<=_i;++Er)for(let Ar=zt;Ar<=Gt;++Ar){const Pr=Er*rt+Ar;if(R_[Pr]===255){let sn=0,Fr=0,on=-1,gn=-1;for(let an=-1;an<=1;++an)for(let hn=-1;hn<=1;++hn){const vn=(Er+an)*rt+Ar+hn;if(R_[vn]>=xr)continue;const tn=JE[vn],dn=Math.abs(tn);dn>Fr&&(sn=tn,Fr=dn,on=hn,gn=an)}if(Fr>.1){const an=1-(xr+.5*Math.abs(on*gn))/Pt;let hn=a._dem.get(Ar,Er)+sn*an;const vn=a._dem.get(Ar+on,Er+gn),tn=a._dem.get(Ar-on,Er-gn,!0);(hn-vn)*(hn-tn)>0&&(hn=(vn+tn)/2),JE[Pr]=a._dem.set(Ar,Er,hn),R_[Pr]=xr}}}}}ot&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=gu.now())}setFilter(s){this.filter=s?c_(s):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(s=>this.filter.filter(new yo(this.id.overscaledZ,{worldview:this.worldview}),s.feature,this.id.canonical)):this.nodesInfo}destroy(){const s=this.getNodesInfo();for(const a of s)B1(a.node),AE(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(s,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const _=a.getReplacementRegionsForTile(s.toUnwrapped());for(const j of this.getNodesInfo()){const tt=j.node.footprint;j.hiddenByReplacement=!!tt&&!_.find(rt=>rt.footprint===tt)}}getHeightAtTileCoord(s,a){const _=[],j=[0,0,0],tt=At([]);for(const rt of this.getNodesInfo()){const ot=rt.node.meshes[0],ct=ot.transformedAabb;if(s<ct.min[0]||a<ct.min[1]||s>ct.max[0]||a>ct.max[1])continue;if(rt.node.hidden===!0)return{height:1/0,maxHeight:rt.feature.properties.height,hidden:!1,verticalScale:rt.evaluatedScale[2]};Bt(tt,rt.node.matrix),j[0]=s,j[1]=a,Vs(j,j,tt);const ht=(j[0]-ot.aabb.min[0])/(ot.aabb.max[0]-ot.aabb.min[0])*S_|0,mt=Math.min(63,(j[1]-ot.aabb.min[1])/(ot.aabb.max[1]-ot.aabb.min[1])*S_|0)*S_+Math.min(63,ht),gt=ot.heightmap[mt];if(!(gt<0&&rt.node.footprint))return rt.hiddenByReplacement?void 0:{height:gt,maxHeight:rt.feature.properties.height,hidden:!1,verticalScale:rt.evaluatedScale[2]};if(rt.node.footprint.grid.query(new yn(s,a),new yn(s,a),_),_.length>0)return{height:void 0,maxHeight:rt.feature.properties.height,hidden:rt.hiddenByReplacement,verticalScale:rt.evaluatedScale[2]}}}}function v0(d,s){return d instanceof a_&&!d.isLightConstant&&s}function FP(d,s,a,_,j,tt,rt,ot){let ct=(61440&s|(61440&s)>>4)>>8,ht=(3840&s|(3840&s)>>4)>>4,mt=240&s|(240&s)>>4;a[3]>0&&(ct=ns(ct,255*a[0],a[3]),ht=ns(ht,255*a[1],a[3]),mt=ns(mt,255*a[2],a[3]));const gt=ct<<8|ht,_t=mt<<8|Math.floor(255*_[3]),Rt=function(xr){const Er=fr(xr,0,2);return Math.min(Math.round(.5*Er*255),255)}(_[2])<<8|15*_[0]<<4|15*_[1],Pt=fr(j[0],0,1),zt=fr(j[1],0,1),Vt=fr(j[2],0,1),Gt=fr(j[3],0,1);let _i,er,rr,_r;if(Pt!==zt&&rt!==tt&&zt!==Pt){const xr=rt-tt;er=1/(xr*(zt-Pt)),rr=-(tt+xr*Pt)/(xr*(zt-Pt));const Er=fr(j[4],-1,1);_r=Math.pow(10,Er),_i=255*Vt<<8|255*Gt}else _i=65535,er=0,rr=1,_r=1;if(d.emplaceBack(gt,_t,Rt,_i,er,rr,_r),ot){const xr=ot.length;ot.clear();for(let Er=0;Er<xr;Er++)ot.emplaceBack(gt,_t,Rt,_i,er,rr,_r)}}function OP(d,s,a){const _=d.node;let j=0;const tt=a&Ox.HasMeshoptCompression;for(const rt of _.meshes){if(_.lights&&_.lightMeshIndex===j||!rt.featureData)continue;rt.featureArray=new Fy,rt.featureArray.reserve(rt.featureData.length);let ot=s;for(const ct of rt.featureData){const ht=tt?65535&ct:ct>>16&65535,mt=tt?ct>>16&65535:65535&ct,gt=(15&mt)<8?15&mt:0,_t=d.evaluatedRMEA[gt],Rt=d.evaluatedColor[gt],Pt=d.emissionHeightBasedParams[gt];let zt;if(ot&&gt===2&&_.lights&&(zt=new Fy,zt.resize(10*_.lights.length)),FP(rt.featureArray,ht,Rt,_t,Pt,rt.aabb.min[2],rt.aabb.max[2],zt),zt&&ot){ot=!1;const Vt=_.meshes[_.lightMeshIndex];Vt.featureArray=zt,Vt.featureArray._trim()}}rt.featureArray._trim(),j++}}function yC(d,s,a,_){const j=1<<d.z;s.lat=dr((_/Rn+d.y)/j),s.lng=gr((a/Rn+d.x)/j)}function zP(d,s,a,_){const j=d.getNodesInfo()[s];if(!j||j.hiddenByReplacement||!j.node.meshes)return;let tt=Number.MAX_VALUE;const rt=j.node,ot=a.tile,ct=_.calculatePosMatrix(ot.tileID.toUnwrapped(),_.worldSize),ht=j.evaluatedScale;let mt=0;_.elevation&&rt.elevation&&(mt=rt.elevation*_.elevation.exaggeration()),It(ct,ct,[(rt.anchor?rt.anchor[0]:0)*(ht[0]-1),(rt.anchor?rt.anchor[1]:0)*(ht[1]-1),mt]),St(ct,ct,ht);const gt=a.queryGeometry,_t=gt.isPointQuery()?gt.screenBounds:gt.screenGeometry,Rt=function(zt){const Vt=Tt([],ct,zt.matrix);Tt(Vt,_.expandedFarZProjMatrix,Vt);for(let Gt=0;Gt<zt.meshes.length;++Gt){const _i=zt.meshes[Gt];if(Gt===zt.lightMeshIndex)continue;const er=FS(_t,_,Vt,_i.aabb);er!=null&&(tt=Math.min(er,tt))}if(zt.children)for(const Gt of zt.children)Rt(Gt)};if(Rt(rt),tt===Number.MAX_VALUE)return;const Pt=new Ot(0,0);return yC(ot.tileID.canonical,Pt,j.node.anchor[0],j.node.anchor[1]),{intersectionZ:tt,position:Pt,feature:j.feature}}Fn(sw,"Tiled3dModelBucket",{omit:["layers"]}),Fn(gC,"Tiled3dModelFeature");const NP={circle:class extends lu{constructor(d,s,a,_){super(d,{layout:zy||(zy=new $o({"circle-sort-key":new Dn(jr.layout_circle["circle-sort-key"]),"circle-elevation-reference":new En(jr.layout_circle["circle-elevation-reference"]),visibility:new En(jr.layout_circle.visibility)})),paint:Bp||(Bp=new $o({"circle-radius":new Dn(jr.paint_circle["circle-radius"]),"circle-color":new Dn(jr.paint_circle["circle-color"]),"circle-blur":new Dn(jr.paint_circle["circle-blur"]),"circle-opacity":new Dn(jr.paint_circle["circle-opacity"]),"circle-translate":new En(jr.paint_circle["circle-translate"]),"circle-translate-anchor":new En(jr.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new En(jr.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new En(jr.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Dn(jr.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Dn(jr.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Dn(jr.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new En(jr.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},s,a,_)}createBucket(d){return new Wl(d)}queryRadius(d){const s=d;return up("circle-radius",this,s)+up("circle-stroke-width",this,s)+vm(this.paint.get("circle-translate"))}queryIntersectsFeature(d,s,a,_,j,tt,rt,ot){const ct=Tp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),tt.angle,d.pixelToTileUnitsFactor),ht=this.paint.get("circle-radius").evaluate(s,a)+this.paint.get("circle-stroke-width").evaluate(s,a);return ET(d,_,tt,rt,ot,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",ct,ht)}getProgramIds(){return["circle"]}getDefaultProgramParams(d,s,a){const _=wT(this);return{config:new Ym(this,{zoom:s,lut:a}),defines:_,overrideFog:!1}}is3D(d){return!d&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends lu{createBucket(d){return new ST(d)}constructor(d,s,a,_){super(d,{layout:CT||(CT=new $o({visibility:new En(jr.layout_heatmap.visibility)})),paint:AT||(AT=new $o({"heatmap-radius":new Dn(jr.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Dn(jr.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new En(jr.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ry(jr.paint_heatmap["heatmap-color"]),"heatmap-opacity":new En(jr.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},s,a,_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(d){d==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Hv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(d){return up("heatmap-radius",this,d)}queryIntersectsFeature(d,s,a,_,j,tt,rt,ot){const ct=this.paint.get("heatmap-radius").evaluate(s,a);return ET(d,_,tt,rt,ot,!0,!0,new yn(0,0),ct)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(d,s,a){return d==="heatmap"?{config:new Ym(this,{zoom:s,lut:a}),overrideFog:!1}:{}}},hillshade:class extends lu{constructor(d,s,a,_){super(d,{layout:RT||(RT=new $o({visibility:new En(jr.layout_hillshade.visibility)})),paint:PT||(PT=new $o({"hillshade-illumination-direction":new En(jr.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new En(jr.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new En(jr.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new En(jr.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new En(jr.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new En(jr.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new En(jr.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},s,a,_)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(d,s,a){return{overrideFog:!1}}},fill:class extends lu{constructor(d,s,a,_){super(d,{layout:$T||($T=new $o({"fill-sort-key":new Dn(jr.layout_fill["fill-sort-key"]),visibility:new En(jr.layout_fill.visibility),"fill-elevation-reference":new En(jr.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Dn(jr.layout_fill["fill-construct-bridge-guard-rail"])})),paint:HT||(HT=new $o({"fill-antialias":new En(jr.paint_fill["fill-antialias"]),"fill-opacity":new Dn(jr.paint_fill["fill-opacity"]),"fill-color":new Dn(jr.paint_fill["fill-color"]),"fill-outline-color":new Dn(jr.paint_fill["fill-outline-color"]),"fill-translate":new En(jr.paint_fill["fill-translate"]),"fill-translate-anchor":new En(jr.paint_fill["fill-translate-anchor"]),"fill-pattern":new Dn(jr.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new En(jr.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new En(jr.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Dn(jr.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Dn(jr.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Dn(jr.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},s,a,_)}getProgramIds(){const d=this.paint.get("fill-pattern"),s=d&&d.constantOr(1),a=[s?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(s&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(d,s,a){return{config:new Ym(this,{zoom:s,lut:a}),overrideFog:!1}}recalculate(d,s){super.recalculate(d,s);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(d){return new lE(d)}queryRadius(){return vm(this.paint.get("fill-translate"))}queryIntersectsFeature(d,s,a,_,j,tt){return!d.queryGeometry.isAboveHorizon&&Au(bm(d.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),tt.angle,d.pixelToTileUnitsFactor),_)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(d){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const s=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return d!=null?s&&!d:s}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends lu{constructor(d,s,a,_){super(d,{layout:fS||(fS=new $o({visibility:new En(jr["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new En(jr["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:mS||(mS=new $o({"fill-extrusion-opacity":new En(jr["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Dn(jr["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new En(jr["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new En(jr["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Dn(jr["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new En(jr["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Dn(jr["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Dn(jr["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new En(jr["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new En(jr["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new En(jr["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new En(jr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new En(jr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new En(jr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new En(jr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new En(jr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new En(jr["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new En(jr["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Dn(jr["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Dn(jr["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new En(jr["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new En(jr["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new En(jr["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new En(jr["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Dn(jr["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Dn(jr["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new En(jr["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},s,a,_),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new k1(d)}queryRadius(){return vm(this.paint.get("fill-extrusion-translate"))}is3D(d){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(d,s,a,_,j,tt,rt,ot,ct){const ht=Tp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),tt.angle,d.pixelToTileUnitsFactor),mt=this.paint.get("fill-extrusion-height").evaluate(s,a),gt=this.paint.get("fill-extrusion-base").evaluate(s,a),_t=[0,0],Rt=ot&&tt.elevation,Pt=tt.elevation?tt.elevation.exaggeration():1,zt=d.tile.getBucket(this);if(Rt&&zt instanceof k1){const rr=zt.centroidVertexArray,_r=ct+1;_r<rr.length&&(_t[0]=rr.geta_centroid_pos0(_r),_t[1]=rr.geta_centroid_pos1(_r))}if(_t[0]===0&&_t[1]===1)return!1;tt.projection.name==="globe"&&(_=pS([_],[new yn(0,0),new yn(Rn,Rn)],d.tileID.canonical).map(rr=>rr.polygon).flat());const Vt=Rt?ot:null,[Gt,_i]=function(rr,_r,xr,Er,Ar,Pr,sn,Fr,on,gn,an){return rr.projection.name==="globe"?function(hn,vn,tn,dn,qr,Gr,wn,_n,Yn,jn,Bn){const An=[],Kn=[],ps=hn.projection.upVectorScale(Bn,hn.center.lat,hn.worldSize).metersToTile,kn=[0,0,0,1],$n=[0,0,0,1],ls=(Is,xs,Nn,ys)=>{Is[0]=xs,Is[1]=Nn,Is[2]=ys,Is[3]=1},ms=dS();tn>0&&(tn+=ms),dn+=ms;for(const Is of vn){const xs=[],Nn=[];for(const ys of Is){const Bs=ys.x+qr.x,or=ys.y+qr.y,ar=hn.projection.projectTilePoint(Bs,or,Bn),Wr=hn.projection.upVector(Bn,ys.x,ys.y);let nn=tn,Mn=dn;if(wn){const In=bS(Bs,or,tn,dn,wn,_n,Yn,jn);nn+=In.base,Mn+=In.top}tn!==0?ls(kn,ar.x+Wr[0]*ps*nn,ar.y+Wr[1]*ps*nn,ar.z+Wr[2]*ps*nn):ls(kn,ar.x,ar.y,ar.z),ls($n,ar.x+Wr[0]*ps*Mn,ar.y+Wr[1]*ps*Mn,ar.z+Wr[2]*ps*Mn),Vs(kn,kn,Gr),Vs($n,$n,Gr),xs.push(new E_(kn[0],kn[1],kn[2])),Nn.push(new E_($n[0],$n[1],$n[2]))}An.push(xs),Kn.push(Nn)}return[An,Kn]}(rr,_r,xr,Er,Ar,Pr,sn,Fr,on,gn,an):sn?function(hn,vn,tn,dn,qr,Gr,wn,_n,Yn){const jn=[],Bn=[],An=[0,0,0,1];for(const Kn of hn){const ps=[],kn=[];for(const $n of Kn){const ls=$n.x+dn.x,ms=$n.y+dn.y,Is=bS(ls,ms,vn,tn,Gr,wn,_n,Yn);An[0]=ls,An[1]=ms,An[2]=Is.base,An[3]=1,Uo(An,An,qr),An[3]=Math.max(An[3],1e-5);const xs=new E_(An[0]/An[3],An[1]/An[3],An[2]/An[3]);An[0]=ls,An[1]=ms,An[2]=Is.top,An[3]=1,Uo(An,An,qr),An[3]=Math.max(An[3],1e-5);const Nn=new E_(An[0]/An[3],An[1]/An[3],An[2]/An[3]);ps.push(xs),kn.push(Nn)}jn.push(ps),Bn.push(kn)}return[jn,Bn]}(_r,xr,Er,Ar,Pr,sn,Fr,on,gn):function(hn,vn,tn,dn,qr){const Gr=[],wn=[],_n=qr[8]*vn,Yn=qr[9]*vn,jn=qr[10]*vn,Bn=qr[11]*vn,An=qr[8]*tn,Kn=qr[9]*tn,ps=qr[10]*tn,kn=qr[11]*tn;for(const $n of hn){const ls=[],ms=[];for(const Is of $n){const xs=Is.x+dn.x,Nn=Is.y+dn.y,ys=qr[0]*xs+qr[4]*Nn+qr[12],Bs=qr[1]*xs+qr[5]*Nn+qr[13],or=qr[2]*xs+qr[6]*Nn+qr[14],ar=qr[3]*xs+qr[7]*Nn+qr[15],Wr=ys+_n,nn=Bs+Yn,Mn=or+jn,In=Math.max(ar+Bn,1e-5),zn=ys+An,es=Bs+Kn,Ms=or+ps,ks=Math.max(ar+kn,1e-5);ls.push(new E_(Wr/In,nn/In,Mn/In)),ms.push(new E_(zn/ks,es/ks,Ms/ks))}Gr.push(ls),wn.push(ms)}return[Gr,wn]}(_r,xr,Er,Ar,Pr)}(tt,_,gt,mt,ht,rt,Vt,_t,Pt,tt.center.lat,d.tileID.canonical),er=d.queryGeometry;return function(rr,_r,xr){let Er=1/0;Au(xr,_r)&&(Er=vS(xr,_r[0]));for(let Ar=0;Ar<_r.length;Ar++){const Pr=_r[Ar],sn=rr[Ar];for(let Fr=0;Fr<Pr.length-1;Fr++){const on=Pr[Fr],gn=[on,Pr[Fr+1],sn[Fr+1],sn[Fr],on];Bu(xr,gn)&&(Er=Math.min(Er,vS(xr,gn)))}}return Er!==1/0&&Er}(Gt,_i,er.isPointQuery()?er.screenBounds:er.screenGeometry)}},building:class extends lu{constructor(d,s,a,_){super(d,{layout:WS||(WS=new $o({visibility:new En(jr.layout_building.visibility),"building-facade":new Dn(jr.layout_building["building-facade"]),"building-facade-floors":new Dn(jr.layout_building["building-facade-floors"]),"building-facade-unit-width":new Dn(jr.layout_building["building-facade-unit-width"]),"building-facade-window":new Dn(jr.layout_building["building-facade-window"]),"building-roof-shape":new Dn(jr.layout_building["building-roof-shape"]),"building-height":new Dn(jr.layout_building["building-height"]),"building-base":new Dn(jr.layout_building["building-base"]),"building-flood-light-wall-radius":new Dn(jr.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Dn(jr.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Dn(jr.layout_building["building-flip-roof-orientation"])})),paint:qS||(qS=new $o({"building-opacity":new En(jr.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new En(jr.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new En(jr.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new En(jr.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new En(jr.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new En(jr.paint_building["building-vertical-scale"]),"building-cast-shadows":new En(jr.paint_building["building-cast-shadows"]),"building-color":new Dn(jr.paint_building["building-color"]),"building-emissive-strength":new Dn(jr.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new En(jr.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new En(jr.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new En(jr.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new En(jr.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new En(jr.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},s,a,_),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new HS(d)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(d){return!0}},line:class extends lu{constructor(d,s,a,_){const j=r2();super(d,j,s,a,_),j.layout&&(this.layout=new Hm(j.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(d){if(d==="line-gradient"){const s=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=s._styleExpression&&s._styleExpression.expression instanceof r_,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(d,s){super.recalculate(d,s),this.paint._values["line-floorwidth"]=(()=>{if(l0)return l0;const a=r2();return l0=new OR(a.paint.properties["line-width"].specification),l0.useIntegerZoom=!0,l0})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,d)}createBucket(d){return new ME(d)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(d,s,a){const _=t2(this);return{config:new Ym(this,{zoom:s,lut:a}),defines:_,overrideFog:!1}}queryRadius(d){const s=d,a=n2(up("line-width",this,s),up("line-gap-width",this,s)),_=up("line-offset",this,s);return a/2+Math.abs(_)+vm(this.paint.get("line-translate"))}queryIntersectsFeature(d,s,a,_,j,tt){if(d.queryGeometry.isAboveHorizon)return!1;const rt=bm(d.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),tt.angle,d.pixelToTileUnitsFactor),ot=d.pixelToTileUnitsFactor/2*n2(this.paint.get("line-width").evaluate(s,a),this.paint.get("line-gap-width").evaluate(s,a)),ct=this.paint.get("line-offset").evaluate(s,a);return ct&&(_=function(ht,mt){const gt=[],_t=new yn(0,0);for(let Rt=0;Rt<ht.length;Rt++){const Pt=ht[Rt],zt=[];for(let Vt=0;Vt<Pt.length;Vt++){const Gt=Pt[Vt],_i=Pt[Vt+1],er=Vt===0?_t:Gt.sub(Pt[Vt-1])._unit()._perp(),rr=Vt===Pt.length-1?_t:_i.sub(Gt)._unit()._perp(),_r=er._add(rr)._unit();_r._mult(1/(_r.x*rr.x+_r.y*rr.y)),zt.push(_r._mult(mt)._add(Gt))}gt.push(zt)}return gt}(_,ct*d.pixelToTileUnitsFactor)),function(ht,mt,gt){for(let _t=0;_t<mt.length;_t++){const Rt=mt[_t];if(ht.length>=3){for(let Pt=0;Pt<Rt.length;Pt++)if(Nl(ht,Rt[Pt]))return!0}if(Ru(ht,Rt,gt))return!0}return!1}(rt,_,ot)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(d){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:tw,background:class extends lu{constructor(d,s,a,_){super(d,{layout:X2||(X2=new $o({visibility:new En(jr.layout_background.visibility)})),paint:K2||(K2=new $o({"background-pitch-alignment":new En(jr.paint_background["background-pitch-alignment"]),"background-color":new En(jr.paint_background["background-color"]),"background-pattern":new En(jr.paint_background["background-pattern"]),"background-opacity":new En(jr.paint_background["background-opacity"]),"background-emissive-strength":new En(jr.paint_background["background-emissive-strength"]),"background-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},s,a,_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(d,s,a){return{overrideFog:!1}}is3D(d){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:tC,"raster-particle":aC,sky:class extends lu{constructor(d,s,a,_){super(d,{layout:nC||(nC=new $o({visibility:new En(jr.layout_sky.visibility)})),paint:sC||(sC=new $o({"sky-type":new En(jr.paint_sky["sky-type"]),"sky-atmosphere-sun":new En(jr.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new En(jr.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new En(jr.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new En(jr.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ry(jr.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new En(jr.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new En(jr.paint_sky["sky-atmosphere-color"]),"sky-opacity":new En(jr.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},s,a,_),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(d){d==="sky-gradient"?this._updateColorRamp():d!=="sky-atmosphere-sun"&&d!=="sky-atmosphere-halo-color"&&d!=="sky-atmosphere-color"&&d!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Hv({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(d){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const s=d.style.light.properties.get("position");return this._lightPosition.azimuthal!==s.azimuthal||this._lightPosition.polar!==s.polar}return!1}getCenter(d,s){if(this.paint.get("sky-type")==="atmosphere"){const _=this.paint.get("sky-atmosphere-sun"),j=!_,tt=d.style.light,rt=tt.properties.get("position");return j&&tt.properties.get("anchor")==="viewport"&&Es("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),j?KE(rt.azimuthal,90-rt.polar,s):KE(_[0],90-_[1],s)}const a=this.paint.get("sky-gradient-center");return KE(a[0],90-a[1],s)}isSky(){return!0}markSkyboxValid(d){this._skyboxInvalidated=!1,this._lightPosition=d.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const d=this.paint.get("sky-type");return d==="atmosphere"?["skyboxCapture","skybox"]:d==="gradient"?["skyboxGradient"]:null}},slot:class extends lu{constructor(d,s,a,_){super(d,{paint:oC||(oC=new $o({}))},s,null)}},model:class extends lu{constructor(d,s,a,_){super(d,{layout:hC||(hC=new $o({visibility:new En(jr.layout_model.visibility),"model-id":new Dn(jr.layout_model["model-id"])})),paint:dC||(dC=new $o({"model-opacity":new Dn(jr.paint_model["model-opacity"]),"model-rotation":new Dn(jr.paint_model["model-rotation"]),"model-scale":new Dn(jr.paint_model["model-scale"]),"model-translation":new Dn(jr.paint_model["model-translation"]),"model-color":new Dn(jr.paint_model["model-color"]),"model-color-mix-intensity":new Dn(jr.paint_model["model-color-mix-intensity"]),"model-type":new En(jr.paint_model["model-type"]),"model-cast-shadows":new En(jr.paint_model["model-cast-shadows"]),"model-receive-shadows":new En(jr.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new En(jr.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Dn(jr.paint_model["model-emissive-strength"]),"model-roughness":new Dn(jr.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Dn(jr.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new En(jr.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new En(jr.paint_model["model-front-cutoff"]),"model-elevation-reference":new En(jr.paint_model["model-elevation-reference"]),"model-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},s,a,_),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new QE(d)}getProgramIds(){return["model"]}is3D(d){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(d){return d instanceof sw?Rn-1:0}queryIntersectsFeature(d,s,a,_,j,tt){if(!this.modelManager)return!1;const rt=this.modelManager,ot=d.tile.getBucket(this);if(!(ot&&ot instanceof QE))return!1;for(const ct in ot.instancesPerModel){const ht=ot.instancesPerModel[ct],mt=s.id!==void 0?s.id:s.properties&&s.properties.hasOwnProperty("id")?s.properties.id:void 0;if(ht.idToFeaturesIndex.hasOwnProperty(mt)){const gt=ht.features[ht.idToFeaturesIndex[mt]],_t=rt.getModel(ct,this.scope);if(!_t)return!1;let Rt=Dt();const Pt=new Ot(0,0),zt=ot.canonical;let Vt=Number.MAX_VALUE;for(let Gt=0;Gt<gt.instancedDataCount;++Gt){const _i=16*(gt.instancedDataOffset+Gt),er=ht.instancedDataArray.float32,rr=[er[_i+4],er[_i+5],er[_i+6]];yC(zt,Pt,er[_i],0|er[_i+1]),OS(Rt,_t,tt,Pt,gt.rotation,gt.scale,rr,!1,!1,!1),tt.projection.name==="globe"&&(Rt=SE(Rt,tt));const _r=Tt([],tt.projMatrix,Rt),xr=d.queryGeometry,Er=FS(xr.isPointQuery()?xr.screenBounds:xr.screenGeometry,tt,_r,_t.aabb);Er!=null&&(Vt=Math.min(Er,Vt))}return Vt!==Number.MAX_VALUE&&Vt}}return!1}_handleOverridablePaintPropertyUpdate(d,s,a){return!(!this.layout||s.isDataDriven()||a.isDataDriven()||d!=="model-color"&&d!=="model-color-mix-intensity"&&d!=="model-rotation"&&d!=="model-scale"&&d!=="model-translation"&&d!=="model-emissive-strength")}_isPropertyZoomDependent(d){const s=this._transitionablePaint._values[d];return s!=null&&s.value!=null&&s.value.expression!=null&&s.value.expression instanceof hm}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends lu{constructor(d,s,a,_){super(d,{layout:WT||(WT=new $o({"clip-layer-types":new En(jr.layout_clip["clip-layer-types"]),"clip-layer-scope":new En(jr.layout_clip["clip-layer-scope"])})),paint:qT||(qT=new $o({}))},s,a,_)}recalculate(d,s){super.recalculate(d,s)}createBucket(d){return new ZT(d)}is3D(d){return!0}}},eT=new Js(0,0,0),tT={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},iT={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},ow={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},BP={PAINT_ORDER_FILL_AND_STROKE:1},b0={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},_C={MASK_TYPE_LUMINANCE:1};function VP(d,s,a){d===1&&s.icons.push(function(_,j){return function(tt){if(tt.usvg_tree.height||(tt.usvg_tree.height=tt.usvg_tree.width),!tt.metadata)return tt;const{metadata:rt}=tt;if(rt.content_area){const{content_area:ot}=rt;ot.left==null&&(ot.left=0),ot.top==null&&(ot.top=ot.left),ot.width==null&&(ot.width=tt.usvg_tree.width),ot.height==null&&(ot.height=ot.width)}if(rt.text_placeholder){const{text_placeholder:ot}=rt;ot.top==null&&(ot.top=ot.left),ot.height==null&&(ot.height=ot.width)}return rt.stretch_x&&rt.stretch_x.length&&xC(rt,"x"),rt.stretch_y&&rt.stretch_y.length&&xC(rt,"y"),tt}(_.readFields(UP,{name:void 0},j))}(a,a.readVarint()+a.pos))}function xC(d,s){const a=[],_=d[`stretch_${s}`];let j=null;for(let tt=0;tt<_.length;tt++)j===null?j=a.length===0?_[0]:a[a.length-1][1]+_[tt]:(a.push([j,j+_[tt]]),j=null);d[`stretch_${s}_areas`]=a}function UP(d,s,a){d===1?s.name=a.readString():d===2?s.metadata=function(_,j){return _.readFields(GP,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},j)}(a,a.readVarint()+a.pos):d===3&&(s.usvg_tree=function(_,j){return _.readFields(WP,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},j)}(a,a.readVarint()+a.pos),s.data="usvg_tree")}function GP(d,s,a){d===1?s.stretch_x=a.readPackedVarint():d===2?s.stretch_y=a.readPackedVarint():d===3?s.content_area=vC(a,a.readVarint()+a.pos):d===4?s.variables.push(function(_,j){return _.readFields(HP,{name:void 0},j)}(a,a.readVarint()+a.pos)):d===5&&(s.text_placeholder=vC(a,a.readVarint()+a.pos))}function vC(d,s){return d.readFields($P,{},s)}function $P(d,s,a){d===1?s.left=a.readVarint():d===2?s.width=a.readVarint():d===3?s.top=a.readVarint():d===4&&(s.height=a.readVarint())}function HP(d,s,a){d===1?s.name=a.readString():d===2&&(s.rgb_color=cw(a.readVarint()),s.value="rgb_color")}function WP(d,s,a){d===1?s.width=s.height=a.readVarint():d===2?s.height=a.readVarint():d===3?s.children.push(aw(a,a.readVarint()+a.pos)):d===4?s.linear_gradients.push(function(_,j){return _.readFields(JP,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},j)}(a,a.readVarint()+a.pos)):d===5?s.radial_gradients.push(function(_,j){return _.readFields(tI,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},j)}(a,a.readVarint()+a.pos)):d===7?s.clip_paths.push(function(_,j){return _.readFields(iI,{children:[]},j)}(a,a.readVarint()+a.pos)):d===8&&s.masks.push(function(_,j){const tt=_.readFields(rI,{left:0,width:20,mask_type:_C.MASK_TYPE_LUMINANCE,children:[]},j);return tt.height==null&&(tt.height=tt.width),tt.top==null&&(tt.top=tt.left),tt}(a,a.readVarint()+a.pos))}function aw(d,s){return d.readFields(qP,{},s)}function qP(d,s,a){d===1?(s.group=function(_,j){return _.readFields(ZP,{opacity:255,children:[]},j)}(a,a.readVarint()+a.pos),s.node="group"):d===2&&(s.path=function(_,j){return _.readFields(KP,{paint_order:1,commands:[],step:1,diffs:[],rule:tT.PATH_RULE_NON_ZERO},j)}(a,a.readVarint()+a.pos),s.node="path")}function ZP(d,s,a){d===1?s.transform=lw(a,a.readVarint()+a.pos):d===2?s.opacity=a.readVarint():d===5?s.clip_path_idx=a.readVarint():d===6?s.mask_idx=a.readVarint():d===7&&s.children.push(aw(a,a.readVarint()+a.pos))}function lw(d,s){return d.readFields(XP,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},s)}function XP(d,s,a){d===1?s.sx=a.readFloat():d===2?s.ky=a.readFloat():d===3?s.kx=a.readFloat():d===4?s.sy=a.readFloat():d===5?s.tx=a.readFloat():d===6&&(s.ty=a.readFloat())}function KP(d,s,a){d===1?s.fill=function(_,j){return _.readFields(YP,{rgb_color:eT,paint:"rgb_color",opacity:255},j)}(a,a.readVarint()+a.pos):d===2?s.stroke=function(_,j){return _.readFields(QP,{rgb_color:eT,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},j)}(a,a.readVarint()+a.pos):d===3?s.paint_order=a.readVarint():d===5?a.readPackedVarint(s.commands):d===6?s.step=a.readFloat():d===7?a.readPackedSVarint(s.diffs):d===8&&(s.rule=a.readVarint())}function YP(d,s,a){d===1?(s.rgb_color=cw(a.readVarint()),s.paint="rgb_color"):d===2?(s.linear_gradient_idx=a.readVarint(),s.paint="linear_gradient_idx"):d===3?(s.radial_gradient_idx=a.readVarint(),s.paint="radial_gradient_idx"):d===5&&(s.opacity=a.readVarint())}function cw(d){return new Js((d>>16&255)/255,(d>>8&255)/255,(255&d)/255,1)}function QP(d,s,a){d===1?(s.rgb_color=cw(a.readVarint()),s.paint="rgb_color"):d===2?(s.linear_gradient_idx=a.readVarint(),s.paint="linear_gradient_idx"):d===3?(s.radial_gradient_idx=a.readVarint(),s.paint="radial_gradient_idx"):d===5?a.readPackedFloat(s.dasharray):d===6?s.dashoffset=a.readFloat():d===7?s.miterlimit=a.readFloat():d===8?s.opacity=a.readVarint():d===9?s.width=a.readFloat():d===10?s.linecap=a.readVarint():d===11&&(s.linejoin=a.readVarint())}function JP(d,s,a){d===1?s.transform=lw(a,a.readVarint()+a.pos):d===2?s.spread_method=a.readVarint():d===3?s.stops.push(bC(a,a.readVarint()+a.pos)):d===4?s.x1=a.readFloat():d===5?s.y1=a.readFloat():d===6?s.x2=a.readFloat():d===7&&(s.y2=a.readFloat())}function bC(d,s){return d.readFields(eI,{offset:0,opacity:255,rgb_color:eT},s)}function eI(d,s,a){d===1?s.offset=a.readFloat():d===2?s.opacity=a.readVarint():d===3&&(s.rgb_color=cw(a.readVarint()))}function tI(d,s,a){d===1?s.transform=lw(a,a.readVarint()+a.pos):d===2?s.spread_method=a.readVarint():d===3?s.stops.push(bC(a,a.readVarint()+a.pos)):d===4?s.cx=a.readFloat():d===5?s.cy=a.readFloat():d===6?s.r=a.readFloat():d===7?s.fx=a.readFloat():d===8?s.fy=a.readFloat():d===9&&(s.fr=a.readFloat())}function iI(d,s,a){d===1?s.transform=lw(a,a.readVarint()+a.pos):d===2?s.clip_path_idx=a.readVarint():d===3&&s.children.push(aw(a,a.readVarint()+a.pos))}function rI(d,s,a){d===1?s.left=s.top=a.readFloat():d===2?s.width=s.height=a.readFloat():d===3?s.top=a.readFloat():d===4?s.height=a.readFloat():d===5?s.mask_type=a.readVarint():d===6?s.mask_idx=a.readVarint():d===7&&s.children.push(aw(a,a.readVarint()+a.pos))}class nI{static calculate(s={},a=[]){const _=new Map,j=new Map;if(Object.keys(s).length===0)return _;a.forEach(tt=>{j.set(tt.name,tt.rgb_color||new Js(0,0,0))});for(const[tt,rt]of Object.entries(s))j.has(tt)?_.set(j.get(tt).toString(),rt):console.warn(`Ignoring unknown image variable "${tt}"`);return _}}function $x(d,s=255,a){const _=s/255,j=d.toString(),tt=a.has(j)?a.get(j).clone():d.clone();return tt.a*=_,tt.toString()}function w0(d,s){if(!ey()){const a=document.createElement("canvas");return a.width=d,a.height=s,a}return new OffscreenCanvas(d,s)}function sI(d,s){const a=nI.calculate(s.params,d.metadata?d.metadata.variables:[]),_=d.usvg_tree,j=_.width,tt=_.height,rt=s.transform?s.transform:new DOMMatrix,ot=Math.max(1,Math.round(j*rt.a)),ct=Math.max(1,Math.round(tt*rt.d)),ht=new DOMMatrix([ot/j,0,0,ct/tt,0,0]),mt=w0(ot,ct).getContext("2d");return rT(mt,ht,_,_,a),mt.getImageData(0,0,ot,ct)}function rT(d,s,a,_,j){for(const tt of _.children)wC(d,s,a,tt,j)}function wC(d,s,a,_,j){_.group?(d.save(),function(tt,rt,ot,ct,ht){const mt=ct.mask_idx!=null?ot.masks[ct.mask_idx]:null,gt=ct.clip_path_idx!=null?ot.clip_paths[ct.clip_path_idx]:null;if(ct.transform&&(rt=Hx(ct.transform).preMultiplySelf(rt)),!function(Pt,zt,Vt){return Pt.opacity!==255||zt||Vt}(ct,gt!=null,mt!=null))return void rT(tt,rt,ot,ct,ht);const _t=w0(tt.canvas.width,tt.canvas.height),Rt=_t.getContext("2d");rT(Rt,rt,ot,ct,ht),gt&&PC(Rt,rt,ot,gt),mt&&IC(Rt,rt,ot,mt,ht),tt.globalAlpha=ct.opacity/255,tt.drawImage(_t,0,0)}(d,s,a,_.group,j),d.restore()):_.path&&(d.save(),function(tt,rt,ot,ct,ht){tt.setTransform(rt),ct.paint_order===BP.PAINT_ORDER_FILL_AND_STROKE?(EC(tt,ot,ct,ht),SC(tt,ot,ct,ht)):(SC(tt,ot,ct,ht),EC(tt,ot,ct,ht))}(d,s,a,_.path,j),d.restore())}function EC(d,s,a,_){const j=a.fill;if(!j)return;const tt=j.opacity/255;switch(d.save(),d.beginPath(),MC(a,d),j.paint){case"rgb_color":d.fillStyle=$x(j.rgb_color,j.opacity,_);break;case"linear_gradient_idx":{const rt=s.linear_gradients[j.linear_gradient_idx];rt.transform&&d.setTransform(Hx(rt.transform).preMultiplySelf(d.getTransform())),d.fillStyle=CC(d,rt,tt,_);break}case"radial_gradient_idx":{const rt=s.radial_gradients[j.radial_gradient_idx];rt.transform&&d.setTransform(Hx(rt.transform).preMultiplySelf(d.getTransform())),d.fillStyle=AC(d,rt,tt,_)}}d.fill(TC(a)),d.restore()}function TC(d){return d.rule===tT.PATH_RULE_NON_ZERO?"nonzero":d.rule===tT.PATH_RULE_EVEN_ODD?"evenodd":void 0}function SC(d,s,a,_){const j=a.stroke;if(!j)return;const tt=kC(a);d.lineWidth=j.width,d.miterLimit=j.miterlimit,d.setLineDash(j.dasharray),d.lineDashOffset=j.dashoffset;const rt=j.opacity/255;switch(j.paint){case"rgb_color":d.strokeStyle=$x(j.rgb_color,j.opacity,_);break;case"linear_gradient_idx":d.strokeStyle=CC(d,s.linear_gradients[j.linear_gradient_idx],rt,_,!0);break;case"radial_gradient_idx":d.strokeStyle=AC(d,s.radial_gradients[j.radial_gradient_idx],rt,_,!0)}switch(j.linejoin){case ow.LINE_JOIN_MITER_CLIP:case ow.LINE_JOIN_MITER:d.lineJoin="miter";break;case ow.LINE_JOIN_ROUND:d.lineJoin="round";break;case ow.LINE_JOIN_BEVEL:d.lineJoin="bevel"}switch(j.linecap){case iT.LINE_CAP_BUTT:d.lineCap="butt";break;case iT.LINE_CAP_ROUND:d.lineCap="round";break;case iT.LINE_CAP_SQUARE:d.lineCap="square"}d.stroke(tt)}function CC(d,s,a,_,j=!1){if(s.stops.length===1){const _t=s.stops[0];return $x(_t.rgb_color,_t.opacity*a,_)}const{x1:tt,y1:rt,x2:ot,y2:ct}=s;let ht=new DOMPoint(tt,rt),mt=new DOMPoint(ot,ct);if(j){const _t=Hx(s.transform);ht=_t.transformPoint(ht),mt=_t.transformPoint(mt)}const gt=d.createLinearGradient(ht.x,ht.y,mt.x,mt.y);for(const _t of s.stops)gt.addColorStop(_t.offset,$x(_t.rgb_color,_t.opacity*a,_));return gt}function AC(d,s,a,_,j=!1){if(s.stops.length===1){const Gt=s.stops[0];return $x(Gt.rgb_color,Gt.opacity*a,_)}const tt=Hx(s.transform),{fx:rt,fy:ot,fr:ct,cx:ht,cy:mt,r:gt}=s;let _t=new DOMPoint(rt,ot),Rt=new DOMPoint(ht,mt),Pt=ct,zt=gt;if(j){_t=tt.transformPoint(_t),Rt=tt.transformPoint(Rt);const Gt=(tt.a+tt.d)/2;Pt=ct*Gt,zt=s.r*Gt}const Vt=d.createRadialGradient(_t.x,_t.y,Pt,Rt.x,Rt.y,zt);for(const Gt of s.stops)Vt.addColorStop(Gt.offset,$x(Gt.rgb_color,Gt.opacity*a,_));return Vt}function RC(d,s,a,_){const j=_.transform?Hx(_.transform).preMultiplySelf(s):s,tt=w0(d.canvas.width,d.canvas.height),rt=tt.getContext("2d");for(const ct of _.children)if(ct.group)RC(rt,j,a,ct.group);else if(ct.path){const ht=ct.path,mt=new Path2D;mt.addPath(kC(ht),j),rt.fill(mt,TC(ht))}const ot=_.clip_path_idx!=null?a.clip_paths[_.clip_path_idx]:null;ot&&PC(rt,j,a,ot),d.globalCompositeOperation="source-over",d.drawImage(tt,0,0)}function PC(d,s,a,_){const j=w0(d.canvas.width,d.canvas.height);RC(j.getContext("2d"),s,a,_),d.globalCompositeOperation="destination-in",d.drawImage(j,0,0)}function IC(d,s,a,_,j){if(_.children.length===0)return;const tt=_.mask_idx!=null?a.masks[_.mask_idx]:null;tt&&IC(d,s,a,tt,j);const rt=d.canvas.width,ot=d.canvas.height,ct=w0(rt,ot),ht=ct.getContext("2d"),mt=_.width,gt=_.height,_t=_.left,Rt=_.top,Pt=new Path2D,zt=new Path2D;zt.rect(_t,Rt,mt,gt),Pt.addPath(zt,s),ht.clip(Pt);for(const _i of _.children)wC(ht,s,a,_i,j);const Vt=ht.getImageData(0,0,rt,ot),Gt=Vt.data;if(_.mask_type===_C.MASK_TYPE_LUMINANCE)for(let _i=0;_i<Gt.length;_i+=4)Gt[_i+3]=Gt[_i+3]/255*(.2126*Gt[_i]+.7152*Gt[_i+1]+.0722*Gt[_i+2]);ht.putImageData(Vt,0,0),d.globalCompositeOperation="destination-in",d.drawImage(ct,0,0)}function Hx(d){return d?new DOMMatrix([d.sx,d.ky,d.kx,d.sy,d.tx,d.ty]):new DOMMatrix}function MC(d,s){const a=d.step;let _=d.diffs[0]*a,j=d.diffs[1]*a;s.moveTo(_,j);for(let tt=0,rt=2;tt<d.commands.length;tt++)switch(d.commands[tt]){case b0.PATH_COMMAND_MOVE:_+=d.diffs[rt++]*a,j+=d.diffs[rt++]*a,s.moveTo(_,j);break;case b0.PATH_COMMAND_LINE:_+=d.diffs[rt++]*a,j+=d.diffs[rt++]*a,s.lineTo(_,j);break;case b0.PATH_COMMAND_QUAD:{const ot=_+d.diffs[rt++]*a,ct=j+d.diffs[rt++]*a;_=ot+d.diffs[rt++]*a,j=ct+d.diffs[rt++]*a,s.quadraticCurveTo(ot,ct,_,j);break}case b0.PATH_COMMAND_CUBIC:{const ot=_+d.diffs[rt++]*a,ct=j+d.diffs[rt++]*a,ht=ot+d.diffs[rt++]*a,mt=ct+d.diffs[rt++]*a;_=ht+d.diffs[rt++]*a,j=mt+d.diffs[rt++]*a,s.bezierCurveTo(ot,ct,ht,mt,_,j);break}case b0.PATH_COMMAND_CLOSE:s.closePath()}return s}function kC(d){return MC(d,new Path2D)}class uw{constructor(s){this.capacity=s,this.cache=new Map}get(s){if(!this.cache.has(s))return;const a=this.cache.get(s);return this.cache.delete(s),this.cache.set(s,a),a}put(s,a){this.cache.has(s)?this.cache.delete(s):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(s,a)}delete(s){this.cache.delete(s)}}Fn(uw,"LRUCache");class nT{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(s){return new iu(s,s.data)}getFromCache(s,a,_){return this.cacheMap.has(_)||this.cacheMap.set(_,new uw(150)),this.cacheMap.get(_).get(Iy(s.toString(),a))}setInCache(s,a,_,j){this.cacheDependenciesMap.has(j)||this.cacheDependenciesMap.set(j,new Map),this.cacheMap.has(j)||this.cacheMap.set(j,new uw(150));const tt=this.cacheDependenciesMap.get(j),rt=Iy(s.id.toString(),_);tt.get(rt)||tt.set(rt,new Set);const ot=this.cacheMap.get(j),ct=s.toString();tt.get(rt).add(ct),ot.put(Iy(s.toString(),_),a)}removeImagesFromCacheByIds(s,a,_=0){if(!this.cacheMap.has(_)||!this.cacheDependenciesMap.has(_))return;const j=this.cacheMap.get(_),tt=this.cacheDependenciesMap.get(_);for(const rt of s){const ot=Iy(rt.toString(),a);if(tt.has(ot)){for(const ct of tt.get(ot))j.delete(ct);tt.delete(ot)}}}rasterize(s,a,_,j,tt=sI){const rt=this.getFromCache(s,_,j);if(rt)return rt.clone();const ot=tt(a.icon,s.options),ct=nT._getImage(ot);return this.setInCache(s,ct,_,j),ct.clone()}}class DC{constructor(s){this.size=s,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(s,a){const _=this.toIdx(s,a);return{min:this.minimums[_],max:this.maximums[_]}}isLeaf(s,a){return this.leaves[this.toIdx(s,a)]}toIdx(s,a){return a*this.size+s}}function LC(d,s,a,_){let j=0,tt=Number.MAX_VALUE;for(let rt=0;rt<3;rt++)if(Math.abs(_[rt])<1e-15){if(a[rt]<d[rt]||a[rt]>s[rt])return null}else{const ot=1/_[rt];let ct=(d[rt]-a[rt])*ot,ht=(s[rt]-a[rt])*ot;if(ct>ht){const mt=ct;ct=ht,ht=mt}if(ct>j&&(j=ct),ht<tt&&(tt=ht),j>tt)return null}return j}function jC(d,s,a,_,j,tt,rt,ot,ct,ht,mt){const gt=_-d,_t=j-s,Rt=tt-a,Pt=rt-d,zt=ot-s,Vt=ct-a,Gt=mt[1]*Vt-mt[2]*zt,_i=mt[2]*Pt-mt[0]*Vt,er=mt[0]*zt-mt[1]*Pt,rr=gt*Gt+_t*_i+Rt*er;if(Math.abs(rr)<1e-15)return null;const _r=1/rr,xr=ht[0]-d,Er=ht[1]-s,Ar=ht[2]-a,Pr=(xr*Gt+Er*_i+Ar*er)*_r;if(Pr<0||Pr>1)return null;const sn=Er*Rt-Ar*_t,Fr=Ar*gt-xr*Rt,on=xr*_t-Er*gt,gn=(mt[0]*sn+mt[1]*Fr+mt[2]*on)*_r;return gn<0||Pr+gn>1?null:(Pt*sn+zt*Fr+Vt*on)*_r}function FC(d,s,a){return(d-s)/(a-s)}function OC(d,s,a,_,j,tt,rt,ot,ct){const ht=1<<a,mt=tt-_,gt=rt-j,_t=(d+1)/ht*mt+_,Rt=(s+0)/ht*gt+j,Pt=(s+1)/ht*gt+j;ot[0]=(d+0)/ht*mt+_,ot[1]=Rt,ct[0]=_t,ct[1]=Pt}class zC{constructor(s){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=s,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(tt){const rt=Math.ceil(Math.log2(tt.dim/8)),ot=[];let ct=Math.ceil(Math.pow(2,rt));const ht=1/ct,mt=(Rt,Pt,zt,Vt,Gt)=>{const _i=Vt?1:0,er=(Rt+1)*zt-_i,rr=Pt*zt,_r=(Pt+1)*zt-_i;Gt[0]=Rt*zt,Gt[1]=rr,Gt[2]=er,Gt[3]=_r};let gt=new DC(ct);const _t=[];for(let Rt=0;Rt<ct*ct;Rt++){mt(Rt%ct,Math.floor(Rt/ct),ht,!1,_t);const Pt=Wy(_t[0],_t[1],tt),zt=Wy(_t[2],_t[1],tt),Vt=Wy(_t[2],_t[3],tt),Gt=Wy(_t[0],_t[3],tt);gt.minimums.push(Math.min(Pt,zt,Vt,Gt)),gt.maximums.push(Math.max(Pt,zt,Vt,Gt)),gt.leaves.push(1)}for(ot.push(gt),ct/=2;ct>=1;ct/=2){const Rt=ot[ot.length-1];gt=new DC(ct);for(let Pt=0;Pt<ct*ct;Pt++){mt(Pt%ct,Math.floor(Pt/ct),2,!0,_t);const zt=Rt.getElevation(_t[0],_t[1]),Vt=Rt.getElevation(_t[2],_t[1]),Gt=Rt.getElevation(_t[2],_t[3]),_i=Rt.getElevation(_t[0],_t[3]),er=Rt.isLeaf(_t[0],_t[1]),rr=Rt.isLeaf(_t[2],_t[1]),_r=Rt.isLeaf(_t[2],_t[3]),xr=Rt.isLeaf(_t[0],_t[3]),Er=Math.min(zt.min,Vt.min,Gt.min,_i.min),Ar=Math.max(zt.max,Vt.max,Gt.max,_i.max),Pr=er&&rr&&_r&&xr;gt.maximums.push(Ar),gt.minimums.push(Er),gt.leaves.push(Ar-Er<=5&&Pr?1:0)}ot.push(gt)}return ot}(this.dem),_=a.length-1,j=a[_];this._addNode(j.minimums[0],j.maximums[0],j.leaves[0]),this._construct(a,0,0,_,0)}raycastRoot(s,a,_,j,tt,rt,ot=1){return LC([s,a,-100],[_,j,this.maximums[0]*ot],tt,rt)}raycast(s,a,_,j,tt,rt,ot=1){if(!this.nodeCount)return null;const ct=this.raycastRoot(s,a,_,j,tt,rt,ot);if(ct==null)return null;const ht=[],mt=[],gt=[],_t=[],Rt=[{idx:0,t:ct,nodex:0,nodey:0,depth:0}];for(;Rt.length>0;){const{idx:Pt,t:zt,nodex:Vt,nodey:Gt,depth:_i}=Rt.pop();if(this.leaves[Pt]){OC(Vt,Gt,_i,s,a,_,j,gt,_t);const rr=1<<_i,_r=(Vt+0)/rr,xr=(Vt+1)/rr,Er=(Gt+0)/rr,Ar=(Gt+1)/rr,Pr=Wy(_r,Er,this.dem)*ot,sn=Wy(xr,Er,this.dem)*ot,Fr=Wy(xr,Ar,this.dem)*ot,on=Wy(_r,Ar,this.dem)*ot,gn=jC(gt[0],gt[1],Pr,_t[0],gt[1],sn,_t[0],_t[1],Fr,tt,rt),an=jC(_t[0],_t[1],Fr,gt[0],_t[1],on,gt[0],gt[1],Pr,tt,rt),hn=Math.min(gn!==null?gn:Number.MAX_VALUE,an!==null?an:Number.MAX_VALUE);if(hn!==Number.MAX_VALUE)return hn;{const vn=pn([],tt,rt,zt);if(NC(Pr,sn,on,Fr,FC(vn[0],gt[0],_t[0]),FC(vn[1],gt[1],_t[1]))>=vn[2])return zt}continue}let er=0;for(let rr=0;rr<this._siblingOffset.length;rr++){OC((Vt<<1)+this._siblingOffset[rr][0],(Gt<<1)+this._siblingOffset[rr][1],_i+1,s,a,_,j,gt,_t),gt[2]=-100,_t[2]=this.maximums[this.childOffsets[Pt]+rr]*ot;const _r=LC(gt,_t,tt,rt);if(_r!=null){const xr=_r;ht[rr]=xr;let Er=!1;for(let Ar=0;Ar<er&&!Er;Ar++)xr>=ht[mt[Ar]]&&(mt.splice(Ar,0,rr),Er=!0);Er||(mt[er]=rr),er++}}for(let rr=0;rr<er;rr++){const _r=mt[rr];Rt.push({idx:this.childOffsets[Pt]+_r,t:ht[_r],nodex:(Vt<<1)+this._siblingOffset[_r][0],nodey:(Gt<<1)+this._siblingOffset[_r][1],depth:_i+1})}}return null}_addNode(s,a,_){return this.minimums.push(s),this.maximums.push(a),this.leaves.push(_),this.childOffsets.push(0),this.nodeCount++}_construct(s,a,_,j,tt){if(s[j].isLeaf(a,_)===1)return;this.childOffsets[tt]||(this.childOffsets[tt]=this.nodeCount);const rt=j-1,ot=s[rt];let ct=0,ht=0;for(let mt=0;mt<this._siblingOffset.length;mt++){const gt=2*a+this._siblingOffset[mt][0],_t=2*_+this._siblingOffset[mt][1],Rt=ot.getElevation(gt,_t),Pt=ot.isLeaf(gt,_t),zt=this._addNode(Rt.min,Rt.max,Pt);Pt&&(ct|=1<<mt),ht||(ht=zt)}for(let mt=0;mt<this._siblingOffset.length;mt++)ct&1<<mt||this._construct(s,2*a+this._siblingOffset[mt][0],2*_+this._siblingOffset[mt][1],rt,ht+mt)}}function NC(d,s,a,_,j,tt){return ns(ns(d,a,tt),ns(s,_,tt),j)}function Wy(d,s,a){const _=a.dim,j=fr(d*_-.5,0,_-1),tt=fr(s*_-.5,0,_-1),rt=Math.floor(j),ot=Math.floor(tt),ct=Math.min(rt+1,_-1),ht=Math.min(ot+1,_-1);return NC(a.get(rt,ot),a.get(ct,ot),a.get(rt,ht),a.get(ct,ht),j-rt,tt-ot)}const oI={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function aI(d,s,a){return(256*d*256+256*s+a)/10-1e4}function lI(d,s,a){return 256*d+s+a/256-32768}class hw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(s,a,_,j=!1){if(this.uid=s,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(_&&_!=="mapbox"&&_!=="terrarium")return void Es(`"${_}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const tt=this.dim=a.height-2,rt=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=j,this._modifiedForSources={},!j){for(let ct=0;ct<tt;ct++)rt[this._idx(-1,ct)]=rt[this._idx(0,ct)],rt[this._idx(tt,ct)]=rt[this._idx(tt-1,ct)],rt[this._idx(ct,-1)]=rt[this._idx(ct,0)],rt[this._idx(ct,tt)]=rt[this._idx(ct,tt-1)];rt[this._idx(-1,-1)]=rt[this._idx(0,0)],rt[this._idx(tt,-1)]=rt[this._idx(tt-1,0)],rt[this._idx(-1,tt)]=rt[this._idx(0,tt-1)],rt[this._idx(tt,tt)]=rt[this._idx(tt-1,tt-1)]}const ot=_==="terrarium"?lI:aI;for(let ct=0;ct<rt.length;++ct){const ht=4*ct;this.floatView[ct]=ot(this.pixels[ht],this.pixels[ht+1],this.pixels[ht+2])}this._timestamp=gu.now()}_buildQuadTree(){this._tree=new zC(this)}get(s,a,_=!1){_&&(s=fr(s,-1,this.dim),a=fr(a,-1,this.dim));const j=this._idx(s,a);return this.floatView[j]}set(s,a,_){const j=this._idx(s,a),tt=this.floatView[j];return this.floatView[j]=_,_-tt}static getUnpackVector(s){return oI[s]}_idx(s,a){if(s<-1||s>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(s+1)}static pack(s,a){const _=[0,0,0,0],j=hw.getUnpackVector(a);let tt=Math.floor((s+j[3])/j[2]);return _[2]=tt%256,tt=Math.floor(tt/256),_[1]=tt%256,tt=Math.floor(tt/256),_[0]=tt,_}getPixels(){return new kT({width:this.stride,height:this.stride},this.pixels)}backfillBorder(s,a,_){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let j=a*this.dim,tt=a*this.dim+this.dim,rt=_*this.dim,ot=_*this.dim+this.dim;switch(a){case-1:j=tt-1;break;case 1:tt=j+1}switch(_){case-1:rt=ot-1;break;case 1:ot=rt+1}const ct=-a*this.dim,ht=-_*this.dim;for(let mt=rt;mt<ot;mt++)for(let gt=j;gt<tt;gt++){const _t=4*this._idx(gt,mt),Rt=4*this._idx(gt+ct,mt+ht);this.pixels[_t+0]=s.pixels[Rt+0],this.pixels[_t+1]=s.pixels[Rt+1],this.pixels[_t+2]=s.pixels[Rt+2],this.pixels[_t+3]=s.pixels[Rt+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function cI(d,s,a){d===1?s.headerLength=a.readFixed32():d===2?s.x=a.readVarint():d===3?s.y=a.readVarint():d===4?s.z=a.readVarint():d===5&&s.layers.push(function(_,j){return _.readFields(fI,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},j)}(a,a.readVarint()+a.pos))}function uI(d,s,a){d===1?(s.delta_filter=function(_,j){return _.readFields(hI,{blockSize:0},j)}(a,a.readVarint()+a.pos),s.filter="delta_filter"):d===2?(a.readVarint(),s.filter="zigzag_filter"):d===3?(a.readVarint(),s.filter="bitshuffle_filter"):d===4&&(a.readVarint(),s.filter="byteshuffle_filter")}function hI(d,s,a){d===1&&(s.blockSize=a.readVarint())}function dI(d,s,a){d===1?(a.readVarint(),s.codec="gzip_data"):d===2?(a.readVarint(),s.codec="jpeg_image"):d===3?(a.readVarint(),s.codec="webp_image"):d===4&&(a.readVarint(),s.codec="png_image")}function pI(d,s,a){let _=0,j=0;d===1?s.firstByte=a.readFixed64():d===2?s.lastByte=a.readFixed64():d===3?s.filters.push(function(tt,rt){return tt.readFields(uI,{},rt)}(a,a.readVarint()+a.pos)):d===4?s.codec=function(tt,rt){return tt.readFields(dI,{},rt)}(a,a.readVarint()+a.pos):d===5?j=a.readFloat():d===6?_=a.readFloat():d===7?s.bands.push(a.readString()):d===8?s.offset=a.readDouble():d===9&&(s.scale=a.readDouble()),s.offset===0&&(s.offset=j),s.scale===0&&(s.scale=_)}function fI(d,s,a){d===1?s.version=a.readVarint():d===2?s.name=a.readString():d===3?s.units=a.readString():d===4?s.tileSize=a.readVarint():d===5?s.buffer=a.readVarint():d===6?s.pixelFormat=a.readVarint():d===7&&s.dataIndex.push(function(_,j){return _.readFields(pI,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},j)}(a,a.readVarint()+a.pos))}function mI(d,s,a){if(d===2)(function(_,j,tt){_.readFields(gI,tt,j)})(a,a.readVarint()+a.pos,s);else if(d===3)throw new Error("Not implemented")}function gI(d,s,a){if(d===1){let _=0;const j=a.readVarint()+a.pos;for(;a.pos<j;)s[_++]=a.readVarint()}}function yI(d,s){if(s.length!==4)throw new Error(`Expected data of dimension 4 but got ${s.length}.`);let a=s[3];for(let _=2;_>=1;_--){const j=_===1?1:0,tt=_===2?1:0;for(let rt=0;rt<s[0];rt++){const ot=s[1]*rt;for(let ct=j;ct<s[1];ct++){const ht=s[2]*(ct+ot);for(let mt=tt;mt<s[2];mt++){const gt=s[3]*(mt+ht);for(let _t=0;_t<s[3];_t++){const Rt=gt+_t;d[Rt]+=d[Rt-a]}}}}a*=s[_]}return d}function _I(d){for(let s=0,a=d.length;s<a;s++)d[s]=d[s]>>>1^-(1&d[s]);return d}function xI(d,s){switch(s){case"uint32":return d;case"uint16":for(let a=0;a<d.length;a+=2){const _=d[a],j=d[a+1];d[a]=(240&_)>>4|(61440&_)>>8|(240&j)<<4|61440&j,d[a+1]=15&_|(3840&_)>>4|(15&j)<<8|(3840&j)<<4}return d;case"uint8":for(let a=0;a<d.length;a+=4){const _=d[a],j=d[a+1],tt=d[a+2],rt=d[a+3];d[a+0]=(192&_)>>6|(192&j)>>4|(192&tt)>>2|192&rt,d[a+1]=(48&_)>>4|(48&j)>>2|48&tt|(48&rt)<<2,d[a+2]=(12&_)>>2|12&j|(12&tt)<<2|(12&rt)<<4,d[a+3]=3&_|(3&j)<<2|(3&tt)<<4|(3&rt)<<6}return d;default:throw new Error(`Invalid pixel format, "${s}"`)}}Fn(hw,"DEMData"),Fn(zC,"DemMinMaxQuadTree",{omit:["dem"]});var hp=Uint8Array,E0=Uint16Array,vI=Int32Array,BC=new hp([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),VC=new hp([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),bI=new hp([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),UC=function(d,s){for(var a=new E0(31),_=0;_<31;++_)a[_]=s+=1<<d[_-1];var j=new vI(a[30]);for(_=1;_<30;++_)for(var tt=a[_];tt<a[_+1];++tt)j[tt]=tt-a[_]<<5|_;return{b:a,r:j}},GC=UC(BC,2),$C=GC.b,wI=GC.r;$C[28]=258,wI[258]=28;for(var EI=UC(VC,0).b,HC=new E0(32768),Ll=0;Ll<32768;++Ll){var Wx=(43690&Ll)>>1|(21845&Ll)<<1;HC[Ll]=((65280&(Wx=(61680&(Wx=(52428&Wx)>>2|(13107&Wx)<<2))>>4|(3855&Wx)<<4))>>8|(255&Wx)<<8)>>1}var T0=function(d,s,a){for(var _=d.length,j=0,tt=new E0(s);j<_;++j)d[j]&&++tt[d[j]-1];var rt,ot=new E0(s);for(j=1;j<s;++j)ot[j]=ot[j-1]+tt[j-1]<<1;rt=new E0(1<<s);var ct=15-s;for(j=0;j<_;++j)if(d[j])for(var ht=j<<4|d[j],mt=s-d[j],gt=ot[d[j]-1]++<<mt,_t=gt|(1<<mt)-1;gt<=_t;++gt)rt[HC[gt]>>ct]=ht;return rt},S0=new hp(288);for(Ll=0;Ll<144;++Ll)S0[Ll]=8;for(Ll=144;Ll<256;++Ll)S0[Ll]=9;for(Ll=256;Ll<280;++Ll)S0[Ll]=7;for(Ll=280;Ll<288;++Ll)S0[Ll]=8;var WC=new hp(32);for(Ll=0;Ll<32;++Ll)WC[Ll]=5;var TI=T0(S0,9),SI=T0(WC,5),sT=function(d){for(var s=d[0],a=1;a<d.length;++a)d[a]>s&&(s=d[a]);return s},$p=function(d,s,a){var _=s/8|0;return(d[_]|d[_+1]<<8)>>(7&s)&a},oT=function(d,s){var a=s/8|0;return(d[a]|d[a+1]<<8|d[a+2]<<16)>>(7&s)},CI=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Hp=function(d,s,a){var _=new Error(s||CI[d]);if(_.code=d,Error.captureStackTrace&&Error.captureStackTrace(_,Hp),!a)throw _;return _},AI=new hp(0),RI=typeof TextDecoder<"u"&&new TextDecoder;try{RI.decode(AI,{stream:!0})}catch{}const PI={gzip_data:"gzip"};class Cp extends Error{constructor(s){super(s),this.name="MRTError"}}const II={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},qC={uint32:1,uint16:2,uint8:4},MI={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let aT;class dw{constructor(s=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=s}getLayer(s){const a=this.layers[s];if(!a)throw new Cp(`Layer '${s}' not found`);return a}getHeaderLength(s){const a=new Uint8Array(s),_=new DataView(s);if(a[0]!==13)throw new Cp("File is not a valid MRT.");return _.getUint32(1,!0)}parseHeader(s){const a=new Uint8Array(s),_=this.getHeaderLength(s);if(a.length<_)throw new Cp(`Expected header with length >= ${_} but got buffer of length ${a.length}`);const j=new aT(a.subarray(0,_)).readFields(cI,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==j.x||this.y!==j.y||this.z!==j.z))throw new Cp(`Invalid attempt to parse header ${j.z}/${j.x}/${j.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=j.x,this.y=j.y,this.z=j.z;for(const tt of j.layers)this.layers[tt.name]=new ZC(tt,{cacheSize:this._cacheSize});return this}createDecodingTask(s){const a=[],_=this.getLayer(s.layerName);for(let j of s.blockIndices){const tt=_.dataIndex[j],rt=tt.firstByte-s.firstByte,ot=tt.lastByte-s.firstByte;if(_._blocksInProgress.has(j))continue;const ct={layerName:_.name,firstByte:rt,lastByte:ot,pixelFormat:_.pixelFormat,blockIndex:j,blockShape:[tt.bands.length].concat(_.bandShape),buffer:_.buffer,codec:tt.codec.codec,filters:tt.filters.map(ht=>ht.filter)};_._blocksInProgress.add(j),a.push(ct)}return new XC(a,()=>{a.forEach(j=>_._blocksInProgress.delete(j.blockIndex))},(j,tt)=>{if(a.forEach(rt=>_._blocksInProgress.delete(rt.blockIndex)),j)throw j;tt.forEach(rt=>{this.getLayer(rt.layerName).processDecodedData(rt)})})}}class ZC{constructor({version:s,name:a,units:_,tileSize:j,pixelFormat:tt,buffer:rt,dataIndex:ot},ct){if(this.version=s,this.version!==1)throw new Cp(`Cannot parse raster layer encoded with MRT version ${s}`);this.name=a,this.units=_,this.tileSize=j,this.buffer=rt,this.pixelFormat=II[tt],this.dataIndex=ot,this.bandShape=[j+2*rt,j+2*rt,qC[this.pixelFormat]],this._decodedBlocks=new uw(ct?ct.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return qC[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:s})=>s).flat()}processDecodedData(s){const a=s.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,s.data)}getBlockForBand(s){let a=0;switch(typeof s){case"string":for(const[_,j]of this.dataIndex.entries()){for(const[tt,rt]of j.bands.entries())if(rt===s)return{bandIndex:a+tt,blockIndex:_,blockBandIndex:tt};a+=j.bands.length}break;case"number":for(const[_,j]of this.dataIndex.entries()){if(s>=a&&s<a+j.bands.length)return{bandIndex:s,blockIndex:_,blockBandIndex:s-a};a+=j.bands.length}break;default:throw new Cp(`Invalid band \`${JSON.stringify(s)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(s){let a=1/0,_=-1/0;const j=[],tt=new Set;for(const rt of s){const{blockIndex:ot}=this.getBlockForBand(rt);if(ot<0)throw new Cp(`Invalid band: ${JSON.stringify(rt)}`);const ct=this.dataIndex[ot];j.includes(ot)||j.push(ot),tt.add(ot),a=Math.min(a,ct.firstByte),_=Math.max(_,ct.lastByte)}if(tt.size>this.cacheSize)throw new Cp(`Number of blocks to decode (${tt.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:_,blockIndices:j}}hasBand(s){const{blockIndex:a}=this.getBlockForBand(s);return a>=0}hasDataForBand(s){const{blockIndex:a}=this.getBlockForBand(s);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(s){const{blockIndex:a,blockBandIndex:_}=this.getBlockForBand(s);if(a<0)throw new Cp(`Band not found: ${JSON.stringify(s)}`);const j=this._decodedBlocks.get(a.toString());if(!j)throw new Cp(`Data for band ${JSON.stringify(s)} of layer "${this.name}" not decoded.`);const tt=this.dataIndex[a],rt=this.bandShape.reduce((ht,mt)=>ht*mt,1),ot=_*rt,ct=j.subarray(ot,ot+rt);return{data:ct,bytes:new Uint8Array(ct.buffer).subarray(ct.byteOffset,ct.byteOffset+ct.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:tt.offset,scale:tt.scale}}}dw.setPbf=function(d){aT=d};class XC{constructor(s,a,_){this.tasks=s,this._onCancel=a,this._onComplete=_,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(s,a){this._finalized||(this._onComplete(s,a),this._finalized=!0)}}dw.performDecoding=function(d,s){const a=new Uint8Array(d);return Promise.all(s.tasks.map(_=>{const{layerName:j,firstByte:tt,lastByte:rt,pixelFormat:ot,blockShape:ct,blockIndex:ht,filters:mt,codec:gt}=_,_t=a.subarray(tt,rt+1),Rt=new Uint32Array(ct[0]*ct[1]*ct[2]);let Pt;if(gt!=="gzip_data")throw new Cp(`Unhandled codec: ${gt}`);return Pt=function(zt,Vt){if(!globalThis.DecompressionStream&&Vt==="gzip_data")return Promise.resolve(((rr=function(Er){Er[0]==31&&Er[1]==139&&Er[2]==8||Hp(6,"invalid gzip data");var Ar=Er[3],Pr=10;4&Ar&&(Pr+=2+(Er[10]|Er[11]<<8));for(var sn=(Ar>>3&1)+(Ar>>4&1);sn>0;sn-=!Er[Pr++]);return Pr+(2&Ar)}(er=zt))+8>er.length&&Hp(6,"invalid gzip data"),function(Er,Ar,Pr,sn){var Fr=Er.length;if(!Fr||Ar.f&&!Ar.l)return Pr||new hp(0);var on=!Pr,gn=on||Ar.i!=2,an=Ar.i;on&&(Pr=new hp(3*Fr));var hn,vn,tn=function(wo){var Eo=Pr.length;if(wo>Eo){var mo=new hp(Math.max(2*Eo,wo));mo.set(Pr),Pr=mo}},dn=Ar.f||0,qr=Ar.p||0,Gr=Ar.b||0,wn=Ar.l,_n=Ar.d,Yn=Ar.m,jn=Ar.n,Bn=8*Fr;do{if(!wn){dn=$p(Er,qr,1);var An=$p(Er,qr+1,3);if(qr+=3,!An){var Kn=Er[(or=4+((qr+7)/8|0))-4]|Er[or-3]<<8,ps=or+Kn;if(ps>Fr){an&&Hp(0);break}gn&&tn(Gr+Kn),Pr.set(Er.subarray(or,ps),Gr),Ar.b=Gr+=Kn,Ar.p=qr=8*ps,Ar.f=dn;continue}if(An==1)wn=TI,_n=SI,Yn=9,jn=5;else if(An==2){var kn=$p(Er,qr,31)+257,$n=$p(Er,qr+10,15)+4,ls=kn+$p(Er,qr+5,31)+1;qr+=14;for(var ms=new hp(ls),Is=new hp(19),xs=0;xs<$n;++xs)Is[bI[xs]]=$p(Er,qr+3*xs,7);qr+=3*$n;var Nn=sT(Is),ys=(1<<Nn)-1,Bs=T0(Is,Nn);for(xs=0;xs<ls;){var or,ar=Bs[$p(Er,qr,ys)];if(qr+=15&ar,(or=ar>>4)<16)ms[xs++]=or;else{var Wr=0,nn=0;for(or==16?(nn=3+$p(Er,qr,3),qr+=2,Wr=ms[xs-1]):or==17?(nn=3+$p(Er,qr,7),qr+=3):or==18&&(nn=11+$p(Er,qr,127),qr+=7);nn--;)ms[xs++]=Wr}}var Mn=ms.subarray(0,kn),In=ms.subarray(kn);Yn=sT(Mn),jn=sT(In),wn=T0(Mn,Yn),_n=T0(In,jn)}else Hp(1);if(qr>Bn){an&&Hp(0);break}}gn&&tn(Gr+131072);for(var zn=(1<<Yn)-1,es=(1<<jn)-1,Ms=qr;;Ms=qr){var ks=(Wr=wn[oT(Er,qr)&zn])>>4;if((qr+=15&Wr)>Bn){an&&Hp(0);break}if(Wr||Hp(2),ks<256)Pr[Gr++]=ks;else{if(ks==256){Ms=qr,wn=null;break}var Ps=ks-254;ks>264&&(Ps=$p(Er,qr,(1<<(Cs=BC[xs=ks-257]))-1)+$C[xs],qr+=Cs);var oo=_n[oT(Er,qr)&es],Lo=oo>>4;if(oo||Hp(3),qr+=15&oo,In=EI[Lo],Lo>3){var Cs=VC[Lo];In+=oT(Er,qr)&(1<<Cs)-1,qr+=Cs}if(qr>Bn){an&&Hp(0);break}gn&&tn(Gr+131072);var _o=Gr+Ps;if(Gr<In){var lo=0-In,Ks=Math.min(In,_o);for(lo+Gr<0&&Hp(3);Gr<Ks;++Gr)Pr[Gr]=(void 0)[lo+Gr]}for(;Gr<_o;++Gr)Pr[Gr]=Pr[Gr-In]}}Ar.l=wn,Ar.p=Ms,Ar.b=Gr,Ar.f=dn,wn&&(dn=1,Ar.m=Yn,Ar.d=_n,Ar.n=jn)}while(!dn);return Gr!=Pr.length&&on?(hn=Pr,((vn=Gr)==null||vn>hn.length)&&(vn=hn.length),new hp(hn.subarray(0,vn))):Pr.subarray(0,Gr)}(er.subarray(rr,-8),{i:2},new hp(((Gt=er)[(_i=Gt.length)-4]|Gt[_i-3]<<8|Gt[_i-2]<<16|Gt[_i-1]<<24)>>>0))));var Gt,_i,er,rr;const _r=PI[Vt];if(!_r)throw new Error(`Unhandled codec: ${Vt}`);const xr=new globalThis.DecompressionStream(_r);return new Response(new Blob([zt]).stream().pipeThrough(xr)).arrayBuffer().then(Er=>new Uint8Array(Er))}(_t,gt).then(zt=>(function(Vt,Gt){Vt.readFields(mI,Gt)}(new aT(zt),Rt),new MI[ot](Rt.buffer))),Pt.then(zt=>{for(let Vt=mt.length-1;Vt>=0;Vt--)switch(mt[Vt]){case"delta_filter":yI(zt,ct);break;case"zigzag_filter":_I(zt);break;case"bitshuffle_filter":xI(zt,ot);break;default:throw new Cp(`Unhandled filter "${mt[Vt]}"`)}return{layerName:j,blockIndex:ht,data:zt}}).catch(zt=>{throw zt})}))},Fn(XC,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Fn(dw,"MapboxRasterTile"),Fn(ZC,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class KC{constructor(s){this._stringToNumber={},this._numberToString=[];for(let a=0;a<s.length;a++){const _=s[a];this._stringToNumber[_]=a,this._numberToString[a]=_}}encode(s){return this._stringToNumber[s]}decode(s){return this._numberToString[s]}}const kI=["id","tile","layer","source","sourceLayer","state"];class qx{constructor(s,a,_,j,tt){this.type="Feature",this._vectorTileFeature=s,this._z=a,this._x=_,this._y=j,this.properties=s.properties,this.id=tt}clone(){const s=new qx(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(s.state=Object.assign({},this.state)),this.layer&&(s.layer=Object.assign({},this.layer)),this.source&&(s.source=this.source),this.sourceLayer&&(s.sourceLayer=this.sourceLayer),s}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of kI)this[a]!==void 0&&(s[a]=this[a]);return s}}class YC{constructor(s,a){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Bm(Rn,16,0),this.featureIndexArray=new f1,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(s,a,_,j,tt,rt=0,ot=0){const ct=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(_,j,tt,rt);const ht=this.grid;for(let mt=0;mt<a.length;mt++){const gt=a[mt],_t=[1/0,1/0,-1/0,-1/0];for(let Rt=0;Rt<gt.length;Rt++){const Pt=gt[Rt];_t[0]=Math.min(_t[0],Pt.x),_t[1]=Math.min(_t[1],Pt.y),_t[2]=Math.max(_t[2],Pt.x),_t[3]=Math.max(_t[3],Pt.y)}ot!==0&&(_t[0]-=ot,_t[1]-=ot,_t[2]+=ot,_t[3]+=ot),_t[0]<Rn&&_t[1]<Rn&&_t[2]>=0&&_t[3]>=0&&ht.insert(ct,_t[0],_t[1],_t[2],_t[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new hs(new V1(this.rawTileData)).layers,this.sourceLayerCoder=new KC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const s in this.vtLayers)this.vtFeatures[s]=[]}return this.vtLayers}query(s,a){const{tilespaceGeometry:_,transform:j,tileTransform:tt,pixelPosMatrix:rt,availableImages:ot,worldview:ct}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const ht=_.bufferedTilespaceBounds,mt=this.grid.query(ht.min.x,ht.min.y,ht.max.x,ht.max.y,(Pt,zt,Vt,Gt)=>$a(_.bufferedTilespaceGeometry,Pt,zt,Vt,Gt));mt.sort(DI);let gt=null;j.elevation&&mt.length>0&&(gt=Gx.create(j.elevation,this.tileID));const _t={};let Rt;for(let Pt=0;Pt<mt.length;Pt++){const zt=mt[Pt];if(zt===Rt)continue;Rt=zt;const Vt=this.featureIndexArray.get(zt);let Gt=null;this.is3DTile?this.loadMatchingModelFeature(_t,Vt,s,_,j,ct):this.loadMatchingFeature(_t,Vt,s,ot,ct,(_i,er,rr,_r=0)=>(Gt||(Gt=Ln(_i,this.tileID.canonical,tt)),er.queryIntersectsFeature(_,_i,rr,Gt,this.z,j,rt,gt,_r)))}return _t}loadMatchingFeature(s,a,_,j,tt,rt){const{featureIndex:ot,bucketIndex:ct,sourceLayerIndex:ht,layoutVertexArrayOffset:mt}=a,gt=this.bucketLayerIDs[ct],_t=_.layers,Rt=Object.keys(_t);if(Rt.length&&!Fs(Rt,gt))return;const Pt=_.sourceCache,zt=this.sourceLayerCoder.decode(ht),Vt=this.vtLayers[zt].feature(ot),Gt=this.getId(Vt,zt);for(let _i=0;_i<gt.length;_i++){const er=gt[_i];if(!_t[er])continue;const{styleLayer:rr,targets:_r}=_t[er];let xr={};Gt!==void 0&&(xr=Pt.getFeatureState(rr.sourceLayer,Gt));const Er=!rt||rt(Vt,rr,xr,mt);if(!Er)continue;const Ar=new qx(Vt,this.z,this.x,this.y,Gt);Ar.tile=this.tileID.canonical,Ar.state=xr;let Pr=this.serializedLayersCache.get(er);Pr||(Pr=rr.serialize(),Pr.id=er,this.serializedLayersCache.set(er,Pr)),Ar.source=Pr.source,Ar.sourceLayer=Pr["source-layer"],Ar.layer=Object.assign({},Pr),Ar.layer.paint=QC(Pr.paint,rr.paint,Vt,xr,j),Ar.layer.layout=QC(Pr.layout,rr.layout,Vt,xr,j);let sn=!1;for(const Fr of _r){this.updateFeatureProperties(Ar,Fr);const{filter:on}=Fr;if(on){if(Vt.properties=Ar.properties,on.needGeometry){const gn=xn(Vt,!0);if(!on.filter(new yo(this.tileID.overscaledZ,{worldview:tt}),gn,this.tileID.canonical))continue}else if(!on.filter(new yo(this.tileID.overscaledZ,{worldview:tt}),Vt))continue}sn=!0,Fr.targetId&&this.addFeatureVariant(Ar,Fr)}sn&&this.appendToResult(s,er,ot,Ar,Er)}}loadMatchingModelFeature(s,a,_,j,tt,rt){const{featureIndex:ot,bucketIndex:ct}=a,ht=this.bucketLayerIDs[ct],mt=_.layers,gt=Object.keys(mt);if(!gt.length||Fs(gt,ht))for(let _t=0;_t<ht.length;_t++){const Rt=ht[_t],{styleLayer:Pt,targets:zt}=mt[Rt];if(Pt.type!=="model")continue;const Vt=j.tile,Gt=Vt.getBucket(Pt);if(!(Gt&&Gt instanceof sw))continue;const _i=zP(Gt,ot,j,tt);if(!_i)continue;const{z:er,x:rr,y:_r}=Vt.tileID.canonical,{feature:xr,intersectionZ:Er,position:Ar}=_i;let Pr={};xr.id!==void 0&&(Pr=_.sourceCache.getFeatureState(Pt.sourceLayer,xr.id));const sn=new qx({},er,rr,_r,xr.id);sn.tile=this.tileID.canonical,sn.state=Pr,sn.properties=xr.properties,sn.geometry={type:"Point",coordinates:[Ar.lng,Ar.lat]};let Fr=this.serializedLayersCache.get(Rt);Fr||(Fr=Pt.serialize(),Fr.id=Rt,this.serializedLayersCache.set(Rt,Fr)),sn.source=Fr.source,sn.sourceLayer=Fr["source-layer"],sn.layer=Object.assign({},Fr);let on=!1;for(const gn of zt){this.updateFeatureProperties(sn,gn);const{filter:an}=gn;if(an){if(xr.properties=sn.properties,an.needGeometry){if(!an.filter(new yo(this.tileID.overscaledZ,{worldview:rt}),xr,this.tileID.canonical))continue}else if(!an.filter(new yo(this.tileID.overscaledZ,{worldview:rt}),xr))continue}on=!0,gn.targetId&&this.addFeatureVariant(sn,gn)}on&&this.appendToResult(s,Rt,ot,sn,Er)}}updateFeatureProperties(s,a,_){if(a.properties){const j={};for(const tt in a.properties){const rt=a.properties[tt].evaluate({zoom:this.z},s._vectorTileFeature,s.state,s.tile,_);rt!=null&&(j[tt]=rt)}s.properties=j}}addFeatureVariant(s,a,_){const j={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(j.properties=s.properties),s.variants=s.variants||{},s.variants[a.targetId]=s.variants[a.targetId]||[],s.variants[a.targetId].push(j)}appendToResult(s,a,_,j,tt){let rt=s[a];rt===void 0&&(rt=s[a]=[]),rt.push({featureIndex:_,feature:j,intersectionZ:tt})}lookupSymbolFeatures(s,a,_,j,tt,rt){const ot={};this.loadVTLayers();for(const ct of s)this.loadMatchingFeature(ot,{bucketIndex:a,sourceLayerIndex:_,featureIndex:ct,layoutVertexArrayOffset:0},j,tt,rt);return ot}loadFeature(s){const{featureIndex:a,sourceLayerIndex:_}=s;this.loadVTLayers();const j=this.sourceLayerCoder.decode(_),tt=this.vtFeatures[j];if(tt[a])return tt[a];const rt=this.vtLayers[j].feature(a);return tt[a]=rt,rt}hasLayer(s){for(const a of this.bucketLayerIDs)for(const _ of a)if(s===_)return!0;return!1}getId(s,a){let _=s.id;if(this.promoteId){const j=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(j!=null)if(Array.isArray(j)){if(!this.promoteIdExpression){const tt=xp(j);if(tt.result!=="success"){const rt=tt.value.map(ot=>`${ot.key}: ${ot.message}`).join(", ");return void Es(`Failed to create expression for promoteId: ${rt}`)}this.promoteIdExpression=tt.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new np),_=this.promoteIdExpression.evaluate({zoom:0},s)}else _=s.properties[j];typeof _=="boolean"&&(_=Number(_))}return _}}function QC(d,s,a,_,j){return ds(d,(tt,rt)=>{const ot=s instanceof Hm?s.get(rt):null;return ot&&ot.evaluate?ot.evaluate(a,_,void 0,j):ot})}function DI(d,s){return s-d}Fn(YC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const JC=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class lT{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,_]=new Uint8Array(s,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const j=_>>4;if(j!==1)throw new Error(`Got v${j} data when expected v1.`);const tt=JC[15&_];if(!tt)throw new Error("Unrecognized array type.");const[rt]=new Uint16Array(s,2,1),[ot]=new Uint32Array(s,4,1);return new lT(ot,rt,tt,s)}constructor(s,a=64,_=Float64Array,j){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=_,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const tt=JC.indexOf(this.ArrayType),rt=2*s*this.ArrayType.BYTES_PER_ELEMENT,ot=s*this.IndexArrayType.BYTES_PER_ELEMENT,ct=(8-ot%8)%8;if(tt<0)throw new Error(`Unexpected typed array class: ${_}.`);j&&j instanceof ArrayBuffer?(this.data=j,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+ot+ct,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+rt+ot+ct),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+ot+ct,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+tt]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=s)}add(s,a){const _=this._pos>>1;return this.ids[_]=_,this.coords[this._pos++]=s,this.coords[this._pos++]=a,_}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return cT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,a,_,j){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:tt,coords:rt,nodeSize:ot}=this,ct=[0,tt.length-1,0],ht=[];for(;ct.length;){const mt=ct.pop()||0,gt=ct.pop()||0,_t=ct.pop()||0;if(gt-_t<=ot){for(let Vt=_t;Vt<=gt;Vt++){const Gt=rt[2*Vt],_i=rt[2*Vt+1];Gt>=s&&Gt<=_&&_i>=a&&_i<=j&&ht.push(tt[Vt])}continue}const Rt=_t+gt>>1,Pt=rt[2*Rt],zt=rt[2*Rt+1];Pt>=s&&Pt<=_&&zt>=a&&zt<=j&&ht.push(tt[Rt]),(mt===0?s<=Pt:a<=zt)&&(ct.push(_t),ct.push(Rt-1),ct.push(1-mt)),(mt===0?_>=Pt:j>=zt)&&(ct.push(Rt+1),ct.push(gt),ct.push(1-mt))}return ht}within(s,a,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:j,coords:tt,nodeSize:rt}=this,ot=[0,j.length-1,0],ct=[],ht=_*_;for(;ot.length;){const mt=ot.pop()||0,gt=ot.pop()||0,_t=ot.pop()||0;if(gt-_t<=rt){for(let Vt=_t;Vt<=gt;Vt++)tA(tt[2*Vt],tt[2*Vt+1],s,a)<=ht&&ct.push(j[Vt]);continue}const Rt=_t+gt>>1,Pt=tt[2*Rt],zt=tt[2*Rt+1];tA(Pt,zt,s,a)<=ht&&ct.push(j[Rt]),(mt===0?s-_<=Pt:a-_<=zt)&&(ot.push(_t),ot.push(Rt-1),ot.push(1-mt)),(mt===0?s+_>=Pt:a+_>=zt)&&(ot.push(Rt+1),ot.push(gt),ot.push(1-mt))}return ct}}function cT(d,s,a,_,j,tt){if(j-_<=a)return;const rt=_+j>>1;eA(d,s,rt,_,j,tt),cT(d,s,a,_,rt-1,1-tt),cT(d,s,a,rt+1,j,1-tt)}function eA(d,s,a,_,j,tt){for(;j>_;){if(j-_>600){const ht=j-_+1,mt=a-_+1,gt=Math.log(ht),_t=.5*Math.exp(2*gt/3),Rt=.5*Math.sqrt(gt*_t*(ht-_t)/ht)*(mt-ht/2<0?-1:1);eA(d,s,a,Math.max(_,Math.floor(a-mt*_t/ht+Rt)),Math.min(j,Math.floor(a+(ht-mt)*_t/ht+Rt)),tt)}const rt=s[2*a+tt];let ot=_,ct=j;for(C0(d,s,_,a),s[2*j+tt]>rt&&C0(d,s,_,j);ot<ct;){for(C0(d,s,ot,ct),ot++,ct--;s[2*ot+tt]<rt;)ot++;for(;s[2*ct+tt]>rt;)ct--}s[2*_+tt]===rt?C0(d,s,_,ct):(ct++,C0(d,s,ct,j)),ct<=a&&(_=ct+1),a<=ct&&(j=ct-1)}}function C0(d,s,a,_){uT(d,a,_),uT(s,2*a,2*_),uT(s,2*a+1,2*_+1)}function uT(d,s,a){const _=d[s];d[s]=d[a],d[a]=_}function tA(d,s,a,_){const j=d-a,tt=s-_;return j*j+tt*tt}h.$=Ku,h.A=Jr,h.B=Iy,h.C=2,h.D=Dx,h.E=kp,h.F=d0,h.G=C2,h.H=_c,h.I=Jl,h.J=fx,h.K=ts,h.L=Ml,h.M=tx,h.N=ex,h.O=_v,h.P=yn,h.Q=vv,h.R=ny,h.S=Wm,h.T=EE,h.U=xp,h.V=nw,h.W=bv,h.X=wy,h.Y=by,h.Z=U_,h._=eu,h.a=function(d){return Gl.API_CDN_URL_REGEX.test(d)},h.a$=dr,h.a0=go,h.a1=uy,h.a2=mx,h.a3=class extends nw{},h.a4=ix,h.a5=yv,h.a6=jr,h.a7=function(d){const s=d.value;return s?go(s)?YE(s,!0)?[]:[new nw(d.key,s,`invalid url "${s}"`)]:[new nw(d.key,s,`string expected, "${ts(s)}" found`)]:[]},h.a8=Q0,h.a9=$o,h.aA=fr,h.aB=Tt,h.aC=Uo,h.aD=_e,h.aE=Nl,h.aF=sr,h.aG=Br,h.aH=function(d,s){const a={};for(let _=0;_<s.length;_++){const j=s[_];j in d&&(a[j]=d[j])}return a},h.aI=qt,h.aJ=pr,h.aK=class{constructor(d){this.entries={},this.scheduler=d}request(d,s,a,_){const j=this.entries[d]=this.entries[d]||{callbacks:[]};if(j.result){const[tt,rt]=j.result;return this.scheduler?this.scheduler.add(()=>{_(tt,rt)},s):_(tt,rt),()=>{}}return j.callbacks.push(_),j.cancel||(j.cancel=a((tt,rt)=>{j.result=[tt,rt];for(const ot of j.callbacks)this.scheduler?this.scheduler.add(()=>{ot(tt,rt)},s):ot(tt,rt);setTimeout(()=>delete this.entries[d],3e3)})),()=>{j.result||(j.callbacks=j.callbacks.filter(tt=>tt!==_),j.callbacks.length||(j.cancel(),delete this.entries[d]))}}},h.aL=function(d,s,a){const _=JSON.stringify(d.request);return d.data&&(this.deduped.entries[_]={result:[null,d.data]}),this.deduped.request(_,{type:"parseTile",isSymbolTile:d.isSymbolTile,zoom:d.tileZoom},j=>{const tt=Ip(d.request,(rt,ot,ct,ht)=>{rt?j(rt):ot&&j(null,{vectorTile:a?void 0:new hs(new V1(ot)),rawData:ot,cacheControl:ct,expires:ht})});return()=>{tt.cancel(),j()}},s)},h.aM=function(d){mp++,mp>Xu&&(d.getActor().send("enforceCacheSizeLimit",Du),mp=0)},h.aN=function(d){return d<=1?1:Math.pow(2,Math.floor(Math.log2(d)))},h.aO=pu,h.aP=tC,h.aQ=aC,h.aR=Ot,h.aS=eC,h.aT=function(d,s){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){s(null,a)};for(let _=0;_<d.length;_++){const j=document.createElement("source");em(d[_])||(a.crossOrigin="Anonymous"),j.src=d[_],a.appendChild(j)}return{cancel:()=>{}}},h.aU=o0,h.aV=function(d){return fetch(d).then(s=>s.arrayBuffer()).then(s=>MS(s,0,d))},h.aW=NS,h.aX=class{constructor(d,s,a,_){this.id=d,this.position=s!=null?new Ot(s[0],s[1]):new Ot(0,0),this.orientation=a??[0,0,0],this.nodes=_,this.uploaded=!1,this.aabb=new cs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(d,s){if(Tt(d.matrix,s,d.matrix),d.meshes)for(const a of d.meshes){const _=cs.applyTransformFast(a.aabb,d.matrix);this.aabb.encapsulate(_)}if(d.children)for(const a of d.children)this._applyTransformations(a,d.matrix)}computeBoundsAndApplyParent(){const d=At([]);for(const s of this.nodes)this._applyTransformations(s,d)}computeModelMatrix(d,s,a,_,j,tt,rt=!1){OS(this.matrix,this,d.transform,this.position,s,a,_,j,tt,rt)}upload(d){if(!this.uploaded){for(const s of this.nodes)CE(s,d);for(const s of this.nodes)B1(s);this.uploaded=!0}}destroy(){for(const d of this.nodes)AE(d)}},h.aY=rs,h.aZ=m0,h.a_=gr,h.aa=En,h.ab=class{constructor(d){this.specification=d}possiblyEvaluate(d,s){return na(d.expression.evaluate(s))}interpolate(d,s,a){return{x:ns(d.x,s.x,a),y:ns(d.y,s.y,a),z:ns(d.z,s.z,a),azimuthal:ns(d.azimuthal,s.azimuthal,a),polar:ns(d.polar,s.polar,a)}}},h.ac=yo,h.ad=hm,h.ae=Yr,h.af=Vs,h.ag=rn,h.ah=Ur,h.ai=Hm,h.aj=Ny,h.ak=ns,h.al=Rn,h.am=Yy,h.an=Lr,h.ao=Js,h.ap=class{constructor(d){this.specification=d}possiblyEvaluate(d,s){return function([a,_]){const j=na([1,a,_]);return{x:j.x,y:j.y,z:j.z}}(d.expression.evaluate(s))}interpolate(d,s,a){return{x:ns(d.x,s.x,a),y:ns(d.y,s.y,a),z:ns(d.z,s.z,a)}}},h.aq=function(d,s,a=0,_=!0){const j=new yn(a,a),tt=d.sub(j),rt=s.add(j),ot=[tt,new yn(rt.x,tt.y),rt,new yn(tt.x,rt.y)];return _&&ot.push(tt.clone()),ot},h.ar=function(d,s){const a=[];for(let _=0;_<d.length;_++){const j=Rr(_-1,-1,d.length-1),tt=Rr(_+1,-1,d.length-1),rt=d[_],ot=d[tt],ct=d[j].sub(rt).unit(),ht=ot.sub(rt).unit(),mt=ht.angleWithSep(ct.x,ct.y),gt=ct.add(ht).unit().mult(-1*s/Math.sin(mt/2));a.push(rt.add(gt))}return a},h.as=B2,h.at=$a,h.au=function(d,s,a=0){return Zr(((s.x-a)*d.scale-d.x)*Rn,(s.y*d.scale-d.y)*Rn,ur(s.z,s.y))},h.av=Hs,h.aw=ss,h.ax=Xs,h.ay=YS,h.az=function(d){let s=1/0,a=1/0,_=-1/0,j=-1/0;for(const tt of d)s=Math.min(s,tt.x),a=Math.min(a,tt.y),_=Math.max(_,tt.x),j=Math.max(j,tt.y);return{min:new yn(s,a),max:new yn(_,j)}},h.b=function(d){return Gl.API_FONTS_REGEX.test(d)},h.b$=hE,h.b0=Zm,h.b1=Dl,h.b2=ln,h.b3=Bv,h.b4=ew,h.b5=function(){vp.isLoading()||vp.isLoaded()||dx()!=="deferred"||Vm()},h.b6=c_,h.b7=xn,h.b8=qx,h.b9=Ws,h.bA=At,h.bB=Kt,h.bC=Dt,h.bD=function(d,s){const{x:a,y:_}=d.point,j=xT(a,_,d.worldSize/d._pixelsPerMercatorPixel,0,0);return Tt(j,j,Qw(wm(s)))},h.bE=xt,h.bF=ws,h.bG=function(d,s){var a=s[0]-d[0],_=s[1]-d[1],j=s[2]-d[2];return Math.sqrt(a*a+_*_+j*j)},h.bH=pn,h.bI=$s,h.bJ=Ls,h.bK=h0,h.bL=Gu,h.bM=zE,h.bN=function(d,s,a,_,j){const tt=5*s+2;d.float32[tt+0]=a,d.float32[tt+1]=_,d.float32[tt+2]=j},h.bO=_b,h.bP=bu,h.bQ=_d,h.bR=Hu,h.bS=wu,h.bT=Rr,h.bU=function(d,s,a,_){var j=new ft(4);return j[0]=d,j[1]=s,j[2]=a,j[3]=_,j},h.bV=D1,h.bW=Bu,h.bX=Zl,h.bY=KT,h.bZ=lC,h.b_=eS,h.ba=ME,h.bb=lE,h.bc=Ln,h.bd=gm,h.be=Tx,h.bf=pT,h.bg=Bo,h.bh=Mx,h.bi=XE,h.bj=function(d,s){const a=Ny(s.zoom);if(a===0)return wm(d);const _=w1(d),j=Yw(_),tt=sr(_.getWest())*s.worldSize,rt=sr(_.getEast())*s.worldSize,ot=pr(_.getNorth())*s.worldSize,ct=pr(_.getSouth())*s.worldSize,ht=[tt,ot,0],mt=[rt,ot,0],gt=[tt,ct,0],_t=[rt,ct,0],Rt=Bt([],s.globeMatrix);return Vs(ht,ht,Rt),Vs(mt,mt,Rt),Vs(gt,gt,Rt),Vs(_t,_t,Rt),j[0]=Qm(j[0],gt,a),j[1]=Qm(j[1],_t,a),j[2]=Qm(j[2],mt,a),j[3]=Qm(j[3],ht,a),cs.fromPoints(j)},h.bk=T1,h.bl=Bt,h.bm=$v,h.bn=Qm,h.bo=qm,h.bp=aA,h.bq=ir,h.br=It,h.bs=dw,h.bt=V1,h.bu=Ip,h.bv=function(d,s){const a=[];for(const _ in d)_ in s||a.push(_);return a},h.bw=Xr,h.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.by=qu,h.bz=function(d){var s=new ft(16);return s[0]=d[0],s[1]=d[1],s[2]=d[2],s[3]=d[3],s[4]=d[4],s[5]=d[5],s[6]=d[6],s[7]=d[7],s[8]=d[8],s[9]=d[9],s[10]=d[10],s[11]=d[11],s[12]=d[12],s[13]=d[13],s[14]=d[14],s[15]=d[15],s},h.c=P_,h.c$=function(d){return d*d*d*d*d},h.c0=OE,h.c1=D2,h.c2=UE,h.c3=lT,h.c4=Cr,h.c5=Xo,h.c6=Vl,h.c7=function(d,s,a){a*=.5;var _=s[0],j=s[1],tt=s[2],rt=s[3],ot=Math.sin(a),ct=Math.cos(a);return d[0]=_*ct+j*ot,d[1]=j*ct-_*ot,d[2]=tt*ct+rt*ot,d[3]=rt*ct-tt*ot,d},h.c8=_a,h.c9=zo,h.cA=Ss,h.cB=DS,h.cC=Vp,h.cD=gT,h.cE=function(d,s,a,_,j,tt,rt,ot,ct){if(ct.name==="globe")return gT(d,s,new Vp(a,_,j),!1);const ht=m0({z:a,x:_,y:j},ct);return new cs([(tt+ht.x/ht.scale)*s,s*(ht.y/ht.scale),rt],[(tt+ht.x2/ht.scale)*s,s*(ht.y2/ht.scale),ot])},h.cF=function(d,s,a){return d[0]=Math.min(s[0],a[0]),d[1]=Math.min(s[1],a[1]),d[2]=Math.min(s[2],a[2]),d[3]=Math.min(s[3],a[3]),d},h.cG=function(d,s,a){return d[0]=Math.max(s[0],a[0]),d[1]=Math.max(s[1],a[1]),d[2]=Math.max(s[2],a[2]),d[3]=Math.max(s[3],a[3]),d},h.cH=function(d){const s=Math.round((d+45+360)%360/90)%4;return Qt[s]},h.cI=yr,h.cJ=Io,h.cK=st,h.cL=function(d){const s=At(new Float64Array(16));Tt(s,d.pixelMatrix,d.globeMatrix);const a=[0,yt,0],_=[0,vt,0];return Vs(a,a,s),Vs(_,_,s),[a[0]>0&&a[0]<=d.width&&a[1]>0&&a[1]<=d.height&&!eE(d,new Ot(d.center.lat,90)),_[0]>0&&_[0]<=d.width&&_[1]>0&&_[1]<=d.height&&!eE(d,new Ot(d.center.lat,-90))]},h.cM=function(d,s){const{scale:a}=d.tileTransform,_=a*Rn/(d.tileSize*Math.pow(2,s.zoom-d.tileID.overscaledZ+d.tileID.canonical.z));return function(j,tt,rt){var ot=tt[1],ct=tt[2],ht=tt[3],mt=rt[0],gt=rt[1];return j[0]=tt[0]*mt,j[1]=ot*mt,j[2]=ct*gt,j[3]=ht*gt,j}(new Float32Array(4),s.inverseAdjustmentMatrix,[_,_])},h.cN=z1,h.cO=br,h.cP=kS,h.cQ=function(d){const s=kS(d,!0);return xt([],[s[0],s[1],s[4],s[5]])},h.cR=St,h.cS=to,h.cT=jt,h.cU=function(d){const{x:s,y:a}=d.point,{lng:_,lat:j}=d._center;return xT(s,a,d.worldSize,_,j)},h.cV=Ut,h.cW=Wt,h.cX=Ix,h.cY=tu,h.cZ=nt,h.c_=function(d,s,a){let _=0;for(let j=0;j<2;++j)d[j]>0&&(_+=(d[j]-0)*(d[j]-0)),s[j]<0&&(_+=(0-s[j])*(0-s[j]));return _},h.ca=function(d,s){return d[0]=-s[0],d[1]=-s[1],d[2]=-s[2],d[3]=s[3],d},h.cb=kr,h.cc=function(d,s,a,_,j){var tt=1/Math.tan(s/2);if(d[0]=tt/a,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=tt,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=-1,d[12]=0,d[13]=0,d[15]=0,j!=null&&j!==1/0){var rt=1/(_-j);d[10]=(j+_)*rt,d[14]=2*j*_*rt}else d[10]=-1,d[14]=-2*_;return d},h.cd=function(d,s,a,_,j,tt,rt){var ot=1/(s-a),ct=1/(_-j),ht=1/(tt-rt);return d[0]=-2*ot,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=-2*ct,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=2*ht,d[11]=0,d[12]=(s+a)*ot,d[13]=(j+_)*ct,d[14]=(rt+tt)*ht,d[15]=1,d},h.ce=hr,h.cf=function(d,s,a){d[4*s+0]=a[0],d[4*s+1]=a[1],d[4*s+2]=a[2],d[4*s+3]=a[3]},h.cg=y_,h.ch=__,h.ci=ba,h.cj=wp,h.ck=v_,h.cl=H2,h.cm=function(){var d=new ft(4);return ft!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d},h.cn=function(d,s,a){var _=s[0],j=s[1],tt=s[2],rt=s[3],ot=Math.sin(a),ct=Math.cos(a);return d[0]=_*ct+tt*ot,d[1]=j*ct+rt*ot,d[2]=_*-ot+tt*ct,d[3]=j*-ot+rt*ct,d},h.co=function(d,s){return d[0]===s[0]&&d[1]===s[1]&&d[2]===s[2]&&d[3]===s[3]},h.cp=Jn,h.cq=function(d){var s=d[0],a=d[1],_=d[2],j=d[3];return Math.sqrt(s*s+a*a+_*_+j*j)},h.cr=su,h.cs=Po,h.ct=Px,h.cu=3,h.cv=2,h.cw=7,h.cx=6,h.cy=vo,h.cz=Sr,h.d=function(d){return Gl.API_TILEJSON_REGEX.test(d)},h.d$=t2,h.d0=tr,h.d1=45,h.d2=x_,h.d3=function(d,s,a){const _=Math.sqrt(d*d+s*s+a*a),j=_>0?Math.acos(a/_)*tp:0;let tt=d!==0||s!==0?Math.atan2(-s,-d)*tp+90:0;return tt<0&&(tt+=360),[_,tt,j]},h.d4=Zr,h.d5=na,h.d6=Nr,h.d7=Xt,h.d8=cs,h.d9=mr,h.dA=function(d,s,a){const _=Ny(a.zoom),j=d.style.map._antialias,tt=d.terrain&&d.terrain.exaggeration()>0;return _===0&&!j&&!tt},h.dB=function(d){const s=d.pixelsPerMeter,a=s/hr(1,d.center.lat),_=At(new Float64Array(16));return It(_,_,[d.point.x,d.point.y,0]),St(_,_,[a,a,s]),Float32Array.from(_)},h.dC=w1,h.dD=function(d){const s=yr-5;d=fr(d,-s,s)/s*90;const a=Math.pow(Math.abs(Math.sin(Lr(d))),3);return Math.round(a*(pt.length-1))},h.dE=function(d,s,a,_){const j=s.getNorth(),tt=s.getSouth(),rt=s.getWest(),ot=s.getEast(),ct=1<<d.z,ht=ot-rt,mt=j-tt,gt=ht/ut,_t=-mt/pt[a],Rt=[0,gt,0,_t,0,0,j,rt,0];if(d.z>0){const Pt=180/_;kt(Rt,Rt,[Pt/ht+1,0,0,0,Pt/mt+1,0,-.5*Pt/gt,.5*Pt/_t,1])}return Rt[2]=ct,Rt[5]=d.x,Rt[8]=d.y,Rt},h.dF=wm,h.dG=function(d,s,a){const _=At(new Float64Array(16)),j=(s/(1<<d)-.5)*Math.PI*2;return Ht(_,a.globeMatrix,j),Float32Array.from(_)},h.dH=class{isDataAvailableAtPoint(d){const s=this._source();if(this.isUsingMockSource()||!s||d.y<0||d.y>1)return!1;const a=s.getSource().maxzoom,_=1<<a,j=Math.floor(d.x),tt=Math.floor((d.x-j)*_),rt=Math.floor(d.y*_),ot=this.findDEMTileFor(new pu(a,j,a,tt,rt));return!(!ot||!ot.dem)}getAtPointOrZero(d,s=0){return this.getAtPoint(d,s)||0}getAtPoint(d,s,a=!0){if(this.isUsingMockSource())return null;s==null&&(s=null);const _=this._source();if(!_||d.y<0||d.y>1)return s;const j=_.getSource().maxzoom,tt=1<<j,rt=Math.floor(d.x),ot=d.x-rt,ct=new pu(j,rt,j,Math.floor(ot*tt),Math.floor(d.y*tt)),ht=this.findDEMTileFor(ct);if(!ht||!ht.dem)return s;const mt=ht.dem,gt=1<<ht.tileID.canonical.z,_t=(ot*gt-ht.tileID.canonical.x)*mt.dim,Rt=(d.y*gt-ht.tileID.canonical.y)*mt.dim,Pt=Math.floor(_t),zt=Math.floor(Rt);return(a?this.exaggeration():1)*ns(ns(mt.get(Pt,zt),mt.get(Pt,zt+1),Rt-zt),ns(mt.get(Pt+1,zt),mt.get(Pt+1,zt+1),Rt-zt),_t-Pt)}getAtTileOffset(d,s,a){const _=1<<d.canonical.z;return this.getAtPointOrZero(new Yr(d.wrap+(d.canonical.x+s/Rn)/_,(d.canonical.y+a/Rn)/_))}getAtTileOffsetFunc(d,s,a,_){return j=>{const tt=this.getAtTileOffset(d,j.x,j.y),rt=_.upVector(d.canonical,j.x,j.y);return Cr(rt,rt,tt*_.upVectorScale(d.canonical,s,a).metersToTile),rt}}getForTilePoints(d,s,a,_){if(this.isUsingMockSource())return!1;const j=Gx.create(this,d,_);return!!j&&(s.forEach(tt=>{tt[2]=this.exaggeration()*j.getElevationAt(tt[0],tt[1],a)}),!0)}getMinMaxForTile(d){if(this.isUsingMockSource())return null;const s=this.findDEMTileFor(d);if(!s||!s.dem)return null;const a=s.dem.tree,_=s.tileID,j=1<<d.canonical.z-_.canonical.z;let tt=d.canonical.x/j-_.canonical.x,rt=d.canonical.y/j-_.canonical.y,ot=0;for(let ct=0;ct<d.canonical.z-_.canonical.z&&!a.leaves[ot];ct++){tt*=2,rt*=2;const ht=2*Math.floor(rt)+Math.floor(tt);ot=a.childOffsets[ot]+ht,tt%=1,rt%=1}return{min:this.exaggeration()*a.minimums[ot],max:this.exaggeration()*a.maximums[ot]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(d,s,a){throw new Error("Pure virtual method called.")}pointCoordinate(d){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(d){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const d=this.visibleDemTiles;if(d.length===0)return null;let s=!1,a=Number.MAX_VALUE,_=Number.MIN_VALUE;for(const j of d){const tt=this.getMinMaxForTile(j.tileID);tt&&(a=Math.min(a,tt.min),_=Math.max(_,tt.max),s=!0)}return s?{min:a,max:_}:null}},h.dI=kT,h.dJ=b1,h.dK=function(d,s){return[Math.pow(d[0],2.2)*s,Math.pow(d[1],2.2)*s,Math.pow(d[2],2.2)*s]},h.dL=Ct,h.dM=function(d,s){var a=Math.sin(s),_=Math.cos(s);return d[0]=_,d[1]=a,d[2]=0,d[3]=-a,d[4]=_,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},h.dN=bo,h.dO=_T,h.dP=Ul,h.dQ=mu,h.dR=256,h.dS=function(d,s){const a=[0,0,0];return Vs(a,a,T1(wm(s.canonical))),Vs(a,a,d),a},h.dT=d=>({u_matrix:new v_(d),u_texsize:new wp(d),u_pixels_to_tile_units:new Rx(d),u_device_pixel_ratio:new ba(d),u_width_scale:new ba(d),u_floor_width_scale:new ba(d),u_image:new y_(d),u_units_to_pixels:new wp(d),u_tile_units_to_pixels:new ba(d),u_alpha_discard_threshold:new ba(d),u_trim_offset:new wp(d),u_trim_fade_range:new wp(d),u_trim_color:new x_(d),u_emissive_strength:new ba(d),u_zbias_factor:new ba(d),u_tile_to_meter:new ba(d),u_ground_shadow_factor:new __(d),u_pattern_transition:new ba(d)}),h.dU=d=>({u_matrix:new v_(d),u_pixels_to_tile_units:new Rx(d),u_device_pixel_ratio:new ba(d),u_width_scale:new ba(d),u_floor_width_scale:new ba(d),u_units_to_pixels:new wp(d),u_dash_image:new y_(d),u_gradient_image:new y_(d),u_image_height:new ba(d),u_texsize:new wp(d),u_tile_units_to_pixels:new ba(d),u_alpha_discard_threshold:new ba(d),u_trim_offset:new wp(d),u_trim_fade_range:new wp(d),u_trim_color:new x_(d),u_emissive_strength:new ba(d),u_zbias_factor:new ba(d),u_tile_to_meter:new ba(d),u_ground_shadow_factor:new __(d)}),h.dV=d=>({u_camera_to_center_distance:new ba(d),u_extrude_scale:new Rx(d),u_device_pixel_ratio:new ba(d),u_matrix:new v_(d),u_inv_rot_matrix:new v_(d),u_merc_center:new wp(d),u_tile_id:new __(d),u_zoom_transition:new ba(d),u_up_dir:new __(d),u_emissive_strength:new ba(d)}),h.dW=jv,h.dX=WR,h.dY=class{constructor(d,s,a,_){this.context=d,this.format=_,this.size=a,this.texture=d.gl.createTexture();const[j,tt,rt]=this.size,{gl:ot}=d;ot.bindTexture(ot.TEXTURE_3D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in s&&s.data&&ot.texImage3D(ot.TEXTURE_3D,0,this.format,j,tt,rt,0,bE(this.format),wE(this.format),s.data)}bind(d,s){const{context:a}=this,{gl:_}=a;_.bindTexture(_.TEXTURE_3D,this.texture),d!==this.minFilter&&(_.texParameteri(_.TEXTURE_3D,_.TEXTURE_MAG_FILTER,d),_.texParameteri(_.TEXTURE_3D,_.TEXTURE_MIN_FILTER,d),this.minFilter=d),s!==this.wrapS&&(_.texParameteri(_.TEXTURE_3D,_.TEXTURE_WRAP_S,s),_.texParameteri(_.TEXTURE_3D,_.TEXTURE_WRAP_T,s),this.wrapS=s)}destroy(){const{gl:d}=this.context;d.deleteTexture(this.texture),this.texture=null}},h.dZ=wT,h.d_=(d,s,a,_,j,tt)=>{const rt=d.transform,ot=rt.projection.name==="globe";let ct;if(tt.paint.get("circle-pitch-alignment")==="map")if(ot){const mt=_T(rt.zoom,s.canonical)*rt._pixelsPerMercatorPixel;ct=Float32Array.from([mt,0,0,mt])}else ct=rt.calculatePixelsToTileUnitsMatrix(a);else ct=new Float32Array([rt.pixelsToGLUnits[0],0,0,rt.pixelsToGLUnits[1]]);const ht={u_camera_to_center_distance:d.transform.getCameraToCenterDistance(rt.projection),u_matrix:d.translatePosMatrix(s.projMatrix,a,tt.paint.get("circle-translate"),tt.paint.get("circle-translate-anchor")),u_device_pixel_ratio:gu.devicePixelRatio,u_extrude_scale:ct,u_inv_rot_matrix:dA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:tt.paint.get("circle-emissive-strength")};if(ot){ht.u_inv_rot_matrix=_,ht.u_merc_center=j,ht.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],ht.u_zoom_transition=Ny(rt.zoom);const mt=j[0]*Rn,gt=j[1]*Rn;ht.u_up_dir=rt.projection.upVector(new Vp(0,0,0),mt,gt)}return ht},h.da=function(d){return[Math.pow(d[0],1/2.2),Math.pow(d[1],1/2.2),Math.pow(d[2],1/2.2)]},h.db=YE,h.dc=function(d,s){return d.readFields(VP,{icons:[]},s)},h.dd=L1,h.de=Bx,h.df=BE,h.dg=_f,h.dh=Y0,h.di=Cm,h.dj=ay,h.dk=Rs,h.dl=function(d){const s=d.indexOf(u_);return s>=0?d.slice(0,s):d},h.dm=function(d){return d.indexOf(u_)>=0},h.dn=function(d){const s=d.lastIndexOf(u_);return s>=0?d.slice(s+1):""},h.dp=function(d){const s=[],a=d.id;return a===void 0&&s.push({message:`layers.${a}: missing required property "id"`}),d.render===void 0&&s.push({message:`layers.${a}: missing required method "render"`}),d.renderingMode&&d.renderingMode!=="2d"&&d.renderingMode!=="3d"&&s.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),s},h.dq=function(d,s,a,_){return d.type==="custom"?new jP(d,s):new NP[d.type](d,s,a,_)},h.dr=js,h.ds=function(d){const s=d.indexOf(u_);return s>=0?d.slice(s+1):""},h.dt=class extends qx{constructor(d,s){super(d._vectorTileFeature,d._z,d._x,d._y,d.id),d.state&&(this.state=Object.assign({},d.state)),this.target=s.target,this.namespace=s.namespace,s.properties&&(this.properties=s.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=d.source,this.sourceLayer=d.sourceLayer,this.layer=d.layer)}toJSON(){const d=super.toJSON();return d.target=this.target,d.namespace=this.namespace,d}},h.du=Cv,h.dv=Ns,h.dw=function(d){return d({pluginStatus:hu,pluginURL:fm}),Cv.on("pluginStateChange",d),d},h.dx=_1,h.dy=class extends bp{constructor(d){super(d),this.current=Zw}set(d,s,a){if(this.fetchUniformLocation(d,s)){for(let _=0;_<9;_++)if(a[_]!==this.current[_]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},h.dz=lr,h.e=Gl,h.e$=function(){const d=r0;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(gE),r0=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},h.e0=bn,h.e1=(d,s,a,_,j,tt,rt,ot,ct,ht)=>{const mt=d.transform,gt=mt.pitch<15?QS(.07,.7,fr((14-mt.zoom)/5,0,1)):.07,_t=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:e2(d,s,a,_),u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:mt.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:j,u_width_scale:tt,u_floor_width_scale:rt,u_image:0,u_tile_units_to_pixels:JS(s,mt),u_units_to_pixels:[1/mt.pixelsToGLUnits[0],1/mt.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:ot,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(_t?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:gt,u_tile_to_meter:Nr(s.tileID.canonical,0),u_ground_shadow_factor:ct,u_pattern_transition:ht}},h.e2=(d,s,a,_,j,tt,rt,ot,ct,ht)=>{const mt=d.transform,gt=mt.calculatePixelsToTileUnitsMatrix(s),_t=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",Rt=mt.pitch<15?QS(.07,.7,fr((14-mt.zoom)/5,0,1)):.07;return{u_matrix:e2(d,s,a,_),u_pixels_to_tile_units:gt,u_device_pixel_ratio:tt,u_width_scale:rt,u_floor_width_scale:ot,u_units_to_pixels:[1/mt.pixelsToGLUnits[0],1/mt.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:j,u_texsize:i2(a)&&s.lineAtlasTexture?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:JS(s,d.transform),u_alpha_discard_threshold:0,u_trim_offset:ct,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(_t?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:Rt,u_tile_to_meter:Nr(s.tileID.canonical,0),u_ground_shadow_factor:ht}},h.e3=Hn,h.e4=Hv,h.e5=ur,h.e6=sA,h.e7=k1,h.e8=dS,h.e9=Vy,h.eA=Sl,h.eB=jy,h.eC=function(d,s,a,_,j,tt,rt,ot,ct,ht,mt,gt,_t,Rt,Pt,zt){var Vt=new ft(16);return Vt[0]=d,Vt[1]=s,Vt[2]=a,Vt[3]=_,Vt[4]=j,Vt[5]=tt,Vt[6]=rt,Vt[7]=ot,Vt[8]=ct,Vt[9]=ht,Vt[10]=mt,Vt[11]=gt,Vt[12]=_t,Vt[13]=Rt,Vt[14]=Pt,Vt[15]=zt,Vt},h.eD=Lt,h.eE=p_,h.eF=wx,h.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new yn(1/0,1/0),max:new yn(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(d,s=!1){const a=QT(new yn(0,0),new yn(Rn,Rn),d),_=[];if(s&&!cE(a,this._globalClipBounds))return _;for(const j of this._activeRegions){if(j.hiddenByOverlap||!cE(a,j))continue;const tt=BA(j.min,j.max,d);_.push({min:tt.min,max:tt.max,sourceId:this._sourceIds[j.priority],footprint:j.footprint,footprintTileId:j.tileId,order:j.order,clipMask:j.clipMask,clipScope:j.clipScope})}return _}setSources(d){this._setSources(d.map(s=>({getSourceId:()=>s.cache.id,getFootprints:()=>{const a=[];for(const _ of s.cache.getVisibleCoordinates()){const j=s.cache.getTile(_).buckets[s.layer];j&&j.updateFootprints(_.toUnwrapped(),a)}return a},getOrder:()=>s.order,getClipMask:()=>s.clipMask,getClipScope:()=>s.clipScope})))}_addSource(d){const s=d.getFootprints();if(s.length===0)return;const a=d.getOrder(),_=d.getClipMask(),j=d.getClipScope();for(const tt of s){if(!tt.footprint)continue;const rt=QT(tt.footprint.min,tt.footprint.max,tt.id);this._activeRegions.push({min:rt.min,max:rt.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:tt.id,footprint:tt.footprint,order:a,clipMask:_,clipScope:j})}this._sourceIds.push(d.getSourceId())}_computeReplacement(){this._activeRegions.sort((s,a)=>s.priority-a.priority||P1(s.min,a.min)||P1(s.max,a.max)||s.order-a.order||s.clipMask-a.clipMask||function(_,j){const tt=(rt,ot)=>rt+ot;return _.length-j.length||_.reduce(tt,"").localeCompare(j.reduce(tt,""))}(s.clipScope,a.clipScope));let d=this._activeRegions.length!==this._prevRegions.length;if(!d){let s=0;for(;!d&&s!==this._activeRegions.length;){const a=this._activeRegions[s],_=this._prevRegions[s];d=a.priority!==_.priority||!YT(a,_)||a.order!==_.order||a.clipMask!==_.clipMask||!qu(a.clipScope,_.clipScope),++s}}if(d){++this._updateTime;for(const a of this._activeRegions)a.order!==Yv&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const s=a=>{const _=this._activeRegions;if(a>=_.length)return a;const j=_[a].priority;for(;a<_.length&&_[a].priority===j;)++a;return a};if(this._sourceIds.length>1){let a=0,_=s(a);for(;a!==_;){let j=a;const tt=a;for(;j!==_;){const rt=this._activeRegions[j];rt.hiddenByOverlap=!1;for(let ot=0;ot<tt;ot++){const ct=this._activeRegions[ot];if(!ct.hiddenByOverlap&&rt.order===Yv&&cE(rt,ct)&&(rt.hiddenByOverlap=JT(rt.footprint,rt.tileId,ct.footprint,ct.tileId),rt.hiddenByOverlap))break}++j}a=_,_=s(a)}}}}_setSources(d){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let s=d.length-1;s>=0;s--)this._addSource(d[s]);this._computeReplacement()}},h.eH=Yv,h.eI=class{constructor(d){this._createGrid(d),this._createPoles(d)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const d of this._poleSegments)d.destroy();for(const d of this._gridSegments)d.withSkirts.destroy(),d.withoutSkirts.destroy()}_fillGridMeshWithLods(d,s){const a=new gm,_=new Dl,j=[],tt=d+1+2,rt=s[0]+1,ot=s[0]+1+(1+s.length),ct=(ht,mt,gt)=>{let _t=ht===tt-1?ht-2:ht===0?ht:ht-1;return _t+=gt?24575:0,[_t,mt]};for(let ht=0;ht<tt;++ht)a.emplaceBack(...ct(ht,0,!0));for(let ht=0;ht<rt;++ht)for(let mt=0;mt<tt;++mt)a.emplaceBack(...ct(mt,ht,(mt===0||mt===tt-1)&&!0));for(let ht=0;ht<s.length;++ht){const mt=s[ht];for(let gt=0;gt<tt;++gt)a.emplaceBack(...ct(gt,mt,!0))}for(let ht=0;ht<s.length;++ht){const mt=_.length,gt=s[ht]+1+2,_t=new Dl;for(let zt=0;zt<gt-1;zt++){const Vt=zt===gt-2,Gt=Vt?tt*(ot-s.length+ht-zt):tt;for(let _i=0;_i<tt-1;_i++){const er=zt*tt+_i;zt===0||Vt||_i===0||_i===tt-2?(_t.emplaceBack(er+1,er,er+Gt),_t.emplaceBack(er+Gt,er+Gt+1,er+1)):(_.emplaceBack(er+1,er,er+Gt),_.emplaceBack(er+Gt,er+Gt+1,er+1))}}const Rt=Bo.simpleSegment(0,mt,a.length,_.length-mt);for(let zt=0;zt<_t.uint16.length;zt+=3)_.emplaceBack(_t.uint16[zt],_t.uint16[zt+1],_t.uint16[zt+2]);const Pt=Bo.simpleSegment(0,mt,a.length,_.length-mt);j.push({withoutSkirts:Rt,withSkirts:Pt})}return{vertices:a,indices:_,segments:j}}_createGrid(d){const s=this._fillGridMeshWithLods(ut,pt);this._gridSegments=s.segments,this._gridBuffer=d.createVertexBuffer(s.vertices,pT.members),this._gridIndexBuffer=d.createIndexBuffer(s.indices,!0)}_createPoles(d){const s=new Dl;for(let rt=0;rt<=ut;rt++)s.emplaceBack(0,rt+1,rt+2);this._poleIndexBuffer=d.createIndexBuffer(s,!0);const a=new Xm,_=new Xm,j=new Xm,tt=new Xm;this._poleSegments=[];for(let rt=0,ot=0;rt<nt;rt++){const ct=360/(1<<rt);a.emplaceBack(0,-_e,0,.5,0),_.emplaceBack(0,-_e,0,.5,1),j.emplaceBack(0,-_e,0,.5,.5),tt.emplaceBack(0,-_e,0,.5,.5);for(let ht=0;ht<=ut;ht++){let mt=ht/ut,gt=0;const _t=ns(0,ct,mt),[Rt,Pt,zt]=Mt(uA,hA,_t,_e);a.emplaceBack(Rt,Pt,zt,mt,gt),_.emplaceBack(Rt,Pt,zt,mt,1-gt);const Vt=Lr(_t);mt=.5+.5*Math.sin(Vt),gt=.5+.5*Math.cos(Vt),j.emplaceBack(Rt,Pt,zt,mt,gt),tt.emplaceBack(Rt,Pt,zt,mt,1-gt)}this._poleSegments.push(Bo.simpleSegment(ot,0,66,64)),ot+=66}this._poleNorthVertexBuffer=d.createVertexBuffer(a,v1,!1),this._poleSouthVertexBuffer=d.createVertexBuffer(_,v1,!1),this._texturedPoleNorthVertexBuffer=d.createVertexBuffer(j,v1,!1),this._texturedPoleSouthVertexBuffer=d.createVertexBuffer(tt,v1,!1)}getGridBuffers(d,s){return[this._gridBuffer,this._gridIndexBuffer,s?this._gridSegments[d].withSkirts:this._gridSegments[d].withoutSkirts]}getPoleBuffers(d,s){return[s?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,s?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[d]]}},h.eJ=XT,h.eK=wr,h.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},h.eM=vr,h.eN=Qr,h.eO=function(d,s,a){return d[0]=s[0]/a[0],d[1]=s[1]/a[1],d[2]=s[2]/a[2],d},h.eP=El,h.eQ=Et,h.eR=Zn,h.eS=Kr,h.eT=function([d,s,a]){const _=Math.hypot(d,s,a),j=Math.atan2(d,a),tt=.5*Math.PI-Math.acos(-s/_);return new Ot(Wt(j),Wt(tt))},h.eU=Pl,h.eV=TE,h.eW=function(d){const s=d.navigator?d.navigator.userAgent:null;return!!function(a){if(ho==null){const _=a.navigator?a.navigator.userAgent:null;ho=!!a.safari||!(!_||!(/\b(iPad|iPhone|iPod)\b/.test(_)||_.match("Safari")&&!_.match("Chrome")))}return ho}(d)&&!(!s||!(s.match("Version/15.4")||s.match("Version/15.5")||s.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},h.eX=function(d,s){Du=d,Xu=s},h.eY=eE,h.eZ=vT,h.e_=function(d){const s=[0,0,0],a=At(new Float64Array(16));return Tt(a,d.pixelMatrix,d.globeMatrix),Vs(s,s,a),new yn(s[0],s[1])},h.ea=450,h.eb=7,h.ec=Ir,h.ed=function(d,s){if(d===s){var a=s[1],_=s[2],j=s[3],tt=s[6],rt=s[7],ot=s[11];d[1]=s[4],d[2]=s[8],d[3]=s[12],d[4]=a,d[6]=s[9],d[7]=s[13],d[8]=_,d[9]=tt,d[11]=s[14],d[12]=j,d[13]=rt,d[14]=ot}else d[0]=s[0],d[1]=s[4],d[2]=s[8],d[3]=s[12],d[4]=s[1],d[5]=s[5],d[6]=s[9],d[7]=s[13],d[8]=s[2],d[9]=s[6],d[10]=s[10],d[11]=s[14],d[12]=s[3],d[13]=s[7],d[14]=s[11],d[15]=s[15];return d},h.ee=LP,h.ef=zs,h.eg=Oy,h.eh=256,h.ei=Qw,h.ej=vu,h.ek=Ht,h.el=function(d,s){return d[0]=s[0],d[1]=s[1],d[2]=s[2],d[3]=s[4],d[4]=s[5],d[5]=s[6],d[6]=s[8],d[7]=s[9],d[8]=s[10],d},h.em=Xm,h.en=zv,h.eo=pv,h.ep=function(d,s,a,_,j){return fr((d-s)/(a-s)*(j-_)+_,_,j)},h.eq=Xl,h.er=function(d,s){var a=s[0],_=s[1],j=s[2],tt=s[3],rt=s[4],ot=s[5],ct=s[6],ht=s[7],mt=s[8],gt=mt*rt-ot*ht,_t=-mt*tt+ot*ct,Rt=ht*tt-rt*ct,Pt=a*gt+_*_t+j*Rt;return Pt?(d[0]=gt*(Pt=1/Pt),d[1]=(-mt*_+j*ht)*Pt,d[2]=(ot*_-j*rt)*Pt,d[3]=_t*Pt,d[4]=(mt*a-j*ct)*Pt,d[5]=(-ot*a+j*tt)*Pt,d[6]=Rt*Pt,d[7]=(-ht*a+_*ct)*Pt,d[8]=(rt*a-_*tt)*Pt,d):null},h.es=2,h.et=As,h.eu=SE,h.ev=[1,1,1],h.ew=Gx,h.ex=_l,h.ey=function(d,s,a,_){var j=s[0],tt=s[1],rt=s[2],ot=s[3];return d[0]=j+_*(a[0]-j),d[1]=tt+_*(a[1]-tt),d[2]=rt+_*(a[2]-rt),d[3]=ot+_*(a[3]-ot),d},h.ez=Ox,h.f=function(d){return btoa(encodeURIComponent(d).replace(/%([0-9A-F]{2})/g,(s,a)=>String.fromCharCode(+("0x"+a))))},h.f0=function(){L1().acquire(gE)},h.f1=dx,h.f2=function(d,s,a=!1){if(hu===Cu.deferred||hu===Cu.loading||hu===Cu.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");fm=gu.resolveURL(d),hu=Cu.deferred,Tv=s,Sv(),a||Vm()},h.f3=function(d){Lx=gu.resolveURL(d),jx||(jx=new Dx(L1(),new kp)),jx.broadcast("setMeshoptUrl",Lx)},h.f4=SS,h.f5=function(d){_E=gu.resolveURL(d),jx||(jx=new Dx(L1(),new kp)),jx.broadcast("setDracoUrl",_E)},h.f6=TS,h.f7=i0,h.f8=function(d){const s=iy();if(!s)return;const a=s.delete(yu);d&&a.then(()=>d()).catch(d)},h.f9=T_,h.fA=function(d){rp(),$l!=null&&$l.then(s=>{s.keys().then(a=>{for(let _=0;_<a.length-d;_++)s.delete(a[_]).catch(j=>Es(j.message))}).catch(a=>Es(a.message))}).catch(s=>Es(s.message))},h.fa=Fn,h.fb=By,h.fc=Gp,h.fd=KC,h.fe=YC,h.ff=ZS,h.fg=Ts,h.fh="hd_road_elevation",h.fi=Fo,h.fj=ds,h.fk=Jm,h.fl=NE,h.fm=A_,h.fn=function(d,s,a,_,j,tt,rt,ot=1,ct,ht,mt){d.createArrays(),d.tilePixelRatio=Rn/(512*d.overscaling),d.compareText={},d.iconsNeedLinear=!1;const gt=d.layers[0].layout,_t=d.layers[0]._unevaluatedLayout._values,Rt={};Rt.scaleFactor=ot,Rt.textSizeScaleRange=gt.get("text-size-scale-range"),Rt.iconSizeScaleRange=gt.get("icon-size-scale-range");const[Pt,zt]=Rt.textSizeScaleRange,[Vt,Gt]=Rt.iconSizeScaleRange;Rt.textScaleFactor=fr(Rt.scaleFactor,Pt,zt),Rt.iconScaleFactor=fr(Rt.scaleFactor,Vt,Gt);const _i=_t["text-size"],er=_t["icon-size"];if(d.textSizeData.kind==="composite"){const{minZoom:Pr,maxZoom:sn}=d.textSizeData;Rt.compositeTextSizes=[_i.possiblyEvaluate(new yo(Pr,{worldview:mt}),tt),_i.possiblyEvaluate(new yo(sn,{worldview:mt}),tt)]}if(d.iconSizeData.kind==="composite"){const{minZoom:Pr,maxZoom:sn}=d.iconSizeData;Rt.compositeIconSizes=[er.possiblyEvaluate(new yo(Pr,{worldview:mt}),tt),er.possiblyEvaluate(new yo(sn,{worldview:mt}),tt)]}Rt.layoutTextSize=_i.possiblyEvaluate(new yo(rt+1,{worldview:mt}),tt),Rt.layoutIconSize=er.possiblyEvaluate(new yo(rt+1,{worldview:mt}),tt),Rt.textMaxSize=_i.possiblyEvaluate(new yo(18,{worldview:mt}),tt);const rr=gt.get("symbol-placement"),_r=gt.get("text-rotation-alignment")==="map"&&rr!=="point",xr=gt.get("text-size");let Er=!1;const Ar=[];for(const Pr of d.features){const sn=gt.get("text-font").evaluate(Pr,{},tt).join(","),Fr=xr.evaluate(Pr,{},tt)*Rt.textScaleFactor,on=Rt.layoutTextSize.evaluate(Pr,{},tt)*Rt.textScaleFactor,gn=Rt.layoutIconSize.evaluate(Pr,{},tt)*Rt.iconScaleFactor,an={horizontal:{},vertical:void 0},hn=Pr.text;let vn,tn=[0,0];if(hn){const $n=hn.toString(),ls=gt.get("text-letter-spacing").evaluate(Pr,{},tt)*Zl,ms=gt.get("text-line-height").evaluate(Pr,{},tt)*Zl,Is=X0($n)?ls:0,xs=gt.get("text-anchor").evaluate(Pr,{},tt),Nn=gt.get("text-variable-anchor");if(!Nn){const Wr=gt.get("text-radial-offset").evaluate(Pr,{},tt);if(Wr)tn=D2(xs,[Wr*Zl,VE]);else{const nn=gt.get("text-offset").evaluate(Pr,{},tt);tn=[nn[0]*Zl,nn[1]*Zl]}}let ys=_r?"center":gt.get("text-justify").evaluate(Pr,{},tt);const Bs=rr==="point",or=Bs?gt.get("text-max-width").evaluate(Pr,{},tt)*Zl:1/0,ar=Wr=>{d.allowVerticalPlacement&&Ev($n)&&(an.vertical=FE(hn,s,a,j,sn,or,ms,xs,Wr,Is,tn,Gu.vertical,!0,on,Fr,ct))};if(!_r&&Nn){const Wr=ys==="auto"?Nn.map(Mn=>UE(Mn)):[ys];let nn=!1;for(let Mn=0;Mn<Wr.length;Mn++){const In=Wr[Mn];if(!an.horizontal[In])if(nn)an.horizontal[In]=an.horizontal[0];else{const zn=FE(hn,s,a,j,sn,or,ms,"center",In,Is,tn,Gu.horizontal,!1,on,Fr,ct);zn&&(an.horizontal[In]=zn,nn=zn.positionedLines.length===1)}}ar("left")}else{if(ys==="auto"&&(ys=UE(xs)),Bs||gt.get("text-writing-mode").indexOf("horizontal")>=0||!Ev($n)){const Wr=FE(hn,s,a,j,sn,or,ms,xs,ys,Is,tn,Gu.horizontal,!1,on,Fr,ct);Wr&&(an.horizontal[ys]=Wr)}ar(Bs?"left":ys)}}let dn,qr,Gr,wn,_n,Yn,jn=!1;const Bn=gt.get("icon-text-fit").evaluate(Pr,{},tt);if(Pr.icon&&Pr.icon.hasPrimary()){const $n=j2(Pr.icon,d.iconSizeData,_t["icon-size"],tt,d.zoom,Pr,ct,Rt.iconScaleFactor,mt);dn=$n.iconPrimary,Gr=$n.iconSecondary;const ls=dn.toString();if(qr=_.get(ls),qr&&(_n=gt.get("icon-offset").evaluate(Pr,{},tt),Yn=gt.get("icon-anchor").evaluate(Pr,{},tt),vn=uP(j.get(ls),Gr?j.get(Gr.toString()):void 0,_n,Yn),jn=qr.sdf,d.sdfIcons===void 0?d.sdfIcons=qr.sdf:d.sdfIcons!==qr.sdf&&Es("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(qr.pixelRatio!==d.pixelRatio||gt.get("icon-rotate").constantOr(1)!==0)&&(d.iconsNeedLinear=!0)),Gr){const ms=Gr.toString();wn=_.get(ms)}}Er=Er||!(!Pr.icon||!Pr.icon.hasSecondary());const An=GE(an.horizontal)||an.vertical;d.iconsInText||(d.iconsInText=!!An&&An.iconsInText);const Kn=on*Rt.textScaleFactor/Zl,{defaultShapedIcon:ps,verticallyShapedIcon:kn}=vP(d,vn,gt,Pr,tt,an,Kn,_n,Bn);Bn!=="none"&&vn&&(y2(vn)||_2(vn))&&(W1(0,qr,dn,vn,ps,Bn,ht,_,j),W1(0,wn,Gr,vn,ps,Bn,ht,_,j),kn&&(W1(0,qr,dn,vn,kn,Bn,ht,_,j),W1(0,wn,Gr,vn,kn,Bn,ht,_,j))),vn=ps,Ar.push({feature:Pr,shapedTextOrientations:an,shapedText:An,shapedIcon:vn,iconPrimary:dn,iconSecondary:Gr,iconOffset:_n,iconAnchor:Yn,verticallyShapedIcon:kn,layoutTextSize:on,layoutIconSize:gn,textOffset:tn,isSDFIcon:jn,iconTextFit:Bn})}return{featureData:Ar,sizes:Rt,hasAnySecondaryIcon:Er,textAlongLine:_r,symbolPlacement:rr}},h.fo=A2,h.fp=function(d,s,a,_,j,tt,rt,ot,ct,ht){const{featureData:mt,hasAnySecondaryIcon:gt,sizes:_t,textAlongLine:Rt,symbolPlacement:Pt}=s;for(const zt of mt){const{shapedIcon:Vt,verticallyShapedIcon:Gt,feature:_i,shapedTextOrientations:er,shapedText:rr,layoutTextSize:_r,textOffset:xr,isSDFIcon:Er,iconPrimary:Ar,iconSecondary:Pr,iconTextFit:sn,iconOffset:Fr}=zt;F2(Vt,ht.iconPositions,Ar,Pr),F2(Gt,ht.iconPositions,Ar,Pr),xP(er,ht.iconPositions),_P(Ar,Pr,ht.iconPositions),(rr||Vt)&&bP(d,_i,er,Vt,Gt,ct,_t,_r,0,xr,Er,_,j,rt,ot,gt,sn,Fr,Rt,Pt)}a&&d.generateCollisionDebugBuffers(tt,d.collisionBoxArray,_t.textScaleFactor)},h.fq=hs,h.fr=hw,h.fs=mn,h.ft=function(d){let s=0;if(new Uint32Array(d,0,1)[0]!==AS){const a=new Uint32Array(d,0,7),[,,_,j,tt,rt]=a;s=a.byteLength+j+tt+rt+tt,(_!==d.byteLength||s>=d.byteLength)&&Es("Invalid b3dm header information.")}return MS(d,s)},h.fu=function(d,s){const a=NS(d);for(const _ of a){for(const j of _.meshes)yR(j);_.lights&&(_.lightMeshIndex=_.meshes.length,_.meshes.push(_R(_.lights,s)))}return a},h.fv=sw,h.fw=ao,h.fx=wS,h.fy=vp,h.fz=Cu,h.g=function(d,s){return Ns(Object.assign(d,{method:"GET"}),s)},h.h=function(d){return d.indexOf("mapbox:")===0},h.i=function(d){return Gl.API_STYLE_REGEX.test(d)&&!P_(d)},h.j=Zp,h.k=Am,h.l=function(d){return decodeURIComponent(atob(d).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join(""))},h.m=function(d,s){return Ns(Object.assign(d,{type:"json"}),s)},h.n=Mp,h.o=gu,h.p=function(d,s){return Ns(Object.assign(d,{method:"POST"}),s)},h.q=iu,h.r=ey,h.s=function(d){try{const s=self[d];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch{return!1}},h.t=function(){return yE||(yE=new T_),yE},h.u=function(){return function d(s){return s?(s^Math.random()*(16>>s/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,d)}()},h.v=function(d){return!!d&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(d)},h.w=Es,h.x=nT,h.y=nm,h.z=au}),it(["./shared"],function(h){function dt(Lr){const Wt=Lr?Lr.url.toString():void 0;return Wt?performance.getEntriesByName(Wt):[]}function ft(Lr){if(typeof Lr=="number"||typeof Lr=="boolean"||typeof Lr=="string"||Lr==null)return JSON.stringify(Lr);if(Array.isArray(Lr)){let Qt="[";for(const lr of Lr)Qt+=`${ft(lr)},`;return`${Qt}]`}let Wt="{";for(const Qt of Object.keys(Lr).sort())Wt+=`${Qt}:${ft(Lr[Qt])},`;return`${Wt}}`}function xt(Lr){let Wt="";for(const Qt of h.bx)Wt+=`/${ft(Lr[Qt])}`;return Wt}class Ct{constructor(Wt){this.keyCache={},this._layers={},this._layerConfigs={},Wt&&this.replace(Wt)}replace(Wt,Qt){this._layerConfigs={},this._layers={},this.update(Wt,[],Qt)}update(Wt,Qt,lr){this._options=lr;for(const vr of Wt)this._layerConfigs[vr.id]=vr,(this._layers[vr.id]=h.dq(vr,this.scope,null,this._options)).compileFilter(lr),this.keyCache[vr.id]&&delete this.keyCache[vr.id];for(const vr of Qt)delete this.keyCache[vr],delete this._layerConfigs[vr],delete this._layers[vr];this.familiesBySource={};const wr=function(vr,fr){const Ur={};for(let Xr=0;Xr<vr.length;Xr++){const Sn=vr[Xr];let ln=fr&&fr[Sn.id];ln||(Sn.type==="symbol"?ln=Sn.id:(ln=xt(Sn),Sn.type==="line"&&Sn.paint&&function rs(ds){return typeof ds=="string"&&ds==="line-progress"||(Array.isArray(ds)?ds.some(rs):!(!ds||typeof ds!="object")&&Object.values(ds).some(rs))}(Sn.paint["line-width"])&&(ln+=`/${ft(Sn.paint["line-width"])}`))),fr&&(fr[Sn.id]=ln);let Hn=Ur[ln];Hn||(Hn=Ur[ln]=[]),Hn.push(Sn)}const Rr=[];for(const Xr in Ur)Rr.push(Ur[Xr]);return Rr}(Object.values(this._layerConfigs),this.keyCache);for(const vr of wr){const fr=vr.map(Hn=>this._layers[Hn.id]),Ur=fr[0];if(Ur.visibility==="none")continue;const Rr=Ur.source||"";let Xr=this.familiesBySource[Rr];Xr||(Xr=this.familiesBySource[Rr]={});const Sn=Ur.sourceLayer||"_geojsonTileLayer";let ln=Xr[Sn];ln||(ln=Xr[Sn]=[]),ln.push(fr)}}}const bt=1*h.fc;class kt{constructor(Wt){const Qt={},lr=[];for(const Ur in Wt){const Rr=Wt[Ur],Xr=Qt[Ur]={};for(const Sn in Rr.glyphs){const ln=Rr.glyphs[+Sn];if(!ln||ln.bitmap.width===0||ln.bitmap.height===0)continue;const Hn=ln.metrics.localGlyph?bt:1,rs={x:0,y:0,w:ln.bitmap.width+2*Hn,h:ln.bitmap.height+2*Hn};lr.push(rs),Xr[Sn]=rs}}const{w:wr,h:vr}=h.G(lr),fr=new h.fb({width:wr||1,height:vr||1});for(const Ur in Wt){const Rr=Wt[Ur];for(const Xr in Rr.glyphs){const Sn=Rr.glyphs[+Xr];if(!Sn||Sn.bitmap.width===0||Sn.bitmap.height===0)continue;const ln=Qt[Ur][Xr],Hn=Sn.metrics.localGlyph?bt:1;h.fb.copy(Sn.bitmap,fr,{x:0,y:0},{x:ln.x+Hn,y:ln.y+Hn},Sn.bitmap)}}this.image=fr,this.positions=Qt}}h.fa(kt,"GlyphAtlas");class Dt{constructor(Wt){this.tileID=new h.aO(Wt.tileID.overscaledZ,Wt.tileID.wrap,Wt.tileID.canonical.z,Wt.tileID.canonical.x,Wt.tileID.canonical.y),this.tileZoom=Wt.tileZoom,this.uid=Wt.uid,this.zoom=Wt.zoom,this.lut=Wt.lut,this.canonical=Wt.tileID.canonical,this.pixelRatio=Wt.pixelRatio,this.tileSize=Wt.tileSize,this.source=Wt.source,this.scope=Wt.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Wt.showCollisionBoxes,this.collectResourceTiming=!!Wt.request&&Wt.request.collectResourceTiming,this.promoteId=Wt.promoteId,this.isSymbolTile=Wt.isSymbolTile,this.tileTransform=h.aZ(Wt.tileID.canonical,Wt.projection),this.projection=Wt.projection,this.worldview=Wt.worldview,this.localizableLayerIds=Wt.localizableLayerIds,this.brightness=Wt.brightness,this.extraShadowCaster=!!Wt.extraShadowCaster,this.tessellationStep=Wt.tessellationStep,this.scaleFactor=Wt.scaleFactor,this.worldview=Wt.worldview}parse(Wt,Qt,lr,wr,vr,fr){this.status="parsing",this.data=Wt,this.collisionBoxArray=new h.b3;const Ur=new h.fd(Object.keys(Wt.layers).sort()),Rr=new h.fe(this.tileID,this.promoteId);Rr.bucketLayerIDs=[];const Xr={},Sn=new h.ff(256,256),ln={featureIndex:Rr,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Sn,availableImages:lr,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Hn=[],rs=Qt.familiesBySource[this.source];for(const js in rs){const Rs=Wt.layers[js];if(!Rs)continue;let Fs=!1,Gs=!1,Es=!1;for(const ao of rs[js])ao[0].type==="symbol"?Fs=!0:Gs=!0,ao[0].is3D()&&ao[0].type!=="model"&&(Es=!0);if(this.extraShadowCaster&&!Es||this.isSymbolTile===!0&&!Fs||this.isSymbolTile===!1&&!Gs)continue;Rs.version===1&&h.w(`Vector tile source "${this.source}" layer "${js}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Mo=Ur.encode(js),Jo=[];let na=!1;for(let ao=0,Ws=0;ao<Rs.length;ao++){const ho=Rs.feature(ao),zo=Rr.getId(ho,js);if(this.localizableLayerIds&&this.localizableLayerIds.has(js)){const po=ho.properties?ho.properties.worldview:null;if(this.worldview&&typeof po=="string")if(po==="all")ho.properties.$localized=!0;else{if(!po.split(",").includes(this.worldview))continue;ho.properties.$localized=!0,ho.properties.worldview=this.worldview}}!na&&ho.properties&&ho.properties.hasOwnProperty(h.fg)&&(na=!0),Jo.push({feature:ho,id:zo,index:Ws,sourceLayerIndex:Mo}),Ws++}na&&!ln.elevationFeatures&&Wt.layers.hasOwnProperty(h.fh)&&(ln.elevationFeatures=h.fi.parseFrom(Wt.layers[h.fh],this.canonical));for(const ao of rs[js]){const Ws=ao[0];if(this.extraShadowCaster&&(!Ws.is3D()||Ws.type==="model")||this.isSymbolTile!==void 0&&Ws.type==="symbol"!==this.isSymbolTile||Ws.minzoom&&this.zoom<Math.floor(Ws.minzoom)||Ws.maxzoom&&this.zoom>=Ws.maxzoom||Ws.visibility==="none")continue;At(ao,this.zoom,ln.brightness,lr,this.worldview);const ho=Xr[Ws.id]=Ws.createBucket({index:Rr.bucketLayerIDs.length,layers:ao,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Mo,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:wr,worldview:this.worldview});Rr.bucketLayerIDs.push(ao.map(po=>h.B(po.id,po.scope)));let zo=ho.prepare?ho.prepare():null;zo!=null?(zo=zo.then(()=>ho.populate(Jo,ln,this.tileID.canonical,this.tileTransform)),Hn.push(zo)):ho.populate(Jo,ln,this.tileID.canonical,this.tileTransform)}}const ds=()=>{let js,Rs,Fs,Gs,Es,Mo;Sn.trim();const Jo={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},na=()=>{if(js)return this.status="done",fr(js);if(this.extraShadowCaster)this.status="done",fr(null,{buckets:Object.values(Xr).filter(Ws=>!Ws.isEmpty()),featureIndex:Rr,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ln.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Rs&&Fs&&Gs){const Ws=new kt(Rs),ho=new Map;for(const[qo,Ul]of Fs.entries()){const{imagePosition:mu}=h.fl(qo,Ul,h.fm);ho.set(qo,mu)}const zo={};for(const qo in Xr){const Ul=Xr[qo];Ul instanceof h.b4&&(At(Ul.layers,this.zoom,ln.brightness,lr,this.worldview),zo[qo]=h.fn(Ul,Rs,Ws.positions,Fs,ho,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Es,this.worldview))}const po={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(vr,Fs,Es,()=>{po.iconsPending=!1,ao(zo,Ws,po)}),this.rasterizeIfNeeded(vr,Gs,Mo,()=>{po.patternsPending=!1,ao(zo,Ws,po)})}},ao=(Ws,ho,zo,po)=>{if(zo.iconsPending||zo.patternsPending)return;const qo=new h.fo(Fs,Gs,this.lut);for(const Ul in Xr){const mu=Xr[Ul];if(Ul in Ws)h.fp(mu,Ws[Ul],this.showCollisionBoxes,lr,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Fs,qo);else if(mu.hasPattern&&(mu instanceof h.ba||mu instanceof h.bb||mu instanceof h.e7)){At(mu.layers,this.zoom,ln.brightness,lr,this.worldview);const Zu=Object.fromEntries(qo.patternPositions);mu.addFeatures(ln,this.tileID.canonical,Zu,lr,this.tileTransform,this.brightness)}}this.status="done",fr(null,{buckets:Object.values(Xr).filter(Ul=>!Ul.isEmpty()),featureIndex:Rr,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ho.image,lineAtlas:Sn,imageAtlas:qo,brightness:ln.brightness})};if(!this.extraShadowCaster){const Ws=h.fj(ln.glyphDependencies,po=>Object.keys(po).map(Number));Object.keys(Ws).length?vr.send("getGlyphs",{uid:this.uid,stacks:Ws},(po,qo)=>{js||(js=po,Rs=qo,na())},void 0,!1,Jo):Rs={};const ho=Array.from(ln.iconDependencies.keys()).map(po=>h.I.parse(po));ho.length?vr.send("getImages",{images:ho,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(po,qo)=>{js||(js=po,Fs=new Map,Es=this.updateImageMapAndGetImageTaskQueue(Fs,qo,ln.iconDependencies),na())},void 0,!1,Jo):(Fs=new Map,Es=new Map);const zo=Array.from(ln.patternDependencies.keys()).map(po=>h.I.parse(po));zo.length?vr.send("getImages",{images:zo,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(po,qo)=>{js||(js=po,Gs=new Map,Mo=this.updateImageMapAndGetImageTaskQueue(Gs,qo,ln.patternDependencies),na())},void 0,!1,Jo):(Gs=new Map,Mo=new Map)}if(ln.elevationFeatures&&ln.elevationFeatures.length>0){const Ws=[];for(const zo of Object.values(Xr))if(zo instanceof h.bb){const po=zo.getUnevaluatedPortalGraph();po&&Ws.push(po)}const ho=h.fk.evaluate(Ws);for(const zo of Object.values(Xr))if(zo instanceof h.bb){const po=Wt.layers[Ur.decode(zo.sourceLayerIndex)];zo.setEvaluatedPortalGraph(ho,po,this.tileID.canonical,ln.availableImages,ln.brightness)}}na()};Hn.length>0?Promise.allSettled(Hn).then(ds).catch(fr):ds()}rasterizeIfNeeded(Wt,Qt,lr,wr){Array.from(Qt.values()).some(vr=>vr.usvg)?this.rasterize(Wt,Qt,lr,wr):wr()}updateImageMapAndGetImageTaskQueue(Wt,Qt,lr){const wr=new Map;for(const vr of Qt.keys()){const fr=lr.get(vr)||[];for(const Ur of fr){const Rr=Ur.toString(),Xr=Qt.get(Ur.id.toString());Xr.usvg?wr.has(Rr)||(wr.set(Rr,Ur),Wt.set(Rr,Object.assign({},Xr))):Wt.set(Rr,Xr)}}return wr}rasterize(Wt,Qt,lr,wr){this.rasterizeTask=Wt.send("rasterizeImages",{scope:this.scope,tasks:lr},(vr,fr)=>{if(!vr)for(const[Ur,Rr]of fr.entries()){const Xr=Object.assign(Qt.get(Ur),{data:Rr});Qt.set(Ur,Xr)}wr()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function At(Lr,Wt,Qt,lr,wr){const vr=new h.ac(Wt,{brightness:Qt,worldview:wr});for(const fr of Lr)fr.recalculate(vr,lr)}class Bt extends h.E{constructor(Wt,Qt,lr,wr,vr,fr,Ur){super(),this.actor=Wt,this.layerIndex=Qt,this.availableImages=lr,this.availableModels=wr,this.loadVectorData=fr||h.aL,this.loading={},this.loaded={},this.deduped=new h.aK(Wt.scheduler),this.isSpriteLoaded=vr,this.scheduler=Wt.scheduler,this.brightness=Ur}loadTile(Wt,Qt){const lr=Wt.uid,wr=Wt&&Wt.request,vr=wr&&wr.collectResourceTiming,fr=this.loading[lr]=new Dt(Wt);fr.abort=this.loadVectorData(Wt,(Ur,Rr)=>{const Xr=!this.loading[lr];if(delete this.loading[lr],fr.cancelRasterize(),Xr||Ur||!Rr)return fr.status="done",Xr||(this.loaded[lr]=fr),Qt(Ur);const Sn=Rr.rawData,ln={};Rr.expires&&(ln.expires=Rr.expires),Rr.cacheControl&&(ln.cacheControl=Rr.cacheControl),fr.vectorTile=Rr.vectorTile||new h.fq(new h.bt(Sn));const Hn=()=>{fr.parse(fr.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(rs,ds)=>{if(rs||!ds)return Qt(rs);const js={};if(vr){const Rs=dt(wr);Rs.length>0&&(js.resourceTiming=JSON.parse(JSON.stringify(Rs)))}Qt(null,Object.assign({rawTileData:Sn.slice(0)},ds,ln,js))})};this.isSpriteLoaded?Hn():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Hn,{type:"parseTile",isSymbolTile:Wt.isSymbolTile,zoom:Wt.tileZoom}):Hn()}),this.loaded=this.loaded||{},this.loaded[lr]=fr})}reloadTile(Wt,Qt){const lr=this.loaded,wr=Wt.uid;if(lr&&lr[wr]){const vr=lr[wr];vr.scaleFactor=Wt.scaleFactor,vr.showCollisionBoxes=Wt.showCollisionBoxes,vr.projection=Wt.projection,vr.brightness=Wt.brightness,vr.tileTransform=h.aZ(Wt.tileID.canonical,Wt.projection),vr.extraShadowCaster=Wt.extraShadowCaster,vr.lut=Wt.lut,vr.worldview=Wt.worldview;const fr=(Ur,Rr)=>{const Xr=vr.reloadCallback;Xr&&(delete vr.reloadCallback,vr.parse(vr.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Xr)),Qt(Ur,Rr)};vr.status==="parsing"?vr.reloadCallback=fr:vr.status==="done"&&(vr.vectorTile?vr.parse(vr.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,fr):fr())}else Qt(null,void 0)}abortTile(Wt,Qt){const lr=Wt.uid,wr=this.loading[lr];wr&&(wr.abort&&wr.abort(),delete this.loading[lr]),Qt()}removeTile(Wt,Qt){const lr=this.loaded,wr=Wt.uid;lr&&lr[wr]&&delete lr[wr],Qt()}}class Tt{loadTile(Wt,Qt){const{uid:lr,encoding:wr,rawImageData:vr,padding:fr}=Wt,Ur=ImageBitmap&&vr instanceof ImageBitmap?this.getImageData(vr,fr):vr;Qt(null,new h.fr(lr,Ur,wr,fr<1))}reloadTile(Wt,Qt){Qt(null,null)}abortTile(Wt,Qt){Qt()}removeTile(Wt,Qt){Qt()}getImageData(Wt,Qt){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Wt.width,Wt.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Wt.width,this.offscreenCanvas.height=Wt.height,this.offscreenCanvasContext.drawImage(Wt,0,0,Wt.width,Wt.height);const lr=this.offscreenCanvasContext.getImageData(-Qt,-Qt,Wt.width+2*Qt,Wt.height+2*Qt);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),lr}}h.bs.setPbf(h.bt);class It{constructor(Wt){this._mrt=new h.bs(Wt.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Wt.uid,this.tileID=Wt.tileID,this.source=Wt.source}parse(Wt,Qt){const lr=this._mrt;this.status="parsing",this._entireBuffer=Wt;try{lr.parseHeader(Wt),this._isHeaderLoaded=!0;const wr=[];for(const vr in lr.layers){const fr=lr.getLayer(vr),Ur=fr.getDataRange(fr.getBandList()),Rr=lr.createDecodingTask(Ur),Xr=Wt.slice(Ur.firstByte,Ur.lastByte+1),Sn=h.bs.performDecoding(Xr,Rr).then(ln=>Rr.complete(null,ln)).catch(ln=>Rr.complete(ln,null));wr.push(Sn)}Promise.allSettled(wr).then(()=>Qt(null,lr)).catch(vr=>Qt(vr))}catch(wr){Qt(wr)}}}class St{constructor(Wt){this.actor=Wt,this.loading={},this.loaded={}}loadTile(Wt,Qt){const lr=Wt.uid,wr=Wt.request,vr=this.loading[lr]=new It(Wt),{cancel:fr}=h.bu(wr,(Ur,Rr,Xr,Sn)=>{const ln=!this.loading[lr];if(delete this.loading[lr],ln||Ur||!Rr)return vr.status="done",ln||(this.loaded[lr]=vr),Qt(Ur);vr.parse(Rr,(Hn,rs)=>{if(Hn||!rs)return Qt(Hn);Qt(null,rs,Xr,Sn)}),this.loaded[lr]=vr});vr.abort=fr}reloadTile(Wt,Qt){Qt(null,void 0)}abortTile(Wt,Qt){const lr=Wt.uid,wr=this.loading[lr];wr&&(wr.abort&&wr.abort(),delete this.loading[lr]),Qt()}removeTile(Wt,Qt){const lr=Wt.uid;this.loaded[lr]&&delete this.loaded[lr],Qt()}decodeRasterArray(Wt,Qt){h.bs.performDecoding(Wt.buffer,Wt.task).then(lr=>Qt(null,lr)).catch(lr=>Qt(lr))}}const jt=h.fs.prototype.toGeoJSON;class Ht{constructor(Wt){this._feature=Wt,this.extent=h.al,this.type=Wt.type,this.properties=Wt.tags,"id"in Wt&&!isNaN(Wt.id)&&(this.id=parseInt(Wt.id,10))}loadGeometry(){if(this._feature.type===1){const Wt=[];for(const Qt of this._feature.geometry)Wt.push([new h.P(Qt[0],Qt[1])]);return Wt}{const Wt=[];for(const Qt of this._feature.geometry){const lr=[];for(const wr of Qt)lr.push(new h.P(wr[0],wr[1]));Wt.push(lr)}return Wt}}toGeoJSON(Wt,Qt,lr){return jt.call(this,Wt,Qt,lr)}}class Kt{constructor(Wt,Qt){this.name=Wt,this.extent=h.al,this.length=Qt.length,this._jsonFeatures=Qt}feature(Wt){return new Ht(this._jsonFeatures[Wt])}}class ir{constructor(Wt){this.layers={},this.extent=h.al;for(const Qt of Object.keys(Wt))this.layers[Qt]=new Kt(Qt,Wt[Qt])}}const nr=64/4096,kr=128;class br{constructor(){this.features=new Map}clear(){this.features.clear()}load(Wt=[],Qt){for(const lr of Wt){const wr=lr.id;if(wr==null)continue;let vr=this.features.get(wr);vr&&this.updateCache(vr,Qt),lr.geometry?(vr=$r(lr),this.updateCache(vr,Qt),this.features.set(wr,vr)):this.features.delete(wr),this.updateCache(vr,Qt)}}updateCache(Wt,Qt){for(const{canonical:lr,uid:wr}of Object.values(Qt)){const{z:vr,x:fr,y:Ur}=lr;Sr(Wt,Math.pow(2,vr),fr,Ur)&&delete Qt[wr]}}getTile(Wt,Qt,lr){const wr=Math.pow(2,Wt),vr=[];for(const fr of this.features.values())Sr(fr,wr,Qt,lr)&&vr.push(Xt(fr,wr,Qt,lr));return{features:vr}}getFeatures(){return[...this.features.values()]}}function Sr({minX:Lr,minY:Wt,maxX:Qt,maxY:lr},wr,vr,fr){return Lr<(vr+1+nr)/wr&&Wt<(fr+1+nr)/wr&&Qt>(vr-nr)/wr&&lr>(fr-nr)/wr}function $r(Lr){const{id:Wt,geometry:Qt,properties:lr}=Lr;if(!Qt)return;if(Qt.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:wr,coordinates:vr}=Qt,fr={id:Wt,type:1,geometry:[],tags:lr,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ur=fr.geometry;if(wr==="Point")rn(vr,Ur,fr);else if(wr==="MultiPoint")for(const Rr of vr)rn(Rr,Ur,fr);else if(wr==="LineString")fr.type=2,Zr(vr,Ur,fr);else if(wr==="MultiLineString")fr.type=2,Kr(vr,Ur,fr);else if(wr==="Polygon")fr.type=3,Kr(vr,Ur,fr,!0);else{if(wr!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");fr.type=3;for(const Rr of vr)Kr(Rr,Ur,fr,!0)}return fr}function rn([Lr,Wt],Qt,lr){const wr=h.aF(Lr);let vr=h.aJ(Wt);vr=vr<0?0:vr>1?1:vr,Qt.push(wr,vr),lr.minX=Math.min(lr.minX,wr),lr.minY=Math.min(lr.minY,vr),lr.maxX=Math.max(lr.maxX,wr),lr.maxY=Math.max(lr.maxY,vr)}function Zr(Lr,Wt,Qt,lr=!1,wr=!1){const vr=[];for(const fr of Lr)rn(fr,vr,Qt);Wt.push(vr),lr&&function(fr,Ur){let Rr=0;for(let Xr=0,Sn=fr.length,ln=Sn-2;Xr<Sn;ln=Xr,Xr+=2)Rr+=(fr[Xr]-fr[ln])*(fr[Xr+1]+fr[ln+1]);if(Rr>0===Ur)for(let Xr=0,Sn=fr.length;Xr<Sn/2;Xr+=2){const ln=fr[Xr],Hn=fr[Xr+1];fr[Xr]=fr[Sn-2-Xr],fr[Xr+1]=fr[Sn-1-Xr],fr[Sn-2-Xr]=ln,fr[Sn-1-Xr]=Hn}}(vr,wr)}function Kr(Lr,Wt,Qt,lr=!1){for(let wr=0;wr<Lr.length;wr++)Zr(Lr[wr],Wt,Qt,lr,wr===0)}function Xt(Lr,Wt,Qt,lr){const{id:wr,type:vr,geometry:fr,tags:Ur}=Lr,Rr=[];if(vr===1)(function(Xr,Sn,ln,Hn,rs){for(let ds=0;ds<Xr.length;ds+=2){const js=Math.round(h.al*(Xr[ds+0]*Sn-ln)),Rs=Math.round(h.al*(Xr[ds+1]*Sn-Hn));rs.push([js,Rs])}})(fr,Wt,Qt,lr,Rr);else for(const Xr of fr)mr(Xr,Wt,Qt,lr,Rr);return{id:wr,type:vr,geometry:Rr,tags:Ur}}function mr(Lr,Wt,Qt,lr,wr){const vr=-kr,fr=h.al+kr;let Ur;for(let Rr=0;Rr<Lr.length-2;Rr+=2){let Xr=Math.round(h.al*(Lr[Rr+0]*Wt-Qt)),Sn=Math.round(h.al*(Lr[Rr+1]*Wt-lr)),ln=Math.round(h.al*(Lr[Rr+2]*Wt-Qt)),Hn=Math.round(h.al*(Lr[Rr+3]*Wt-lr));const rs=ln-Xr,ds=Hn-Sn;Xr<vr&&ln<vr||(Xr<vr?(Sn+=Math.round(ds*((vr-Xr)/rs)),Xr=vr):ln<vr&&(Hn=Sn+Math.round(ds*((vr-Xr)/rs)),ln=vr),Sn<vr&&Hn<vr||(Sn<vr?(Xr+=Math.round(rs*((vr-Sn)/ds)),Sn=vr):Hn<vr&&(ln=Xr+Math.round(rs*((vr-Sn)/ds)),Hn=vr),Xr>=fr&&ln>=fr||(Xr>=fr?(Sn+=Math.round(ds*((fr-Xr)/rs)),Xr=fr):ln>=fr&&(Hn=Sn+Math.round(ds*((fr-Xr)/rs)),ln=fr),Sn>=fr&&Hn>=fr||(Sn>=fr?(Xr+=Math.round(rs*((fr-Sn)/ds)),Sn=fr):Hn>=fr&&(ln=Xr+Math.round(rs*((fr-Sn)/ds)),Hn=fr),Ur&&Xr===Ur[Ur.length-1][0]&&Sn===Ur[Ur.length-1][1]||(Ur=[[Xr,Sn]],wr.push(Ur)),Ur.push([ln,Hn])))))}}function Ut({name:Lr,features:Wt},Qt){Qt.writeStringField(1,Lr),Qt.writeVarintField(5,h.al);const lr=new Map,wr=new Map,vr={keys:lr,values:wr,feature:null};for(const fr of Wt)vr.feature=fr,Qt.writeMessage(2,Jt,vr);for(const fr of lr.keys())Qt.writeStringField(3,fr);for(const fr of wr.keys())Qt.writeMessage(4,Zn,fr)}function Jt(Lr,Wt){const Qt=Lr.feature;Qt.id!==void 0&&Number.isSafeInteger(+Qt.id)&&Wt.writeVarintField(1,+Qt.id),Qt.tags&&Wt.writeMessage(2,Or,Lr),Wt.writeVarintField(3,Qt.type),Wt.writeMessage(4,On,Qt)}function Or({keys:Lr,values:Wt,feature:Qt},lr){for(const wr of Object.keys(Qt.tags)){let vr=Qt.tags[wr];if(vr===null)continue;let fr=Lr.get(wr);fr===void 0&&(fr=Lr.size,Lr.set(wr,fr)),lr.writeVarint(fr);const Ur=typeof vr;Ur!=="string"&&Ur!=="boolean"&&Ur!=="number"&&(vr=JSON.stringify(vr));let Rr=Wt.get(vr);Rr===void 0&&(Rr=Wt.size,Wt.set(vr,Rr)),lr.writeVarint(Rr)}}function Cr(Lr,Wt){return(Wt<<3)+(7&Lr)}function pn(Lr){return Lr<<1^Lr>>31}function On(Lr,Wt){const{geometry:Qt,type:lr}=Lr;let wr=0,vr=0;if(lr===1){Wt.writeVarint(Cr(1,Qt.length));for(const fr of Qt){const Ur=fr[0]-wr,Rr=fr[1]-vr;Wt.writeVarint(pn(Ur)),Wt.writeVarint(pn(Rr)),wr+=Ur,vr+=Rr}}else for(const fr of Qt){Wt.writeVarint(Cr(1,1));const Ur=fr.length-(lr===3?1:0);for(let Rr=0;Rr<Ur;Rr++){Rr===1&&Wt.writeVarint(Cr(2,Ur-1));const Xr=fr[Rr][0]-wr,Sn=fr[Rr][1]-vr;Wt.writeVarint(pn(Xr)),Wt.writeVarint(pn(Sn)),wr+=Xr,vr+=Sn}lr===3&&Wt.writeVarint(Cr(7,1))}}function Zn(Lr,Wt){const Qt=typeof Lr;Qt==="string"?Wt.writeStringField(1,Lr):Qt==="boolean"?Wt.writeBooleanField(7,Lr):Qt==="number"&&(Lr%1!=0?Wt.writeDoubleField(3,Lr):Lr<0?Wt.writeSVarintField(6,Lr):Wt.writeVarintField(5,Lr))}const As={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Lr=>Lr},ss=Math.fround||(Ls=new Float32Array(1),Lr=>(Ls[0]=+Lr,Ls[0]));var Ls;const $s=3,vo=5,Vs=6;class bo{constructor(Wt){this.options=Object.assign(Object.create(As),Wt),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Wt){const{log:Qt,minZoom:lr,maxZoom:wr}=this.options;Qt&&console.time("total time");const vr=`prepare ${Wt.length} points`;Qt&&console.time(vr),this.points=Wt;const fr=[];for(let Rr=0;Rr<Wt.length;Rr++){const Xr=Wt[Rr];if(!Xr.geometry)continue;const[Sn,ln]=Xr.geometry.coordinates,Hn=ss(Jn(Sn)),rs=ss(Hs(ln));fr.push(Hn,rs,1/0,Rr,-1,1),this.options.reduce&&fr.push(0)}let Ur=this.trees[wr+1]=this._createTree(fr);Qt&&console.timeEnd(vr);for(let Rr=wr;Rr>=lr;Rr--){const Xr=+Date.now();Ur=this.trees[Rr]=this._createTree(this._cluster(Ur,Rr)),Qt&&console.log("z%d: %d clusters in %dms",Rr,Ur.numItems,+Date.now()-Xr)}return Qt&&console.timeEnd("total time"),this}getClusters(Wt,Qt){let lr=((Wt[0]+180)%360+360)%360-180;const wr=Math.max(-90,Math.min(90,Wt[1]));let vr=Wt[2]===180?180:((Wt[2]+180)%360+360)%360-180;const fr=Math.max(-90,Math.min(90,Wt[3]));if(Wt[2]-Wt[0]>=360)lr=-180,vr=180;else if(lr>vr){const ln=this.getClusters([lr,wr,180,fr],Qt),Hn=this.getClusters([-180,wr,vr,fr],Qt);return ln.concat(Hn)}const Ur=this.trees[this._limitZoom(Qt)],Rr=Ur.range(Jn(lr),Hs(fr),Jn(vr),Hs(wr)),Xr=Ur.data,Sn=[];for(const ln of Rr){const Hn=this.stride*ln;Sn.push(Xr[Hn+vo]>1?Po(Xr,Hn,this.clusterProps):this.points[Xr[Hn+$s]])}return Sn}getChildren(Wt){const Qt=this._getOriginId(Wt),lr=this._getOriginZoom(Wt),wr="No cluster with the specified id.",vr=this.trees[lr];if(!vr)throw new Error(wr);const fr=vr.data;if(Qt*this.stride>=fr.length)throw new Error(wr);const Ur=this.options.radius/(this.options.extent*Math.pow(2,lr-1)),Rr=vr.within(fr[Qt*this.stride],fr[Qt*this.stride+1],Ur),Xr=[];for(const Sn of Rr){const ln=Sn*this.stride;fr[ln+4]===Wt&&Xr.push(fr[ln+vo]>1?Po(fr,ln,this.clusterProps):this.points[fr[ln+$s]])}if(Xr.length===0)throw new Error(wr);return Xr}getLeaves(Wt,Qt,lr){const wr=[];return this._appendLeaves(wr,Wt,Qt=Qt||10,lr=lr||0,0),wr}getTile(Wt,Qt,lr){const wr=this.trees[this._limitZoom(Wt)],vr=Math.pow(2,Wt),{extent:fr,radius:Ur}=this.options,Rr=Ur/fr,Xr=(lr-Rr)/vr,Sn=(lr+1+Rr)/vr,ln={features:[]};return this._addTileFeatures(wr.range((Qt-Rr)/vr,Xr,(Qt+1+Rr)/vr,Sn),wr.data,Qt,lr,vr,ln),Qt===0&&this._addTileFeatures(wr.range(1-Rr/vr,Xr,1,Sn),wr.data,vr,lr,vr,ln),Qt===vr-1&&this._addTileFeatures(wr.range(0,Xr,Rr/vr,Sn),wr.data,-1,lr,vr,ln),ln.features.length?ln:null}getClusterExpansionZoom(Wt){let Qt=this._getOriginZoom(Wt)-1;for(;Qt<=this.options.maxZoom;){const lr=this.getChildren(Wt);if(Qt++,lr.length!==1)break;Wt=lr[0].properties.cluster_id}return Qt}_appendLeaves(Wt,Qt,lr,wr,vr){const fr=this.getChildren(Qt);for(const Ur of fr){const Rr=Ur.properties;if(Rr&&Rr.cluster?vr+Rr.point_count<=wr?vr+=Rr.point_count:vr=this._appendLeaves(Wt,Rr.cluster_id,lr,wr,vr):vr<wr?vr++:Wt.push(Ur),Wt.length===lr)break}return vr}_createTree(Wt){const Qt=new h.c3(Wt.length/this.stride|0,this.options.nodeSize,Float32Array);for(let lr=0;lr<Wt.length;lr+=this.stride)Qt.add(Wt[lr],Wt[lr+1]);return Qt.finish(),Qt.data=Wt,Qt}_addTileFeatures(Wt,Qt,lr,wr,vr,fr){for(const Ur of Wt){const Rr=Ur*this.stride,Xr=Qt[Rr+vo]>1;let Sn,ln,Hn;if(Xr)Sn=ws(Qt,Rr,this.clusterProps),ln=Qt[Rr],Hn=Qt[Rr+1];else{const js=this.points[Qt[Rr+$s]];Sn=js.properties;const[Rs,Fs]=js.geometry.coordinates;ln=Jn(Rs),Hn=Hs(Fs)}const rs={type:1,geometry:[[Math.round(this.options.extent*(ln*vr-lr)),Math.round(this.options.extent*(Hn*vr-wr))]],tags:Sn};let ds;ds=Xr||this.options.generateId?Qt[Rr+$s]:this.points[Qt[Rr+$s]].id,ds!==void 0&&(rs.id=ds),fr.features.push(rs)}}_limitZoom(Wt){return Math.max(this.options.minZoom,Math.min(Math.floor(+Wt),this.options.maxZoom+1))}_cluster(Wt,Qt){const{radius:lr,extent:wr,reduce:vr,minPoints:fr}=this.options,Ur=lr/(wr*Math.pow(2,Qt)),Rr=Wt.data,Xr=[],Sn=this.stride;for(let ln=0;ln<Rr.length;ln+=Sn){if(Rr[ln+2]<=Qt)continue;Rr[ln+2]=Qt;const Hn=Rr[ln],rs=Rr[ln+1],ds=Wt.within(Rr[ln],Rr[ln+1],Ur),js=Rr[ln+vo];let Rs=js;for(const Fs of ds){const Gs=Fs*Sn;Rr[Gs+2]>Qt&&(Rs+=Rr[Gs+vo])}if(Rs>js&&Rs>=fr){let Fs,Gs=Hn*js,Es=rs*js,Mo=-1;const Jo=(ln/Sn<<5)+(Qt+1)+this.points.length;for(const na of ds){const ao=na*Sn;if(Rr[ao+2]<=Qt)continue;Rr[ao+2]=Qt;const Ws=Rr[ao+vo];Gs+=Rr[ao]*Ws,Es+=Rr[ao+1]*Ws,Rr[ao+4]=Jo,vr&&(Fs||(Fs=this._map(Rr,ln,!0),Mo=this.clusterProps.length,this.clusterProps.push(Fs)),vr(Fs,this._map(Rr,ao)))}Rr[ln+4]=Jo,Xr.push(Gs/Rs,Es/Rs,1/0,Jo,-1,Rs),vr&&Xr.push(Mo)}else{for(let Fs=0;Fs<Sn;Fs++)Xr.push(Rr[ln+Fs]);if(Rs>1)for(const Fs of ds){const Gs=Fs*Sn;if(!(Rr[Gs+2]<=Qt)){Rr[Gs+2]=Qt;for(let Es=0;Es<Sn;Es++)Xr.push(Rr[Gs+Es])}}}}return Xr}_getOriginId(Wt){return Wt-this.points.length>>5}_getOriginZoom(Wt){return(Wt-this.points.length)%32}_map(Wt,Qt,lr){if(Wt[Qt+vo]>1){const fr=this.clusterProps[Wt[Qt+Vs]];return lr?Object.assign({},fr):fr}const wr=this.points[Wt[Qt+$s]].properties,vr=this.options.map(wr);return lr&&vr===wr?Object.assign({},vr):vr}}function Po(Lr,Wt,Qt){return{type:"Feature",id:Lr[Wt+$s],properties:ws(Lr,Wt,Qt),geometry:{type:"Point",coordinates:[(lr=Lr[Wt],360*(lr-.5)),El(Lr[Wt+1])]}};var lr}function ws(Lr,Wt,Qt){const lr=Lr[Wt+vo],wr=lr>=1e4?`${Math.round(lr/1e3)}k`:lr>=1e3?Math.round(lr/100)/10+"k":lr,vr=Lr[Wt+Vs],fr=vr===-1?{}:Object.assign({},Qt[vr]);return Object.assign(fr,{cluster:!0,cluster_id:Lr[Wt+$s],point_count:lr,point_count_abbreviated:wr})}function Jn(Lr){return Lr/360+.5}function Hs(Lr){const Wt=Math.sin(Lr*Math.PI/180),Qt=.5-.25*Math.log((1+Wt)/(1-Wt))/Math.PI;return Qt<0?0:Qt>1?1:Qt}function El(Lr){const Wt=(180-360*Lr)*Math.PI/180;return 360*Math.atan(Math.exp(Wt))/Math.PI-90}function Xo(Lr,Wt,Qt,lr){let wr=lr;const vr=Wt+(Qt-Wt>>1);let fr,Ur=Qt-Wt;const Rr=Lr[Wt],Xr=Lr[Wt+1],Sn=Lr[Qt],ln=Lr[Qt+1];for(let Hn=Wt+3;Hn<Qt;Hn+=3){const rs=_l(Lr[Hn],Lr[Hn+1],Rr,Xr,Sn,ln);if(rs>wr)fr=Hn,wr=rs;else if(rs===wr){const ds=Math.abs(Hn-vr);ds<Ur&&(fr=Hn,Ur=ds)}}wr>lr&&(fr-Wt>3&&Xo(Lr,Wt,fr,lr),Lr[fr+2]=wr,Qt-fr>3&&Xo(Lr,fr,Qt,lr))}function _l(Lr,Wt,Qt,lr,wr,vr){let fr=wr-Qt,Ur=vr-lr;if(fr!==0||Ur!==0){const Rr=((Lr-Qt)*fr+(Wt-lr)*Ur)/(fr*fr+Ur*Ur);Rr>1?(Qt=wr,lr=vr):Rr>0&&(Qt+=fr*Rr,lr+=Ur*Rr)}return fr=Lr-Qt,Ur=Wt-lr,fr*fr+Ur*Ur}function Io(Lr,Wt,Qt,lr){const wr={id:Lr??null,type:Wt,geometry:Qt,tags:lr,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Wt==="Point"||Wt==="MultiPoint"||Wt==="LineString")Pl(wr,Qt);else if(Wt==="Polygon")Pl(wr,Qt[0]);else if(Wt==="MultiLineString")for(const vr of Qt)Pl(wr,vr);else if(Wt==="MultiPolygon")for(const vr of Qt)Pl(wr,vr[0]);return wr}function Pl(Lr,Wt){for(let Qt=0;Qt<Wt.length;Qt+=3)Lr.minX=Math.min(Lr.minX,Wt[Qt]),Lr.minY=Math.min(Lr.minY,Wt[Qt+1]),Lr.maxX=Math.max(Lr.maxX,Wt[Qt]),Lr.maxY=Math.max(Lr.maxY,Wt[Qt+1])}function Uo(Lr,Wt,Qt,lr){if(!Wt.geometry)return;const wr=Wt.geometry.coordinates;if(wr&&wr.length===0)return;const vr=Wt.geometry.type,fr=Math.pow(Qt.tolerance/((1<<Qt.maxZoom)*Qt.extent),2);let Ur=[],Rr=Wt.id;if(Qt.promoteId?Rr=Wt.properties[Qt.promoteId]:Qt.generateId&&(Rr=lr||0),vr==="Point")Fl(wr,Ur);else if(vr==="MultiPoint")for(const Xr of wr)Fl(Xr,Ur);else if(vr==="LineString")Vl(wr,Ur,fr,!1);else if(vr==="MultiLineString"){if(Qt.lineMetrics){for(const Xr of wr)Ur=[],Vl(Xr,Ur,fr,!1),Lr.push(Io(Rr,"LineString",Ur,Wt.properties));return}_a(wr,Ur,fr,!1)}else if(vr==="Polygon")_a(wr,Ur,fr,!0);else{if(vr!=="MultiPolygon"){if(vr==="GeometryCollection"){for(const Xr of Wt.geometry.geometries)Uo(Lr,{id:Rr,geometry:Xr,properties:Wt.properties},Qt,lr);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Xr of wr){const Sn=[];_a(Xr,Sn,fr,!0),Ur.push(Sn)}}Lr.push(Io(Rr,vr,Ur,Wt.properties))}function Fl(Lr,Wt){Wt.push(Xl(Lr[0]),Go(Lr[1]),0)}function Vl(Lr,Wt,Qt,lr){let wr,vr,fr=0;for(let Rr=0;Rr<Lr.length;Rr++){const Xr=Xl(Lr[Rr][0]),Sn=Go(Lr[Rr][1]);Wt.push(Xr,Sn,0),Rr>0&&(fr+=lr?(wr*Sn-Xr*vr)/2:Math.sqrt(Math.pow(Xr-wr,2)+Math.pow(Sn-vr,2))),wr=Xr,vr=Sn}const Ur=Wt.length-3;Wt[2]=1,Xo(Wt,0,Ur,Qt),Wt[Ur+2]=1,Wt.size=Math.abs(fr),Wt.start=0,Wt.end=Wt.size}function _a(Lr,Wt,Qt,lr){for(let wr=0;wr<Lr.length;wr++){const vr=[];Vl(Lr[wr],vr,Qt,lr),Wt.push(vr)}}function Xl(Lr){return Lr/360+.5}function Go(Lr){const Wt=Math.sin(Lr*Math.PI/180),Qt=.5-.25*Math.log((1+Wt)/(1-Wt))/Math.PI;return Qt<0?0:Qt>1?1:Qt}function xl(Lr,Wt,Qt,lr,wr,vr,fr,Ur){if(lr/=Wt,vr>=(Qt/=Wt)&&fr<lr)return Lr;if(fr<Qt||vr>=lr)return null;const Rr=[];for(const Xr of Lr){const Sn=Xr.geometry;let ln=Xr.type;const Hn=wr===0?Xr.minX:Xr.minY,rs=wr===0?Xr.maxX:Xr.maxY;if(Hn>=Qt&&rs<lr){Rr.push(Xr);continue}if(rs<Qt||Hn>=lr)continue;let ds=[];if(ln==="Point"||ln==="MultiPoint")$u(Sn,ds,Qt,lr,wr);else if(ln==="LineString")su(Sn,ds,Qt,lr,wr,!1,Ur.lineMetrics);else if(ln==="MultiLineString")Ol(Sn,ds,Qt,lr,wr,!1);else if(ln==="Polygon")Ol(Sn,ds,Qt,lr,wr,!0);else if(ln==="MultiPolygon")for(const js of Sn){const Rs=[];Ol(js,Rs,Qt,lr,wr,!0),Rs.length&&ds.push(Rs)}if(ds.length){if(Ur.lineMetrics&&ln==="LineString"){for(const js of ds)Rr.push(Io(Xr.id,ln,js,Xr.tags));continue}ln!=="LineString"&&ln!=="MultiLineString"||(ds.length===1?(ln="LineString",ds=ds[0]):ln="MultiLineString"),ln!=="Point"&&ln!=="MultiPoint"||(ln=ds.length===3?"Point":"MultiPoint"),Rr.push(Io(Xr.id,ln,ds,Xr.tags))}}return Rr.length?Rr:null}function $u(Lr,Wt,Qt,lr,wr){for(let vr=0;vr<Lr.length;vr+=3){const fr=Lr[vr+wr];fr>=Qt&&fr<=lr&&bu(Wt,Lr[vr],Lr[vr+1],Lr[vr+2])}}function su(Lr,Wt,Qt,lr,wr,vr,fr){let Ur=Mu(Lr);const Rr=wr===0?_h:Hu;let Xr,Sn,ln=Lr.start;for(let Rs=0;Rs<Lr.length-3;Rs+=3){const Fs=Lr[Rs],Gs=Lr[Rs+1],Es=Lr[Rs+2],Mo=Lr[Rs+3],Jo=Lr[Rs+4],na=wr===0?Fs:Gs,ao=wr===0?Mo:Jo;let Ws=!1;fr&&(Xr=Math.sqrt(Math.pow(Fs-Mo,2)+Math.pow(Gs-Jo,2))),na<Qt?ao>Qt&&(Sn=Rr(Ur,Fs,Gs,Mo,Jo,Qt),fr&&(Ur.start=ln+Xr*Sn)):na>lr?ao<lr&&(Sn=Rr(Ur,Fs,Gs,Mo,Jo,lr),fr&&(Ur.start=ln+Xr*Sn)):bu(Ur,Fs,Gs,Es),ao<Qt&&na>=Qt&&(Sn=Rr(Ur,Fs,Gs,Mo,Jo,Qt),Ws=!0),ao>lr&&na<=lr&&(Sn=Rr(Ur,Fs,Gs,Mo,Jo,lr),Ws=!0),!vr&&Ws&&(fr&&(Ur.end=ln+Xr*Sn),Wt.push(Ur),Ur=Mu(Lr)),fr&&(ln+=Xr)}let Hn=Lr.length-3;const rs=Lr[Hn],ds=Lr[Hn+1],js=wr===0?rs:ds;js>=Qt&&js<=lr&&bu(Ur,rs,ds,Lr[Hn+2]),Hn=Ur.length-3,vr&&Hn>=3&&(Ur[Hn]!==Ur[0]||Ur[Hn+1]!==Ur[1])&&bu(Ur,Ur[0],Ur[1],Ur[2]),Ur.length&&Wt.push(Ur)}function Mu(Lr){const Wt=[];return Wt.size=Lr.size,Wt.start=Lr.start,Wt.end=Lr.end,Wt}function Ol(Lr,Wt,Qt,lr,wr,vr){for(const fr of Lr)su(fr,Wt,Qt,lr,wr,vr,!1)}function bu(Lr,Wt,Qt,lr){Lr.push(Wt,Qt,lr)}function _h(Lr,Wt,Qt,lr,wr,vr){const fr=(vr-Wt)/(lr-Wt);return bu(Lr,vr,Qt+(wr-Qt)*fr,1),fr}function Hu(Lr,Wt,Qt,lr,wr,vr){const fr=(vr-Qt)/(wr-Qt);return bu(Lr,Wt+(lr-Wt)*fr,vr,1),fr}function ku(Lr,Wt){const Qt=[];for(let lr=0;lr<Lr.length;lr++){const wr=Lr[lr],vr=wr.type;let fr;if(vr==="Point"||vr==="MultiPoint"||vr==="LineString")fr=_d(wr.geometry,Wt);else if(vr==="MultiLineString"||vr==="Polygon"){fr=[];for(const Ur of wr.geometry)fr.push(_d(Ur,Wt))}else if(vr==="MultiPolygon"){fr=[];for(const Ur of wr.geometry){const Rr=[];for(const Xr of Ur)Rr.push(_d(Xr,Wt));fr.push(Rr)}}Qt.push(Io(wr.id,vr,fr,wr.tags))}return Qt}function _d(Lr,Wt){const Qt=[];Qt.size=Lr.size,Lr.start!==void 0&&(Qt.start=Lr.start,Qt.end=Lr.end);for(let lr=0;lr<Lr.length;lr+=3)Qt.push(Lr[lr]+Wt,Lr[lr+1],Lr[lr+2]);return Qt}function dp(Lr,Wt){if(Lr.transformed)return Lr;const Qt=1<<Lr.z,lr=Lr.x,wr=Lr.y;for(const vr of Lr.features){const fr=vr.geometry,Ur=vr.type;if(vr.geometry=[],Ur===1)for(let Rr=0;Rr<fr.length;Rr+=2)vr.geometry.push(So(fr[Rr],fr[Rr+1],Wt,Qt,lr,wr));else for(let Rr=0;Rr<fr.length;Rr++){const Xr=[];for(let Sn=0;Sn<fr[Rr].length;Sn+=2)Xr.push(So(fr[Rr][Sn],fr[Rr][Sn+1],Wt,Qt,lr,wr));vr.geometry.push(Xr)}}return Lr.transformed=!0,Lr}function So(Lr,Wt,Qt,lr,wr,vr){return[Math.round(Qt*(Lr*lr-wr)),Math.round(Qt*(Wt*lr-vr))]}function Qo(Lr,Wt,Qt,lr,wr){const vr=Wt===wr.maxZoom?0:wr.tolerance/((1<<Wt)*wr.extent),fr={features:[],numPoints:0,numSimplified:0,numFeatures:Lr.length,source:null,x:Qt,y:lr,z:Wt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ur of Lr)ep(fr,Ur,vr,wr);return fr}function ep(Lr,Wt,Qt,lr){const wr=Wt.geometry,vr=Wt.type,fr=[];if(Lr.minX=Math.min(Lr.minX,Wt.minX),Lr.minY=Math.min(Lr.minY,Wt.minY),Lr.maxX=Math.max(Lr.maxX,Wt.maxX),Lr.maxY=Math.max(Lr.maxY,Wt.maxY),vr==="Point"||vr==="MultiPoint")for(let Ur=0;Ur<wr.length;Ur+=3)fr.push(wr[Ur],wr[Ur+1]),Lr.numPoints++,Lr.numSimplified++;else if(vr==="LineString")pp(fr,wr,Lr,Qt,!1,!1);else if(vr==="MultiLineString"||vr==="Polygon")for(let Ur=0;Ur<wr.length;Ur++)pp(fr,wr[Ur],Lr,Qt,vr==="Polygon",Ur===0);else if(vr==="MultiPolygon")for(let Ur=0;Ur<wr.length;Ur++){const Rr=wr[Ur];for(let Xr=0;Xr<Rr.length;Xr++)pp(fr,Rr[Xr],Lr,Qt,!0,Xr===0)}if(fr.length){let Ur=Wt.tags||null;if(vr==="LineString"&&lr.lineMetrics){Ur={};for(const Xr in Wt.tags)Ur[Xr]=Wt.tags[Xr];Ur.mapbox_clip_start=wr.start/wr.size,Ur.mapbox_clip_end=wr.end/wr.size}const Rr={geometry:fr,type:vr==="Polygon"||vr==="MultiPolygon"?3:vr==="LineString"||vr==="MultiLineString"?2:1,tags:Ur};Wt.id!==null&&(Rr.id=Wt.id),Lr.features.push(Rr)}}function pp(Lr,Wt,Qt,lr,wr,vr){const fr=lr*lr;if(lr>0&&Wt.size<(wr?fr:lr))return void(Qt.numPoints+=Wt.length/3);const Ur=[];for(let Rr=0;Rr<Wt.length;Rr+=3)(lr===0||Wt[Rr+2]>fr)&&(Qt.numSimplified++,Ur.push(Wt[Rr],Wt[Rr+1])),Qt.numPoints++;wr&&function(Rr,Xr){let Sn=0;for(let ln=0,Hn=Rr.length,rs=Hn-2;ln<Hn;rs=ln,ln+=2)Sn+=(Rr[ln]-Rr[rs])*(Rr[ln+1]+Rr[rs+1]);if(Sn>0===Xr)for(let ln=0,Hn=Rr.length;ln<Hn/2;ln+=2){const rs=Rr[ln],ds=Rr[ln+1];Rr[ln]=Rr[Hn-2-ln],Rr[ln+1]=Rr[Hn-1-ln],Rr[Hn-2-ln]=rs,Rr[Hn-1-ln]=ds}}(Ur,vr),Lr.push(Ur)}const wu={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ap{constructor(Wt,Qt){const lr=(Qt=this.options=function(vr,fr){for(const Ur in fr)vr[Ur]=fr[Ur];return vr}(Object.create(wu),Qt)).debug;if(lr&&console.time("preprocess data"),Qt.maxZoom<0||Qt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Qt.promoteId&&Qt.generateId)throw new Error("promoteId and generateId cannot be used together.");let wr=function(vr,fr){const Ur=[];if(vr.type==="FeatureCollection")for(let Rr=0;Rr<vr.features.length;Rr++)Uo(Ur,vr.features[Rr],fr,Rr);else Uo(Ur,vr.type==="Feature"?vr:{geometry:vr},fr);return Ur}(Wt,Qt);this.tiles={},this.tileCoords=[],lr&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Qt.indexMaxZoom,Qt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),wr=function(vr,fr){const Ur=fr.buffer/fr.extent;let Rr=vr;const Xr=xl(vr,1,-1-Ur,Ur,0,-1,2,fr),Sn=xl(vr,1,1-Ur,2+Ur,0,-1,2,fr);return(Xr||Sn)&&(Rr=xl(vr,1,-Ur,1+Ur,0,-1,2,fr)||[],Xr&&(Rr=ku(Xr,1).concat(Rr)),Sn&&(Rr=Rr.concat(ku(Sn,-1)))),Rr}(wr,Qt),wr.length&&this.splitTile(wr,0,0,0),lr&&(wr.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Wt,Qt,lr,wr,vr,fr,Ur){const Rr=[Wt,Qt,lr,wr],Xr=this.options,Sn=Xr.debug;for(;Rr.length;){wr=Rr.pop(),lr=Rr.pop(),Qt=Rr.pop(),Wt=Rr.pop();const ln=1<<Qt,Hn=Wp(Qt,lr,wr);let rs=this.tiles[Hn];if(!rs&&(Sn>1&&console.time("creation"),rs=this.tiles[Hn]=Qo(Wt,Qt,lr,wr,Xr),this.tileCoords.push({z:Qt,x:lr,y:wr}),Sn)){Sn>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Qt,lr,wr,rs.numFeatures,rs.numPoints,rs.numSimplified),console.timeEnd("creation"));const Ws=`z${Qt}`;this.stats[Ws]=(this.stats[Ws]||0)+1,this.total++}if(rs.source=Wt,vr==null){if(Qt===Xr.indexMaxZoom||rs.numPoints<=Xr.indexMaxPoints)continue}else{if(Qt===Xr.maxZoom||Qt===vr)continue;if(vr!=null){const Ws=vr-Qt;if(lr!==fr>>Ws||wr!==Ur>>Ws)continue}}if(rs.source=null,Wt.length===0)continue;Sn>1&&console.time("clipping");const ds=.5*Xr.buffer/Xr.extent,js=.5-ds,Rs=.5+ds,Fs=1+ds;let Gs=null,Es=null,Mo=null,Jo=null,na=xl(Wt,ln,lr-ds,lr+Rs,0,rs.minX,rs.maxX,Xr),ao=xl(Wt,ln,lr+js,lr+Fs,0,rs.minX,rs.maxX,Xr);Wt=null,na&&(Gs=xl(na,ln,wr-ds,wr+Rs,1,rs.minY,rs.maxY,Xr),Es=xl(na,ln,wr+js,wr+Fs,1,rs.minY,rs.maxY,Xr),na=null),ao&&(Mo=xl(ao,ln,wr-ds,wr+Rs,1,rs.minY,rs.maxY,Xr),Jo=xl(ao,ln,wr+js,wr+Fs,1,rs.minY,rs.maxY,Xr),ao=null),Sn>1&&console.timeEnd("clipping"),Rr.push(Gs||[],Qt+1,2*lr,2*wr),Rr.push(Es||[],Qt+1,2*lr,2*wr+1),Rr.push(Mo||[],Qt+1,2*lr+1,2*wr),Rr.push(Jo||[],Qt+1,2*lr+1,2*wr+1)}}getTile(Wt,Qt,lr){Wt=+Wt,Qt=+Qt,lr=+lr;const wr=this.options,{extent:vr,debug:fr}=wr;if(Wt<0||Wt>24)return null;const Ur=1<<Wt,Rr=Wp(Wt,Qt=Qt+Ur&Ur-1,lr);if(this.tiles[Rr])return dp(this.tiles[Rr],vr);fr>1&&console.log("drilling down to z%d-%d-%d",Wt,Qt,lr);let Xr,Sn=Wt,ln=Qt,Hn=lr;for(;!Xr&&Sn>0;)Sn--,ln>>=1,Hn>>=1,Xr=this.tiles[Wp(Sn,ln,Hn)];return Xr&&Xr.source?(fr>1&&(console.log("found parent tile z%d-%d-%d",Sn,ln,Hn),console.time("drilling down")),this.splitTile(Xr.source,Sn,ln,Hn,Wt,Qt,lr),fr>1&&console.timeEnd("drilling down"),this.tiles[Rr]?dp(this.tiles[Rr],vr):null):null}}function Wp(Lr,Wt,Qt){return 32*((1<<Lr)*Qt+Wt)+Lr}function Wu(Lr,Wt){const Qt=Lr.tileID.canonical;if(!this._geoJSONIndex)return void Wt(null,null);const lr=this._geoJSONIndex.getTile(Qt.z,Qt.x,Qt.y);if(!lr)return void Wt(null,null);const wr=Xr=>Xr.tags&&"3d_elevation_id"in Xr.tags&&"source"in Xr.tags&&Xr.tags.source==="elevation",vr=lr.features.filter(Xr=>wr(Xr));let fr={_geojsonTileLayer:lr.features};vr.length>0&&(fr={_geojsonTileLayer:lr.features.filter(Xr=>!wr(Xr)),hd_road_elevation:vr});const Ur=new ir(fr),Rr=function(Xr){const Sn=new h.bt;for(const ln of Object.keys(Xr))Sn.writeMessage(3,Ut,{name:ln,features:Xr[ln]});return Sn.finish()}(fr).buffer;Wt(null,{vectorTile:Ur,rawData:Rr})}class yn extends Bt{constructor(Wt,Qt,lr,wr,vr,fr,Ur){super(Wt,Qt,lr,wr,vr,Wu,Ur),fr&&(this.loadGeoJSON=fr),this._dynamicIndex=new br}loadData(Wt,Qt){const lr=Wt&&Wt.request,wr=lr&&lr.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(Wt,(vr,fr)=>{if(vr||!fr)return Qt(vr);if(typeof fr!="object")return Qt(new Error(`Input data given to '${Wt.source}' is not a valid GeoJSON object.`));{try{if(Wt.filter){const Rr=h.U(Wt.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Rr.result==="error")throw new Error(Rr.value.map(Xr=>`${Xr.key}: ${Xr.message}`).join(", "));fr.features=fr.features.filter(Xr=>Rr.value.evaluate({zoom:0},Xr))}Wt.dynamic?(fr.type==="Feature"&&(fr={type:"FeatureCollection",features:[fr]}),Wt.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(fr.features,this.loaded),Wt.cluster&&(fr.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Wt.cluster?new bo(function({superclusterOptions:Rr,clusterProperties:Xr}){if(!Xr||!Rr)return Rr;const Sn={},ln={},Hn={accumulated:null,zoom:0},rs={properties:null},ds=Object.keys(Xr);for(const js of ds){const[Rs,Fs]=Xr[js],Gs=h.U(Fs),Es=h.U(typeof Rs=="string"?[Rs,["accumulated"],["get",js]]:Rs);Sn[js]=Gs.value,ln[js]=Es.value}return Rr.map=js=>{rs.properties=js;const Rs={};for(const Fs of ds)Rs[Fs]=Sn[Fs].evaluate(Hn,rs);return Rs},Rr.reduce=(js,Rs)=>{rs.properties=Rs;for(const Fs of ds)Hn.accumulated=js[Fs],js[Fs]=ln[Fs].evaluate(Hn,rs)},Rr}(Wt)).load(fr.features):Wt.dynamic?this._dynamicIndex:function(Rr,Xr){return new Ap(Rr,Xr)}(fr,Wt.geojsonVtOptions)}catch(Rr){return Qt(Rr)}const Ur={};if(wr){const Rr=dt(lr);Rr&&(Ur.resourceTiming={},Ur.resourceTiming[Wt.source]=JSON.parse(JSON.stringify(Rr)))}Qt(null,Ur)}})}reloadTile(Wt,Qt){const lr=this.loaded;return lr&&lr[Wt.uid]?Wt.partial?Qt(null,void 0):super.reloadTile(Wt,Qt):this.loadTile(Wt,Qt)}loadGeoJSON(Wt,Qt){if(Wt.request)h.m(Wt.request,Qt);else{if(typeof Wt.data!="string")return Qt(new Error(`Input data given to '${Wt.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return Qt(null,JSON.parse(Wt.data))}catch{return Qt(new Error(`Input data given to '${Wt.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(Wt,Qt){try{Qt(null,this._geoJSONIndex.getClusterExpansionZoom(Wt.clusterId))}catch(lr){Qt(lr)}}getClusterChildren(Wt,Qt){try{Qt(null,this._geoJSONIndex.getChildren(Wt.clusterId))}catch(lr){Qt(lr)}}getClusterLeaves(Wt,Qt){try{Qt(null,this._geoJSONIndex.getLeaves(Wt.clusterId,Wt.limit,Wt.offset))}catch(lr){Qt(lr)}}}class qu{constructor(Wt,Qt,lr){this.tileID=new h.aO(Wt.tileID.overscaledZ,Wt.tileID.wrap,Wt.tileID.canonical.z,Wt.tileID.canonical.x,Wt.tileID.canonical.y),this.tileZoom=Wt.tileZoom,this.uid=Wt.uid,this.zoom=Wt.zoom,this.canonical=Wt.tileID.canonical,this.pixelRatio=Wt.pixelRatio,this.tileSize=Wt.tileSize,this.source=Wt.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Wt.projection,this.brightness=Qt,this.worldview=lr}parse(Wt,Qt,lr,wr){this.status="parsing";const vr=new h.aO(lr.tileID.overscaledZ,lr.tileID.wrap,lr.tileID.canonical.z,lr.tileID.canonical.x,lr.tileID.canonical.y),fr=[],Ur=Qt.familiesBySource[lr.source],Rr=new h.fe(vr,lr.promoteId);Rr.bucketLayerIDs=[],Rr.is3DTile=!0,h.ft(Wt).then(Xr=>{if(!Xr)return wr(new Error("Could not parse tile"));const Sn=Xr.json.extensionsUsed&&Xr.json.extensionsUsed.includes("MAPBOX_mesh_features")||Xr.json.asset.extras&&Xr.json.asset.extras.MAPBOX_mesh_features,ln=Xr.json.extensionsUsed&&Xr.json.extensionsUsed.includes("EXT_meshopt_compression"),Hn=new h.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const rs in Ur)for(const ds of Ur[rs]){const js=ds[0];Rr.bucketLayerIDs.push(ds.map(Gs=>h.B(Gs.id,Gs.scope))),js.recalculate(Hn,[]);const Rs=h.fu(Xr,1/h.d6(lr.tileID.canonical)),Fs=new h.fv(ds,Rs,vr,Sn,ln,this.brightness,Rr,this.worldview);Sn||(Fs.needsUpload=!0),fr.push(Fs),Fs.evaluate(js)}this.status="done",wr(null,{buckets:fr,featureIndex:Rr,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Xr=>wr(new Error(Xr.message)))}}class qp{constructor(Wt,Qt,lr,wr,vr,fr,Ur,Rr){this.actor=Wt,this.layerIndex=Qt,this.availableImages=lr,this.availableModels=wr,this.brightness=Ur,this.loading={},this.loaded={},this.worldview=Rr}loadTile(Wt,Qt){const lr=Wt.uid,wr=this.loading[lr]=new qu(Wt,this.brightness,this.worldview);h.bu(Wt.request,(vr,fr)=>{const Ur=!this.loading[lr];return delete this.loading[lr],Ur||vr?(wr.status="done",Ur||(this.loaded[lr]=wr),Qt(vr)):fr&&fr.byteLength!==0?void wr.parse(fr,this.layerIndex,Wt,(Rr,Xr)=>{wr.status="done",this.loaded=this.loaded||{},this.loaded[lr]=wr,Rr||!Xr?Qt(Rr):Qt(null,Xr)}):(wr.status="done",this.loaded[lr]=wr,Qt())})}reloadTile(Wt,Qt){const lr=this.loaded,wr=Wt.uid;if(lr&&lr[wr]){const vr=lr[wr];vr.projection=Wt.projection,vr.brightness=Wt.brightness;const fr=(Ur,Rr)=>{vr.reloadCallback&&(delete vr.reloadCallback,this.loadTile(Wt,Qt)),Qt(Ur,Rr)};vr.status==="parsing"?vr.reloadCallback=fr:vr.status==="done"&&this.loadTile(Wt,Qt)}}abortTile(Wt,Qt){const lr=Wt.uid;this.loading[lr]&&delete this.loading[lr],Qt()}removeTile(Wt,Qt){const lr=this.loaded,wr=Wt.uid;lr&&lr[wr]&&delete lr[wr],Qt()}}class tp{constructor(Wt){this.self=Wt,this.actor=new h.fx(Wt,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new h.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=h.cl({name:"mercator"}),this.workerSourceTypes={vector:Bt,geojson:yn,"raster-dem":Tt,"raster-array":St,"batched-model":qp},this.workerSources={},this.self.registerWorkerSource=(Qt,lr)=>{if(this.workerSourceTypes[Qt])throw new Error(`Worker source with name "${Qt}" already registered.`);this.workerSourceTypes[Qt]=lr},this.self.registerRTLTextPlugin=Qt=>{if(h.fy.isParsed())throw new Error("RTL text plugin already registered.");h.fy.setState({pluginStatus:h.fz.parsed,pluginURL:h.fy.getPluginURL()}),h.fy.applyArabicShaping=Qt.applyArabicShaping,h.fy.processBidirectionalText=Qt.processBidirectionalText,h.fy.processStyledBidirectionalText=Qt.processStyledBidirectionalText;for(const lr of this.rtlPluginParsingListeners)lr(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Wt,Qt,lr){delete this.layerIndexes[Wt],delete this.availableImages[Wt],delete this.availableModels[Wt],delete this.workerSources[Wt],lr()}checkIfReady(Wt,Qt,lr){lr()}setReferrer(Wt,Qt){this.referrer=Qt}spriteLoaded(Wt,Qt){this.isSpriteLoaded[Wt]||(this.isSpriteLoaded[Wt]={});const{scope:lr,isLoaded:wr}=Qt;if(this.isSpriteLoaded[Wt][lr]=wr,this.workerSources[Wt]&&this.workerSources[Wt][lr])for(const vr in this.workerSources[Wt][lr]){const fr=this.workerSources[Wt][lr][vr];for(const Ur in fr){const Rr=fr[Ur];Rr instanceof Bt&&(Rr.isSpriteLoaded=wr,Rr.fire(new h.z("isSpriteLoaded")))}}}setImages(Wt,Qt,lr){this.availableImages[Wt]||(this.availableImages[Wt]={});const{scope:wr,images:vr}=Qt;if(this.availableImages[Wt][wr]=vr,this.workerSources[Wt]&&this.workerSources[Wt][wr]){for(const fr in this.workerSources[Wt][wr]){const Ur=this.workerSources[Wt][wr][fr];for(const Rr in Ur)Ur[Rr].availableImages=vr}lr()}else lr()}setModels(Wt,{scope:Qt,models:lr},wr){if(this.availableModels[Wt]||(this.availableModels[Wt]={}),this.availableModels[Wt][Qt]=lr,this.workerSources[Wt]&&this.workerSources[Wt][Qt]){for(const vr in this.workerSources[Wt][Qt]){const fr=this.workerSources[Wt][Qt][vr];for(const Ur in fr)fr[Ur].availableModels=lr}wr()}else wr()}setProjection(Wt,Qt){this.projections[Wt]=h.cl(Qt)}setBrightness(Wt,Qt,lr){this.brightness=Qt,lr()}setWorldview(Wt,Qt,lr){this.worldview=Qt,lr()}setLayers(Wt,Qt,lr){this.getLayerIndex(Wt,Qt.scope).replace(Qt.layers,Qt.options),lr()}updateLayers(Wt,Qt,lr){this.getLayerIndex(Wt,Qt.scope).update(Qt.layers,Qt.removedIds,Qt.options),lr()}loadTile(Wt,Qt,lr){Qt.projection=this.projections[Wt]||this.defaultProjection,this.getWorkerSource(Wt,Qt.type,Qt.source,Qt.scope).loadTile(Qt,lr)}decodeRasterArray(Wt,Qt,lr){this.getWorkerSource(Wt,Qt.type,Qt.source,Qt.scope).decodeRasterArray(Qt,lr)}reloadTile(Wt,Qt,lr){Qt.projection=this.projections[Wt]||this.defaultProjection,this.getWorkerSource(Wt,Qt.type,Qt.source,Qt.scope).reloadTile(Qt,lr)}abortTile(Wt,Qt,lr){this.getWorkerSource(Wt,Qt.type,Qt.source,Qt.scope).abortTile(Qt,lr)}removeTile(Wt,Qt,lr){this.getWorkerSource(Wt,Qt.type,Qt.source,Qt.scope).removeTile(Qt,lr)}removeSource(Wt,Qt,lr){if(!(this.workerSources[Wt]&&this.workerSources[Wt][Qt.scope]&&this.workerSources[Wt][Qt.scope][Qt.type]&&this.workerSources[Wt][Qt.scope][Qt.type][Qt.source]))return;const wr=this.workerSources[Wt][Qt.scope][Qt.type][Qt.source];delete this.workerSources[Wt][Qt.scope][Qt.type][Qt.source],wr.removeSource!==void 0?wr.removeSource(Qt,lr):lr()}loadWorkerSource(Wt,Qt,lr){try{this.self.importScripts(Qt.url),lr()}catch(wr){lr(wr.toString())}}syncRTLPluginState(Wt,Qt,lr){if(h.fy.isParsed())lr(null,!0);else if(h.fy.isParsing())this.rtlPluginParsingListeners.push(lr);else try{h.fy.setState(Qt);const wr=h.fy.getPluginURL();!h.fy.isLoaded()||h.fy.isParsed()||h.fy.isParsing()||wr==null||(h.fy.setState({pluginStatus:h.fz.parsing,pluginURL:h.fy.getPluginURL()}),this.self.importScripts(wr),h.fy.isParsed()?lr(null,!0):this.rtlPluginParsingListeners.push(lr))}catch(wr){lr(wr.toString())}}setDracoUrl(Wt,Qt){this.dracoUrl=Qt}getAvailableImages(Wt,Qt){this.availableImages[Wt]||(this.availableImages[Wt]={});let lr=this.availableImages[Wt][Qt];return lr||(lr=[]),lr}getAvailableModels(Wt,Qt){this.availableModels[Wt]||(this.availableModels[Wt]={});let lr=this.availableModels[Wt][Qt];return lr||(lr={}),lr}getLayerIndex(Wt,Qt){this.layerIndexes[Wt]||(this.layerIndexes[Wt]={});let lr=this.layerIndexes[Wt][Qt];return lr||(lr=this.layerIndexes[Wt][Qt]=new Ct,lr.scope=Qt),lr}getWorkerSource(Wt,Qt,lr,wr){const vr=this.workerSources;return vr[Wt]||(vr[Wt]={}),vr[Wt][wr]||(vr[Wt][wr]={}),vr[Wt][wr][Qt]||(vr[Wt][wr][Qt]={}),this.isSpriteLoaded[Wt]||(this.isSpriteLoaded[Wt]={}),vr[Wt][wr][Qt][lr]||(vr[Wt][wr][Qt][lr]=new this.workerSourceTypes[Qt]({send:(fr,Ur,Rr,Xr,Sn,ln)=>this.actor.send(fr,Ur,Rr,Wt,Sn,ln),scheduler:this.actor.scheduler},this.getLayerIndex(Wt,wr),this.getAvailableImages(Wt,wr),this.getAvailableModels(Wt,wr),this.isSpriteLoaded[Wt][wr],void 0,this.brightness,this.worldview)),vr[Wt][wr][Qt][lr]}rasterizeImagesWorker(Wt,Qt,lr){const wr=new Map;for(const[vr,{image:fr,imageVariant:Ur}]of Qt.tasks.entries()){const Rr=this.imageRasterizer.rasterize(Ur,fr,Qt.scope,Wt);wr.set(vr,Rr)}lr(void 0,wr)}removeRasterizedImages(Wt,Qt,lr){this.imageRasterizer.removeImagesFromCacheByIds(Qt.imageIds,Qt.scope,Wt),lr()}enforceCacheSizeLimit(Wt,Qt){h.fA(Qt)}getWorkerPerformanceMetrics(Wt,Qt,lr){lr(void 0,void 0)}}return h.fw(self)&&(self.worker=new tp(self)),tp}),it(["./shared"],function(h){var dt="3.15.0";const ft={create:"create",load:"load",fullLoad:"fullLoad"},xt={mark(et){performance.mark(et)},measure(et,o,g){performance.measure(et,o,g)}};function Ct(et){const o=et.name.split("?")[0];return h.a(o)&&o.includes("mapbox-gl.js")?"javascript":h.a(o)&&o.includes("mapbox-gl.css")?"css":h.b(o)?"fontRange":h.c(o)?"sprite":h.i(o)?"style":h.d(o)?"tilejson":"other"}var bt,kt={},Dt=function(){if(bt)return kt;function et(_e){return!o(_e)}function o(_e){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var st,lt,ut=new Blob([""],{type:"text/javascript"}),pt=URL.createObjectURL(ut);try{lt=new Worker(pt),st=!0}catch{st=!1}return lt&&lt.terminate(),URL.revokeObjectURL(pt),st}()?function(){var st=document.createElement("canvas");st.width=st.height=1;var lt=st.getContext("2d");if(!lt)return!1;var ut=lt.getImageData(0,0,1,1);return ut&&ut.width===st.width}()?(g[nt=_e&&_e.failIfMajorPerformanceCaveat]===void 0&&(g[nt]=function(st){var lt,ut=function(pt){var yt=document.createElement("canvas"),vt=Object.create(et.webGLContextAttributes);return vt.failIfMajorPerformanceCaveat=pt,yt.getContext("webgl2",vt)}(st);if(!ut)return!1;try{lt=ut.createShader(ut.VERTEX_SHADER)}catch{return!1}return!(!lt||ut.isContextLost())&&(ut.shaderSource(lt,"void main() {}"),ut.compileShader(lt),ut.getShaderParameter(lt,ut.COMPILE_STATUS)===!0)}(nt)),g[nt]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var nt}bt=1,kt.supported=et,kt.notSupportedReason=o;var g={};return et.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},kt}();function At(et,o,g){const _e=document.createElement(et);return o!=null&&(_e.className=o),g&&g.appendChild(_e),_e}function Bt(et,o,g){const _e=document.createElementNS("http://www.w3.org/2000/svg",et);for(const nt of Object.keys(o))_e.setAttributeNS(null,nt,String(o[nt]));return g&&g.appendChild(_e),_e}const Tt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,It=Tt&&Tt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let St;function jt(){Tt&&It&&(St=Tt[It],Tt[It]="none")}function Ht(){Tt&&It&&(Tt[It]=St)}function Kt(et){et.preventDefault(),et.stopPropagation(),window.removeEventListener("click",Kt,!0)}function ir(){window.addEventListener("click",Kt,!0),window.setTimeout(()=>{window.removeEventListener("click",Kt,!0)},0)}function nr(et,o){const g=et.getBoundingClientRect();return Sr(et,g,o)}function kr(et,o){const g=et.getBoundingClientRect(),_e=[];for(let nt=0;nt<o.length;nt++)_e.push(Sr(et,g,o[nt]));return _e}function br(et){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&et.button===2&&et.ctrlKey?0:et.button}function Sr(et,o,g){const _e=et.offsetWidth===o.width?1:et.offsetWidth/o.width;return new h.P((g.clientX-o.left)*_e,(g.clientY-o.top)*_e)}const $r="01",rn="NO_ACCESS_TOKEN";class Zr{constructor(o,g,_e){this._transformRequestFn=o,this._customAccessToken=g,this._silenceAuthErrors=!!_e,this._createSkuToken()}_createSkuToken(){const o=function(){let g="";for(let _e=0;_e<10;_e++)g+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",$r,g].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,g){return this._transformRequestFn&&this._transformRequestFn(o,g)||{url:o}}normalizeStyleURL(o,g){if(!h.h(o))return o;const _e=Xt(o);return _e.params.push(`sdk=js-${dt}`),_e.path=`/styles/v1${_e.path}`,this._makeAPIURL(_e,this._customAccessToken||g)}normalizeGlyphsURL(o,g){if(!h.h(o))return o;const _e=Xt(o);return _e.path=`/fonts/v1${_e.path}`,this._makeAPIURL(_e,this._customAccessToken||g)}normalizeModelURL(o,g){if(!h.h(o))return o;const _e=Xt(o);return _e.path=`/models/v1${_e.path}`,this._makeAPIURL(_e,this._customAccessToken||g)}normalizeSourceURL(o,g,_e,nt){if(!h.h(o))return o;const st=Xt(o);return st.path=`/v4/${st.authority}.json`,st.params.push("secure"),_e&&st.params.push(`language=${_e}`),nt&&st.params.push(`worldview=${nt}`),this._makeAPIURL(st,this._customAccessToken||g)}normalizeIconsetURL(o,g){const _e=Xt(o);return h.h(o)?(_e.path=`/styles/v1${_e.path}/iconset.pbf`,this._makeAPIURL(_e,this._customAccessToken||g)):mr(_e)}normalizeSpriteURL(o,g,_e,nt){const st=Xt(o);return h.h(o)?(st.path=`/styles/v1${st.path}/sprite${g}${_e}`,this._makeAPIURL(st,this._customAccessToken||nt)):(st.path+=`${g}${_e}`,mr(st))}normalizeTileURL(o,g,_e){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!h.h(o))return o;const nt=Xt(o);nt.path=nt.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${g||_e&&nt.authority!=="raster"&&_e===512?"@2x":""}${h.k.supported?".webp":"$1"}`),nt.authority==="raster"?nt.path=`/${h.e.RASTER_URL_PREFIX}${nt.path}`:nt.authority==="rasterarrays"?nt.path=`/${h.e.RASTERARRAYS_URL_PREFIX}${nt.path}`:nt.authority==="3dtiles"?nt.path=`/${h.e.TILES3D_URL_PREFIX}${nt.path}`:(nt.path=nt.path.replace(/^.+\/v4\//,"/"),nt.path=`/${h.e.TILE_URL_VERSION}${nt.path}`);const st=this._customAccessToken||function(lt){for(const ut of lt){const pt=ut.match(/^access_token=(.*)$/);if(pt)return pt[1]}return null}(nt.params)||h.e.ACCESS_TOKEN;return h.e.REQUIRE_ACCESS_TOKEN&&st&&this._skuToken&&nt.params.push(`sku=${this._skuToken}`),this._makeAPIURL(nt,st)}canonicalizeTileURL(o,g){const _e=Xt(o);if(!_e.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!_e.path.match(/\.[\w]+$/))return o;let nt="mapbox://";_e.path.match(/^\/raster\/v1\//)?nt+=`raster/${_e.path.replace(`/${h.e.RASTER_URL_PREFIX}/`,"")}`:_e.path.match(/^\/rasterarrays\/v1\//)?nt+=`rasterarrays/${_e.path.replace(`/${h.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:nt+=`tiles/${_e.path.replace(`/${h.e.TILE_URL_VERSION}/`,"")}`;let st=_e.params;return g&&(st=st.filter(lt=>!lt.match(/^access_token=/))),st.length&&(nt+=`?${st.join("&")}`),nt}canonicalizeTileset(o,g){const _e=!!g&&h.h(g),nt=[];for(const st of o.tiles||[])h.j(st)?nt.push(this.canonicalizeTileURL(st,_e)):nt.push(st);return nt}_makeAPIURL(o,g){const _e="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",nt=Xt(h.e.API_URL);if(o.protocol=nt.protocol,o.authority=nt.authority,o.protocol==="http"){const st=o.params.indexOf("secure");st>=0&&o.params.splice(st,1)}if(nt.path!=="/"&&(o.path=`${nt.path}${o.path}`),!h.e.REQUIRE_ACCESS_TOKEN)return mr(o);if(g=g||h.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!g)throw new Error(`An API access token is required to use Mapbox GL. ${_e}`);if(g[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${_e}`)}return o.params=o.params.filter(st=>st.indexOf("access_token")===-1),o.params.push(`access_token=${g||""}`),mr(o)}}const Kr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Xt(et){const o=et.match(Kr);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function mr(et){const o=et.params.length?`?${et.params.join("&")}`:"";return`${et.protocol}://${et.authority}${et.path}${o}`}const Ut="mapbox.eventData";function Jt(et){if(!et)return null;const o=et.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(h.l(o[1]))}catch{return null}}class Or{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const g=Jt(h.e.ACCESS_TOKEN);let _e="";return _e=g&&g.u?h.f(g.u):h.e.ACCESS_TOKEN||"",o?`${Ut}.${o}:${_e}`:`${Ut}:${_e}`}fetchEventData(){const o=h.s("localStorage"),g=this.getStorageKey(),_e=this.getStorageKey("uuid");if(o)try{const nt=localStorage.getItem(g);nt&&(this.eventData=JSON.parse(nt));const st=localStorage.getItem(_e);st&&(this.anonId=st)}catch{h.w("Unable to read from LocalStorage")}}saveEventData(){const o=h.s("localStorage"),g=this.getStorageKey(),_e=this.getStorageKey("uuid"),nt=this.anonId;if(o&&nt)try{localStorage.setItem(_e,nt),Object.keys(this.eventData).length>=1&&localStorage.setItem(g,JSON.stringify(this.eventData))}catch{h.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,g,_e,nt){if(!h.e.EVENTS_URL)return;const st=Xt(h.e.EVENTS_URL);st.params.push(`access_token=${nt||h.e.ACCESS_TOKEN||""}`);const lt={event:this.type,created:new Date(o).toISOString()},ut=g?Object.assign(lt,g):lt,pt={url:mr(st),headers:{"Content-Type":"text/plain"},body:JSON.stringify([ut])};this.pendingRequest=h.p(pt,yt=>{this.pendingRequest=null,_e(yt),this.saveEventData(),this.processRequests(nt)})}queueRequest(o,g){this.queue.push(o),this.processRequests(g)}}const Cr=new class extends Or{constructor(et){super("appUserTurnstile"),this._customAccessToken=et}postTurnstileEvent(et,o){h.e.EVENTS_URL&&h.e.ACCESS_TOKEN&&Array.isArray(et)&&et.some(g=>h.h(g)||h.j(g))&&this.queueRequest(Date.now(),o)}processRequests(et){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=Jt(h.e.ACCESS_TOKEN),g=o?o.u:h.e.ACCESS_TOKEN;let _e=g!==this.eventData.tokenU;h.v(this.anonId)||(this.anonId=h.u(),_e=!0);const nt=this.queue.shift();if(this.eventData.lastSuccess){const st=new Date(this.eventData.lastSuccess),lt=new Date(nt),ut=(nt-this.eventData.lastSuccess)/864e5;_e=_e||ut>=1||ut<-1||st.getDate()!==lt.getDate()}else _e=!0;_e?this.postEvent(nt,{sdkIdentifier:"mapbox-gl-js",sdkVersion:dt,skuId:$r,"enabled.telemetry":!1,userId:this.anonId},st=>{st||(this.eventData.lastSuccess=nt,this.eventData.tokenU=g)},et):this.processRequests()}},pn=Cr.postTurnstileEvent.bind(Cr),On=new class extends Or{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(et,o,g,_e){this.skuToken=o,this.errorCb=_e,h.e.EVENTS_URL&&(g||h.e.ACCESS_TOKEN?this.queueRequest({id:et,timestamp:Date.now()},g):this.errorCb(new Error(rn)))}processRequests(et){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:g}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),h.v(this.anonId)||(this.anonId=h.u()),this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:dt,skuId:$r,skuToken:this.skuToken,userId:this.anonId},_e=>{_e?this.errorCb(_e):o&&(this.success[o]=!0)},et))}remove(){this.errorCb=null}},Zn=On.postMapLoadEvent.bind(On),As=new class extends Or{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(et){let o=this.mapInstanceIdMap.get(et);return o||(o=h.u(),this.mapInstanceIdMap.set(et,o)),o}getEventId(et){const o=this.eventIdPerMapInstanceMap.get(et)||0;return this.eventIdPerMapInstanceMap.set(et,o+1),o}postStyleLoadEvent(et,o){const{map:g,style:_e,importedStyles:nt}=o;if(!h.e.EVENTS_URL||!et&&!h.e.ACCESS_TOKEN)return;const st=this.getMapInstanceId(g),lt={mapInstanceId:st,eventId:this.getEventId(st),style:_e};nt.length&&(lt.importedStyles=nt),this.queueRequest({timestamp:Date.now(),payload:lt},et)}processRequests(et){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:g}=this.queue.shift();this.postEvent(o,g,()=>{},et)}},ss=As.postStyleLoadEvent.bind(As),Ls=new class extends Or{constructor(){super("gljs.performance")}postPerformanceEvent(et,o){h.e.EVENTS_URL&&(et||h.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},et)}processRequests(et){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:g}=this.queue.shift(),_e=function(nt){const st=performance.getEntriesByType("resource"),lt=performance.getEntriesByType("mark"),ut=function(Lt){const Ft={};if(Lt){for(const Ot in Lt)if(Ot!=="other")for(const qt of Lt[Ot]){const $t=`${Ot}ResolveRangeMin`,Yt=`${Ot}ResolveRangeMax`,tr=`${Ot}RequestCount`,sr=`${Ot}RequestCachedCount`;Ft[$t]=Math.min(Ft[$t]||1/0,qt.startTime),Ft[Yt]=Math.max(Ft[Yt]||-1/0,qt.responseEnd);const pr=hr=>{Ft[hr]===void 0&&(Ft[hr]=0),++Ft[hr]};qt.transferSize!==void 0&&qt.transferSize===0&&pr(sr),pr(tr)}}return Ft}(function(Lt,Ft){const Ot={};if(Lt)for(const qt of Lt){const $t=Ft(qt);Ot[$t]===void 0&&(Ot[$t]=[]),Ot[$t].push(qt)}return Ot}(st,Ct)),pt=window.devicePixelRatio,yt=navigator.connection||navigator.mozConnection||navigator.webkitConnection,vt=yt?yt.effectiveType:void 0,Mt={counters:[],metadata:[],attributes:[]},Et=(Lt,Ft,Ot)=>{Ot!=null&&Lt.push({name:Ft,value:Ot.toString()})};for(const Lt in ut)Et(Mt.counters,Lt,ut[Lt]);if(nt.interactionRange[0]!==1/0&&nt.interactionRange[1]!==-1/0&&(Et(Mt.counters,"interactionRangeMin",nt.interactionRange[0]),Et(Mt.counters,"interactionRangeMax",nt.interactionRange[1])),lt)for(const Lt of Object.keys(ft)){const Ft=ft[Lt],Ot=lt.find(qt=>qt.name===Ft);Ot&&Et(Mt.counters,Ft,Ot.startTime)}return Et(Mt.counters,"visibilityHidden",nt.visibilityHidden),Et(Mt.attributes,"style",function(Lt){if(Lt)for(const Ft of Lt){const Ot=Ft.name.split("?")[0];if(h.i(Ot)){const qt=Ot.split("/").slice(-2);if(qt.length===2)return`mapbox://styles/${qt[0]}/${qt[1]}`}}}(st)),Et(Mt.attributes,"terrainEnabled",nt.terrainEnabled?"true":"false"),Et(Mt.attributes,"fogEnabled",nt.fogEnabled?"true":"false"),Et(Mt.attributes,"projection",nt.projection),Et(Mt.attributes,"zoom",nt.zoom),Et(Mt.metadata,"devicePixelRatio",pt),Et(Mt.metadata,"connectionEffectiveType",vt),Et(Mt.metadata,"navigatorUserAgent",navigator.userAgent),Et(Mt.metadata,"screenWidth",window.screen.width),Et(Mt.metadata,"screenHeight",window.screen.height),Et(Mt.metadata,"windowWidth",window.innerWidth),Et(Mt.metadata,"windowHeight",window.innerHeight),Et(Mt.metadata,"mapWidth",nt.width/pt),Et(Mt.metadata,"mapHeight",nt.height/pt),Et(Mt.metadata,"webglRenderer",nt.renderer),Et(Mt.metadata,"webglVendor",nt.vendor),Et(Mt.metadata,"sdkVersion",dt),Et(Mt.metadata,"sdkIdentifier","mapbox-gl-js"),Mt}(g);for(const nt of _e.metadata);for(const nt of _e.counters);for(const nt of _e.attributes);this.postEvent(o,_e,()=>{},et)}},$s=Ls.postPerformanceEvent.bind(Ls),vo=new class extends Or{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(et,o,g,_e){if(!h.e.API_URL||!h.e.SESSION_PATH)return;const nt=Xt(h.e.API_URL+h.e.SESSION_PATH);nt.params.push(`sku=${o||""}`),nt.params.push(`access_token=${_e||h.e.ACCESS_TOKEN||""}`);const st={url:mr(nt),headers:{"Content-Type":"text/plain"}};this.pendingRequest=h.g(st,lt=>{this.pendingRequest=null,g(lt),this.saveEventData(),this.processRequests(_e)})}getSessionAPI(et,o,g,_e){this.skuToken=o,this.errorCb=_e,h.e.SESSION_PATH&&h.e.API_URL&&(g||h.e.ACCESS_TOKEN?this.queueRequest({id:et,timestamp:Date.now()},g):this.errorCb(new Error(rn)))}processRequests(et){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:g}=this.queue.shift();o&&this.success[o]||this.getSession(g,this.skuToken,_e=>{_e?this.errorCb(_e):o&&(this.success[o]=!0)},et)}remove(){this.errorCb=null}},Vs=vo.getSessionAPI.bind(vo),bo=new Set;function Po(et,o){o?bo.add(et):bo.delete(et)}class ws{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,g){this._updatedSourceCaches[o]=g,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const g=o.scope;this._updatedLayers[g]=this._updatedLayers[g]||new Set,this._updatedLayers[g].add(o.id),this.setDirty()}removeLayer(o){const g=o.scope;this._removedLayers[g]=this._removedLayers[g]||{},this._updatedLayers[g]=this._updatedLayers[g]||new Set,this._removedLayers[g][o.id]=o,this._updatedLayers[g].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const g in this._updatedLayers)o[g]=o[g]||{},o[g].updatedIds=Array.from(this._updatedLayers[g].values());for(const g in this._removedLayers)o[g]=o[g]||{},o[g].removedIds=Object.keys(this._removedLayers[g]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,g){this._updatedImages[g]=this._updatedImages[g]||new Set,this._updatedImages[g].add(h.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Jn(et){const{userImage:o}=et;return!!(o&&o.render&&o.render())&&(et.data.replace(new Uint8Array(o.data.buffer)),!0)}class Hs extends h.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&h.r()&&(this.imageRasterizerDispatcher=new h.D(h.t(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new h.q({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);const g=this.atlasTexture.get(o);g&&(g.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,g){this.imageProviders.has(g)||this.imageProviders.set(g,new Map),this.imageProviders.get(g).set(o.id,o)}removeImageProvider(o,g){this.imageProviders.has(g)&&this.imageProviders.get(g).delete(o)}getPendingImageProviders(){const o=[];for(const g of this.imageProviders.values())for(const _e of g.values())_e.hasPendingRequests()&&o.push(_e);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new h.x),this._imageRasterizer}isLoaded(){for(const o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,g){if(this.loaded.get(g)!==o&&(this.loaded.set(g,o),o)){for(const{ids:_e,callback:nt}of this.requestors)this._notify(_e,g,nt);this.requestors=[]}}hasImage(o,g){return!!this.getImage(o,g)}getImage(o,g){return this.images.get(g).get(o.toString())}addImage(o,g,_e){this._validate(o,_e)&&this.images.get(g).set(o.toString(),_e)}_validate(o,g){let _e=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new h.y(new Error(`Image "${o.name}" has invalid "stretchX" value`))),_e=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new h.y(new Error(`Image "${o.name}" has invalid "stretchY" value`))),_e=!1),this._validateContent(g.content,g)||(this.fire(new h.y(new Error(`Image "${o.name}" has invalid "content" value`))),_e=!1),_e}_validateStretch(o,g){if(!o)return!0;let _e=0;for(const nt of o){if(nt[0]<_e||nt[1]<nt[0]||g<nt[1])return!1;_e=nt[1]}return!0}_validateContent(o,g){return o?o.length!==4||!g.usvg&&(o[0]<0||g.data.width<o[0]||o[1]<0||g.data.height<o[1]||o[2]<0||g.data.width<o[2]||o[3]<0||g.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,g,_e){const nt=this.images.get(g).get(o.toString());_e.version=nt.version+1,this.images.get(g).set(o.toString(),_e),this.updatedImages.get(g).add(o),this.removeFromImageRasterizerCache(o,g)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,g){this.spriteFormat!=="raster"&&(h.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:g}):this.imageRasterizer.removeImagesFromCacheByIds([o],g))}removeImage(o,g){const _e=this.images.get(g),nt=_e.get(o.toString());_e.delete(o.toString()),this.patterns.get(g).delete(o.toString()),this.removeFromImageRasterizerCache(o,g),nt.userImage&&nt.userImage.onRemove&&nt.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(g=>h.I.from(g))}getImages(o,g,_e){const nt=[],st=[],lt=this.imageProviders.get(g);for(const vt of o){if(!vt.iconsetId){nt.push(vt);continue}const Mt=lt.get(vt.iconsetId);Mt&&(this.getImage(vt,g)?st.push(vt):Mt.addPendingRequest(vt))}if(nt.length===0)return void this._notify(st,g,_e);let ut=!0;const pt=!!this.loaded.get(g),yt=this.images.get(g);if(!pt)for(const vt of nt)yt.has(vt.toString())||(ut=!1);pt||ut?this._notify(nt,g,_e):this.requestors.push({ids:nt,scope:g,callback:_e})}rasterizeImages(o,g){const _e=new Map,{tasks:nt,scope:st}=o;for(const[lt,ut]of nt.entries()){const pt=this.getImage(ut.id,st);pt&&_e.set(lt,{image:pt,imageVariant:ut})}this._rasterizeImages(st,_e,g)}_rasterizeImages(o,g,_e){if(h.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:g,scope:o},_e);else{const nt=new Map;for(const[st,{image:lt,imageVariant:ut}]of g.entries())nt.set(st,this.imageRasterizer.rasterize(ut,lt,o,0));_e(void 0,nt)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,g,_e){const nt=this.images.get(g),st=new Map;for(const lt of o){if(!nt.get(lt.toString())){if(lt.iconsetId)continue;this.fire(new h.z("styleimagemissing",{id:lt.name}))}const ut=nt.get(lt.toString());if(!ut){h.w(`Image "${lt.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const pt={data:ut.usvg?null:ut.data.clone(),pixelRatio:ut.pixelRatio,sdf:ut.sdf,usvg:ut.usvg,version:ut.version,stretchX:ut.stretchX,stretchY:ut.stretchY,content:ut.content,hasRenderCallback:!!(ut.userImage&&ut.userImage.render)};ut.usvg&&Object.assign(pt,{width:ut.icon.usvg_tree.width,height:ut.icon.usvg_tree.height}),st.set(h.I.toString(lt),pt)}_e(null,st)}getPixelSize(o){const{width:g,height:_e}=this.atlasImage.get(o);return{width:g,height:_e}}getPattern(o,g,_e){const nt=o.toString(),st=this.patterns.get(g),lt=st.get(nt),ut=this.getImage(o,g);if(!ut)return null;if(lt){if(lt.position.version===ut.version)return lt.position;lt.position.version=ut.version}else{if(ut.usvg&&!ut.data){const pt=this.getPatternInFlightId(nt,g);if(this.patternsInFlight.has(pt))return null;this.patternsInFlight.add(pt);const yt=new h.A(o).scaleSelf(h.o.devicePixelRatio),vt=new Map([[yt.toString(),{image:ut,imageVariant:yt}]]);return this._rasterizeImages(g,vt,(Mt,Et)=>this.storePatternImage(yt,g,ut,_e,Et)),null}this.storePattern(o,g,ut)}return this._updatePatternAtlas(g,_e),st.get(nt).position}getPatternInFlightId(o,g){return h.B(o,g)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,g,_e,nt,st){const lt=o.toString(),ut=st?st.get(lt):void 0;ut&&(_e.data=ut,this.storePattern(o.id,g,_e),this._updatePatternAtlas(g,nt),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),g)))}storePattern(o,g,_e){const nt={w:_e.data.width+2*h.C,h:_e.data.height+2*h.C,x:0,y:0},st=new h.F(nt,_e,h.C);this.patterns.get(g).set(o.toString(),{bin:nt,position:st})}destroyAtlasTextures(){for(const o of this.atlasTexture.values())o&&o.destroy();this.atlasTexture.clear()}bind(o,g){const _e=o.gl;let nt=this.atlasTexture.get(g);nt?this.dirty&&(nt.update(this.atlasImage.get(g)),this.dirty=!1):(nt=new h.T(o,this.atlasImage.get(g),_e.RGBA8),this.atlasTexture.set(g,nt)),nt.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}_updatePatternAtlas(o,g){const _e=this.patterns.get(o),nt=Array.from(_e.values()).map(({bin:yt})=>yt),{w:st,h:lt}=h.G(nt),ut=this.atlasImage.get(o);ut.resize({width:st||1,height:lt||1});const pt=this.images.get(o);for(const[yt,{bin:vt,position:Mt}]of _e.entries()){let Et=Mt.padding;const Lt=vt.x+Et,Ft=vt.y+Et,Ot=pt.get(yt).data,qt=Ot.width,$t=Ot.height;Et=Et>1?Et-1:Et,h.q.copy(Ot,ut,{x:0,y:0},{x:Lt,y:Ft},{width:qt,height:$t},g),h.q.copy(Ot,ut,{x:0,y:$t-Et},{x:Lt,y:Ft-Et},{width:qt,height:Et},g),h.q.copy(Ot,ut,{x:0,y:0},{x:Lt,y:Ft+$t},{width:qt,height:Et},g),h.q.copy(Ot,ut,{x:qt-Et,y:0},{x:Lt-Et,y:Ft},{width:Et,height:$t},g),h.q.copy(Ot,ut,{x:0,y:0},{x:Lt+qt,y:Ft},{width:Et,height:$t},g),h.q.copy(Ot,ut,{x:qt-Et,y:$t-Et},{x:Lt-Et,y:Ft-Et},{width:Et,height:Et},g),h.q.copy(Ot,ut,{x:0,y:$t-Et},{x:Lt+qt,y:Ft-Et},{width:Et,height:Et},g),h.q.copy(Ot,ut,{x:0,y:0},{x:Lt+qt,y:Ft+$t},{width:Et,height:Et},g),h.q.copy(Ot,ut,{x:qt-Et,y:0},{x:Lt-Et,y:Ft+$t},{width:Et,height:Et},g)}this.dirty=!0}beginFrame(){for(const o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,g){const _e=this.images.get(g);for(const nt of o){if(this.callbackDispatchedThisFrame.get(g).has(nt.toString()))continue;this.callbackDispatchedThisFrame.get(g).add(nt.toString());const st=_e.get(nt.toString());Jn(st)&&this.updateImage(nt,g,st)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function El(et){const o=et.value,g=et.valueSpec,_e=et.style,nt=et.styleSpec,st=et.key,lt=et.arrayElementValidator||So;if(!Array.isArray(o))return[new h.V(st,o,`array expected, ${h.K(o)} found`)];if(g.length&&o.length!==g.length)return[new h.V(st,o,`array length ${g.length} expected, length ${o.length} found`)];if(g["min-length"]&&o.length<g["min-length"])return[new h.V(st,o,`array length at least ${g["min-length"]} expected, length ${o.length} found`)];let ut={type:g.value,values:g.values,minimum:g.minimum,maximum:g.maximum,function:void 0};nt.$version<7&&(ut.function=g.function),h.H(g.value)&&(ut=g.value);let pt=[];for(let yt=0;yt<o.length;yt++)pt=pt.concat(lt({array:o,arrayIndex:yt,value:o[yt],valueSpec:ut,style:_e,styleSpec:nt,key:`${st}[${yt}]`},!0));return pt}function Xo(et){const o=et.key,g=et.value,_e=et.valueSpec;if(!h.L(g))return[new h.V(o,g,`number expected, ${h.K(g)} found`)];if(g!=g)return[new h.V(o,g,"number expected, NaN found")];if("minimum"in _e){let nt=_e.minimum;if(Array.isArray(_e.minimum)&&(nt=_e.minimum[et.arrayIndex]),g<nt)return[new h.V(o,g,`${g} is less than the minimum value ${nt}`)]}if("maximum"in _e){let nt=_e.maximum;if(Array.isArray(_e.maximum)&&(nt=_e.maximum[et.arrayIndex]),g>nt)return[new h.V(o,g,`${g} is greater than the maximum value ${nt}`)]}return[]}function _l(et){const o=et.key,g=et.value;if(!h.H(g))return[new h.V(o,g,`object expected, ${h.K(g)} found`)];const _e=et.valueSpec,nt=h.J(g.type);let st,lt,ut,pt={};const yt=nt!=="categorical"&&g.property===void 0,vt=!yt,Mt=function(Ot){const qt=Ot.stops;return Array.isArray(qt)&&Array.isArray(qt[0])&&h.H(qt[0][0])}(g),Et=Qo({key:et.key,value:et.value,valueSpec:et.styleSpec.function,style:et.style,styleSpec:et.styleSpec,objectElementValidators:{stops:function(Ot){if(nt==="identity")return[new h.V(Ot.key,Ot.value,'identity function may not have a "stops" property')];let qt=[];const $t=Ot.value;return qt=qt.concat(El({key:Ot.key,value:$t,valueSpec:Ot.valueSpec,style:Ot.style,styleSpec:Ot.styleSpec,arrayElementValidator:Lt})),Array.isArray($t)&&$t.length===0&&qt.push(new h.V(Ot.key,$t,"array must have at least one stop")),qt},default:function(Ot){return So({key:Ot.key,value:Ot.value,valueSpec:_e,style:Ot.style,styleSpec:Ot.styleSpec})}}});return nt==="identity"&&yt&&Et.push(new h.V(et.key,et.value,'missing required property "property"')),nt==="identity"||g.stops||Et.push(new h.V(et.key,et.value,'missing required property "stops"')),nt==="exponential"&&_e.expression&&!h.M(_e)&&Et.push(new h.V(et.key,et.value,"exponential functions not supported")),et.styleSpec.$version>=8&&(vt&&!h.N(_e)?Et.push(new h.V(et.key,et.value,"property functions not supported")):yt&&!h.O(_e)&&Et.push(new h.V(et.key,et.value,"zoom functions not supported"))),nt!=="categorical"&&!Mt||g.property!==void 0||Et.push(new h.V(et.key,et.value,'"property" property is required')),Et;function Lt(Ot){let qt=[];const $t=Ot.value,Yt=Ot.key;if(!Array.isArray($t))return[new h.V(Yt,$t,`array expected, ${h.K($t)} found`)];if($t.length!==2)return[new h.V(Yt,$t,`array length 2 expected, length ${$t.length} found`)];if(Mt){if(!h.H($t[0]))return[new h.V(Yt,$t,`object expected, ${h.K($t[0])} found`)];const tr=$t[0];if(tr.zoom===void 0)return[new h.V(Yt,$t,"object stop key must have zoom")];if(tr.value===void 0)return[new h.V(Yt,$t,"object stop key must have value")];const sr=h.J(tr.zoom);if(typeof sr!="number")return[new h.V(Yt,tr.zoom,"stop zoom values must be numbers")];if(ut&&ut>sr)return[new h.V(Yt,tr.zoom,"stop zoom values must appear in ascending order")];sr!==ut&&(ut=sr,lt=void 0,pt={}),qt=qt.concat(Qo({key:`${Yt}[0]`,value:$t[0],valueSpec:{zoom:{}},style:Ot.style,styleSpec:Ot.styleSpec,objectElementValidators:{zoom:Xo,value:Ft}}))}else qt=qt.concat(Ft({key:`${Yt}[0]`,value:$t[0],style:Ot.style,styleSpec:Ot.styleSpec},$t));return h.Q(h.S($t[1]))?qt.concat([new h.V(`${Yt}[1]`,$t[1],"expressions are not allowed in function stops.")]):qt.concat(So({key:`${Yt}[1]`,value:$t[1],valueSpec:_e,style:Ot.style,styleSpec:Ot.styleSpec}))}function Ft(Ot,qt){const $t=h.K(Ot.value),Yt=h.J(Ot.value),tr=Ot.value!==null?Ot.value:qt;if(st){if($t!==st)return[new h.V(Ot.key,tr,`${$t} stop domain type must match previous stop domain type ${st}`)]}else st=$t;if($t!=="number"&&$t!=="string"&&$t!=="boolean"&&typeof Yt!="number"&&typeof Yt!="string"&&typeof Yt!="boolean")return[new h.V(Ot.key,tr,"stop domain value must be a number, string, or boolean")];if($t!=="number"&&nt!=="categorical"){let sr=`number expected, ${$t} found`;return h.N(_e)&&nt===void 0&&(sr+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new h.V(Ot.key,tr,sr)]}return nt!=="categorical"||$t!=="number"||typeof Yt=="number"&&isFinite(Yt)&&Math.floor(Yt)===Yt?nt!=="categorical"&&$t==="number"&&typeof Yt=="number"&&typeof lt=="number"&&lt!==void 0&&Yt<lt?[new h.V(Ot.key,tr,"stop domain values must appear in ascending order")]:(lt=Yt,nt==="categorical"&&Yt in pt?[new h.V(Ot.key,tr,"stop domain values must be unique")]:(pt[Yt]=!0,[])):[new h.V(Ot.key,tr,`integer expected, found ${String(Yt)}`)]}}function Io(et){const o=(et.expressionContext==="property"?h.W:h.U)(h.S(et.value),et.valueSpec);if(o.result==="error")return o.value.map(_e=>new h.V(`${et.key}${_e.key}`,et.value,_e.message));const g=o.value.expression||o.value._styleExpression.expression;if(et.expressionContext==="property"&&et.propertyKey==="text-font"&&!g.outputDefined())return[new h.V(et.key,et.value,`Invalid data expression for "${et.propertyKey}". Output values must be contained as literals within the expression.`)];if(et.expressionContext==="property"&&et.propertyType==="layout"&&!h.Z(g))return[new h.V(et.key,et.value,'"feature-state" data expressions are not supported with layout properties.')];if(et.expressionContext==="filter")return Pl(g,et);if(et.expressionContext==="appearance")return Uo(g,et);if(et.expressionContext&&et.expressionContext.indexOf("cluster")===0){if(!h.X(g,["zoom","feature-state"]))return[new h.V(et.key,et.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(et.expressionContext==="cluster-initial"&&!h.Y(g))return[new h.V(et.key,et.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Pl(et,o){const g=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const nt of o.valueSpec.expression.parameters)g.delete(nt);if(g.size===0)return[];const _e=[];return et instanceof h._&&g.has(et.name)?[new h.V(o.key,o.value,`["${et.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(et.eachChild(nt=>{_e.push(...Pl(nt,o))}),_e)}function Uo(et,o){const g=new Set;if(o.valueSpec&&o.valueSpec.expression)for(const nt of o.valueSpec.expression.parameters)g.add(nt);if(g.size===0)return[];const _e=[];return et instanceof h._&&!g.has(et.name)?[new h.V(o.key,o.value,`["${et.name}"] is not an allowed parameter`)]:(et.eachChild(nt=>{_e.push(...Uo(nt,o))}),_e)}function Fl(et){const o=et.key,g=et.value,_e=et.valueSpec,nt=[];return Array.isArray(_e.values)?_e.values.indexOf(h.J(g))===-1&&nt.push(new h.V(o,g,`expected one of [${_e.values.join(", ")}], ${JSON.stringify(g)} found`)):Object.keys(_e.values).indexOf(h.J(g))===-1&&nt.push(new h.V(o,g,`expected one of [${Object.keys(_e.values).join(", ")}], ${JSON.stringify(g)} found`)),nt}function Vl(et){return h.a2(h.S(et.value))?Io(Object.assign({},et,{expressionContext:"filter",valueSpec:et.styleSpec[`filter_${et.layerType||"fill"}`]})):_a(et)}function _a(et){const o=et.value,g=et.key;if(!Array.isArray(o))return[new h.V(g,o,`array expected, ${h.K(o)} found`)];if(o.length<1)return[new h.V(g,o,"filter array must have at least 1 element")];const _e=et.styleSpec;let nt=Fl({key:`${g}[0]`,value:o[0],valueSpec:_e.filter_operator});switch(h.J(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&h.J(o[1])==="$type"&&nt.push(new h.V(g,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&nt.push(new h.V(g,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(h.a0(o[1])||nt.push(new h.V(`${g}[1]`,o[1],`string expected, ${h.K(o[1])} found`)));for(let st=2;st<o.length;st++)h.J(o[1])==="$type"?nt=nt.concat(Fl({key:`${g}[${st}]`,value:o[st],valueSpec:_e.geometry_type})):h.a0(o[st])||h.L(o[st])||h.$(o[st])||nt.push(new h.V(`${g}[${st}]`,o[st],`string, number, or boolean expected, ${h.K(o[st])} found.`));break;case"any":case"all":case"none":for(let st=1;st<o.length;st++)nt=nt.concat(_a({key:`${g}[${st}]`,value:o[st],style:et.style,styleSpec:et.styleSpec}));break;case"has":case"!has":o.length!==2?nt.push(new h.V(g,o,`filter array for "${o[0]}" operator must have 2 elements`)):h.a0(o[1])||nt.push(new h.V(`${g}[1]`,o[1],`string expected, ${h.K(o[1])} found`))}return nt}function Xl(et,o){const g=et.key,_e=et.style,nt=et.layer,st=et.styleSpec,lt=et.value,ut=et.objectKey,pt=st[`${o}_${et.layerType}`];if(!pt)return[];const yt=ut.match(/^(.*)-use-theme$/);if(yt&&pt[yt[1]])return h.Q(lt)?[].concat(So({key:et.key,value:lt,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:_e,styleSpec:st,expressionContext:"property",propertyType:o,propertyKey:ut})):So({key:g,value:lt,valueSpec:{type:"string"},style:_e,styleSpec:st});const vt=ut.match(/^(.*)-transition$/);if(o==="paint"&&vt&&pt[vt[1]]&&pt[vt[1]].transition)return So({key:g,value:lt,valueSpec:st.transition,style:_e,styleSpec:st});const Mt=et.valueSpec||pt[ut];if(!Mt)return[new h.a3(g,lt,`unknown property "${ut}"`)];let Et;if(h.a0(lt)&&h.N(Mt)&&!Mt.tokens&&(Et=/^{([^}]+)}$/.exec(lt))){const Ft=`\`{ "type": "identity", "property": ${Et?JSON.stringify(Et[1]):'"_"'} }\``;return[new h.V(g,lt,`"${ut}" does not support interpolation syntax
Use an identity property function instead: ${Ft}.`)]}const Lt=[];if(et.layerType==="symbol")ut!=="text-field"||!_e||_e.glyphs||_e.imports||Lt.push(new h.V(g,lt,'use of "text-field" requires a style "glyphs" property')),ut==="text-font"&&h.a4(h.S(lt))&&h.J(lt.type)==="identity"&&Lt.push(new h.V(g,lt,'"text-font" does not support identity functions'));else if(et.layerType==="model"&&o==="paint"&&nt&&nt.layout&&nt.layout.hasOwnProperty("model-id")&&h.N(Mt)&&(h.a5(Mt)||h.O(Mt))){const Ft=h.W(h.S(lt),Mt),Ot=Ft.value.expression||Ft.value._styleExpression.expression;Ot&&!h.X(Ot,["measure-light"])&&(ut==="model-emissive-strength"&&h.Y(Ot)&&h.Z(Ot)||Lt.push(new h.V(g,lt,`${ut} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Lt.concat(So({key:et.key,value:lt,valueSpec:Mt,style:_e,styleSpec:st,expressionContext:"property",propertyType:o,propertyKey:ut}))}function Go(et){return Xl(et,"paint")}function xl(et){return Xl(et,"layout")}function $u(et){let o=[];const g=et.value,_e=et.key,nt=et.style,st=et.styleSpec;if(!h.H(g))return[new h.V(_e,g,"object expected")];g.type||g.ref||o.push(new h.V(_e,g,'either "type" or "ref" is required'));let lt=h.J(g.type);const ut=h.J(g.ref);if(g.id){const pt=h.J(g.id);for(let yt=0;yt<et.arrayIndex;yt++){const vt=nt.layers[yt];h.J(vt.id)===pt&&o.push(new h.V(_e,g.id,`duplicate layer id "${pt}", previously used at line ${vt.id.__line__}`))}}if("ref"in g){let pt;["type","source","source-layer","filter","layout"].forEach(yt=>{yt in g&&o.push(new h.V(_e,g[yt],`"${yt}" is prohibited for ref layers`))}),nt.layers.forEach(yt=>{h.J(yt.id)===ut&&(pt=yt)}),pt?pt.ref?o.push(new h.V(_e,g.ref,"ref cannot reference another ref layer")):lt=h.J(pt.type):typeof ut=="string"&&o.push(new h.V(_e,g.ref,`ref layer "${ut}" not found`))}else if(lt!=="background"&&lt!=="sky"&&lt!=="slot")if(g.source)if(h.a0(g.source)){const pt=nt.sources&&nt.sources[g.source],yt=pt&&h.J(pt.type);pt?yt==="vector"&&lt==="raster"?o.push(new h.V(_e,g.source,`layer "${g.id}" requires a raster source`)):yt==="raster"&&lt!=="raster"?o.push(new h.V(_e,g.source,`layer "${g.id}" requires a vector source`)):yt!=="vector"||g["source-layer"]?yt==="raster-dem"&&lt!=="hillshade"?o.push(new h.V(_e,g.source,"raster-dem source can only be used with layer type 'hillshade'.")):yt!=="raster-array"||["raster","raster-particle"].includes(lt)?lt==="line"&&g.paint&&(g.paint["line-gradient"]||g.paint["line-trim-offset"])&&yt==="geojson"&&!pt.lineMetrics?o.push(new h.V(_e,g,`layer "${g.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):lt==="raster-particle"&&yt!=="raster-array"&&o.push(new h.V(_e,g.source,`layer "${g.id}" requires a 'raster-array' source.`)):o.push(new h.V(_e,g.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new h.V(_e,g,`layer "${g.id}" must specify a "source-layer"`)):o.push(new h.V(_e,g.source,`source "${g.source}" not found`))}else o.push(new h.V(`${_e}.source`,g.source,'"source" must be a string'));else o.push(new h.V(_e,g,'missing required property "source"'));return o=o.concat(Qo({key:_e,value:g,valueSpec:st.layer,style:et.style,styleSpec:et.styleSpec,objectElementValidators:{"*":()=>[],type:()=>So({key:`${_e}.type`,value:g.type,valueSpec:st.layer.type,style:et.style,styleSpec:et.styleSpec,object:g,objectKey:"type"}),filter:pt=>Vl(Object.assign({layerType:lt},pt)),layout:pt=>Qo({layer:g,key:pt.key,value:pt.value,valueSpec:{},style:pt.style,styleSpec:pt.styleSpec,objectElementValidators:{"*":yt=>xl(Object.assign({layerType:lt},yt))}}),paint:pt=>Qo({layer:g,key:pt.key,value:pt.value,valueSpec:{},style:pt.style,styleSpec:pt.styleSpec,objectElementValidators:{"*":yt=>Go(Object.assign({layerType:lt,layer:g},yt))}}),appearances(pt){const yt=El({key:pt.key,value:pt.value,valueSpec:pt.valueSpec,style:pt.style,styleSpec:pt.styleSpec,arrayElementValidator:Et=>function(Lt){const{key:Ft,layer:Ot,layerType:qt}=Lt,$t=h.J(Lt.value),Yt=h.J($t.name),tr=h.J($t.condition),sr=Qo({key:Ft,value:$t,valueSpec:Lt.styleSpec.appearance,style:Lt.style,styleSpec:Lt.styleSpec,objectElementValidators:{condition:pr=>function(hr){const gr=[];return gr.push(...Io({key:hr.key,value:hr.object.condition,valueSpec:h.a6.appearance.condition,expressionContext:"appearance"})),gr}(Object.assign({layer:Ot,layerType:qt},pr)),properties:pr=>function(hr){const gr=[],{styleSpec:dr,layer:ur,layerType:yr}=hr,Vr=dr[`paint_${yr}`],Ir=dr[`layout_${yr}`],Qr=hr.object[hr.objectKey];for(const Nr in Qr){const Yr=Nr in Vr?"paint":Nr in Ir?"layout":void 0;if(!Yr){gr.push(new h.V(hr.key,Nr,`unknown property "${Nr}" for layer type "${yr}"`));continue}const Cn=Object.assign({},hr,{key:`${hr.key}.${Nr}`,object:Qr,objectKey:Nr,layer:ur,layerType:yr,value:Qr[Nr],valueSpec:Yr==="paint"?Vr[Nr]:Ir[Nr]});gr.push(...Xl(Cn,Yr))}return gr}(Object.assign({layer:Ot,layerType:qt},pr))}});return Yt==="hidden"||tr||sr.push(new h.V(Lt.key,"name",'Appearance with name different than "hidden" must have a condition')),sr}(Object.assign({layerType:lt,layer:g},Et))}),vt=Array.isArray(pt.value)?pt.value:[],Mt=new Set;return vt.forEach((Et,Lt)=>{const Ft=h.J(Et.name);if(Ft)if(Mt.has(Ft)){const Ot=h.J(g.id);yt.push(new h.V(pt.key,Ft,`Duplicated appearance name "${Ft}" for layer "${Ot}"`))}else Mt.add(Ft)}),yt}}})),o}function su({key:et,value:o}){return h.a0(o)?[]:[new h.V(et,o,`string expected, ${h.K(o)} found`)]}const Mu={promoteId:function et({key:o,value:g}){if(h.a0(g))return su({key:o,value:g});if(Array.isArray(g)){const nt=[],st=h.S(g),lt=h.U(st);return lt.result==="error"&&lt.value.forEach(ut=>{nt.push(new h.V(`${o}${ut.key}`,null,`${ut.message}`))}),h.X(lt.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||nt.push(new h.V(`${o}`,null,"promoteId expression should be only feature dependent")),nt}if(!h.H(g))return[new h.V(o,g,`string, expression or object expected, "${h.K(g)}" found`)];const _e=[];for(const nt in g)_e.push(...et({key:`${o}.${nt}`,value:g[nt]}));return _e}};function Ol(et){const o=et.value,g=et.key,_e=et.styleSpec,nt=et.style;if(!h.H(o))return[new h.V(g,o,`object expected, ${h.K(o)} found`)];if(!("type"in o))return[new h.V(g,o,'"type" is required')];const st=h.J(o.type);let lt=[];switch(["vector","raster","raster-dem","raster-array"].includes(st)&&("url"in o||"tiles"in o||lt.push(new h.a3(g,o,'Either "url" or "tiles" is required.'))),st){case"vector":case"raster":case"raster-dem":case"raster-array":return lt=lt.concat(Qo({key:g,value:o,valueSpec:_e[`source_${st.replace("-","_")}`],style:et.style,styleSpec:_e,objectElementValidators:Mu})),lt;case"geojson":if(lt=Qo({key:g,value:o,valueSpec:_e.source_geojson,style:nt,styleSpec:_e,objectElementValidators:Mu}),"cluster"in o&&"clusterProperties"in o){if(!h.H(o.clusterProperties))return[new h.V(`${g}.clusterProperties`,o,`object expected, ${h.K(o)} found`)];for(const ut in o.clusterProperties){const pt=o.clusterProperties[ut];if(!Array.isArray(pt))return[new h.V(`${g}.clusterProperties.${ut}`,pt,"array expected")];const[yt,vt]=pt,Mt=typeof yt=="string"?[yt,["accumulated"],["get",ut]]:yt;lt.push(...Io({key:`${g}.${ut}.map`,value:vt,expressionContext:"cluster-map"})),lt.push(...Io({key:`${g}.${ut}.reduce`,value:Mt,expressionContext:"cluster-reduce"}))}}return lt;case"video":return Qo({key:g,value:o,valueSpec:_e.source_video,style:nt,styleSpec:_e});case"image":return Qo({key:g,value:o,valueSpec:_e.source_image,style:nt,styleSpec:_e});case"canvas":return[new h.V(g,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fl({key:`${g}.type`,value:o.type,valueSpec:{values:bu(_e)}})}}function bu(et){return et.source.reduce((o,g)=>{const _e=et[g];return _e.type.type==="enum"&&(o=o.concat(Object.keys(_e.type.values))),o},[])}function _h(et){const o=et.value,g=et.styleSpec,_e=g.light,nt=et.style;if(o===void 0)return[];if(!h.H(o))return[new h.V("light",o,`object expected, ${h.K(o)} found`)];let st=[];for(const lt in o){const ut=lt.match(/^(.*)-transition$/),pt=lt.match(/^(.*)-use-theme$/);st=st.concat(pt&&_e[pt[1]]?So({key:lt,value:o[lt],valueSpec:{type:"string"},style:nt,styleSpec:g}):ut&&_e[ut[1]]&&_e[ut[1]].transition?So({key:lt,value:o[lt],valueSpec:g.transition,style:nt,styleSpec:g}):_e[lt]?So({key:lt,value:o[lt],valueSpec:_e[lt],style:nt,styleSpec:g}):[new h.V(lt,o[lt],`unknown property "${lt}"`)])}return st}function Hu(et){const o=et.value;if(!o)return[];const g=et.key;if(!h.H(o))return[new h.V(g,o,`object expected, ${h.K(o)} found`)];let _e=[];const nt=et.styleSpec,st=nt["light-3d"],lt=et.style,ut=et.style.lights;for(const vt of["type","id"])if(!(vt in o))return _e=_e.concat([new h.V(g,o,`missing property "${vt}"`)]),_e;if(!h.a0(o.type))return _e=_e.concat([new h.V(`${g}.type`,o.type,"string expected")]),_e;if(ut)for(let vt=0;vt<et.arrayIndex;vt++){const Mt=h.J(o.type),Et=ut[vt];h.J(Et.type)===Mt&&_e.push(new h.V(g,o.id,`duplicate light type "${o.type}", previously defined at line ${Et.id.__line__}`))}const pt=`properties_light_${o.type}`;if(!(pt in nt))return _e=_e.concat([new h.V(`${g}.type`,o,`Invalid light type ${o.type}`)]),_e;const yt=nt[pt];for(const vt in o)if(vt==="properties"){const Mt=o[vt];if(!h.H(Mt))return _e=_e.concat([new h.V("properties",Mt,`object expected, ${h.K(Mt)} found`)]),_e;for(const Et in Mt){const Lt=Et.match(/^(.*)-transition$/),Ft=Et.match(/^(.*)-use-theme$/);_e=_e.concat(Ft&&yt[Ft[1]]?So({key:vt,value:Mt[Et],valueSpec:{type:"string"},style:lt,styleSpec:nt}):Lt&&yt[Lt[1]]&&yt[Lt[1]].transition?So({key:vt,value:o[vt],valueSpec:nt.transition,style:lt,styleSpec:nt}):yt[Et]?So({key:Et,value:Mt[Et],valueSpec:yt[Et],style:lt,styleSpec:nt}):[new h.a3(et.key,Mt[Et],`unknown property "${Et}"`)])}}else _e=_e.concat(st[vt]?So({key:vt,value:o[vt],valueSpec:st[vt],style:lt,styleSpec:nt}):[new h.a3(vt,o[vt],`unknown property "${vt}"`)]);return _e}function ku(et){const o=et.value,g=et.key,_e=et.style,nt=et.styleSpec,st=nt.terrain;if(o==null)return[];if(!h.H(o))return[new h.V("terrain",o,`object expected, ${h.K(o)} found`)];let lt=[];for(const ut in o){const pt=ut.match(/^(.*)-transition$/),yt=ut.match(/^(.*)-use-theme$/);lt=lt.concat(yt&&st[yt[1]]?So({key:ut,value:o[ut],valueSpec:{type:"string"},style:_e,styleSpec:nt}):pt&&st[pt[1]]&&st[pt[1]].transition?So({key:ut,value:o[ut],valueSpec:nt.transition,style:_e,styleSpec:nt}):st[ut]?So({key:ut,value:o[ut],valueSpec:st[ut],style:_e,styleSpec:nt}):[new h.a3(ut,o[ut],`unknown property "${ut}"`)])}if(o.source)if(h.a0(o.source)){const ut=_e.sources&&_e.sources[o.source],pt=ut&&h.J(ut.type);ut?pt!=="raster-dem"&&lt.push(new h.V(`${g}.source`,o.source,`terrain cannot be used with a source of type ${pt}, it only be used with a "raster-dem" source type`)):lt.push(new h.V(`${g}.source`,o.source,`source "${o.source}" not found`))}else lt.push(new h.V(`${g}.source`,o.source,"source must be a string"));else lt.push(new h.V(g,o,'terrain is missing required property "source"'));return lt}function _d(et){const o=et.value,g=et.style,_e=et.styleSpec,nt=_e.fog;if(o===void 0)return[];if(!h.H(o))return[new h.V("fog",o,`object expected, ${h.K(o)} found`)];let st=[];for(const lt in o){const ut=lt.match(/^(.*)-transition$/),pt=lt.match(/^(.*)-use-theme$/);st=st.concat(pt&&nt[pt[1]]?So({key:lt,value:o[lt],valueSpec:{type:"string"},style:g,styleSpec:_e}):ut&&nt[ut[1]]&&nt[ut[1]].transition?So({key:lt,value:o[lt],valueSpec:_e.transition,style:g,styleSpec:_e}):nt[lt]?So({key:lt,value:o[lt],valueSpec:nt[lt],style:g,styleSpec:_e}):[new h.a3(lt,o[lt],`unknown property "${lt}"`)])}return st}const dp={"*":()=>[],array:El,boolean:function(et){const o=et.value,g=et.key;return h.$(o)?[]:[new h.V(g,o,`boolean expected, ${h.K(o)} found`)]},number:Xo,color:function({key:et,value:o}){return h.a0(o)?h.a1.parseCSSColor(o)===null?[new h.V(et,o,`color expected, "${o}" found`)]:[]:[new h.V(et,o,`color expected, ${h.K(o)} found`)]},enum:Fl,filter:Vl,function:_l,layer:$u,object:Qo,source:Ol,model:h.a7,light:_h,"light-3d":Hu,terrain:ku,fog:_d,string:su,formatted:function(et){return su(et).length===0?[]:Io(et)},resolvedImage:function(et){return su(et).length===0?[]:Io(et)},projection:function(et){const o=et.value,g=et.styleSpec,_e=g.projection,nt=et.style;if(h.H(o)){let st=[];for(const lt in o)st=st.concat(So({key:lt,value:o[lt],valueSpec:_e[lt],style:nt,styleSpec:g}));return st}return h.a0(o)?[]:[new h.V("projection",o,`object or string expected, ${h.K(o)} found`)]},import:function(et){const o=et.key,{value:g,styleSpec:_e}=et;if(!h.H(g))return[new h.V(o,g,"import must be an object")];const{data:nt,...st}=g;Object.defineProperty(st,"__line__",{value:g.__line__,enumerable:!1});let lt=Qo(Object.assign({},et,{value:st,valueSpec:_e.import}));return h.J(st.id)===""&&lt.push(new h.V(`${et.key}.id`,st,"import id can't be an empty string")),nt&&(lt=lt.concat(pp(nt,_e,{key:`${et.key}.data`}))),lt},iconset:function(et){const o=et.value,g=et.key,_e=et.styleSpec,nt=et.style;if(!h.H(o))return[new h.V(g,o,"object expected")];if(!o.type)return[new h.V(g,o,'"type" is required')];const st=h.J(o.type);let lt=[];if(lt=lt.concat(Qo({key:g,value:o,valueSpec:_e[`iconset_${st}`],style:nt,styleSpec:_e})),function(ut,pt){return!(ut!=="source"||!pt.source)}(st,o)){const ut=nt.sources&&nt.sources[o.source],pt=ut&&h.J(ut.type);ut?pt!=="raster-array"&&lt.push(new h.V(g,o.source,`iconset cannot be used with a source of type ${String(pt)}, it only be used with a "raster-array" source type`)):lt.push(new h.V(g,o.source,`source "${o.source}" not found`))}return lt}};function So(et,o=!1){const g=et.value,_e=et.valueSpec,nt=et.styleSpec;if(_e.expression){if(h.a4(h.J(g)))return _l(et);if(h.Q(h.S(g)))return Io(et)}if(_e.type&&dp[_e.type]){const st=dp[_e.type](et);return o===!0&&st.length>0&&Array.isArray(et.value)?Io(et):st}return Qo(Object.assign({},et,{valueSpec:_e.type?nt[_e.type]:_e}))}function Qo(et){const o=et.key,g=et.value,_e=et.valueSpec||{},nt=et.objectElementValidators||{},st=et.style,lt=et.styleSpec;if(!h.H(g))return[new h.V(o,g,`object expected, ${h.K(g)} found`)];let ut=[];for(const pt in g){const yt=pt.split(".")[0];let vt;nt[yt]?vt=nt[yt]:_e[yt]?vt=So:nt["*"]?vt=nt["*"]:_e["*"]&&(vt=So),vt?ut=ut.concat(vt({key:(o&&`${o}.`)+pt,value:g[pt],valueSpec:_e[yt]||_e["*"],style:st,styleSpec:lt,object:g,objectKey:pt},g)):ut.push(new h.a3(o,g[pt],`unknown property "${pt}"`))}for(const pt in _e)nt[pt]||_e[pt].required&&_e[pt].default===void 0&&g[pt]===void 0&&ut.push(new h.V(o,g,`missing required property "${pt}"`));return ut}function ep({key:et,value:o}){const g=su({key:et,value:o});if(g.length)return g;const _e=o;return _e.indexOf("{fontstack}")===-1&&g.push(new h.V(et,o,'"glyphs" url must include a "{fontstack}" token')),_e.indexOf("{range}")===-1&&g.push(new h.V(et,o,'"glyphs" url must include a "{range}" token')),g}function pp(et,o=h.a6,g={}){return Qo({key:g.key||"",value:et,valueSpec:Object.assign(o.$root,{"*":{type:"*"}}),styleSpec:o,style:et,objectElementValidators:{glyphs:ep}})}function wu(et,o=h.a6){return vr(pp(et,o))}const Ap=et=>vr(Ol(et)),Wp=et=>vr(_h(et)),Wu=et=>vr(Hu(et)),yn=et=>vr(ku(et)),qu=et=>vr(_d(et)),qp=et=>vr(function(o){const g=o.value,_e=o.style,nt=o.styleSpec,st=nt.snow;if(g===void 0)return[];if(!h.H(g))return[new h.V("snow",g,`object expected, ${h.K(g)} found`)];let lt=[];for(const ut in g){const pt=ut.match(/^(.*)-transition$/);lt=lt.concat(pt&&st[pt[1]]&&st[pt[1]].transition?So({key:ut,value:g[ut],valueSpec:nt.transition,style:_e,styleSpec:nt}):st[ut]?So({key:ut,value:g[ut],valueSpec:st[ut],style:_e,styleSpec:nt}):[new h.a3(ut,g[ut],`unknown property "${ut}"`)])}return lt}(et)),tp=et=>vr(function(o){const g=o.value,_e=o.style,nt=o.styleSpec,st=nt.rain;if(g===void 0)return[];if(!h.H(g))return[new h.V("rain",g,`object expected, ${h.K(g)} found`)];let lt=[];for(const ut in g){const pt=ut.match(/^(.*)-transition$/);lt=lt.concat(pt&&st[pt[1]]&&st[pt[1]].transition?So({key:ut,value:g[ut],valueSpec:nt.transition,style:_e,styleSpec:nt}):st[ut]?So({key:ut,value:g[ut],valueSpec:st[ut],style:_e,styleSpec:nt}):[new h.a3(ut,g[ut],`unknown property "${ut}"`)])}return lt}(et)),Lr=et=>vr($u(et)),Wt=et=>vr(Vl(et)),Qt=et=>vr(Go(et)),lr=et=>vr(xl(et)),wr=et=>vr(h.a7(et));function vr(et){return et.slice().sort((o,g)=>o.line&&g.line?o.line-g.line:0)}function fr(et,o){let g=!1;if(o&&o.length)for(const _e of o)_e instanceof h.a3?h.w(_e.message):(et.fire(new h.y(new Error(_e.message))),g=!0);return g}let Ur;class Rr extends h.E{constructor(o,g="flat"){super(),this._transitionable=new h.a8(Ur||(Ur=new h.a9({anchor:new h.aa(h.a6.light.anchor),position:new h.ab(h.a6.light.position),color:new h.aa(h.a6.light.color),intensity:new h.aa(h.a6.light.intensity)}))),this.setLight(o,g),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,g,_e={}){this._validate(Wp,o,_e)||(this._transitionable.setTransitionOrValue(o),this.id=g)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,g,_e){return(!_e||_e.validate!==!1)&&fr(this,o.call(wu,Object.assign({value:g,style:{glyphs:!0,sprite:!0},styleSpec:h.a6})))}}let Xr=class extends h.E{constructor(et,o,g,_e,nt){super(),this.scope=g,this._transitionable=new h.a8(new h.a9({source:new h.aa(h.a6.terrain.source),exaggeration:new h.aa(h.a6.terrain.exaggeration)}),g,_e),this._transitionable.setTransitionOrValue(et,_e),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o,this.worldview=nt}get(){return this._transitionable.serialize()}set(et,o){this._transitionable.setTransitionOrValue(et,o)}updateTransitions(et){this._transitioning=this._transitionable.transitioned(et,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(et){this.properties=this._transitioning.possiblyEvaluate(et)}getExaggeration(et){return this._transitioning.possiblyEvaluate(new h.ac(et,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const et=this._transitionable._values.exaggeration;if(!et)return null;const o=et.value.expression;if(!o)return null;let g=-1,_e=-1,nt=1;for(const st of o.zoomStops)nt=o.evaluate(new h.ac(st,{worldview:this.worldview})),nt>.01?(g=st,_e=-1):_e=st;return nt<.01&&g>0&&_e>g?[g,_e]:null}isZoomDependent(){const et=this._transitionable._values.exaggeration;return et!=null&&et.value!=null&&et.value.expression!=null&&et.value.expression instanceof h.ad}};const Sn=45,ln=65,Hn=.05;function rs(et,o,g,_e){const nt=h.ah(Sn,ln,g),[st,lt]=ds(et,_e);let ut=1-Math.min(1,Math.exp((o-st)/(lt-st)*-6));return ut*=ut*ut,ut=Math.min(1,1.00747*ut),ut*nt*et.alpha}function ds(et,o){const g=.5/Math.tan(.5*o);return[et.range[0]+g,et.range[1]+g]}function js(et,o,g,_e,nt){const st=h.af([],[o,g,_e],nt.mercatorFogMatrix);return rs(et,h.ag(st),nt.pitch,nt._fov)}function Rs(et,o,g,_e,nt,st,lt){const ut=[[g,_e,0],[nt,_e,0],[nt,st,0],[g,st,0]];let pt=Number.MAX_VALUE,yt=-Number.MAX_VALUE;for(const vt of ut){const Mt=h.af([],vt,o),Et=h.ag(Mt);pt=Math.min(pt,Et),yt=Math.max(yt,Et)}return[rs(et,pt,lt.pitch,lt._fov),rs(et,yt,lt.pitch,lt._fov)]}class Fs extends h.E{constructor(o,g,_e,nt){super();const st=new h.a9({range:new h.aa(h.a6.fog.range),color:new h.aa(h.a6.fog.color),"color-use-theme":new h.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new h.aa(h.a6.fog["high-color"]),"high-color-use-theme":new h.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new h.aa(h.a6.fog["space-color"]),"space-color-use-theme":new h.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new h.aa(h.a6.fog["horizon-blend"]),"star-intensity":new h.aa(h.a6.fog["star-intensity"]),"vertical-range":new h.aa(h.a6.fog["vertical-range"])});this._transitionable=new h.a8(st,_e,new Map(nt)),this.set(o,nt),this._transitioning=this._transitionable.untransitioned(),this._transform=g,this.properties=new h.ai(st),this.scope=_e}get state(){const o=this._transform,g=o.projection.name==="globe",_e=h.aj(o.zoom),nt=this.properties.get("range"),st=[.5,3];return{range:g?[h.ak(st[0],nt[0],_e),h.ak(st[1],nt[1],_e)]:nt,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,g,_e={}){if(this._validate(qu,o,_e))return;const nt=Object.assign({},o);for(const st of Object.keys(h.a6.fog))nt[st]===void 0&&(nt[st]=h.a6.fog[st].default);this._options=nt,this._transitionable.setTransitionOrValue(this._options,g)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const g=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:h.ah(Sn,ln,o))*g.a}getOpacityAtLatLng(o,g){return this._transform.projection.supportsFog?function(_e,nt,st){const lt=h.ae.fromLngLat(nt),ut=st.elevation?st.elevation.getAtPointOrZero(lt):0;return js(_e,lt.x,lt.y,ut,st)}(this.state,o,g):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const g=this._transform.calculateFogTileMatrix(o.toUnwrapped());return Rs(this.state,g,0,0,h.al,h.al,this._transform)}getOpacityForBounds(o,g,_e,nt,st){return this._transform.projection.supportsFog?Rs(this.state,o,g,_e,nt,st,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?ds(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const g=[4,5,6,7];for(const _e of g){const nt=o.points[_e];let st;if(nt[2]>=0)st=nt;else{const lt=o.points[_e-4];st=h.am(lt,nt,lt[2]/(lt[2]-nt[2]))}if(js(this.state,st[0],st[1],0,this._transform)>=Hn)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,g,_e){return(!_e||_e.validate!==!1)&&fr(this,o.call(wu,Object.assign({value:g,style:{glyphs:!0,sprite:!0},styleSpec:h.a6})))}}let Gs,Es,Mo,Jo,na=class extends h.E{constructor(et,o,g,_e){super();const nt=Gs||(Gs=new h.a9({density:new h.aa(h.a6.snow.density),intensity:new h.aa(h.a6.snow.intensity),color:new h.aa(h.a6.snow.color),opacity:new h.aa(h.a6.snow.opacity),vignette:new h.aa(h.a6.snow.vignette),"vignette-color":new h.aa(h.a6.snow["vignette-color"]),"center-thinning":new h.aa(h.a6.snow["center-thinning"]),direction:new h.aa(h.a6.snow.direction),"flake-size":new h.aa(h.a6.snow["flake-size"])}));this._transitionable=new h.a8(nt,g,new Map(_e)),this.set(et,_e),this._transitioning=this._transitionable.untransitioned(),this.properties=new h.ai(nt),this.scope=g}get state(){const et=this.properties.get("opacity"),o=this.properties.get("color"),g=this.properties.get("direction"),_e=h.an(g[0]),nt=-Math.max(h.an(g[1]),.01),st=[Math.cos(_e)*Math.cos(nt),Math.sin(_e)*Math.cos(nt),Math.sin(nt)],lt=this.properties.get("vignette"),ut=this.properties.get("vignette-color");return ut.a=lt,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new h.ao(o.r,o.g,o.b,o.a*et),direction:st,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:ut}}get(){return this._transitionable.serialize()}set(et,o,g={}){if(this._validate(qp,et,g))return;const _e=Object.assign({},et);for(const nt of Object.keys(h.a6.snow))_e[nt]===void 0&&(_e[nt]=h.a6.snow[nt].default);this._options=_e,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(et){this._transitionable.setTransitionOrValue(this._options,new Map(et))}updateTransitions(et){this._transitioning=this._transitionable.transitioned(et,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(et){this.properties=this._transitioning.possiblyEvaluate(et)}_validate(et,o,g){return(!g||g.validate!==!1)&&fr(this,et.call(wu,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:h.a6})))}},ao=class extends h.E{constructor(et,o,g,_e){super();const nt=Es||(Es=new h.a9({density:new h.aa(h.a6.rain.density),intensity:new h.aa(h.a6.rain.intensity),color:new h.aa(h.a6.rain.color),opacity:new h.aa(h.a6.rain.opacity),vignette:new h.aa(h.a6.rain.vignette),"vignette-color":new h.aa(h.a6.rain["vignette-color"]),"center-thinning":new h.aa(h.a6.rain["center-thinning"]),direction:new h.aa(h.a6.rain.direction),"droplet-size":new h.aa(h.a6.rain["droplet-size"]),"distortion-strength":new h.aa(h.a6.rain["distortion-strength"])}));this._transitionable=new h.a8(nt,g,new Map(_e)),this.set(et,_e),this._transitioning=this._transitionable.untransitioned(),this.properties=new h.ai(nt),this.scope=g}get state(){const et=this.properties.get("opacity"),o=this.properties.get("color"),g=this.properties.get("direction"),_e=h.an(g[0]),nt=-Math.max(h.an(g[1]),.01),st=[Math.cos(_e)*Math.cos(nt),Math.sin(_e)*Math.cos(nt),Math.sin(nt)],lt=this.properties.get("vignette-color");return lt.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new h.ao(o.r,o.g,o.b,o.a*et),direction:st,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:lt}}get(){return this._transitionable.serialize()}set(et,o,g={}){if(this._validate(tp,et,g))return;const _e=Object.assign({},et);for(const nt of Object.keys(h.a6.rain))_e[nt]===void 0&&(_e[nt]=h.a6.rain[nt].default);this._options=_e,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(et){this._transitionable.setTransitionOrValue(this._options,new Map(et))}updateTransitions(et){this._transitioning=this._transitionable.transitioned(et,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(et){this.properties=this._transitioning.possiblyEvaluate(et)}_validate(et,o,g){return(!g||g.validate!==!1)&&fr(this,et.call(wu,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:h.a6})))}};class Ws extends h.E{constructor(o,g,_e,nt){super(),this.scope=_e,this._options=o,this.properties=new h.ai(g),this._transitionable=new h.a8(g,_e,new Map(nt)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,g){this._options=o,this._transitionable.setTransitionOrValue(o.properties,g)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ho{constructor(o,g,_e){this.screenBounds=o,this.cameraPoint=_e.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_e)}static createFromScreenPoints(o,g){let _e,nt;if(o instanceof h.P||typeof o[0]=="number"){const st=h.P.convert(o);_e=[st],nt=g.isPointAboveHorizon(st)}else{const st=h.P.convert(o[0]),lt=h.P.convert(o[1]),ut=st.add(lt)._div(2);_e=[st,lt],nt=h.aq(st,lt).every(pt=>g.isPointAboveHorizon(pt))&&g.isPointAboveHorizon(ut)}return new ho(_e,nt,g)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return h.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const g=this.screenBounds[0],_e=this.screenBounds.length===1?this.screenBounds[0].add(new h.P(1,1)):this.screenBounds[1],nt=h.aq(g,_e,0,!1);return this.cameraPoint.y>_e.y&&(this.cameraPoint.x>g.x&&this.cameraPoint.x<_e.x?nt.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_e.x?nt[2]=this.cameraPoint:this.cameraPoint.x<=g.x&&(nt[3]=this.cameraPoint)),h.ar(nt,o)}bufferedCameraGeometryGlobe(o){const g=this.screenBounds[0],_e=this.screenBounds.length===1?this.screenBounds[0].add(new h.P(1,1)):this.screenBounds[1],nt=h.aq(g,_e,o),st=this.cameraPoint.clone();switch(3*((st.y>g.y)+(st.y>_e.y))+((st.x>g.x)+(st.x>_e.x))){case 0:nt[0]=st,nt[4]=st.clone();break;case 1:nt.splice(1,0,st);break;case 2:nt[1]=st;break;case 3:nt.splice(4,0,st);break;case 5:nt.splice(2,0,st);break;case 6:nt[3]=st;break;case 7:nt.splice(3,0,st);break;case 8:nt[2]=st}return nt}containsTile(o,g,_e,nt=0){const st=o.queryPadding/g._pixelsPerMercatorPixel+1,lt=_e?this._bufferedCameraMercator(st,g):this._bufferedScreenMercator(st,g);let ut=o.tileID.wrap+(lt.unwrapped?nt:0);const pt=lt.polygon.map(qt=>h.as(o.tileTransform,qt,ut));if(!h.at(pt,0,0,h.al,h.al))return;ut=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?nt:0);const yt=this.screenGeometryMercator.polygon.map(qt=>h.au(o.tileTransform,qt,ut)),vt=yt.map(qt=>new h.P(qt[0],qt[1])),Mt=g.getFreeCameraOptions().position||new h.ae(0,0,0),Et=h.au(o.tileTransform,Mt,ut),Lt=yt.map(qt=>{const $t=h.av(qt,qt,Et);return h.aw($t,$t),new h.ax(Et,$t)}),Ft=h.ay(o,1,g.zoom)*g._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:vt,tilespaceRays:Lt,bufferedTilespaceGeometry:pt,bufferedTilespaceBounds:(Ot=h.az(pt),Ot.min.x=h.aA(Ot.min.x,0,h.al),Ot.min.y=h.aA(Ot.min.y,0,h.al),Ot.max.x=h.aA(Ot.max.x,0,h.al),Ot.max.y=h.aA(Ot.max.y,0,h.al),Ot),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:Ft};var Ot}_bufferedScreenMercator(o,g){const _e=qo(o);if(this._screenRaycastCache[_e])return this._screenRaycastCache[_e];{let nt;return nt=g.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),g):{polygon:this.bufferedScreenGeometry(o).map(st=>g.pointCoordinate3D(st)),unwrapped:!0},this._screenRaycastCache[_e]=nt,nt}}_bufferedCameraMercator(o,g){const _e=qo(o);if(this._cameraRaycastCache[_e])return this._cameraRaycastCache[_e];{let nt;return nt=g.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),g):{polygon:this.bufferedCameraGeometry(o).map(st=>g.pointCoordinate3D(st)),unwrapped:!0},this._cameraRaycastCache[_e]=nt,nt}}_projectAndResample(o,g){const _e=function(st,lt){const ut=h.aB([],lt.pixelMatrix,lt.globeMatrix),pt=[0,-h.aD,0,1],yt=[0,h.aD,0,1],vt=[0,0,0,1];h.aC(pt,pt,ut),h.aC(yt,yt,ut),h.aC(vt,vt,ut);const Mt=new h.P(pt[0]/pt[3],pt[1]/pt[3]),Et=new h.P(yt[0]/yt[3],yt[1]/yt[3]),Lt=h.aE(st,Mt)&&pt[3]<vt[3],Ft=h.aE(st,Et)&&yt[3]<vt[3];if(!Lt&&!Ft)return null;const Ot=function(gr,dr,ur){for(let yr=1;yr<gr.length;yr++){const Vr=po(dr.pointCoordinate3D(gr[yr-1]).x),Ir=po(dr.pointCoordinate3D(gr[yr]).x);if(ur<0){if(Vr<Ir)return{idx:yr,t:-Vr/(Ir-1-Vr)}}else if(Ir<Vr)return{idx:yr,t:(1-Vr)/(Ir+1-Vr)}}return null}(st,lt,Lt?-1:1);if(!Ot)return null;const{idx:qt,t:$t}=Ot;let Yt=qt>1?zo(st.slice(0,qt),lt):[],tr=qt<st.length?zo(st.slice(qt),lt):[];Yt=Yt.map(gr=>new h.P(po(gr.x),gr.y)),tr=tr.map(gr=>new h.P(po(gr.x),gr.y));const sr=[...Yt];sr.length===0&&sr.push(tr[tr.length-1]);const pr=h.ak(sr[sr.length-1].y,(tr.length===0?Yt[0]:tr[0]).y,$t);let hr;return hr=Lt?[new h.P(0,pr),new h.P(0,0),new h.P(1,0),new h.P(1,pr)]:[new h.P(1,pr),new h.P(1,1),new h.P(0,1),new h.P(0,pr)],sr.push(...hr),tr.length===0?sr.push(Yt[0]):sr.push(...tr),{polygon:sr.map(gr=>new h.ae(gr.x,gr.y)),unwrapped:!1}}(o,g);if(_e)return _e;const nt=function(st,lt){let ut=!1,pt=-1/0,yt=0;for(let Mt=0;Mt<st.length-1;Mt++)st[Mt].x>pt&&(pt=st[Mt].x,yt=Mt);for(let Mt=0;Mt<st.length-1;Mt++){const Et=(yt+Mt)%(st.length-1),Lt=st[Et],Ft=st[Et+1];Math.abs(Lt.x-Ft.x)>.5&&(Lt.x<Ft.x?(Lt.x+=1,Et===0&&(st[st.length-1].x+=1)):(Ft.x+=1,Et+1===st.length-1&&(st[0].x+=1)),ut=!0)}const vt=h.aF(lt.center.lng);return ut&&vt<Math.abs(vt-1)&&st.forEach(Mt=>{Mt.x-=1}),{polygon:st,unwrapped:ut}}(zo(o,g).map(st=>new h.P(po(st.x),st.y)),g);return{polygon:nt.polygon.map(st=>new h.ae(st.x,st.y)),unwrapped:nt.unwrapped}}}function zo(et,o){return h.aG(et,g=>{const _e=o.pointCoordinate3D(g);g.x=_e.x,g.y=_e.y},1/256)}function po(et){return et<0?1+et%1:et%1}function qo(et){return 100*et|0}function Ul(et,o,g,_e,nt){const st=function(ut,pt){if(ut)return nt(ut);if(pt){if(et.url&&pt.tiles&&et.tiles&&delete et.tiles,pt.variants){if(!Array.isArray(pt.variants))return nt(new Error("variants must be an array"));for(const vt of pt.variants){if(vt==null||typeof vt!="object"||vt.constructor!==Object)return nt(new Error("variant must be an object"));if(!Array.isArray(vt.capabilities))return nt(new Error("capabilities must be an array"));if(vt.capabilities.length===1&&vt.capabilities[0]==="meshopt"){pt=Object.assign(pt,vt);break}}}const yt=h.aH(Object.assign({},pt,et),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);yt.tiles=o.canonicalizeTileset(yt,et.url),nt(null,yt)}},lt=function(ut,pt,yt){if(!ut)return null;if(!pt&&!yt)return ut;yt=yt||ut.worldview_default;const vt=Object.values(ut.language||{});if(vt.length===0)return null;const Mt=Object.values(ut.worldview||{});if(Mt.length===0)return null;const Et=vt.every(Ft=>Ft===pt),Lt=Mt.every(Ft=>Ft===yt);return Et&&Lt?ut:pt in(ut.language_options||{})||yt in(ut.worldview_options||{})?null:ut.language_options&&ut.worldview_options?ut:null}(et.data,g,_e);return lt?h.o.frame(()=>st(null,lt)):et.url?h.m(o.transformRequest(o.normalizeSourceURL(et.url,null,g,_e),h.R.Source),st):h.o.frame(()=>{const{data:ut,...pt}=et;st(null,pt)})}function mu(et,o){const g=Math.pow(2,o.z),_e=Math.floor(h.aF(et.getWest())*g),nt=Math.floor(h.aJ(et.getNorth())*g),st=Math.ceil(h.aF(et.getEast())*g),lt=Math.ceil(h.aJ(et.getSouth())*g);return o.x>=_e&&o.x<st&&o.y>=nt&&o.y<lt}class Zu{constructor(o,g,_e){this.bounds=o?h.aI.convert(this.validateBounds(o)):null,this.minzoom=g||0,this.maxzoom=_e||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(const g of o)this.extraBounds.push(h.aI.convert(this.validateBounds(g)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!mu(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(const g of this.extraBounds)if(mu(g,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;const g=new Zu(o.bounds,o.minzoom,o.maxzoom);return g.addExtraBounds(o.extra_bounds),g}}class Gl extends h.E{constructor(o,g,_e,nt){if(super(),this.id=o,this.dispatcher=_e,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,h.aH(g,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},g),this._collectResourceTiming=!!g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(nt),this._tileWorkers={},this._deduped=new h.aK}load(o){this._loaded=!1,this.fire(new h.z("dataloading",{dataType:"source"}));const g=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_e=this.map.getWorldview();this._tileJSONRequest=Ul(this._options,this.map._requestManager,g,_e,(nt,st)=>{if(this._tileJSONRequest=null,this._loaded=!0,nt)g&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${g}`),_e&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_e}`),this.fire(new h.y(nt));else if(st){if(Object.assign(this,st),this.hasWorldviews=!!st.worldview_options,st.worldview_default&&(this.worldviewDefault=st.worldview_default),st.vector_layers){this.vectorLayers=st.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const lt of st.vector_layers)this.vectorLayerIds.push(lt.id),st.worldview&&st.worldview[lt.source]&&this.localizableLayerIds.add(lt.id)}this.tileBounds=Zu.fromTileJSON(st),pn(st.tiles,this.map._requestManager._customAccessToken),this.fire(new h.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.z("data",{dataType:"source",sourceDataType:"content"}))}o&&o(nt)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=h.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(o,g){const _e=o.tileID.canonical.url(this.tiles,this.scheme),nt=this.map._requestManager.normalizeTileURL(_e),st=this.map._requestManager.transformRequest(nt,h.R.Tile),lt=this.map.style?this.map.style.getLut(this.scope):null,ut=lt?{image:lt.image.clone()}:null,pt={request:st,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:ut,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:h.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&h.h(_e)&&(pt.localizableLayerIds=this.localizableLayerIds),pt.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=g:o.request=o.actor.send("reloadTile",pt,yt.bind(this));else if(o.actor=this._tileWorkers[nt]=this._tileWorkers[nt]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",pt,yt.bind(this),void 0,!0);else{const vt=h.aL.call({deduped:this._deduped},pt,(Mt,Et)=>{Mt||!Et?yt.call(this,Mt):(pt.data={cacheControl:Et.cacheControl,expires:Et.expires,rawData:Et.rawData.slice(0)},o.actor&&o.actor.send("loadTile",pt,yt.bind(this),void 0,!0))},!0);o.request={cancel:vt}}function yt(vt,Mt){return delete o.request,o.aborted?g(null):vt&&vt.status!==404?g(vt):(Mt&&Mt.resourceTiming&&(o.resourceTiming=Mt.resourceTiming),this.map._refreshExpiredTiles&&Mt&&o.setExpiryData(Mt),o.loadVectorData(Mt,this.map.painter),h.aM(this.dispatcher),g(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,g){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Zp extends h.E{constructor(o,g,_e,nt){super(),this.id=o,this.dispatcher=_e,this.setEventedParent(nt),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},g),Object.assign(this,h.aH(g,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new h.z("dataloading",{dataType:"source"}));const g=this.map.getWorldview();this._tileJSONRequest=Ul(this._options,this.map._requestManager,null,g,(_e,nt)=>{this._tileJSONRequest=null,this._loaded=!0,_e?this.fire(new h.y(_e)):nt&&(Object.assign(this,nt),nt.raster_layers&&(this.rasterLayers=nt.raster_layers,this.rasterLayerIds=this.rasterLayers.map(st=>st.id)),this.tileBounds=Zu.fromTileJSON(nt),pn(nt.tiles),this.fire(new h.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.z("data",{dataType:"source",sourceDataType:"content"}))),o&&o(_e)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=h.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,g){const _e=h.o.devicePixelRatio>=2,nt=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),_e,this.tileSize);o.request=h.n(this.map._requestManager.transformRequest(nt,h.R.Tile),(st,lt,ut,pt)=>(delete o.request,o.aborted?(o.state="unloaded",g(null)):st?(o.state="errored",g(st)):lt?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:ut,expires:pt}),o.setTexture(lt,this.map.painter),o.state="loaded",h.aM(this.dispatcher),void g(null)):g(null)))}abortTile(o,g){o.request&&(o.request.cancel(),delete o.request),g&&g()}unloadTile(o,g){o.texture&&o.texture instanceof h.T?(o.destroy(!0),o.texture&&o.texture instanceof h.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),g&&g()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function P_([et,o],g,_e,{scaled:nt=!0}={}){const{tileSize:st,buffer:lt}=_e,{x:ut,y:pt,z:yt}=g;if(!isFinite(ut)||!isFinite(pt)||!isFinite(yt))throw new Error("Invalid MRT header");const vt=2**yt,Mt=vt*h.aF(et),Et=vt*h.aJ(o);return function([Lt,Ft],Ot,{scaled:qt=!0}={}){if(!Ot)throw new Error("bandView is undefined");const{data:$t,tileSize:Yt,buffer:tr,offset:sr,scale:pr,dimension:hr}=Ot;if(Lt<-tr||Lt>Yt+tr||Ft<-tr||Ft>Yt+tr)throw new Error(`Point (${Lt}, ${Ft}) out of bounds for tileSize=${Yt}, buffer=${tr}`);const gr=(Ft+tr)*(Yt+2*tr)+(Lt+tr);if(new Uint32Array($t.buffer)[gr]===4294967295)return null;let dr=[];dr=qt?[]:new Ot.data.constructor(hr);for(let ur=0;ur<hr;ur++)dr[ur]=Math.round(1e12*($t[hr*gr+ur]*pr+sr))/1e12;return dr}([Math.min(Math.max(-lt,Math.floor((Mt-ut)*st)),st-1+lt),Math.min(Math.max(-lt,Math.floor((Et-pt)*st)),st-1+lt)],_e,{scaled:nt})}class ip extends Zp{constructor(o,g,_e,nt){super(o,g,_e,nt),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},g)}triggerRepaint(o){const g=this.map.painter._terrain,_e=this.map.style.getSourceCache(this.id);g&&g.enabled&&_e&&g._clearRenderCacheForTile(_e.id,o.tileID),this.map.triggerRepaint()}loadTile(o,g){const _e=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),nt=this.map._requestManager.transformRequest(_e,h.R.Tile),st={request:nt,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=nt,o.actor||(o.actor=this.dispatcher.getActor());const lt=(ut,pt,yt,vt)=>{if(delete o.request,o.aborted)return o.state="unloaded",g(null);if(ut)return ut.name==="AbortError"?void 0:(o.state="errored",g(ut));if(this.map._refreshExpiredTiles&&pt&&o.setExpiryData({cacheControl:yt,expires:vt}),this.partial&&o.state!=="expired")o.state="empty";else if(!this.partial){if(!pt)return g(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=pt}g(null)};o.request=this.partial?o.fetchHeader(void 0,lt.bind(this)):o.actor.send("loadTile",st,lt.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,g){const _e=o.texturePerLayer;if(o.flushAllQueues(),_e.size){o.destroy(!0);for(const nt of _e.values())this.map.painter.saveTileTexture(nt)}else o.destroy()}prepareTile(o,g,_e,nt){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBandForRender(g,_e,nt,(st,lt)=>{if(st)return o.state="errored",this.fire(new h.y(st)),void this.triggerRepaint(o);lt&&(o._isHeaderLoaded=!0,o.setTexturePerLayer(_e,lt,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;const g=this.rasterLayers.find(({id:st})=>st===o),_e=g&&g.fields,nt=_e&&_e.bands&&_e.bands;return nt?nt[0]:0}getTextureDescriptor(o,g,_e){if(!o)return;const nt=g.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!nt)return;let st=null;g instanceof h.aP?st=g.paint.get("raster-array-band"):g instanceof h.aQ&&(st=g.paint.get("raster-particle-array-band"));const lt=st||this.getInitialBand(nt);if(lt==null)return;if(!o.textureDescriptorPerLayer.get(g.id))return void this.prepareTile(o,nt,g.id,lt);if(o.updateNeeded(g.id,lt)&&!_e)return;const ut=o.textureDescriptorPerLayer.get(g.id);return Object.assign({},ut,{texture:o.texturePerLayer.get(g.id)})}getImages(o,g){const _e=new Map;for(const nt of o)for(const st of g){const[lt,ut]=st.split("/"),pt=nt.getLayer(lt);if(!pt||!pt.hasBand(ut)||!pt.hasDataForBand(ut))continue;const{bytes:yt,tileSize:vt,buffer:Mt}=pt.getBandView(ut),Et=vt+2*Mt,Lt={data:new h.q({width:Et,height:Et},yt),pixelRatio:2,sdf:!1,usvg:!1,version:0};_e.set(st,Lt)}return _e}queryRasterArrayValueByBandId(o,g,_e){const nt=g._mrt;return new Promise(st=>{const lt={},ut=new Set;for(const[pt,yt]of Object.entries(nt.layers)){if(_e.layerName&&pt!==_e.layerName)continue;const vt={};lt[pt]=vt;for(const{bands:Mt}of yt.dataIndex)for(const Et of Mt)_e.bands&&!_e.bands.includes(Et)||(ut.add(h.B(pt,Et)),g.fetchBand(pt,null,Et,Lt=>{h.o.frame(()=>{vt[Et]=Lt?null:P_([o.lng,o.lat],nt,yt.getBandView(Et)),ut.delete(h.B(pt,Et)),ut.size===0&&st(lt)})},!1))}ut.size===0&&st(lt)})}_loadTileForQuery(o,g){if(this._loadTileLoaded[o.uid])return void g(null,o._mrt);if(this._loadTilePending[o.uid])return void this._loadTilePending[o.uid].push(g);this._loadTilePending[o.uid]=[g];const _e=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),nt=this.map._requestManager.transformRequest(_e,h.R.Tile);o.actor.send("loadTile",{request:nt,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(st,lt,ut,pt)=>st?(this._loadTilePending[o.uid].forEach(yt=>yt(st,null)),void delete this._loadTilePending[o.uid]):lt?(this.map._refreshExpiredTiles&&lt&&o.setExpiryData({cacheControl:ut,expires:pt}),o._mrt=lt,o._isHeaderLoaded=!0,o.state="loaded",this._loadTilePending[o.uid].forEach(yt=>yt(null,lt)),this._loadTileLoaded[o.uid]=!0,void delete this._loadTilePending[o.uid]):(this._loadTilePending[o.uid].forEach(yt=>yt(null,null)),void delete this._loadTilePending[o.uid]),void 0,!0)}queryRasterArrayValueByAllBands(o,g,_e){return new Promise((nt,st)=>{this._loadTileForQuery(g,(lt,ut)=>{lt?st(lt):nt(ut?this.queryRasterArrayValueByBandId(o,g,_e):null)})})}queryRasterArrayValue(o,g){const _e=h.aR.convert(o),nt=this.findLoadedParent(_e);return nt&&nt._mrt?g.bands||!this.partial?this.queryRasterArrayValueByBandId(_e,nt,g):this.queryRasterArrayValueByAllBands(_e,nt,g):Promise.resolve(null)}findLoadedParent(o){const g=h.ae.fromLngLat(o,this.map.transform.tileSize),_e=this.maxzoom+1,nt=1<<_e,st=Math.floor(g.x),lt=Math.floor((g.x-st)*nt),ut=Math.floor(g.y*nt),pt=this.map.style.getSourceCache(this.id),yt=new h.aO(_e,st,_e,lt,ut);return pt.findLoadedParent(yt,this.minzoom)}}const Rp={vector:Gl,raster:Zp,"raster-dem":class extends Zp{constructor(et,o,g,_e){super(et,o,g,_e),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(et,o){const g=this.map._requestManager.normalizeTileURL(et.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _e(nt,st){nt&&(et.state="errored",o(nt)),st&&(et.dem=st,et.dem.onDeserialize(),et.needsHillshadePrepare=!0,et.needsDEMTextureUpload=!0,et.state="loaded",o(null))}et.request=h.n(this.map._requestManager.transformRequest(g,h.R.Tile),(function(nt,st,lt,ut){if(delete et.request,et.aborted)et.state="unloaded",o(null);else if(nt)et.state="errored",o(nt);else if(st){this.map._refreshExpiredTiles&&et.setExpiryData({cacheControl:lt,expires:ut});const pt=ImageBitmap&&st instanceof ImageBitmap&&h.r(),yt=1-(st.width-h.aN(st.width))/2;yt<1||et.neighboringTiles||(et.neighboringTiles=this._getNeighboringTiles(et.tileID));const vt=pt?st:h.o.getImageData(st,yt),Mt={uid:et.uid,tileID:et.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:vt,encoding:this.encoding,padding:yt};et.actor&&et.state!=="expired"||(et.actor=this.dispatcher.getActor(),et.actor.send("loadTile",Mt,_e.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(et){const o=et.canonical,g=Math.pow(2,o.z),_e=(o.x-1+g)%g,nt=o.x===0?et.wrap-1:et.wrap,st=(o.x+1+g)%g,lt=o.x+1===g?et.wrap+1:et.wrap,ut={};return ut[new h.aO(et.overscaledZ,nt,o.z,_e,o.y).key]={backfilled:!1},ut[new h.aO(et.overscaledZ,lt,o.z,st,o.y).key]={backfilled:!1},o.y>0&&(ut[new h.aO(et.overscaledZ,nt,o.z,_e,o.y-1).key]={backfilled:!1},ut[new h.aO(et.overscaledZ,et.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},ut[new h.aO(et.overscaledZ,lt,o.z,st,o.y-1).key]={backfilled:!1}),o.y+1<g&&(ut[new h.aO(et.overscaledZ,nt,o.z,_e,o.y+1).key]={backfilled:!1},ut[new h.aO(et.overscaledZ,et.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},ut[new h.aO(et.overscaledZ,lt,o.z,st,o.y+1).key]={backfilled:!1}),ut}},"raster-array":ip,geojson:class extends h.E{constructor(et,o,g,_e){super(),this.id=et,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(_e),this._data=o.data,this._options=Object.assign({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const nt=h.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*nt,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*nt,extent:h.al,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:h.al,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*nt,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(et){this.map=et,this.setData(this._data)}setData(et){return this._data=et,this._updateWorkerData(),this}updateData(et){if(!this._options.dynamic)return this.fire(new h.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof et!="string"&&(et.type==="Feature"&&(et={type:"FeatureCollection",features:[et]}),et.type!=="FeatureCollection"))return this.fire(new h.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof et!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const o=new Map;for(const g of this._data.features)o.set(g.id,g);for(const g of et.features)o.set(g.id,g);this._data.features=[...o.values()]}else this._data=et;return this._updateWorkerData(!0),this}getClusterExpansionZoom(et,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:et,source:this.id,scope:this.scope},o),this}getClusterChildren(et,o){return this.actor.send("geojson.getClusterChildren",{clusterId:et,source:this.id,scope:this.scope},o),this}getClusterLeaves(et,o,g,_e){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:et,limit:o,offset:g},_e),this}_updateWorkerData(et=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new h.z("dataloading",{dataType:"source"})),this._loaded=!1;const o=Object.assign({append:et},this.workerOptions);o.scope=this.scope;const g=this._data;typeof g=="string"?(o.request=this.map._requestManager.transformRequest(h.o.resolveURL(g),h.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(g),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(_e,nt)=>{if(this._loaded=!0,this._pendingLoad=null,_e)this.fire(new h.y(_e));else{const st={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&nt&&nt.resourceTiming&&nt.resourceTiming[this.id]&&(st.resourceTiming=nt.resourceTiming[this.id]),et&&(this._partialReload=!0),this.fire(new h.z("data",st)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(et),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const et=h.B(this.id,this.scope);this.map.style.clearSource(et),this._updateWorkerData()}loadTile(et,o){const g=et.actor?"reloadTile":"loadTile";et.actor=this.actor;const _e=this.map.style?this.map.style.getLut(this.scope):null,nt=_e?{image:_e.image.clone()}:null,st=this._partialReload,lt={type:this.type,uid:et.uid,tileID:et.tileID,tileZoom:et.tileZoom,zoom:et.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:nt,scope:this.scope,pixelRatio:h.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:et.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:st,worldview:this.map.getWorldview()};et.request=this.actor.send(g,lt,(ut,pt)=>st&&!pt?(et.state="loaded",o(null)):(delete et.request,et.destroy(),et.aborted?o(null):ut?o(ut):(et.loadVectorData(pt,this.map.painter,g==="reloadTile"),o(null))),void 0,g==="loadTile")}abortTile(et){et.request&&(et.request.cancel(),delete et.request),et.aborted=!0}unloadTile(et,o){this.actor.send("removeTile",{uid:et.uid,type:this.type,source:this.id,scope:this.scope}),et.destroy()}onRemove(et){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends h.aS{constructor(et,o,g,_e){super(et,o,g,_e),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const et=this.options;this.urls=[];for(const o of et.urls)this.urls.push(this.map._requestManager.transformRequest(o,h.R.Source).url);h.aT(this.urls,(o,g)=>{this._loaded=!0,o?this.fire(new h.y(o)):g&&(this.video=g,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(et){if(this.video){const o=this.video.seekable;et<o.start(0)||et>o.end(0)?this.fire(new h.y(new h.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=et}}getVideo(){return this.video}onAdd(et){this.map||(this.map=et,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const et=this.map.painter.context,o=et.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new h.T(et,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(et)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:h.aS,model:class extends h.E{constructor(et,o,g,_e){super(),this.id=et,this.type="model",this.models=[],this._loaded=!1,this._options=o}load(){const et=[];for(const o in this._options.models){const g=this._options.models[o],_e=h.aV(this.map._requestManager.transformRequest(g.uri,h.R.Model).url).then(nt=>{if(!nt)return;const st=h.aW(nt),lt=new h.aX(o,g.position,g.orientation,st);lt.computeBoundsAndApplyParent(),this.models.push(lt)}).catch(nt=>{this.fire(new h.y(new Error(`Could not load model ${o} from ${g.uri}: ${nt.message}`)))});et.push(_e)}Promise.allSettled(et).then(()=>{this._loaded=!0,this.fire(new h.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(o=>{this._loaded=!0,this.fire(new h.y(new Error(`Could not load models: ${o.message}`)))})}onAdd(et){this.map=et,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(et,o){}serialize(){return this._options}},"batched-model":class extends h.E{constructor(et,o,g,_e){super(),this.type="batched-model",this.id=et,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=g,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_e)}onAdd(et){this.map=et,this.load()}reload(){this.cancelTileJSONRequest();const et=h.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(et))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(et){this._loaded=!1,this.fire(new h.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=Ul(this._options,this.map._requestManager,o,g,(_e,nt)=>{this._tileJSONRequest=null,this._loaded=!0,_e?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new h.y(_e))):nt&&(Object.assign(this,nt),nt.bounds&&(this.tileBounds=new Zu(nt.bounds,this.minzoom,this.maxzoom)),pn(nt.tiles,this.map._requestManager._customAccessToken),this.fire(new h.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.z("data",{dataType:"source",sourceDataType:"content"}))),et&&et(_e)})}hasTransition(){return!1}hasTile(et){return!this.tileBounds||this.tileBounds.contains(et.canonical)}loaded(){return this._loaded}loadTile(et,o){const g=this.map._requestManager.normalizeTileURL(et.tileID.canonical.url(this.tiles,this.scheme)),_e={request:this.map._requestManager.transformRequest(g,h.R.Tile),data:void 0,uid:et.uid,tileID:et.tileID,tileZoom:et.tileZoom,zoom:et.tileID.overscaledZ,tileSize:this.tileSize*et.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:et.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:h.o.devicePixelRatio,promoteId:this.promoteId};if(et.actor&&et.state!=="expired")if(et.state==="loading")et.reloadCallback=o;else{if(et.buckets){const st=Object.values(et.buckets);for(const lt of st)lt.dirty=!0;return void(et.state="loaded")}et.request=et.actor.send("reloadTile",_e,nt.bind(this))}else et.actor=this.dispatcher.getActor(),et.request=et.actor.send("loadTile",_e,nt.bind(this),void 0,!0);function nt(st,lt){return et.aborted?o(null):st&&st.status!==404?o(st):(this.map._refreshExpiredTiles&&lt&&et.setExpiryData(lt),et.loadModelData(lt,this.map.painter),et.state="loaded",void o(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends h.aS{constructor(et,o,g,_e){super(et,o,g,_e),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(nt=>!Array.isArray(nt)||nt.length!==2||nt.some(st=>typeof st!="number"))||this.fire(new h.y(new h.V(`sources.${et}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.y(new h.V(`sources.${et}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new h.y(new h.V(`sources.${et}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new h.y(new h.V(`sources.${et}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.y(new h.V(`sources.${et}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(et){this.map=et,this.load(),this.canvas&&this.animate&&this.play()}onRemove(et){this.pause()}prepare(){let et=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,et=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,et=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!et&&!this._playing||this.texture instanceof h.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const et of[this.canvas.width,this.canvas.height])if(isNaN(et)||et<=0)return!0;return!1}},custom:class extends h.E{constructor(et,o,g,_e){super(),this.id=et,this.type="custom",this._dataType="raster",this._dispatcher=g,this._implementation=o,this.setEventedParent(_e),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new h.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new h.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Zu(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,h.aH(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return h.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new h.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(et){this.map=et,this._loaded=!1,this.fire(new h.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(et),this.load()}onRemove(et){this._implementation.onRemove&&this._implementation.onRemove(et)}hasTile(et){if(this._implementation.hasTile){const{x:o,y:g,z:_e}=et.canonical;return this._implementation.hasTile({x:o,y:g,z:_e})}return!this.tileBounds||this.tileBounds.contains(et.canonical)}loadTile(et,o){const{x:g,y:_e,z:nt}=et.tileID.canonical,st=new AbortController;et.request=Promise.resolve(this._implementation.loadTile({x:g,y:_e,z:nt},{signal:st.signal})).then((function(lt){return delete et.request,et.aborted?(et.state="unloaded",o(null)):lt===void 0?(et.state="errored",o(null)):lt===null?(this.loadTileData(et,{width:this.tileSize,height:this.tileSize,data:null}),et.state="loaded",o(null)):function(ut){return ut instanceof ImageData||ut instanceof HTMLCanvasElement||ut instanceof ImageBitmap||ut instanceof HTMLImageElement}(lt)?(this.loadTileData(et,lt),et.state="loaded",void o(null)):(et.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(lt=>{lt.name!=="AbortError"&&(et.state="errored",o(lt))}),et.request.cancel=()=>st.abort()}loadTileData(et,o){et.setTexture(o,this.map.painter)}unloadTile(et,o){if(et.texture&&et.texture instanceof h.T?(et.destroy(!0),et.texture&&et.texture instanceof h.T&&this.map.painter.saveTileTexture(et.texture)):et.destroy(),this._implementation.unloadTile){const{x:g,y:_e,z:nt}=et.tileID.canonical;this._implementation.unloadTile({x:g,y:_e,z:nt})}o&&o()}abortTile(et,o){et.request&&et.request.cancel&&(et.request.cancel(),delete et.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(et=>({x:et.canonical.x,y:et.canonical.y,z:et.canonical.z}))}_clearTiles(){const et=h.B(this.id,this.scope);this.map.style.clearSource(et)}_update(){this.fire(new h.z("data",{dataType:"source",sourceDataType:"content"}))}}},Xp=function(et,o,g,_e){const nt=new Rp[o.type](et,o,g,_e);if(nt.id!==et)throw new Error(`Expected Source id to be ${et} instead of ${nt.id}`);return h.aY(["load","abort","unload","serialize","prepare"],nt),nt};function Kp(et,o,g=""){return`${g}:${o.id||""}:${o.layer.id}:${function(_e){if("layerId"in _e)return`layer:${_e.layerId}`;{const{featuresetId:nt,importId:st}=_e;return`featureset:${nt}${st?`:import:${st}`:""}`}}(et.target)}`}function Il(et,o,g,_e=""){if(et.uniqueFeatureID){const nt=Kp(et,o,_e);if(g.has(nt))return!0;g.add(nt)}return!1}function Yp(et,o,g,_e,nt=!1){const st=o.sourceCache.transform,lt=o.sourceCache.tilesIn(et,o.has3DLayers,nt);lt.sort(ty);const ut=[];for(const pt of lt){const yt=pt.tile.queryRenderedFeatures(o,pt,g,_e,st,nt);Object.keys(yt).length&&ut.push({wrappedTileID:pt.tile.tileID.wrapped().key,queryResults:yt})}return ut.length===0?{}:function(pt){const yt={},vt={};for(const Mt of pt){const Et=Mt.queryResults,Lt=Mt.wrappedTileID,Ft=vt[Lt]=vt[Lt]||{};for(const Ot in Et){const qt=Et[Ot],$t=Ft[Ot]=Ft[Ot]||{},Yt=yt[Ot]=yt[Ot]||[];for(const tr of qt)$t[tr.featureIndex]||($t[tr.featureIndex]=!0,Yt.push(tr))}}return yt}(ut)}function ey(et,o,g,_e,nt,st){const lt={},ut=_e.queryRenderedSymbols(et),pt=[];for(const yt of Object.keys(ut).map(Number))pt.push(nt[yt]);pt.sort(ty);for(const yt of pt){const vt=yt.featureIndex.lookupSymbolFeatures(ut[yt.bucketInstanceId],yt.bucketIndex,yt.sourceLayerIndex,o,g,st);for(const Mt in vt){const Et=lt[Mt]=lt[Mt]||[],Lt=vt[Mt];Lt.sort((Ft,Ot)=>{const qt=yt.featureSortOrder;if(qt){const $t=qt.indexOf(Ft.featureIndex);return qt.indexOf(Ot.featureIndex)-$t}return Ot.featureIndex-Ft.featureIndex});for(const Ft of Lt)Et.push(Ft)}}return lt}function gu(et,o){const g=et.getRenderableIds().map(st=>et.getTileByID(st)),_e=[],nt={};for(let st=0;st<g.length;st++){const lt=g[st],ut=lt.tileID.canonical.key;nt[ut]||(nt[ut]=!0,lt.querySourceFeatures(_e,o))}return _e}function ty(et,o){const g=et.tileID,_e=o.tileID;return g.overscaledZ-_e.overscaledZ||g.canonical.y-_e.canonical.y||g.wrap-_e.wrap||g.canonical.x-_e.canonical.x}function Cm(et,o){const g={};if(!o)return g;for(const _e of et){const nt=_e.layerIds.map(st=>o.getLayer(st)).filter(Boolean);if(nt.length!==0){_e.layers=nt,_e.stateDependentLayerIds&&(_e.stateDependentLayers=_e.stateDependentLayerIds.map(st=>nt.filter(lt=>lt.id===st)[0]));for(const st of nt)g[st.fqid]=_e}}return g}const yu=32,Du=33,Xu=new Uint16Array(8184);for(let et=0;et<2046;et++){let o=et+2,g=0,_e=0,nt=0,st=0,lt=0,ut=0;for(1&o?nt=st=lt=yu:g=_e=ut=yu;(o>>=1)>1;){const yt=g+nt>>1,vt=_e+st>>1;1&o?(nt=g,st=_e,g=lt,_e=ut):(g=nt,_e=st,nt=lt,st=ut),lt=yt,ut=vt}const pt=4*et;Xu[pt+0]=g,Xu[pt+1]=_e,Xu[pt+2]=nt,Xu[pt+3]=st}const Eu=new Uint16Array(2178),$l=new Uint8Array(1089),fp=new Uint16Array(1089);function iy(et){return et===0?-.03125:et===32?.03125:0}const rp=(()=>({type:2,extent:h.al,loadGeometry:()=>[[new h.P(0,0),new h.P(h.al+1,0),new h.P(h.al+1,h.al+1),new h.P(0,h.al+1),new h.P(0,0)]]}))();class mp{constructor(o,g,_e,nt,st,lt){this.tileID=o,this.uid=h.b2(),this.uses=0,this.tileSize=g,this.tileZoom=_e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=st,nt&&nt.style&&(this._lastUpdatedBrightness=nt.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",nt&&nt.transform&&(this.projection=nt.transform.projection),this.worldview=lt}registerFadeDuration(o){const g=o+this.timeAdded;g<h.o.now()||this.fadeEndTime&&g<this.fadeEndTime||(this.fadeEndTime=g)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=h.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,g,_e){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=Cm(o.buckets,g.style),this.hasSymbolBuckets=!1;for(const nt in this.buckets){const st=this.buckets[nt];if(st instanceof h.b4){if(this.hasSymbolBuckets=!0,!_e)break;st.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const nt in this.buckets){const st=this.buckets[nt];if(st instanceof h.b4&&st.hasRTLText){this.hasRTLText=!0,h.b5();break}}this.queryPadding=0;for(const nt in this.buckets){const st=this.buckets[nt],lt=g.style.getOwnLayer(nt);if(!lt)continue;const ut=lt.queryRadius(st);this.queryPadding=Math.max(this.queryPadding,ut)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new h.b3}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,g,_e){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,Cm(o.buckets,g.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o){for(const nt in this.buckets){const st=this.buckets[nt];st.uploadPending()&&st.upload(o)}const g=o.gl,_e=this.imageAtlas;_e&&!_e.uploaded&&(this.imageAtlasTexture=new h.T(o,_e.image,g.RGBA8,{useMipmap:!!_e.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new h.T(o,this.glyphAtlasImage,g.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new h.T(o,this.lineAtlas.image,g.R8),this.lineAtlas.uploaded=!0)}prepare(o,g,_e){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,_e),!g||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const nt=g.style.getBrightness();(this._lastUpdatedBrightness||nt)&&(this._lastUpdatedBrightness&&nt&&Math.abs(this._lastUpdatedBrightness-nt)<.001||(this.updateBuckets(g,this._lastUpdatedBrightness!==nt),this._lastUpdatedBrightness=nt))}queryRenderedFeatures(o,g,_e,nt,st,lt){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const ut=function(pt,yt){const vt=h.bq([],[.5*pt.width,.5*-pt.height,1]);return h.br(vt,vt,[1,-1,0]),h.aB(vt,vt,pt.calculateProjMatrix(yt.toUnwrapped())),Float32Array.from(vt)}(st,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:g,pixelPosMatrix:ut,transform:nt,availableImages:_e,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(o,g){const _e=this.latestFeatureIndex;if(!_e||!_e.rawTileData)return;const nt=_e.loadVTLayers(),st=g?g.sourceLayer:"",lt=nt._geojsonTileLayer||nt[st];if(!lt)return;const ut=h.b6(g&&g.filter),{z:pt,x:yt,y:vt}=this.tileID.canonical,Mt={z:pt,x:yt,y:vt};for(let Et=0;Et<lt.length;Et++){const Lt=lt.feature(Et);if(ut.needGeometry){const qt=h.b7(Lt,!0);if(!ut.filter(new h.ac(this.tileID.overscaledZ,{worldview:this.worldview}),qt,this.tileID.canonical))continue}else if(!ut.filter(new h.ac(this.tileID.overscaledZ,{worldview:this.worldview}),Lt))continue;const Ft=_e.getId(Lt,st),Ot=new h.b8(Lt,pt,yt,vt,Ft);Ot.tile=Mt,o.push(Ot)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){const g=this.expirationTime;if(o.cacheControl){const _e=h.b9(o.cacheControl);_e["max-age"]&&(this.expirationTime=Date.now()+1e3*_e["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const _e=Date.now();let nt=!1;if(this.expirationTime>_e)nt=!1;else if(g)if(this.expirationTime<g)nt=!0;else{const st=this.expirationTime-g;st?this.expirationTime=_e+Math.max(st,3e4):nt=!0}else nt=!0;nt?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}updateBuckets(o,g){if(!this.latestFeatureIndex||!o.style)return;const _e=this.latestFeatureIndex.loadVTLayers(),nt=o.style.listImages(),st=o.style.getBrightness();for(const lt in this.buckets){if(!o.style.hasLayer(lt))continue;const ut=this.buckets[lt],pt=ut.layers[0],yt=pt.sourceLayer||"_geojsonTileLayer",vt=_e[yt],Mt=o.style.getLayerSourceCache(pt);let Et={};Mt&&(Et=Mt._state.getState(yt,void 0));const Lt=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Ft=Object.keys(Et).length>0&&!g;(Ft&&ut.stateDependentLayers.length!==0||g)&&ut.update(Et,vt,nt,Lt,Ft?ut.stateDependentLayers:ut.layers,g,st),(ut instanceof h.ba||ut instanceof h.bb)&&o._terrain&&o._terrain.enabled&&Mt&&ut.uploadPending()&&o._terrain._clearRenderCacheForTile(Mt.id,this.tileID);const Ot=o&&o.style&&o.style.getOwnLayer(lt);Ot&&(this.queryPadding=Math.max(this.queryPadding,Ot.queryRadius(ut)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<h.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=h.o.now()+o}setTexture(o,g){const _e=g.context,nt=_e.gl;this.texture=this.texture||g.getTileTexture(o.width),this.texture&&this.texture instanceof h.T?this.texture.update(o):(this.texture=new h.T(_e,o,nt.RGBA8,{useMipmap:!0}),this.texture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE))}setDependencies(o,g){const _e={};for(const nt of g)_e[nt]=!0;this.dependencies[o]=_e}hasDependency(o,g){for(const _e of o){const nt=this.dependencies[_e];if(nt){for(const st of g)if(nt[st])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,g){if(!g||g.name==="mercator"||this._tileDebugBuffer)return;const _e=h.bc(rp,this.tileID.canonical,this.tileTransform)[0],nt=new h.bd,st=new h.be;for(let lt=0;lt<_e.length;lt++){const{x:ut,y:pt}=_e[lt];nt.emplaceBack(ut,pt),st.emplaceBack(lt)}st.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(st),this._tileDebugBuffer=o.createVertexBuffer(nt,h.bf.members),this._tileDebugSegments=h.bg.simpleSegment(0,0,nt.length,st.length)}_makeTileBoundsBuffers(o,g){if(this._tileBoundsBuffer||!g||g.name==="mercator")return;const _e=h.bc(rp,this.tileID.canonical,this.tileTransform)[0];let nt,st;if(this.isRaster){const lt=function(ut,pt){const yt=h.aZ(ut,pt),vt=Math.pow(2,ut.z);for(let qt=0;qt<Du;qt++)for(let $t=0;$t<Du;$t++){const Yt=h.a_((ut.x+($t+iy($t))/yu)/vt),tr=h.a$((ut.y+(qt+iy(qt))/yu)/vt),sr=pt.project(Yt,tr),pr=qt*Du+$t;Eu[2*pr+0]=Math.round((sr.x*yt.scale-yt.x)*h.al),Eu[2*pr+1]=Math.round((sr.y*yt.scale-yt.y)*h.al)}$l.fill(0),fp.fill(0);for(let qt=2045;qt>=0;qt--){const $t=4*qt,Yt=Xu[$t+0],tr=Xu[$t+1],sr=Xu[$t+2],pr=Xu[$t+3],hr=Yt+sr>>1,gr=tr+pr>>1,dr=hr+gr-tr,ur=gr+Yt-hr,yr=tr*Du+Yt,Vr=pr*Du+sr,Ir=gr*Du+hr,Qr=Math.hypot((Eu[2*yr+0]+Eu[2*Vr+0])/2-Eu[2*Ir+0],(Eu[2*yr+1]+Eu[2*Vr+1])/2-Eu[2*Ir+1])>=16;$l[Ir]=$l[Ir]||(Qr?1:0),qt<1022&&($l[Ir]=$l[Ir]||$l[(tr+ur>>1)*Du+(Yt+dr>>1)]||$l[(pr+ur>>1)*Du+(sr+dr>>1)])}const Mt=new h.b0,Et=new h.b1;let Lt=0;function Ft(qt,$t){const Yt=$t*Du+qt;return fp[Yt]===0&&(Mt.emplaceBack(Eu[2*Yt+0],Eu[2*Yt+1],qt*h.al/yu,$t*h.al/yu),fp[Yt]=++Lt),fp[Yt]-1}function Ot(qt,$t,Yt,tr,sr,pr){const hr=qt+Yt>>1,gr=$t+tr>>1;if(Math.abs(qt-sr)+Math.abs($t-pr)>1&&$l[gr*Du+hr])Ot(sr,pr,qt,$t,hr,gr),Ot(Yt,tr,sr,pr,hr,gr);else{const dr=Ft(qt,$t),ur=Ft(Yt,tr),yr=Ft(sr,pr);Et.emplaceBack(dr,ur,yr)}}return Ot(0,0,yu,yu,yu,0),Ot(yu,yu,0,0,0,yu),{vertices:Mt,indices:Et}}(this.tileID.canonical,g);nt=lt.vertices,st=lt.indices}else{nt=new h.b0,st=new h.b1;for(const{x:ut,y:pt}of _e)nt.emplaceBack(ut,pt,0,0);const lt=h.bh(nt.int16.subarray(0,4*nt.length),void 0,4);for(let ut=0;ut<lt.length;ut+=3)st.emplaceBack(lt[ut],lt[ut+1],lt[ut+2])}this._tileBoundsBuffer=o.createVertexBuffer(nt,h.bi.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(st),this._tileBoundsSegments=h.bg.simpleSegment(0,0,nt.length,st.length)}_makeGlobeTileDebugBuffers(o,g){const _e=g.projection;if(!_e||_e.name!=="globe"||g.freezeTileCoverage)return;const nt=this.tileID.canonical,st=h.bj(nt,g),lt=h.bk(st),ut=h.aj(g.zoom);let pt;ut>0&&(pt=h.bl(new Float64Array(16),g.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,nt,g,lt,pt,ut),this._makeGlobeTileDebugTextBuffer(o,nt,g,lt,pt,ut)}_globePoint(o,g,_e,nt,st,lt,ut){let pt=h.bm(o,g,_e);if(lt){const yt=1<<_e.z,vt=h.aF(nt.center.lng),Mt=h.aJ(nt.center.lat),Et=(_e.x+.5)/yt-vt;let Lt=0;Et>.5?Lt=-1:Et<-.5&&(Lt=1);let Ft=(o/h.al+_e.x)/yt+Lt,Ot=(g/h.al+_e.y)/yt;Ft=(Ft-vt)*nt._pixelsPerMercatorPixel+vt,Ot=(Ot-Mt)*nt._pixelsPerMercatorPixel+Mt;const qt=[Ft*nt.worldSize,Ot*nt.worldSize,0];h.af(qt,qt,lt),pt=h.bn(pt,qt,ut)}return h.af(pt,pt,st)}_makeGlobeTileDebugBorderBuffer(o,g,_e,nt,st,lt){const ut=new h.bd,pt=new h.be,yt=new h.bo,vt=(Et,Lt,Ft,Ot,qt)=>{const $t=(Ft-Et)/(qt-1),Yt=(Ot-Lt)/(qt-1),tr=ut.length;for(let sr=0;sr<qt;sr++){const pr=Et+sr*$t,hr=Lt+sr*Yt;ut.emplaceBack(pr,hr);const gr=this._globePoint(pr,hr,g,_e,nt,st,lt);yt.emplaceBack(gr[0],gr[1],gr[2]),pt.emplaceBack(tr+sr)}},Mt=h.al;vt(0,0,Mt,0,16),vt(Mt,0,Mt,Mt,16),vt(Mt,Mt,0,Mt,16),vt(0,Mt,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(pt),this._tileDebugBuffer=o.createVertexBuffer(ut,h.bf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(yt,h.bp.members),this._tileDebugSegments=h.bg.simpleSegment(0,0,ut.length,pt.length)}_makeGlobeTileDebugTextBuffer(o,g,_e,nt,st,lt){const ut=h.al/4,pt=new h.bd,yt=new h.b1,vt=new h.bo,Mt=25;yt.reserve(32),pt.reserve(Mt),vt.reserve(Mt);const Et=(Lt,Ft)=>Mt*Lt+Ft;for(let Lt=0;Lt<Mt;Lt++){const Ft=Lt*ut;for(let Ot=0;Ot<Mt;Ot++){const qt=Ot*ut;pt.emplaceBack(qt,Ft);const $t=this._globePoint(qt,Ft,g,_e,nt,st,lt);vt.emplaceBack($t[0],$t[1],$t[2])}}for(let Lt=0;Lt<4;Lt++)for(let Ft=0;Ft<4;Ft++){const Ot=Et(Lt,Ft),qt=Et(Lt,Ft+1),$t=Et(Lt+1,Ft),Yt=Et(Lt+1,Ft+1);yt.emplaceBack(Ot,qt,$t),yt.emplaceBack($t,qt,Yt)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(yt),this._tileDebugTextBuffer=o.createVertexBuffer(pt,h.bf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(vt,h.bp.members),this._tileDebugTextSegments=h.bg.simpleSegment(0,0,Mt,32)}destroy(o=!1){for(const g in this.buckets)this.buckets[g].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!o&&this.texture&&this.texture instanceof h.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}h.bs.setPbf(h.bt);class Am extends mp{constructor(o,g,_e,nt,st){super(o,g,_e,nt,st),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexturePerLayer(o,g,_e){const nt=_e.context,st=nt.gl;let lt=this.texturePerLayer.get(o)||_e.getTileTexture(g.width);lt&&lt instanceof h.T?lt.update(g,{premultiply:!1}):lt=new h.T(nt,g,st.RGBA8,{premultiply:!1}),this.texturePerLayer.has(o)||this.texturePerLayer.set(o,lt)}flushQueues(o){const g=this._workQueuePerLayer.get(o)||[],_e=this._fetchQueuePerLayer.get(o)||[];for(;g.length;)g.pop()();for(;_e.length;)_e.pop()()}flushAllQueues(){for(const o of this._workQueuePerLayer.keys()){const g=this._workQueuePerLayer.get(o)||[];for(;g.length;)g.pop()()}for(const o of this._fetchQueuePerLayer.keys()){const g=this._fetchQueuePerLayer.get(o)||[];for(;g.length;)g.pop()()}}fetchHeader(o=16384,g){const _e=this._mrt=new h.bs(30),nt=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=h.bu(nt,(st,lt,ut,pt)=>{if(st)g(st);else try{const yt=_e.getHeaderLength(lt);if(yt>o)return void(this.request=this.fetchHeader(yt,g));_e.parseHeader(lt),this._isHeaderLoaded=!0;let vt=0;for(const Mt of Object.values(_e.layers))vt=Math.max(vt,Mt.dataIndex[Mt.dataIndex.length-1].lastByte);lt.byteLength>=vt&&(this.entireBuffer=lt),g(null,this.entireBuffer||lt,ut,pt)}catch(yt){g(yt)}}),this.request}fetchBandForRender(o,g,_e,nt){this.fetchBand(o,g,_e,st=>{if(st)return void nt(st);this.updateTextureDescriptor(o,g,_e);const lt=this.textureDescriptorPerLayer.get(g);nt(null,lt?lt.img:null)})}fetchBand(o,g,_e,nt,st=!0){const lt=this._mrt;if(!this._isHeaderLoaded||!lt)return void nt(new Error("Tile header is not ready"));const ut=this.actor;if(!ut)return void nt(new Error("Can't fetch tile band without an actor"));let pt;const yt=h.B(String(_e),h.B(this.tileID.key,o));let vt=this._taskQueue.get(yt);vt?vt.add(nt):(vt=new Set,vt.add(nt),this._taskQueue.set(yt,vt));const Mt=(Ot,qt)=>{pt.complete(Ot,qt),Ot?nt(Ot):(vt.values().forEach($t=>$t(null,qt)),this._taskQueue.delete(yt))},Et=(Ot,qt)=>{if(Ot)return nt(Ot);const $t=ut.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:qt,task:pt},Mt,void 0,!0);if(g!==null){const Yt=this._workQueuePerLayer.get(g)||[];Yt.push(()=>{$t&&$t.cancel(),pt.cancel()}),this._workQueuePerLayer.has(g)||this._workQueuePerLayer.set(g,Yt)}};let Lt;try{Lt=lt.getLayer(o)}catch(Ot){if(this.state==="reloading")return;throw Ot}if(!Lt)return void nt(new Error(`Unknown sourceLayer "${o}"`));if(Lt.hasDataForBand(_e))return vt.values().forEach(Ot=>Ot(null,null)),void this._taskQueue.delete(yt);const Ft=Lt.getDataRange([_e]);if(pt=lt.createDecodingTask(Ft),!pt||pt.tasks.length)if(g!==null&&this.flushQueues(g),this.entireBuffer)Et(null,this.entireBuffer.slice(Ft.firstByte,Ft.lastByte+1));else{const Ot=Object.assign({},this.requestParams,{headers:{Range:`bytes=${Ft.firstByte}-${Ft.lastByte}`}}),qt=h.bu(Ot,Et);if(g!==null){const $t=this._fetchQueuePerLayer.get(g)||[];$t.push(()=>{qt.cancel(),pt.cancel()}),this._fetchQueuePerLayer.has(g)||this._fetchQueuePerLayer.set(g,$t)}}}updateNeeded(o,g){return(!this.textureDescriptorPerLayer.get(o)||this.textureDescriptorPerLayer.get(o).band!==g||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(o,g,_e){if(!this._mrt)return;const nt=this._mrt.getLayer(o);if(!nt||!nt.hasBand(_e)||!nt.hasDataForBand(_e))return;const{bytes:st,tileSize:lt,buffer:ut,offset:pt,scale:yt}=nt.getBandView(_e),vt=lt+2*ut,Mt=new h.q({width:vt,height:vt},st),Et=this.texturePerLayer.get(g);Et&&Et instanceof h.T&&Et.update(Mt,{premultiply:!1}),this.textureDescriptorPerLayer.set(g,{layer:o,band:_e,img:Mt,buffer:ut,offset:pt,tileSize:lt,format:nt.pixelFormat,mix:[yt,256*yt,65536*yt,16777216*yt]})}destroy(o=!1){if(super.destroy(o),delete this._mrt,!o)for(const g of this.texturePerLayer.values())g&&g instanceof h.T&&g.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Rm{constructor(o,g){this.max=o,this.onRemove=g,this.reset()}reset(){for(const o in this.data)for(const g of this.data[o])g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value);return this.data={},this.order=[],this}add(o,g,_e){const nt=o.wrapped().key;this.data[nt]===void 0&&(this.data[nt]=[]);const st={value:g,timeout:void 0};if(_e!==void 0&&(st.timeout=setTimeout(()=>{this.remove(o,st)},_e)),this.data[nt].push(st),this.order.push(nt),this.order.length>this.max){const lt=this._getAndRemoveByKey(this.order[0]);lt&&this.onRemove(lt)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const g=this.data[o].shift();return g.timeout&&clearTimeout(g.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),g.value}getByKey(o){const g=this.data[o];return g?g[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,g){if(!this.has(o))return this;const _e=o.wrapped().key,nt=g===void 0?0:this.data[_e].indexOf(g),st=this.data[_e][nt];return this.data[_e].splice(nt,1),st.timeout&&clearTimeout(st.timeout),this.data[_e].length===0&&delete this.data[_e],this.onRemove(st.value),this.order.splice(this.order.indexOf(_e),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}filter(o){const g=[];for(const _e in this.data)for(const nt of this.data[_e])o(nt.value)||g.push(nt);for(const _e of g)this.remove(_e.value.tileID,_e)}}class Qp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,g,_e){const nt=String(g);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][nt]=this.stateChanges[o][nt]||{},Object.assign(this.stateChanges[o][nt],_e),this.deletedStates[o]===null){this.deletedStates[o]={};for(const st in this.state[o])st!==nt&&(this.deletedStates[o][st]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][nt]===null){this.deletedStates[o][nt]={};for(const st in this.state[o][nt])_e[st]||(this.deletedStates[o][nt][st]=null)}else for(const st in _e)this.deletedStates[o]&&this.deletedStates[o][nt]&&this.deletedStates[o][nt][st]===null&&delete this.deletedStates[o][nt][st]}removeFeatureState(o,g,_e){if(this.deletedStates[o]===null)return;const nt=String(g);if(this.deletedStates[o]=this.deletedStates[o]||{},_e&&g!==void 0)this.deletedStates[o][nt]!==null&&(this.deletedStates[o][nt]=this.deletedStates[o][nt]||{},this.deletedStates[o][nt][_e]=null);else if(g!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][nt])for(_e in this.deletedStates[o][nt]={},this.stateChanges[o][nt])this.deletedStates[o][nt][_e]=null;else this.deletedStates[o][nt]=null;else this.deletedStates[o]=null}getState(o,g){const _e=this.state[o]||{},nt=this.stateChanges[o]||{},st=this.deletedStates[o];if(st===null)return{};if(g!==void 0){const ut=String(g),pt=Object.assign({},_e[ut],nt[ut]);if(st){const yt=st[g];if(yt===null)return{};for(const vt in yt)delete pt[vt]}return pt}const lt=Object.assign({},_e,nt);if(st)for(const ut in st)delete lt[ut];return lt}initializeTileState(o,g){o.refreshFeatureState(g)}coalesceChanges(o,g){const _e={};for(const nt in this.stateChanges){this.state[nt]=this.state[nt]||{};const st={};for(const lt in this.stateChanges[nt])this.state[nt][lt]||(this.state[nt][lt]={}),Object.assign(this.state[nt][lt],this.stateChanges[nt][lt]),st[lt]=this.state[nt][lt];_e[nt]=st}for(const nt in this.deletedStates){this.state[nt]=this.state[nt]||{};const st={};if(this.deletedStates[nt]===null)for(const lt in this.state[nt])st[lt]={},this.state[nt][lt]={};else for(const lt in this.deletedStates[nt]){if(this.deletedStates[nt][lt]===null)this.state[nt][lt]={};else if(this.state[nt][lt])for(const ut of Object.keys(this.deletedStates[nt][lt]))delete this.state[nt][lt][ut];st[lt]=this.state[nt][lt]}_e[nt]=_e[nt]||{},Object.assign(_e[nt],st)}if(this.stateChanges={},this.deletedStates={},Object.keys(_e).length!==0)for(const nt in o)o[nt].refreshFeatureState(g)}}class ou extends h.E{constructor(o,g,_e){super(),this.id=o,this._onlySymbols=_e,g.on("data",nt=>{nt.dataType==="source"&&nt.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&nt.dataType==="source"&&nt.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),g.on("error",()=>{this._sourceErrored=!0}),this._source=g,this._tiles={},this._cache=new Rm(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Qp,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,g){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,g)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const g in this._tiles){const _e=this._tiles[g];_e.upload(o),_e.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Pp).map(o=>o.key)}getRenderableIds(o,g){const _e=[];for(const nt in this._tiles)this._isIdRenderable(+nt,o,g)&&_e.push(this._tiles[nt]);return o?_e.sort((nt,st)=>{const lt=nt.tileID,ut=st.tileID,pt=new h.P(lt.canonical.x,lt.canonical.y)._rotate(this.transform.angle),yt=new h.P(ut.canonical.x,ut.canonical.y)._rotate(this.transform.angle);return lt.overscaledZ-ut.overscaledZ||yt.y-pt.y||yt.x-pt.x}).map(nt=>nt.tileID.key):_e.map(nt=>nt.tileID).sort(Pp).map(nt=>nt.key)}hasRenderableParent(o){const g=this.findLoadedParent(o,0);return!!g&&this._isIdRenderable(g.tileID.key)}_isIdRenderable(o,g,_e){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(g||!this._tiles[o].holdingForFade())&&(_e||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,g){const _e=this._tiles[o];_e&&(_e.state!=="loading"&&(_e.state=g),this._loadTile(_e,this._tileLoaded.bind(this,_e,o,g)))}_tileLoaded(o,g,_e,nt){if(nt)if(o.state="errored",nt.status!==404)this._source.fire(new h.y(nt,{tile:o}));else{if(this._source.fire(new h.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const st=this.map.painter.terrain;this.update(this.transform,st.getScaledDemTileSize(),!0),st.resetTileLookupCache(this.id)}else this.update(this.transform)}else o.timeAdded=h.o.now(),_e==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(g,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new h.z("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const g=this.getRenderableIds();for(let nt=0;nt<g.length;nt++){const st=g[nt];if(o.neighboringTiles&&o.neighboringTiles[st]){const lt=this.getTileByID(st);_e(o,lt),_e(lt,o)}}function _e(nt,st){if(!nt.dem||nt.dem.borderReady)return;nt.needsHillshadePrepare=!0,nt.needsDEMTextureUpload=!0;let lt=st.tileID.canonical.x-nt.tileID.canonical.x;const ut=st.tileID.canonical.y-nt.tileID.canonical.y,pt=Math.pow(2,nt.tileID.canonical.z),yt=st.tileID.key;lt===0&&ut===0||Math.abs(ut)>1||(Math.abs(lt)>1&&(Math.abs(lt+pt)===1?lt+=pt:Math.abs(lt-pt)===1&&(lt-=pt)),st.dem&&nt.dem&&(nt.dem.backfillBorder(st.dem,lt,ut),nt.neighboringTiles&&nt.neighboringTiles[yt]&&(nt.neighboringTiles[yt].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,g,_e,nt){for(const st in this._tiles){let lt=this._tiles[st];if(nt[st]||!lt.hasData()||lt.tileID.overscaledZ<=g||lt.tileID.overscaledZ>_e)continue;let ut=lt.tileID;for(;lt&&lt.tileID.overscaledZ>g+1;){const yt=lt.tileID.scaledTo(lt.tileID.overscaledZ-1);lt=this._tiles[yt.key],lt&&lt.hasData()&&(ut=yt)}let pt=ut;for(;pt.overscaledZ>g;)if(pt=pt.scaledTo(pt.overscaledZ-1),o[pt.key]){nt[ut.key]=ut;break}}}findLoadedParent(o,g){if(o.key in this._loadedParentTiles){const _e=this._loadedParentTiles[o.key];return _e&&_e.tileID.overscaledZ>=g?_e:null}for(let _e=o.overscaledZ-1;_e>=g;_e--){const nt=o.scaledTo(_e),st=this._getLoadedTile(nt);if(st)return st}}_getLoadedTile(o){const g=this._tiles[o.key];return g&&g.hasData()?g:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,g){g=g||this._source.tileSize;const _e=Math.ceil(o.width/g)+1,nt=Math.ceil(o.height/g)+1,st=Math.floor(_e*nt*5),lt=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,st):st,ut=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,lt):lt;this._cache.setMaxSize(ut)}handleWrapJump(o){const g=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,g){const _e={};for(const nt in this._tiles){const st=this._tiles[nt];st.tileID=st.tileID.unwrapTo(st.tileID.wrap+g),_e[st.tileID.key]=st}this._tiles=_e;for(const nt in this._timers)clearTimeout(this._timers[nt]),delete this._timers[nt];for(const nt in this._tiles)this._setTileReloadTimer(+nt,this._tiles[nt])}}update(o,g,_e,nt,st){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!_e)return;this.updateCacheSize(o,g),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const lt=this._source.type==="batched-model";let ut,pt=this._source.maxzoom;const yt=this.map&&this.map.painter?this.map.painter._terrain:null;if(yt&&yt.sourceCache===this&&yt.attenuationRange()){const Et=yt.attenuationRange()[0],Lt=Math.floor(Et)-Math.log2(yt.getDemUpscale());pt>Lt&&(pt=Lt)}if(this.used||this.usedForTerrain){if(this._source.tileID)ut=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(Et=>new h.aO(Et.canonical.z,Et.wrap,Et.canonical.z,Et.canonical.x,Et.canonical.y));else if(this.tileCoverLift!==0){const Et=o.clone();Et.tileCoverLift=this.tileCoverLift,ut=Et.coveringTiles({tileSize:g||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:pt,roundZoom:this._source.roundZoom&&!_e,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:lt}),this._source.minzoom<=1&&o.projection.name==="globe"&&(ut.push(new h.aO(1,0,1,0,0)),ut.push(new h.aO(1,0,1,1,0)),ut.push(new h.aO(1,0,1,0,1)),ut.push(new h.aO(1,0,1,1,1)))}else if(ut=o.coveringTiles({tileSize:g||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:pt,roundZoom:this._source.roundZoom&&!_e,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:lt}),this._source.hasTile){const Et=this._source.hasTile.bind(this._source);ut=ut.filter(Lt=>Et(Lt))}}else ut=[];if(ut.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ry(this._source.type)){const Et=o.coveringZoomLevel({tileSize:g||this._source.tileSize,roundZoom:this._source.roundZoom&&!_e}),Lt=Math.min(Et,this._source.maxzoom);if(lt){const Ft=o.extendTileCover(ut,Lt);for(const Ot of Ft)ut.push(Ot)}else if(st){const Ft=o.extendTileCoverToNearPlane(ut,this.transform.getFrustum(Lt),Lt);for(const Ot of Ft)ut.push(Ot)}else if(this.castsShadows&&nt){const Ft=o.extendTileCover(ut,Lt,nt);for(const Ot of Ft)this._shadowCasterTiles[Ot.key]=!0,ut.push(Ot)}}const vt=this._updateRetainedTiles(ut);if(ry(this._source.type)&&ut.length!==0){const Et={},Lt={},Ft=Object.keys(vt);for(const qt of Ft){const $t=vt[qt],Yt=this._tiles[qt];if(!Yt||Yt.fadeEndTime&&Yt.fadeEndTime<=h.o.now())continue;const tr=this.findLoadedParent($t,Math.max($t.overscaledZ-ou.maxOverzooming,this._source.minzoom));tr&&(this._addTile(tr.tileID),Et[tr.tileID.key]=tr.tileID),Lt[qt]=$t}const Ot=ut[ut.length-1].overscaledZ;for(const qt in this._tiles){const $t=this._tiles[qt];if(vt[qt]||!$t.hasData())continue;let Yt=$t.tileID;for(;Yt.overscaledZ>Ot;){Yt=Yt.scaledTo(Yt.overscaledZ-1);const tr=this._tiles[Yt.key];if(tr&&tr.hasData()&&Lt[Yt.key]){vt[qt]=$t.tileID;break}}}for(const qt in Et)vt[qt]||(this._coveredTiles[qt]=!0,vt[qt]=Et[qt])}for(const Et in vt)this._tiles[Et].clearFadeHold();const Mt=h.bv(this._tiles,vt);for(const Et of Mt){const Lt=this._tiles[Et];Lt.hasSymbolBuckets&&!Lt.holdingForFade()?Lt.setHoldDuration(this.map._fadeDuration):Lt.hasSymbolBuckets&&!Lt.symbolFadeFinished()||this._removeTile(+Et)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const g={};if(o.length===0)return g;const _e={},nt=o.reduce((yt,vt)=>Math.min(yt,vt.overscaledZ),1/0),st=o[0].overscaledZ,lt=Math.max(st-ou.maxOverzooming,this._source.minzoom),ut=Math.max(st+ou.maxUnderzooming,this._source.minzoom),pt={};for(const yt of o){const vt=this._addTile(yt);g[yt.key]=yt,vt.hasData()||nt<this._source.maxzoom&&(pt[yt.key]=yt)}this._retainLoadedChildren(pt,nt,ut,g);for(const yt of o){let vt=this._tiles[yt.key];if(vt.hasData())continue;if(yt.canonical.z>=this._source.maxzoom){const Et=yt.children(this._source.maxzoom)[0],Lt=this.getTile(Et);if(Lt&&Lt.hasData()){g[Et.key]=Et;continue}}else{const Et=yt.children(this._source.maxzoom);if(g[Et[0].key]&&g[Et[1].key]&&g[Et[2].key]&&g[Et[3].key])continue}let Mt=vt.wasRequested();for(let Et=yt.overscaledZ-1;Et>=lt;--Et){const Lt=yt.scaledTo(Et);if(_e[Lt.key]||(_e[Lt.key]=!0,vt=this.getTile(Lt),!vt&&Mt&&(vt=this._addTile(Lt)),vt&&(g[Lt.key]=Lt,Mt=vt.wasRequested(),vt.hasData())))break}}return g}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const g=[];let _e,nt=this._tiles[o].tileID;for(;nt.overscaledZ>0;){if(nt.key in this._loadedParentTiles){_e=this._loadedParentTiles[nt.key];break}g.push(nt.key);const st=nt.scaledTo(nt.overscaledZ-1);if(_e=this._getLoadedTile(st),_e)break;nt=st}for(const st of g)this._loadedParentTiles[st]=_e}}_addTile(o){let g=this._tiles[o.key];if(g)return g.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),g;g=this._cache.getAndRemove(o),g&&(this._setTileReloadTimer(o.key,g),g.tileID=o,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,g)));const _e=!!g;if(!_e){const nt=this.map?this.map.painter:null,st=this._source.tileSize*o.overscaleFactor();g=this._source.type==="raster-array"?new Am(o,st,this.transform.tileZoom,nt,this._isRaster):new mp(o,st,this.transform.tileZoom,nt,this._isRaster,this._source.worldview),this._loadTile(g,this._tileLoaded.bind(this,g,o.key,g.state))}return g.uses++,this._tiles[o.key]=g,_e||this._source.fire(new h.z("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g}_setTileReloadTimer(o,g){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const _e=g.getExpiryTimeout();_e&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},_e))}_removeTile(o){const g=this._tiles[o];g&&(g.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),g.uses>0||(g.hasData()&&g.state!=="reloading"||g.state==="empty"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,g,_e){const nt=[],st=this.transform;if(!st)return nt;const lt=st.projection.name==="globe",ut=h.aF(st.center.lng);for(const pt in this._tiles){const yt=this._tiles[pt];if(_e&&yt.clearQueryDebugViz(),yt.holdingForFade())continue;let vt;if(lt){const Mt=yt.tileID.canonical;if(Mt.z===0){const Et=[Math.abs(h.aA(ut,...Jp(Mt,-1))-ut),Math.abs(h.aA(ut,...Jp(Mt,1))-ut)];vt=[0,2*Et.indexOf(Math.min(...Et))-1]}else{const Et=[Math.abs(h.aA(ut,...Jp(Mt,-1))-ut),Math.abs(h.aA(ut,...Jp(Mt,0))-ut),Math.abs(h.aA(ut,...Jp(Mt,1))-ut)];vt=[Et.indexOf(Math.min(...Et))-1]}}else vt=[0];for(const Mt of vt){const Et=o.containsTile(yt,st,g,Mt);Et&&nt.push(Et)}}return nt}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,g){const _e=this.getRenderableIds(o,g).map(st=>this._tiles[st].tileID),nt=this.transform.projection.name==="globe";for(const st of _e)st.projMatrix=this.transform.calculateProjMatrix(st.toUnwrapped()),st.expandedProjMatrix=nt?this.transform.calculateProjMatrix(st.toUnwrapped(),!1,!0):st.projMatrix;return _e}sortCoordinatesByDistance(o){const g=o.slice(),_e=this.transform._camera.position,nt=this.transform._camera.forward(),st={};for(const lt of g){const ut=1/(1<<lt.canonical.z);st[lt.key]=((lt.canonical.x+.5)*ut+lt.wrap-_e[0])*nt[0]+((lt.canonical.y+.5)*ut-_e[1])*nt[1]-_e[2]*nt[2]}return g.sort((lt,ut)=>st[lt.key]-st[ut.key]),g}hasTransition(){if(this._source.hasTransition())return!0;if(ry(this._source.type))for(const o in this._tiles){const g=this._tiles[o];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=h.o.now())return!0}return!1}setFeatureState(o,g,_e){this._state.updateState(o=o||"_geojsonTileLayer",g,_e)}removeFeatureState(o,g,_e){this._state.removeFeatureState(o=o||"_geojsonTileLayer",g,_e)}getFeatureState(o,g){return this._state.getState(o=o||"_geojsonTileLayer",g)}setDependencies(o,g,_e){const nt=this._tiles[o];nt&&nt.setDependencies(g,_e)}reloadTilesForDependencies(o,g){for(const _e in this._tiles)this._tiles[_e].hasDependency(o,g)&&this._reloadTile(+_e,"reloading");this._cache.filter(_e=>!_e.hasDependency(o,g))}_preloadTiles(o,g){if(!this._sourceLoaded){const pt=()=>{this._sourceLoaded&&(this._source.off("data",pt),this._preloadTiles(o,g))};return void this._source.on("data",pt)}const _e=new Map,nt=Array.isArray(o)?o:[o],st=this.map.painter.terrain,lt=this.usedForTerrain&&st?st.getScaledDemTileSize():this._source.tileSize;for(const pt of nt){const yt=pt.coveringTiles({tileSize:lt,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const vt of yt)_e.set(vt.key,vt);this.usedForTerrain&&pt.updateElevation(!1)}const ut=Array.from(_e.values());h.bw(ut,(pt,yt)=>{const vt=new mp(pt,this._source.tileSize*pt.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(vt,Mt=>{this._source.type==="raster-dem"&&vt.dem&&this._backfillDEM(vt),yt(Mt,vt)})},g)}}function Pp(et,o){const g=Math.abs(2*et.wrap)-+(et.wrap<0),_e=Math.abs(2*o.wrap)-+(o.wrap<0);return et.overscaledZ-o.overscaledZ||_e-g||o.canonical.y-et.canonical.y||o.canonical.x-et.canonical.x}function ry(et){return et==="raster"||et==="image"||et==="video"||et==="custom"}function Jp(et,o){const g=1<<et.z;return[et.x/g+o,(et.x+1)/g+o]}ou.maxOverzooming=10,ou.maxUnderzooming=3;class ny{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const o=!1,g=!1;for(const _e in this.style._mergedLayers){const nt=this.style._mergedLayers[_e];if(nt.type==="fill-extrusion"||nt.type==="building")this.layers.push({layer:nt,visible:o,visibilityChanged:g});else if(nt.type==="model"){const st=this.style.getLayerSource(nt);st&&st.type==="batched-model"&&this.layers.push({layer:nt,visible:o,visibilityChanged:g})}}}onNewFrame(o){this.layersGotHidden=!1;for(const g of this.layers){const _e=g.layer;let nt=!1;_e.type==="fill-extrusion"?nt=!_e.isHidden(o)&&_e.paint.get("fill-extrusion-opacity")>0:_e.type==="building"?nt=!_e.isHidden(o)&&_e.paint.get("building-opacity")>0:_e.type==="model"&&(nt=!_e.isHidden(o)&&_e.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!nt&&g.visible,g.visible=nt}}updateZOffset(o,g){this.currentBuildingBuckets=[];for(const nt of this.layers){const st=nt.layer,lt=this.style.getLayerSourceCache(st);let ut=1;st.type==="fill-extrusion"?ut=nt.visible?st.paint.get("fill-extrusion-vertical-scale"):0:st.type==="building"&&(ut=nt.visible?st.paint.get("building-vertical-scale"):0);let pt=lt?lt.getTile(g):null;if(!pt&&lt)for(const yt in lt._tiles){const vt=lt._tiles[yt];if(g.canonical.isChildOf(vt.tileID.canonical)){pt=vt;break}}this.currentBuildingBuckets.push({bucket:pt?pt.getBucket(st):null,tileID:pt?pt.tileID:g,verticalScale:ut})}o.hasAnyZOffset=!1;let _e=!1;for(let nt=0;nt<o.symbolInstances.length;nt++){const st=o.symbolInstances.get(nt),lt=st.zOffset,ut=this._getHeightAtTileOffset(g,st.tileAnchorX,st.tileAnchorY);st.zOffset=ut!==Number.NEGATIVE_INFINITY?ut:lt,_e||lt===st.zOffset||(_e=!0),o.hasAnyZOffset||st.zOffset===0||(o.hasAnyZOffset=!0)}_e&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,g,_e,nt){let st=g,lt=_e;if(o.canonical.z!==nt.canonical.z){const ut=nt.canonical,pt=1/(1<<o.canonical.z-ut.z);st=(g+o.canonical.x*h.al)*pt-ut.x*h.al|0,lt=(_e+o.canonical.y*h.al)*pt-ut.y*h.al|0}return{tileX:st,tileY:lt}}_getHeightAtTileOffset(o,g,_e){let nt,st;for(let lt=0;lt<this.layers.length;++lt){const ut=this.layers[lt].layer;if(ut.type!=="fill-extrusion"&&ut.type!=="building")continue;const{bucket:pt,tileID:yt,verticalScale:vt}=this.currentBuildingBuckets[lt];if(!pt)continue;const{tileX:Mt,tileY:Et}=this._mapCoordToOverlappingTile(o,g,_e,yt),Lt=pt.getHeightAtTileCoord(Mt,Et);Lt&&Lt.height!==void 0&&(Lt.hidden?nt=Lt.height:st=Math.max(Lt.height*vt,st||0))}if(st!==void 0)return st;for(let lt=0;lt<this.layers.length;++lt){const ut=this.layers[lt];if(ut.layer.type!=="model"||!ut.visible)continue;const{bucket:pt,tileID:yt}=this.currentBuildingBuckets[lt];if(!pt)continue;const{tileX:vt,tileY:Mt}=this._mapCoordToOverlappingTile(o,g,_e,yt),Et=pt.getHeightAtTileCoord(vt,Mt);if(Et&&!Et.hidden)return Et.height===void 0&&nt!==void 0?Math.min(Et.maxHeight,nt)*Et.verticalScale:Et.height?Et.height*Et.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Zy(et,o){const g={};for(const _e in et)_e!=="ref"&&(g[_e]=et[_e]);return h.bx.forEach(_e=>{_e in o&&(g[_e]=o[_e])}),g}function _f(et){et=et.slice();const o=Object.create(null);for(let g=0;g<et.length;g++)o[et[g].id]=et[g];for(let g=0;g<et.length;g++)"ref"in et[g]&&(et[g]=Zy(et[g],o[et[g].ref]));return et}const Ns={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Ip(et,o,g){g.push({command:Ns.addSource,args:[et,o[et]]})}function em(et,o,g){o.push({command:Ns.removeSource,args:[et]}),g[et]=!0}function Tu(et,o,g,_e){em(et,g,_e),Ip(et,o,g)}function sy(et,o,g){let _e;for(_e in et[g])if(et[g].hasOwnProperty(_e)&&_e!=="data"&&!h.by(et[g][_e],o[g][_e]))return!1;for(_e in o[g])if(o[g].hasOwnProperty(_e)&&_e!=="data"&&!h.by(et[g][_e],o[g][_e]))return!1;return!0}function gp(et,o,g,_e,nt,st){let lt;for(lt in o=o||{},et=et||{})et.hasOwnProperty(lt)&&(h.by(et[lt],o[lt])||g.push({command:st,args:[_e,lt,o[lt],nt]}));for(lt in o)o.hasOwnProperty(lt)&&!et.hasOwnProperty(lt)&&(h.by(et[lt],o[lt])||g.push({command:st,args:[_e,lt,o[lt],nt]}))}function Mp(et){return et.id}function tm(et,o){return et[o.id]=o,et}function im(et,o,g){const _e=o.createTileMatrix(et,et.worldSize,g.toUnwrapped());return h.aB(new Float32Array(16),et.projMatrix,_e)}function oy(et,o,g){if(o.projection.name===g.projection.name)return et.projMatrix;const _e=g.clone();return _e.setProjection(o.projection),im(_e,o.getProjection(),et)}function Su(et,o,g){return o.name===g.projection.name?et.projMatrix:im(g,o,et)}class Xy{constructor(o,g){this.reset(o,g)}reset(o,g){this.points=o||[],this._distances=[0];for(let _e=1;_e<this.points.length;_e++)this._distances[_e]=this._distances[_e-1]+this.points[_e].dist(this.points[_e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(g||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=h.aA(o,0,1);let g=1,_e=this._distances[g];const nt=o*this.paddedLength+this.padding;for(;_e<nt&&g<this._distances.length;)_e=this._distances[++g];const st=g-1,lt=this._distances[st],ut=_e-lt,pt=ut>0?(nt-lt)/ut:0;return this.points[st].mult(1-pt).add(this.points[g].mult(pt))}}class Pm{constructor(o,g,_e){const nt=this.boxCells=[],st=this.circleCells=[];this.xCellCount=Math.ceil(o/_e),this.yCellCount=Math.ceil(g/_e);for(let lt=0;lt<this.xCellCount*this.yCellCount;lt++)nt.push([]),st.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=g,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/g,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,g,_e,nt,st){this._forEachCell(g,_e,nt,st,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(g),this.bboxes.push(_e),this.bboxes.push(nt),this.bboxes.push(st)}insertCircle(o,g,_e,nt){this._forEachCell(g-nt,_e-nt,g+nt,_e+nt,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(g),this.circles.push(_e),this.circles.push(nt)}_insertBoxCell(o,g,_e,nt,st,lt){this.boxCells[st].push(lt)}_insertCircleCell(o,g,_e,nt,st,lt){this.circleCells[st].push(lt)}_query(o,g,_e,nt,st,lt){if(_e<0||o>this.width||nt<0||g>this.height)return!st&&[];const ut=[];if(o<=0&&g<=0&&this.width<=_e&&this.height<=nt){if(st)return!0;for(let pt=0;pt<this.boxKeys.length;pt++)ut.push({key:this.boxKeys[pt],x1:this.bboxes[4*pt],y1:this.bboxes[4*pt+1],x2:this.bboxes[4*pt+2],y2:this.bboxes[4*pt+3]});for(let pt=0;pt<this.circleKeys.length;pt++){const yt=this.circles[3*pt],vt=this.circles[3*pt+1],Mt=this.circles[3*pt+2];ut.push({key:this.circleKeys[pt],x1:yt-Mt,y1:vt-Mt,x2:yt+Mt,y2:vt+Mt})}return lt?ut.filter(lt):ut}return this._forEachCell(o,g,_e,nt,this._queryCell,ut,{hitTest:st,seenUids:{box:{},circle:{}}},lt),st?ut.length>0:ut}_queryCircle(o,g,_e,nt,st){const lt=o-_e,ut=o+_e,pt=g-_e,yt=g+_e;if(ut<0||lt>this.width||yt<0||pt>this.height)return!nt&&[];const vt=[];return this._forEachCell(lt,pt,ut,yt,this._queryCellCircle,vt,{hitTest:nt,circle:{x:o,y:g,radius:_e},seenUids:{box:{},circle:{}}},st),nt?vt.length>0:vt}query(o,g,_e,nt,st){return this._query(o,g,_e,nt,!1,st)}hitTest(o,g,_e,nt,st){return this._query(o,g,_e,nt,!0,st)}hitTestCircle(o,g,_e,nt){return this._queryCircle(o,g,_e,!0,nt)}_queryCell(o,g,_e,nt,st,lt,ut,pt){const yt=ut.seenUids,vt=this.boxCells[st];if(vt!==null){const Et=this.bboxes;for(const Lt of vt)if(!yt.box[Lt]){yt.box[Lt]=!0;const Ft=4*Lt;if(o<=Et[Ft+2]&&g<=Et[Ft+3]&&_e>=Et[Ft+0]&&nt>=Et[Ft+1]&&(!pt||pt(this.boxKeys[Lt]))){if(ut.hitTest)return lt.push(!0),!0;lt.push({key:this.boxKeys[Lt],x1:Et[Ft],y1:Et[Ft+1],x2:Et[Ft+2],y2:Et[Ft+3]})}}}const Mt=this.circleCells[st];if(Mt!==null){const Et=this.circles;for(const Lt of Mt)if(!yt.circle[Lt]){yt.circle[Lt]=!0;const Ft=3*Lt;if(this._circleAndRectCollide(Et[Ft],Et[Ft+1],Et[Ft+2],o,g,_e,nt)&&(!pt||pt(this.circleKeys[Lt]))){if(ut.hitTest)return lt.push(!0),!0;{const Ot=Et[Ft],qt=Et[Ft+1],$t=Et[Ft+2];lt.push({key:this.circleKeys[Lt],x1:Ot-$t,y1:qt-$t,x2:Ot+$t,y2:qt+$t})}}}}}_queryCellCircle(o,g,_e,nt,st,lt,ut,pt){const yt=ut.circle,vt=ut.seenUids,Mt=this.boxCells[st];if(Mt!==null){const Lt=this.bboxes;for(const Ft of Mt)if(!vt.box[Ft]){vt.box[Ft]=!0;const Ot=4*Ft;if(this._circleAndRectCollide(yt.x,yt.y,yt.radius,Lt[Ot+0],Lt[Ot+1],Lt[Ot+2],Lt[Ot+3])&&(!pt||pt(this.boxKeys[Ft])))return lt.push(!0),!0}}const Et=this.circleCells[st];if(Et!==null){const Lt=this.circles;for(const Ft of Et)if(!vt.circle[Ft]){vt.circle[Ft]=!0;const Ot=3*Ft;if(this._circlesCollide(Lt[Ot],Lt[Ot+1],Lt[Ot+2],yt.x,yt.y,yt.radius)&&(!pt||pt(this.circleKeys[Ft])))return lt.push(!0),!0}}}_forEachCell(o,g,_e,nt,st,lt,ut,pt){const yt=this._convertToXCellCoord(o),vt=this._convertToYCellCoord(g),Mt=this._convertToXCellCoord(_e),Et=this._convertToYCellCoord(nt);for(let Lt=yt;Lt<=Mt;Lt++)for(let Ft=vt;Ft<=Et;Ft++)if(st.call(this,o,g,_e,nt,this.xCellCount*Ft+Lt,lt,ut,pt))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,g,_e,nt,st,lt){const ut=nt-o,pt=st-g,yt=_e+lt;return yt*yt>ut*ut+pt*pt}_circleAndRectCollide(o,g,_e,nt,st,lt,ut){const pt=(lt-nt)/2,yt=Math.abs(o-(nt+pt));if(yt>pt+_e)return!1;const vt=(ut-st)/2,Mt=Math.abs(g-(st+vt));if(Mt>vt+_e)return!1;if(yt<=pt||Mt<=vt)return!0;const Et=yt-pt,Lt=Mt-vt;return Et*Et+Lt*Lt<=_e*_e}}const rm={unknown:0,flipRequired:1,flipNotRequired:2},ay=Math.tan(85*Math.PI/180);function au(et,o,g,_e,nt,st,lt){const ut=h.bC();if(g)if(st.name==="globe"){const pt=h.bD(nt,o);h.aB(ut,ut,pt)}else{const pt=h.bE([],lt);ut[0]=pt[0],ut[1]=pt[1],ut[4]=pt[2],ut[5]=pt[3],_e||h.bB(ut,ut,nt.angle)}else h.aB(ut,nt.labelPlaneMatrix,et);return ut}function nm(et,o,g,_e,nt,st,lt){const ut=au(et,o,g,_e,nt,st,lt);return st.name==="globe"&&g||(ut[2]=ut[6]=ut[10]=ut[14]=0),ut}function Im(et,o,g,_e,nt,st,lt){if(g){if(st.name==="globe"){const ut=au(et,o,g,_e,nt,st,lt);return h.bl(ut,ut),h.aB(ut,et,ut),ut}{const ut=h.bz(et),pt=h.bA([]);return pt[0]=lt[0],pt[1]=lt[1],pt[4]=lt[2],pt[5]=lt[3],h.aB(ut,ut,pt),_e||h.bB(ut,ut,-nt.angle),ut}}return nt.glCoordMatrix}function _u(et,o,g,_e){const nt=[et,o,g,1];g?h.aC(nt,nt,_e):Yy(nt,nt,_e);const st=nt[3];return nt[0]/=st,nt[1]/=st,nt[2]/=st,nt}function kp(et,o){return Math.min(.5+et/o*.5,1.5)}function Jl(et,o){const g=et[0]/et[3],_e=et[1]/et[3];return g>=-o[0]&&g<=o[0]&&_e>=-o[1]&&_e<=o[1]}function ly(et,o,g,_e,nt,st,lt,ut,pt,yt){const vt=g.transform,Mt=_e?et.textSizeData:et.iconSizeData,Et=h.bK(Mt,g.transform.zoom),Lt=vt.projection.name==="globe",Ft=[256/g.width*2+1,256/g.height*2+1],Ot=_e?et.text.dynamicLayoutVertexArray:et.icon.dynamicLayoutVertexArray;Ot.clear();let qt=null;Lt&&(qt=_e?et.text.globeExtVertexArray:et.icon.globeExtVertexArray);const $t=et.lineVertexArray,Yt=_e?et.text.placedSymbolArray:et.icon.placedSymbolArray,tr=g.transform.width/g.transform.height;let sr,pr=!1;for(let hr=0;hr<Yt.length;hr++){const gr=Yt.get(hr),{numGlyphs:dr,writingMode:ur}=gr;if(ur!==h.bL.vertical||pr||sr===h.bL.horizontal||(pr=!0),sr=ur,(gr.hidden||ur===h.bL.vertical)&&!pr){ns(dr,Ot);continue}pr=!1;const yr=new h.P(gr.tileAnchorX,gr.tileAnchorY);let{x:Vr,y:Ir,z:Qr}=vt.projection.projectTilePoint(yr.x,yr.y,yt.canonical);if(pt){const[mn,Xn,Gn]=pt(yr);Vr+=mn,Ir+=Xn,Qr+=Gn}const Nr=[Vr,Ir,Qr,1];if(h.aC(Nr,Nr,o),!Jl(Nr,Ft)){ns(dr,Ot);continue}const Yr=Nr[3],Cn=kp(g.transform.getCameraToCenterDistance(vt.projection),Yr),Br=h.bM(Mt,Et,gr),Tr=lt?Br/Cn:Br*Cn,en=_u(Vr,Ir,Qr,nt);if(en[3]<=0){ns(dr,Ot);continue}let Hr={};const un=h.an(et.layers[0].layout.get("text-max-angle")),Tn=Math.cos(un),Ln=lt?null:pt,xn=Js(gr,Tr,!1,ut,o,nt,st,et.glyphOffsetArray,$t,Ot,qt,en,yr,Hr,tr,Ln,vt.projection,yt,lt,Tn);pr=xn.useVertical,Ln&&xn.needsFlipping&&(Hr={}),(xn.notEnoughRoom||pr||xn.needsFlipping&&Js(gr,Tr,!0,ut,o,nt,st,et.glyphOffsetArray,$t,Ot,qt,en,yr,Hr,tr,Ln,vt.projection,yt,lt,Tn).notEnoughRoom)&&ns(dr,Ot)}_e?(et.text.dynamicLayoutVertexBuffer.updateData(Ot),qt&&et.text.globeExtVertexBuffer&&et.text.globeExtVertexBuffer.updateData(qt)):(et.icon.dynamicLayoutVertexBuffer.updateData(Ot),qt&&et.icon.globeExtVertexBuffer&&et.icon.globeExtVertexBuffer.updateData(qt))}function cy(et,o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt,Et,Lt,Ft,Ot,qt){const{lineStartIndex:$t,glyphStartIndex:Yt,segment:tr}=ut,sr=Yt+ut.numGlyphs,pr=$t+ut.lineLength,hr=o.getoffsetX(Yt),gr=o.getoffsetX(sr-1),dr=sm(et*hr,g,_e,nt,st,lt,tr,$t,pr,pt,yt,vt,Mt,Et,!0,Lt,Ft,Ot,qt);if(!dr)return null;const ur=sm(et*gr,g,_e,nt,st,lt,tr,$t,pr,pt,yt,vt,Mt,Et,!0,Lt,Ft,Ot,qt);return ur?{first:dr,last:ur}:null}function uy(et,o,g,_e){return et===h.bL.horizontal&&Math.abs(_e)>Math.abs(g)?{useVertical:!0}:et===h.bL.vertical?_e>0?{needsFlipping:!0}:null:o!==rm.unknown&&function(nt,st){return nt===0||Math.abs(st/nt)>ay}(g,_e)?o===rm.flipRequired?{needsFlipping:!0}:null:g<0?{needsFlipping:!0}:null}function Js(et,o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt,Et,Lt,Ft,Ot,qt,$t,Yt,tr){const sr=o/24,pr=et.lineOffsetX*sr,hr=et.lineOffsetY*sr,{lineStartIndex:gr,glyphStartIndex:dr,numGlyphs:ur,segment:yr,writingMode:Vr,flipState:Ir}=et,Qr=gr+et.lineLength,Nr=Yr=>{if(vt){const[en,Hr,un]=Yr.up,Tn=yt.length;h.bN(vt,Tn+0,en,Hr,un),h.bN(vt,Tn+1,en,Hr,un),h.bN(vt,Tn+2,en,Hr,un),h.bN(vt,Tn+3,en,Hr,un)}const[Cn,Br,Tr]=Yr.point;h.bO(yt,Cn,Br,Tr,Yr.angle)};if(ur>1){const Yr=cy(sr,ut,pr,hr,g,Mt,Et,et,pt,st,Lt,Ot,!1,qt,$t,Yt,tr);if(!Yr)return{notEnoughRoom:!0};if(_e&&!g){let[Cn,Br,Tr]=Yr.first.point,[en,Hr,un]=Yr.last.point;[Cn,Br]=_u(Cn,Br,Tr,lt),[en,Hr]=_u(en,Hr,un,lt);const Tn=uy(Vr,Ir,(en-Cn)*Ft,Hr-Br);if(et.flipState=Tn&&Tn.needsFlipping?rm.flipRequired:rm.flipNotRequired,Tn)return Tn}Nr(Yr.first);for(let Cn=dr+1;Cn<dr+ur-1;Cn++){const Br=sm(sr*ut.getoffsetX(Cn),pr,hr,g,Mt,Et,yr,gr,Qr,pt,st,Lt,Ot,!1,!1,qt,$t,Yt,tr);if(!Br)return yt.length-=4*(Cn-dr),{notEnoughRoom:!0};Nr(Br)}Nr(Yr.last)}else{if(_e&&!g){const Cn=_u(Et.x,Et.y,0,nt),Br=gr+yr+1,Tr=new h.P(pt.getx(Br),pt.gety(Br)),en=_u(Tr.x,Tr.y,0,nt),Hr=en[3]>0?en:hy(Et,Tr,Cn,1,nt,void 0,qt,$t.canonical),un=uy(Vr,Ir,(Hr[0]-Cn[0])*Ft,Hr[1]-Cn[1]);if(et.flipState=un&&un.needsFlipping?rm.flipRequired:rm.flipNotRequired,un)return un}const Yr=sm(sr*ut.getoffsetX(dr),pr,hr,g,Mt,Et,yr,gr,Qr,pt,st,Lt,Ot,!1,!1,qt,$t,Yt,tr);if(!Yr)return{notEnoughRoom:!0};Nr(Yr)}return{}}function Ky(et,o,g,_e,nt){const{x:st,y:lt,z:ut}=_e.projectTilePoint(et.x,et.y,o);if(!nt)return _u(st,lt,ut,g);const[pt,yt,vt]=nt(et);return _u(st+pt,lt+yt,ut+vt,g)}function hy(et,o,g,_e,nt,st,lt,ut){const pt=Ky(et.sub(o)._unit()._add(et),ut,nt,lt,st);return h.av(pt,g,pt),h.aw(pt,pt),h.bH(pt,g,pt,_e)}function sm(et,o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt,Et,Lt,Ft,Ot,qt,$t,Yt){const tr=_e?et-o:et+o;let sr=tr>0?1:-1,pr=0;_e&&(sr*=-1,pr=Math.PI),sr<0&&(pr+=Math.PI);let hr=ut+lt+(sr>0?0:1)|0,gr=nt,dr=nt,ur=0,yr=0;const Vr=Math.abs(tr),Ir=[],Qr=[];let Nr=st,Yr=Nr,Cn=h.bF([]);const Br=()=>hy(Yr,Nr,dr,Vr-ur+1,vt,Et,Ot,qt.canonical);for(;ur+yr<=Vr;){if(hr+=sr,hr<ut||hr>=pt)return null;if(dr=gr,Yr=Nr,Ir.push(dr),Lt&&Qr.push(Yr),Nr=new h.P(yt.getx(hr),yt.gety(hr)),gr=Mt[hr],!gr){const Gn=Ky(Nr,qt.canonical,vt,Ot,Et);gr=Gn[3]>0?Mt[hr]=Gn:Br()}ur+=yr;const mn=h.av([],gr,dr),Xn=h.bG(dr,gr);if(g&&Xn>0&&yr>0&&h.bJ(Cn,mn)/(yr*Xn)<Yt)return null;yr=Xn,Cn=mn}Ft&&Et&&(Mt[hr]&&(gr=Br(),yr=h.bG(dr,gr),Cn=h.av([],gr,dr)),Mt[hr]=gr);const Tr=(Vr-ur)/yr,en=Nr.sub(Yr)._mult(Tr)._add(Yr),Hr=h.bH([],dr,Cn,Tr);let un=[0,0,1],Tn=Cn[0],Ln=Cn[1];if($t&&(un=Ot.upVector(qt.canonical,en.x,en.y),un[0]!==0||un[1]!==0||un[2]!==1)){const mn=[un[2],0,-un[0]],Xn=h.bI([],un,mn);h.aw(mn,mn),h.aw(Xn,Xn),Tn=h.bJ(Cn,mn),Ln=h.bJ(Cn,Xn)}if(g){const mn=h.bI([],un,Cn);h.aw(mn,mn),h.bH(Hr,Hr,mn,g*sr)}const xn=pr+Math.atan2(Ln,Tn);return Ir.push(Hr),Lt&&Qr.push(en),{point:Hr,angle:xn,path:Ir,tilePath:Qr,up:un}}function ns(et,o){const g=o.length,_e=g+4*et;o.resize(_e),o.float32.fill(-1/0,4*g,4*_e)}function Yy(et,o,g){const _e=o[0],nt=o[1];return et[0]=g[0]*_e+g[4]*nt+g[12],et[1]=g[1]*_e+g[5]*nt+g[13],et[3]=g[3]*_e+g[7]*nt+g[15],et}const xu=100;class Lu{constructor(o,g,_e=new Pm(o.width+200,o.height+200,25),nt=new Pm(o.width+200,o.height+200,25)){this.transform=o,this.grid=_e,this.ignoredGrid=nt,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+xu,this.screenBottomBoundary=o.height+xu,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=g}placeCollisionBox(o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt){let Et=_e.projectedAnchorX,Lt=_e.projectedAnchorY,Ft=_e.projectedAnchorZ;const Ot=_e.tileAnchorX,qt=_e.tileAnchorY,$t=_e.elevation,Yt=_e.tileID,tr=o.getProjection();if($t&&Yt){const[Qr,Nr,Yr]=tr.upVector(Yt.canonical,_e.tileAnchorX,_e.tileAnchorY),Cn=tr.upVectorScale(Yt.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Et+=Qr*$t*Cn,Lt+=Nr*$t*Cn,Ft+=Yr*$t*Cn}const sr=o.projection.name==="globe",pr=o.projection.name==="globe"?h.aj(this.transform.zoom):0;if(Yt&&sr&&pr<1&&!lt){const Qr=1<<Yt.canonical.z,Nr=h.bP(Ot,qt);h.bQ(Nr,Nr,1/h.al),h.bR(Nr,Nr,h.bP(Yt.canonical.x,Yt.canonical.y)),h.bQ(Nr,Nr,1/Qr),h.bS(Nr,Nr,h.bP(nt[0],nt[1])),Nr[0]=h.bT(Nr[0],-.5,.5),h.bQ(Nr,Nr,h.al);const Yr=h.bU(Nr[0],Nr[1],h.al/(2*Math.PI),1);h.aC(Yr,Yr,st),Et=h.ak(Et,Yr[0],pr),Lt=h.ak(Lt,Yr[1],pr),Ft=h.ak(Ft,Yr[2],pr)}const hr=this.projectAndGetPerspectiveRatio(vt,Et,Lt,Ft,_e.tileID,tr.name==="globe"||!!$t||this.transform.pitch>0,tr),gr=yt*hr.perspectiveRatio,dr=(_e.x1*g+ut.x-_e.padding)*gr+hr.point.x,ur=(_e.y1*g+ut.y-_e.padding)*gr+hr.point.y,yr=(_e.x2*g+ut.x+_e.padding)*gr+hr.point.x,Vr=(_e.y2*g+ut.y+_e.padding)*gr+hr.point.y,Ir=hr.perspectiveRatio<=.55||hr.occluded;return!this.isInsideGrid(dr,ur,yr,Vr)||!pt&&this.grid.hitTest(dr,ur,yr,Vr,Mt)||Ir?{box:[],offscreen:!1,occluded:hr.occluded}:{box:[dr,ur,yr,Vr],offscreen:this.isOffscreen(dr,ur,yr,Vr),occluded:!1}}placeCollisionCircles(o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt,Et,Lt,Ft,Ot){const qt=[],$t=this.transform.elevation,Yt=o.getProjection(),tr=$t?$t.getAtTileOffsetFunc(Ot,this.transform.center.lat,this.transform.worldSize,Yt):null,sr=new h.P(_e.tileAnchorX,_e.tileAnchorY);let{x:pr,y:hr,z:gr}=Yt.projectTilePoint(sr.x,sr.y,Ot.canonical);if(tr){const[un,Tn,Ln]=tr(sr);pr+=un,hr+=Tn,gr+=Ln}const dr=Yt.name==="globe",ur=this.projectAndGetPerspectiveRatio(ut,pr,hr,gr,Ot,dr||!!$t||this.transform.pitch>0,Yt),{perspectiveRatio:yr}=ur,Vr=(Mt?lt/yr:lt*yr)/h.bX,Ir=_u(pr,hr,gr,pt),Qr=_e.lineOffsetX*Vr,Nr=_e.lineOffsetY*Vr,Yr=h.an(o.layers[0].layout.get("text-max-angle")),Cn=Math.cos(Yr),Br=ur.signedDistanceFromCamera>0?cy(Vr,st,Qr,Nr,!1,Ir,sr,_e,nt,pt,{},$t&&!Mt?tr:null,Mt&&!!$t,Yt,Ot,Mt,Cn):null;let Tr=!1,en=!1,Hr=!0;if(Br&&!ur.occluded){const un=.5*Lt*yr+Ft,Tn=new h.P(-100,-100),Ln=new h.P(this.screenRightBoundary,this.screenBottomBoundary),xn=new Xy,{first:mn,last:Xn}=Br,Gn=mn.path.length;let Wn=[];for(let vs=Gn-1;vs>=1;vs--)Wn.push(mn.path[vs]);for(let vs=1;vs<Xn.path.length;vs++)Wn.push(Xn.path[vs]);const Un=2.5*un;yt&&(Wn=Wn.map(([vs,Ts,no],fs)=>(tr&&!dr&&(no=tr(fs<Gn-1?mn.tilePath[Gn-1-fs]:Xn.tilePath[fs-Gn+2])[2]),_u(vs,Ts,no,yt))),Wn.some(vs=>vs[3]<=0)&&(Wn=[]));let hs=[];if(Wn.length>0){let vs=1/0,Ts=-1/0,no=1/0,fs=-1/0;for(const qs of Wn)vs=Math.min(vs,qs[0]),no=Math.min(no,qs[1]),Ts=Math.max(Ts,qs[0]),fs=Math.max(fs,qs[1]);Ts>=Tn.x&&vs<=Ln.x&&fs>=Tn.y&&no<=Ln.y&&(hs=[Wn.map(qs=>new h.P(qs[0],qs[1]))],(vs<Tn.x||Ts>Ln.x||no<Tn.y||fs>Ln.y)&&(hs=h.bV(hs,Tn.x,Tn.y,Ln.x,Ln.y)))}for(const vs of hs){xn.reset(vs,.25*un);let Ts=0;Ts=xn.length<=.5*un?1:Math.ceil(xn.paddedLength/Un)+1;for(let no=0;no<Ts;no++){const fs=no/Math.max(Ts-1,1),qs=xn.lerp(fs),io=qs.x+xu,Ao=qs.y+xu;qt.push(io,Ao,un,0);const bs=io-un,Qs=Ao-un,Xs=io+un,to=Ao+un;if(Hr=Hr&&this.isOffscreen(bs,Qs,Xs,to),en=en||this.isInsideGrid(bs,Qs,Xs,to),!g&&this.grid.hitTestCircle(io,Ao,un,Et)&&(Tr=!0,!vt))return{circles:[],offscreen:!1,collisionDetected:Tr,occluded:!1}}}}return{circles:!vt&&Tr||!en?[]:qt,offscreen:Hr,collisionDetected:Tr,occluded:ur.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const g=[];let _e=1/0,nt=1/0,st=-1/0,lt=-1/0;for(const vt of o){const Mt=new h.P(vt.x+xu,vt.y+xu);_e=Math.min(_e,Mt.x),nt=Math.min(nt,Mt.y),st=Math.max(st,Mt.x),lt=Math.max(lt,Mt.y),g.push(Mt)}const ut=this.grid.query(_e,nt,st,lt).concat(this.ignoredGrid.query(_e,nt,st,lt)),pt={},yt={};for(const vt of ut){const Mt=vt.key;if(pt[Mt.bucketInstanceId]===void 0&&(pt[Mt.bucketInstanceId]={}),pt[Mt.bucketInstanceId][Mt.featureIndex])continue;const Et=[new h.P(vt.x1,vt.y1),new h.P(vt.x2,vt.y1),new h.P(vt.x2,vt.y2),new h.P(vt.x1,vt.y2)];h.bW(g,Et)&&(pt[Mt.bucketInstanceId][Mt.featureIndex]=!0,yt[Mt.bucketInstanceId]===void 0&&(yt[Mt.bucketInstanceId]=[]),yt[Mt.bucketInstanceId].push(Mt.featureIndex))}return yt}insertCollisionBox(o,g,_e,nt,st){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:_e,featureIndex:nt,collisionGroupID:st},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,g,_e,nt,st){const lt=g?this.ignoredGrid:this.grid,ut={bucketInstanceId:_e,featureIndex:nt,collisionGroupID:st};for(let pt=0;pt<o.length;pt+=4)lt.insertCircle(ut,o[pt],o[pt+1],o[pt+2])}projectAndGetPerspectiveRatio(o,g,_e,nt,st,lt,ut){const pt=[g,_e,nt,1];let yt=!1;nt||this.transform.pitch>0?(h.aC(pt,pt,o),this.fogState&&st&&ut.name!=="globe"&&(yt=function(Et,Lt,Ft,Ot,qt,$t){const Yt=$t.calculateFogTileMatrix(qt),tr=[Lt,Ft,Ot];return h.af(tr,tr,Yt),rs(Et,h.ag(tr),$t.pitch,$t._fov)}(this.fogState,g,_e,nt,st.toUnwrapped(),this.transform)>.9)):Yy(pt,pt,o);const vt=pt[3];return{point:new h.P((pt[0]/vt+1)/2*this.transform.width+xu,(-pt[1]/vt+1)/2*this.transform.height+xu),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(ut)/vt*.5,1.5),signedDistanceFromCamera:vt,occluded:lt&&pt[2]>vt||yt}}isOffscreen(o,g,_e,nt){return _e<xu||o>=this.screenRightBoundary||nt<xu||g>this.screenBottomBoundary}isInsideGrid(o,g,_e,nt){return _e>=0&&o<this.gridRightBoundary&&nt>=0&&g<this.gridBottomBoundary}getViewportMatrix(){const o=h.bA([]);return h.br(o,o,[-100,-100,0]),o}}class dy{constructor(o,g,_e,nt){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?g:-g))):nt&&_e?1:0,this.placed=_e}isHidden(){return this.opacity===0&&!this.placed}}class ju{constructor(o,g,_e,nt,st,lt=!1){this.text=new dy(o?o.text:null,g,_e,st),this.icon=new dy(o?o.icon:null,g,nt,st),this.clipped=lt}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class qn{constructor(o,g,_e,nt=!1){this.text=o,this.icon=g,this.skipFade=_e,this.clipped=nt}}class eo{constructor(){this.invProjMatrix=h.bC(),this.viewportMatrix=h.bC(),this.circles=[]}}class Ys{constructor(o,g,_e,nt,st){this.bucketInstanceId=o,this.featureIndex=g,this.sourceLayerIndex=_e,this.bucketIndex=nt,this.tileID=st}}class uu{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const g=++this.maxGroupID;this.collisionGroups[o]={ID:g,predicate:_e=>_e.collisionGroupID===g}}return this.collisionGroups[o]}}function Dp(et,o,g,_e,nt){const{horizontalAlign:st,verticalAlign:lt}=h.c0(et),ut=-(st-.5)*o,pt=-(lt-.5)*g,yt=h.c1(et,_e);return new h.P(ut+yt[0]*nt,pt+yt[1]*nt)}function Zs(et,o,g,_e,nt){const st=new h.P(et,o);return g&&st._rotate(_e?nt:-nt),st}class Lp{constructor(o,g,_e,nt,st,lt){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new Lu(this.transform,st),this.buildingIndex=lt,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new uu(_e),this.collisionCircleArrays={},this.prevPlacement=nt,nt&&(nt.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,g,_e,nt,st=1){const lt=_e.getBucket(g),ut=_e.latestFeatureIndex;if(!lt||!ut||g.fqid!==lt.layerIds[0])return;const pt=lt.layers[0].layout,yt=lt.layers[0].paint,vt=_e.collisionBoxArray,Mt=Math.pow(2,this.transform.zoom-_e.tileID.overscaledZ),Et=_e.tileSize/h.al,Lt=_e.tileID.toUnwrapped();this.transform.setProjection(lt.projection);const Ft=(Ot=_e.tileID,qt=lt.getProjection(),$t=this.transform,qt.name===this.projection?$t.calculateProjMatrix(Ot.toUnwrapped()):im($t,qt,Ot));var Ot,qt,$t;const Yt=pt.get("text-pitch-alignment")==="map",tr=pt.get("text-rotation-alignment")==="map";g.compileFilter(g.options);const sr=g.dynamicFilter(),pr=g.dynamicFilterNeedsFeature(),hr=this.transform.calculatePixelsToTileUnitsMatrix(_e),gr=nm(Ft,_e.tileID.canonical,Yt,tr,this.transform,lt.getProjection(),hr);let dr=null;const ur=lt.getProjection().createInversionMatrix(this.transform,_e.tileID.canonical);if(Yt){const Tr=Im(Ft,_e.tileID.canonical,Yt,tr,this.transform,lt.getProjection(),hr);dr=h.aB([],this.transform.labelPlaneMatrix,Tr)}let yr=null;sr&&_e.latestFeatureIndex&&(yr={unwrappedTileID:Lt,dynamicFilter:sr,dynamicFilterNeedsFeature:pr}),this.retainedQueryData[lt.bucketInstanceId]=new Ys(lt.bucketInstanceId,ut,lt.sourceLayerIndex,lt.index,_e.tileID);const[Vr,Ir]=lt.layers[0].layout.get("text-size-scale-range"),Qr=h.aA(st,Vr,Ir),[Nr,Yr]=pt.get("icon-size-scale-range"),Cn=h.aA(st,Nr,Yr),Br={bucket:lt,layout:pt,paint:yt,posMatrix:Ft,invMatrix:ur,mercatorCenter:[h.aF(this.transform.center.lng),h.aJ(this.transform.center.lat)],textLabelPlaneMatrix:gr,labelToScreenMatrix:dr,clippingData:yr,scale:Mt,textPixelRatio:Et,holdingForFade:_e.holdingForFade(),collisionBoxArray:vt,partiallyEvaluatedTextSize:h.bK(lt.textSizeData,this.transform.zoom,Qr),partiallyEvaluatedIconSize:h.bK(lt.iconSizeData,this.transform.zoom,Cn),collisionGroup:this.collisionGroups.get(lt.sourceID),latestFeatureIndex:_e.latestFeatureIndex};if(nt)for(const Tr of lt.sortKeyRanges){const{sortKey:en,symbolInstanceStart:Hr,symbolInstanceEnd:un}=Tr;o.push({sortKey:en,symbolInstanceStart:Hr,symbolInstanceEnd:un,parameters:Br})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:lt.symbolInstances.length,parameters:Br})}attemptAnchorPlacement(o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt,Et,Lt,Ft,Ot,qt,$t,Yt,tr,sr,pr){const{textOffset0:hr,textOffset1:gr,crossTileID:dr}=Ot,ur=[hr,gr],yr=Dp(o,lt,ut,ur,pt),Vr=this.collisionIndex.placeCollisionBox($t,pt,g,_e,nt,st,Zs(yr.x,yr.y,yt,vt,this.transform.angle),Ft,Mt,Et,Lt.predicate);if(tr){const Ir=$t.getSymbolInstanceIconSize(pr,this.transform.zoom,Ot.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox($t,Ir,tr,_e,nt,st,Zs(yr.x,yr.y,yt,vt,this.transform.angle),Ft,Mt,Et,Lt.predicate).box.length===0)return}if(Vr.box.length>0){let Ir;return this.prevPlacement&&this.prevPlacement.variableOffsets[dr]&&this.prevPlacement.placements[dr]&&this.prevPlacement.placements[dr].text&&(Ir=this.prevPlacement.variableOffsets[dr].anchor),this.variableOffsets[dr]={textOffset:ur,width:lt,height:ut,anchor:o,textScale:pt,prevAnchor:Ir},this.markUsedJustification($t,o,Ot,Yt),$t.allowVerticalPlacement&&(this.markUsedOrientation($t,Yt,Ot),this.placedOrientations[dr]=Yt),{shift:yr,placedGlyphBoxes:Vr}}}placeLayerBucketPart(o,g,_e,nt,st=1){const{bucket:lt,layout:ut,paint:pt,posMatrix:yt,textLabelPlaneMatrix:vt,labelToScreenMatrix:Mt,clippingData:Et,textPixelRatio:Lt,mercatorCenter:Ft,invMatrix:Ot,holdingForFade:qt,collisionBoxArray:$t,partiallyEvaluatedTextSize:Yt,partiallyEvaluatedIconSize:tr,collisionGroup:sr,latestFeatureIndex:pr}=o.parameters,hr=ut.get("text-optional"),gr=ut.get("icon-optional"),dr=ut.get("text-allow-overlap"),ur=ut.get("icon-allow-overlap"),yr=ut.get("text-rotation-alignment")==="map",Vr=ut.get("icon-rotation-alignment")==="map",Ir=ut.get("text-pitch-alignment")==="map",Qr=pt.get("symbol-z-offset"),Nr=ut.get("symbol-elevation-reference")==="sea",Yr=ut.get("symbol-placement"),[Cn,Br]=ut.get("text-size-scale-range"),[Tr,en]=ut.get("icon-size-scale-range"),Hr=h.aA(st,Cn,Br),un=h.aA(st,Tr,en),Tn=ut.get("text-variable-anchor"),Ln=yr&&Yr!=="point",xn=Vr&&Yr!=="point",mn=Tn&&lt.hasTextData(),Xn=lt.hasIconTextFit()&&mn&&lt.hasIconData();this.transform.setProjection(lt.projection);const Gn=mn||Ln,Wn=xn||Xn;let Un=dr&&(ur||!lt.hasIconData()||gr),hs=ur&&(dr||!lt.hasTextData()||hr);const vs=!Qr.isConstant();!lt.collisionArrays&&$t&&lt.deserializeCollisionBoxes($t),_e&&nt&&lt.updateCollisionDebugBuffers(this.transform.zoom,$t,Hr,un);const Ts=(fs,qs,io)=>{const{crossTileID:Ao,numVerticalGlyphVertices:bs}=fs;let Qs=null;if(Et&&Et.dynamicFilterNeedsFeature||vs){const Zo=this.retainedQueryData[lt.bucketInstanceId];Qs=pr.loadFeature({featureIndex:fs.featureIndex,bucketIndex:Zo.bucketIndex,sourceLayerIndex:Zo.sourceLayerIndex,layoutVertexArrayOffset:0})}if(Et&&!(0,Et.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Qs,this.retainedQueryData[lt.bucketInstanceId].tileID.canonical,new h.P(fs.tileAnchorX,fs.tileAnchorY),this.transform.calculateDistanceTileData(Et.unwrappedTileID)))return this.placements[Ao]=new qn(!1,!1,!1,!0),void g.add(Ao);const Xs=Qr.evaluate(Qs,{});if(g.has(Ao))return;if(qt)return void(this.placements[Ao]=new qn(!1,!1,!1));let to=!1,ko=!1,Ko=!0,zl=!1,Do=!1,Ss=null,cs={box:null,offscreen:null,occluded:null},so={box:null},Ho=null,Fo=null,yl=null,Wl=0,Bu=0,Vu=0;io.textFeatureIndex?Wl=io.textFeatureIndex:fs.useRuntimeCollisionCircles&&(Wl=fs.featureIndex),io.verticalTextFeatureIndex&&(Bu=io.verticalTextFeatureIndex);const Au=Zo=>{Zo.tileID=this.retainedQueryData[lt.bucketInstanceId].tileID;const Yo=this.transform.elevation;Zo.elevation=Nr?Xs:Xs+(Yo?Yo.getAtTileOffset(Zo.tileID,Zo.tileAnchorX,Zo.tileAnchorY):0),Zo.elevation+=fs.zOffset},Ru=io.textBox;if(Ru){Au(Ru);const Zo=Oo=>{let Cl=h.bL.horizontal;if(lt.allowVerticalPlacement&&!Oo&&this.prevPlacement){const Nl=this.prevPlacement.placedOrientations[Ao];Nl&&(this.placedOrientations[Ao]=Nl,Cl=Nl,this.markUsedOrientation(lt,Cl,fs))}return Cl},Yo=(Oo,Cl)=>{if(lt.allowVerticalPlacement&&bs>0&&io.verticalTextBox){for(const Nl of lt.writingModes)if(Nl===h.bL.vertical?(cs=Cl(),so=cs):cs=Oo(),cs&&cs.box&&cs.box.length)break}else cs=Oo()};if(Tn){let Oo=Tn;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ao]){const $a=this.prevPlacement.variableOffsets[Ao];Oo.indexOf($a.anchor)>0&&(Oo=Oo.filter(tu=>tu!==$a.anchor),Oo.unshift($a.anchor))}const Cl=($a,tu,Ep)=>{const Np=lt.getSymbolInstanceTextSize(Yt,fs,this.transform.zoom,qs),up=($a.x2-$a.x1)*Np+2*$a.padding,vm=($a.y2-$a.y1)*Np+2*$a.padding,bm=fs.hasIconTextFit&&!ur?tu:null;bm&&Au(bm);let Tp={box:[],offscreen:!1,occluded:!1};const zy=dr?2*Oo.length:Oo.length;for(let Bp=0;Bp<zy;++Bp){const Sp=this.attemptAnchorPlacement(Oo[Bp%Oo.length],$a,Ft,Ot,Gn,up,vm,Np,yr,Ir,Lt,yt,sr,Bp>=Oo.length,fs,qs,lt,Ep,bm,Yt,tr);if(Sp&&(Tp=Sp.placedGlyphBoxes,Tp&&Tp.box&&Tp.box.length)){to=!0,Ss=Sp.shift;break}}return Tp};Yo(()=>Cl(Ru,io.iconBox,h.bL.horizontal),()=>{const $a=io.verticalTextBox;return $a&&Au($a),lt.allowVerticalPlacement&&!(cs&&cs.box&&cs.box.length)&&bs>0&&$a?Cl($a,io.verticalIconBox,h.bL.vertical):{box:null,offscreen:null,occluded:null}}),cs&&(to=cs.box,Ko=cs.offscreen,zl=cs.occluded);const Nl=Zo(!(!cs||!cs.box));if(!to&&this.prevPlacement){const $a=this.prevPlacement.variableOffsets[Ao];$a&&(this.variableOffsets[Ao]=$a,this.markUsedJustification(lt,$a.anchor,fs,Nl))}}else{const Oo=(Cl,Nl)=>{const $a=lt.getSymbolInstanceTextSize(Yt,fs,this.transform.zoom,qs),tu=this.collisionIndex.placeCollisionBox(lt,$a,Cl,Ft,Ot,Gn,new h.P(0,0),dr,Lt,yt,sr.predicate);return tu&&tu.box&&tu.box.length&&(this.markUsedOrientation(lt,Nl,fs),this.placedOrientations[Ao]=Nl),tu};Yo(()=>Oo(Ru,h.bL.horizontal),()=>{const Cl=io.verticalTextBox;return lt.allowVerticalPlacement&&bs>0&&Cl?(Au(Cl),Oo(Cl,h.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Zo(!!(cs&&cs.box&&cs.box.length))}}if(Ho=cs,to=Ho&&Ho.box&&Ho.box.length>0,Ko=Ho&&Ho.offscreen,zl=Ho&&Ho.occluded,fs.useRuntimeCollisionCircles){const Zo=lt.text.placedSymbolArray.get(fs.centerJustifiedTextSymbolIndex>=0?fs.centerJustifiedTextSymbolIndex:fs.verticalPlacedTextSymbolIndex),Yo=h.bM(lt.textSizeData,Yt,Zo),Oo=ut.get("text-padding");Fo=this.collisionIndex.placeCollisionCircles(lt,dr,Zo,lt.lineVertexArray,lt.glyphOffsetArray,Yo,yt,vt,Mt,_e,Ir,sr.predicate,fs.collisionCircleDiameter*Yo/h.bX,Oo,this.retainedQueryData[lt.bucketInstanceId].tileID),to=dr||Fo.circles.length>0&&!Fo.collisionDetected,Ko=Ko&&Fo.offscreen,zl=Fo.occluded}if(io.iconFeatureIndex&&(Vu=io.iconFeatureIndex),io.iconBox){const Zo=Yo=>{Au(Yo);const Oo=fs.hasIconTextFit&&Ss?Zs(Ss.x,Ss.y,yr,Ir,this.transform.angle):new h.P(0,0),Cl=lt.getSymbolInstanceIconSize(tr,this.transform.zoom,fs.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(lt,Cl,Yo,Ft,Ot,Wn,Oo,ur,Lt,yt,sr.predicate)};so&&so.box&&so.box.length&&io.verticalIconBox?(yl=Zo(io.verticalIconBox),ko=yl.box.length>0):(yl=Zo(io.iconBox),ko=yl.box.length>0),Ko=Ko&&yl.offscreen,Do=yl.occluded}const du=hr||fs.numHorizontalGlyphVertices===0&&bs===0,Ju=gr||fs.numIconVertices===0;if(du||Ju?Ju?du||(ko=ko&&to):to=ko&&to:ko=to=ko&&to,to&&Ho&&Ho.box&&this.collisionIndex.insertCollisionBox(Ho.box,ut.get("text-ignore-placement"),lt.bucketInstanceId,so&&so.box&&Bu?Bu:Wl,sr.ID),ko&&yl&&this.collisionIndex.insertCollisionBox(yl.box,ut.get("icon-ignore-placement"),lt.bucketInstanceId,Vu,sr.ID),Fo&&(to&&this.collisionIndex.insertCollisionCircles(Fo.circles,ut.get("text-ignore-placement"),lt.bucketInstanceId,Wl,sr.ID),_e)){const Zo=lt.bucketInstanceId;let Yo=this.collisionCircleArrays[Zo];Yo===void 0&&(Yo=this.collisionCircleArrays[Zo]=new eo);for(let Oo=0;Oo<Fo.circles.length;Oo+=4)Yo.circles.push(Fo.circles[Oo+0]),Yo.circles.push(Fo.circles[Oo+1]),Yo.circles.push(Fo.circles[Oo+2]),Yo.circles.push(Fo.collisionDetected?1:0)}const cp=lt.projection.name!=="globe";Un=Un&&(cp||!zl),hs=hs&&(cp||!Do),this.placements[Ao]=new qn(to||Un,ko||hs,Ko||lt.justReloaded),g.add(Ao)},no=this.retainedQueryData[lt.bucketInstanceId].tileID;if(lt.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(lt,no),lt.elevationType==="road"&&lt.updateRoadElevation(no.canonical),lt.updateZOffset(),lt.sortFeaturesByY){const fs=lt.getSortedSymbolIndexes(this.transform.angle);for(let qs=fs.length-1;qs>=0;--qs){const io=fs[qs];Ts(lt.symbolInstances.get(io),io,lt.collisionArrays[io])}lt.hasAnyZOffset&&h.w(`${lt.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(lt.hasAnyZOffset){const fs=lt.getSortedIndexesByZOffset();for(let qs=0;qs<fs.length;++qs){const io=fs[qs];Ts(lt.symbolInstances.get(io),io,lt.collisionArrays[io])}}else for(let fs=o.symbolInstanceStart;fs<o.symbolInstanceEnd;fs++)Ts(lt.symbolInstances.get(fs),fs,lt.collisionArrays[fs]);if(_e&&lt.bucketInstanceId in this.collisionCircleArrays){const fs=this.collisionCircleArrays[lt.bucketInstanceId];h.bl(fs.invProjMatrix,yt),fs.viewportMatrix=this.collisionIndex.getViewportMatrix()}lt.justReloaded=!1}markUsedJustification(o,g,_e,nt){const{leftJustifiedTextSymbolIndex:st,centerJustifiedTextSymbolIndex:lt,rightJustifiedTextSymbolIndex:ut,verticalPlacedTextSymbolIndex:pt,crossTileID:yt}=_e,vt=h.c2(g),Mt=nt===h.bL.vertical?pt:vt==="left"?st:vt==="center"?lt:vt==="right"?ut:-1;st>=0&&(o.text.placedSymbolArray.get(st).crossTileID=Mt>=0&&st!==Mt?0:yt),lt>=0&&(o.text.placedSymbolArray.get(lt).crossTileID=Mt>=0&&lt!==Mt?0:yt),ut>=0&&(o.text.placedSymbolArray.get(ut).crossTileID=Mt>=0&&ut!==Mt?0:yt),pt>=0&&(o.text.placedSymbolArray.get(pt).crossTileID=Mt>=0&&pt!==Mt?0:yt)}markUsedOrientation(o,g,_e){const nt=g===h.bL.horizontal||g===h.bL.horizontalOnly?g:0,st=g===h.bL.vertical?g:0,{leftJustifiedTextSymbolIndex:lt,centerJustifiedTextSymbolIndex:ut,rightJustifiedTextSymbolIndex:pt,verticalPlacedTextSymbolIndex:yt}=_e,vt=o.text.placedSymbolArray;lt>=0&&(vt.get(lt).placedOrientation=nt),ut>=0&&(vt.get(ut).placedOrientation=nt),pt>=0&&(vt.get(pt).placedOrientation=nt),yt>=0&&(vt.get(yt).placedOrientation=st)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const g=this.prevPlacement;let _e=!1;this.prevZoomAdjustment=g?g.zoomAdjustment(this.transform.zoom):0;const nt=g?g.symbolFadeChange(o):1,st=g?g.opacities:{},lt=g?g.variableOffsets:{},ut=g?g.placedOrientations:{};for(const pt in this.placements){const yt=this.placements[pt],vt=st[pt];vt?(this.opacities[pt]=new ju(vt,nt,yt.text,yt.icon,null,yt.clipped),_e=_e||yt.text!==vt.text.placed||yt.icon!==vt.icon.placed):(this.opacities[pt]=new ju(null,nt,yt.text,yt.icon,yt.skipFade,yt.clipped),_e=_e||yt.text||yt.icon)}for(const pt in st){const yt=st[pt];if(!this.opacities[pt]){const vt=new ju(yt,nt,!1,!1);vt.isHidden()||(this.opacities[pt]=vt,_e=_e||yt.text.placed||yt.icon.placed)}}for(const pt in lt)this.variableOffsets[pt]||!this.opacities[pt]||this.opacities[pt].isHidden()||(this.variableOffsets[pt]=lt[pt]);for(const pt in ut)this.placedOrientations[pt]||!this.opacities[pt]||this.opacities[pt].isHidden()||(this.placedOrientations[pt]=ut[pt]);_e?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=g?g.lastPlacementChangeTime:o)}updateLayerOpacities(o,g,_e,nt){const st=new Set;for(const lt of g){const ut=lt.getBucket(o);ut&&lt.latestFeatureIndex&&o.fqid===ut.layerIds[0]&&(this.updateBucketOpacities(ut,st,lt,lt.collisionBoxArray,_e,nt,lt.tileID,o.scope),ut.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(ut,lt.tileID),ut.elevationType==="road"&&ut.updateRoadElevation(lt.tileID.canonical),ut.updateZOffset())}}updateBucketOpacities(o,g,_e,nt,st,lt,ut,pt){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const yt=o.layers[0].layout,vt=o.layers[0].paint,Mt=!!o.layers[0].dynamicFilter(),Et=new ju(null,0,!1,!1,!0),Lt=yt.get("text-allow-overlap"),Ft=yt.get("icon-allow-overlap"),Ot=yt.get("text-variable-anchor"),qt=yt.get("text-rotation-alignment")==="map",$t=yt.get("text-pitch-alignment")==="map",Yt=vt.get("symbol-z-offset"),tr=yt.get("symbol-elevation-reference")==="sea",sr=!Yt.isConstant(),pr=new ju(null,0,Lt&&(Ft||!o.hasIconData()||yt.get("icon-optional")),Ft&&(Lt||!o.hasTextData()||yt.get("text-optional")),!0);!o.collisionArrays&&nt&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(nt);const hr=(dr,ur,yr)=>{for(let Vr=0;Vr<ur/4;Vr++)dr.opacityVertexArray.emplaceBack(yr)};let gr=0;lt&&o.updateReplacement(ut,lt);for(let dr=0;dr<o.symbolInstances.length;dr++){const ur=o.symbolInstances.get(dr),{numHorizontalGlyphVertices:yr,numVerticalGlyphVertices:Vr,crossTileID:Ir,numIconVertices:Qr,tileAnchorX:Nr,tileAnchorY:Yr}=ur;let Cn=null;const Br=this.retainedQueryData[o.bucketInstanceId];sr&&ur&&Br&&(Cn=_e.latestFeatureIndex.loadFeature({featureIndex:ur.featureIndex,bucketIndex:Br.bucketIndex,sourceLayerIndex:Br.sourceLayerIndex,layoutVertexArrayOffset:0}));const Tr=Yt.evaluate(Cn,{}),en=g.has(Ir);let Hr=this.opacities[Ir];en?Hr=Et:Hr||(Hr=pr,this.opacities[Ir]=Hr),g.add(Ir);const un=yr>0||Vr>0,Tn=Qr>0,Ln=this.placedOrientations[Ir],xn=Ln===h.bL.vertical,mn=Ln===h.bL.horizontal||Ln===h.bL.horizontalOnly;!un&&!Tn||Hr.isHidden()||gr++;let Xn=!1;if((un||Tn)&&lt)for(const Gn of o.activeReplacements){if(h.bY(Gn,st,h.bZ.Symbol,pt)||Gn.min.x>Nr||Nr>Gn.max.x||Gn.min.y>Yr||Yr>Gn.max.y)continue;const Wn=h.b_(Nr,Yr,ut.canonical,Gn.footprintTileId.canonical);if(Xn=h.b$(Wn,Gn.footprint),Xn)break}if(un){const Gn=Xn?Mr:cr(Hr.text);hr(o.text,yr,xn?Mr:Gn),hr(o.text,Vr,mn?Mr:Gn);const Wn=Hr.text.isHidden(),{leftJustifiedTextSymbolIndex:Un,centerJustifiedTextSymbolIndex:hs,rightJustifiedTextSymbolIndex:vs,verticalPlacedTextSymbolIndex:Ts}=ur,no=o.text.placedSymbolArray,fs=Wn||xn?1:0;Un>=0&&(no.get(Un).hidden=fs),hs>=0&&(no.get(hs).hidden=fs),vs>=0&&(no.get(vs).hidden=fs),Ts>=0&&(no.get(Ts).hidden=Wn||mn?1:0);const qs=this.variableOffsets[Ir];qs&&this.markUsedJustification(o,qs.anchor,ur,Ln);const io=this.placedOrientations[Ir];io&&(this.markUsedJustification(o,"left",ur,io),this.markUsedOrientation(o,io,ur))}if(Tn){const Gn=Xn?Mr:cr(Hr.icon),{placedIconSymbolIndex:Wn,verticalPlacedIconSymbolIndex:Un}=ur,hs=o.icon.placedSymbolArray,vs=Hr.icon.isHidden()?1:0;Wn>=0&&(hr(o.icon,Qr,xn?Mr:Gn),hs.get(Wn).hidden=vs),Un>=0&&(hr(o.icon,ur.numVerticalIconVertices,mn?Mr:Gn),hs.get(Un).hidden=vs)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Gn=o.collisionArrays[dr];if(Gn){let Wn=new h.P(0,0),Un=!0;if(Gn.textBox||Gn.verticalTextBox){if(Ot){const vs=this.variableOffsets[Ir];vs?(Wn=Dp(vs.anchor,vs.width,vs.height,vs.textOffset,vs.textScale),qt&&Wn._rotate($t?this.transform.angle:-this.transform.angle)):Un=!1}Mt&&(Un=!Hr.clipped),Gn.textBox&&yp(o.textCollisionBox.collisionVertexArray,Hr.text.placed,!Un||xn,Tr,tr,Wn.x,Wn.y),Gn.verticalTextBox&&yp(o.textCollisionBox.collisionVertexArray,Hr.text.placed,!Un||mn,Tr,tr,Wn.x,Wn.y)}const hs=Un&&!!(!mn&&Gn.verticalIconBox);Gn.iconBox&&yp(o.iconCollisionBox.collisionVertexArray,Hr.icon.placed,hs,Tr,tr,ur.hasIconTextFit?Wn.x:0,ur.hasIconTextFit?Wn.y:0),Gn.verticalIconBox&&yp(o.iconCollisionBox.collisionVertexArray,Hr.icon.placed,!hs,Tr,tr,ur.hasIconTextFit?Wn.x:0,ur.hasIconTextFit?Wn.y:0)}}}if(o.fullyClipped=gr===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const dr=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=dr.invProjMatrix,o.placementViewportMatrix=dr.viewportMatrix,o.collisionCircleArray=dr.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,g){const _e=this.zoomAtLastRecencyCheck===g?1-this.zoomAdjustment(g):1;return this.zoomAtLastRecencyCheck=g,this.commitTime+this.fadeDuration*_e>o}setStale(){this.stale=!0}}function yp(et,o,g,_e,nt,st,lt){et.emplaceBack(o?1:0,g?1:0,st||0,lt||0,_e,nt?1:0),et.emplaceBack(o?1:0,g?1:0,st||0,lt||0,_e,nt?1:0),et.emplaceBack(o?1:0,g?1:0,st||0,lt||0,_e,nt?1:0),et.emplaceBack(o?1:0,g?1:0,st||0,lt||0,_e,nt?1:0)}const Mm=Math.pow(2,25),Kl=Math.pow(2,24),xa=Math.pow(2,17),I_=Math.pow(2,16),wt=Math.pow(2,9),Nt=Math.pow(2,8),Zt=Math.pow(2,1);function cr(et){if(et.opacity===0&&!et.placed)return 0;if(et.opacity===1&&et.placed)return 4294967295;const o=et.placed?1:0,g=Math.floor(127*et.opacity);return g*Mm+o*Kl+g*xa+o*I_+g*wt+o*Nt+g*Zt+o}const Mr=0;class zr{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,g,_e,nt,st,lt){const ut=this._bucketParts;for(;this._currentTileIndex<o.length;)if(g.getBucketParts(ut,nt,o[this._currentTileIndex],this._sortAcrossTiles,lt),this._currentTileIndex++,st())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,ut.sort((pt,yt)=>pt.sortKey-yt.sortKey));this._currentPartIndex<ut.length;){const pt=ut[this._currentPartIndex];if(g.placeLayerBucketPart(pt,this._seenCrossTileIDs,_e,pt.symbolInstanceStart===0,lt),this._currentPartIndex++,st())return!0}return!1}}class Dr{constructor(o,g,_e,nt,st,lt,ut,pt,yt){this.placement=new Lp(o,st,lt,ut,pt,yt),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=_e,this._showCollisionBoxes=nt,this._done=!1}isDone(){return this._done}continuePlacement(o,g,_e,nt,st){const lt=h.o.now(),ut=()=>{const pt=h.o.now()-lt;return!this._forceFullPlacement&&pt>2};for(;this._currentPlacementIndex>=0;){const pt=g[o[this._currentPlacementIndex]],yt=this.placement.collisionIndex.transform.zoom;if(pt.type==="symbol"&&(!pt.minzoom||pt.minzoom<=yt)&&(!pt.maxzoom||pt.maxzoom>yt)){const vt=pt,Mt=vt.layout.get("symbol-z-elevate"),Et=vt.layout.get("symbol-sort-key").constantOr(1)!==void 0,Lt=vt.layout.get("symbol-z-order"),Ft=Lt==="viewport-y"||Lt==="auto"&&!(Lt!=="viewport-y"&&Et),Ot=vt.layout.get("text-allow-overlap")||vt.layout.get("icon-allow-overlap")||vt.layout.get("text-ignore-placement")||vt.layout.get("icon-ignore-placement"),qt=Ft&&Ot,$t=this._inProgressLayer=this._inProgressLayer||new zr(vt),Yt=h.B(pt.source,pt.scope);if($t.continuePlacement(Mt||qt?nt[Yt]:_e[Yt],this.placement,this._showCollisionBoxes,pt,ut,st))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Jr=512/h.al/2;class bn{constructor(o,g,_e){this.tileID=o,this.bucketInstanceId=_e,this.index=new h.c3(g.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const nt=o.canonical.x*h.al,st=o.canonical.y*h.al;for(let lt=0;lt<g.length;lt++){const{key:ut,crossTileID:pt,tileAnchorX:yt,tileAnchorY:vt}=g.get(lt),Mt=Math.floor((nt+yt)*Jr),Et=Math.floor((st+vt)*Jr);this.index.add(Mt,Et),this.keys.push(ut),this.crossTileIDs.push(pt)}this.index.finish()}findMatches(o,g,_e){const nt=this.tileID.canonical.z<g.canonical.z?1:Math.pow(2,this.tileID.canonical.z-g.canonical.z),st=Jr/Math.pow(2,g.canonical.z-this.tileID.canonical.z),lt=g.canonical.x*h.al,ut=g.canonical.y*h.al;for(let pt=0;pt<o.length;pt++){const yt=o.get(pt);if(yt.crossTileID)continue;const{key:vt,tileAnchorX:Mt,tileAnchorY:Et}=yt,Lt=Math.floor((lt+Mt)*st),Ft=Math.floor((ut+Et)*st),Ot=this.index.range(Lt-nt,Ft-nt,Lt+nt,Ft+nt).sort((qt,$t)=>qt-$t);for(const qt of Ot){const $t=this.crossTileIDs[qt];if(this.keys[qt]===vt&&!_e.has($t)){_e.add($t),yt.crossTileID=$t;break}}}}}class Qn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class as{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const g=Math.round((o-this.lng)/360);if(g!==0)for(const _e in this.indexes){const nt=this.indexes[_e],st={};for(const lt in nt){const ut=nt[lt];ut.tileID=ut.tileID.unwrapTo(ut.tileID.wrap+g),st[ut.tileID.key]=ut}this.indexes[_e]=st}this.lng=o}addBucket(o,g,_e){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===g.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let st=0;st<g.symbolInstances.length;st++)g.symbolInstances.get(st).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const nt=this.usedCrossTileIDs[o.overscaledZ];for(const st in this.indexes){const lt=this.indexes[st];if(Number(st)>o.overscaledZ)for(const ut in lt){const pt=lt[ut];pt.tileID.isChildOf(o)&&pt.findMatches(g.symbolInstances,o,nt)}else{const ut=lt[o.scaledTo(Number(st)).key];ut&&ut.findMatches(g.symbolInstances,o,nt)}}for(let st=0;st<g.symbolInstances.length;st++){const lt=g.symbolInstances.get(st);lt.crossTileID||(lt.crossTileID=_e.generate(),nt.add(lt.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new bn(o,g.symbolInstances,g.bucketInstanceId),!0}removeBucketCrossTileIDs(o,g){for(const _e of g.crossTileIDs)this.usedCrossTileIDs[o].delete(_e)}removeStaleBuckets(o){let g=!1;for(const _e in this.indexes){const nt=this.indexes[_e];for(const st in nt)o[nt[st].bucketInstanceId]||(this.removeBucketCrossTileIDs(_e,nt[st]),delete nt[st],g=!0)}return g}}class _s{constructor(){this.layerIndexes={},this.crossTileIDs=new Qn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,g,_e,nt){let st=this.layerIndexes[o.fqid];st===void 0&&(st=this.layerIndexes[o.fqid]=new as);let lt=!1;const ut={};nt.name!=="globe"&&st.handleWrapJump(_e);for(const pt of g){const yt=pt.getBucket(o);yt&&o.fqid===yt.layerIds[0]&&(yt.bucketInstanceId||(yt.bucketInstanceId=++this.maxBucketInstanceId),st.addBucket(pt.tileID,yt,this.crossTileIDs)&&(lt=!0),ut[yt.bucketInstanceId]=!0)}return st.removeStaleBuckets(ut)&&(lt=!0),lt}pruneUnusedLayers(o){const g={};o.forEach(_e=>{g[_e]=!0});for(const _e in this.layerIndexes)g[_e]||delete this.layerIndexes[_e]}}const gs=771;class Pn{constructor(o,g,_e,nt){this.blendFunction=o,this.blendColor=g.toNonPremultipliedRenderColor(null),this.mask=_e,this.blendEquation=nt}}Pn.Replace=[1,0,1,0],Pn.disabled=new Pn(Pn.Replace,h.ao.transparent,[!1,!1,!1,!1]),Pn.unblended=new Pn(Pn.Replace,h.ao.transparent,[!0,!0,!0,!0]),Pn.alphaBlended=new Pn([1,gs,1,gs],h.ao.transparent,[!0,!0,!0,!0]),Pn.alphaBlendedNonPremultiplied=new Pn([770,gs,770,gs],h.ao.transparent,[!0,!0,!0,!0]),Pn.multiply=new Pn([774,0,774,0],h.ao.transparent,[!0,!0,!0,!0]);class fn{constructor(o,g,_e){this.func=o,this.mask=g,this.range=_e}}fn.ReadOnly=!1,fn.ReadWrite=!0,fn.disabled=new fn(519,fn.ReadOnly,[0,1]);const ro=7680;class Vn{constructor(o,g,_e,nt,st,lt){this.test=o,this.ref=g,this.mask=_e,this.fail=nt,this.depthFail=st,this.pass=lt}}Vn.disabled=new Vn({func:519,mask:0},0,0,ro,ro,ro);const jo=1029,Tl=2305;class ts{constructor(o,g,_e){this.enable=o,this.mode=g,this.frontFace=_e}}function _c(et,o){const g=h.c9(et,3);h.cb(et,o),h.cf(et,3,g)}function go(et,o){const g=h.c6([]);return h.c7(g,g,-o),h.c8(g,g,-et),g}function Ml(et,o){const g=[et[0],et[1],0],_e=[o[0],o[1],0];if(h.ag(g)>=1e-15){const lt=h.aw([],g);h.c4(_e,lt,h.bJ(_e,lt)),o[0]=_e[0],o[1]=_e[1]}const nt=h.bI([],o,et);if(h.c5(nt)<1e-15)return null;const st=Math.atan2(-nt[1],nt[0]);return go(Math.atan2(Math.sqrt(et[0]*et[0]+et[1]*et[1]),-et[2]),st)}ts.disabled=new ts(!1,jo,Tl),ts.backCCW=new ts(!0,jo,Tl),ts.backCW=new ts(!0,jo,2304),ts.frontCW=new ts(!0,1028,2304),ts.frontCCW=new ts(!0,1028,Tl);class Ku{constructor(o,g){this.position=o,this.orientation=g}get position(){return this._position}set position(o){if(o){const g=o instanceof h.ae?o:new h.ae(o[0],o[1],o[2]);this._renderWorldCopies&&(g.x=h.bT(g.x,0,1)),this._position=g}else this._position=null}lookAtPoint(o,g){if(this.orientation=null,!this.position)return;const _e=this.position,nt=this._elevation?this._elevation.getAtPointOrZero(h.ae.fromLngLat(o)):0,st=h.ae.fromLngLat(o,nt),lt=[st.x-_e.x,st.y-_e.y,st.z-_e.z];g||(g=[0,0,1]),g[2]=Math.abs(g[2]),this.orientation=Ml(lt,g)}setPitchBearing(o,g){this.orientation=go(h.an(o),h.an(-g))}}class py{constructor(o,g){this._transform=h.bA([]),this.orientation=g,this.position=o}get mercatorPosition(){const o=this.position;return new h.ae(o[0],o[1],o[2])}get position(){const o=h.c9(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var g;o&&h.cf(this._transform,3,[(g=o)[0],g[1],g[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||h.c6([]),o&&_c(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),g=this.right();return{bearing:Math.atan2(-g[1],g[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,g){this._orientation=go(o,g),_c(this._transform,this._orientation)}forward(){const o=h.c9(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=h.c9(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=h.c9(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,g){const _e=new Float64Array(16);return h.bl(_e,this.getWorldToCamera(o,g)),_e}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,g,_e){const nt=this.position;h.c4(nt,nt,-o);const st=new Float64Array(16);return h.bq(st,[_e,_e,_e]),h.br(st,st,nt),st[10]*=g,st}getWorldToCamera(o,g){const _e=new Float64Array(16),nt=new Float64Array(4),st=this.position;return h.ca(nt,this._orientation),h.c4(st,st,-o),h.cb(_e,nt),h.br(_e,_e,st),_e[1]*=-1,_e[5]*=-1,_e[9]*=-1,_e[13]*=-1,_e[8]*=g,_e[9]*=g,_e[10]*=g,_e[11]*=g,_e}getCameraToClipPerspective(o,g,_e,nt){const st=new Float64Array(16);return h.cc(st,o,g,_e,nt),st}getCameraToClipOrthographic(o,g,_e,nt,st,lt){const ut=new Float64Array(16);return h.cd(ut,o,g,_e,nt,st,lt),ut}getDistanceToElevation(o,g=!1){const _e=o===0?0:h.ce(o,g?h.a$(this.position[1]):this.position[1]),nt=this.forward();return(_e-this.position[2])/nt[2]}clone(){return new py([...this.position],[...this.orientation])}}const ga={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Qy{constructor(o=0,g=0,_e=0,nt=0){if(isNaN(o)||o<0||isNaN(g)||g<0||isNaN(_e)||_e<0||isNaN(nt)||nt<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=g,this.left=_e,this.right=nt}interpolate(o,g,_e){return g.top!=null&&o.top!=null&&(this.top=h.ak(o.top,g.top,_e)),g.bottom!=null&&o.bottom!=null&&(this.bottom=h.ak(o.bottom,g.bottom,_e)),g.left!=null&&o.left!=null&&(this.left=h.ak(o.left,g.left,_e)),g.right!=null&&o.right!=null&&(this.right=h.ak(o.right,g.right,_e)),this}getCenter(o,g){const _e=h.aA((this.left+o-this.right)/2,0,o),nt=h.aA((this.top+g-this.bottom)/2,0,g);return new h.P(_e,nt)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Qy(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const np=15;class eu{constructor(o,g,_e,nt,st,lt,ut){this.tileSize=512,this._renderWorldCopies=st===void 0||st,this._minZoom=o||0,this._maxZoom=g||22,this._minPitch=_e??0,this._maxPitch=nt??60,this.setProjection(lt),this.setMaxBounds(ut),this.width=0,this.height=0,this._center=new h.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Qy,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new py,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const o=new eu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<np}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,g=!1){const _e=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_e)&&this._updateCameraOnTerrain(),(o||_e)&&this._constrainCamera(g),this._calcMatrices()}getProjection(){return h.aH(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const g=this.projection?this.getProjection():void 0;this.projection=h.cl(this.projectionOptions);const _e=this.getProjection(),nt=!h.by(g,_e);return nt&&this._calcMatrices(),this.mercatorFromTransition=!1,nt}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=h.cl({name:"mercator"});const g=o!==this.projection.name;return g&&this._calcMatrices(),g}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return h.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this.width,this.height)}get bearing(){return h.bT(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const g=-o*Math.PI/180;this.angle!==g&&(this._unmodified=!1,this.angle=g,this._calcMatrices(),this.rotationMatrix=h.cm(),h.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const g=h.aA(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==g&&(this._unmodified=!1,this._pitch=g,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=h.an(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const g=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==g&&(this._unmodified=!1,this._setZoom(g),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,g=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!g||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const _e=this._elevation;g||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_e.exaggeration()&&this._centerAltitudeValidForExaggeration!==_e.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_e.exaggeration(),this._centerAltitudeValidForExaggeration=_e.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=_e.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const o=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(o)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,g=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_e=this.horizonLineFromTop();let nt=0,st=0;for(let lt=0;lt<g.length;lt++){const ut=new h.P(g[lt][0]*this.width,_e+g[lt][1]*(this.height-_e)),pt=o.pointCoordinate(ut);if(!pt)continue;const yt=1/Math.hypot(pt[0]-this._camera.position[0],pt[1]-this._camera.position[1]);nt+=pt[3]*yt,st+=yt}return st===0?NaN:nt/st}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,g=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_e=this.pixelsPerMeter/this.worldSize*g,nt=this._mercatorZfromZoom(o),st=this._mercatorZfromZoom(this._maxZoom),lt=Math.max(nt-_e,st);this._setZoom(this._zoomFromMercatorZ(lt))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const g=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let _e;_e=o.z<this._camera.position[2]?[g.x,g.y,g.z]:[o.x,o.y,o.z];const nt=h.ag(h.av([],this._camera.position,_e));return h.aA(this._zoomFromMercatorZ(nt),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let g=!1;if(o.orientation&&!h.co(o.orientation,this._camera.orientation)&&(g=this._setCameraOrientation(o.orientation)),o.position){const _e=[o.position.x,o.position.y,o.position.z];h.cp(_e,this._camera.position)||(this._setCameraPosition(_e),g=!0)}g&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,g=new Ku;return g.position=new h.ae(o[0],o[1],o[2]),g.orientation=this._camera.orientation,g._elevation=this.elevation,g._renderWorldCopies=this.renderWorldCopies,g}_setCameraOrientation(o){if(!h.cq(o))return!1;h.cr(o,o);const g=h.cs([],[0,0,-1],o),_e=h.cs([],[0,-1,0],o);if(_e[2]<0)return!1;const nt=Ml(g,_e);return!!nt&&(this._camera.orientation=nt,!0)}_setCameraPosition(o){const g=this.zoomScale(this.minZoom)*this.tileSize,_e=this.zoomScale(this.maxZoom)*this.tileSize,nt=this.cameraToCenterDistance;o[2]=h.aA(o[2],nt/_e,nt/g),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,g,_e){this._unmodified=!1,this._edgeInsets.interpolate(o,g,_e),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const g=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,g)}getVisibleUnwrappedCoordinates(o){const g=[new h.ct(0,o)];if(this.renderWorldCopies){const _e=this.pointCoordinate(new h.P(0,0)),nt=this.pointCoordinate(new h.P(this.width,0)),st=this.pointCoordinate(new h.P(this.width,this.height)),lt=this.pointCoordinate(new h.P(0,this.height)),ut=Math.floor(Math.min(_e.x,nt.x,st.x,lt.x)),pt=Math.floor(Math.max(_e.x,nt.x,st.x,lt.x)),yt=1;for(let vt=ut-yt;vt<=pt+yt;vt++)vt!==0&&g.push(new h.ct(vt,o))}return g}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,g,_e){let nt=[];const st=_e!=null,lt=!st;if(lt&&this.zoom<g||st&&_e[0]===0&&_e[1]===0)return nt;const ut=new Set,pt=(vt,Mt,Et,Lt,Ft)=>{const Ot=h.cX(Mt,vt,Et,Lt,Ft);ut.has(Ot)||(nt.push(new h.aO(vt,Mt,Et,Lt,Ft)),ut.add(Ot))};for(let vt=0;vt<o.length;vt++){const Mt=o[vt];if(lt&&Mt.canonical.z!==g)continue;const Et=Mt.canonical,Lt=Mt.overscaledZ,Ft=Mt.wrap,Ot=1<<Et.z,qt=Et.x+1<Ot,$t=Et.x>0,Yt=Et.y+1<Ot,tr=Et.y>0,sr=Mt.wrap-($t?0:1),pr=Mt.wrap+(qt?0:1),hr=$t?Et.x-1:Ot-1,gr=qt?Et.x+1:0;if(st)_e[0]<0?(pt(Lt,pr,Et.z,gr,Et.y),_e[1]<0&&Yt&&(pt(Lt,Ft,Et.z,Et.x,Et.y+1),pt(Lt,pr,Et.z,gr,Et.y+1)),_e[1]>0&&tr&&(pt(Lt,Ft,Et.z,Et.x,Et.y-1),pt(Lt,pr,Et.z,gr,Et.y-1))):_e[0]>0?(pt(Lt,sr,Et.z,hr,Et.y),_e[1]<0&&Yt&&(pt(Lt,Ft,Et.z,Et.x,Et.y+1),pt(Lt,sr,Et.z,hr,Et.y+1)),_e[1]>0&&tr&&(pt(Lt,Ft,Et.z,Et.x,Et.y-1),pt(Lt,sr,Et.z,hr,Et.y-1))):_e[1]<0&&Yt?pt(Lt,Ft,Et.z,Et.x,Et.y+1):tr&&pt(Lt,Ft,Et.z,Et.x,Et.y-1);else{const dr=Mt.visibleQuadrants;1&dr&&(pt(Lt,sr,Et.z,hr,Et.y),tr&&(pt(Lt,Ft,Et.z,Et.x,Et.y-1),pt(Lt,sr,Et.z,hr,Et.y-1))),2&dr&&(pt(Lt,pr,Et.z,gr,Et.y),tr&&(pt(Lt,Ft,Et.z,Et.x,Et.y-1),pt(Lt,pr,Et.z,gr,Et.y-1))),4&dr&&(pt(Lt,sr,Et.z,hr,Et.y),Yt&&(pt(Lt,Ft,Et.z,Et.x,Et.y+1),pt(Lt,sr,Et.z,hr,Et.y+1))),8&dr&&(pt(Lt,pr,Et.z,gr,Et.y),Yt&&(pt(Lt,Ft,Et.z,Et.x,Et.y+1),pt(Lt,pr,Et.z,gr,Et.y+1)))}}const yt=[];for(const vt of nt)nt.some(Mt=>vt.isChildOf(Mt))||yt.push(vt);if(nt=yt.filter(vt=>!o.some(Mt=>!!(vt.overscaledZ<g&&Mt.isChildOf(vt))||vt.equals(Mt)||vt.isChildOf(Mt))),lt){const vt=1<<g,Mt=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Et=[vt*Mt.x,vt*Mt.y],Lt=4,Ft=Lt*Lt;nt=nt.filter(Ot=>{const qt=Ot.canonical.x+.5-Et[0],$t=Ot.canonical.y+.5-Et[1];return qt*qt+$t*$t<Ft})}return nt}extendTileCoverToNearPlane(o,g,_e){const nt=[],st=new Set;for(const Yt of o)st.add(Yt.key);const lt=(Yt,tr,sr,pr,hr)=>{const gr=h.cX(tr,Yt,sr,pr,hr);st.has(gr)||(nt.push(new h.aO(Yt,tr,sr,pr,hr)),st.add(gr))},ut=o.reduce((Yt,tr)=>Math.max(Yt,tr.overscaledZ),_e),pt=1<<_e,yt=[new h.P(0,0),new h.P(h.al,0),new h.P(h.al,h.al),new h.P(0,h.al)],vt=new h.P(0,0),Mt=new h.P(0,0),Et=(Yt,tr)=>{const sr=Math.floor(Yt[0]),pr=Math.floor(Yt[1]),hr=(Yt[0]-sr)*h.al,gr=(Yt[1]-pr)*h.al,dr=Math.floor(tr[0]),ur=Math.floor(tr[1]),yr=(tr[0]-dr)*h.al,Vr=(tr[1]-ur)*h.al;for(let Ir=-1;Ir<=1;Ir++){const Qr=sr+Ir;if(!(Qr<0||Qr>=pt)){vt.x=hr-Ir*h.al,Mt.x=yr-(Qr-dr)*h.al;for(let Nr=-1;Nr<=1;Nr++){const Yr=pr+Nr;vt.y=gr-Nr*h.al,Mt.y=Vr-(Yr-ur)*h.al,h.cY(vt,Mt,yt)&&lt(ut,0,_e,Qr,Yr)}}}},Lt=g.points,Ft=Lt[h.cu],Ot=Lt[h.cv],qt=this._projectToGround(Ft,Lt[h.cw]),$t=this._projectToGround(Ot,Lt[h.cx]);return Et(Ft,qt),Et(Ot,$t),nt}_projectToGround(o,g){return h.cy(h.cz(),o,g,o[2]/(o[2]-g[2]))}coveringTiles(o){let g=this.coveringZoomLevel(o);const _e=g,nt=this.elevation&&this.elevation.exaggeration(),st=nt&&!o.isTerrainDEM,lt=this.projection.name==="mercator";if(o.minzoom!==void 0&&g<o.minzoom)return[];o.maxzoom!==void 0&&g>o.maxzoom&&(g=o.maxzoom);const ut=this.locationCoordinate(this.center),pt=this.center.lat,yt=1<<g,vt=[yt*ut.x,yt*ut.y,0],Mt=this.projection.name==="globe",Et=!Mt,Lt=h.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g,Et),Ft=Mt?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Ot=yt*h.ce(1,this.center.lat),qt=this._camera.position[2]/h.ce(1,this.center.lat),$t=[yt*Ft.x,yt*Ft.y,qt*(Et?1:Ot)],Yt=Mt||nt,tr=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),sr=this.isLODDisabled(!0)?g:0;let pr;if(this._elevation&&o.isTerrainDEM)pr=1e4*this._elevation.exaggeration();else if(this._elevation){const Tr=this._elevation.getMinMaxForVisibleTiles();pr=Tr?Tr.max:this._centerAltitude}else pr=this._centerAltitude;const hr=o.isTerrainDEM?-pr:this._elevation?this._elevation.getMinElevationBelowMSL():0,gr=this.projection.isReprojectedInTileSpace?h.cB(this):1,dr=Tr=>{const Hr=new h.ae(Tr.x+25e-6,Tr.y,Tr.z),un=new h.ae(Tr.x,Tr.y+25e-6,Tr.z),Tn=Tr.toLngLat(),Ln=Hr.toLngLat(),xn=un.toLngLat(),mn=this.locationCoordinate(Tn),Xn=this.locationCoordinate(Ln),Gn=this.locationCoordinate(xn),Wn=Math.hypot(Xn.x-mn.x,Xn.y-mn.y),Un=Math.hypot(Gn.x-mn.x,Gn.y-mn.y);return Math.sqrt(Wn*Un)*gr/25e-6},ur=Tr=>{const en=pr,Hr=hr;return{aabb:h.cE(this,yt,0,0,0,Tr,Hr,en,this.projection),zoom:0,x:0,y:0,minZ:Hr,maxZ:en,wrap:Tr,fullyVisible:!1}},yr=[];let Vr=[];const Ir=g,Qr=o.reparseOverscaled?_e:g,Nr=(qt-this._centerAltitude)*Ot,Yr=Tr=>{if(!this._elevation||!Tr.tileID||!lt)return;const en=this._elevation.getMinMaxForTile(Tr.tileID),Hr=Tr.aabb;en?(Hr.min[2]=en.min,Hr.max[2]=en.max,Hr.center[2]=(Hr.min[2]+Hr.max[2])/2):(Tr.shouldSplit=Br(Tr),Tr.shouldSplit||(Hr.min[2]=Hr.max[2]=Hr.center[2]=this._centerAltitude))},Cn=(Tr,en)=>{if(.707*en<Tr)return 1;const Hr=en/Tr;return Hr/(1.4144271570014144+(Math.pow(1.1,Hr-1.4144271570014144+1)-1)/(1.1-1)-1)},Br=Tr=>{if(Tr.zoom<sr)return!0;if(Tr.zoom===Ir)return!1;if(Tr.shouldSplit!=null)return Tr.shouldSplit;const en=Tr.aabb.distanceX($t),Hr=Tr.aabb.distanceY($t);let un=Nr,Tn=1;if(Mt){un=Tr.aabb.distanceZ($t);const Un=Math.pow(2,Tr.zoom),hs=h.a$((Tr.y+1)/Un),vs=h.a$(Tr.y/Un),Ts=Math.min(Math.max(pt,hs),vs),no=h.d0(Ts)/h.d0(pt);if(Tn=Ts===pt?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,no/this._mercatorScaleRatio),this.zoom<=h.cZ&&Tr.zoom===Ir-1&&no>=.9)return!0}else if(st&&(un=Tr.aabb.distanceZ($t)*Ot),this.projection.isReprojectedInTileSpace&&_e<=5){const Un=Math.pow(2,Tr.zoom),hs=dr(new h.ae((Tr.x+.5)/Un,(Tr.y+.5)/Un));Tn=hs>.85?1:hs}if(!lt){const Un=Math.sqrt(en*en+Hr*Hr+un*un);let hs=(1<<Ir-Tr.zoom)*tr*Tn;return hs*=Cn(Math.max(un,Nr),Un),Un<hs}let Ln=Number.MAX_VALUE,xn=0;const mn=Tr.aabb.getCorners(),Xn=[];for(const Un of mn){h.av(Xn,Un,$t),Mt||(st?Xn[2]*=Ot:Xn[2]=Nr);const hs=h.bJ(Xn,this._camera.forward());hs<Ln&&(Ln=hs,xn=Math.abs(Xn[2]))}let Gn=(1<<Ir-Tr.zoom)*tr*Tn;if(Gn*=Cn(Math.max(xn,Nr),Ln),Ln<Gn)return!0;const Wn=Tr.aabb.closestPoint(vt);return Wn[0]===vt[0]&&Wn[1]===vt[1]};if(this.renderWorldCopies)for(let Tr=1;Tr<=3;Tr++)yr.push(ur(-Tr)),yr.push(ur(Tr));for(yr.push(ur(0));yr.length>0;){const Tr=yr.pop(),en=Tr.x,Hr=Tr.y;let un=Tr.fullyVisible;const Tn=()=>this.projection.name==="globe"&&(Tr.y===0||Tr.y===(1<<Tr.zoom)-1);if(!un){let Ln=Yt?Tr.aabb.intersects(Lt):Tr.aabb.intersectsFlat(Lt);if(Ln===0&&Tn()){const xn=new h.cC(Tr.zoom,en,Hr);Ln=h.cD(this,yt,xn,!0).intersects(Lt)}if(Ln===0)continue;un=Ln===2}if(Tr.zoom!==Ir&&Br(Tr))for(let Ln=0;Ln<4;Ln++){const xn=(en<<1)+Ln%2,mn=(Hr<<1)+(Ln>>1),Xn={aabb:lt?Tr.aabb.quadrant(Ln):h.cE(this,yt,Tr.zoom+1,xn,mn,Tr.wrap,Tr.minZ,Tr.maxZ,this.projection),zoom:Tr.zoom+1,x:xn,y:mn,wrap:Tr.wrap,fullyVisible:un,tileID:void 0,shouldSplit:void 0,minZ:Tr.minZ,maxZ:Tr.maxZ};st&&!Mt&&(Xn.tileID=new h.aO(Tr.zoom+1===Ir?Qr:Tr.zoom+1,Tr.wrap,Tr.zoom+1,xn,mn),Yr(Xn)),yr.push(Xn)}else{const Ln=Tr.zoom===Ir?Qr:Tr.zoom;if(o.minzoom&&o.minzoom>Ln)continue;let xn=0;if(!un){let Wn=Yt?Tr.aabb.intersectsPrecise(Lt):Tr.aabb.intersectsPreciseFlat(Lt);if(Wn===0&&Tn()){const Un=new h.cC(Tr.zoom,en,Hr);Wn=h.cD(this,yt,Un,!0).intersectsPrecise(Lt)}if(Wn===0)continue;if(o.calculateQuadrantVisibility)if(Lt.containsPoint(Tr.aabb.center))xn=15;else for(let Un=0;Un<4;Un++)Tr.aabb.quadrant(Un).intersects(Lt)!==0&&(xn|=1<<Un)}const mn=vt[0]-(.5+en+(Tr.wrap<<Tr.zoom))*(1<<g-Tr.zoom),Xn=vt[1]-.5-Hr,Gn=Tr.tileID?Tr.tileID:new h.aO(Ln,Tr.wrap,Tr.zoom,en,Hr);o.calculateQuadrantVisibility&&(Gn.visibleQuadrants=xn),Vr.push({tileID:Gn,distanceSq:mn*mn+Xn*Xn})}}if(this.fogCullDistSq){const Tr=this.fogCullDistSq,en=this.horizonLineFromTop();Vr=Vr.filter(Hr=>{const un=[0,0,0,1],Tn=[h.al,h.al,0,1],Ln=this.calculateFogTileMatrix(Hr.tileID.toUnwrapped());h.aC(un,un,Ln),h.aC(Tn,Tn,Ln);const xn=h.cF([],un,Tn),mn=h.cG([],un,Tn),Xn=h.c_(xn,mn);if(Xn===0)return!0;let Gn=!1;const Wn=this._elevation;if(Wn&&Xn>Tr&&en!==0){const Un=this.calculateProjMatrix(Hr.tileID.toUnwrapped());let hs;o.isTerrainDEM||(hs=Wn.getMinMaxForTile(Hr.tileID)),hs||(hs={min:hr,max:pr});const vs=h.cH(this.rotation),Ts=[vs[0]*h.al,vs[1]*h.al,hs.max];h.af(Ts,Ts,Un),Gn=(1-Ts[1])*this.height*.5<en}return Xn<Tr||Gn})}return Vr.sort((Tr,en)=>Tr.distanceSq-en.distanceSq).map(Tr=>Tr.tileID)}resize(o,g){this.width=o,this.height=g,this.pixelsToGLUnits=[2/o,-2/g],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log2(o)}project(o){const g=h.aA(o.lat,-h.cI,h.cI),_e=this.projection.project(o.lng,g);return new h.P(_e.x*this.worldSize,_e.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/h.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,g){let _e,nt;const st=this.centerPoint;if(this.projection.name==="globe"){const ut=this.worldSize;_e=(g.x-st.x)/ut,nt=(g.y-st.y)/ut}else{const ut=this.pointCoordinate(g),pt=this.pointCoordinate(st);_e=ut.x-pt.x,nt=ut.y-pt.y}const lt=this.locationCoordinate(o);this.setLocation(new h.ae(lt.x-_e,lt.y-nt))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,g){return this.projection.locationPoint(this,o,g)}locationPoint3D(o,g){return this.projection.locationPoint(this,o,g,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,g){return this.coordinateLocation(this.pointCoordinate3D(o,g))}locationCoordinate(o,g){const _e=g?h.ce(g,o.lat):void 0,nt=this.projection.project(o.lng,o.lat);return new h.ae(nt.x,nt.y,_e)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,g){const _e=g??this._centerAltitude,nt=[o.x,o.y,0,1],st=[o.x,o.y,1,1];h.aC(nt,nt,this.pixelMatrixInverse),h.aC(st,st,this.pixelMatrixInverse);const lt=st[3];h.cJ(nt,nt,1/nt[3]),h.cJ(st,st,1/lt);const ut=nt[2],pt=st[2];return{p0:nt,p1:st,t:ut===pt?0:(_e-ut)/(pt-ut)}}screenPointToMercatorRay(o){const g=[o.x,o.y,0,1],_e=[o.x,o.y,1,1];return h.aC(g,g,this.pixelMatrixInverse),h.aC(_e,_e,this.pixelMatrixInverse),h.cJ(g,g,1/g[3]),h.cJ(_e,_e,1/_e[3]),g[2]=h.ce(g[2],this._center.lat)*this.worldSize,_e[2]=h.ce(_e[2],this._center.lat)*this.worldSize,h.cJ(g,g,1/this.worldSize),h.cJ(_e,_e,1/this.worldSize),new h.ax([g[0],g[1],g[2]],h.aw([],h.av([],_e,g)))}rayIntersectionCoordinate(o){const{p0:g,p1:_e,t:nt}=o,st=h.ce(g[2],this._center.lat),lt=h.ce(_e[2],this._center.lat);return new h.ae(h.ak(g[0],_e[0],nt)/this.worldSize,h.ak(g[1],_e[1],nt)/this.worldSize,h.ak(st,lt,nt))}pointCoordinate(o,g=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,g)}pointCoordinate3D(o,g){if(!this.elevation)return this.pointCoordinate(o,g);let _e=this.projection.pointCoordinate3D(this,o.x,o.y);if(_e)return new h.ae(_e[0],_e[1],_e[2]);let nt=0,st=this.horizonLineFromTop();if(o.y>st)return this.pointCoordinate(o,g);const lt=.02*st,ut=o.clone();for(let pt=0;pt<10&&st-nt>lt;pt++){ut.y=h.ak(nt,st,.66);const yt=this.projection.pointCoordinate3D(this,ut.x,ut.y);yt?(st=ut.y,_e=yt):nt=ut.y}return _e?new h.ae(_e[0],_e[1],_e[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=h.cK)return!this.isPointAboveHorizon(o);const g=this.pointCoordinate(o);return g.y>=0&&g.y<=1}_coordinatePoint(o,g){const _e=g&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,nt=[o.x*this.worldSize,o.y*this.worldSize,_e+o.toAltitude(),1];return h.aC(nt,nt,this.pixelMatrix),nt[3]>0?new h.P(nt[0]/nt[3],nt[1]/nt[3]):new h.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:g}=this._edgeInsets,_e=this.height-this._edgeInsets.bottom,nt=this.width-this._edgeInsets.right,st=this.pointLocation3D(new h.P(g,o)),lt=this.pointLocation3D(new h.P(nt,o)),ut=this.pointLocation3D(new h.P(nt,_e)),pt=this.pointLocation3D(new h.P(g,_e));let yt=Math.min(st.lng,lt.lng,ut.lng,pt.lng),vt=Math.max(st.lng,lt.lng,ut.lng,pt.lng),Mt=Math.min(st.lat,lt.lat,ut.lat,pt.lat),Et=Math.max(st.lat,lt.lat,ut.lat,pt.lat);const Lt=Math.pow(2,-this.zoom)/16*270,Ft=this.projection.name==="globe"?1:4,Ot=(qt,$t,Yt,tr,sr)=>{const pr=(qt+Yt)/2,hr=($t+tr)/2,gr=new h.P(pr,hr),{lng:dr,lat:ur}=this.pointLocation3D(gr),yr=Math.max(0,yt-dr,Mt-ur,dr-vt,ur-Et);yt=Math.min(yt,dr),vt=Math.max(vt,dr),Mt=Math.min(Mt,ur),Et=Math.max(Et,ur),(sr<Ft||yr>Lt)&&(Ot(qt,$t,pr,hr,sr+1),Ot(pr,hr,Yt,tr,sr+1))};if(Ot(g,o,nt,o,1),Ot(nt,o,nt,_e,1),Ot(nt,_e,g,_e,1),Ot(g,_e,g,o,1),this.projection.name==="globe"){const[qt,$t]=h.cL(this);qt?(Et=90,vt=180,yt=-180):$t&&(Mt=-90,vt=180,yt=-180)}return new h.aI(new h.aR(yt,Mt),new h.aR(vt,Et))}_getBoundsRectangular(o,g){const{top:_e,left:nt}=this._edgeInsets,st=this.height-this._edgeInsets.bottom,lt=this.width-this._edgeInsets.right,ut=new h.P(nt,_e),pt=new h.P(lt,_e),yt=new h.P(lt,st),vt=new h.P(nt,st);let Mt=this.pointCoordinate(ut,o),Et=this.pointCoordinate(pt,o);const Lt=this.pointCoordinate(yt,g),Ft=this.pointCoordinate(vt,g),Ot=(qt,$t)=>($t.y-qt.y)/($t.x-qt.x);return Mt.y>1&&Et.y>=0?Mt=new h.ae((1-Ft.y)/Ot(Ft,Mt)+Ft.x,1):Mt.y<0&&Et.y<=1&&(Mt=new h.ae(-Ft.y/Ot(Ft,Mt)+Ft.x,0)),Et.y>1&&Mt.y>=0?Et=new h.ae((1-Lt.y)/Ot(Lt,Et)+Lt.x,1):Et.y<0&&Mt.y<=1&&(Et=new h.ae(-Lt.y/Ot(Lt,Et)+Lt.x,0)),new h.aI().extend(this.coordinateLocation(Mt)).extend(this.coordinateLocation(Et)).extend(this.coordinateLocation(Ft)).extend(this.coordinateLocation(Lt))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const g=o.visibleDemTiles.reduce((_e,nt)=>{if(nt.dem){const st=nt.dem.tree;_e.min=Math.min(_e.min,st.minimums[0]),_e.max=Math.max(_e.max,st.maximums[0])}return _e},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(g.min*o.exaggeration(),g.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const g=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_e=this.height/2-g*(1-this._horizonShift);return o?Math.max(0,_e):_e}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-h.cI,this.maxLat=h.cI,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=h.aF(this.minLng)*this.tileSize,this.worldMaxX=h.aF(this.maxLng)*this.tileSize,this.worldMinY=h.aJ(this.maxLat)*this.tileSize,this.worldMaxY=h.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,g){return this.projection.createTileMatrix(this,g,o)}calculateDistanceTileData(o){const g=o.key,_e=this._distanceTileDataCache;if(_e[g])return _e[g];const nt=o.canonical,st=1/this.height,lt=this.cameraWorldSize,ut=lt/this.zoomScale(nt.z),pt=(nt.x+Math.pow(2,nt.z)*o.wrap)*ut,yt=nt.y*ut,vt=this.point;vt.x*=lt/this.worldSize,vt.y*=lt/this.worldSize;const Mt=this.angle,Et=Math.sin(-Mt),Lt=-Math.cos(-Mt);return _e[g]={bearing:[Et,Lt],center:[(vt.x-pt)*st,(vt.y-yt)*st],scale:ut/h.al*st},_e[g]}calculateFogTileMatrix(o){const g=o.key,_e=this._fogTileMatrixCache;if(_e[g])return _e[g];const nt=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return h.aB(nt,this.worldToFogMatrix,nt),_e[g]=new Float32Array(nt),_e[g]}calculateProjMatrix(o,g=!1,_e=!1){const nt=o.key;let st;if(st=_e?this._expandedProjMatrixCache:g?this._alignedProjMatrixCache:this._projMatrixCache,st[nt])return st[nt];const lt=this.calculatePosMatrix(o,this.worldSize);let ut;return ut=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_e?this.expandedFarZProjMatrix:g?this.alignedProjMatrix:this.projMatrix,h.aB(lt,ut,lt),st[nt]=new Float32Array(lt),st[nt]}calculatePixelsToTileUnitsMatrix(o){const g=o.tileID.key,_e=this._pixelsToTileUnitsCache;if(_e[g])return _e[g];const nt=h.cM(o,this);return _e[g]=nt,_e[g]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,g=h.bq([],[o,o,o]);return h.aB(g,g,this.globeMatrix),g}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const g=h.ce(1,this._center.lat)*this.worldSize,_e=this._computeCameraPosition(g),nt=this._camera.forward(),st=h.ce(1,this._center.lat);_e[2]/=st,nt[2]/=st,h.aw(nt,nt);const lt=o.raycast(_e,nt,o.exaggeration());if(lt){const ut=h.bH([],_e,nt,lt),pt=new h.ae(ut[0],ut[1],h.ce(ut[2],h.a$(ut[1]))),yt=(pt.z+h.ag([pt.x-_e[0],pt.y-_e[1],pt.z-_e[2]*st]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(yt),this._centerAltitude=pt.toAltitude(),this._center=this.coordinateLocation(pt),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const g=this._elevation,_e=h.ce(1,this._center.lat)*this.worldSize,nt=this._computeCameraPosition(_e),st=g.getAtPointOrZero(new h.ae(...nt)),lt=this.pixelsPerMeter/this.worldSize*st,ut=this._minimumHeightOverTerrain(),pt=nt[2]-lt;if(pt<=ut)if(pt<0||o){const yt=this.locationCoordinate(this._center,this._centerAltitude),vt=[nt[0],nt[1],yt.z-nt[2]],Mt=h.ag(vt);vt[2]-=(ut-pt)/this._pixelsPerMercatorPixel;const Et=h.ag(vt);if(Et===0)return;h.c4(vt,vt,Mt/Et*this._pixelsPerMercatorPixel),this._camera.position=[nt[0],nt[1],yt.z*this._pixelsPerMercatorPixel-vt[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const Et=this.center;return Et.lat=h.aA(Et.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(Et.lng=h.aA(Et.lng,this.minLng,this.maxLng)),this.center=Et,void(this._constraining=!1)}const g=this._unmodified,{x:_e,y:nt}=this.point;let st=0,lt=_e,ut=nt;const pt=this.width/2,yt=this.height/2,vt=this.worldMinY*this.scale,Mt=this.worldMaxY*this.scale;if(nt-yt<vt&&(ut=vt+yt),nt+yt>Mt&&(ut=Mt-yt),Mt-vt<this.height&&(st=Math.max(st,this.height/(Mt-vt)),ut=(Mt+vt)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Et=this.worldMinX*this.scale,Lt=this.worldMaxX*this.scale,Ft=this.worldSize/2-(Et+Lt)/2;lt=(_e+Ft+this.worldSize)%this.worldSize-Ft,lt-pt<Et&&(lt=Et+pt),lt+pt>Lt&&(lt=Lt-pt),Lt-Et<this.width&&(st=Math.max(st,this.width/(Lt-Et)),lt=(Lt+Et)/2)}lt===_e&&ut===nt||this._allowWorldUnderZoom||(this.center=this.unproject(new h.P(lt,ut))),st&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(st)),this._constrainCamera(),this._unmodified=g,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,g=this.projection.name==="globe",_e=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=h.ce(1,this.center.lat)/h.ce(1,h.d1));const nt=h.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,nt),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const st=this.projection.zAxisUnit==="meters"?_e:1,lt=this._camera.getWorldToCamera(this.worldSize,st);let ut;const pt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(pt[8]=2*-o.x/this.width,pt[9]=2*o.y/this.height,this.isOrthographic){let ur=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),yr=ur*this.aspect,Vr=-yr,Ir=-ur;yr-=o.x,Vr-=o.x,ur+=o.y,Ir+=o.y,ut=this._camera.getCameraToClipOrthographic(Vr,yr,Ir,ur,this._nearZ,this._farZ),((Qr,Nr,Yr,Cn)=>{for(let Br=0;Br<16;Br++)Qr[Br]=h.ak(Nr[Br],Yr[Br],Cn)})(ut,ut,pt,h.c$(this.pitch>=np?1:this.pitch/np))}else ut=pt;const yt=h.cO([],pt,lt);let vt=h.cO([],ut,lt);if(this.projection.isReprojectedInTileSpace){const ur=this.locationCoordinate(this.center),yr=h.bA([]);h.br(yr,yr,[ur.x*this.worldSize,ur.y*this.worldSize,0]),h.aB(yr,yr,h.cP(this)),h.br(yr,yr,[-ur.x*this.worldSize,-ur.y*this.worldSize,0]),h.aB(vt,vt,yr),h.aB(yt,yt,yr),this.inverseAdjustmentMatrix=h.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=h.cR([],vt,[this.worldSize,this.worldSize,this.worldSize/st,1]),this.projMatrix=vt,this.invProjMatrix=h.bl(new Float64Array(16),this.projMatrix),g){const ur=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ur[8]=2*-o.x/this.width,ur[9]=2*o.y/this.height,this.expandedFarZProjMatrix=h.cO([],ur,lt)}else this.expandedFarZProjMatrix=this.projMatrix;const Mt=h.bl([],ut);this.frustumCorners=h.cS.fromInvProjectionMatrix(Mt,this.horizonLineFromTop(),this.height),this.cameraFrustum=h.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!g);const Et=new Float32Array(16);h.bA(Et),h.cR(Et,Et,[1,-1,1]),h.cT(Et,Et,this._pitch),h.bB(Et,Et,this.angle);const Lt=h.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=h.bz(Lt);const Ft=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Lt[8]=2*-o.x/this.width,Lt[9]=2*(o.y+Ft)/this.height,this.skyboxMatrix=h.aB(Et,Lt,Et);const Ot=this.point,qt=Ot.x,$t=Ot.y,Yt=this.width%2/2,tr=this.height%2/2,sr=Math.cos(this.angle),pr=Math.sin(this.angle),hr=qt-Math.round(qt)+sr*Yt+pr*tr,gr=$t-Math.round($t)+sr*tr+pr*Yt,dr=new Float64Array(vt);if(h.br(dr,dr,[hr>.5?hr-1:hr,gr>.5?gr-1:gr,0]),this.alignedProjMatrix=dr,vt=h.bC(),h.cR(vt,vt,[this.width/2,-this.height/2,1]),h.br(vt,vt,[1,-1,0]),this.labelPlaneMatrix=vt,vt=h.bC(),h.cR(vt,vt,[1,-1,1]),h.br(vt,vt,[-1,-1,0]),h.cR(vt,vt,[2/this.width,2/this.height,1]),this.glCoordMatrix=vt,this.pixelMatrix=h.aB(new Float64Array(16),this.labelPlaneMatrix,yt),this._calcFogMatrices(),this._distanceTileDataCache={},vt=h.bl(new Float64Array(16),this.pixelMatrix),!vt)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=vt,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=h.cU(this);const ur=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=h.af(ur,ur,lt),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=vt;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,g=this.cameraPixelsPerMeter,_e=this._camera.position,nt=1/this.height/this._pixelsPerMercatorPixel,st=[o,o,g];h.c4(st,st,nt),h.c4(_e,_e,-1),h.cV(_e,_e,st);const lt=h.bC();h.br(lt,lt,_e),h.cR(lt,lt,st),this.mercatorFogMatrix=lt,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,g,nt)}_computeCameraPosition(o){const g=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,_e=this._camera.forward(),nt=this.point,st=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*g-o/this.worldSize*this._centerAltitude;return[nt.x/this.worldSize-_e[0]*st,nt.y/this.worldSize-_e[1]*st,o/this.worldSize*this._centerAltitude-_e[2]*st]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const g=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_e=this._camera.position[2],nt=o[2];let st=1;this.projection.wrap&&(this.center=this.center.wrap()),nt>0&&(st=Math.min((g-_e)/nt,1)),this._camera.position=h.bH([],this._camera.position,o,st),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,g=this._camera.forward(),{pitch:_e,bearing:nt}=this._camera.getPitchBearing(),st=h.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,lt=this._mercatorZfromZoom(this._maxZoom)*Math.cos(h.an(this._maxPitch)),ut=Math.max((o[2]-st)/Math.cos(_e),lt),pt=this._zoomFromMercatorZ(ut);h.bH(o,o,g,ut),this._pitch=h.aA(_e,h.an(this.minPitch),h.an(this.maxPitch)),this.angle=h.bT(nt,-Math.PI,Math.PI),this._setZoom(h.aA(pt,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new h.ae(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,o)*this.tileSize))}zoomFromMercatorZAdjusted(o){let g=0,_e=h.cK,nt=0,st=1/0;for(;_e-g>1e-6&&_e>g;){const lt=g+.5*(_e-g),ut=this.tileSize*Math.pow(2,lt),pt=this.getCameraToCenterDistance(this.projection,lt,ut),yt=this.scaleZoom(pt/(Math.max(0,o)*this.tileSize)),vt=Math.abs(lt-yt);vt<st&&(st=vt,nt=lt),lt<yt?g=lt:_e=lt}return nt}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(h.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,g){const _e=Math.min(o.x,g.x),nt=Math.max(o.x,g.x),st=Math.min(o.y,g.y),lt=Math.max(o.y,g.y);if(st<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const ut=[new h.P(_e,st),new h.P(nt,lt),new h.P(_e,lt),new h.P(nt,st)],pt=this.renderWorldCopies?-3:0,yt=this.renderWorldCopies?4:1;for(const vt of ut){const Mt=this.pointRayIntersection(vt);if(Mt.t<0)return!0;const Et=this.rayIntersectionCoordinate(Mt);if(Et.x<pt||Et.y<0||Et.x>yt||Et.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+h.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new h.P(0,0),new h.P(this.width,this.height))}zoomDeltaToMovement(o,g){const _e=h.ag(h.av([],this._camera.position,o)),nt=this._zoomFromMercatorZ(_e)+g;return _e-this._mercatorZfromZoom(nt)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([g,_e,nt],st){const lt=[g,_e,nt,1];h.aC(lt,lt,st);const ut=lt[3]=Math.max(lt[3],1e-6);return lt[0]/=ut,lt[1]/=ut,lt[2]/=ut,lt}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new h.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(0,o))}}getCameraToCenterDistance(o,g=this.zoom,_e=this.worldSize){const nt=h.cN(o,g,this.width,this.height,1024),st=o.pixelSpaceConversion(this.center.lat,_e,nt);let lt=.5/Math.tan(.5*this._fov)*this.height*st;return this.isOrthographic&&(lt=h.ak(1,lt,h.c$(this.pitch>=np?1:this.pitch/np))),lt}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&h.aB(o,o,this.globeMatrix),o}getFrustum(o){return h.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}const Fu=(et,o)=>{if(o>0&&et.terrain&&h.w("Cutoff is currently disabled on terrain"),o<=0||et.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const g=et.transform,_e=Math.max(Math.abs(g._zoom-(et.minCutoffZoom-1)),1),nt=g.isLODDisabled(!1)?h.ah(60,45,g.pitch):h.ah(30,15,g.pitch),st=g._farZ-g._nearZ,lt=o*g.height,ut=((1-(pt=nt))*g.cameraToCenterDistance+pt*(g._farZ+lt))*_e;var pt;return{shouldRenderCutoff:nt<1,uniformValues:{u_cutoff_params:[g._nearZ,g._farZ,(ut-g._nearZ)/st,(ut-lt-g._nearZ)/st]}}},Yl={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class R0{constructor(o,g){this.aabb=o,this.lastCascade=g}}class Jy{add(o,g){const _e=this.receivers[o.key];_e!==void 0?(_e.aabb.min[0]=Math.min(_e.aabb.min[0],g.min[0]),_e.aabb.min[1]=Math.min(_e.aabb.min[1],g.min[1]),_e.aabb.min[2]=Math.min(_e.aabb.min[2],g.min[2]),_e.aabb.max[0]=Math.max(_e.aabb.max[0],g.max[0]),_e.aabb.max[1]=Math.max(_e.aabb.max[1],g.max[1]),_e.aabb.max[2]=Math.max(_e.aabb.max[2],g.max[2])):this.receivers[o.key]=new R0(g,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,g,_e){const nt=h.d8.fromPoints(o.points);let st=0;for(const lt in this.receivers){const ut=this.receivers[lt];if(!ut||!nt.intersectsAabb(ut.aabb))continue;ut.aabb.min=nt.closestPoint(ut.aabb.min),ut.aabb.max=nt.closestPoint(ut.aabb.max);const pt=ut.aabb.getCorners();for(let yt=0;yt<_e.length;yt++){let vt=!0;for(const Mt of pt){const Et=[Mt[0]*g,Mt[1]*g,Mt[2]];if(h.af(Et,Et,_e[yt].matrix),Et[0]<-1||Et[0]>1||Et[1]<-1||Et[1]>1){vt=!1;break}}if(ut.lastCascade=yt,st=Math.max(st,yt),vt)break}}return st+1}}class pw{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Jy,this._depthMode=new fn(o.context.gl.LEQUAL,fn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,o.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),o.tp.registerParameter(Yl,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(Yl,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),o.tp.registerParameter(Yl,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),o.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,g){const _e=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!g||!g.properties)return;const nt=g.properties.get("shadow-intensity");if(!g.shadowsEnabled()||nt<=0||(this._shadowLayerCount=_e.style.order.reduce((Ft,Ot)=>{const qt=_e.style._mergedLayers[Ot];return Ft+(qt.hasShadowPass()&&!qt.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const st=_e.context,lt=Yl.shadowMapResolution,ut=Yl.shadowMapResolution;if(this._cascades.length===0||Yl.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Ft=0;Ft<Yl.cascadeCount;++Ft){const Ot=_e._shadowMapDebug,qt=st.gl,$t=st.createFramebuffer(lt,ut,Ot,"texture"),Yt=new h.T(st,{width:lt,height:ut,data:null},qt.DEPTH_COMPONENT16);if($t.depthAttachment.set(Yt.texture),Ot){const tr=new h.T(st,{width:lt,height:ut,data:null},qt.RGBA8);$t.colorAttachment.set(tr.texture)}this._cascades.push({framebuffer:$t,texture:Yt,matrix:[],far:0,boundingSphereRadius:0,frustum:new h.cA,scale:0})}}this.shadowDirection=fy(g);let pt=0;if(o.elevation){const Ft=o.elevation,Ot=[1e4,-1e4];Ft.visibleDemTiles.filter(qt=>qt.dem).forEach(qt=>{const $t=qt.dem.tree;Ot[0]=Math.min(Ot[0],$t.minimums[0]),Ot[1]=Math.max(Ot[1],$t.maximums[0])}),Ot[0]!==1e4&&(pt=(Ot[1]-Ot[0])*Ft.exaggeration())}const yt=1.5*o.cameraToCenterDistance,vt=3*yt,Mt=new Float64Array(16);for(let Ft=0;Ft<this._cascades.length;++Ft){const Ot=this._cascades[Ft];let qt=o.height/50,$t=1;Yl.cascadeCount===1?$t=vt:Ft===0?$t=yt:(qt=yt,$t=vt);const[Yt,tr]=fw(o,this.shadowDirection,qt,$t,Yl.shadowMapResolution,pt);Ot.scale=o.scale,Ot.matrix=Yt,Ot.boundingSphereRadius=tr,h.bl(Mt,Ot.matrix),Ot.frustum=h.cA.fromInvProjectionMatrix(Mt,1,0,!0),Ot.far=$t}const Et=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Et].far,this._cascades[Et].far],this._uniformValues.u_shadow_intensity=nt,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Yl.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Yl.shadowMapResolution,this._uniformValues.u_shadowmap_0=ga.ShadowMap0,this._uniformValues.u_shadowmap_1=ga.ShadowMap0+1,this._groundShadowTiles=_e.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Lt=_e.transform.elevation;for(const Ft of this._groundShadowTiles){let Ot={min:0,max:0};if(Lt){const qt=Lt.getMinMaxForTile(Ft);qt&&(Ot=qt)}this.addShadowReceiver(Ft.toUnwrapped(),Ot.min,Ot.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,g){if(!this.enabled)return;const _e=this.painter,nt=_e.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_e.transform.getFrustum(0),_e.transform.worldSize,this._cascades),nt.viewport.set([0,0,Yl.shadowMapResolution,Yl.shadowMapResolution]);for(let st=0;st<this._numCascadesToRender;++st){_e.currentShadowCascade=st,nt.bindFramebuffer.set(this._cascades[st].framebuffer.framebuffer),nt.clear({color:h.ao.white,depth:1});for(const lt of o.order){const ut=o._mergedLayers[lt];if(!ut.hasShadowPass()||ut.isHidden(_e.transform.zoom))continue;const pt=o.getLayerSourceCache(ut),yt=pt?g[pt.id]:void 0;(ut.type==="model"||yt&&yt.length)&&_e.renderLayer(_e,pt,ut,yt)}}_e.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const o=this.painter,g=o.style,_e=o.context,nt=_e.gl,st=g.directionalLight,lt=g.ambientLight;if(!st||!lt)return;const ut=[],pt=Fu(o,o.longestCutoffRange);pt.shouldRenderCutoff&&ut.push("RENDER_CUTOFF"),ut.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&ut.push("NORMAL_OFFSET");const yt=sp(g,st,lt),vt=new fn(nt.LEQUAL,fn.ReadOnly,o.depthRangeFor3D),Mt=new Vn({func:nt.EQUAL,mask:255},0,255,nt.KEEP,nt.KEEP,nt.KEEP);for(const Et of this._groundShadowTiles){const Lt=Et.toUnwrapped(),Ft=o.isTileAffectedByFog(Et),Ot=o.getOrCreateProgram("groundShadow",{defines:ut,overrideFog:Ft});this.setupShadows(Lt,Ot),o.uploadCommonUniforms(_e,Ot,Lt,null,pt);const qt={u_matrix:o.transform.calculateProjMatrix(Lt),u_ground_shadow_factor:yt};Ot.draw(o,nt.TRIANGLES,vt,Mt,Pn.multiply,ts.disabled,qt,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Pn.unblended:Pn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){const g=this.painter.transform,_e=g.calculatePosMatrix(o,g.worldSize);return h.aB(_e,this._cascades[this.painter.currentShadowCascade].matrix,_e),Float32Array.from(_e)}calculateShadowPassMatrixFromMatrix(o){return h.aB(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}setupShadows(o,g,_e){if(!this.enabled)return;const nt=this.painter.transform,st=this.painter.context,lt=st.gl,ut=this._uniformValues,pt=new Float64Array(16),yt=nt.calculatePosMatrix(o,nt.worldSize);for(let vt=0;vt<this._cascades.length;vt++)h.aB(pt,this._cascades[vt].matrix,yt),ut[vt===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(pt),st.activeTexture.set(lt.TEXTURE0+ga.ShadowMap0+vt),this._cascades[vt].texture.bindExtraParam(lt.LINEAR,lt.LINEAR,lt.CLAMP_TO_EDGE,lt.CLAMP_TO_EDGE,lt.GREATER);if(this.useNormalOffset=!!_e,this.useNormalOffset){const vt=h.d6(o.canonical),Mt=2/nt.tileSize*h.al/Yl.shadowMapResolution,Et=Mt*this._cascades[0].boundingSphereRadius,Lt=Mt*this._cascades[this._cascades.length-1].boundingSphereRadius,Ft=(_e==="vector-tile"?1:3)*function(Ot,qt,$t,Yt,tr){const sr=h.aA((Ot-22)/-22,0,1);return .125*(1-sr)+4*sr}(nt.zoom);ut.u_shadow_normal_offset=[vt,Et*Ft,Lt*Ft],ut.u_shadow_bias=[1e-4,.0012,.012]}else ut.u_shadow_bias=[36e-5,.0012,.012];g.setShadowUniformValues(st,ut)}setupShadowsFromMatrix(o,g,_e=!1){if(!this.enabled)return;const nt=this.painter.context,st=nt.gl,lt=this._uniformValues,ut=new Float64Array(16);for(let pt=0;pt<Yl.cascadeCount;pt++)h.aB(ut,this._cascades[pt].matrix,o),lt[pt===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(ut),nt.activeTexture.set(st.TEXTURE0+ga.ShadowMap0+pt),this._cascades[pt].texture.bindExtraParam(st.LINEAR,st.LINEAR,st.CLAMP_TO_EDGE,st.CLAMP_TO_EDGE,st.GREATER);if(this.useNormalOffset=_e,_e){const pt=Yl.normalOffset;lt.u_shadow_normal_offset=[1,pt,pt],lt.u_shadow_bias=[6e-5,.0012,.012]}else lt.u_shadow_bias=[36e-5,.0012,.012];g.setShadowUniformValues(nt,lt)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,g,_e,nt){if(nt[2]>=0)return{};const st=function(pt,yt,vt){const Mt=vt/(1<<pt.canonical.z);return new h.d8([pt.canonical.x*Mt+pt.wrap*vt,pt.canonical.y*Mt+pt.wrap*vt,0],[(pt.canonical.x+1)*Mt+pt.wrap*vt,(pt.canonical.y+1)*Mt+pt.wrap*vt,yt])}(o,g,_e).getCorners(),lt=g/-nt[2];nt[0]<0?(h.d7(st[0],st[0],[nt[0]*lt,0,0]),h.d7(st[3],st[3],[nt[0]*lt,0,0])):nt[0]>0&&(h.d7(st[1],st[1],[nt[0]*lt,0,0]),h.d7(st[2],st[2],[nt[0]*lt,0,0])),nt[1]<0?(h.d7(st[0],st[0],[0,nt[1]*lt,0]),h.d7(st[1],st[1],[0,nt[1]*lt,0])):nt[1]>0&&(h.d7(st[2],st[2],[0,nt[1]*lt,0]),h.d7(st[3],st[3],[0,nt[1]*lt,0]));const ut={};return ut.vertices=st,ut.planes=[M_(st[1],st[0],st[4]),M_(st[2],st[1],st[5]),M_(st[3],st[2],st[6]),M_(st[0],st[3],st[7])],ut}addShadowReceiver(o,g,_e){this._receivers.add(o,h.d8.fromTileIdAndHeight(o,g,_e))}getMaxCascadeForTile(o){const g=this._receivers.get(o);return g&&g.lastCascade?g.lastCascade:0}}function M_(et,o,g){const _e=h.av([],g,o),nt=h.av([],et,o),st=h.bI([],_e,nt),lt=h.ag(st);return lt===0?[0,0,1,0]:(h.c4(st,st,1/lt),[st[0],st[1],st[2],-h.bJ(st,o)])}function fy(et){const o=et.properties.get("direction"),g=h.d3(o.x,o.y,o.z);g[2]=h.aA(g[2],0,75);const _e=h.d5([g[0],g[1],g[2]]);return h.d4(_e.x,_e.y,_e.z)}function sp(et,o,g){const _e=o.properties.get("color-use-theme")==="none",nt=o.properties.get("color"),st=o.properties.get("intensity"),lt=o.properties.get("direction"),ut=[lt.x,lt.y,lt.z],pt=g.properties.get("color-use-theme")==="none",yt=g.properties.get("color"),vt=g.properties.get("intensity"),Mt=Math.max(h.bJ([0,0,1],ut),0),Et=[0,0,0];h.c4(Et,yt.toPremultipliedRenderColor(pt?null:et.getLut(o.scope)).toArray01Linear().slice(0,3),vt);const Lt=[0,0,0];return h.c4(Lt,nt.toPremultipliedRenderColor(_e?null:et.getLut(g.scope)).toArray01Linear().slice(0,3),Mt*st),h.da([Et[0]>0?Et[0]/(Et[0]+Lt[0]):0,Et[1]>0?Et[1]/(Et[1]+Lt[1]):0,Et[2]>0?Et[2]/(Et[2]+Lt[2]):0])}function fw(et,o,g,_e,nt,st){const lt=et.zoom,ut=et.scale,pt=et.worldSize,yt=1/pt,vt=et.aspect,Mt=Math.sqrt(1+vt*vt)*Math.tan(.5*et.fovX),Et=Mt*Mt,Lt=_e-g,Ft=_e+g;let Ot,qt;Et>Lt/Ft?(Ot=_e,qt=_e*Mt):(Ot=.5*Ft*(1+Et),qt=.5*Math.sqrt(Lt*Lt+2*(_e*_e+g*g)*Et+Ft*Ft*Et*Et));const $t=et.projection.pixelsPerMeter(et.center.lat,pt),Yt=et._camera.getCameraToWorldMercator(),tr=[0,0,-Ot*yt];h.af(tr,tr,Yt);let sr=qt*yt;const pr=et._edgeInsets;if(!(pr.left===0&&pr.top===0&&pr.right===0&&pr.bottom===0||pr.left===pr.right&&pr.top===pr.bottom)){const un=et._camera.getWorldToCamera(et.worldSize,et.projection.zAxisUnit==="meters"?$t:1),Tn=et._camera.getCameraToClipPerspective(et._fov,et.width/et.height,g,_e);Tn[8]=2*-et.centerOffset.x/et.width,Tn[9]=2*et.centerOffset.y/et.height;const Ln=new Float64Array(16);h.cO(Ln,Tn,un);const xn=new Float64Array(16);h.bl(xn,Ln);const mn=h.cA.fromInvProjectionMatrix(xn,pt,lt,!0);for(const Xn of mn.points){const Gn=((hr=Xn)[0]/=ut,hr[1]/=ut,hr[2]=h.ce(hr[2],et._center.lat),hr);sr=Math.max(sr,h.c5(h.d9([],tr,Gn)))}}var hr;sr*=nt/(nt-1);const gr=Math.acos(o[2]),dr=Math.atan2(-o[0],-o[1]),ur=new py;ur.position=tr,ur.setPitchBearing(gr,dr);const yr=ur.getWorldToCamera(pt,$t),Vr=sr*pt,Ir=Math.min(et._mercatorZfromZoom(17)*pt*-2,-2*Vr),Qr=ur.getCameraToClipOrthographic(-Vr,Vr,-Vr,Vr,Ir,(Vr+st*$t)/o[2]),Nr=new Float64Array(16);h.aB(Nr,Qr,yr);const Yr=h.d4(Math.floor(1e6*tr[0])/1e6*pt,Math.floor(1e6*tr[1])/1e6*pt,0),Cn=.5*nt,Br=[0,0,0];h.af(Br,Yr,Nr),h.c4(Br,Br,Cn);const Tr=[Math.floor(Br[0]),Math.floor(Br[1]),Math.floor(Br[2])],en=[0,0,0];h.av(en,Br,Tr),h.c4(en,en,-1/Cn);const Hr=new Float64Array(16);return h.bA(Hr),h.br(Hr,Hr,en),h.aB(Nr,Hr,Nr),[Nr,Vr]}class my extends h.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,g){return h.aV(this.requestManager.transformRequest(g,h.R.Model).url).then(_e=>{if(!_e)return;const nt=h.aW(_e),st=new h.aX(o,void 0,void 0,nt);return st.computeBoundsAndApplyParent(),st}).catch(_e=>{if(_e&&_e.status===404)return null;this.fire(new h.y(new Error(`Could not load model ${o} from ${g}: ${_e.message}`)))})}load(o,g,_e={forceReload:!1}){this.models[g]||(this.models[g]={});const nt=Object.keys(o),st=[],lt=[];for(const ut of nt){const pt=o[ut];this.hasURLBeenRequested(pt)&&!_e.forceReload||(this.modelByURL[pt]={modelId:ut,scope:g},st.push(this.loadModel(ut,pt)),lt.push(ut)),this.models[g][ut]||(this.models[g][ut]={model:null,numReferences:1})}this.numModelsLoading[g]=(this.numModelsLoading[g]||0)+lt.length,Promise.allSettled(st).then(ut=>{for(let pt=0;pt<ut.length;pt++){const{status:yt}=ut[pt];if(yt==="rejected")continue;const{value:vt}=ut[pt];this.models[g][lt[pt]]||(this.models[g][lt[pt]]={model:null,numReferences:1}),this.models[g][lt[pt]].model=vt}this.numModelsLoading[g]-=lt.length,this.fire(new h.z("data",{dataType:"style"}))}).catch(ut=>{this.fire(new h.y(new Error(`Could not load models: ${ut.message}`)))})}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,g,_e={exactIdMatch:!1}){return!!(_e.exactIdMatch?this.getModel(o,g):this.getModelByURL(this.modelUris[g][o]))}getModel(o,g){return this.models[g]||(this.models[g]={}),this.models[g][o]?this.models[g][o].model:void 0}getModelByURL(o){if(!o)return null;const g=this.modelByURL[o];return g?this.models[g.scope][g.modelId].model:null}hasModelBeenAdded(o,g){return this.models[g]&&this.models[g][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,g,_e){this.models[_e]||(this.models[_e]={}),this.modelUris[_e]||(this.modelUris[_e]={});const nt=this.requestManager.normalizeModelURL(g);if((this.hasModel(o,_e,{exactIdMatch:!0})||this.hasModelBeenAdded(o,_e))&&this.modelUris[_e][o]===nt)this.models[_e][o].numReferences++;else if(this.hasURLBeenRequested(nt)){const{scope:st,modelId:lt}=this.modelByURL[nt];this.models[st][lt].numReferences++}else this.modelUris[_e][o]=nt,this.load({[o]:this.modelUris[_e][o]},_e)}addModelURLs(o,g){this.models[g]||(this.models[g]={}),this.modelUris[g]||(this.modelUris[g]={});const _e=this.modelUris[g];for(const nt in o)_e[nt]=this.requestManager.normalizeModelURL(o[nt])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,g){this.models[g]||(this.models[g]={}),this.modelUris[g]||(this.modelUris[g]={});const _e={};for(const nt of o)this.hasModel(nt,g,{exactIdMatch:!0})||this.hasURLBeenRequested(nt)?this.models[g][nt].numReferences++:this.modelUris[g][nt]&&!this.hasURLBeenRequested(nt)?_e[nt]=this.modelUris[g][nt]:!this.hasURLBeenRequested(nt)&&h.db(nt,!1)&&(this.modelUris[g][nt]=this.requestManager.normalizeModelURL(nt),_e[nt]=this.modelUris[g][nt]);this.load(_e,g)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,g,_e=!1,nt=!1){if(this.models[g]&&this.models[g][o]&&(this.models[g][o].numReferences--,this.models[g][o].numReferences===0||nt)){const st=this.modelUris[g][o];_e||delete this.modelUris[g][o],delete this.modelByURL[st];const lt=this.models[g][o].model;if(!lt)return;delete this.models[g][o],lt.destroy()}}destroy(){for(const o of Object.keys(this.models))for(const g of Object.keys(this.models[o])){const _e=this.models[o][g].model;delete this.models[o][g],_e&&_e.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,g){this.models[g]||(this.models[g]={});for(const _e in this.models[g])this.models[g][_e].model&&this.models[g][_e].model.upload(o.context)}}const P0=new h.a9({data:new h.aa(h.a6.colorTheme.data)});function k_(et){if(!et.metadata||!et.metadata.content_area)return;const o=h.o.devicePixelRatio,{left:g,top:_e,width:nt,height:st}=et.metadata.content_area,lt=g*o,ut=_e*o;return[lt,ut,lt+nt*o,ut+st*o]}function D_(et){if(et)return et.map(([o,g])=>[o*h.o.devicePixelRatio,g*h.o.devicePixelRatio])}class om{constructor(o,g,_e){this.id=o,this.scope=g,this.sourceCache=_e,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const o=new Map;if(!this.sourceCache.loaded())return o;const g=this.sourceCache.getVisibleCoordinates();if(g.length===0)return o;const _e=this.sourceCache.getSource();if(!(_e instanceof ip))return o;const nt=g.map(lt=>this.sourceCache.getTile(lt)),st=_e.getImages(nt,Array.from(this.pendingRequests));for(const[lt,ut]of st)o.set(h.I.from({name:lt,iconsetId:this.id}),ut),this.pendingRequests.delete(lt);for(const lt of this.pendingRequests)this.missingRequests.add(lt);return this.pendingRequests.clear(),o}}const km=(et,o)=>fr(et,o&&o.filter(g=>g.identifier!=="source.canvas")),mw=h.aH(Ns,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),gw=h.aH(Ns,["setCenter","setZoom","setBearing","setPitch"]),L_=new Set(["background","sky","slot","custom"]),I0={version:8,layers:[],sources:{}},j_={duration:300,delay:0};class Yu extends h.E{constructor(o,g={}){super(),this.map=o,this.scope=g.scope||"",this.globalId=null,this.fragments=[],this.importDepth=g.importDepth||0,this.importsCache=g.importsCache||new Map,this.resolvedImports=g.resolvedImports||new Set,this.transition=Object.assign({},j_),this._buildingIndex=new ny(this),this.crossTileSymbolIndex=new _s,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=g.styleChanges||new ws,this.dispatcher=g.dispatcher?g.dispatcher:new h.D(h.dd(),this),g.imageManager?this.imageManager=g.imageManager:(this.imageManager=new Hs(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=g.glyphManager?g.glyphManager:new h.de(o._requestManager,g.localFontFamily?h.df.all:g.localIdeographFontFamily?h.df.ideographs:h.df.none,g.localFontFamily||g.localIdeographFontFamily),g.modelManager?this.modelManager=g.modelManager:(this.modelManager=new my(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=g.configOptions?g.configOptions:new Map,this._configDependentLayers=g.configDependentLayers?g.configDependentLayers:new Set,this._config=g.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:g.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=g.initialConfig,this.dispatcher.broadcast("setReferrer",h.dg());const _e=this;this._rtlTextPluginCallback=Yu.registerForPluginStateChange(nt=>{_e.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:nt.pluginStatus,pluginURL:nt.pluginURL},(st,lt)=>{if(h.dh(st),lt&&lt.every(ut=>ut))for(const ut in _e._sourceCaches){const pt=_e._sourceCaches[ut],yt=pt.getSource().type;yt!=="vector"&&yt!=="geojson"||pt.reload()}})}),this.on("data",nt=>{if(nt.dataType!=="source"||nt.sourceDataType!=="metadata")return;const st=this.getOwnSource(nt.sourceId);if(st&&st.vectorLayerIds)for(const lt in this._layers){const ut=this._layers[lt];ut.source===st.id&&this._validateLayer(ut)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(h.h(o))return o;const g=h.di(o);if(!g.startsWith("http"))try{return new URL(g,location.href).toString()}catch{return g}return g}return`json://${h.dj(JSON.stringify(o))}`}_diffStyle(o,g,_e){this.globalId=this._getGlobalId(o);const nt=(st,lt)=>{try{lt(null,this.setState(st,_e))}catch(ut){lt(ut,!1)}};if(typeof o=="string"){const st=this.map._requestManager.normalizeStyleURL(o),lt=this.map._requestManager.transformRequest(st,h.R.Style);h.m(lt,(ut,pt)=>{ut?this.fire(new h.y(ut)):pt&&nt(pt,g)})}else typeof o=="object"&&nt(o,g)}loadURL(o,g={}){this.fire(new h.z("dataloading",{dataType:"style"}));const _e=typeof g.validate=="boolean"?g.validate:!h.h(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,g.accessToken),this.resolvedImports.add(o);const nt=this.importsCache.get(o);if(nt)return this._load(nt,_e);const st=this.map._requestManager.transformRequest(o,h.R.Style);this._request=h.m(st,(lt,ut)=>{if(this._request=null,lt)this.fire(new h.y(lt));else if(ut)return this.importsCache.set(o,ut),this._load(ut,_e)})}loadJSON(o,g={}){this.fire(new h.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=h.o.frame(()=>{this._request=null,this._load(o,g.validate!==!1)})}loadEmpty(){this.fire(new h.z("dataloading",{dataType:"style"})),this._load(I0,!1)}_loadImports(o,g,_e){if(this.importDepth>=4)return h.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const nt=[];for(const st of o){const lt=this._createFragmentStyle(st),ut=new Promise(vt=>{lt.once("style.import.load",vt),lt.once("error",vt)}).then(()=>this.mergeAll());if(nt.push(ut),this.resolvedImports.has(st.url)){lt.loadEmpty();continue}const pt=st.data||this.importsCache.get(st.url);pt?(lt.loadJSON(pt,{validate:g}),this._isInternalStyle(pt)&&(lt.globalId=null)):st.url?lt.loadURL(st.url,{validate:g}):lt.loadEmpty();const yt={style:lt,id:st.id,config:st.config};if(_e){const vt=this.fragments.findIndex(({id:Mt})=>Mt===_e);this.fragments=this.fragments.slice(0,vt).concat(yt).concat(this.fragments.slice(vt))}else this.fragments.push(yt)}return Promise.allSettled(nt)}getImportGlobalIds(o=this,g=new Set){for(const _e of o.fragments)_e.style.globalId&&g.add(_e.style.globalId),this.getImportGlobalIds(_e.style,g);return[...g.values()]}_createFragmentStyle(o){const g=this.scope?h.B(o.id,this.scope):o.id;let _e;const nt=this._initialConfig&&this._initialConfig[g];(o.config||nt)&&(_e=Object.assign({},o.config,nt));const st=new Yu(this.map,{scope:g,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_e,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers});return st.setEventedParent(this.map,{style:st}),st}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,g){if(this._isInternalStyle(o)){const st=Object.assign({},I0,{imports:[{id:"basemap",data:o,url:""}]});return void this._load(st,g)}if(this.updateConfig(this._config,o.schema),g&&km(this,wu(o)))return;this._loaded=!0,this.stylesheet=h.dk(o);const _e=()=>{for(const pt in o.sources)this.addSource(pt,o.sources[pt],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(const pt in o.iconsets)this.addIconset(pt,o.iconsets[pt]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&o.glyphs&&this.glyphManager.setURL(o.glyphs);const st=_f(this.stylesheet.layers);if(this._order=st.map(pt=>pt.id),this.stylesheet.light&&h.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const pt=this.stylesheet.lights[0];this.light=new Rr(pt.properties,pt.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Rr(this.stylesheet.light)),this._layers={};for(const pt of st){const yt=h.dq(pt,this.scope,this._styleColorTheme.lut,this.options);yt.configDependencies.size!==0&&this._configDependentLayers.add(yt.fqid),yt.setEventedParent(this,{layer:{id:yt.id}}),this._layers[yt.id]=yt;const vt=this.getOwnLayerSourceCache(yt),Mt=!!this.directionalLight&&this.directionalLight.shadowsEnabled();vt&&yt.canCastShadows()&&Mt&&(vt.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const lt=this.stylesheet.terrain;lt&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(lt,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new h.z("data",{dataType:"style"}));const ut=this.isRootStyle();o.imports?this._loadImports(o.imports,g).then(()=>{this._reloadImports(),this.fire(new h.z(ut?"style.load":"style.import.load"))}).catch(pt=>{this.fire(new h.y(new Error("Failed to load imports",pt))),this.fire(new h.z(ut?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new h.z(ut?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const nt=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(nt){const st=this._evaluateColorThemeData(nt);this._loadColorTheme(st).then(()=>{_e()}).catch(lt=>{h.w(`Couldn't load color theme from the stylesheet: ${lt}`),_e()})}else this._styleColorTheme.lut=null,_e()}isRootStyle(){return this.importDepth===0}mergeAll(){let o,g,_e,nt,st,lt,ut,pt,yt,vt;const Mt={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(Et=>{if(Et.stylesheet){if(Et.light!=null&&(o=Et.light),Et.stylesheet.lights)for(const Lt of Et.stylesheet.lights)Lt.type==="ambient"&&Et.ambientLight!=null&&(g=Et.ambientLight),Lt.type==="directional"&&Et.directionalLight!=null&&(_e=Et.directionalLight);nt=this._prioritizeTerrain(nt,Et.terrain,Et.stylesheet.terrain),Et.stylesheet.fog&&Et.fog!=null&&(st=Et.fog),Et.stylesheet.snow&&Et.snow!=null&&(lt=Et.snow),Et.stylesheet.rain&&Et.rain!=null&&(ut=Et.rain),Et.stylesheet.camera!=null&&(vt=Et.stylesheet.camera),Et.stylesheet.projection!=null&&(pt=Et.stylesheet.projection),Et.stylesheet.transition!=null&&(yt=Et.stylesheet.transition),Mt[Et.scope]=Et._styleColorTheme}}),this.light=o,this.ambientLight=g,this.directionalLight=_e,this.fog=st,this.snow=lt,this.rain=ut,this._styleColorThemeForScope=Mt,nt===null?delete this.terrain:this.terrain=nt,this.camera=vt||{"camera-projection":"perspective"},this.projection=pt||{name:"mercator"},this.transition=Object.assign({},j_,yt),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(o){const g=_e=>{for(const nt of _e.fragments)g(nt.style);o(_e)};g(this)}_prioritizeTerrain(o,g,_e){const nt=o&&o.drapeRenderMode===0;return _e===null?g&&g.drapeRenderMode===0?g:nt?o:null:g!=null&&(!o||nt||g&&g.drapeRenderMode===1)?g:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(g=>{o=this._prioritizeTerrain(o,g.terrain,g.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(g=>{g.stylesheet.projection!=null&&(o=g.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){const o={},g={},_e={};this.forEachFragmentStyle(nt=>{for(const st in nt._sourceCaches){const lt=h.B(st,nt.scope);o[lt]=nt._sourceCaches[st]}for(const st in nt._otherSourceCaches){const lt=h.B(st,nt.scope);g[lt]=nt._otherSourceCaches[st]}for(const st in nt._symbolSourceCaches){const lt=h.B(st,nt.scope);_e[lt]=nt._symbolSourceCaches[st]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=g,this._mergedSymbolSourceCaches=_e}mergeLayers(){const o={},g=[],_e={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(lt=>{for(const ut of lt._order){const pt=lt._layers[ut];if(pt.type==="slot"){const yt=h.dl(ut);if(o[yt])continue;o[yt]=[]}pt.slot&&o[pt.slot]?o[pt.slot].push(pt):g.push(pt)}}),this._mergedOrder=[];let nt=-1;const st=(lt=[])=>{for(const ut of lt)if(ut.type==="slot"){const pt=h.dl(ut.id);o[pt]&&st(o[pt]),this._mergedSlots.push(pt)}else{const pt=h.B(ut.id,ut.scope);this._mergedOrder.push(pt),_e[pt]=ut,ut.is3D(!!this.terrain)&&(this._has3DLayers=!0,nt=this._mergedOrder.length-1),ut.type==="circle"&&(this._hasCircleLayers=!0),ut.type==="symbol"&&(this._hasSymbolLayers=!0),ut.type==="clip"&&(this._clipLayerPresent=!0)}};if(st(g),this._has3DLayers){const lt={};for(let ut=0;ut<this._mergedOrder.length;++ut){const pt=this._mergedOrder[ut];lt[pt]=ut===nt?1:ut<nt?_e[pt].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((ut,pt)=>lt[ut]-lt[pt])}this._mergedLayers=_e,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(g,_e,nt,st){const lt=Object.assign({},_e);for(const pt of Object.keys(h.a6.colorTheme))lt[pt]===void 0&&(lt[pt]=h.a6.colorTheme[pt].default);const ut=new h.a8(P0,g,new Map(nt));return ut.setTransitionOrValue(lt,nt),ut.untransitioned().possiblyEvaluate(new h.ac(0,{worldview:void 0}))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const g=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((_e,nt)=>{const st="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void _e();let lt=o;lt.startsWith(st)||(lt=st+lt);const ut=h.I.from("mapbox-reserved-lut"),pt=new Image;pt.src=lt,pt.onerror=()=>{this._styleColorTheme.lutLoading=!1,nt(new Error("Failed to load image data"))},pt.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==g)return void _e();this._styleColorTheme.lutLoading=!1;const{width:yt,height:vt,data:Mt}=h.o.getImageData(pt);if(vt>32)return void nt(new Error("The height of the image must be less than or equal to 32 pixels."));if(yt!==vt*vt)return void nt(new Error("The width of the image must be equal to the height squared."));this.getImage(ut)&&this.removeImage(ut),this.addImage(ut,{data:new h.q({width:yt,height:vt},Mt),pixelRatio:1,sdf:!1,usvg:!1,version:0});const Et=this.imageManager.getImage(ut,this.scope);Et?(this._styleColorTheme.lut={image:Et.data,data:o},_e()):nt(new Error("Missing LUT image."))}})}getLut(o){const g=this._styleColorThemeForScope[o];return g?g.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(g,_e,nt){let st,lt,ut;const pt=h.o.devicePixelRatio>1?"@2x":"";let yt=h.m(_e.transformRequest(_e.normalizeSpriteURL(g,pt,".json"),h.R.SpriteJSON),(Et,Lt)=>{yt=null,ut||(ut=Et,st=Lt,Mt())}),vt=h.n(_e.transformRequest(_e.normalizeSpriteURL(g,pt,".png"),h.R.SpriteImage),(Et,Lt)=>{vt=null,ut||(ut=Et,lt=Lt,Mt())});function Mt(){if(ut)nt(ut);else if(st&&lt){const Et=h.o.getImageData(lt),Lt={};for(const Ft in st){const{width:Ot,height:qt,x:$t,y:Yt,sdf:tr,pixelRatio:sr,stretchX:pr,stretchY:hr,content:gr}=st[Ft],dr=new h.q({width:Ot,height:qt});h.q.copy(Et,dr,{x:$t,y:Yt},{x:0,y:0},{width:Ot,height:qt},null),Lt[Ft]={data:dr,pixelRatio:sr!==void 0?sr:1,sdf:tr!==void 0&&tr,stretchX:pr,stretchY:hr,content:gr,usvg:!1,version:0}}nt(null,Lt)}}return{cancel(){yt&&(yt.cancel(),yt=null),vt&&(vt.cancel(),vt=null)}}}(o,this.map._requestManager,(g,_e)=>{if(this._spriteRequest=null,g)this.fire(new h.y(g));else if(_e){const nt=new Map;for(const st in _e)nt.set(h.I.from(st),_e[st]);this.addImages(nt)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new h.z("data",{dataType:"style"}))})}addIconset(o,g){if(g.type==="sprite")return void this._loadSprite(g.url);const _e=this.getOwnSourceCache(g.source);if(!_e)return void this.fire(new h.y(new Error(`Source "${g.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));const nt=_e.getSource();if(nt.type!=="raster-array")return void this.fire(new h.y(new Error(`Source "${g.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));nt.partial=!1;const st=new om(o,this.scope,_e);this.imageManager.addImageProvider(st,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!h.h(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);const g=this.map._spriteFormat==="auto";var _e,nt;this._spriteRequest=(nt=(st,lt)=>{if(this._spriteRequest=null,st)g?this._loadSprite(o):this.fire(new h.y(st));else if(lt){const ut=new Map;for(const pt in lt)ut.set(h.I.from(pt),lt[pt]);this.addImages(ut)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new h.z("data",{dataType:"style"}))},h.bu((_e=this.map._requestManager).transformRequest(_e.normalizeIconsetURL(o),h.R.Iconset),(st,lt)=>{if(st)return void nt(st);const ut={},pt=h.dc(new h.bt(lt));for(const yt of pt.icons){const vt={version:1,pixelRatio:h.o.devicePixelRatio,content:k_(yt),stretchX:yt.metadata?D_(yt.metadata.stretch_x_areas):void 0,stretchY:yt.metadata?D_(yt.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:yt};ut[yt.name]=vt}nt(null,ut)}))}_validateLayer(o){const g=this.getOwnSource(o.source);if(!g)return;const _e=o.sourceLayer;_e&&(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(_e)===-1)&&this.fire(new h.y(new Error(`Source layer "${_e}" does not exist on source "${g.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,g)=>{const _e=this.fragments[g];return _e&&_e.style&&(o.data=_e.style.serialize()),o})}_serializeSources(){const o={};for(const g in this._sourceCaches){const _e=this._sourceCaches[g].getSource();o[_e.id]||(o[_e.id]=_e.serialize())}return o}_serializeLayers(o){const g=[];for(const _e of o){const nt=this._layers[_e];nt&&nt.type!=="custom"&&g.push(nt.serialize())}return g}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const g=this.getOwnLayer(o);if(g)return g;this.fire(new h.y(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const g=this.getOwnSource(o);if(g)return g;this.fire(new h.y(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,g){const _e=this.map.painter;if(_e)for(let nt=o.minzoom||0;nt<(o.maxzoom||25.5);nt++){const st=o.getProgramIds();if(st)for(const lt of st){const ut=o.getDefaultProgramParams(lt,g.zoom,this._styleColorTheme.lut);ut&&(_e.style=this,this.fog&&(_e._fogVisible=!0,ut.overrideFog=!0,_e.getOrCreateProgram(lt,ut)),_e._fogVisible=!1,ut.overrideFog=!1,_e.getOrCreateProgram(lt,ut),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(ut.overrideRtt=!0,_e.getOrCreateProgram(lt,ut)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const g=this.calculateLightsBrightness();o.brightness=g||0,g!==this._brightness&&(this._brightness=g,this.dispatcher.broadcast("setBrightness",g)),o.worldview!==this._worldview&&(this._worldview=o.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const _e=this._changes.isDirty();let nt=!1;if(this._changes.isDirty()){const ut=this._changes.getLayerUpdatesByScope();for(const pt in ut){const{updatedIds:yt,removedIds:vt}=ut[pt];(yt||vt)&&(this._updateWorkerLayers(pt,yt,vt),nt=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}const st={};for(const ut in this._mergedSourceCaches){const pt=this._mergedSourceCaches[ut];st[ut]=pt.used,pt.used=!1,pt.tileCoverLift=0}for(const ut of this._mergedOrder){const pt=this._mergedLayers[ut];if(pt.recalculate(o,this._availableImages),!pt.isHidden(o.zoom)){const yt=this.getLayerSourceCache(pt);yt&&(yt.used=!0,yt.tileCoverLift=Math.max(yt.tileCoverLift,pt.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(pt,o)}):this.precompilePrograms(pt,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&nt&&this.mergeLayers();const lt=this.imageManager.getPendingImageProviders();for(const ut of lt)ut.sourceCache.used=!0;for(const ut in st){const pt=this._mergedSourceCaches[ut];st[ut]!==pt.used&&pt.getSource().fire(new h.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:pt.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),_e&&this.fire(new h.z("data",{dataType:"style"}))}updateImageProviders(){const o=this.imageManager.getPendingImageProviders();for(const g of o){const _e=g.resolvePendingRequests(),nt=this.getFragmentStyle(g.scope);nt&&nt.addImages(_e)}}_updateTilesForChangedImages(){const o={};for(const g in this._mergedSourceCaches){const _e=this._mergedSourceCaches[g].getSource().scope;o[_e]=o[_e]||this._changes.getUpdatedImages(_e),o[_e].length!==0&&this._mergedSourceCaches[g].reloadTilesForDependencies(["icons","patterns"],o[_e])}for(const g in o)this._changes.resetUpdatedImages(g)}_updateWorkerLayers(o,g,_e){const nt=this.getFragmentStyle(o);nt&&this.dispatcher.broadcast("updateLayers",{layers:g?nt._serializeLayers(g):[],scope:o,removedIds:_e||[],options:nt.options})}setState(o,g){if(this._checkLoaded(),km(this,wu(o)))return!1;(o=h.dk(o)).layers=_f(o.layers);const _e=function(lt,ut){if(!lt)return[{command:Ns.setStyle,args:[ut]}];let pt=[];try{if(!h.by(lt.version,ut.version))return[{command:Ns.setStyle,args:[ut]}];if(h.by(lt.center,ut.center)||pt.push({command:Ns.setCenter,args:[ut.center]}),h.by(lt.zoom,ut.zoom)||pt.push({command:Ns.setZoom,args:[ut.zoom]}),h.by(lt.bearing,ut.bearing)||pt.push({command:Ns.setBearing,args:[ut.bearing]}),h.by(lt.pitch,ut.pitch)||pt.push({command:Ns.setPitch,args:[ut.pitch]}),h.by(lt.sprite,ut.sprite)||pt.push({command:Ns.setSprite,args:[ut.sprite]}),h.by(lt.glyphs,ut.glyphs)||pt.push({command:Ns.setGlyphs,args:[ut.glyphs]}),h.by(lt.imports,ut.imports)||function(Lt=[],Ft=[],Ot){Ft=Ft||[];const qt=(Lt=Lt||[]).map(Mp),$t=Ft.map(Mp),Yt=Lt.reduce(tm,{}),tr=Ft.reduce(tm,{}),sr=qt.slice();let pr,hr,gr,dr;for(pr=0,hr=0;pr<qt.length;pr++)gr=qt[pr],tr.hasOwnProperty(gr)?hr++:(Ot.push({command:Ns.removeImport,args:[gr]}),sr.splice(sr.indexOf(gr,hr),1));for(pr=0,hr=0;pr<$t.length;pr++)gr=$t[$t.length-1-pr],sr[sr.length-1-pr]!==gr&&(Yt.hasOwnProperty(gr)?(Ot.push({command:Ns.removeImport,args:[gr]}),sr.splice(sr.lastIndexOf(gr,sr.length-hr),1)):hr++,dr=sr[sr.length-pr],Ot.push({command:Ns.addImport,args:[tr[gr],dr]}),sr.splice(sr.length-pr,0,gr));for(const ur of Ft){const yr=Yt[ur.id];yr&&(delete yr.data,h.by(yr,ur)||Ot.push({command:Ns.updateImport,args:[ur.id,ur]}))}}(lt.imports,ut.imports,pt),h.by(lt.transition,ut.transition)||pt.push({command:Ns.setTransition,args:[ut.transition]}),h.by(lt.light,ut.light)||pt.push({command:Ns.setLight,args:[ut.light]}),h.by(lt.fog,ut.fog)||pt.push({command:Ns.setFog,args:[ut.fog]}),h.by(lt.snow,ut.snow)||pt.push({command:Ns.setSnow,args:[ut.snow]}),h.by(lt.rain,ut.rain)||pt.push({command:Ns.setRain,args:[ut.rain]}),h.by(lt.projection,ut.projection)||pt.push({command:Ns.setProjection,args:[ut.projection]}),h.by(lt.lights,ut.lights)||pt.push({command:Ns.setLights,args:[ut.lights]}),h.by(lt.camera,ut.camera)||pt.push({command:Ns.setCamera,args:[ut.camera]}),h.by(lt.iconsets,ut.iconsets)||function(Lt,Ft,Ot){let qt;for(qt in Ft=Ft||{},Lt=Lt||{})Lt.hasOwnProperty(qt)&&(Ft.hasOwnProperty(qt)||Ot.push({command:Ns.removeIconset,args:[qt]}));for(qt in Ft){if(!Ft.hasOwnProperty(qt))continue;const $t=Ft[qt];Lt.hasOwnProperty(qt)?h.by(Lt[qt],$t)||(Ot.push({command:Ns.removeIconset,args:[qt]}),Ot.push({command:Ns.addIconset,args:[qt,$t]})):Ot.push({command:Ns.addIconset,args:[qt,$t]})}}(lt.iconsets,ut.iconsets,pt),!h.by(lt["color-theme"],ut["color-theme"]))return[{command:Ns.setStyle,args:[ut]}];const yt={},vt=[];(function(Lt,Ft,Ot,qt){let $t;for($t in Ft=Ft||{},Lt=Lt||{})Lt.hasOwnProperty($t)&&(Ft.hasOwnProperty($t)||em($t,Ot,qt));for($t in Ft){if(!Ft.hasOwnProperty($t))continue;const Yt=Ft[$t];Lt.hasOwnProperty($t)?h.by(Lt[$t],Yt)||(Lt[$t].type==="geojson"&&Yt.type==="geojson"&&sy(Lt,Ft,$t)?Ot.push({command:Ns.setGeoJSONSourceData,args:[$t,Yt.data]}):Tu($t,Ft,Ot,qt)):Ip($t,Ft,Ot)}})(lt.sources,ut.sources,vt,yt);const Mt=[];lt.layers&&lt.layers.forEach(Lt=>{Lt.source&&yt[Lt.source]?pt.push({command:Ns.removeLayer,args:[Lt.id]}):Mt.push(Lt)});let Et=lt.terrain;Et&&yt[Et.source]&&(pt.push({command:Ns.setTerrain,args:[void 0]}),Et=void 0),pt=pt.concat(vt),h.by(Et,ut.terrain)||pt.push({command:Ns.setTerrain,args:[ut.terrain]}),function(Lt,Ft,Ot){Ft=Ft||[];const qt=(Lt=Lt||[]).map(Mp),$t=Ft.map(Mp),Yt=Lt.reduce(tm,{}),tr=Ft.reduce(tm,{}),sr=qt.slice(),pr=Object.create(null);let hr,gr,dr,ur,yr,Vr,Ir;for(hr=0,gr=0;hr<qt.length;hr++)dr=qt[hr],tr.hasOwnProperty(dr)?gr++:(Ot.push({command:Ns.removeLayer,args:[dr]}),sr.splice(sr.indexOf(dr,gr),1));for(hr=0,gr=0;hr<$t.length;hr++)dr=$t[$t.length-1-hr],sr[sr.length-1-hr]!==dr&&(Yt.hasOwnProperty(dr)?(Ot.push({command:Ns.removeLayer,args:[dr]}),sr.splice(sr.lastIndexOf(dr,sr.length-gr),1)):gr++,Vr=sr[sr.length-hr],Ot.push({command:Ns.addLayer,args:[tr[dr],Vr]}),sr.splice(sr.length-hr,0,dr),pr[dr]=!0);for(hr=0;hr<$t.length;hr++)if(dr=$t[hr],ur=Yt[dr],yr=tr[dr],!pr[dr]&&!h.by(ur,yr))if(h.by(ur.source,yr.source)&&h.by(ur["source-layer"],yr["source-layer"])&&h.by(ur.type,yr.type)){for(Ir in gp(ur.layout,yr.layout,Ot,dr,null,Ns.setLayoutProperty),gp(ur.paint,yr.paint,Ot,dr,null,Ns.setPaintProperty),h.by(ur.slot,yr.slot)||Ot.push({command:Ns.setSlot,args:[dr,yr.slot]}),h.by(ur.filter,yr.filter)||Ot.push({command:Ns.setFilter,args:[dr,yr.filter]}),h.by(ur.minzoom,yr.minzoom)&&h.by(ur.maxzoom,yr.maxzoom)||Ot.push({command:Ns.setLayerZoomRange,args:[dr,yr.minzoom,yr.maxzoom]}),ur)ur.hasOwnProperty(Ir)&&Ir!=="layout"&&Ir!=="paint"&&Ir!=="filter"&&Ir!=="metadata"&&Ir!=="minzoom"&&Ir!=="maxzoom"&&Ir!=="slot"&&(Ir.indexOf("paint.")===0?gp(ur[Ir],yr[Ir],Ot,dr,Ir.slice(6),Ns.setPaintProperty):h.by(ur[Ir],yr[Ir])||Ot.push({command:Ns.setLayerProperty,args:[dr,Ir,yr[Ir]]}));for(Ir in yr)yr.hasOwnProperty(Ir)&&!ur.hasOwnProperty(Ir)&&Ir!=="layout"&&Ir!=="paint"&&Ir!=="filter"&&Ir!=="metadata"&&Ir!=="minzoom"&&Ir!=="maxzoom"&&Ir!=="slot"&&(Ir.indexOf("paint.")===0?gp(ur[Ir],yr[Ir],Ot,dr,Ir.slice(6),Ns.setPaintProperty):h.by(ur[Ir],yr[Ir])||Ot.push({command:Ns.setLayerProperty,args:[dr,Ir,yr[Ir]]}))}else Ot.push({command:Ns.removeLayer,args:[dr]}),Vr=sr[sr.lastIndexOf(dr)+1],Ot.push({command:Ns.addLayer,args:[yr,Vr]})}(Mt,ut.layers,pt)}catch(yt){console.warn("Unable to compute style diff:",yt),pt=[{command:Ns.setStyle,args:[ut]}]}return pt}(this.serialize(),o).filter(lt=>!(lt.command in gw));if(_e.length===0)return!1;const nt=_e.filter(lt=>!(lt.command in mw));if(nt.length>0)throw new Error(`Unimplemented: ${nt.map(lt=>lt.command).join(", ")}.`);const st=[];return _e.forEach(lt=>{st.push(this[lt.command](...lt.args))}),g&&Promise.all(st).then(g).catch(g),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){if(o.size===0)return this;for(const[g,_e]of o.entries()){if(this.getImage(g))return this.fire(new h.y(new Error(`An image with the name "${g.name}" already exists.`)));this.imageManager.addImage(g,this.scope,_e),this._changes.updateImage(g,this.scope)}return this._updateWorkerImages(),this.fire(new h.z("data",{dataType:"style"})),this}addImage(o,g){return this.getImage(o)?this.fire(new h.y(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,g),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new h.z("data",{dataType:"style"})),this)}updateImage(o,g,_e=!1){this.imageManager.updateImage(o,this.scope,g),_e&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new h.z("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new h.z("data",{dataType:"style"})),this):this.fire(new h.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(o){return this.modelManager.addModelURLs(o,this.scope),this._updateWorkerModels(),this.fire(new h.z("data",{dataType:"style"})),this}addModel(o,g,_e={}){return this._checkLoaded(),this._validate(wr,`models.${o}`,g,null,_e)||(this.modelManager.addModel(o,g,this.scope),this.fire(new h.z("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope,!1,!0),this.fire(new h.z("data",{dataType:"style"})),this):this.fire(new h.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,g,_e={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!g.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(g).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(Ap,`sources.${o}`,g,null,_e))return;this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);const nt=Xp(o,g,this.dispatcher,this);nt.scope=this.scope,nt.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(nt.id),source:nt.serialize(),sourceId:nt.id}));const st=lt=>{const ut=(lt?"symbol:":"other:")+nt.id,pt=h.B(ut,this.scope),yt=this._sourceCaches[ut]=new ou(pt,nt,lt);(lt?this._symbolSourceCaches:this._otherSourceCaches)[nt.id]=yt,yt.onAdd(this.map)};st(!1),g.type!=="vector"&&g.type!=="geojson"||st(!0),nt.onAdd&&nt.onAdd(this.map),_e.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const g=this.getOwnSource(o);if(!g)throw new Error("There is no source with this ID");for(const nt in this._layers)if(this._layers[nt].source===o)return this.fire(new h.y(new Error(`Source "${o}" cannot be removed while layer "${nt}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new h.y(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const nt=Object.entries(this.stylesheet.iconsets).find(([st,lt])=>lt.type==="source"&&lt.source===o);if(nt)return this.fire(new h.y(new Error(`Source "${o}" cannot be removed while iconset "${nt[0]}" is using it.`)))}const _e=this.getOwnSourceCaches(o);for(const nt of _e){const st=h.dl(nt.id);delete this._sourceCaches[st],this._changes.discardSourceCacheUpdate(nt.id),nt.fire(new h.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:nt.getSource().id})),nt.setEventedParent(null),nt.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),g.setEventedParent(null),g.onRemove&&g.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,g){this._checkLoaded(),this.getOwnSource(o).setData(g),this._changes.setDirty()}getOwnSource(o){const g=this.getOwnSourceCache(o);return g&&g.getSource()}getOwnSources(){const o=[];for(const g in this._otherSourceCaches){const _e=this.getOwnSourceCache(g);_e&&o.push(_e.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const g in o){const _e=o[g]._tiles;for(const nt in _e){const st=_e[nt];if(st.state!=="loaded"&&st.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const g=this._getTransitionParameters();for(const st of o){if(this._validate(Wu,"lights",st))return;switch(st.type){case"ambient":if(this.ambientLight){const lt=this.ambientLight;lt.set(st),lt.updateTransitions(g)}else this.ambientLight=new Ws(st,Mo||(Mo=new h.a9({color:new h.aa(h.a6.properties_light_ambient.color),"color-use-theme":new h.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new h.aa(h.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const lt=this.directionalLight;lt.set(st),lt.updateTransitions(g)}else this.directionalLight=new Ws(st,Jo||(Jo=new h.a9({direction:new h.ap(h.a6.properties_light_directional.direction),color:new h.aa(h.a6.properties_light_directional.color),"color-use-theme":new h.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new h.aa(h.a6.properties_light_directional.intensity),"cast-shadows":new h.aa(h.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new h.aa(h.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new h.aa(h.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const _e=Object.assign(g,{worldview:this.map.getWorldview()}),nt=new h.ac(this.z||0,_e);this.ambientLight&&this.ambientLight.recalculate(nt),this.directionalLight&&this.directionalLight.recalculate(nt),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,g=this.ambientLight;if(!o||!g)return;const _e=Et=>.2126*(Et[0]<=.03928?Et[0]/12.92:Math.pow((Et[0]+.055)/1.055,2.4))+.7152*(Et[1]<=.03928?Et[1]/12.92:Math.pow((Et[1]+.055)/1.055,2.4))+.0722*(Et[2]<=.03928?Et[2]/12.92:Math.pow((Et[2]+.055)/1.055,2.4)),nt=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),st=o.properties.get("intensity"),lt=o.properties.get("direction"),ut=1-h.d3(lt.x,lt.y,lt.z)[2]/90,pt=_e(nt)*st*ut,yt=g.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),vt=g.properties.get("intensity"),Mt=_e(yt)*vt;return Number(((pt+Mt)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(h.dm(o)){const g=h.dn(o),_e=this.fragments.find(({id:st})=>st===g);if(!_e)return;const nt=h.dl(o);return _e.style.getFragmentStyle(nt)}{const g=this.fragments.find(({id:_e})=>_e===o);return g?g.style:void 0}}setFeaturesetSelectors(o){if(!o)return;const g={},_e=(nt,st="")=>`${nt}::${st}`;this._featuresetSelectors={};for(const nt in o){const st=this._featuresetSelectors[nt]=[];for(const lt of o[nt].selectors){if(lt.featureNamespace){const pt=this.getOwnLayer(lt.layer);if(!pt){h.w(`Layer is undefined for selector: ${lt.layer}`);continue}const yt=_e(pt.source,pt.sourceLayer);if(yt in g&&g[yt]!==lt.featureNamespace){h.w(`"featureNamespace ${lt.featureNamespace} of featureset ${nt}'s selector is not associated to the same source, skip this selector`);continue}g[yt]=lt.featureNamespace}let ut;if(lt.properties)for(const pt in lt.properties){const yt=h.U(lt.properties[pt]);yt.result==="success"&&(ut=ut||{},ut[pt]=yt.value)}st.push({layerId:lt.layer,namespace:lt.featureNamespace,properties:ut,uniqueFeatureID:lt._uniqueFeatureID})}}}getFeaturesetDescriptors(o){const g=this.getFragmentStyle(o);if(!g||!g.stylesheet.featuresets)return[];const _e=[];for(const nt in g.stylesheet.featuresets)_e.push({featuresetId:nt,importId:g.scope?g.scope:void 0});return _e}getFeaturesetLayers(o,g){const _e=this.getFragmentStyle(g),nt=_e.stylesheet.featuresets;if(!nt||!nt[o])return this.fire(new h.y(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];const st=[];for(const lt of nt[o].selectors){const ut=_e.getOwnLayer(lt.layer);ut&&st.push(ut)}return st}getConfigProperty(o,g){const _e=this.getFragmentStyle(o);if(!_e)return null;const nt=h.B(g,_e.scope),st=_e.options.get(nt),lt=st?st.value||st.default:null;return lt?lt.serialize():null}setConfigProperty(o,g,_e){const nt=this.getFragmentStyle(o);if(!nt)return;const st=nt.stylesheet.schema;if(!st||!st[g])return;const lt=h.U(_e);if(lt.result!=="success")return void km(this,lt.value);const ut=lt.value.expression,pt=h.B(g,nt.scope),yt=nt.options.get(pt);if(!yt)return;let vt;const{minValue:Mt,maxValue:Et,stepValue:Lt,type:Ft,values:Ot}=st[g],qt=h.U(st[g].default);qt.result==="success"&&(vt=qt.value.expression),vt?(this.options.set(pt,Object.assign({},yt,{value:ut,default:vt,minValue:Mt,maxValue:Et,stepValue:Lt,type:Ft,values:Ot})),this.updateConfigDependencies(g)):this.fire(new h.y(new Error(`No schema defined for the config option "${g}" in the "${o}" fragment.`)))}getConfig(o){const g=this.getFragmentStyle(o);if(!g)return null;const _e=g.stylesheet.schema;if(!_e)return null;const nt={};for(const st in _e){const lt=h.B(st,g.scope),ut=g.options.get(lt),pt=ut?ut.value||ut.default:null;nt[st]=pt?pt.serialize():null}return nt}setConfig(o,g){const _e=this.getFragmentStyle(o);_e&&(_e.updateConfig(g,_e.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){const g=this.getFragmentStyle(o);return g?g.stylesheet.schema:null}setSchema(o,g){const _e=this.getFragmentStyle(o);_e&&(_e.stylesheet.schema=g,_e.updateConfig(_e._config,g),this.updateConfigDependencies())}updateConfig(o,g){if(this._config=o,o||g)if(g)for(const _e in g){let nt,st;const lt=h.U(g[_e].default);if(lt.result==="success"&&(nt=lt.value.expression),o&&o[_e]!==void 0){const Et=h.U(o[_e]);Et.result==="success"&&(st=Et.value.expression)}const{minValue:ut,maxValue:pt,stepValue:yt,type:vt,values:Mt}=g[_e];if(nt){const Et=h.B(_e,this.scope);this.options.set(Et,{default:nt,value:st,minValue:ut,maxValue:pt,stepValue:yt,type:vt,values:Mt})}else this.fire(new h.y(new Error(`No schema defined for config option "${_e}".`)))}else this.fire(new h.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(o){for(const g of this._configDependentLayers){const _e=this.getLayer(g);if(_e){if(o&&!_e.configDependencies.has(o))continue;_e.possiblyEvaluateVisibility(),this._updateLayer(_e)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(g=>{const _e=g._styleColorTheme.colorThemeOverride?g._styleColorTheme.colorThemeOverride:g._styleColorTheme.colorTheme;if(_e){const nt=g._evaluateColorThemeData(_e);(!g._styleColorTheme.lut&&nt!==""||g._styleColorTheme.lut&&nt!==g._styleColorTheme.lut.data)&&g.setColorTheme(_e)}}),this._changes.setDirty()}addLayer(o,g,_e={}){this._checkLoaded();const nt=o.id;if(this._layers[nt])return void this.fire(new h.y(new Error(`Layer with id "${nt}" already exists on this map`)));let st;if(o.type==="custom"){if(km(this,h.dp(o)))return;st=h.dq(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(nt,o.source),o=h.dk(o),o=Object.assign(o,{source:nt})),this._validate(Lr,`layers.${nt}`,o,{arrayIndex:-1},_e))return;st=h.dq(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(st),st.setEventedParent(this,{layer:{id:nt}})}st.configDependencies.size!==0&&this._configDependentLayers.add(st.fqid);let lt=this._order.length;if(g){const vt=this._order.indexOf(g);if(vt===-1)return void this.fire(new h.y(new Error(`Layer with id "${g}" does not exist on this map.`)));st.slot===this._layers[g].slot?lt=vt:h.w(`Layer with id "${g}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(lt,0,nt),this._layerOrderChanged=!0,this._layers[nt]=st;const ut=this.getOwnLayerSourceCache(st),pt=!!this.directionalLight&&this.directionalLight.shadowsEnabled();ut&&st.canCastShadows()&&pt&&(ut.castsShadows=!0);const yt=this._changes.getRemovedLayer(st);if(yt&&st.source&&ut&&st.type!=="custom"){this._changes.discardLayerRemoval(st);const vt=h.B(st.source,st.scope);yt.type!==st.type?this._changes.updateSourceCache(vt,"clear"):(this._changes.updateSourceCache(vt,"reload"),ut.pause())}this._updateLayer(st),st.onAdd&&st.onAdd(this.map),st.scope=this.scope,this.mergeLayers()}moveLayer(o,g){this._checkLoaded();const _e=this._checkLayer(o);if(!_e||o===g)return;const nt=this._order.indexOf(o);this._order.splice(nt,1);let st=this._order.length;if(g){const lt=this._order.indexOf(g);if(lt===-1)return void this.fire(new h.y(new Error(`Layer with id "${g}" does not exist on this map.`)));_e.slot===this._layers[g].slot?st=lt:h.w(`Layer with id "${g}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(st,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();const g=this._checkLayer(o);if(!g)return;g.setEventedParent(null);const _e=this._order.indexOf(o);this._order.splice(_e,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(g.fqid),this._changes.removeLayer(g);const nt=this.getOwnLayerSourceCache(g);if(nt&&nt.castsShadows){let st=!1;for(const lt in this._layers)if(this._layers[lt].source===g.source&&this._layers[lt].canCastShadows()){st=!0;break}nt.castsShadows=st}g.onRemove&&g.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const g in this._layers)if(this._layers[g].type===o)return!0;return!1}setLayerZoomRange(o,g,_e){this._checkLoaded();const nt=this._checkLayer(o);nt&&(nt.minzoom===g&&nt.maxzoom===_e||(g!=null&&(nt.minzoom=g),_e!=null&&(nt.maxzoom=_e),this._updateLayer(nt)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,g){this._checkLoaded();const _e=this._checkLayer(o);_e&&_e.slot!==g&&(_e.slot=g,this._updateLayer(_e))}setFilter(o,g,_e={}){this._checkLoaded();const nt=this._checkLayer(o);if(nt&&!h.by(nt.filter,g))return g==null?(nt.filter=void 0,void this._updateLayer(nt)):void(this._validate(Wt,`layers.${nt.id}.filter`,g,{layerType:nt.type},_e)||(nt.filter=h.dk(g),this._updateLayer(nt)))}getFilter(o){const g=this._checkLayer(o);if(g)return h.dk(g.filter)}setLayoutProperty(o,g,_e,nt={}){this._checkLoaded();const st=this._checkLayer(o);if(st&&!h.by(st.getLayoutProperty(g),_e)){if(_e!=null&&(!nt||nt.validate!==!1)&&km(st,lr.call(wu,{key:`layers.${o}.layout.${g}`,layerType:st.type,objectKey:g,value:_e,styleSpec:h.a6,style:{glyphs:!0,sprite:!0}})))return;st.setLayoutProperty(g,_e),st.configDependencies.size!==0&&this._configDependentLayers.add(st.fqid),this._updateLayer(st)}}getLayoutProperty(o,g){const _e=this._checkLayer(o);if(_e)return _e.getLayoutProperty(g)}setPaintProperty(o,g,_e,nt={}){this._checkLoaded();const st=this._checkLayer(o);if(!st||h.by(st.getPaintProperty(g),_e)||_e!=null&&(!nt||nt.validate!==!1)&&km(st,Qt.call(wu,{key:`layers.${o}.paint.${g}`,layerType:st.type,objectKey:g,value:_e,styleSpec:h.a6})))return;const lt=st.setPaintProperty(g,_e);st.configDependencies.size!==0&&this._configDependentLayers.add(st.fqid),lt&&this._updateLayer(st),this._changes.updatePaintProperties(st)}getPaintProperty(o,g){const _e=this._checkLayer(o);if(_e)return _e.getPaintProperty(g)}setFeatureState(o,g){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:pt,importId:yt}=o.target,vt=this.getFragmentStyle(yt),Mt=vt.getFeaturesetLayers(pt);for(const{source:Et,sourceLayer:Lt}of Mt)vt.setFeatureState({id:o.id,source:Et,sourceLayer:Lt},g)}else if("layerId"in o.target){const{layerId:pt}=o.target,yt=this.getLayer(pt);this.setFeatureState({id:o.id,source:yt.source,sourceLayer:yt.sourceLayer},g)}return}const _e=o.source,nt=o.sourceLayer,st=this._checkSource(_e);if(!st)return;const lt=st.type;if(lt==="geojson"&&nt)return void this.fire(new h.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(lt==="vector"&&!nt)return void this.fire(new h.y(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new h.y(new Error("The feature id parameter must be provided.")));const ut=this.getOwnSourceCaches(_e);for(const pt of ut)pt.setFeatureState(nt,o.id,g)}removeFeatureState(o,g){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:pt,importId:yt}=o.target,vt=this.getFragmentStyle(yt),Mt=vt.getFeaturesetLayers(pt);for(const{source:Et,sourceLayer:Lt}of Mt)vt.removeFeatureState({id:o.id,source:Et,sourceLayer:Lt},g)}else if("layerId"in o.target){const{layerId:pt}=o.target,yt=this.getLayer(pt);this.removeFeatureState({id:o.id,source:yt.source,sourceLayer:yt.sourceLayer},g)}return}const _e=o.source,nt=this._checkSource(_e);if(!nt)return;const st=nt.type,lt=st==="vector"?o.sourceLayer:void 0;if(st==="vector"&&!lt)return void this.fire(new h.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(g&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new h.y(new Error("A feature id is required to remove its specific state property.")));const ut=this.getOwnSourceCaches(_e);for(const pt of ut)pt.removeFeatureState(lt,o.id,g)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let st;if("featuresetId"in o.target){const{featuresetId:lt,importId:ut}=o.target,pt=this.getFragmentStyle(ut),yt=pt.getFeaturesetLayers(lt);for(const{source:vt,sourceLayer:Mt}of yt){const Et=pt.getFeatureState({id:o.id,source:vt,sourceLayer:Mt});if(Et&&!st)st=Et;else if(!h.by(st,Et))return void this.fire(new h.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){const{layerId:lt}=o.target,ut=this.getLayer(lt);st=this.getFeatureState({id:o.id,source:ut.source,sourceLayer:ut.sourceLayer})}return st}const g=o.source,_e=o.sourceLayer,nt=this._checkSource(g);if(nt){if(nt.type!=="vector"||_e)return o.id===void 0&&this.fire(new h.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(g)[0].getFeatureState(_e,o.id);this.fire(new h.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),g=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return h.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:g,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_e=>_e!==void 0)}_updateFilteredLayers(o){for(const g of Object.values(this._mergedLayers))o(g)&&this._updateLayer(g)}_updateLayer(o){this._changes.updateLayer(o);const g=this.getLayerSourceCache(o),_e=h.B(o.source,o.scope),nt=this._changes.getUpdatedSourceCaches();o.source&&!nt[_e]&&g&&g.getSource().type!=="raster"&&(this._changes.updateSourceCache(_e,"reload"),g.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const g=ut=>this._mergedLayers[ut].is3D(!!this.terrain),_e=this.order,nt={},st=[];for(let ut=_e.length-1;ut>=0;ut--){const pt=_e[ut];if(g(pt)){nt[pt]=ut;for(const yt of o){const vt=yt[pt];if(vt)for(const Mt of vt)st.push(Mt)}}}st.sort((ut,pt)=>pt.intersectionZ-ut.intersectionZ);const lt=[];for(let ut=_e.length-1;ut>=0;ut--){const pt=_e[ut];if(g(pt))for(let yt=st.length-1;yt>=0;yt--){const vt=st[yt].feature;if(vt.layer&&nt[vt.layer.id]<ut)break;lt.push(vt),st.pop()}else for(const yt of o){const vt=yt[pt];if(vt)for(const Mt of vt)lt.push(Mt.feature)}}return lt}queryRasterValue(o,g,_e){const nt=this.getOwnSource(o);return nt?nt.type!=="raster-array"?(this.fire(new h.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):nt.queryRasterArrayValue(g,_e):(this.fire(new h.y(new Error(`Source with id "${o}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(o,g,_e){let nt;g&&!Array.isArray(g)&&g.filter&&(this._validate(Wt,"queryRenderedFeatures.filter",g.filter,null,g),nt=h.b6(g.filter));const st={},lt=vt=>{if(L_.has(vt.type))return;const Mt=this.getOwnLayerSourceCache(vt),Et=st[Mt.id]=st[Mt.id]||{sourceCache:Mt,layers:{},has3DLayers:!1};vt.is3D(!!this.terrain)&&(Et.has3DLayers=!0),Et.layers[vt.fqid]=Et.layers[vt.fqid]||{styleLayer:vt,targets:[]},Et.layers[vt.fqid].targets.push({filter:nt})};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new h.y(new Error("parameters.layers must be an Array."))),[];for(const vt of g.layers){const Mt=this._layers[vt];if(!Mt)return this.fire(new h.y(new Error(`The layer '${vt}' does not exist in the map's style and cannot be queried for features.`))),[];lt(Mt)}}else for(const vt in this._layers)lt(this._layers[vt]);const ut=this._queryRenderedFeatures(o,st,_e),pt=this._flattenAndSortRenderedFeatures(ut),yt=[];for(const vt of pt)h.ds(vt.layer.id)===this.scope&&yt.push(vt);return yt}queryRenderedFeatureset(o,g,_e){let nt;g&&!Array.isArray(g)&&g.filter&&(this._validate(Wt,"queryRenderedFeatures.filter",g.filter,null,g),nt=h.b6(g.filter));const st="mock",lt=[];if(g&&g.target)lt.push(Object.assign({},g,{targetId:st,filter:nt}));else{const vt=this.getFeaturesetDescriptors();for(const Mt of vt)lt.push({targetId:st,filter:nt,target:Mt});for(const{style:Mt}of this.fragments){const Et=Mt.getFeaturesetDescriptors();for(const Lt of Et)lt.push({targetId:st,filter:nt,target:Lt})}}const ut=this.queryRenderedTargets(o,lt,_e),pt=[],yt=new Set;for(const vt of ut)for(const Mt of vt.variants[st])Il(Mt,vt,yt)||pt.push(new h.dt(vt,Mt));return pt}queryRenderedTargets(o,g,_e){const nt={},st=(ut,pt,yt,vt)=>{const Mt=nt[pt.id]=nt[pt.id]||{sourceCache:pt,layers:{},has3DLayers:!1};if(Mt.layers[ut.fqid]=Mt.layers[ut.fqid]||{styleLayer:ut,targets:[]},ut.is3D(!!this.terrain)&&(Mt.has3DLayers=!0),!vt)return yt.uniqueFeatureID=!1,void Mt.layers[ut.fqid].targets.push(yt);Mt.layers[ut.fqid].targets.push(Object.assign({},yt,{namespace:vt.namespace,properties:vt.properties,uniqueFeatureID:vt.uniqueFeatureID}))};for(const ut of g)if("featuresetId"in ut.target){const{featuresetId:pt,importId:yt}=ut.target,vt=this.getFragmentStyle(yt);if(!vt||!vt._featuresetSelectors)continue;const Mt=vt._featuresetSelectors[pt];if(!Mt){this.fire(new h.y(new Error(`The featureset '${pt}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const Et of Mt){const Lt=vt.getOwnLayer(Et.layerId);Lt&&!L_.has(Lt.type)&&st(Lt,vt.getOwnLayerSourceCache(Lt),ut,Et)}}else if("layerId"in ut.target){const{layerId:pt}=ut.target,yt=this.getLayer(pt);if(!yt||L_.has(yt.type))continue;st(yt,this.getLayerSourceCache(yt),ut)}const lt=this._queryRenderedFeatures(o,nt,_e);return this._flattenAndSortRenderedFeatures(lt)}_queryRenderedFeatures(o,g,_e){const nt=[],st=!!this.map._showQueryGeometry,lt=ho.createFromScreenPoints(o,_e);for(const ut in g){const pt=Yp(lt,g[ut],this._availableImages,_e,st);Object.keys(pt).length&&nt.push(pt)}if(this.placement)for(const ut in g){if(!g[ut].sourceCache._onlySymbols)continue;const pt=ey(lt.screenGeometry,g[ut],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(pt).length&&nt.push(pt)}return nt}querySourceFeatures(o,g){const _e=g&&g.filter;_e&&this._validate(Wt,"querySourceFeatures.filter",_e,null,g);let nt=[];const st=this.getOwnSourceCaches(o);for(const lt of st)nt=nt.concat(gu(lt,g));return nt}addSourceType(o,g,_e){return Yu.getSourceType(o)?_e(new Error(`A source type called "${o}" already exists.`)):(Yu.setSourceType(o,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:g.workerSourceURL},_e):_e(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,g,_e={}){this._checkLoaded();const nt=this.light.getLight();let st=!1;for(const ut in o)if(!h.by(o[ut],nt[ut])){st=!0;break}if(!st)return;const lt=this._getTransitionParameters();this.light.setLight(o,g,_e),this.light.updateTransitions(lt)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=h.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&h.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,g=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),g===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _e=o;const nt=o.source==null;if(g===1){if(this.disableElevatedTerrain)return;if(typeof _e.source=="object"){const ut="terrain-dem-src";this.addSource(ut,_e.source),_e=h.dk(_e),_e=Object.assign(_e,{source:ut})}const st=Object.assign({},_e),lt={};if(this.terrain&&nt){st.source=this.terrain.get().source;const ut=this.terrain?this.getFragmentStyle(this.terrain.scope):null;ut&&(lt.style=ut.serialize())}if(this._validate(yn,"terrain",st,lt))return}if(!this.terrain||this.terrain.scope!==this.scope&&!nt||this.terrain&&g!==this.terrain.drapeRenderMode){if(!_e)return;this._createTerrain(_e,g),this.fire(new h.z("data",{dataType:"style"}))}else{const st=this.terrain,lt=st.get();for(const ut of Object.keys(h.a6.terrain))!_e.hasOwnProperty(ut)&&h.a6.terrain[ut].default&&(_e[ut]=h.a6.terrain[ut].default);for(const ut in o)if(!h.by(o[ut],lt[ut])){st.set(o,this.options),this.stylesheet.terrain=o;const pt=this._getTransitionParameters({duration:0});st.updateTransitions(pt),this.fire(new h.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const g=this.fog=new Fs(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=g.get();const _e=this._getTransitionParameters({duration:0});g.updateTransitions(_e)}_createSnow(o){const g=this.snow=new na(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=g.get();const _e=this._getTransitionParameters({duration:0});g.updateTransitions(_e)}_createRain(o){const g=this.rain=new ao(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=g.get();const _e=this._getTransitionParameters({duration:0});g.updateTransitions(_e)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const g=this.fog;if(!h.by(g.get(),o)){g.set(o,this.options),this.stylesheet.fog=g.get();const _e=this._getTransitionParameters({duration:0});g.updateTransitions(_e)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const g=this.snow;if(!h.by(g.get(),o)){g.set(o,this.options),this.stylesheet.snow=g.get();const _e=this._getTransitionParameters({duration:0});g.updateTransitions(_e)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const g=this.rain;if(!h.by(g.get(),o)){g.set(o,this.options),this.stylesheet.rain=g.get();const _e=this._getTransitionParameters({duration:0});g.updateTransitions(_e)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){const o=()=>{for(const nt in this._layers)this._layers[nt].lut=this._styleColorTheme.lut;for(const nt in this._sourceCaches)this._sourceCaches[nt].clearTiles()},g=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!g)return this._styleColorTheme.lut=null,void o();const _e=this._evaluateColorThemeData(g);this._loadColorTheme(_e).then(()=>{this.fire(new h.z("colorthemeset")),o()}).catch(nt=>{h.w(`Couldn't set color theme: ${nt}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&h.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,g){const _e=this.getFragmentStyle(o);_e&&(_e._styleColorTheme.colorThemeOverride=g,_e._reloadColorTheme())}_getTransitionParameters(o){return{now:h.o.now(),transition:Object.assign(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],g=[];for(const _e of this._mergedOrder)this.isLayerDraped(this._mergedLayers[_e])?o.push(_e):g.push(_e);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...g)}_createTerrain(o,g){const _e=this.terrain=new Xr(o,g,this.scope,this.options,this.map.getWorldview());g===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const nt=this._getTransitionParameters({duration:0});_e.updateTransitions(nt)}_force3DLayerUpdate(){for(const o in this._layers){const g=this._layers[o];g.type==="fill-extrusion"&&this._updateLayer(g)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const g=this._layers[o];g.type==="symbol"&&this._updateLayer(g)}}_validate(o,g,_e,nt,st={}){if(st&&st.validate===!1)return!1;const lt=Object.assign({},this.serialize());return km(this,o.call(wu,Object.assign({key:g,style:lt,value:_e,styleSpec:h.a6},nt)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){const g=this.getSourceCaches(o);for(const _e of g)_e.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}clearLayers(){for(const o in this._mergedLayers){const g=this._mergedLayers[o];g._clear&&g._clear()}}reloadSource(o){const g=this.getSourceCaches(o);for(const _e of g)_e.resume(),_e.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let g;this.directionalLight&&(g=fy(this.directionalLight));const _e=new Set;for(const nt in this._mergedLayers){const st=this._mergedLayers[nt];st.hasElevation()&&!_e.has(st.source)&&_e.add(st.source)}for(const nt in this._mergedSourceCaches){const st=this._mergedSourceCaches[nt],lt=_e.has(st._source.id);st.update(o,void 0,void 0,g,lt)}}_generateCollisionBoxes(){for(const o in this._sourceCaches){const g=this._sourceCaches[o];g.resume(),g.reload()}}_updatePlacement(o,g,_e,nt,st,lt,ut=!1){let pt=!1,yt=!1;const vt={},Mt={};for(const Et of this._mergedOrder){const Lt=this._mergedLayers[Et];if(Lt.type!=="symbol")continue;const Ft=h.B(Lt.source,Lt.scope);let Ot=vt[Ft];if(!Ot){const $t=this.getLayerSourceCache(Lt);if(!$t)continue;const Yt=$t.getRenderableIds(!0).map(tr=>$t.getTileByID(tr));Mt[Ft]=Yt.slice(),Ot=vt[Ft]=Yt.sort((tr,sr)=>sr.tileID.overscaledZ-tr.tileID.overscaledZ||(tr.tileID.isLessThan(sr.tileID)?-1:1))}const qt=this.crossTileSymbolIndex.addLayer(Lt,Ot,g.center.lng,g.projection);pt=pt||qt}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),ut=ut||this._layerOrderChanged||nt===0,this._layerOrderChanged&&this.fire(new h.z("neworder")),(ut||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.o.now(),g.zoom))&&(this.pauseablePlacement=new Dr(g,this._mergedOrder,ut,_e,nt,st,this.placement,this.fog&&g.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,vt,Mt,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.o.now()),yt=!0),pt&&this.pauseablePlacement.placement.setStale()),yt||pt){this._buildingIndex.onNewFrame(g.zoom);for(let Et=0;Et<this._mergedOrder.length;Et++){const Lt=this._mergedLayers[this._mergedOrder[Et]];if(Lt.type!=="symbol")continue;const Ft=this.isLayerClipped(Lt);this.placement.updateLayerOpacities(Lt,vt[h.B(Lt.source,Lt.scope)],Et,Ft?lt:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.o.now())}}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,g){this._checkLoaded();const _e=this.stylesheet.imports=this.stylesheet.imports||[];if(_e.findIndex(({id:st})=>st===o.id)!==-1)return void this.fire(new h.y(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!g)return _e.push(o),this._loadImports([o],!0);const nt=_e.findIndex(({id:st})=>st===g);return nt===-1&&this.fire(new h.y(new Error(`Import with id "${g}" does not exist on this map.`))),this.stylesheet.imports=_e.slice(0,nt).concat(o).concat(_e.slice(nt)),this._loadImports([o],!0,g)}updateImport(o,g){this._checkLoaded();const _e=this.stylesheet.imports||[],nt=this.getImportIndex(o);return nt===-1?this:typeof g=="string"?(this.setImportUrl(o,g),this):(g.url&&g.url!==_e[nt].url&&this.setImportUrl(o,g.url),h.by(g.config,_e[nt].config)||this.setImportConfig(o,g.config,g.data.schema),h.by(g.data,_e[nt].data)||this.setImportData(o,g.data),this)}moveImport(o,g){this._checkLoaded();let _e=this.stylesheet.imports||[];const nt=this.getImportIndex(o);if(nt===-1)return this;const st=this.getImportIndex(g);if(st===-1)return this;const lt=_e[nt],ut=this.fragments[nt];return _e=_e.filter(({id:pt})=>pt!==o),this.fragments=this.fragments.filter(({id:pt})=>pt!==o),this.stylesheet.imports=_e.slice(0,st).concat(lt).concat(_e.slice(st)),this.fragments=this.fragments.slice(0,st).concat(ut).concat(this.fragments.slice(st)),this.mergeLayers(),this}setImportUrl(o,g){this._checkLoaded();const _e=this.stylesheet.imports||[],nt=this.getImportIndex(o);if(nt===-1)return this;_e[nt].url=g;const st=this.fragments[nt];return st.style=this._createFragmentStyle(_e[nt]),st.style.on("style.import.load",()=>this.mergeAll()),st.style.loadURL(g),this}setImportData(o,g){this._checkLoaded();const _e=this.getImportIndex(o),nt=this.stylesheet.imports||[];return _e===-1?this:g?(this.fragments[_e].style.setState(g),this._reloadImports(),this):(delete nt[_e].data,this.setImportUrl(o,nt[_e].url))}setImportConfig(o,g,_e){this._checkLoaded();const nt=this.getImportIndex(o),st=this.stylesheet.imports||[];if(nt===-1)return this;g?st[nt].config=g:delete st[nt].config;const lt=this.fragments[nt];_e&&lt.style.stylesheet&&(lt.style.stylesheet.schema=_e);const ut=lt.style.stylesheet&&lt.style.stylesheet.schema;return lt.config=g,lt.style.updateConfig(g,ut),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const g=this.stylesheet.imports||[],_e=this.getImportIndex(o);_e!==-1&&(g.splice(_e,1),this.fragments[_e].style._remove(),this.fragments.splice(_e,1),this._reloadImports())}getImportIndex(o){const g=(this.stylesheet.imports||[]).findIndex(_e=>_e.id===o);return g===-1&&this.fire(new h.y(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),g}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const g in this._mergedOtherSourceCaches){const _e=this._mergedOtherSourceCaches[g];_e&&o.push(_e.getSource())}return o}getSource(o,g){const _e=this.getSourceCache(o,g);return _e&&_e.getSource()}getLayerSource(o){const g=this.getLayerSourceCache(o);return g&&g.getSource()}getSourceCache(o,g){const _e=h.B(o,g);return this._mergedOtherSourceCaches[_e]}getLayerSourceCache(o){const g=h.B(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[g]:this._mergedOtherSourceCaches[g]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);const g=[];return this._mergedOtherSourceCaches[o]&&g.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&g.push(this._mergedSymbolSourceCaches[o]),g}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const g in o){const _e=o[g];_e==="reload"?this.reloadSource(g):_e==="clear"&&this.clearSource(g)}}updateLayers(o){const g=this._changes.getUpdatedPaintProperties();for(const _e of g){const nt=this.getLayer(_e);nt&&nt.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o)}getImages(o,g,_e){this.imageManager.getImages(g.images,g.scope,_e),this._updateTilesForChangedImages();const nt=lt=>{if(lt){const ut=g.images.map(pt=>h.I.toString(pt));lt.setDependencies(g.tileID.key,g.type,ut)}},st=h.B(g.source,g.scope);nt(this._mergedOtherSourceCaches[st]),nt(this._mergedSymbolSourceCaches[st]),g.images.some(lt=>lt.iconsetId)&&this.fire(new h.z("data",{dataType:"style"}))}rasterizeImages(o,g,_e){this.imageManager.rasterizeImages(g,_e)}getGlyphs(o,g,_e){this.glyphManager.getGlyphs(g.stacks,_e)}getResource(o,g,_e){return h.dv(g,_e)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const g=[];return this._otherSourceCaches[o]&&g.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&g.push(this._symbolSourceCaches[o]),g}_isSourceCacheLoaded(o){const g=this.getOwnSourceCaches(o);return g.length===0?(this.fire(new h.y(new Error(`There is no source with ID '${o}'`))),!1):g.every(_e=>_e.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,g){if(!this._clipLayerPresent&&o.type!=="fill-extrusion"&&o.type!=="building")return!1;const _e=o.type==="fill-extrusion"&&(o.sourceLayer==="building"||o.sourceLayer==="procedural_buildings"),nt=o.type==="building";if(o.is3D(!!this.terrain)){if(_e||nt||g&&g.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Yu.getSourceType=function(et){return Rp[et]},Yu.setSourceType=function(et,o){Rp[et]=o},Yu.registerForPluginStateChange=h.dw;class M0{execute(o){const g=this._makeBuildingsQueryArea(o),_e=this._makeFloorsQueryArea(o),nt=o.queryRenderedFeatures(g).reduce((yt,vt)=>{const Mt=vt.properties.id;return vt.properties.type!=="building"||yt.some(Et=>Et.properties.id===Mt)||yt.push(vt),yt},[]),st=o.queryRenderedFeatures(_e).reduce((yt,vt)=>{const Mt=vt.properties.id;return vt.properties.type!=="floor"||yt.some(Et=>Et.properties.id===Mt)||yt.push(vt),yt},[]),lt=[o.getCenter().lng,o.getCenter().lat],ut=this._findBuildingAtCenter(lt,nt),pt=nt.length>0?nt[0]:null;return{floors:st.map(yt=>({id:yt.properties.id,name:yt.properties.name,isDefault:yt.properties.is_default,zIndex:yt.properties.z_index,connectedFloorIds:yt.properties.connected_floor_ids,conflictedFloorIds:yt.properties.conflicted_floor_ids,buildingIds:yt.properties.building_ids})),building:ut?{id:ut.properties.id,name:ut.properties.name}:{id:pt.properties.id,name:pt.properties.name}}}_makeBuildingsQueryArea(o){const g=o.transform.width,_e=o.transform.height,nt=Math.min(g,_e)*(1/8),st=.5*(g-nt),lt=.5*(_e-nt);return[new h.P(st,lt),new h.P(st+nt,lt+nt)]}_makeFloorsQueryArea(o){const g=o.transform.width,_e=o.transform.height;return[new h.P(0,0),new h.P(g,_e)]}_findBuildingAtCenter(o,g){for(const _e of g)if(_e.geometry.type==="Polygon"&&this._pointInPolygon(o,_e.geometry.coordinates[0]))return _e;return null}_pointInPolygon(o,g){let _e=!1;for(let nt=0,st=g.length-1;nt<g.length;st=nt++){const lt=g[nt][0],ut=g[nt][1],pt=g[st][1];ut>o[1]!=pt>o[1]&&o[0]<(g[st][0]-lt)*(o[1]-ut)/(pt-ut)+lt&&(_e=!_e)}return _e}}class k0{constructor(){this._floors=new Map,this._buildings=new Map}append(o){const g=o.building;let _e=!1;if(g){const nt=g.id;nt&&(this._buildings.set(nt,g),_e||this._buildings.has(nt)||(_e=!0))}return o.floors.forEach(nt=>{const st=nt.id;_e||this._floors.has(st)||(_e=!0),this._floors.set(st,nt)}),_e}clear(){this._floors.clear(),this._buildings.clear()}getFloors(o=null){const g=Array.from(this._floors.values());return o?g.filter(_e=>{const nt=_e.buildingIds;return!!nt&&nt.split(";").includes(o)}):g}}class D0{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new k0}setIndoorData(o){const g=this._featuresStorage.append(o);return this._selectedBuildingId=o.building?o.building.id:null,g}setFloorId(o){const g=this._selectedFloorId!==o;return g&&(this._selectedFloorId=o),g}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const o=this._featuresStorage.getFloors(this._selectedBuildingId),g=this.getActiveFloors().find(_e=>{const nt=_e.buildingIds;if(!nt)return!1;const st=nt.split(";");return!!this._selectedBuildingId&&st.includes(this._selectedBuildingId)});return{selectedFloorId:g?g.id:null,floors:o}}getActiveFloors(o=!1){const g=this._featuresStorage.getFloors(),_e=g.find(pt=>pt.id===this._selectedFloorId),nt=g.filter(pt=>pt.isDefault===!0);let st=[];if(_e)return st=this._calculateCurrentActiveFloors(g,_e,nt,o),st;if(nt.length===0){const pt=this._featuresStorage.getFloors(this._selectedBuildingId);st=pt.length>0?[pt[0]]:[]}else st=nt;const lt=this._getNonConflictingLastActiveFloors(st),ut=[...st,...lt];return this._lastActiveFloors=ut,ut}hasBuildingChanged(o){return this._selectedBuildingId!==(o.building?o.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(o,g,_e,nt){if(!g)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,_e);const st=this._getConnectedFloors(g,o);return nt?this._buildExplicitSelectionFloors(g,st,_e):this._buildImplicitSelectionFloors(st,_e)}_getConnectedFloors(o,g){const _e=o.connectedFloorIds;if(!_e)return[];const nt=new Set(_e.split(";"));return g.filter(st=>nt.has(st.id))}_buildExplicitSelectionFloors(o,g,_e){const nt=[o,...g],st=this._getNonConflictingLastActiveFloors(nt),lt=[...nt,...st],ut=this._deduplicateFloors(lt),pt=this._getConflictingFloorIdsFrom(ut),yt=_e.filter(Mt=>!pt.has(Mt.id)),vt=[...ut,...yt];return this._lastActiveFloors=vt,vt}_buildImplicitSelectionFloors(o,g){const _e=this._getConflictingFloorIdsFrom(this._lastActiveFloors),nt=g.filter(lt=>!_e.has(lt.id)),st=this._deduplicateFloors([...this._lastActiveFloors,...nt]);return this._lastActiveFloors=st,st}_getNonConflictingDefaultFloors(o,g){const _e=this._getConflictingFloorIdsFrom(o),nt=g.filter(lt=>!_e.has(lt.id)),st=this._deduplicateFloors([...o,...nt]);return this._lastActiveFloors=st,st}_deduplicateFloors(o){const g=new Set;return o.filter(_e=>{const nt=_e.id;return!g.has(nt)&&(g.add(nt),!0)})}_getConflictingFloorIdsFrom(o){const g=new Set;return o.forEach(_e=>{const nt=_e.conflictedFloorIds;nt&&nt.split(";").forEach(st=>g.add(st))}),g}_getNonConflictingLastActiveFloors(o){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const g=new Set(o.map(nt=>nt.id)),_e=this._getConflictingFloorIdsFrom(o);return this._lastActiveFloors.filter(nt=>{const st=nt.id;return!g.has(st)&&!_e.has(st)})}_isFloorConflicted(o,g){const _e=o.id;return g.some(nt=>{const st=nt.conflictedFloorIds;return!!st&&st.split(";").includes(_e)})}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class Dm extends h.E{constructor(o){super(),h.aY(["_onLoad","_onMove"],this),this._map=o,this._floorSelectionState=new D0,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(o){this._floorSelectionState.setFloorId(o)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle(o=>{o.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new h.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=o.scope,this._indoorDataQuery=new M0))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const o=this._indoorDataQuery.execute(this._map);if(!o||o.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(o)){if(!o.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(o),o.building&&this._updateIndoorSelector()}else this._setIndoorData(o)}_setIndoorData(o){this._floorSelectionState.setIndoorData(o)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const o=this._floorSelectionState.getCurrentBuildingSelection(),g=o.floors.map(_e=>({id:_e.id,name:_e.name,shortName:_e.zIndex.toString(),levelOrder:_e.zIndex}));this.fire(new h.z("indoorupdate",{selectedFloorId:o.selectedFloorId,floors:g}))}_updateIndoorConfig(o=!1){const g=this._floorSelectionState.getActiveFloors(o).map(_e=>_e.id)||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",g])}}var e_=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Zx=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Xx=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,gy="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",yy=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Kx=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,F_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ou=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,O_=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Rn=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Yx=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const _y=[];Qu(e_,_y),Qu(Xx,_y),Qu(Zx,_y);const xy={"_prelude_fog.vertex.glsl":Kx,"_prelude_terrain.vertex.glsl":yy,"_prelude_shadow.vertex.glsl":Rn,"_prelude_fog.fragment.glsl":F_,"_prelude_shadow.fragment.glsl":Yx,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ou,"_prelude_raster_particle.glsl":O_},t_={};Os("",yy),Os(F_,Kx),Os(Yx,Rn),Os(Ou,""),Os(O_,"");const i_=Os(Zx,Xx),_p=e_;var z_={background:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Os(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Os(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Os("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Os(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Os(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Os("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Os("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Os("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Os(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Os(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Os(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Os(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Os(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Os(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Os("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Os("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Os(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Os(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Os("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Os(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,gy),skyboxGradient:Os(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,gy),skyboxCapture:Os(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Os(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Os(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Os(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Os(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Os("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Os("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Os("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Os("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Qu(et,o){const g=et.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _e of g)if(_e=_e.trim(),_e[0]==="#"&&_e.includes("if")&&!_e.includes("endif")){_e=_e.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const nt=_e.split(" ");for(const st of nt)o.includes(st)||o.push(st)}}function Os(et,o){const g=/#include\s+"([^"]+)"/g,_e=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,nt={},st=[],lt=[];if(et=et.replace(g,(pt,yt)=>(lt.push(yt),"")),(o=o.replace(g,(pt,yt)=>(st.push(yt),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let ut=[..._y];Qu(et,ut),Qu(o,ut);for(const pt of[...st,...lt])xy[pt]||console.error(`Undefined include: ${pt}`),t_[pt]||(t_[pt]=[],Qu(xy[pt],t_[pt])),ut=[...ut,...t_[pt]];return{fragmentSource:et=et.replace(_e,(pt,yt,vt,Mt,Et)=>(nt[Et]=!0,yt==="define"?`
#ifndef HAS_UNIFORM_u_${Et}
in ${vt} ${Mt} ${Et};
#else
uniform ${vt} ${Mt} u_${Et};
#endif
`:yt==="initialize"?`
#ifdef HAS_UNIFORM_u_${Et}
    ${vt} ${Mt} ${Et} = u_${Et};
#endif
`:yt==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Et}
    in ${vt} ${Mt} ${Et};
#endif
`:yt==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(_e,(pt,yt,vt,Mt,Et)=>{const Lt=Mt==="float"?"vec2":Mt,Ft=Et.match(/color/)?"color":Lt;return yt==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Et}
in ${vt} ${Mt} a_${Et};
#endif
`:nt[Et]?yt==="define"?`
#ifndef HAS_UNIFORM_u_${Et}
uniform lowp float u_${Et}_t;
in ${vt} ${Lt} a_${Et};
out ${vt} ${Mt} ${Et};
#else
uniform ${vt} ${Mt} u_${Et};
#endif
`:yt==="initialize"?Ft==="vec4"?`
#ifndef HAS_UNIFORM_u_${Et}
    ${Et} = a_${Et};
#else
    ${vt} ${Mt} ${Et} = u_${Et};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Et}
    ${Et} = unpack_mix_${Ft}(a_${Et}, u_${Et}_t);
#else
    ${vt} ${Mt} ${Et} = u_${Et};
#endif
`:yt==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Et}
    in ${vt} ${Mt} a_${Et};
    out ${vt} ${Mt} ${Et};
#endif
`:yt==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Et}
    ${Et} = a_${Et};
#endif
`:void 0:yt==="define"?`
#ifndef HAS_UNIFORM_u_${Et}
uniform lowp float u_${Et}_t;
in ${vt} ${Lt} a_${Et};
#else
uniform ${vt} ${Mt} u_${Et};
#endif
`:yt==="define-instanced"?Ft==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Et}0;
in vec4 a_${Et}1;
in vec4 a_${Et}2;
in vec4 a_${Et}3;
#else
uniform ${vt} ${Mt} u_${Et};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${vt} ${Lt} a_${Et};
#else
uniform ${vt} ${Mt} u_${Et};
#endif
`:yt==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Et}
    ${vt} ${Mt} ${Et} = a_${Et};
#endif
`:Ft==="vec4"?`
#ifndef HAS_UNIFORM_u_${Et}
    ${vt} ${Mt} ${Et} = a_${Et};
#else
    ${vt} ${Mt} ${Et} = u_${Et};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Et}
    ${vt} ${Mt} ${Et} = unpack_mix_${Ft}(a_${Et}, u_${Et}_t);
#else
    ${vt} ${Mt} ${Et} = u_${Et};
#endif
`}),usedDefines:ut,vertexIncludes:st,fragmentIncludes:lt}}class vy{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,g,_e,nt,st,lt,ut,pt){this.context=o;let yt=this.boundPaintVertexBuffers.length!==nt.length;for(let Mt=0;!yt&&Mt<nt.length;Mt++)this.boundPaintVertexBuffers[Mt]!==nt[Mt]&&(yt=!0);let vt=this.boundDynamicVertexBuffers.length!==ut.length;for(let Mt=0;!vt&&Mt<ut.length;Mt++)this.boundDynamicVertexBuffers[Mt]!==ut[Mt]&&(vt=!0);if(!this.vao||this.boundProgram!==g||this.boundLayoutVertexBuffer!==_e||yt||vt||this.boundIndexBuffer!==st||this.boundVertexOffset!==lt)this.freshBind(g,_e,nt,st,lt,ut,pt);else{o.bindVertexArrayOES.set(this.vao);for(const Mt of ut)Mt&&(Mt.bind(),pt&&Mt.instanceCount&&Mt.setVertexAttribDivisor(o.gl,g,pt));st&&st.dynamicDraw&&st.bind()}}freshBind(o,g,_e,nt,st,lt,ut){const pt=this.context,yt=pt.gl;this.vao&&this.destroy(),this.vao=pt.gl.createVertexArray(),pt.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=g,this.boundPaintVertexBuffers=_e,this.boundIndexBuffer=nt,this.boundVertexOffset=st,this.boundDynamicVertexBuffers=lt,g.enableAttributes(yt,o),g.bind(),g.setVertexAttribPointers(yt,o,st);for(const vt of _e)vt.enableAttributes(yt,o),vt.bind(),vt.setVertexAttribPointers(yt,o,st);for(const vt of lt)vt&&(vt.enableAttributes(yt,o),vt.bind(),vt.setVertexAttribPointers(yt,o,st),ut&&vt.instanceCount&&vt.setVertexAttribDivisor(yt,o,ut));nt&&nt.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function yw(et,o){const g=Math.pow(2,o.canonical.z),_e=o.canonical.y;return[new h.ae(0,_e/g).toLngLat().lat,new h.ae(0,(_e+1)/g).toLngLat().lat]}function _w(et,o,g,_e,nt,st,lt){const ut=et.context,pt=ut.gl,yt=g.hillshadeFBO;if(!yt)return;et.prepareDrawTile();const vt=et.isTileAffectedByFog(o),Mt=et.getOrCreateProgram("hillshade",{overrideFog:vt});ut.activeTexture.set(pt.TEXTURE0),pt.bindTexture(pt.TEXTURE_2D,yt.colorAttachment.get());const Et=((qt,$t,Yt,tr)=>{const sr=Yt.paint.get("hillshade-shadow-color"),pr=Yt.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",hr=Yt.paint.get("hillshade-highlight-color"),gr=Yt.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",dr=Yt.paint.get("hillshade-accent-color"),ur=Yt.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",yr=Yt.paint.get("hillshade-emissive-strength");let Vr=h.an(Yt.paint.get("hillshade-illumination-direction"));if(Yt.paint.get("hillshade-illumination-anchor")==="viewport")Vr-=qt.transform.angle;else if(qt.style&&qt.style.enable3dLights()&&qt.style.directionalLight){const Qr=qt.style.directionalLight.properties.get("direction"),Nr=h.d3(Qr.x,Qr.y,Qr.z);Vr=h.an(Nr[1])}const Ir=!qt.options.moving;return{u_matrix:tr||qt.transform.calculateProjMatrix($t.tileID.toUnwrapped(),Ir),u_image:0,u_latrange:yw(0,$t.tileID),u_light:[Yt.paint.get("hillshade-exaggeration"),Vr],u_shadow:sr.toPremultipliedRenderColor(pr?null:Yt.lut),u_highlight:hr.toPremultipliedRenderColor(gr?null:Yt.lut),u_emissive_strength:yr,u_accent:dr.toPremultipliedRenderColor(ur?null:Yt.lut)}})(et,g,_e,et.terrain?o.projMatrix:null);et.uploadCommonUniforms(ut,Mt,o.toUnwrapped());const{tileBoundsBuffer:Lt,tileBoundsIndexBuffer:Ft,tileBoundsSegments:Ot}=et.getTileBoundsBuffers(g);Mt.draw(et,pt.TRIANGLES,nt,st,lt,ts.disabled,Et,_e.id,Lt,Ft,Ot)}function N_(et,o,g){if(!o.needsDEMTextureUpload)return;const _e=et.context,nt=_e.gl;_e.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||et.getTileTexture(g.stride);const st=g.getPixels();o.demTexture?o.demTexture.update(st,{premultiply:!1}):o.demTexture=new h.T(_e,st,nt.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function xw(et,o,g){const _e=et.context,nt=_e.gl;if(!o.dem)return;const st=o.dem;if(_e.activeTexture.set(nt.TEXTURE1),N_(et,o,st),!o.demTexture)return;o.demTexture.bind(nt.NEAREST,nt.CLAMP_TO_EDGE);const lt=st.dim;_e.activeTexture.set(nt.TEXTURE0);let ut=o.hillshadeFBO;if(!ut){const Et=new h.T(_e,{width:lt,height:lt,data:null},nt.RGBA8);Et.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),ut=o.hillshadeFBO=_e.createFramebuffer(lt,lt,!0,"renderbuffer"),ut.colorAttachment.set(Et.texture)}_e.bindFramebuffer.set(ut.framebuffer),_e.viewport.set([0,0,lt,lt]);const{tileBoundsBuffer:pt,tileBoundsIndexBuffer:yt,tileBoundsSegments:vt}=et.getMercatorTileBoundsBuffers(),Mt=[];et.linearFloatFilteringSupported()&&Mt.push("TERRAIN_DEM_FLOAT_FORMAT"),et.getOrCreateProgram("hillshadePrepare",{defines:Mt}).draw(et,nt.TRIANGLES,fn.disabled,Vn.disabled,Pn.unblended,ts.disabled,((Et,Lt)=>{const Ft=Lt.stride,Ot=h.bC();return h.cd(Ot,0,h.al,-h.al,0,0,1),h.br(Ot,Ot,[0,-h.al,0]),{u_matrix:Ot,u_image:1,u_dimension:[Ft,Ft],u_zoom:Et.overscaledZ}})(o.tileID,st),g.id,pt,yt,vt),o.needsHillshadePrepare=!1}class No{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class L0 extends No{getDefault(){return h.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const g=this.current;(o.r!==g.r||o.g!==g.g||o.b!==g.b||o.a!==g.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Qx extends No{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class bw extends No{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class ww extends No{getDefault(){return[!0,!0,!0,!0]}set(o){const g=this.current;(o[0]!==g[0]||o[1]!==g[1]||o[2]!==g[2]||o[3]!==g[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Ew extends No{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Tw extends No{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class j0 extends No{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const g=this.current;(o.func!==g.func||o.ref!==g.ref||o.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Sw extends No{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const g=this.current;(o[0]!==g[0]||o[1]!==g[1]||o[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class B_ extends No{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const g=this.gl;o?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=o,this.dirty=!1}}class Cw extends No{getDefault(){return[0,1]}set(o){const g=this.current;(o[0]!==g[0]||o[1]!==g[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class F0 extends No{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const g=this.gl;o?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=o,this.dirty=!1}}class Jx extends No{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class V_ extends No{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const g=this.gl;o?g.enable(g.BLEND):g.disable(g.BLEND),this.current=o,this.dirty=!1}}class ev extends No{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const g=this.current;(o[0]!==g[0]||o[1]!==g[1]||o[2]!==g[2]||o[3]!==g[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Lm extends No{getDefault(){return h.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const g=this.current;(o.r!==g.r||o.g!==g.g||o.b!==g.b||o.a!==g.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class by extends No{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class U_ extends No{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const g=this.gl;o?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=o,this.dirty=!1}}class G_ extends No{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class wy extends No{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let O0=class extends No{getDefault(){return null}set(et){(et!==this.current||this.dirty)&&(this.gl.useProgram(et),this.current=et,this.dirty=!1)}};class tv extends No{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class z0 extends No{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const g=this.current;(o[0]!==g[0]||o[1]!==g[1]||o[2]!==g[2]||o[3]!==g[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Ey extends No{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class $_ extends No{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class H_ extends No{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const g=this.gl;g.bindTexture(g.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class iv extends No{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class W_ extends No{getDefault(){return null}set(o){const g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class r_ extends No{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class N0 extends No{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class B0 extends No{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class V0 extends No{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class am extends No{constructor(o,g){super(o),this.context=o,this.parent=g}getDefault(){return null}}class U0 extends am{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class G0 extends am{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,this.attachment(),g.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Aw extends am{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,this.attachment(),g.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Rw extends G0{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const rv=(et,o,g)=>({u_matrix:et,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:g}),q_=(et,o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt,Et,Lt,Ft,Ot)=>({u_proj_matrix:Float32Array.from(et),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(_e),u_merc_matrix:g,u_zoom_transition:nt,u_merc_center:st,u_image0:0,u_frustum_tl:lt,u_frustum_tr:ut,u_frustum_br:pt,u_frustum_bl:yt,u_globe_pos:vt,u_globe_radius:Mt,u_viewport:Et,u_grid_matrix:Ot?Float32Array.from(Ot):new Float32Array(9),u_skirt_height:Lt,u_far_z_cutoff:Ft});function Z_(et,o){return et!=null&&o!=null&&!(!et.hasData()||!o.hasData())&&et.demTexture!=null&&o.demTexture!=null&&et.tileID.key!==o.tileID.key}const lm=new class{constructor(){this.operations={}}newMorphing(et,o,g,_e,nt){if(et in this.operations){const st=this.operations[et];st.to.tileID.key!==g.tileID.key&&(st.queued=g)}else this.operations[et]={startTime:_e,phase:0,duration:nt,from:o,to:g,queued:null}}getMorphValuesForProxy(et){if(!(et in this.operations))return null;const o=this.operations[et];return{from:o.from,to:o.to,phase:o.phase}}update(et){for(const o in this.operations){const g=this.operations[o];for(g.phase=(et-g.startTime)/g.duration;g.phase>=1||!this._validOp(g);)if(!this._nextOp(g,et)){delete this.operations[o];break}}}_nextOp(et,o){return!!et.queued&&(et.from=et.to,et.to=et.queued,et.queued=null,et.phase=0,et.startTime=o,!0)}_validOp(et){return et.from.hasData()&&et.to.hasData()}},nv={0:null,1:"TERRAIN_VERTEX_MORPHING"};function sv(et,o,g){if(o===0)return 0;const _e=o<1&&g===514?.25/o:1;return 6*Math.pow(1.5,22-et)*Math.max(o,1)*_e}function Pw(et,o){const g=1<<et.z;return!o&&(et.x===0||et.x===g-1)||et.y===0||et.y===g-1}const jm=et=>({u_matrix:et});function Fm(et,o,g,_e,nt){if(nt>0){const st=h.o.now(),lt=(st-et.timeAdded)/nt,ut=o?(st-o.timeAdded)/nt:-1,pt=g.getSource(),yt=_e.coveringZoomLevel({tileSize:pt.tileSize,roundZoom:pt.roundZoom}),vt=!o||Math.abs(o.tileID.overscaledZ-yt)>Math.abs(et.tileID.overscaledZ-yt),Mt=vt&&et.refreshedUponExpiration?1:h.aA(vt?lt:1-ut,0,1);return o?{opacity:1,mix:1-Mt,isFading:lt<1}:{opacity:Mt,mix:0,isFading:lt<1}}return{opacity:1,mix:0,isFading:!1}}class $0 extends ou{constructor(o){const g=Xp("mock-dem",{type:"raster-dem",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,g){o.state="loaded",g(null)}}class zu extends ou{constructor(o){const g=Xp("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("proxy",g,!1),g.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,g,_e){if(o.freezeTileCoverage)return;this.transform=o;const nt=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((st,lt)=>{if(st[lt.key]="",!this._tiles[lt.key]){const ut=new mp(lt,this._source.tileSize*lt.overscaleFactor(),o.tileZoom,void 0,void 0,this._source.worldview);ut.state="loaded",this._tiles[lt.key]=ut}return st},{});for(const st in this._tiles)st in nt||(this.freeFBO(st),this._tiles[st].unloadVectorData(),delete this._tiles[st])}freeFBO(o){const g=this.proxyCachedFBO[o];if(g!==void 0){const _e=Object.values(g);this.renderCachePool.push(..._e),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class X_ extends h.aO{constructor(o,g,_e){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=g,this.projMatrix=_e}}class n_ extends h.dH{constructor(o,g){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_e,nt,st]=function(pt){const yt=new h.bd,vt=new h.b1,Mt=131;yt.reserve(17161),vt.reserve(33800);const Et=h.al/128,Lt=h.al+Et/2,Ft=Lt+Et;for(let qt=-Et;qt<Ft;qt+=Et)for(let $t=-Et;$t<Ft;$t+=Et){const Yt=$t<0||$t>Lt||qt<0||qt>Lt?24575:0,tr=h.aA(Math.round($t),0,h.al),sr=h.aA(Math.round(qt),0,h.al);yt.emplaceBack(tr+Yt,sr)}const Ot=(qt,$t)=>{const Yt=$t*Mt+qt;vt.emplaceBack(Yt+1,Yt,Yt+Mt),vt.emplaceBack(Yt+Mt,Yt+Mt+1,Yt+1)};for(let qt=1;qt<129;qt++)for(let $t=1;$t<129;$t++)Ot($t,qt);return[0,129].forEach(qt=>{for(let $t=0;$t<130;$t++)Ot($t,qt),Ot(qt,$t)}),[yt,vt,32768]}(),lt=o.context;this.gridBuffer=lt.createVertexBuffer(_e,h.bf.members),this.gridIndexBuffer=lt.createIndexBuffer(nt),this.gridSegments=h.bg.simpleSegment(0,0,_e.length,nt.length),this.gridNoSkirtSegments=h.bg.simpleSegment(0,0,_e.length,st),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new zu(g.map),this.orthoMatrix=h.bC(),h.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,h.al,0,h.al,0,1);const ut=lt.gl;this._overlapStencilMode=new Vn({func:ut.GEQUAL,mask:255},0,255,ut.KEEP,ut.KEEP,ut.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=g,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new $0(g.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,g,_e){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const nt=o.terrain.properties,st=o.terrain.drapeRenderMode===0,lt=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=h.o.now();const ut=o.terrain&&o.terrain.scope,pt=nt.get("source"),yt=st?this._mockSourceCache:o.getSourceCache(pt,ut);if(!yt)return void h.w(`Couldn't find terrain source "${pt}".`);if(this.sourceCache=yt,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=lt?this.calculateExaggeration(g):nt.get("exaggeration"),!g.projection.requiresDraping&&lt&&this._exaggeration===0)return void this._disable();this.enabled=!0;const vt=()=>{this.sourceCache.used&&h.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Mt=this.getScaledDemTileSize();this.sourceCache.update(g,Mt,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,vt(),this._initializing=!0),vt(),g.updateElevation(!0,_e),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(g),this._emptyDEMTextureDirty=!0,this._previousZoom=g.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);const g=this._previousCameraAltitude,_e=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=_e;const nt=g!=null?_e-g:Number.MAX_VALUE;if(Math.abs(nt)<2)return this._exaggeration;const st=o.zoom,lt=this._style.terrain;if(!this._previousUpdateTimestamp)return lt.getExaggeration(st);let ut=st-this._previousZoom;const pt=this._previousUpdateTimestamp;let yt=st;this._evaluationZoom!=null&&(yt=this._evaluationZoom,Math.abs(st-yt)>.5&&(ut=.5*(st-yt+ut)),ut*nt<0&&(yt+=ut)),this._evaluationZoom=yt;const vt=lt.getExaggeration(yt),Mt=vt===lt.getExaggeration(Math.max(0,yt-.1));if(Mt&&Math.abs(vt-this._exaggeration)<.01)return vt;let Et=Math.min(.1,.00375*(this._updateTimestamp-pt));return(Mt||vt<.1||Math.abs(ut)<1e-4)&&(Et=Math.min(.2,4*Et)),h.ak(this._exaggeration,vt,Et)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.dataType==="source"&&o.coord?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const g=this.proxySourceCache,_e=this.painter.transform;this._initializing&&(this._initializing=_e._centerAltitude===0&&this.getAtPointOrZero(h.ae.fromLngLat(_e.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const nt=this.proxyCoords=g.getIds().map(pt=>{const yt=g.getTileByID(pt).tileID;return yt.projMatrix=_e.calculateProjMatrix(yt.toUnwrapped()),yt});(function(pt,yt){const vt=yt.transform.pointCoordinate(yt.transform.getCameraPoint()),Mt=new h.P(vt.x,vt.y);pt.sort((Et,Lt)=>{if(Lt.overscaledZ-Et.overscaledZ)return Lt.overscaledZ-Et.overscaledZ;const Ft=new h.P(Et.canonical.x+(1<<Et.canonical.z)*Et.wrap,Et.canonical.y),Ot=new h.P(Lt.canonical.x+(1<<Lt.canonical.z)*Lt.wrap,Lt.canonical.y),qt=Mt.mult(1<<Et.canonical.z);return qt.x-=.5,qt.y-=.5,qt.distSqr(Ft)-qt.distSqr(Ot)})})(nt,this.painter);const st=this.proxyToSource||{};this.proxyToSource={},nt.forEach(pt=>{this.proxyToSource[pt.key]={}}),this.terrainTileForTile={};const lt=this._style._mergedSourceCaches;for(const pt in lt){const yt=lt[pt];if(!yt.used||(yt!==this.sourceCache&&this.resetTileLookupCache(yt.id),this._setupProxiedCoordsForOrtho(yt,o[pt],st),yt.usedForTerrain))continue;const vt=o[pt];yt.getSource().reparseOverscaled&&this._assignTerrainTiles(vt)}this.proxiedCoords[g.id]=nt.map(pt=>new X_(pt,pt.key,this.orthoMatrix)),this._assignTerrainTiles(nt),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(st),this.renderingToTexture=!1;const ut={};this._visibleDemTiles=[];for(const pt of this.proxyCoords){const yt=this.terrainTileForTile[pt.key];if(!yt)continue;const vt=yt.tileID.key;vt in ut||(this._visibleDemTiles.push(yt),ut[vt]=vt)}}_assignTerrainTiles(o){this._initializing||o.forEach(g=>{if(this.terrainTileForTile[g.key])return;const _e=this._findTileCoveringTileID(g,this.sourceCache);_e&&(this.terrainTileForTile[g.key]=_e)})}_prepareDEMTextures(){const o=this.painter.context,g=o.gl;for(const _e in this.terrainTileForTile){const nt=this.terrainTileForTile[_e],st=nt.dem;!st||nt.demTexture&&!nt.needsDEMTextureUpload||(o.activeTexture.set(g.TEXTURE1),N_(this.painter,nt,st))}}_prepareDemTileUniforms(o,g,_e,nt){if(!g||g.demTexture==null)return!1;const st=o.tileID.canonical,lt=Math.pow(2,g.tileID.canonical.z-st.z),ut=nt||"";return _e[`u_dem_tl${ut}`]=[st.x*lt%1,st.y*lt%1],_e[`u_dem_scale${ut}`]=lt,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0;const g=this._visibleDemTiles.reduce((_e,nt)=>{if(!nt.dem)return _e;const st=nt.dem.tree.minimums[0];return st>0&&o++,_e+st},0);return o?g/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,g=o.gl;o.activeTexture.set(g.TEXTURE2);const _e=this._getLoadedAreaMinimum(),nt=new h.dI({width:1,height:1},new Float32Array([_e]));this._emptyDEMTextureDirty=!1;let st=this._emptyDEMTexture;return st?st.update(nt,{premultiply:!1}):st=this._emptyDEMTexture=new h.T(o,nt,g.R32F,{premultiply:!1}),st}setupElevationDraw(o,g,_e){const nt=this.painter.context,st=nt.gl,lt={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};lt.u_exaggeration=this.exaggeration();let ut=null,pt=null,yt=1;if(_e&&_e.morphing&&this._useVertexMorphing){const Lt=_e.morphing.srcDemTile,Ft=_e.morphing.dstDemTile;yt=_e.morphing.phase,Lt&&Ft&&(this._prepareDemTileUniforms(o,Lt,lt,"_prev")&&(pt=Lt),this._prepareDemTileUniforms(o,Ft,lt)&&(ut=Ft))}const vt=Lt=>Lt&&Lt.demTexture&&this.painter.linearFloatFilteringSupported()?st.LINEAR:st.NEAREST;let Mt=null;var Et;if(this.enabled?pt&&ut?(Mt=ut.demTexture,nt.activeTexture.set(st.TEXTURE4),pt.demTexture.bind(vt(pt),st.CLAMP_TO_EDGE),lt.u_dem_lerp=yt):(ut=this.terrainTileForTile[o.tileID.key],Mt=this._prepareDemTileUniforms(o,ut,lt)?ut.demTexture:this.emptyDEMTexture):Mt=this.emptyDEMTexture,nt.activeTexture.set(st.TEXTURE2),Mt&&(lt.u_dem_size=(Et=Mt).size[0]===1?1:Et.size[0]-2,Mt.bind(vt(ut),st.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(_e&&_e.useDepthForOcclusion,g,lt),_e&&_e.useMeterToDem&&ut){const Lt=(1<<ut.tileID.canonical.z)*h.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;lt.u_meter_to_dem=Lt}if(_e&&_e.labelPlaneMatrixInv&&(lt.u_label_plane_matrix_inv=_e.labelPlaneMatrixInv),g.setTerrainUniformValues(nt,lt),this.painter.transform.projection.name==="globe"){const Lt=this.globeUniformValues(this.painter.transform,o.tileID.canonical,_e&&_e.useDenormalizedUpVectorScale);g.setGlobeUniformValues(nt,Lt)}}globeUniformValues(o,g,_e){const nt=o.projection;return{u_tile_tl_up:nt.upVector(g,0,0),u_tile_tr_up:nt.upVector(g,h.al,0),u_tile_br_up:nt.upVector(g,h.al,h.al),u_tile_bl_up:nt.upVector(g,0,h.al),u_tile_up_scale:_e?h.dJ(1):nt.upVectorScale(g,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const g=this.painter,_e=this.painter.context;o.length!==0&&(_e.bindFramebuffer.set(null),_e.viewport.set([0,0,g.width,g.height]),g.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(nt,st,lt,ut,pt){if(nt.transform.projection.name==="globe")(function(yt,vt,Mt,Et,Lt){const Ft=yt.context,Ot=Ft.gl;let qt,$t;const Yt=yt.transform,tr=h.dA(yt,Ft,Yt),sr=(Qr,Nr)=>{if($t===Nr)return;const Yr=[nv[Nr],"PROJECTION_GLOBE_VIEW"];tr&&Yr.push("CUSTOM_ANTIALIASING");const Cn=yt.isTileAffectedByFog(Qr);qt=yt.getOrCreateProgram("globeRaster",{defines:Yr,overrideFog:Cn}),$t=Nr},pr=yt.colorModeForRenderPass(),hr=new fn(Ot.LEQUAL,fn.ReadWrite,yt.depthRangeFor3D);lm.update(Lt);const gr=h.dB(Yt),dr=[h.aF(Yt.center.lng),h.aJ(Yt.center.lat)],ur=yt.globeSharedBuffers,yr=[Yt.width*h.o.devicePixelRatio,Yt.height*h.o.devicePixelRatio],Vr=Float32Array.from(Yt.globeMatrix),Ir={useDenormalizedUpVectorScale:!0};{const Qr=yt.transform,Nr=sv(Qr.zoom,vt.exaggeration(),vt.sourceCache._source.tileSize);$t=-1;const Yr=Ot.TRIANGLES;for(const Cn of Et){const Br=Mt.getTile(Cn),Tr=Vn.disabled,en=vt.prevTerrainTileForTile[Cn.key],Hr=vt.terrainTileForTile[Cn.key];Z_(en,Hr)&&lm.newMorphing(Cn.key,en,Hr,Lt,250),Ft.activeTexture.set(Ot.TEXTURE0),Br.texture&&Br.texture.bind(Ot.LINEAR,Ot.CLAMP_TO_EDGE);const un=lm.getMorphValuesForProxy(Cn.key),Tn=un?1:0;un&&Object.assign(Ir,{morphing:{srcDemTile:un.from,dstDemTile:un.to,phase:h.dz(un.phase)}});const Ln=h.dC(Cn.canonical),xn=h.dD(Ln.getCenter().lat),mn=h.dE(Cn.canonical,Ln,xn,Qr.worldSize/Qr._pixelsPerMercatorPixel),Xn=h.bk(h.dF(Cn.canonical)),Gn=q_(Qr.expandedFarZProjMatrix,Vr,gr,Xn,h.aj(Qr.zoom),dr,Qr.frustumCorners.TL,Qr.frustumCorners.TR,Qr.frustumCorners.BR,Qr.frustumCorners.BL,Qr.globeCenterInViewSpace,Qr.globeRadius,yr,Nr,Qr._farZ,mn);if(sr(Cn,Tn),qt&&(vt.setupElevationDraw(Br,qt,Ir),yt.uploadCommonUniforms(Ft,qt,Cn.toUnwrapped()),ur)){const[Wn,Un,hs]=ur.getGridBuffers(xn,Nr!==0);qt.draw(yt,Yr,hr,Tr,pr,ts.backCCW,Gn,"globe_raster",Wn,Un,hs)}}}if(ur&&(yt.renderDefaultNorthPole||yt.renderDefaultSouthPole)){const Qr=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];tr&&Qr.push("CUSTOM_ANTIALIASING"),qt=yt.getOrCreateProgram("globeRaster",{defines:Qr});for(const Nr of Et){const{x:Yr,y:Cn,z:Br}=Nr.canonical,Tr=Cn===0,en=Cn===(1<<Br)-1,[Hr,un,Tn,Ln]=ur.getPoleBuffers(Br,!1);if(Ln&&(Tr||en)){const xn=Mt.getTile(Nr);Ft.activeTexture.set(Ot.TEXTURE0),xn.texture&&xn.texture.bind(Ot.LINEAR,Ot.CLAMP_TO_EDGE);let mn=h.dG(Br,Yr,Yt);const Xn=h.bk(h.dF(Nr.canonical)),Gn=(Wn,Un)=>Wn.draw(yt,Ot.TRIANGLES,hr,Vn.disabled,pr,ts.disabled,q_(Yt.expandedFarZProjMatrix,mn,mn,Xn,0,dr,Yt.frustumCorners.TL,Yt.frustumCorners.TR,Yt.frustumCorners.BR,Yt.frustumCorners.BL,Yt.globeCenterInViewSpace,Yt.globeRadius,yr,0,Yt._farZ),"globe_pole_raster",Un,Tn,Ln);vt.setupElevationDraw(xn,qt,Ir),yt.uploadCommonUniforms(Ft,qt,Nr.toUnwrapped()),Tr&&yt.renderDefaultNorthPole&&Gn(qt,Hr),en&&yt.renderDefaultSouthPole&&(mn=h.cR(h.bC(),mn,[1,-1,1]),Gn(qt,un))}}}})(nt,st,lt,ut,pt);else{const yt=nt.context,vt=yt.gl;let Mt,Et;const Lt=nt.shadowRenderer,Ft=Fu(nt,nt.longestCutoffRange),Ot=pr=>{if(Et===pr)return;const hr=[];hr.push(nv[pr]),Ft.shouldRenderCutoff&&hr.push("RENDER_CUTOFF"),Lt&&(hr.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Lt.useNormalOffset&&hr.push("NORMAL_OFFSET")),Mt=nt.getOrCreateProgram("terrainRaster",{defines:hr}),Et=pr},qt=nt.colorModeForRenderPass(),$t=new fn(vt.LEQUAL,fn.ReadWrite,nt.depthRangeFor3D);lm.update(pt);const Yt=nt.transform,tr=sv(Yt.zoom,st.exaggeration(),st.sourceCache._source.tileSize);let sr=[0,0,0];if(Lt){const pr=nt.style.directionalLight,hr=nt.style.ambientLight;pr&&hr&&(sr=sp(nt.style,pr,hr))}{Et=-1;const pr=vt.TRIANGLES,[hr,gr]=[st.gridIndexBuffer,st.gridSegments];for(const dr of ut){const ur=lt.getTile(dr),yr=Vn.disabled,Vr=st.prevTerrainTileForTile[dr.key],Ir=st.terrainTileForTile[dr.key];Z_(Vr,Ir)&&lm.newMorphing(dr.key,Vr,Ir,pt,250),yt.activeTexture.set(vt.TEXTURE0),ur.texture&&ur.texture.bind(vt.LINEAR,vt.CLAMP_TO_EDGE);const Qr=lm.getMorphValuesForProxy(dr.key),Nr=Qr?1:0;let Yr;Qr&&(Yr={morphing:{srcDemTile:Qr.from,dstDemTile:Qr.to,phase:h.dz(Qr.phase)}});const Cn=rv(dr.projMatrix,Pw(dr.canonical,Yt.renderWorldCopies)?tr/10:tr,sr);if(Ot(Nr),!Mt)continue;st.setupElevationDraw(ur,Mt,Yr);const Br=dr.toUnwrapped();Lt&&Lt.setupShadows(Br,Mt),nt.uploadCommonUniforms(yt,Mt,Br,null,Ft),Mt.draw(nt,pr,$t,yr,qt,ts.backCCW,Cn,"terrain_raster",st.gridBuffer,hr,gr)}}}}(g,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,g.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const g=this.painter,_e=this.painter.context,nt=this.proxySourceCache,st=this.proxiedCoords[nt.id],lt=this._drapedRenderBatches.shift(),ut=g.style.order,pt=[];let yt=0;for(const vt of st){const Mt=nt.getTileByID(vt.proxyTileKey),Et=nt.proxyCachedFBO[vt.key]?nt.proxyCachedFBO[vt.key][o]:void 0,Lt=Et!==void 0?nt.renderCache[Et]:this.pool[yt++],Ft=Et!==void 0;if(Mt.texture=Lt.tex,Ft&&!Lt.dirty){pt.push(Mt.tileID);continue}let Ot;_e.bindFramebuffer.set(Lt.fb.framebuffer),this.renderedToTile=!1,Lt.dirty&&(_e.clear({color:h.ao.transparent,stencil:0}),Lt.dirty=!1);for(let qt=lt.start;qt<=lt.end;++qt){const $t=g.style._mergedLayers[ut[qt]];if($t.isHidden(g.transform.zoom))continue;const Yt=g.style.getLayerSourceCache($t),tr=Yt?this.proxyToSource[vt.key][Yt.id]:[vt];if(!tr)continue;const sr=tr;_e.viewport.set([0,0,Lt.fb.width,Lt.fb.height]),Ot!==(Yt?Yt.id:null)&&(this._setupStencil(Lt,tr,$t,Yt),Ot=Yt?Yt.id:null),g.renderLayer(g,Yt,$t,sr)}if(this._drapedRenderBatches.length===0)for(const qt of this._pendingGroundEffectLayers){const $t=g.style._mergedLayers[ut[qt]];if($t.isHidden(g.transform.zoom))continue;const Yt=g.style.getLayerSourceCache($t),tr=Yt?this.proxyToSource[vt.key][Yt.id]:[vt];if(!tr)continue;const sr=tr;_e.viewport.set([0,0,Lt.fb.width,Lt.fb.height]),Ot!==(Yt?Yt.id:null)&&(this._setupStencil(Lt,tr,$t,Yt),Ot=Yt?Yt.id:null),g.renderLayer(g,Yt,$t,sr)}this.renderedToTile?(Lt.dirty=!0,pt.push(Mt.tileID)):Ft||--yt,yt===5&&(yt=0,this.renderToBackBuffer(pt))}return this.renderToBackBuffer(pt),this.renderingToTexture=!1,_e.bindFramebuffer.set(null),_e.viewport.set([0,0,g.width,g.height]),lt.end+1}postRender(){}isLayerOrderingCorrect(o){const g=o.order.length;let _e=-1,nt=g;for(let st=0;st<g;++st)this._style.isLayerDraped(o._mergedLayers[o.order[st]])?_e=Math.max(_e,st):nt=Math.min(nt,st);return nt>_e}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(g=>g.dem).forEach(g=>{o=Math.min(o,g.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,g,_e){if(!this._visibleDemTiles)return null;const nt=this._visibleDemTiles.filter(st=>st.dem).map(st=>{const lt=st.tileID,ut=1<<lt.overscaledZ,{x:pt,y:yt}=lt.canonical,vt=pt/ut,Mt=(pt+1)/ut,Et=yt/ut,Lt=(yt+1)/ut;return{minx:vt,miny:Et,maxx:Mt,maxy:Lt,t:st.dem.tree.raycastRoot(vt,Et,Mt,Lt,o,g,_e),tile:st}});nt.sort((st,lt)=>(st.t!==null?st.t:Number.MAX_VALUE)-(lt.t!==null?lt.t:Number.MAX_VALUE));for(const st of nt){if(st.t==null)return null;const lt=st.tile.dem.tree.raycast(st.minx,st.miny,st.maxx,st.maxy,o,g,_e);if(lt!=null)return lt}return null}_createFBO(){const o=this.painter.context,g=o.gl,_e=this.drapeBufferSize;o.activeTexture.set(g.TEXTURE0);const nt=new h.T(o,{width:_e[0],height:_e[1],data:null},g.RGBA8);nt.bind(g.LINEAR,g.CLAMP_TO_EDGE);const st=o.createFramebuffer(_e[0],_e[1],!0,null);return st.colorAttachment.set(nt.texture),st.depthAttachment=new Rw(o,st.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,_e[0],_e[1]),this._stencilRef=0,st.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):st.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&g.texParameterf(g.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:st,tex:nt,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const g=this._style._mergedLayers[o],_e=g.isHidden(this.painter.transform.zoom);return g.type==="hillshade"||g.type==="custom"?!_e&&g.shouldRedrape():!_e&&g.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const _e of this._style.getSources())if(_e instanceof Gl){o=!0;break}if(!o)return;const g={};for(let _e=0;_e<this._style.order.length;++_e){const nt=this._style._mergedLayers[this._style.order[_e]],st=this._style.getLayerSourceCache(nt);if(st&&!g[st.id]&&!nt.isHidden(this.painter.transform.zoom)&&nt.type==="line"&&nt.widthExpression()instanceof h.ad){g[st.id]=!0;for(const lt of this.proxyCoords){const ut=this.proxyToSource[lt.key][st.id];if(ut)for(const pt of ut)this._clearRenderCacheForTile(st.id,pt)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const _e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_e]._source instanceof Zp){o=!0;break}if(!o)return;const g={};for(let _e=0;_e<this._style.order.length;++_e){const nt=this._style._mergedLayers[this._style.order[_e]],st=this._style.getLayerSourceCache(nt);if(!st||g[st.id]||nt.isHidden(this.painter.transform.zoom)||nt.type!=="raster")continue;const lt=nt.paint.get("raster-fade-duration");for(const ut of this.proxyCoords){const pt=this.proxyToSource[ut.key][st.id];if(pt)for(const yt of pt){const vt=Fm(st.getTile(yt),st.findLoadedParent(yt,0),st,this.painter.transform,lt);(vt.opacity!==1||vt.mix!==0)&&this._clearRenderCacheForTile(st.id,yt)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const o=this._style.order,g=o.length;if(g===0)return;const _e=[];this._pendingGroundEffectLayers=[];let nt,st=0,lt=this._style._mergedLayers[o[st]];for(;!this._style.isLayerDraped(lt)&&lt.isHidden(this.painter.transform.zoom)&&++st<g;)lt=this._style._mergedLayers[o[st]];for(;st<g;++st){const ut=this._style._mergedLayers[o[st]];ut.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(ut)?nt===void 0&&(nt=st):(ut.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(st),nt!==void 0&&(_e.push({start:nt,end:st-1}),nt=void 0)))}if(nt!==void 0&&_e.push({start:nt,end:st-1}),_e.length!==0){const ut=_e[_e.length-1];this._pendingGroundEffectLayers.every(pt=>pt>ut.end)||h.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_e}_setupRenderCache(o){const g=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,g.renderCache.length>g.renderCachePool.length){const lt=Object.values(g.proxyCachedFBO);g.proxyCachedFBO={};for(let ut=0;ut<lt.length;++ut){const pt=Object.values(lt[ut]);g.renderCachePool.push(...pt)}}return}this._clearRasterLayersFromRenderCache();const _e=this.proxyCoords,nt=this._tilesDirty;for(let lt=_e.length-1;lt>=0;lt--){const ut=_e[lt];if(g.getTileByID(ut.key),g.proxyCachedFBO[ut.key]!==void 0){const pt=o[ut.key],yt=this.proxyToSource[ut.key];let vt=0;for(const Mt in yt){const Et=yt[Mt],Lt=pt[Mt];if(!Lt||Lt.length!==Et.length||Et.some((Ft,Ot)=>Ft!==Lt[Ot]||nt[Mt]&&nt[Mt].hasOwnProperty(Ft.key))){vt=-1;break}++vt}for(const Mt in g.proxyCachedFBO[ut.key])g.renderCache[g.proxyCachedFBO[ut.key][Mt]].dirty=vt<0||vt!==Object.values(pt).length}}const st=[...this._drapedRenderBatches];st.sort((lt,ut)=>ut.end-ut.start-(lt.end-lt.start));for(const lt of st)for(const ut of _e){if(g.proxyCachedFBO[ut.key])continue;let pt=g.renderCachePool.pop();pt===void 0&&g.renderCache.length<50&&(pt=g.renderCache.length,g.renderCache.push(this._createFBO())),pt!==void 0&&(g.proxyCachedFBO[ut.key]={},g.proxyCachedFBO[ut.key][lt.start]=pt,g.renderCache[pt].dirty=!0)}this._tilesDirty={}}_setupStencil(o,g,_e,nt){if(!nt||!this._sourceTilesOverlap[nt.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const st=this.painter.context,lt=st.gl;if(g.length<=1)return void(this._overlapStencilType=!1);let ut;if(_e.isTileClipped())ut=g.length,this._overlapStencilMode.test={func:lt.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(g[0].overscaledZ>g[g.length-1].overscaledZ))return void(this._overlapStencilType=!1);ut=1,this._overlapStencilMode.test={func:lt.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+ut>255&&(st.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=ut,this._overlapStencilMode.ref=this._stencilRef,_e.isTileClipped()&&this._renderTileClippingMasks(g,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):Vn.disabled}_renderTileClippingMasks(o,g){const _e=this.painter,nt=this.painter.context,st=nt.gl;_e._tileClippingMaskIDs={},nt.setColorMode(Pn.disabled),nt.setDepthMode(fn.disabled);const lt=_e.getOrCreateProgram("clippingMask");for(const ut of o){const pt=_e._tileClippingMaskIDs[ut.key]=--g;lt.draw(_e,st.TRIANGLES,fn.disabled,new Vn({func:st.ALWAYS,mask:0},pt,255,st.KEEP,st.KEEP,st.REPLACE),Pn.disabled,ts.disabled,jm(ut.projMatrix),"$clipping",_e.tileExtentBuffer,_e.quadTriangleIndexBuffer,_e.tileExtentSegments)}}pointCoordinate(o){const g=this.painter.transform;if(o.x<0||o.x>g.width||o.y<0||o.y>g.height)return null;const _e=[o.x,o.y,1,1];h.aC(_e,_e,g.pixelMatrixInverse),h.cJ(_e,_e,1/_e[3]),_e[0]/=g.worldSize,_e[1]/=g.worldSize;const nt=g._camera.position,st=h.ce(1,g.center.lat),lt=[nt[0],nt[1],nt[2]/st,0],ut=h.d9([],_e.slice(0,3),lt);h.aw(ut,ut);const pt=this.raycast(lt,ut,this._exaggeration);return pt!==null&&pt?(h.bH(lt,lt,ut,pt),lt[3]=lt[2],lt[2]*=st,lt):null}_setupProxiedCoordsForOrtho(o,g,_e){if(o.getSource()instanceof h.aS)return this._setupProxiedCoordsForImageSource(o,g,_e);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const nt=this.proxiedCoords[o.id]=[],st=this.proxyCoords;for(let pt=0;pt<st.length;pt++){const yt=st[pt],vt=this._findTileCoveringTileID(yt,o);if(vt){const Mt=this._createProxiedId(yt,vt,_e[yt.key]&&_e[yt.key][o.id]);nt.push(Mt),this.proxyToSource[yt.key][o.id]=[Mt]}}let lt=!1;const ut=new Set;for(let pt=0;pt<g.length;pt++){const yt=o.getTile(g[pt]);if(!yt||!yt.hasData())continue;const vt=this._findTileCoveringTileID(yt.tileID,this.proxySourceCache);if(vt&&vt.tileID.canonical.z!==yt.tileID.canonical.z){const Mt=this.proxyToSource[vt.tileID.key][o.id],Et=this._createProxiedId(vt.tileID,yt,_e[vt.tileID.key]&&_e[vt.tileID.key][o.id]);Mt?Mt.splice(Mt.length-1,0,Et):this.proxyToSource[vt.tileID.key][o.id]=[Et];const Lt=this.proxyToSource[vt.tileID.key][o.id];ut.has(Lt)||ut.add(Lt),nt.push(Et),lt=!0}}if(this._sourceTilesOverlap[o.id]=lt,lt&&this._debugParams.sortTilesHiZFirst)for(const pt of ut)pt.sort((yt,vt)=>vt.overscaledZ-yt.overscaledZ)}_setupProxiedCoordsForImageSource(o,g,_e){if(!o.getSource().loaded())return;const nt=this.proxiedCoords[o.id]=[],st=this.proxyCoords,lt=o.getSource(),ut=lt.tileID;if(!ut)return;const pt=new h.P(ut.x,ut.y)._div(1<<ut.z),yt=lt.coordinates.map(h.ae.fromLngLat).reduce((Mt,Et)=>(Mt.min.x=Math.min(Mt.min.x,Et.x-pt.x),Mt.min.y=Math.min(Mt.min.y,Et.y-pt.y),Mt.max.x=Math.max(Mt.max.x,Et.x-pt.x),Mt.max.y=Math.max(Mt.max.y,Et.y-pt.y),Mt),{min:new h.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new h.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),vt=(Mt,Et)=>{const Lt=Mt.wrap+Mt.canonical.x/(1<<Mt.canonical.z),Ft=Mt.canonical.y/(1<<Mt.canonical.z),Ot=h.al/(1<<Mt.canonical.z),qt=Et.wrap+Et.canonical.x/(1<<Et.canonical.z),$t=Et.canonical.y/(1<<Et.canonical.z);return Lt+Ot<qt+yt.min.x||Lt>qt+yt.max.x||Ft+Ot<$t+yt.min.y||Ft>$t+yt.max.y};for(let Mt=0;Mt<st.length;Mt++){const Et=st[Mt];for(let Lt=0;Lt<g.length;Lt++){const Ft=o.getTile(g[Lt]);if(!Ft||!Ft.hasData()||vt(Et,Ft.tileID))continue;const Ot=this._createProxiedId(Et,Ft,_e[Et.key]&&_e[Et.key][o.id]),qt=this.proxyToSource[Et.key][o.id];qt?qt.push(Ot):this.proxyToSource[Et.key][o.id]=[Ot],nt.push(Ot)}}}_createProxiedId(o,g,_e){let nt=this.orthoMatrix;if(_e){const st=_e.find(lt=>lt.key===g.tileID.key);if(st)return st}if(g.tileID.key!==o.key){const st=o.canonical.z-g.tileID.canonical.z;let lt,ut,pt;nt=h.bC();const yt=g.tileID.wrap-o.wrap<<o.overscaledZ;st>0?(lt=h.al>>st,ut=lt*((g.tileID.canonical.x<<st)-o.canonical.x+yt),pt=lt*((g.tileID.canonical.y<<st)-o.canonical.y)):(lt=h.al<<-st,ut=h.al*(g.tileID.canonical.x-(o.canonical.x+yt<<-st)),pt=h.al*(g.tileID.canonical.y-(o.canonical.y<<-st))),h.cd(nt,0,lt,0,lt,0,1),h.br(nt,nt,[ut,pt,0])}return new X_(g.tileID,o.key,nt)}_findTileCoveringTileID(o,g){let _e=g.getTile(o);if(_e&&_e.hasData())return _e;const nt=this._findCoveringTileCache[g.id],st=nt[o.key];if(_e=st?g.getTileByID(st):null,_e&&_e.hasData()||st===null)return _e;let lt=_e?_e.tileID:o,ut=lt.overscaledZ;const pt=g.getSource().minzoom,yt=[];if(!st){const Mt=g.getSource().maxzoom;if(o.canonical.z>=Mt){const Et=o.canonical.z-Mt;g.getSource().reparseOverscaled?(ut=Math.max(o.canonical.z+2,g.transform.tileZoom),lt=new h.aO(ut,o.wrap,Mt,o.canonical.x>>Et,o.canonical.y>>Et)):Et!==0&&(ut=Mt,lt=new h.aO(ut,o.wrap,Mt,o.canonical.x>>Et,o.canonical.y>>Et))}lt.key!==o.key&&(yt.push(lt.key),_e=g.getTile(lt))}const vt=Mt=>{yt.forEach(Et=>{nt[Et]=Mt}),yt.length=0};for(ut-=1;ut>=pt&&(!_e||!_e.hasData());ut--){_e&&vt(_e.tileID.key);const Mt=lt.calculateScaledKey(ut);if(_e=g.getTileByID(Mt),_e&&_e.hasData())break;const Et=nt[Mt];if(Et===null)break;Et===void 0?yt.push(Mt):_e=g.getTileByID(Et)}return vt(_e?_e.tileID.key:null),_e&&_e.hasData()?_e:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,g){let _e=this._tilesDirty[o];_e||(_e=this._tilesDirty[o]={}),_e[g.key]=!0}}function K_(et,o,g){const _e=function(ut,pt,yt){const vt=h.bJ(pt,ut),Mt=h.bJ(yt,[.2126,.7152,.0722]),Et=(Ft,Ot,qt)=>(1-qt)*Ft+qt*Ot,Lt=Et(1-.3*Math.min(Mt,1),1,Math.min(vt+1,1));return Et(.92,1,Math.asin(h.aA(pt[2],-1,1))/Math.PI+.5)*Lt}(et,[0,0,1],o),nt=[0,0,0];h.c4(nt,g.slice(0,3),_e);const st=[0,0,0];h.c4(st,o.slice(0,3),et[2]);const lt=[0,0,0];return h.d7(lt,nt,st),h.da(lt)}const ov=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],av=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Y_{static cacheKey(o,g,_e,nt){let st=`${g}${nt?nt.cacheKey:""}`;for(const lt of _e)o.usedDefines.includes(lt)&&(st+=`/${lt}`);return st}constructor(o,g,_e,nt,st,lt){const ut=o.gl;this.program=ut.createProgram(),this.configuration=nt,this.name=g,this.fixedDefines=[...lt];let pt=nt?nt.defines():[];pt=pt.concat(lt.map(Ft=>`#define ${Ft}`));const yt=`#version 300 es
`;let vt=yt+pt.concat("precision mediump float;",_p,i_.fragmentSource).join(`
`);for(const Ft of _e.fragmentIncludes)vt+=`
${xy[Ft]}`;vt+=`
${_e.fragmentSource}`;let Mt=yt+pt.concat("precision highp float;",_p,i_.vertexSource).join(`
`);for(const Ft of _e.vertexIncludes)Mt+=`
${xy[Ft]}`;this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&_e.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Mt+=`
uniform int u_instanceID;
`),Mt+=`
${_e.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Mt=Mt.replaceAll("gl_InstanceID","u_instanceID"));const Et=ut.createShader(ut.FRAGMENT_SHADER);if(ut.isContextLost())return void(this.failedToCreate=!0);ut.shaderSource(Et,vt),ut.compileShader(Et),ut.attachShader(this.program,Et);const Lt=ut.createShader(ut.VERTEX_SHADER);ut.isContextLost()?this.failedToCreate=!0:(ut.shaderSource(Lt,Mt),ut.compileShader(Lt),ut.attachShader(this.program,Lt),this.attributes={},ut.linkProgram(this.program),ut.deleteShader(Lt),ut.deleteShader(Et),this.fixedUniforms=st(o),this.binderUniforms=nt?nt.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Ft=>({u_instanceID:new h.cg(Ft)}))(o)),(lt.includes("TERRAIN")||g.indexOf("symbol")!==-1||g.indexOf("circle")!==-1)&&(this.terrainUniforms=(Ft=>({u_dem:new h.cg(Ft),u_dem_prev:new h.cg(Ft),u_dem_tl:new h.cj(Ft),u_dem_scale:new h.ci(Ft),u_dem_tl_prev:new h.cj(Ft),u_dem_scale_prev:new h.ci(Ft),u_dem_size:new h.ci(Ft),u_dem_lerp:new h.ci(Ft),u_exaggeration:new h.ci(Ft),u_depth:new h.cg(Ft),u_depth_size_inv:new h.cj(Ft),u_depth_range_unpack:new h.cj(Ft),u_occluder_half_size:new h.ci(Ft),u_occlusion_depth_offset:new h.ci(Ft),u_meter_to_dem:new h.ci(Ft),u_label_plane_matrix_inv:new h.ck(Ft)}))(o)),lt.includes("GLOBE")&&(this.globeUniforms=(Ft=>({u_tile_tl_up:new h.ch(Ft),u_tile_tr_up:new h.ch(Ft),u_tile_br_up:new h.ch(Ft),u_tile_bl_up:new h.ch(Ft),u_tile_up_scale:new h.ci(Ft)}))(o)),lt.includes("FOG")&&(this.fogUniforms=(Ft=>({u_fog_matrix:new h.ck(Ft),u_fog_range:new h.cj(Ft),u_fog_color:new h.d2(Ft),u_fog_horizon_blend:new h.ci(Ft),u_fog_vertical_limit:new h.cj(Ft),u_fog_temporal_offset:new h.ci(Ft),u_frustum_tl:new h.ch(Ft),u_frustum_tr:new h.ch(Ft),u_frustum_br:new h.ch(Ft),u_frustum_bl:new h.ch(Ft),u_globe_pos:new h.ch(Ft),u_globe_radius:new h.ci(Ft),u_globe_transition:new h.ci(Ft),u_is_globe:new h.cg(Ft),u_viewport:new h.cj(Ft)}))(o)),lt.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Ft=>({u_cutoff_params:new h.d2(Ft)}))(o)),lt.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Ft=>({u_lighting_ambient_color:new h.ch(Ft),u_lighting_directional_dir:new h.ch(Ft),u_lighting_directional_color:new h.ch(Ft),u_ground_radiance:new h.ch(Ft)}))(o)),lt.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Ft=>({u_light_matrix_0:new h.ck(Ft),u_light_matrix_1:new h.ck(Ft),u_fade_range:new h.cj(Ft),u_shadow_normal_offset:new h.ch(Ft),u_shadow_intensity:new h.ci(Ft),u_shadow_texel_size:new h.ci(Ft),u_shadow_map_resolution:new h.ci(Ft),u_shadow_direction:new h.ch(Ft),u_shadow_bias:new h.ch(Ft),u_shadowmap_0:new h.cg(Ft),u_shadowmap_1:new h.cg(Ft)}))(o)))}getAttributeLocation(o,g){let _e=this.attributes[g];return _e===void 0&&(_e=this.attributes[g]=o.getAttribLocation(this.program,g)),_e}setTerrainUniformValues(o,g){if(!this.terrainUniforms)return;const _e=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const nt in g)_e[nt]&&_e[nt].set(this.program,nt,g[nt])}}setGlobeUniformValues(o,g){if(!this.globeUniforms)return;const _e=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const nt in g)_e[nt]&&_e[nt].set(this.program,nt,g[nt])}}setFogUniformValues(o,g){if(!this.fogUniforms)return;const _e=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const nt in g)_e[nt].set(this.program,nt,g[nt])}}setCutoffUniformValues(o,g){if(!this.cutoffUniforms)return;const _e=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const nt in g)_e[nt].set(this.program,nt,g[nt])}}setLightsUniformValues(o,g){if(!this.lightsUniforms)return;const _e=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const nt in g)_e[nt].set(this.program,nt,g[nt])}}setShadowUniformValues(o,g){if(this.failedToCreate||!this.shadowUniforms)return;const _e=this.shadowUniforms;o.program.set(this.program);for(const nt in g)_e[nt].set(this.program,nt,g[nt])}_drawDebugWireframe(o,g,_e,nt,st,lt,ut,pt,yt,vt){const Mt=o.options.wireframe;if(Mt.terrain===!1&&Mt.layers2D===!1&&Mt.layers3D===!1)return;const Et=o.context;if(!(()=>!(!Mt.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Mt.layers2D||o._terrain&&o._terrain.renderingToTexture||!ov.includes(this.name))||!(!Mt.layers3D||!av.includes(this.name)))())return;const Lt=Et.gl,Ft=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,st,Et);if(!Ft)return;const Ot=[...this.fixedDefines];Ot.push("DEBUG_WIREFRAME");const qt=o.getOrCreateProgram(this.name,{config:this.configuration,defines:Ot});Et.program.set(qt.program);const $t=(sr,pr,hr)=>{if(pr[sr]&&hr[sr])for(const gr in pr[sr])hr[sr][gr]&&hr[sr][gr].set(hr.program,gr,pr[sr][gr].current)};yt&&yt.setUniforms(qt.program,Et,qt.binderUniforms,ut,{zoom:pt}),$t("fixedUniforms",this,qt),$t("terrainUniforms",this,qt),$t("globeUniforms",this,qt),$t("fogUniforms",this,qt),$t("lightsUniforms",this,qt),$t("shadowUniforms",this,qt),Ft.bind(),Et.setColorMode(new Pn([Lt.ONE,Lt.ONE_MINUS_SRC_ALPHA,Lt.ZERO,Lt.ONE],h.ao.transparent,[!0,!0,!0,!1])),Et.setDepthMode(new fn(g.func===Lt.LESS?Lt.LEQUAL:g.func,fn.ReadOnly,g.range)),Et.setStencilMode(Vn.disabled);const Yt=3*lt.primitiveLength*2,tr=3*lt.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const sr=vt||1;for(let pr=0;pr<sr;++pr)qt.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",pr),Lt.drawElements(Lt.LINES,Yt,Lt.UNSIGNED_SHORT,tr)}else vt&&vt>1?Lt.drawElementsInstanced(Lt.LINES,Yt,Lt.UNSIGNED_SHORT,tr,vt):Lt.drawElements(Lt.LINES,Yt,Lt.UNSIGNED_SHORT,tr);st.bind(),Et.program.set(this.program),Et.setDepthMode(g),Et.setStencilMode(_e),Et.setColorMode(nt)}checkUniforms(o,g,_e){if(this.fixedDefines.includes(g)){for(const nt of Object.keys(_e))if(!_e[nt].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${nt} not set but required by ${g} being defined`)}}draw(o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt,Et,Lt,Ft,Ot,qt){const $t=o.context,Yt=$t.gl;if(this.failedToCreate)return;$t.program.set(this.program),$t.setDepthMode(_e),$t.setStencilMode(nt),$t.setColorMode(st),$t.setCullFace(lt);for(const pr of Object.keys(this.fixedUniforms))this.fixedUniforms[pr].set(this.program,pr,ut[pr]);Ft&&Ft.setUniforms(this.program,$t,this.binderUniforms,Et,{zoom:Lt});const tr={[Yt.POINTS]:1,[Yt.LINES]:2,[Yt.TRIANGLES]:3,[Yt.LINE_STRIP]:1}[g];this.checkUniforms(pt,"RENDER_SHADOWS",this.shadowUniforms);const sr=qt&&qt>0?1:void 0;for(const pr of Mt.get()){const hr=pr.vaos||(pr.vaos={});if((hr[pt]||(hr[pt]=new vy)).bind($t,this,yt,Ft?Ft.getPaintVertexBuffers():[],vt,pr.vertexOffset,Ot||[],sr),this.forceManualRenderingForInstanceIDShaders){const gr=qt||1;for(let dr=0;dr<gr;++dr)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",dr),vt?Yt.drawElements(g,pr.primitiveLength*tr,Yt.UNSIGNED_SHORT,pr.primitiveOffset*tr*2):Yt.drawArrays(g,pr.vertexOffset,pr.vertexLength)}else qt&&qt>1?Yt.drawElementsInstanced(g,pr.primitiveLength*tr,Yt.UNSIGNED_SHORT,pr.primitiveOffset*tr*2,qt):vt?Yt.drawElements(g,pr.primitiveLength*tr,Yt.UNSIGNED_SHORT,pr.primitiveOffset*tr*2):Yt.drawArrays(g,pr.vertexOffset,pr.vertexLength);g===Yt.TRIANGLES&&vt&&this._drawDebugWireframe(o,_e,nt,st,vt,pr,Et,Lt,Ft,qt)}}}function s_(et,o,g=0){const _e=Math.pow(2,o.tileID.overscaledZ),nt=o.tileSize*Math.pow(2,et.transform.tileZoom)/_e,st=nt*(o.tileID.canonical.x+o.tileID.wrap*_e),lt=nt*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/h.ay(o,1,et.transform.tileZoom),u_pixel_coord_upper:[st>>16,lt>>16],u_pixel_coord_lower:[65535&st,65535&lt],u_pattern_transition:g}}const Ty={terrain:0,flat:1},lv=h.bC(),o_=(et,o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt,Et,Lt,Ft,Ot,qt,$t)=>{const Yt=o.style.light,tr=Yt.properties.get("position"),sr=[tr.x,tr.y,tr.z],pr=h.dL();Yt.properties.get("anchor")==="viewport"&&(h.dM(pr,-o.transform.angle),h.dN(sr,sr,pr));const hr=Yt.properties.get("color").toPremultipliedRenderColor(null),gr=o.transform,dr={u_matrix:et,u_lightpos:sr,u_lightintensity:Yt.properties.get("intensity"),u_lightcolor:[hr.r,hr.g,hr.b],u_vertical_gradient:+g,u_opacity:_e,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:lv,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Ty[yt],u_base_type:Ty[vt],u_ao:nt,u_edge_radius:st,u_width_scale:lt,u_flood_light_color:Ft,u_vertical_scale:Ot,u_flood_light_intensity:qt,u_ground_shadow_factor:$t};return gr.projection.name==="globe"&&(dr.u_tile_id=[ut.canonical.x,ut.canonical.y,1<<ut.canonical.z],dr.u_zoom_transition=Mt,dr.u_inv_rot_matrix=Lt,dr.u_merc_center=Et,dr.u_up_dir=gr.projection.upVector(new h.cC(0,0,0),Et[0]*h.al,Et[1]*h.al),dr.u_height_lift=pt),dr},cv=(et,o,g,_e,nt,st)=>({u_matrix:et,u_edge_radius:o,u_width_scale:g,u_vertical_scale:_e,u_height_type:Ty[nt],u_base_type:Ty[st]}),H0=(et,o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt,Et,Lt,Ft,Ot,qt,$t)=>{const Yt=o_(et,o,g,_e,nt,st,lt,ut,yt,vt,Mt,Et,Lt,Ft,Ot,qt,1,[0,0,0]),tr={u_height_factor:-Math.pow(2,ut.overscaledZ)/pt.tileSize/8};return Object.assign(Yt,s_(o,pt,$t),tr)},uv=(et,o,g)=>({u_matrix:et,u_emissive_strength:o,u_ground_shadow_factor:g}),Om=(et,o,g,_e,nt,st=0)=>Object.assign(uv(et,o,nt),s_(g,_e,st)),Iw=(et,o,g,_e)=>({u_matrix:et,u_world:g,u_emissive_strength:o,u_ground_shadow_factor:_e}),Mw=(et,o,g,_e,nt,st,lt=0)=>Object.assign(Om(et,o,g,_e,st,lt),{u_world:nt}),kw=(et,o)=>({u_matrix:et,u_ground_shadow_factor:o}),Q_=(et,o,g,_e,nt)=>({u_matrix:et,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:g,u_height_scale:_e,u_reset_depth:nt}),Dw=(et,o,g,_e,nt,st,lt)=>({u_matrix:et,u_normal_matrix:o,u_opacity:g,u_faux_facade_ao_intensity:_e,u_camera_pos:nt,u_tile_to_meter:st,u_facade_emissive_chance:lt}),Lw=et=>({u_matrix:et}),hv=et=>({u_matrix:et}),dv=(et,o,g,_e,nt,st,lt,ut)=>{const pt=h.al/st.tileSize;return{u_matrix:et,u_inv_rot_matrix:o,u_camera_to_center_distance:g.getCameraToCenterDistance(ut),u_extrude_scale:[g.pixelsToGLUnits[0]/pt,g.pixelsToGLUnits[1]/pt],u_zoom_transition:_e,u_tile_id:lt,u_merc_center:nt}},pv=(et,o,g=1)=>({u_matrix:et,u_color:o,u_overlay:0,u_overlay_scale:g}),Sy=h.bC(),W0=(et,o,g,_e,nt,st,lt)=>{const ut=et.transform,pt=ut.projection.name==="globe",yt=pt?h.dO(ut.zoom,o.canonical)*ut._pixelsPerMercatorPixel:h.ay(g,1,st),vt={u_matrix:o.projMatrix,u_extrude_scale:yt,u_intensity:lt,u_inv_rot_matrix:Sy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(pt){vt.u_inv_rot_matrix=_e,vt.u_merc_center=nt,vt.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],vt.u_zoom_transition=h.aj(ut.zoom);const Mt=nt[0]*h.al,Et=nt[1]*h.al;vt.u_up_dir=ut.projection.upVector(new h.cC(0,0,0),Mt,Et)}return vt};function fv(et,[o,g,_e,nt],[st,lt]){if(st===lt)return[0,0,0,0];const ut=255*(et-1)/(et*(lt-st));return[o*ut,g*ut,_e*ut,nt*ut]}function mv(et,o,[g,_e]){return g===_e?0:.5/et+(o-g)*(et-1)/(et*(_e-g))}const J_=(et,o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt,Et,Lt,Ft,Ot,qt,$t,Yt,tr,sr)=>({u_matrix:et,u_normalize_matrix:o,u_globe_matrix:g,u_merc_matrix:_e,u_grid_matrix:nt,u_tl_parent:st,u_scale_parent:yt,u_fade_t:vt.mix,u_opacity:vt.opacity*Mt.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Mt.paint.get("raster-brightness-min"),u_brightness_high:Mt.paint.get("raster-brightness-max"),u_saturation_factor:h.dQ(Mt.paint.get("raster-saturation")),u_contrast_factor:h.dP(Mt.paint.get("raster-contrast")),u_spin_weights:zm(Mt.paint.get("raster-hue-rotate")),u_perspective_transform:Et,u_raster_elevation:Lt,u_zoom_transition:lt,u_merc_center:ut,u_cutoff_params:pt,u_colorization_mix:fv(h.dR,Ot,$t),u_colorization_offset:mv(h.dR,qt,$t),u_color_ramp:Ft,u_texture_offset:[tr/(Yt+2*tr),Yt/(Yt+2*tr)],u_texture_res:[Yt+2*tr,Yt+2*tr],u_emissive_strength:sr});function zm(et){et*=Math.PI/180;const o=Math.sin(et),g=Math.cos(et);return[(2*g+1)/3,(-Math.sqrt(3)*o-g+1)/3,(Math.sqrt(3)*o-g+1)/3]}const Nm=.05,cm=(et,o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt)=>({u_matrix:et,u_normalize_matrix:o,u_globe_matrix:g,u_merc_matrix:_e,u_grid_matrix:nt,u_tl_parent:st,u_scale_parent:yt,u_fade_t:vt.mix,u_opacity:vt.opacity,u_image0:0,u_image1:1,u_raster_elevation:Mt,u_zoom_transition:lt,u_merc_center:ut,u_cutoff_params:pt}),gv=(et,o,g,_e,nt,st,lt,ut,pt,yt)=>({u_particle_texture:et,u_particle_texture_side_len:o,u_tile_offset:g,u_velocity:_e,u_color_ramp:st,u_velocity_res:nt,u_max_speed:lt,u_uv_offset:ut,u_data_scale:[255*pt[0],255*pt[1]],u_data_offset:yt,u_particle_pos_scale:1.1,u_particle_pos_offset:[Nm,Nm]}),ex=(et,o,g,_e,nt,st,lt,ut,pt,yt)=>({u_particle_texture:et,u_particle_texture_side_len:o,u_velocity:g,u_velocity_res:_e,u_max_speed:nt,u_speed_factor:st,u_reset_rate:lt,u_rand_seed:Math.random(),u_uv_offset:ut,u_data_scale:[255*pt[0],255*pt[1]],u_data_offset:yt,u_particle_pos_scale:1.1,u_particle_pos_offset:[Nm,Nm]}),yv=h.bC(),_v=(et,o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt,Et,Lt,Ft,Ot,qt,$t,Yt,tr,sr,pr,hr,gr)=>{const dr=nt.transform,ur={u_is_size_zoom_constant:+(et==="constant"||et==="source"),u_is_size_feature_constant:+(et==="constant"||et==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:dr.getCameraToCenterDistance(Yt),u_rotate_symbol:+g,u_aspect_ratio:dr.width/dr.height,u_fade_change:nt.options.fadeDuration?nt.symbolFadeChange:1,u_matrix:st,u_label_plane_matrix:lt,u_coord_matrix:ut,u_is_text:+yt,u_elevation_from_sea:pt?1:0,u_pitch_with_map:+_e,u_texsize:vt,u_texsize_icon:Mt,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:yv,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:yv,u_up_vector:[0,-1,0],u_color_adj_mat:pr,u_icon_transition:hr||0,u_gamma_scale:_e?nt.transform.getCameraToCenterDistance(Yt)*Math.cos(nt.terrain?0:nt.transform._pitch):1,u_device_pixel_ratio:h.o.devicePixelRatio,u_is_halo:1,u_scale_factor:gr||1,u_ground_shadow_factor:tr,u_inv_matrix:h.bl(h.bC(),lt),u_normal_scale:sr,u_lutTexture:ga.LUT};return Yt.name==="globe"&&(ur.u_tile_id=[Lt.canonical.x,Lt.canonical.y,1<<Lt.canonical.z],ur.u_zoom_transition=Ft,ur.u_inv_rot_matrix=qt,ur.u_merc_center=Ot,ur.u_camera_forward=dr._camera.forward(),ur.u_ecef_origin=h.dS(dr.globeMatrix,Lt.toUnwrapped()),ur.u_tile_matrix=Float32Array.from(dr.globeMatrix),ur.u_up_vector=$t),ur},tx=(et,o,g,_e)=>({u_matrix:et,u_emissive_strength:o,u_opacity:g,u_color:_e}),ix=(et,o,g,_e,nt,st,lt,ut,pt)=>Object.assign(function(yt,vt,Mt,Et,Lt,Ft){const{width:Ot,height:qt}=Et.imageManager.getPixelSize(vt),$t=Math.pow(2,Ft.tileID.overscaledZ),Yt=Ft.tileSize*Math.pow(2,Et.transform.tileZoom)/$t,tr=Yt*(Ft.tileID.canonical.x+Ft.tileID.wrap*$t),sr=Yt*Ft.tileID.canonical.y;return{u_image:0,u_pattern_tl:Mt.tl,u_pattern_br:Mt.br,u_texsize:[Ot,qt],u_pattern_size:Mt.displaySize,u_pattern_units_to_pixels:Lt?[Et.transform.width,-1*Et.transform.height]:[1/h.ay(Ft,1,Et.transform.tileZoom),1/h.ay(Ft,1,Et.transform.tileZoom)],u_pixel_coord_upper:[tr>>16,sr>>16],u_pixel_coord_lower:[65535&tr,65535&sr]}}(0,st,lt,_e,ut,pt),{u_matrix:et,u_emissive_strength:o,u_opacity:g}),xv=new Float32Array(h.bA([])),rx=(et,o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt,Et,Lt=[0,0,0],Ft)=>{const Ot=nt.style.light,qt=Ot.properties.get("position"),$t=[-qt.x,-qt.y,qt.z],Yt=h.dL();Ot.properties.get("anchor")==="viewport"&&(h.dM(Yt,-nt.transform.angle),h.dN($t,$t,Yt));const tr=vt.alphaMode==="MASK",sr=Ot.properties.get("color").toNonPremultipliedRenderColor(null),pr=Et.paint.get("model-ambient-occlusion-intensity"),hr=Et.paint.get("model-color").constantOr(h.ao.white).toNonPremultipliedRenderColor(null);return hr.a=Et.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:et,u_lighting_matrix:o,u_normal_matrix:g,u_node_matrix:_e||xv,u_lightpos:$t,u_lightintensity:Ot.properties.get("intensity"),u_lightcolor:[sr.r,sr.g,sr.b],u_camera_pos:Lt,u_opacity:st,u_baseTextureIsAlpha:0,u_alphaMask:+tr,u_alphaCutoff:vt.alphaCutoff,u_baseColorFactor:lt.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:ut.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:pt,u_roughnessFactor:yt,u_baseColorTexture:ga.BaseColor,u_metallicRoughnessTexture:ga.MetallicRoughness,u_normalTexture:ga.Normal,u_occlusionTexture:ga.Occlusion,u_emissionTexture:ga.Emission,u_lutTexture:ga.LUT,u_color_mix:hr.toArray01(),u_aoIntensity:pr,u_emissive_strength:Mt,u_occlusionTextureTransform:Ft||[0,0,0,0]}},Cy=(et,o=xv,g=xv)=>({u_matrix:et,u_instance:o,u_node_matrix:g}),jw={fillExtrusion:et=>({u_matrix:new h.ck(et),u_lightpos:new h.ch(et),u_lightintensity:new h.ci(et),u_lightcolor:new h.ch(et),u_vertical_gradient:new h.ci(et),u_opacity:new h.ci(et),u_edge_radius:new h.ci(et),u_width_scale:new h.ci(et),u_ao:new h.cj(et),u_height_type:new h.cg(et),u_base_type:new h.cg(et),u_tile_id:new h.ch(et),u_zoom_transition:new h.ci(et),u_inv_rot_matrix:new h.ck(et),u_merc_center:new h.cj(et),u_up_dir:new h.ch(et),u_height_lift:new h.ci(et),u_flood_light_color:new h.ch(et),u_vertical_scale:new h.ci(et),u_flood_light_intensity:new h.ci(et),u_ground_shadow_factor:new h.ch(et)}),fillExtrusionDepth:et=>({u_matrix:new h.ck(et),u_edge_radius:new h.ci(et),u_width_scale:new h.ci(et),u_vertical_scale:new h.ci(et),u_height_type:new h.cg(et),u_base_type:new h.cg(et)}),fillExtrusionPattern:et=>({u_matrix:new h.ck(et),u_lightpos:new h.ch(et),u_lightintensity:new h.ci(et),u_lightcolor:new h.ch(et),u_vertical_gradient:new h.ci(et),u_height_factor:new h.ci(et),u_edge_radius:new h.ci(et),u_width_scale:new h.ci(et),u_ao:new h.cj(et),u_height_type:new h.cg(et),u_base_type:new h.cg(et),u_tile_id:new h.ch(et),u_zoom_transition:new h.ci(et),u_inv_rot_matrix:new h.ck(et),u_merc_center:new h.cj(et),u_up_dir:new h.ch(et),u_height_lift:new h.ci(et),u_image:new h.cg(et),u_texsize:new h.cj(et),u_pixel_coord_upper:new h.cj(et),u_pixel_coord_lower:new h.cj(et),u_tile_units_to_pixels:new h.ci(et),u_opacity:new h.ci(et),u_pattern_transition:new h.ci(et)}),fillExtrusionGroundEffect:et=>({u_matrix:new h.ck(et),u_opacity:new h.ci(et),u_ao_pass:new h.ci(et),u_meter_to_tile:new h.ci(et),u_ao:new h.cj(et),u_flood_light_intensity:new h.ci(et),u_flood_light_color:new h.ch(et),u_attenuation:new h.ci(et),u_edge_radius:new h.ci(et),u_fb:new h.cg(et),u_fb_size:new h.ci(et),u_dynamic_offset:new h.ci(et)}),fill:et=>({u_matrix:new h.ck(et),u_emissive_strength:new h.ci(et),u_ground_shadow_factor:new h.ch(et)}),fillPattern:et=>({u_matrix:new h.ck(et),u_emissive_strength:new h.ci(et),u_image:new h.cg(et),u_texsize:new h.cj(et),u_pixel_coord_upper:new h.cj(et),u_pixel_coord_lower:new h.cj(et),u_tile_units_to_pixels:new h.ci(et),u_ground_shadow_factor:new h.ch(et),u_pattern_transition:new h.ci(et)}),fillOutline:et=>({u_matrix:new h.ck(et),u_emissive_strength:new h.ci(et),u_world:new h.cj(et),u_ground_shadow_factor:new h.ch(et)}),fillOutlinePattern:et=>({u_matrix:new h.ck(et),u_emissive_strength:new h.ci(et),u_world:new h.cj(et),u_image:new h.cg(et),u_texsize:new h.cj(et),u_pixel_coord_upper:new h.cj(et),u_pixel_coord_lower:new h.cj(et),u_tile_units_to_pixels:new h.ci(et),u_ground_shadow_factor:new h.ch(et),u_pattern_transition:new h.ci(et)}),building:et=>({u_matrix:new h.ck(et),u_normal_matrix:new h.ck(et),u_opacity:new h.ci(et),u_faux_facade_ao_intensity:new h.ci(et),u_camera_pos:new h.ch(et),u_tile_to_meter:new h.ci(et),u_facade_emissive_chance:new h.ci(et)}),buildingBloom:et=>({u_matrix:new h.ck(et)}),buildingDepth:et=>({u_matrix:new h.ck(et)}),elevatedStructuresDepth:et=>({u_matrix:new h.ck(et),u_depth_bias:new h.ci(et)}),elevatedStructures:et=>({u_matrix:new h.ck(et),u_ground_shadow_factor:new h.ch(et)}),elevatedStructuresDepthReconstruct:et=>({u_matrix:new h.ck(et),u_camera_pos:new h.ch(et),u_depth_bias:new h.ci(et),u_height_scale:new h.ci(et),u_reset_depth:new h.ci(et)}),circle:h.dV,collisionBox:et=>({u_matrix:new h.ck(et),u_inv_rot_matrix:new h.ck(et),u_camera_to_center_distance:new h.ci(et),u_extrude_scale:new h.cj(et),u_zoom_transition:new h.ci(et),u_merc_center:new h.cj(et),u_tile_id:new h.ch(et)}),collisionCircle:et=>({u_matrix:new h.ck(et),u_inv_matrix:new h.ck(et),u_camera_to_center_distance:new h.ci(et),u_viewport_size:new h.cj(et)}),debug:et=>({u_color:new h.dx(et),u_matrix:new h.ck(et),u_overlay:new h.cg(et),u_overlay_scale:new h.ci(et)}),clippingMask:et=>({u_matrix:new h.ck(et)}),heatmap:et=>({u_extrude_scale:new h.ci(et),u_intensity:new h.ci(et),u_matrix:new h.ck(et),u_inv_rot_matrix:new h.ck(et),u_merc_center:new h.cj(et),u_tile_id:new h.ch(et),u_zoom_transition:new h.ci(et),u_up_dir:new h.ch(et)}),heatmapTexture:et=>({u_image:new h.cg(et),u_color_ramp:new h.cg(et),u_opacity:new h.ci(et)}),hillshade:et=>({u_matrix:new h.ck(et),u_image:new h.cg(et),u_latrange:new h.cj(et),u_light:new h.cj(et),u_shadow:new h.dx(et),u_highlight:new h.dx(et),u_emissive_strength:new h.ci(et),u_accent:new h.dx(et)}),hillshadePrepare:et=>({u_matrix:new h.ck(et),u_image:new h.cg(et),u_dimension:new h.cj(et),u_zoom:new h.ci(et)}),line:h.dU,linePattern:h.dT,raster:et=>({u_matrix:new h.ck(et),u_normalize_matrix:new h.ck(et),u_globe_matrix:new h.ck(et),u_merc_matrix:new h.ck(et),u_grid_matrix:new h.dy(et),u_tl_parent:new h.cj(et),u_scale_parent:new h.ci(et),u_fade_t:new h.ci(et),u_opacity:new h.ci(et),u_image0:new h.cg(et),u_image1:new h.cg(et),u_brightness_low:new h.ci(et),u_brightness_high:new h.ci(et),u_saturation_factor:new h.ci(et),u_contrast_factor:new h.ci(et),u_spin_weights:new h.ch(et),u_perspective_transform:new h.cj(et),u_raster_elevation:new h.ci(et),u_zoom_transition:new h.ci(et),u_merc_center:new h.cj(et),u_cutoff_params:new h.d2(et),u_colorization_mix:new h.d2(et),u_colorization_offset:new h.ci(et),u_color_ramp:new h.cg(et),u_texture_offset:new h.cj(et),u_texture_res:new h.cj(et),u_emissive_strength:new h.ci(et)}),rasterParticle:et=>({u_matrix:new h.ck(et),u_normalize_matrix:new h.ck(et),u_globe_matrix:new h.ck(et),u_merc_matrix:new h.ck(et),u_grid_matrix:new h.dy(et),u_tl_parent:new h.cj(et),u_scale_parent:new h.ci(et),u_fade_t:new h.ci(et),u_opacity:new h.ci(et),u_image0:new h.cg(et),u_image1:new h.cg(et),u_raster_elevation:new h.ci(et),u_zoom_transition:new h.ci(et),u_merc_center:new h.cj(et),u_cutoff_params:new h.d2(et)}),rasterParticleTexture:et=>({u_texture:new h.cg(et),u_opacity:new h.ci(et)}),rasterParticleDraw:et=>({u_particle_texture:new h.cg(et),u_particle_texture_side_len:new h.ci(et),u_tile_offset:new h.cj(et),u_velocity:new h.cg(et),u_color_ramp:new h.cg(et),u_velocity_res:new h.cj(et),u_max_speed:new h.ci(et),u_uv_offset:new h.cj(et),u_data_scale:new h.cj(et),u_data_offset:new h.ci(et),u_particle_pos_scale:new h.ci(et),u_particle_pos_offset:new h.cj(et)}),rasterParticleUpdate:et=>({u_particle_texture:new h.cg(et),u_particle_texture_side_len:new h.ci(et),u_velocity:new h.cg(et),u_velocity_res:new h.cj(et),u_max_speed:new h.ci(et),u_speed_factor:new h.ci(et),u_reset_rate:new h.ci(et),u_rand_seed:new h.ci(et),u_uv_offset:new h.cj(et),u_data_scale:new h.cj(et),u_data_offset:new h.ci(et),u_particle_pos_scale:new h.ci(et),u_particle_pos_offset:new h.cj(et)}),symbol:et=>({u_is_size_zoom_constant:new h.cg(et),u_is_size_feature_constant:new h.cg(et),u_size_t:new h.ci(et),u_size:new h.ci(et),u_camera_to_center_distance:new h.ci(et),u_rotate_symbol:new h.cg(et),u_aspect_ratio:new h.ci(et),u_fade_change:new h.ci(et),u_matrix:new h.ck(et),u_label_plane_matrix:new h.ck(et),u_coord_matrix:new h.ck(et),u_is_text:new h.cg(et),u_elevation_from_sea:new h.cg(et),u_pitch_with_map:new h.cg(et),u_texsize:new h.cj(et),u_texsize_icon:new h.cj(et),u_texture:new h.cg(et),u_texture_icon:new h.cg(et),u_gamma_scale:new h.ci(et),u_device_pixel_ratio:new h.ci(et),u_tile_id:new h.ch(et),u_zoom_transition:new h.ci(et),u_inv_rot_matrix:new h.ck(et),u_merc_center:new h.cj(et),u_camera_forward:new h.ch(et),u_tile_matrix:new h.ck(et),u_up_vector:new h.ch(et),u_ecef_origin:new h.ch(et),u_is_halo:new h.cg(et),u_icon_transition:new h.ci(et),u_color_adj_mat:new h.ck(et),u_scale_factor:new h.ci(et),u_ground_shadow_factor:new h.ch(et),u_inv_matrix:new h.ck(et),u_normal_scale:new h.ci(et),u_lutTexture:new h.cg(et)}),background:et=>({u_matrix:new h.ck(et),u_emissive_strength:new h.ci(et),u_opacity:new h.ci(et),u_color:new h.dx(et)}),backgroundPattern:et=>({u_matrix:new h.ck(et),u_emissive_strength:new h.ci(et),u_opacity:new h.ci(et),u_image:new h.cg(et),u_pattern_tl:new h.cj(et),u_pattern_br:new h.cj(et),u_texsize:new h.cj(et),u_pattern_size:new h.cj(et),u_pixel_coord_upper:new h.cj(et),u_pixel_coord_lower:new h.cj(et),u_pattern_units_to_pixels:new h.cj(et)}),terrainRaster:et=>({u_matrix:new h.ck(et),u_image0:new h.cg(et),u_skirt_height:new h.ci(et),u_ground_shadow_factor:new h.ch(et)}),skybox:et=>({u_matrix:new h.ck(et),u_sun_direction:new h.ch(et),u_cubemap:new h.cg(et),u_opacity:new h.ci(et),u_temporal_offset:new h.ci(et)}),skyboxGradient:et=>({u_matrix:new h.ck(et),u_color_ramp:new h.cg(et),u_center_direction:new h.ch(et),u_radius:new h.ci(et),u_opacity:new h.ci(et),u_temporal_offset:new h.ci(et)}),skyboxCapture:et=>({u_matrix_3f:new h.dy(et),u_sun_direction:new h.ch(et),u_sun_intensity:new h.ci(et),u_color_tint_r:new h.d2(et),u_color_tint_m:new h.d2(et),u_luminance:new h.ci(et)}),globeRaster:et=>({u_proj_matrix:new h.ck(et),u_globe_matrix:new h.ck(et),u_normalize_matrix:new h.ck(et),u_merc_matrix:new h.ck(et),u_zoom_transition:new h.ci(et),u_merc_center:new h.cj(et),u_image0:new h.cg(et),u_grid_matrix:new h.dy(et),u_skirt_height:new h.ci(et),u_far_z_cutoff:new h.ci(et),u_frustum_tl:new h.ch(et),u_frustum_tr:new h.ch(et),u_frustum_br:new h.ch(et),u_frustum_bl:new h.ch(et),u_globe_pos:new h.ch(et),u_globe_radius:new h.ci(et),u_viewport:new h.cj(et)}),globeAtmosphere:et=>({u_frustum_tl:new h.ch(et),u_frustum_tr:new h.ch(et),u_frustum_br:new h.ch(et),u_frustum_bl:new h.ch(et),u_horizon:new h.ci(et),u_transition:new h.ci(et),u_fadeout_range:new h.ci(et),u_atmosphere_fog_color:new h.d2(et),u_high_color:new h.d2(et),u_space_color:new h.d2(et),u_temporal_offset:new h.ci(et),u_horizon_angle:new h.ci(et)}),model:et=>({u_matrix:new h.ck(et),u_lighting_matrix:new h.ck(et),u_normal_matrix:new h.ck(et),u_node_matrix:new h.ck(et),u_lightpos:new h.ch(et),u_lightintensity:new h.ci(et),u_lightcolor:new h.ch(et),u_camera_pos:new h.ch(et),u_opacity:new h.ci(et),u_baseColorFactor:new h.d2(et),u_emissiveFactor:new h.d2(et),u_metallicFactor:new h.ci(et),u_roughnessFactor:new h.ci(et),u_baseTextureIsAlpha:new h.cg(et),u_alphaMask:new h.cg(et),u_alphaCutoff:new h.ci(et),u_baseColorTexture:new h.cg(et),u_metallicRoughnessTexture:new h.cg(et),u_normalTexture:new h.cg(et),u_occlusionTexture:new h.cg(et),u_emissionTexture:new h.cg(et),u_lutTexture:new h.cg(et),u_color_mix:new h.d2(et),u_aoIntensity:new h.ci(et),u_emissive_strength:new h.ci(et),u_occlusionTextureTransform:new h.d2(et)}),modelDepth:et=>({u_matrix:new h.ck(et),u_instance:new h.ck(et),u_node_matrix:new h.ck(et)}),groundShadow:et=>({u_matrix:new h.ck(et),u_ground_shadow_factor:new h.ch(et)}),stars:et=>({u_matrix:new h.ck(et),u_up:new h.ch(et),u_right:new h.ch(et),u_intensity_multiplier:new h.ci(et)}),snowParticle:et=>({u_modelview:new h.ck(et),u_projection:new h.ck(et),u_time:new h.ci(et),u_cam_pos:new h.ch(et),u_velocityConeAperture:new h.ci(et),u_velocity:new h.ci(et),u_horizontalOscillationRadius:new h.ci(et),u_horizontalOscillationRate:new h.ci(et),u_boxSize:new h.ci(et),u_billboardSize:new h.ci(et),u_simpleShapeParameters:new h.cj(et),u_screenSize:new h.cj(et),u_thinningCenterPos:new h.cj(et),u_thinningShape:new h.ch(et),u_thinningAffectedRatio:new h.ci(et),u_thinningParticleOffset:new h.ci(et),u_particleColor:new h.d2(et),u_direction:new h.ch(et)}),rainParticle:et=>({u_modelview:new h.ck(et),u_projection:new h.ck(et),u_time:new h.ci(et),u_cam_pos:new h.ch(et),u_texScreen:new h.cg(et),u_velocityConeAperture:new h.ci(et),u_velocity:new h.ci(et),u_boxSize:new h.ci(et),u_rainDropletSize:new h.cj(et),u_distortionStrength:new h.ci(et),u_rainDirection:new h.ch(et),u_color:new h.d2(et),u_screenSize:new h.cj(et),u_thinningCenterPos:new h.cj(et),u_thinningShape:new h.ch(et),u_thinningAffectedRatio:new h.ci(et),u_thinningParticleOffset:new h.ci(et),u_shapeDirectionalPower:new h.ci(et),u_shapeNormalPower:new h.ci(et),u_mode:new h.ci(et)}),vignette:et=>({u_vignetteShape:new h.ch(et),u_vignetteColor:new h.d2(et)}),occlusion:et=>({u_matrix:new h.ck(et),u_anchorPos:new h.ch(et),u_screenSizePx:new h.cj(et),u_occluderSizePx:new h.cj(et),u_color:new h.d2(et)})};class um{constructor(o,g,_e,nt){this.id=um.uniqueIdxCounter,um.uniqueIdxCounter++,this.context=o;const st=o.gl;this.buffer=st.createBuffer(),this.dynamicDraw=!!_e,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),st.bufferData(st.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?st.DYNAMIC_DRAW:st.STATIC_DRAW),this.dynamicDraw||nt||g.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=um.uniqueIdxCounter,um.uniqueIdxCounter++;const g=this.context.gl;this.context.unbindVAO(),this.bind(),g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}um.uniqueIdxCounter=0;const q0={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fw{constructor(o,g,_e,nt,st,lt){this.length=g.length,this.attributes=_e,this.itemSize=g.bytesPerElement,this.dynamicDraw=nt,this.instanceCount=lt,this.context=o;const ut=o.gl;this.buffer=ut.createBuffer(),o.bindVertexBuffer.set(this.buffer),ut.bufferData(ut.ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?ut.DYNAMIC_DRAW:ut.STATIC_DRAW),this.dynamicDraw||st||g.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const g=this.context.gl;this.bind(),g.bufferSubData(g.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,g){for(let _e=0;_e<this.attributes.length;_e++){const nt=g.getAttributeLocation(o,this.attributes[_e].name);nt!==-1&&o.enableVertexAttribArray(nt)}}setVertexAttribPointers(o,g,_e){for(let nt=0;nt<this.attributes.length;nt++){const st=this.attributes[nt],lt=g.getAttributeLocation(o,st.name);lt!==-1&&o.vertexAttribPointer(lt,st.components,o[q0[st.type]],!1,this.itemSize,st.offset+this.itemSize*(_e||0))}}setVertexAttribDivisor(o,g,_e){for(let nt=0;nt<this.attributes.length;nt++){const st=g.getAttributeLocation(o,this.attributes[nt].name);st!==-1&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(st,_e)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class nx{constructor(o,g,_e,nt,st){this.context=o,this.width=g,this.height=_e;const lt=this.framebuffer=o.gl.createFramebuffer();nt&&(this.colorAttachment=new U0(o,lt)),st&&(this.depthAttachmentType=st,this.depthAttachment=st==="renderbuffer"?new G0(o,lt):new Aw(o,lt))}destroy(){const o=this.context.gl;if(this.colorAttachment){const g=this.colorAttachment.get();g&&o.deleteTexture(g)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const g=this.depthAttachment.get();g&&o.deleteRenderbuffer(g)}else{const g=this.depthAttachment.get();g&&o.deleteTexture(g)}o.deleteFramebuffer(this.framebuffer)}}class vv{constructor(o,g){this.gl=o,this.clearColor=new L0(this),this.clearDepth=new Qx(this),this.clearStencil=new bw(this),this.colorMask=new ww(this),this.depthMask=new Ew(this),this.stencilMask=new Tw(this),this.stencilFunc=new j0(this),this.stencilOp=new Sw(this),this.stencilTest=new B_(this),this.depthRange=new Cw(this),this.depthTest=new F0(this),this.depthFunc=new Jx(this),this.blend=new V_(this),this.blendFunc=new ev(this),this.blendColor=new Lm(this),this.blendEquation=new by(this),this.cullFace=new U_(this),this.cullFaceSide=new G_(this),this.frontFace=new wy(this),this.program=new O0(this),this.activeTexture=new tv(this),this.viewport=new z0(this),this.bindFramebuffer=new Ey(this),this.bindRenderbuffer=new $_(this),this.bindTexture=new H_(this),this.bindVertexBuffer=new iv(this),this.bindElementBuffer=new W_(this),this.bindVertexArrayOES=new r_(this),this.pixelStoreUnpack=new N0(this),this.pixelStoreUnpackPremultiplyAlpha=new B0(this),this.pixelStoreUnpackFlipY=new V0(this),this.options=g?Object.assign({},g):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=g&&!!g.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.maxPointSize=o.getParameter(o.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,g,_e){return new um(this,o,g,_e)}createVertexBuffer(o,g,_e,nt,st){return new Fw(this,o,g,_e,nt,st)}createRenderbuffer(o,g,_e){const nt=this.gl,st=nt.createRenderbuffer();return this.bindRenderbuffer.set(st),nt.renderbufferStorage(nt.RENDERBUFFER,o,g,_e),this.bindRenderbuffer.set(null),st}createFramebuffer(o,g,_e,nt){return new nx(this,o,g,_e,nt)}clear({color:o,depth:g,stencil:_e,colorMask:nt}){const st=this.gl;let lt=0;o&&(lt|=st.COLOR_BUFFER_BIT,this.clearColor.set(o.toNonPremultipliedRenderColor(null)),this.colorMask.set(nt||[!0,!0,!0,!0])),g!==void 0&&(lt|=st.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),_e!==void 0&&(lt|=st.STENCIL_BUFFER_BIT,this.clearStencil.set(_e),this.stencilMask.set(255)),st.clear(lt)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){h.by(o.blendFunction,Pn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let xp;function a_(et,o,g,_e,nt,st,lt){const ut=et.context,pt=ut.gl,yt=et.transform,vt=[h.aF(yt.center.lng),h.aJ(yt.center.lat)],Mt=g.layout.get("symbol-placement"),Et=g.layout.get("text-variable-anchor"),Lt=g.layout.get("icon-rotation-alignment")==="map",Ft=g.layout.get("text-rotation-alignment")==="map",Ot=Mt!=="point",qt=[];let $t=0,Yt=0;for(let ur=0;ur<_e.length;ur++){const yr=_e[ur],Vr=o.getTile(yr),Ir=Vr.getBucket(g);if(!Ir)continue;const Qr=Ir.getProjection().createInversionMatrix(yt,yr.canonical),Nr=[],Yr=oy(yr,Ir,yt),Cn=!lt&&Lt&&Ot,Br=lt&&Ft&&Ot,Tr=Et&&Ir.hasTextData(),en=Ir.hasIconTextFit()&&Tr&&Ir.hasIconData(),Hr=Cn||Br||lt&&Tr||en,un=Ir.projection.name==="globe",Tn=un?h.aj(yt.zoom):0;un&&(Nr.push("PROJECTION_GLOBE_VIEW"),Hr&&Nr.push("PROJECTED_POS_ON_VIEWPORT"));const Ln=et.getOrCreateProgram("collisionBox",{defines:Nr});let xn=Yr;nt[0]===0&&nt[1]===0||(xn=et.translatePosMatrix(Yr,Vr,nt,st));const mn=lt?Ir.textCollisionBox:Ir.iconCollisionBox,Xn=Ir.collisionCircleArray;if(Xn.length>0){const Wn=h.bC(),Un=xn;h.cO(Wn,Ir.placementInvProjMatrix,yt.glCoordMatrix),h.cO(Wn,Wn,Ir.placementViewportMatrix),qt.push({circleArray:Xn,circleOffset:Yt,transform:Un,invTransform:Wn,projection:Ir.getProjection()}),$t+=Xn.length/4,Yt=$t}if(!mn)continue;et.terrain&&et.terrain.setupElevationDraw(Vr,Ln);const Gn=un?[yr.canonical.x,yr.canonical.y,1<<yr.canonical.z]:[0,0,0];Ln.draw(et,pt.LINES,fn.disabled,Vn.disabled,et.colorModeForRenderPass(),ts.disabled,dv(xn,Qr,yt,Tn,vt,Vr,Gn,Ir.getProjection()),g.id,mn.layoutVertexBuffer,mn.indexBuffer,mn.segments,null,yt.zoom,null,[mn.collisionVertexBuffer,mn.collisionVertexBufferExt])}if(!lt||!qt.length)return;const tr=et.getOrCreateProgram("collisionCircle"),sr=new h.dW;sr.resize(4*$t),sr._trim();let pr=0;for(const ur of qt)for(let yr=0;yr<ur.circleArray.length/4;yr++){const Vr=4*yr,Ir=ur.circleArray[Vr+0],Qr=ur.circleArray[Vr+1],Nr=ur.circleArray[Vr+2],Yr=ur.circleArray[Vr+3];sr.emplace(pr++,Ir,Qr,Nr,Yr,0),sr.emplace(pr++,Ir,Qr,Nr,Yr,1),sr.emplace(pr++,Ir,Qr,Nr,Yr,2),sr.emplace(pr++,Ir,Qr,Nr,Yr,3)}(!xp||xp.length<2*$t)&&(xp=function(ur){const yr=2*ur,Vr=new h.b1;Vr.resize(yr),Vr._trim();for(let Ir=0;Ir<yr;Ir++){const Qr=6*Ir;Vr.uint16[Qr+0]=4*Ir+0,Vr.uint16[Qr+1]=4*Ir+1,Vr.uint16[Qr+2]=4*Ir+2,Vr.uint16[Qr+3]=4*Ir+2,Vr.uint16[Qr+4]=4*Ir+3,Vr.uint16[Qr+5]=4*Ir+0}return Vr}($t));const hr=ut.createIndexBuffer(xp,!0),gr=ut.createVertexBuffer(sr,h.dX.members,!0);for(const ur of qt){const yr={u_matrix:ur.transform,u_inv_matrix:ur.invTransform,u_camera_to_center_distance:(dr=yt).getCameraToCenterDistance(ur.projection),u_viewport_size:[dr.width,dr.height]};tr.draw(et,pt.TRIANGLES,fn.disabled,Vn.disabled,et.colorModeForRenderPass(),ts.disabled,yr,g.id,gr,hr,h.bg.simpleSegment(0,2*ur.circleOffset,ur.circleArray.length,ur.circleArray.length/2),null,yt.zoom)}var dr;gr.destroy(),hr.destroy()}const hm=h.bC();function bv(et){const o=et._camera.getWorldToCamera(et.worldSize,1),g=h.aB([],o,et.globeMatrix);h.bl(g,g);const _e=[0,0,0],nt=[0,1,0,0];return h.aC(nt,nt,g),_e[0]=nt[0],_e[1]=nt[1],_e[2]=nt[2],h.aw(_e,_e),_e}function sx({width:et,height:o,anchor:g,textOffset:_e,textScale:nt},st){const{horizontalAlign:lt,verticalAlign:ut}=h.c0(g),pt=-(lt-.5)*et,yt=-(ut-.5)*o,vt=h.c1(g,_e);return new h.P((pt/nt+vt[0])*st,(yt/nt+vt[1])*st)}function ox(et,o,g,_e,nt,st,lt,ut,pt,yt){const vt=et.text.placedSymbolArray,Mt=et.text.dynamicLayoutVertexArray,Et=et.icon.dynamicLayoutVertexArray,Lt={},Ft=et.getProjection(),Ot=Su(lt,Ft,nt),qt=nt.elevation,$t=Ft.upVectorScale(lt.canonical,nt.center.lat,nt.worldSize).metersToTile;Mt.clear();for(let Yt=0;Yt<vt.length;Yt++){const tr=vt.get(Yt),{tileAnchorX:sr,tileAnchorY:pr,numGlyphs:hr}=tr,gr=tr.hidden||!tr.crossTileID||et.allowVerticalPlacement&&!tr.placedOrientation?null:_e[tr.crossTileID];if(gr){let dr=0,ur=0,yr=0;if(qt){const en=qt?qt.getAtTileOffset(lt,sr,pr):0,[Hr,un,Tn]=Ft.upVector(lt.canonical,sr,pr);dr=en*Hr*$t,ur=en*un*$t,yr=en*Tn*$t}let[Vr,Ir,Qr,Nr]=_u(tr.projectedAnchorX+dr,tr.projectedAnchorY+ur,tr.projectedAnchorZ+yr,g?Ot:st);const Yr=kp(nt.getCameraToCenterDistance(Ft),Nr);let Cn=h.bM(et.textSizeData,pt,tr)*Yr/h.bX;g&&(Cn*=et.tilePixelRatio/ut);const Br=sx(gr,Cn);g?({x:Vr,y:Ir,z:Qr}=Ft.projectTilePoint(sr+Br.x,pr+Br.y,lt.canonical),[Vr,Ir,Qr]=_u(Vr+dr,Ir+ur,Qr+yr,st)):(o&&Br._rotate(-nt.angle),Vr+=Br.x,Ir+=Br.y,Qr=0);const Tr=et.allowVerticalPlacement&&tr.placedOrientation===h.bL.vertical?Math.PI/2:0;for(let en=0;en<hr;en++)h.bO(Mt,Vr,Ir,Qr,Tr);yt&&tr.associatedIconIndex>=0&&(Lt[tr.associatedIconIndex]={x:Vr,y:Ir,z:Qr,angle:Tr})}else ns(hr,Mt)}if(yt){Et.clear();const Yt=et.icon.placedSymbolArray;for(let tr=0;tr<Yt.length;tr++){const sr=Yt.get(tr),{numGlyphs:pr}=sr,hr=Lt[tr];if(sr.hidden||!hr)ns(pr,Et);else{const{x:gr,y:dr,z:ur,angle:yr}=hr;for(let Vr=0;Vr<pr;Vr++)h.bO(Et,gr,dr,ur,yr)}}et.icon.dynamicLayoutVertexBuffer.updateData(Et)}et.text.dynamicLayoutVertexBuffer.updateData(Mt)}function l_(et,o,g,_e,nt,st,lt={}){const ut=g.paint.get("icon-translate"),pt=g.paint.get("text-translate"),yt=g.paint.get("icon-translate-anchor"),vt=g.paint.get("text-translate-anchor"),Mt=g.layout.get("icon-rotation-alignment"),Et=g.layout.get("text-rotation-alignment"),Lt=g.layout.get("icon-pitch-alignment"),Ft=g.layout.get("text-pitch-alignment"),Ot=g.layout.get("icon-keep-upright"),qt=g.layout.get("text-keep-upright"),$t=g.paint.get("icon-color-saturation"),Yt=g.paint.get("icon-color-contrast"),tr=g.paint.get("icon-color-brightness-min"),sr=g.paint.get("icon-color-brightness-max"),pr=g.layout.get("symbol-elevation-reference")==="sea",hr=g.layout.get("icon-image-use-theme")==="none",gr=et.context,dr=gr.gl,ur=et.transform,yr=Mt==="map",Vr=Et==="map",Ir=Lt==="map",Qr=Ft==="map",Nr=g.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Yr=!1;const Cn=et.depthModeForSublayer(0,fn.ReadOnly),Br=new fn(et.context.gl.LEQUAL,fn.ReadOnly,et.depthRangeFor3D),Tr=[h.aF(ur.center.lng),h.aJ(ur.center.lat)],en=g.layout.get("text-variable-anchor"),Hr=ur.projection.name==="globe",un=[],Tn=[0,-1,0];for(const Ln of _e){const xn=o.getTile(Ln),mn=xn.getBucket(g);if(!mn||mn.projection.name==="mercator"&&Hr||mn.fullyClipped)continue;const Xn=mn.projection.name==="globe",Gn=Xn?h.aj(ur.zoom):0,Wn=Su(Ln,mn.getProjection(),ur),Un=ur.calculatePixelsToTileUnitsMatrix(xn),hs=en&&mn.hasTextData(),vs=mn.hasIconTextFit()&&hs&&mn.hasIconData(),Ts=mn.getProjection().createInversionMatrix(ur,Ln.canonical),no=(1<<xn.tileID.canonical.z)*h.al/et.transform.worldSize,fs=Do=>{let Ss=[0,0,0];if(Do){const cs=et.style.directionalLight,so=et.style.ambientLight;cs&&so&&(Ss=sp(et.style,cs,so))}return Ss},qs=Do=>{ur.depthOcclusionForSymbolsAndCircles&&(g.hasOcclusionOpacityProperties||et.terrain)&&(Do.push("DEPTH_D24"),Do.push("DEPTH_OCCLUSION"))},io=Do=>{g.lut&&!hr&&(g.lut.texture||(g.lut.texture=new h.dY(et.context,g.lut.image,[g.lut.image.height,g.lut.image.height,g.lut.image.height],gr.gl.RGBA8)),gr.activeTexture.set(gr.gl.TEXTURE0+ga.LUT),g.lut.texture&&g.lut.texture.bind(gr.gl.LINEAR,gr.gl.CLAMP_TO_EDGE),Do.push("APPLY_LUT_ON_GPU"))},Ao=()=>{const Do=yr&&g.layout.get("symbol-placement")!=="point",Ss=[];qs(Ss),io(Ss);const cs=Do||vs,so=mn.elevationType==="road",Ho=et.shadowRenderer,Fo=so&&Ir&&!!Ho&&Ho.enabled,yl=fs(Fo),Wl=so&&Ir&&!et.terrain?Br:Cn,Bu=g.paint.get("icon-image-cross-fade");et.terrainRenderModeElevated()&&Ir&&Ss.push("PITCH_WITH_MAP_TERRAIN"),Xn&&(Ss.push("PROJECTION_GLOBE_VIEW"),cs&&Ss.push("PROJECTED_POS_ON_VIEWPORT")),Bu>0&&mn.hasAnySecondaryIcon&&Ss.push("ICON_TRANSITION"),!mn.icon.zOffsetVertexBuffer||so&&et.terrain||Ss.push("Z_OFFSET"),$t===0&&Yt===0&&tr===0&&sr===1||Ss.push("COLOR_ADJUSTMENT"),mn.sdfIcons&&Ss.push("RENDER_SDF"),Fo&&Ss.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),so&&Ir&&!et.terrain&&mn.icon.orientationVertexBuffer&&Ss.push("ELEVATED_ROADS");const Vu=mn.icon.programConfigurations.get(g.id),Au=et.getOrCreateProgram("symbol",{config:Vu,defines:Ss}),Ru=xn.imageAtlasTexture?xn.imageAtlasTexture.size:[0,0],du=mn.iconSizeData,Ju=h.bK(du,ur.zoom),cp=Ir||!ur.isOrthographic,Zo=au(Wn,xn.tileID.canonical,Ir,yr,ur,mn.getProjection(),Un),Yo=Im(Wn,xn.tileID.canonical,Ir,yr,ur,mn.getProjection(),Un),Oo=et.translatePosMatrix(Yo,xn,ut,yt,!0),Cl=et.translatePosMatrix(Wn,xn,ut,yt),Nl=cs?hm:Zo,$a=yr&&!Ir&&!Do;let tu=Tn;!Hr&&!ur.mercatorFromTransition||yr||(tu=bv(ur));const Ep=Xn?tu:Tn,Np=g.getColorAdjustmentMatrix($t,Yt,tr,sr),up=_v(du.kind,Ju,$a,Ir,et,Cl,Nl,Oo,pr,!1,Ru,[0,0],0,Ln,Gn,Tr,Ts,Ep,mn.getProjection(),yl,no,Np,Bu,null),vm=xn.imageAtlasTexture?xn.imageAtlasTexture:null,bm=g.layout.get("icon-size").constantOr(0)!==1||mn.iconsNeedLinear,Tp=mn.sdfIcons||et.options.rotating||et.options.zooming||bm||cp?dr.LINEAR:dr.NEAREST,zy=mn.sdfIcons&&g.paint.get("icon-halo-width").constantOr(1)!==0,Bp=et.terrain&&Ir&&Do?h.bl(h.bC(),Zo):hm;if(Do&&mn.icon){const Sp=ur.elevation,Vp=Sp?Sp.getAtTileOffsetFunc(Ln,ur.center.lat,ur.worldSize,mn.getProjection()):null,Px=nm(Wn,xn.tileID.canonical,Ir,yr,ur,mn.getProjection(),Un);ly(mn,Wn,et,!1,Px,Yo,Ir,Ot,Vp,Ln)}return{program:Au,buffers:mn.icon,uniformValues:up,atlasTexture:vm,atlasTextureIcon:null,atlasInterpolation:Tp,atlasInterpolationIcon:null,isSDF:mn.sdfIcons,hasHalo:zy,depthMode:Wl,tile:xn,renderWithShadows:Fo,labelPlaneMatrixInv:Bp}},bs=()=>{const Do=Vr&&g.layout.get("symbol-placement")!=="point",Ss=[],cs=Do||en||vs,so=mn.elevationType==="road",Ho=et.shadowRenderer,Fo=so&&Qr&&!!Ho&&Ho.enabled,yl=fs(Fo),Wl=so&&Qr&&!et.terrain?Br:Cn;et.terrainRenderModeElevated()&&Qr&&Ss.push("PITCH_WITH_MAP_TERRAIN"),Xn&&(Ss.push("PROJECTION_GLOBE_VIEW"),cs&&Ss.push("PROJECTED_POS_ON_VIEWPORT")),!mn.text.zOffsetVertexBuffer||so&&et.terrain||Ss.push("Z_OFFSET"),mn.iconsInText&&Ss.push("RENDER_TEXT_AND_SYMBOL"),Ss.push("RENDER_SDF"),Fo&&Ss.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),so&&Qr&&!et.terrain&&mn.text.orientationVertexBuffer&&Ss.push("ELEVATED_ROADS"),qs(Ss);const Bu=mn.text.programConfigurations.get(g.id),Vu=et.getOrCreateProgram("symbol",{config:Bu,defines:Ss});let Au,Ru=[0,0],du=null;const Ju=mn.textSizeData;mn.iconsInText&&(Ru=xn.imageAtlasTexture?xn.imageAtlasTexture.size:[0,0],du=xn.imageAtlasTexture?xn.imageAtlasTexture:null,Au=Qr||!ur.isOrthographic||et.options.rotating||et.options.zooming||Ju.kind==="composite"||Ju.kind==="camera"?dr.LINEAR:dr.NEAREST);const cp=xn.glyphAtlasTexture?xn.glyphAtlasTexture.size:[0,0],Zo=g.layout.get("text-size-scale-range"),Yo=h.aA(et.scaleFactor,Zo[0],Zo[1]),Oo=h.bK(Ju,ur.zoom,Yo),Cl=au(Wn,xn.tileID.canonical,Qr,Vr,ur,mn.getProjection(),Un),Nl=Im(Wn,xn.tileID.canonical,Qr,Vr,ur,mn.getProjection(),Un),$a=et.translatePosMatrix(Nl,xn,pt,vt,!0),tu=et.translatePosMatrix(Wn,xn,pt,vt),Ep=cs?hm:Cl,Np=Vr&&!Qr&&!Do;let up=Tn;!Hr&&!ur.mercatorFromTransition||Vr||(up=bv(ur));const vm=_v(Ju.kind,Oo,Np,Qr,et,tu,Ep,$a,pr,!0,cp,Ru,0,Ln,Gn,Tr,Ts,Xn?up:Tn,mn.getProjection(),yl,no,null,null,Yo),bm=xn.glyphAtlasTexture?xn.glyphAtlasTexture:null,Tp=dr.LINEAR,zy=g.paint.get("text-halo-width").constantOr(1)!==0,Bp=et.terrain&&Qr&&Do?h.bl(h.bC(),Cl):hm;if(Do&&mn.text){const Sp=ur.elevation,Vp=Sp?Sp.getAtTileOffsetFunc(Ln,ur.center.lat,ur.worldSize,mn.getProjection()):null,Px=nm(Wn,xn.tileID.canonical,Qr,Vr,ur,mn.getProjection(),Un);ly(mn,Wn,et,!0,Px,Nl,Qr,qt,Vp,Ln)}return{program:Vu,buffers:mn.text,uniformValues:vm,atlasTexture:bm,atlasTextureIcon:du,atlasInterpolation:Tp,atlasInterpolationIcon:Au,isSDF:!0,hasHalo:zy,depthMode:Wl,tile:xn,renderWithShadows:Fo,labelPlaneMatrixInv:Bp}},Qs=mn.icon.segments.get().length,Xs=mn.text.segments.get().length,to=Qs&&!lt.onlyText?Ao():null,ko=Xs&&!lt.onlyIcons?bs():null,Ko=g.paint.get("icon-opacity").constantOr(1),zl=g.paint.get("text-opacity").constantOr(1);if(Nr&&mn.canOverlap){Yr=!0;const Do=Ko&&!lt.onlyText?mn.icon.segments.get():[],Ss=zl&&!lt.onlyIcons?mn.text.segments.get():[];for(const cs of Do)un.push({segments:new h.bg([cs]),sortKey:cs.sortKey,state:to});for(const cs of Ss)un.push({segments:new h.bg([cs]),sortKey:cs.sortKey,state:ko})}else lt.onlyText||un.push({segments:Ko?mn.icon.segments:new h.bg([]),sortKey:0,state:to}),lt.onlyIcons||un.push({segments:zl?mn.text.segments:new h.bg([]),sortKey:0,state:ko})}Yr&&un.sort((Ln,xn)=>Ln.sortKey-xn.sortKey);for(const Ln of un){const xn=Ln.state;if(xn)if(et.terrain?et.terrain.setupElevationDraw(xn.tile,xn.program,{useDepthForOcclusion:ur.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:xn.labelPlaneMatrixInv}):et.setupDepthForOcclusion(ur.depthOcclusionForSymbolsAndCircles,xn.program),gr.activeTexture.set(dr.TEXTURE0),xn.atlasTexture&&xn.atlasTexture.bind(xn.atlasInterpolation,dr.CLAMP_TO_EDGE,!0),xn.atlasTextureIcon&&(gr.activeTexture.set(dr.TEXTURE1),xn.atlasTextureIcon&&xn.atlasTextureIcon.bind(xn.atlasInterpolationIcon,dr.CLAMP_TO_EDGE,!0)),xn.renderWithShadows&&et.shadowRenderer.setupShadows(xn.tile.tileID.toUnwrapped(),xn.program,"vector-tile"),et.uploadCommonLightUniforms(et.context,xn.program),xn.hasHalo){const mn=xn.uniformValues;mn.u_is_halo=1,ax(xn.buffers,Ln.segments,g,et,xn.program,xn.depthMode,nt,st,mn,2),mn.u_is_halo=0}else{if(xn.isSDF){const mn=xn.uniformValues;xn.hasHalo&&(mn.u_is_halo=1,ax(xn.buffers,Ln.segments,g,et,xn.program,xn.depthMode,nt,st,mn,1)),mn.u_is_halo=0}ax(xn.buffers,Ln.segments,g,et,xn.program,xn.depthMode,nt,st,xn.uniformValues,1)}}}function ax(et,o,g,_e,nt,st,lt,ut,pt,yt){const vt=[et.dynamicLayoutVertexBuffer,et.opacityVertexBuffer,et.iconTransitioningVertexBuffer,et.globeExtVertexBuffer,et.zOffsetVertexBuffer,et.orientationVertexBuffer];nt.draw(_e,_e.context.gl.TRIANGLES,st,lt,ut,ts.disabled,pt,g.id,et.layoutVertexBuffer,et.indexBuffer,o,g.paint,_e.transform.zoom,et.programConfigurations.get(g.id),vt,yt)}function Z0(et,o){const g=1<<et.canonical.z,_e=(o.x*g-et.canonical.x-et.wrap*g)*h.al,nt=(o.y*g-et.canonical.y)*h.al,st=h.e5(o.z,o.y);return h.d4(_e,nt,st)}function Bm(et,o,g,_e,nt){if(!g.layout||g.layout.get("fill-elevation-reference")==="none")return;const st=et.context.gl,lt=new fn(et.context.gl.LEQUAL,fn.ReadWrite,et.depthRangeFor3D),ut=new fn(et.context.gl.GREATER,fn.ReadWrite,et.depthRangeFor3D),pt=function(Lt){let Ft=.01;return Lt.isOrthographic&&(Ft=h.ak(1e-4,Ft,h.c$(Lt.pitch>=np?1:Lt.pitch/np))),2*Ft}(et.transform),yt=et.transform.getFreeCameraOptions().position,vt="elevatedStructuresDepthReconstruct",Mt=et.getOrCreateProgram(vt,{defines:["DEPTH_RECONSTRUCTION"]}),Et=et.getOrCreateProgram(vt);for(const Lt of _e){const Ft=o.getTile(Lt),Ot=Ft.getBucket(g);if(!Ot)continue;const qt=Ot.elevatedStructures;if(!qt)continue;const $t=Ot.elevationBufferData.heightRange,Yt=Z0(Lt.toUnwrapped(),yt),tr=et.translatePosMatrix(Lt.projMatrix,Ft,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));let sr,pr,hr,gr;if(nt==="initialize"){if(!$t||$t.min>=1||qt.depthSegments.segments[0].primitiveLength===0)continue;sr=Q_(tr,Yt,pt,1,0),pr=lt,hr=qt.depthSegments,gr=Mt}else if(nt==="reset"){if(!$t||$t.min>=0||qt.maskSegments.segments[0].primitiveLength===0)continue;sr=Q_(tr,Yt,0,0,1),pr=ut,hr=qt.maskSegments,gr=Mt}else if(nt==="geometry"){if(qt.depthSegments.segments[0].primitiveLength===0)continue;sr=Q_(tr,Yt,pt,1,0),pr=lt,hr=qt.depthSegments,gr=Et}gr.draw(et,st.TRIANGLES,pr,Vn.disabled,Pn.disabled,ts.disabled,sr,g.id,qt.vertexBuffer,qt.indexBuffer,hr,g.paint,et.transform.zoom)}}function Ay(et,o,g){const{painter:_e,sourceCache:nt,layer:st,coords:lt,colorMode:ut,elevationType:pt,terrainEnabled:yt,pass:vt}=et,Mt=_e.context.gl,Et=st.paint.get("fill-pattern"),Lt=st.paint.get("fill-pattern-cross-fade"),Ft=Et.constantOr(null);let Ot=pt;pt!=="road"||o&&!yt||(Ot="none");const qt=Ot==="road",$t=et.painter.shadowRenderer,Yt=qt&&!!$t&&$t.enabled,tr=new fn(_e.context.gl.LEQUAL,fn.ReadOnly,_e.depthRangeFor3D);let sr=[0,0,0];if(Yt){const gr=_e.style.directionalLight,dr=_e.style.ambientLight;gr&&dr&&(sr=sp(_e.style,gr,dr))}const pr=Et&&Et.constantOr(1),hr=(gr,dr)=>{let ur,yr,Vr,Ir,Qr;dr?(ur=pr&&!st.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Vr=Mt.LINES):(ur=pr?"fillPattern":"fill",Vr=Mt.TRIANGLES);for(const Nr of lt){const Yr=nt.getTile(Nr);if(pr&&!Yr.patternsLoaded())continue;const Cn=Yr.getBucket(st);if(!Cn)continue;const Br=o?Cn.elevationBufferData:Cn.bufferData;if(Br.isEmpty())continue;_e.prepareDrawTile();const Tr=Br.programConfigurations.get(st.id),en=_e.isTileAffectedByFog(Nr),Hr=[],un=[];qt&&(Hr.push("ELEVATED_ROADS"),un.push(Br.elevatedLayoutVertexBuffer)),Yt&&Hr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),pr&&(_e.context.activeTexture.set(Mt.TEXTURE0),Yr.imageAtlasTexture&&Yr.imageAtlasTexture.bind(Mt.LINEAR,Mt.CLAMP_TO_EDGE),Tr.updatePaintBuffers());let Tn=!1;if(Ft&&Yr.imageAtlas){const Gn=Yr.imageAtlas,Wn=h.e0.from(Ft),Un=Wn.getPrimary().scaleSelf(h.o.devicePixelRatio).toString(),hs=Wn.getSecondary(),vs=Gn.patternPositions.get(Un),Ts=hs?Gn.patternPositions.get(hs.scaleSelf(h.o.devicePixelRatio).toString()):null;Tn=!!vs&&!!Ts,vs&&Tr.setConstantPatternPositions(vs,Ts)}Lt>0&&(Tn||Tr.getPatternTransitionVertexBuffer("fill-pattern"))&&Hr.push("FILL_PATTERN_TRANSITION");const Ln=_e.getOrCreateProgram(ur,{config:Tr,overrideFog:en,defines:Hr}),xn=_e.translatePosMatrix(Nr.projMatrix,Yr,st.paint.get("fill-translate"),st.paint.get("fill-translate-anchor"));Yt&&$t.setupShadows(Yr.tileID.toUnwrapped(),Ln,"vector-tile");const mn=st.paint.get("fill-emissive-strength");if(dr){Ir=Br.lineIndexBuffer,Qr=Br.lineSegments;const Gn=_e.terrain&&_e.terrain.renderingToTexture?_e.terrain.drapeBufferSize:[Mt.drawingBufferWidth,Mt.drawingBufferHeight];yr=ur==="fillOutlinePattern"&&pr?Mw(xn,mn,_e,Yr,Gn,sr,Lt):Iw(xn,mn,Gn,sr)}else Ir=Br.indexBuffer,Qr=Br.triangleSegments,yr=pr?Om(xn,mn,_e,Yr,sr,Lt):uv(xn,mn,sr);_e.uploadCommonUniforms(_e.context,Ln,Nr.toUnwrapped());let Xn=gr;(pt==="road"&&!yt||pt==="offset")&&(Xn=tr),Ln.draw(_e,Vr,Xn,g||_e.stencilModeForClipping(Nr),ut,ts.disabled,yr,st.id,Br.layoutVertexBuffer,Ir,Qr,st.paint,_e.transform.zoom,Tr,un)}};_e.renderPass===vt&&hr(_e.depthModeForSublayer(1,_e.renderPass==="opaque"?fn.ReadWrite:fn.ReadOnly),!1),Ot==="none"&&_e.renderPass==="translucent"&&st.paint.get("fill-antialias")&&hr(_e.depthModeForSublayer(st.getPaintProperty("fill-outline-color")?2:0,fn.ReadOnly),!0)}function Fn(et,o,g,_e,nt,st,lt,ut){g.resetLayerRenderingStats(et);const pt=et.context,yt=pt.gl,vt=et.transform,Mt=g.paint.get("fill-extrusion-pattern"),Et=g.paint.get("fill-extrusion-pattern-cross-fade"),Lt=Mt.constantOr(null),Ft=Mt.constantOr(1),Ot=g.paint.get("fill-extrusion-opacity"),qt=et.style.enable3dLights(),$t=g.paint.get(qt&&!Ft?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Yt=[g.paint.get("fill-extrusion-ambient-occlusion-intensity"),$t],tr=g.layout.get("fill-extrusion-edge-radius"),sr=tr>0&&!g.paint.get("fill-extrusion-rounded-roof"),pr=sr?0:tr,hr=vt.projection.name==="globe"?h.e8():0,gr=vt.projection.name==="globe",dr=gr?h.aj(vt.zoom):0,ur=[h.aF(vt.center.lng),h.aJ(vt.center.lat)],yr=g.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Vr=g.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(yr?null:g.lut).toArray01().slice(0,3),Ir=g.paint.get("fill-extrusion-flood-light-intensity"),Qr=g.paint.get("fill-extrusion-vertical-scale"),Nr=g.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Yr=g.paint.get("fill-extrusion-height-alignment"),Cn=g.paint.get("fill-extrusion-base-alignment"),Br=Fu(et,g.paint.get("fill-extrusion-cutoff-fade-range")),Tr=[];let en;gr&&Tr.push("PROJECTION_GLOBE_VIEW"),Yt[0]>0&&Tr.push("FAUX_AO"),sr&&Tr.push("ZERO_ROOF_RADIUS"),ut&&Tr.push("HAS_CENTROID"),Ir>0&&Tr.push("FLOOD_LIGHT"),Br.shouldRenderCutoff&&Tr.push("RENDER_CUTOFF"),Nr&&Tr.push("RENDER_WALL_MODE");const Hr=et.renderPass==="shadow",un=et.shadowRenderer,Tn=Hr&&!!un,Ln=Hr?ts.disabled:ts.backCCW;et.shadowRenderer&&(et.shadowRenderer.useNormalOffset=!0);let xn=[0,0,0];if(un){const Gn=et.style.directionalLight,Wn=et.style.ambientLight;Gn&&Wn&&(xn=sp(et.style,Gn,Wn)),Hr||(Tr.push("RENDER_SHADOWS","DEPTH_TEXTURE"),un.useNormalOffset&&Tr.push("NORMAL_OFFSET")),en=Tr.concat(["SHADOWS_SINGLE_CASCADE"])}const mn=Tn?"fillExtrusionDepth":Ft?"fillExtrusionPattern":"fillExtrusion",Xn=g.getLayerRenderingStats();for(const Gn of _e){const Wn=o.getTile(Gn),Un=Wn.getBucket(g);if(!Un||Un.projection.name!==vt.projection.name)continue;let hs=!1;un&&(hs=un.getMaxCascadeForTile(Gn.toUnwrapped())===0);const vs=et.isTileAffectedByFog(Gn),Ts=Un.programConfigurations.get(g.id);let no=!1;if(Lt&&Wn.imageAtlas){const Xs=Wn.imageAtlas,to=h.e0.from(Lt),ko=to.getPrimary().scaleSelf(h.o.devicePixelRatio).toString(),Ko=to.getSecondary(),zl=Xs.patternPositions.get(ko),Do=Ko?Xs.patternPositions.get(Ko.scaleSelf(h.o.devicePixelRatio).toString()):null;no=!!zl&&!!Do,zl&&Ts.setConstantPatternPositions(zl,Do)}Et>0&&(no||Ts.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Tr.push("FILL_EXTRUSION_PATTERN_TRANSITION");const fs=et.getOrCreateProgram(mn,{config:Ts,defines:hs?en:Tr,overrideFog:vs});if(et.terrain&&et.terrain.setupElevationDraw(Wn,fs,{useMeterToDem:!0}),!Un.centroidVertexBuffer){const Xs=fs.getAttributeLocation(yt,"a_centroid_pos");Xs!==-1&&yt.vertexAttrib2f(Xs,0,0)}!Hr&&un&&un.setupShadows(Wn.tileID.toUnwrapped(),fs,"vector-tile"),Ft&&(et.context.activeTexture.set(yt.TEXTURE0),Wn.imageAtlasTexture&&Wn.imageAtlasTexture.bind(yt.LINEAR,yt.CLAMP_TO_EDGE),Ts.updatePaintBuffers());const qs=g.paint.get("fill-extrusion-vertical-gradient"),io=1/Un.tileToMeter;let Ao;if(Hr&&un){if(X0(Wn.tileID,Un.maxHeight,et))continue;const Xs=un.calculateShadowPassMatrixFromTile(Wn.tileID.toUnwrapped());Ao=cv(Xs,pr,io,Qr,Yr,Cn)}else{const Xs=et.translatePosMatrix(Gn.expandedProjMatrix,Wn,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),to=vt.projection.createInversionMatrix(vt,Gn.canonical);Ao=Ft?H0(Xs,et,qs,Ot,Yt,pr,io,Gn,Wn,hr,Yr,Cn,dr,ur,to,Vr,Qr,Et):o_(Xs,et,qs,Ot,Yt,pr,io,Gn,hr,Yr,Cn,dr,ur,to,Vr,Qr,Ir,xn)}et.uploadCommonUniforms(pt,fs,Gn.toUnwrapped(),null,Br);let bs=Un.segments;if(vt.projection.name==="mercator"&&!Hr&&(bs=Un.getVisibleSegments(Wn.tileID,et.terrain,et.transform.getFrustum(0)),!bs.get().length))continue;if(Xn)if(Hr)for(const Xs of bs.get())Xn.numRenderedVerticesInShadowPass+=Xs.primitiveLength;else for(const Xs of bs.get())Xn.numRenderedVerticesInTransparentPass+=Xs.primitiveLength;const Qs=[];(et.terrain||ut)&&Qs.push(Un.centroidVertexBuffer),gr&&Qs.push(Un.layoutVertexExtBuffer),Nr&&Qs.push(Un.wallVertexBuffer),fs.draw(et,pt.gl.TRIANGLES,nt,st,lt,Ln,Ao,g.id,Un.layoutVertexBuffer,Un.indexBuffer,bs,g.paint,et.transform.zoom,Ts,Qs)}et.shadowRenderer&&(et.shadowRenderer.useNormalOffset=!1)}class wv{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function jp(et,o,g,_e,nt,st,lt,ut,pt,yt,vt,Mt,Et,Lt,Ft,Ot,qt,$t,Yt,tr){const sr=o.context,pr=sr.gl,hr=o.transform,gr=o.transform.zoom,dr=[],ur=et.translate,yr=et.translateAnchor,Vr=et.edgeRadius,Ir=Fu(o,et.cutoffFadeRange);vt==="clear"?(dr.push("CLEAR_SUBPASS"),tr&&(dr.push("CLEAR_FROM_TEXTURE"),sr.activeTexture.set(pr.TEXTURE0),tr.bind(pr.LINEAR,pr.CLAMP_TO_EDGE))):vt==="sdf"&&dr.push("SDF_SUBPASS"),$t&&dr.push("HAS_CENTROID"),Ir.shouldRenderCutoff&&dr.push("RENDER_CUTOFF");const Qr=(Nr,Yr,Cn,Br,Tr)=>{const en=Yr.programConfigurations.get(_e.id),Hr=o.isTileAffectedByFog(Nr),un=o.getOrCreateProgram("fillExtrusionGroundEffect",{config:en,defines:dr,overrideFog:Hr}),Tn=((xn,mn,Xn,Gn,Wn,Un,hs,vs,Ts,no,fs)=>({u_matrix:mn,u_opacity:Xn,u_ao_pass:Gn?1:0,u_meter_to_tile:Wn,u_ao:Un,u_flood_light_intensity:hs,u_flood_light_color:vs,u_attenuation:Ts,u_edge_radius:no,u_fb:0,u_fb_size:fs,u_dynamic_offset:1}))(0,Br,Mt,yt,Tr,[Et,Lt*Tr],Ft,Ot,qt,gr>=17?0:Vr*Tr,tr?tr.size[0]:0),Ln=[];$t&&Ln.push(Yr.hiddenByLandmarkVertexBuffer),o.uploadCommonUniforms(sr,un,Nr.toUnwrapped(),null,Ir),un.draw(o,sr.gl.TRIANGLES,st,lt,ut,pt,Tn,_e.id,Yr.vertexBuffer,Yr.indexBuffer,Cn,_e.paint,gr,en,Ln)};for(const Nr of nt){const Yr=g.getTile(Nr),Cn=Yr.getBucket(_e);if(!Cn||Cn.projection.name!==hr.projection.name||!Cn.groundEffect||Cn.groundEffect&&!Cn.groundEffect.hasData())continue;const Br=Cn.groundEffect,Tr=1/Cn.tileToMeter;{const en=o.translatePosMatrix(Nr.projMatrix,Yr,ur,yr),Hr=Br.getDefaultSegment();Qr(Nr,Br,Hr,en,Tr)}if(Yt)for(let en=0;en<4;en++){const Hr=h.e6[en](Nr),un=g.getTile(Hr);if(!un)continue;const Tn=un.getBucket(_e);if(!Tn||Tn.projection.name!==hr.projection.name||!Tn.groundEffect||Tn.groundEffect&&!Tn.groundEffect.hasData())continue;const Ln=Tn.groundEffect;let xn,mn;en===0?(xn=[-h.al,0,0],mn=1):en===1?(xn=[h.al,0,0],mn=0):en===2?(xn=[0,-h.al,0],mn=3):(xn=[0,h.al,0],mn=2);const Xn=Ln.regionSegments[mn];if(!Xn)continue;const Gn=new Float32Array(16);h.br(Gn,Nr.projMatrix,xn),Qr(Nr,Ln,Xn,o.translatePosMatrix(Gn,Yr,ur,yr),Tr)}}}function dm(et,o,g,_e,nt,st,lt){_e.centroidVertexArray.length===0&&_e.createCentroidsBuffer();const ut=st?st.findDEMTileFor(g):null;if(!(ut&&ut.dem||lt))return;st&&ut&&ut.dem&&_e.selfDEMTileTimestamp!==ut.dem._timestamp&&(_e.borderDoneWithNeighborZ=[-1,-1,-1,-1],_e.selfDEMTileTimestamp=ut.dem._timestamp);const pt=$t=>new h.P(Math.ceil(($t+h.ea)*h.eb),0),yt=$t=>{const Yt=o.getSource().minzoom,tr=pr=>{const hr=o.getTileByID(pr);if(hr&&hr.hasData())return hr.getBucket(nt)},sr=[0,-1,1];for(const pr of sr){if($t.overscaledZ+pr<Yt)continue;const hr=tr($t.calculateScaledKey($t.overscaledZ+pr));if(hr)return hr}},vt=[0,0,0],Mt=($t,Yt)=>(vt[0]=Math.min($t.min.y,Yt.min.y),vt[1]=Math.max($t.max.y,Yt.max.y),vt[2]=h.al-Yt.min.x>$t.max.x?Yt.min.x-h.al:$t.max.x,vt),Et=($t,Yt)=>(vt[0]=Math.min($t.min.x,Yt.min.x),vt[1]=Math.max($t.max.x,Yt.max.x),vt[2]=h.al-Yt.min.y>$t.max.y?Yt.min.y-h.al:$t.max.y,vt),Lt=[($t,Yt)=>Mt($t,Yt),($t,Yt)=>Mt(Yt,$t),($t,Yt)=>Et($t,Yt),($t,Yt)=>Et(Yt,$t)],Ft=($t,Yt,tr,sr,pr,hr,gr)=>{if(!st)return 0;const dr=[[hr?tr:$t,hr?$t:tr,0],[hr?tr:Yt,hr?Yt:tr,0]],ur=gr<0?h.al+gr:gr,yr=[hr?ur:($t+Yt)/2,hr?($t+Yt)/2:ur,0];return tr===0&&gr<0||tr!==0&&gr>0?st.getForTilePoints(pr,[yr],!0,sr):dr.push(yr),st.getForTilePoints(g,dr,!0,ut),Math.max(dr[0][2],dr[1][2],yr[2])/st.exaggeration()};for(let $t=0;$t<4;$t++){const Yt=_e.borderFeatureIndices[$t];if(Yt.length===0)continue;const tr=h.e6[$t](g),sr=yt(tr);if(!(sr&&sr instanceof h.e7))continue;const pr=st?st.findDEMTileFor(tr):null;if(!(pr&&pr.dem||lt)||(st&&pr&&pr.dem&&_e.borderDEMTileTimestamp[$t]!==pr.dem._timestamp&&(_e.borderDoneWithNeighborZ[$t]=-1,_e.borderDEMTileTimestamp[$t]=pr.dem._timestamp),_e.borderDoneWithNeighborZ[$t]===sr.canonical.z))continue;sr.centroidVertexArray.length===0&&sr.createCentroidsBuffer();const hr=($t<2?1:5)-$t,gr=sr.borderDoneWithNeighborZ[hr]!==_e.canonical.z,dr=sr.borderFeatureIndices[hr];let ur=0;if(_e.canonical.z!==sr.canonical.z){for(const yr of Yt)_e.showCentroid(_e.featuresOnBorder[yr]);if(gr)for(const yr of dr)sr.showCentroid(sr.featuresOnBorder[yr]);_e.borderDoneWithNeighborZ[$t]=sr.canonical.z,sr.borderDoneWithNeighborZ[hr]=_e.canonical.z}for(const yr of Yt){const Vr=_e.featuresOnBorder[yr],Ir=_e.centroidData[Vr.centroidDataIndex],Qr=Vr.borders[$t];let Nr;for(;ur<dr.length;){Nr=sr.featuresOnBorder[dr[ur]];const Yr=Nr.borders[hr];if(Yr[1]>Qr[0]+3||Yr[0]>Qr[0]-3)break;sr.showCentroid(Nr),ur++}if(Nr&&ur<dr.length){const Yr=ur;let Cn=0;for(;!(Nr.borders[hr][0]>Qr[1]-3)&&(Cn++,++ur!==dr.length);)Nr=sr.featuresOnBorder[dr[ur]];Nr=sr.featuresOnBorder[dr[Yr]];let Br=!1;if(Cn>=1){const Hr=Nr.borders[hr];Math.abs(Qr[0]-Hr[0])<3&&Math.abs(Qr[1]-Hr[1])<3&&(Cn=1,Br=!0,ur=Yr+1)}else if(Cn===0){_e.showCentroid(Vr);continue}const Tr=sr.centroidData[Nr.centroidDataIndex];lt&&Br&&(((Ot=Ir).flags|(qt=Tr).flags)&h.e9?(Ot.flags|=h.e9,qt.flags|=h.e9):(Ot.flags&=~h.e9,qt.flags&=~h.e9));const en=Vr.intersectsCount()>1||Nr.intersectsCount()>1;if(Cn>1)ur=Yr,Ir.centroidXY=Tr.centroidXY=new h.P(0,0);else if(pr&&pr.dem&&!en){const Hr=Lt[$t](Ir,Tr),un=$t%2?h.al-1:0,Tn=Ft(Hr[0],Math.min(h.al-1,Hr[1]),un,pr,tr,$t<2,Hr[2]);Ir.centroidXY=Tr.centroidXY=pt(Tn)}else en?Ir.centroidXY=Tr.centroidXY=new h.P(0,0):(Ir.centroidXY=_e.encodeBorderCentroid(Vr),Tr.centroidXY=sr.encodeBorderCentroid(Nr));_e.writeCentroidToBuffer(Ir),sr.writeCentroidToBuffer(Tr)}else _e.showCentroid(Vr)}_e.borderDoneWithNeighborZ[$t]=sr.canonical.z,sr.borderDoneWithNeighborZ[hr]=_e.canonical.z}var Ot,qt;(_e.needsCentroidUpdate||!_e.centroidVertexBuffer&&_e.centroidVertexArray.length!==0)&&_e.uploadCentroid(et)}const pm=[1,0,0],os=[0,1,0],Ev=[0,0,1];function X0(et,o,g){const _e=g.transform,nt=g.shadowRenderer;if(!nt)return!0;const st=et.toUnwrapped(),lt=_e.tileSize*nt._cascades[g.currentShadowCascade].scale;let ut=o;if(_e.elevation){const Ot=_e.elevation.getMinMaxForTile(et);Ot&&(ut+=Ot.max)}const pt=[...nt.shadowDirection];pt[2]=-pt[2];const yt=nt.computeSimplifiedTileShadowVolume(st,ut,lt,pt);if(!yt)return!1;const vt=[pm,os,Ev,pt,[pt[0],0,pt[2]],[0,pt[1],pt[2]]],Mt=_e.projection.name==="globe",Et=_e.scaleZoom(lt),Lt=h.cA.fromInvProjectionMatrix(_e.invProjMatrix,_e.worldSize,Et,!Mt),Ft=nt.getCurrentCascadeFrustum();return Lt.intersectsPrecise(yt.vertices,yt.planes,vt)===0||Ft.intersectsPrecise(yt.vertices,yt.planes,vt)===0}function lx(et){const{painter:o,source:g,layer:_e,coords:nt}=et;let st=et.defines;const lt=o.context,ut=o.renderPass==="shadow",pt=o.renderPass==="light-beam",yt=o.shadowRenderer,vt=h.ec(o.transform.center.lat,o.transform.zoom),Mt=Fu(o,_e.paint.get("building-cutoff-fade-range"));Mt.shouldRenderCutoff&&(st=st.concat("RENDER_CUTOFF"));for(const Et of nt){const Lt=g.getTile(Et),Ft=Lt.getBucket(_e);if(!Ft)continue;yt&&yt.getMaxCascadeForTile(Et.toUnwrapped())===0&&(st=st.concat("SHADOWS_SINGLE_CASCADE"));const Ot=Ft.programConfigurations.get(_e.id);let qt,$t,Yt,tr=o.translatePosMatrix(Et.expandedProjMatrix,Lt,[0,0],"map");if(tr=h.cR(h.bC(),tr,[1,1,et.verticalScale]),ut&&yt){if(X0(Lt.tileID,Ft.maxHeight*vt,o))continue;let pr=yt.calculateShadowPassMatrixFromTile(Lt.tileID.toUnwrapped());pr=h.cR(h.bC(),pr,[1,1,et.verticalScale]),Yt=hv(pr),qt=$t=o.getOrCreateProgram("buildingDepth",{config:Ot,defines:st,overrideFog:!1})}else if(pt)qt=$t=o.getOrCreateProgram("buildingBloom",{config:Ot,defines:st,overrideFog:!1}),Yt=Lw(tr);else{const pr=o.transform.calculatePosMatrix(Et.toUnwrapped(),o.transform.worldSize);h.cR(pr,pr,[1,1,et.verticalScale]);const hr=h.bC();h.cR(hr,pr,[1,-1,1/vt]),h.bl(hr,hr),h.ed(hr,hr);const gr=o.transform.getFreeCameraOptions().position,dr=1<<Et.canonical.z;Yt=Dw(tr,hr,et.opacity,et.facadeAOIntensity,[((gr.x-Et.wrap)*dr-Et.canonical.x)*h.al,(gr.y*dr-Et.canonical.y)*h.al,gr.z*dr*h.al],Ft.tileToMeter,et.facadeEmissiveChance),$t=o.getOrCreateProgram("building",{config:Ot,defines:st,overrideFog:!1});const ur=st.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);qt=o.getOrCreateProgram("building",{config:Ot,defines:ur,overrideFog:!1}),yt&&(yt.setupShadowsFromMatrix(pr,$t,!0),yt.setupShadowsFromMatrix(pr,qt,!0))}const sr=(pr,hr)=>{if(pt){const gr=pr.entranceBloom;hr.draw(o,lt.gl.TRIANGLES,et.depthMode,Vn.disabled,et.blendMode,ts.disabled,Yt,_e.id,gr.layoutVertexBuffer,gr.indexBuffer,gr.segmentsBucket,_e.paint,o.transform.zoom,Ot,[gr.layoutAttenuationBuffer,gr.layoutColorBuffer])}else{const gr=pr.segmentsBucket;let dr=[pr.layoutNormalBuffer,pr.layoutCentroidBuffer,pr.layoutColorBuffer];pr.layoutFacadePaintBuffer&&(dr=dr.concat([pr.layoutFacadeDataBuffer,pr.layoutFacadeVerticalRangeBuffer,pr.layoutFacadePaintBuffer])),hr.draw(o,lt.gl.TRIANGLES,et.depthMode,Vn.disabled,et.blendMode,ut?ts.disabled:ts.backCW,Yt,_e.id,pr.layoutVertexBuffer,pr.indexBuffer,gr,_e.paint,o.transform.zoom,Ot,dr)}};o.uploadCommonUniforms(lt,$t,Et.toUnwrapped(),null,Mt),Ft.buildingWithoutFacade&&sr(Ft.buildingWithoutFacade,$t),qt!==$t&&o.uploadCommonUniforms(lt,qt,Et.toUnwrapped(),null,Mt),Ft.buildingWithFacade&&sr(Ft.buildingWithFacade,qt)}}function ux(et){return[et[0]*h.ee,et[1]*h.ee,et[2]*h.ee,0]}function hx(et,o,g,_e,nt,st,lt,ut,pt){const yt=_e.getSource(),vt=g.globeSharedBuffers;if(!vt)return;let Mt,Et,Lt;if(o&&(Mt=_e.getTile(o)),yt instanceof h.aS?(Et=yt.texture,Lt=h.dG(0,0,g.transform)):Mt&&o&&(Et=Mt.texture,Lt=h.dG(o.canonical.z,o.canonical.x,g.transform)),!Et||!Lt)return;et||(Lt=h.cR(h.bC(),Lt,[1,-1,1]));const Ft=g.context,Ot=Ft.gl,qt=nt.paint.get("raster-resampling")==="nearest"?Ot.NEAREST:Ot.LINEAR,$t=g.colorModeForDrapableLayerRenderPass(st),Yt=lt.defines;Yt.push("GLOBE_POLES");const tr=new fn(Ot.LEQUAL,fn.ReadWrite,g.depthRangeFor3D),sr=Float32Array.from(g.transform.expandedFarZProjMatrix),pr=Float32Array.from(h.bk(h.dF(new h.cC(0,0,0))));g.terrain&&g.terrain.prepareDrawTile(),Ft.activeTexture.set(Ot.TEXTURE0),Et.bind(qt,Ot.CLAMP_TO_EDGE),Ft.activeTexture.set(Ot.TEXTURE1),Et.bind(qt,Ot.CLAMP_TO_EDGE),"useMipmap"in Et&&Ft.extTextureFilterAnisotropic&&g.transform.pitch>20&&Ot.texParameterf(Ot.TEXTURE_2D,Ft.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Ft.extTextureFilterAnisotropicMax);const[hr,gr,dr,ur]=o?vt.getPoleBuffers(o.canonical.z,!1):vt.getPoleBuffers(0,!0),yr=nt.paint.get("raster-elevation");let Vr;et?(Vr=hr,g.renderDefaultNorthPole=yr!==0):(Vr=gr,g.renderDefaultSouthPole=yr!==0);const Ir=ux(lt.mix),Qr=((Yr,Cn,Br,Tr,en,Hr,un,Tn,Ln,xn,mn,Xn,Gn)=>J_(Yr,Cn,Br,new Float32Array(16),new Float32Array(9),[0,0],Tr,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Hr,[0,0],Tn,2,xn,mn,Xn,1,0,Gn))(sr,pr,Lt,h.aj(g.transform.zoom),0,nt,0,yr,0,Ir,lt.offset,lt.range,st),Nr=g.getOrCreateProgram("raster",{defines:Yt});g.uploadCommonUniforms(Ft,Nr,null),Nr.draw(g,Ot.TRIANGLES,tr,pt,$t,ut,Qr,nt.id,Vr,dr,ur)}function Ow(et){const o=et._nearZ,g=et.projection.farthestPixelDistance(et),_e=g-o,nt=.2*et.height,st=o+nt;return[o,g,(st-nt-o)/_e,(st-o)/_e]}function K0(et,o,g,_e){if(et)return o instanceof ip&&et instanceof Am?o.getTextureDescriptor(et,g,!0):{texture:et.texture,mix:ux(_e.mix),offset:_e.offset,buffer:0,tileSize:1}}var zw=h.ef([{name:"a_index",type:"Int16",components:1}]);class Nw{constructor(o,g,_e,nt){const st={width:_e[0],height:_e[1],data:null},lt=o.gl;this.targetColorTexture=new h.T(o,st,lt.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new h.T(o,st,lt.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(g,nt),this.lastInvalidatedAt=0}updateParticleTexture(o,g){if(this.particleTextureDimension===g.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const _e=this.context.gl,nt=g.width*g.height;this.particleTexture0=new h.T(this.context,g,_e.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new h.T(this.context,g,_e.RGBA8,{premultiply:!1,useMipmap:!1});const st=new h.eg;st.reserve(nt);for(let lt=0;lt<nt;lt++)st.emplaceBack(lt);this.particleIndexBuffer=this.context.createVertexBuffer(st,zw.members,!0),this.particleSegment=h.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=g.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=h.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Cu(et,o,g){if(!et)return null;const _e=o.getTextureDescriptor(et,g,!0);if(!_e)return null;let{texture:nt,mix:st,offset:lt,tileSize:ut,buffer:pt,format:yt}=_e;if(!nt||!yt)return null;let vt=!1;return yt==="uint32"&&(vt=!0,st[3]=0,st=fv(h.eh,st,[0,g.paint.get("raster-particle-max-speed")]),lt=mv(h.eh,lt,[0,g.paint.get("raster-particle-max-speed")])),{texture:nt,textureOffset:[pt/(ut+2*pt),ut/(ut+2*pt)],tileSize:ut,scalarData:vt,scale:st,offset:lt,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[yt]]}}function Tv(et){const o=et._nearZ,g=et.projection.farthestPixelDistance(et),_e=g-o,nt=.2*et.height,st=o+nt;return[o,g,(st-nt-o)/_e,(st-o)/_e]}const hu=new h.ao(1,0,0,1),fm=new h.ao(0,1,0,1),Y0=new h.ao(0,0,1,1),Sv=new h.ao(1,0,1,1),Cv=new h.ao(0,1,1,1);function dx(et,o,g,_e,nt,st){for(let lt=0;lt<g.length;lt++)if(nt){const yt=new h.ao(_e.r*.8,_e.g*.8,_e.b*.8,1);Vm(et,o,g[lt],_e,-1,-1,st),Vm(et,o,g[lt],_e,-1,1,st),Vm(et,o,g[lt],_e,1,1,st),Vm(et,o,g[lt],_e,1,-1,st),Vm(et,o,g[lt],yt,0,0,st)}else Vm(et,o,g[lt],_e,0,0,st)}function Vm(et,o,g,_e,nt,st,lt){const ut=et.context,pt=et.transform,yt=ut.gl,vt=pt.projection.name==="globe",Mt=vt?["PROJECTION_GLOBE_VIEW"]:[];let Et=h.bz(g.projMatrix);if(vt&&h.aj(pt.zoom)>0){const Ir=h.bj(g.canonical,pt),Qr=h.ei(Ir);Et=h.aB(new Float32Array(16),pt.globeMatrix,Qr),h.aB(Et,pt.projMatrix,Et)}const Lt=h.bC();Lt[12]+=2*nt/(h.o.devicePixelRatio*pt.width),Lt[13]+=2*st/(h.o.devicePixelRatio*pt.height),h.aB(Et,Lt,Et);const Ft=et.getOrCreateProgram("debug",{defines:Mt}),Ot=o.getTileByID(g.key);et.terrain&&et.terrain.setupElevationDraw(Ot,Ft);const qt=fn.disabled,$t=Vn.disabled,Yt=et.colorModeForRenderPass(),tr="$debug";ut.activeTexture.set(yt.TEXTURE0),et.emptyTexture.bind(yt.LINEAR,yt.CLAMP_TO_EDGE),vt?Ot._makeGlobeTileDebugBuffers(et.context,pt):Ot._makeDebugTileBoundsBuffers(et.context,pt.projection);const sr=Ot._tileDebugBuffer||et.debugBuffer,pr=Ot._tileDebugIndexBuffer||et.debugIndexBuffer,hr=Ot._tileDebugSegments||et.debugSegments;if(Ft.draw(et,yt.LINE_STRIP,qt,$t,Yt,ts.disabled,pv(Et,_e.toPremultipliedRenderColor(null)),tr,sr,pr,hr,null,null,null,[Ot._globeTileDebugBorderBuffer]),lt){const Ir=Ot.latestRawTileData,Qr=Math.floor((Ir&&Ir.byteLength||0)/1024);let Nr=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(Nr+=` => ${g.overscaledZ}`),Nr+=` ${Ot.state}`,Nr+=` ${Qr}kb`,function(Yr,Cn){Yr.initDebugOverlayCanvas();const Br=Yr.debugOverlayCanvas,Tr=Yr.context.gl,en=Yr.debugOverlayCanvas.getContext("2d");en.clearRect(0,0,Br.width,Br.height),en.shadowColor="white",en.shadowBlur=2,en.lineWidth=1.5,en.strokeStyle="white",en.textBaseline="top",en.font="bold 36px Open Sans, sans-serif",en.fillText(Cn,5,5),en.strokeText(Cn,5,5),Yr.debugOverlayTexture.update(Br),Yr.debugOverlayTexture.bind(Tr.LINEAR,Tr.CLAMP_TO_EDGE)}(et,Nr)}const gr=o.getTile(g).tileSize,dr=512/Math.min(gr,512)*(g.overscaledZ/pt.zoom)*.5,ur=Ot._tileDebugTextBuffer||et.debugBuffer,yr=Ot._tileDebugTextIndexBuffer||et.quadTriangleIndexBuffer,Vr=Ot._tileDebugTextSegments||et.debugSegments;Ft.draw(et,yt.TRIANGLES,qt,$t,Pn.alphaBlended,ts.disabled,pv(Et,h.ao.transparent.toPremultipliedRenderColor(null),dr),tr,ur,yr,Vr,null,null,null,[Ot._globeTileDebugTextBuffer])}function vp(et,o,g,_e){Um(et,0,o+g/2,et.transform.width,g,_e)}function yo(et,o,g,_e){Um(et,o-g/2,0,g,et.transform.height,_e)}function Um(et,o,g,_e,nt,st){const lt=et.context,ut=lt.gl;ut.enable(ut.SCISSOR_TEST),ut.scissor(o*h.o.devicePixelRatio,g*h.o.devicePixelRatio,_e*h.o.devicePixelRatio,nt*h.o.devicePixelRatio),lt.clear({color:st}),ut.disable(ut.SCISSOR_TEST)}const Av=h.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Q0}=Av;function Fp(et,o,g,_e){et.emplaceBack(o,g,_e)}class Rv{constructor(o){this.vertexArray=new h.ej,this.indices=new h.b1,Fp(this.vertexArray,-1,-1,1),Fp(this.vertexArray,1,-1,1),Fp(this.vertexArray,-1,1,1),Fp(this.vertexArray,1,1,1),Fp(this.vertexArray,-1,-1,-1),Fp(this.vertexArray,1,-1,-1),Fp(this.vertexArray,-1,1,-1),Fp(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Q0),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=h.bg.simpleSegment(0,0,36,12)}}function Gm(et,o,g,_e,nt,st){const lt=et.context.gl,ut=o.paint.get("sky-atmosphere-color"),pt=o.paint.get("sky-atmosphere-halo-color"),yt=o.paint.get("sky-atmosphere-sun-intensity"),vt=((Mt,Et,Lt,Ft,Ot)=>({u_matrix_3f:Mt,u_sun_direction:Et,u_sun_intensity:Lt,u_color_tint_r:[Ft.r,Ft.g,Ft.b,Ft.a],u_color_tint_m:[Ot.r,Ot.g,Ot.b,Ot.a],u_luminance:5e-5}))(h.el(h.dL(),_e),nt,yt,ut.toPremultipliedRenderColor(null),pt.toPremultipliedRenderColor(null));lt.framebufferTexture2D(lt.FRAMEBUFFER,lt.COLOR_ATTACHMENT0,lt.TEXTURE_CUBE_MAP_POSITIVE_X+st,o.skyboxTexture,0),g.draw(et,lt.TRIANGLES,fn.disabled,Vn.disabled,Pn.unblended,ts.frontCW,vt,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const $m=h.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Hm{constructor(o){const g=new h.em;g.emplaceBack(-1,1,1,0,0),g.emplaceBack(1,1,1,1,0),g.emplaceBack(1,-1,1,1,1),g.emplaceBack(-1,-1,1,0,1);const _e=new h.b1;_e.emplaceBack(0,1,2),_e.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(g,$m.members),this.indexBuffer=o.createIndexBuffer(_e),this.segments=h.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const En=h.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Dn{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ry{constructor(o){this.colorModeAlphaBlendedWriteRGB=new Pn([1,gs,1,gs],h.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Pn([1,0,1,0],h.ao.transparent,[!1,!1,!1,!0]),this.params=new Dn,this.updateNeeded=!0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),o.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(o){const g=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Hm(g);const _e=this.params.sizeRange,nt=this.params.intensityRange,st=function(vt){const Mt=h.eo(30),Et=[];for(let Lt=0;Lt<vt;++Lt){const Ft=2*Math.PI*Mt(),Ot=Math.acos(1-2*Mt())-.5*Math.PI;Et.push(h.d4(Math.cos(Ot)*Math.cos(Ft),Math.cos(Ot)*Math.sin(Ft),Math.sin(Ot)))}return Et}(this.params.starsCount),lt=h.eo(300),ut=new h.en,pt=new h.b1;let yt=0;for(let vt=0;vt<st.length;++vt){const Mt=h.c4([],st[vt],200),Et=Math.max(0,1+.01*_e*(1*lt()-.5)),Lt=Math.max(0,1+.01*nt*(1*lt()-.5));ut.emplaceBack(Mt[0],Mt[1],Mt[2],-1,-1,Et,Lt),ut.emplaceBack(Mt[0],Mt[1],Mt[2],1,-1,Et,Lt),ut.emplaceBack(Mt[0],Mt[1],Mt[2],1,1,Et,Lt),ut.emplaceBack(Mt[0],Mt[1],Mt[2],-1,1,Et,Lt),pt.emplaceBack(yt+0,yt+1,yt+2),pt.emplaceBack(yt+0,yt+2,yt+3),yt+=4}this.starsVx=g.createVertexBuffer(ut,En.members),this.starsIdx=g.createIndexBuffer(pt),this.starsSegments=h.bg.simpleSegment(0,0,ut.length,pt.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,g){const _e=o.context,nt=_e.gl,st=o.transform,lt=new fn(nt.LEQUAL,fn.ReadOnly,[0,1]),ut=h.aj(st.zoom),pt=o.style.getLut(g.scope),yt=g.properties.get("color-use-theme")==="none",vt=g.properties.get("color").toNonPremultipliedRenderColor(yt?null:pt),Mt=g.properties.get("high-color-use-theme")==="none",Et=g.properties.get("high-color").toNonPremultipliedRenderColor(Mt?null:pt),Lt=g.properties.get("space-color-use-theme")==="none",Ft=g.properties.get("space-color").toNonPremultipliedRenderColor(Lt?null:pt),Ot=5e-4,qt=h.ep(g.properties.get("horizon-blend"),0,1,Ot,.25),$t=h.dA(o,_e,st)&&qt===Ot?st.worldSize/(2*Math.PI*1.025)-1:st.globeRadius,Yt=o.frameCounter/1e3%1,tr=h.ag(st.globeCenterInViewSpace),sr=Math.sqrt(Math.pow(tr,2)-Math.pow($t,2)),pr=Math.acos(sr/tr),hr=gr=>{const dr=st.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];gr&&dr.push("ALPHA_PASS");const ur=o.getOrCreateProgram("globeAtmosphere",{defines:dr}),yr=((Ir,Qr,Nr,Yr,Cn,Br,Tr,en,Hr,un,Tn,Ln)=>({u_frustum_tl:Ir,u_frustum_tr:Qr,u_frustum_br:Nr,u_frustum_bl:Yr,u_horizon:Cn,u_transition:Br,u_fadeout_range:Tr,u_atmosphere_fog_color:en.toArray01(),u_high_color:Hr.toArray01(),u_space_color:un.toArray01(),u_temporal_offset:Tn,u_horizon_angle:Ln}))(st.frustumCorners.TL,st.frustumCorners.TR,st.frustumCorners.BR,st.frustumCorners.BL,st.frustumCorners.horizon,ut,qt,vt,Et,Ft,Yt,pr);o.uploadCommonUniforms(_e,ur);const Vr=this.atmosphereBuffer;Vr&&ur.draw(o,nt.TRIANGLES,lt,Vn.disabled,gr?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ts.backCW,yr,gr?"atmosphere_glow_alpha":"atmosphere_glow",Vr.vertexBuffer,Vr.indexBuffer,Vr.segments)};hr(!1),hr(!0)}drawStars(o,g){const _e=h.aA(g.properties.get("star-intensity"),0,1);if(_e===0)return;const nt=o.context,st=nt.gl,lt=o.transform,ut=o.getOrCreateProgram("stars"),pt=h.c6([]);h.c8(pt,pt,-lt._pitch),h.c7(pt,pt,-lt.angle),h.c8(pt,pt,h.an(lt._center.lat)),h.eq(pt,pt,-h.an(lt._center.lng));const yt=h.cb(new Float32Array(16),pt),vt=h.aB([],lt.starsProjMatrix,yt),Mt=h.el([],yt),Et=h.er([],Mt),Lt=[0,1,0];h.dN(Lt,Lt,Et),h.c4(Lt,Lt,this.params.sizeMultiplier);const Ft=[1,0,0];h.dN(Ft,Ft,Et),h.c4(Ft,Ft,this.params.sizeMultiplier);const Ot=(qt=Lt,$t=Ft,Yt=_e,{u_matrix:Float32Array.from(vt),u_up:qt,u_right:$t,u_intensity_multiplier:Yt});var qt,$t,Yt;o.uploadCommonUniforms(nt,ut),this.starsVx&&this.starsIdx&&ut.draw(o,st.TRIANGLES,fn.disabled,Vn.disabled,this.colorModeAlphaBlendedWriteRGB,ts.disabled,Ot,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class $o{constructor(){this.visibleTiles=[]}updateBorders(o,g){const _e=[],nt=[],st=o._getRenderableCoordinates(!1,!0);for(const pt of st){const yt=o.getTile(pt);if(!yt.hasData())continue;const vt=yt.getBucket(g);vt&&(vt.isEmpty()||(_e.push(pt.key),nt.push({bucket:vt,tileID:pt.canonical})))}let lt=_e.length!==this.visibleTiles.length;if(!lt){_e.sort();for(let pt=0;pt<_e.length;pt++)if(_e[pt]!==this.visibleTiles[pt]){lt=!0;break}}if(!lt)return;const ut=new Set;this.visibleTiles=_e,nt.sort((pt,yt)=>pt.tileID.z-yt.tileID.z||pt.tileID.x-yt.tileID.x||pt.tileID.y-yt.tileID.y);for(const pt of nt){const yt=new Array,vt=new Array,Mt=pt.bucket;for(const Et of Mt.featuresOnBorder)ut.has(Et.featureId)?vt.push(Et.footprintIndex):(ut.add(Et.featureId),yt.push(Et.footprintIndex));Mt.updateFootprintHiddenFlags(yt,h.es,!1),Mt.updateFootprintHiddenFlags(vt,h.es,!0)}}}function jr(et,o){const g=[...et],_e=o.cameraWorldSizeForFog/o.worldSize,nt=h.bA([]);return h.cR(nt,nt,[_e,_e,1]),h.aB(g,nt,g),h.aB(g,o.worldToFogMatrix,g),g}function fx(et,o,g,_e,nt){const st=g.material,lt=_e.context,{baseColorTexture:ut,metallicRoughnessTexture:pt}=st.pbrMetallicRoughness,{normalTexture:yt,occlusionTexture:vt,emissionTexture:Mt}=st;function Et(Ft,Ot,qt){if(Ft&&(et.push(Ot),lt.activeTexture.set(lt.gl.TEXTURE0+qt),Ft.gfxTexture)){const{minFilter:$t,magFilter:Yt,wrapS:tr,wrapT:sr}=Ft.sampler;Ft.gfxTexture.bindExtraParam($t,Yt,tr,sr)}}Et(ut,"HAS_TEXTURE_u_baseColorTexture",ga.BaseColor),Et(pt,"HAS_TEXTURE_u_metallicRoughnessTexture",ga.MetallicRoughness),Et(yt,"HAS_TEXTURE_u_normalTexture",ga.Normal),Et(vt,"HAS_TEXTURE_u_occlusionTexture",ga.Occlusion),Et(Mt,"HAS_TEXTURE_u_emissionTexture",ga.Emission),nt&&(nt.texture||(nt.texture=new h.dY(_e.context,nt.image,[nt.image.height,nt.image.height,nt.image.height],lt.gl.RGBA8)),lt.activeTexture.set(lt.gl.TEXTURE0+ga.LUT),nt.texture&&nt.texture.bind(lt.gl.LINEAR,lt.gl.CLAMP_TO_EDGE),et.push("APPLY_LUT_ON_GPU")),g.texcoordBuffer&&(et.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(g.texcoordBuffer)),g.colorBuffer&&(et.push(g.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(g.colorBuffer)),g.normalBuffer&&(et.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(g.normalBuffer)),g.pbrBuffer&&(et.push("HAS_ATTRIBUTE_a_pbr"),et.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(g.pbrBuffer)),st.alphaMode!=="OPAQUE"&&st.alphaMode!=="MASK"||et.push("UNPREMULT_TEXTURE_IN_SHADER"),st.defined||et.push("DIFFUSE_SHADED");const Lt=_e.shadowRenderer;Lt&&(et.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Lt.useNormalOffset&&et.push("NORMAL_OFFSET"))}function Wm(et,o,g,_e,nt,st){const lt=g.paint.get("model-opacity").constantOr(1),ut=o.context,pt=new fn(o.context.gl.LEQUAL,fn.ReadWrite,o.depthRangeFor3D),yt=o.transform,vt=et.mesh,Mt=vt.material,Et=Mt.pbrMetallicRoughness,Lt=o.style.fog;let Ft;Ft=o.transform.projection.zAxisUnit==="pixels"?[...et.nodeModelMatrix]:h.aB([],_e.zScaleMatrix,et.nodeModelMatrix),h.aB(Ft,_e.negCameraPosMatrix,Ft);const Ot=h.bl([],Ft);h.ed(Ot,Ot);const qt=g.paint.get("model-color-use-theme").constantOr("default")==="none",$t=g.paint.get("model-emissive-strength").constantOr(0),Yt=rx(new Float32Array(et.worldViewProjection),new Float32Array(Ft),new Float32Array(Ot),null,o,lt,Et.baseColorFactor,Mt.emissiveFactor,Et.metallicFactor,Et.roughnessFactor,Mt,$t,g),tr={defines:[]},sr=[],pr=o.shadowRenderer;pr&&(pr.useNormalOffset=!1),fx(tr.defines,sr,vt,o,qt?null:g.lut);let hr=null;if(Lt){const ur=jr(et.nodeModelMatrix,o.transform);if(hr=new Float32Array(ur),yt.projection.name!=="globe"){const yr=vt.aabb.min,Vr=vt.aabb.max,[Ir,Qr]=Lt.getOpacityForBounds(ur,yr[0],yr[1],Vr[0],Vr[1]);tr.overrideFog=Ir>=Hn||Qr>=Hn}}const gr=Fu(o,g.paint.get("model-cutoff-fade-range"));gr.shouldRenderCutoff&&tr.defines.push("RENDER_CUTOFF");const dr=o.getOrCreateProgram("model",tr);o.uploadCommonUniforms(ut,dr,null,hr,gr),o.renderPass!=="shadow"&&pr&&pr.setupShadowsFromMatrix(et.nodeModelMatrix,dr),dr.draw(o,ut.gl.TRIANGLES,pt,nt,st,vt.material.doubleSided?ts.disabled:ts.backCCW,Yt,g.id,vt.vertexBuffer,vt.indexBuffer,vt.segments,g.paint,o.transform.zoom,void 0,sr)}function mx(et,o,g,_e,nt,st,lt){let ut;ut=et.projection.name==="globe"?h.eu(g,et):[...g],h.aB(ut,ut,o.matrix);const pt=h.aB([],_e,ut);if(o.meshes)for(const yt of o.meshes){if(yt.material.alphaMode!=="BLEND"){lt.push({mesh:yt,depth:0,modelIndex:nt,worldViewProjection:pt,nodeModelMatrix:ut});continue}const vt=h.af([],yt.centroid,pt);!et.isOrthographic&&vt[2]<=0||st.push({mesh:yt,depth:vt[2],modelIndex:nt,worldViewProjection:pt,nodeModelMatrix:ut})}if(o.children)for(const yt of o.children)mx(et,yt,g,_e,nt,st,lt)}function c_(et,o,g,_e){const nt=g.shadowRenderer;if(!nt)return;const st=nt.getShadowPassDepthMode(),lt=nt.getShadowPassColorMode(),ut=nt.calculateShadowPassMatrixFromMatrix(o),pt=Cy(ut);g.getOrCreateProgram("modelDepth",{defines:g._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(g,g.context.gl.TRIANGLES,st,Vn.disabled,lt,ts.backCCW,pt,_e.id,et.vertexBuffer,et.indexBuffer,et.segments,_e.paint,g.transform.zoom,void 0,void 0)}function J0(et,o,g){const _e=o.updateZoomBasedPaintProperties(),nt=function(st,lt,ut){let pt,yt,vt,Mt=st.terrain?st.terrain.exaggeration():0;if(st.terrain&&Mt>0){const Et=st.terrain,Lt=Et.findDEMTileFor(ut);Lt&&Lt.dem?pt=h.ew.create(Et,ut,Lt):Mt=0}if(Mt===0&&(lt.terrainElevationMin=0,lt.terrainElevationMax=0),Mt===lt.validForExaggeration&&(Mt===0||pt&&pt._demTile&&pt._demTile.tileID===lt.validForDEMTile.id&&pt._dem._timestamp===lt.validForDEMTile.timestamp))return!1;for(const Et in lt.instancesPerModel){const Lt=lt.instancesPerModel[Et];for(let Ft=0;Ft<Lt.instancedDataArray.length;++Ft){const Ot=(pt?Mt*pt.getElevationAt(0|Lt.instancedDataArray.float32[16*Ft],0|Lt.instancedDataArray.float32[16*Ft+1],!0,!0):0)+Lt.instancesEvaluatedElevation[Ft];Lt.instancedDataArray.float32[16*Ft+6]=Ot,yt=yt?Math.min(lt.terrainElevationMin,Ot):Ot,vt=vt?Math.max(lt.terrainElevationMax,Ot):Ot}}return lt.terrainElevationMin=yt||0,lt.terrainElevationMax=vt||0,lt.validForExaggeration=Mt,lt.validForDEMTile=pt&&pt._demTile?{id:pt._demTile.tileID,timestamp:pt._dem._timestamp}:{id:void 0,timestamp:0},!0}(et,o,g);(_e||nt)&&(o.uploaded=!1,o.upload(et.context))}const op={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new h.d8([0,0,0],[h.al,h.al,0])};function Py(et,o){const g=1<<et.canonical.z,_e=o.getFreeCameraOptions().position,nt=o.elevation,st=et.canonical.x/g,lt=(et.canonical.x+1)/g,ut=et.canonical.y/g,pt=(et.canonical.y+1)/g;let yt=o._centerAltitude;if(nt){const Lt=nt.getMinMaxForTile(et);Lt&&Lt.max>yt&&(yt=Lt.max)}const vt=h.aA(_e.x,st,lt)-_e.x,Mt=h.aA(_e.y,ut,pt)-_e.y,Et=h.ce(yt,o.center.lat)-_e.z;return o._zoomFromMercatorZ(Math.sqrt(vt*vt+Mt*Mt+Et*Et))}function e1(et,o,g,_e,nt,st,lt){const ut=et.context,pt=et.renderPass==="shadow",yt=et.shadowRenderer,vt=pt&&yt?yt.getShadowPassDepthMode():new fn(ut.gl.LEQUAL,fn.ReadWrite,et.depthRangeFor3D),Mt=et.isTileAffectedByFog(st);if(g.meshes)for(const Et of g.meshes){const Lt=["MODEL_POSITION_ON_GPU"],Ft=[];let Ot,qt,$t;_e.instancedDataArray.length>20&&Lt.push("INSTANCED_ARRAYS");const Yt=Fu(et,o.paint.get("model-cutoff-fade-range"));if(Yt.shouldRenderCutoff&&Lt.push("RENDER_CUTOFF"),pt&&yt)Ot=et.getOrCreateProgram("modelDepth",{defines:Lt}),qt=Cy(lt.shadowTileMatrix,lt.shadowTileMatrix,Float32Array.from(g.matrix)),$t=yt.getShadowPassColorMode();else{fx(Lt,Ft,Et,et,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),Ot=et.getOrCreateProgram("model",{defines:Lt,overrideFog:Mt});const sr=Et.material,pr=sr.pbrMetallicRoughness,hr=o.paint.get("model-opacity").constantOr(1),gr=o.paint.get("model-emissive-strength").constantOr(0);qt=rx(st.expandedProjMatrix,Float32Array.from(g.matrix),new Float32Array(16),null,et,hr,pr.baseColorFactor,sr.emissiveFactor,pr.metallicFactor,pr.roughnessFactor,sr,gr,o,nt),yt&&(lt.shadowUniformsInitialized?Ot.setShadowUniformValues(ut,yt.getShadowUniformValues()):(yt.setupShadows(st.toUnwrapped(),Ot,"model-tile"),lt.shadowUniformsInitialized=!0)),$t=Yt.shouldRenderCutoff||hr<1||sr.alphaMode!=="OPAQUE"?Pn.alphaBlended:Pn.unblended}et.uploadCommonUniforms(ut,Ot,st.toUnwrapped(),null,Yt);const tr=Et.material.doubleSided?ts.disabled:ts.backCCW;if(_e.instancedDataArray.length>20)Ft.push(_e.instancedDataBuffer),Ot.draw(et,ut.gl.TRIANGLES,vt,Vn.disabled,$t,tr,qt,o.id,Et.vertexBuffer,Et.indexBuffer,Et.segments,o.paint,et.transform.zoom,void 0,Ft,_e.instancedDataArray.length);else{const sr=pt?"u_instance":"u_normal_matrix";for(let pr=0;pr<_e.instancedDataArray.length;++pr)qt[sr]=new Float32Array(_e.instancedDataArray.arrayBuffer,64*pr,16),Ot.draw(et,ut.gl.TRIANGLES,vt,Vn.disabled,$t,tr,qt,o.id,Et.vertexBuffer,Et.indexBuffer,Et.segments,o.paint,et.transform.zoom,void 0,Ft)}}if(g.children)for(const Et of g.children)e1(et,o,Et,_e,nt,st,lt)}const Bw=[1,-1,1];function t1(et,o,g,_e){if(!g.modelManager)return!0;const nt=g.modelManager;if(!g.shadowRenderer)return!0;const st=g.shadowRenderer,lt=o.aabb;let ut=!0,pt=et.maxHeight;if(pt===0){let vt=0;for(const Mt in et.instancesPerModel){const Et=nt.getModel(Mt,_e);Et?vt=Math.max(vt,Math.max(Math.max(Et.aabb.max[0],Et.aabb.max[1]),Et.aabb.max[2])):ut=!1}pt=et.maxScale*vt*1.41+et.maxVerticalOffset,ut&&(et.maxHeight=pt)}lt.max[2]=pt,lt.min[2]+=et.terrainElevationMin,lt.max[2]+=et.terrainElevationMax,h.af(lt.min,lt.min,o.tileMatrix),h.af(lt.max,lt.max,o.tileMatrix);const yt=lt.intersects(st.getCurrentCascadeFrustum());return g.currentShadowCascade===0&&(et.isInsideFirstShadowMapFrustum=yt===2),yt===0}function gx(et,o){const g=et.uniformValues.u_cutoff_params[0],_e=et.uniformValues.u_cutoff_params[1],nt=et.uniformValues.u_cutoff_params[2],st=et.uniformValues.u_cutoff_params[3];return _e===g||st===nt?1:h.aA(((o-g)/(_e-g)-nt)/(st-nt),0,1)}function Pv(et,o,g,_e){if(o.pitch<20)return 1;const nt=o.getWorldToCameraMatrix();h.aB(nt,nt,et);const st=h.bU(g.min[0],g.min[1],g.min[2],1);let lt=h.aC(h.ex(),st,nt),ut=lt,pt=lt;st[1]=g.max[1],lt=h.aC(h.ex(),st,nt),ut=lt[1]<ut[1]?lt:ut,pt=lt[1]>pt[1]?lt:pt,st[0]=g.max[0],lt=h.aC(h.ex(),st,nt),ut=lt[1]<ut[1]?lt:ut,pt=lt[1]>pt[1]?lt:pt,st[1]=g.min[1],lt=h.aC(h.ex(),st,nt),ut=lt[1]<ut[1]?lt:ut,pt=lt[1]>pt[1]?lt:pt;const yt=h.aA(_e[0],0,1),vt=100*o.pixelsPerMeter*h.aA(_e[1],0,1),Mt=h.aA(_e[2],0,1),Et=h.ey(h.ex(),ut,pt,yt),Lt=Math.tan(.5*o.fovX),Ft=-Et[2]*Lt;if(vt===0)return Et[1]<-Math.abs(Ft)?Mt:1;const Ot=(-Math.abs(Ft)-Et[1])/vt,qt=(Yt,tr,sr)=>(1-sr)*Yt+sr*tr,$t=h.aA(qt(1,Mt,Ot),Mt,1);return qt(1,$t,h.aA((o.pitch-20)/20,0,1))}class i1{}class r1{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,g,_e){{const Mt=this._storage.get(g.id);if(Mt)return Mt.lastUsedFrameIdx=o,Mt.buf}const nt=_e.gl,st=nt.getBufferParameter(nt.ELEMENT_ARRAY_BUFFER,nt.BUFFER_SIZE),lt=new ArrayBuffer(st),ut=new Int16Array(lt);nt.getBufferSubData(nt.ELEMENT_ARRAY_BUFFER,0,new Int16Array(lt));const pt=new h.eA;for(let Mt=0;Mt<st/2;Mt+=3){const Et=ut[Mt],Lt=ut[Mt+1],Ft=ut[Mt+2];pt.emplaceBack(Et,Lt),pt.emplaceBack(Lt,Ft),pt.emplaceBack(Ft,Et)}const yt=_e.bindVertexArrayOES.current,vt=new i1;return vt.buf=new um(_e,pt),vt.lastUsedFrameIdx=o,this._storage.set(g.id,vt),_e.bindVertexArrayOES.set(yt),vt.buf}update(o){for(const[g,_e]of this._storage)o-_e.lastUsedFrameIdx>30&&(_e.buf.destroy(),this._storage.delete(g))}destroy(){for(const[o,g]of this._storage)g.buf.destroy(),this._storage.delete(o)}}class yx{constructor(o){this.occluderSize=30,this.depthOffset=-1e-4,o.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),o.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const u_=h.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Iy{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Iv{constructor(o,g){this.revealStart=11,this.revealRange=2,o.registerParameter(this,[...g,"Reveal"],"revealStart",{min:0,max:17,step:.05}),o.registerParameter(this,[...g,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const n1=h.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class Vw{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,g){const _e=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const lt=new h.eB,ut=new h.b1;lt.emplaceBack(-1,-1),lt.emplaceBack(1,-1),lt.emplaceBack(1,1),lt.emplaceBack(-1,1),ut.emplaceBack(0,1,2),ut.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(lt,n1.members),this.vignetteIdx=o.context.createIndexBuffer(ut)}const nt=h.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,_e);const lt={u_vignetteShape:(st={vignetteShape:[g.start,g.range,Math.pow(10,g.fadePower)],vignetteColor:[g.color.r,g.color.g,g.color.b,g.color.a*g.strength]}).vignetteShape,u_vignetteColor:st.vignetteColor};_e.draw(o,o.context.gl.TRIANGLES,fn.disabled,Vn.disabled,Pn.alphaBlended,ts.disabled,lt,"vignette",this.vignetteVx,this.vignetteIdx,nt)}var st}}class s1{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,g){const _e=o.getFreeCameraOptions().position,nt=_e.toAltitude(),st=_e.toLngLat(),lt=h.an(st.lng),ut=h.an(st.lat),pt=o.pixelsPerMeter/g,yt=lt*h.eD,vt=h.eD*Math.log(Math.tan(Math.PI/4+ut/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Mt=-this._offsetYPrev+vt,Et=-this._elevationPrev+nt;this._accumulatedOffsetX+=(-this._offsetXPrev+yt)*pt,this._accumulatedOffsetY+=Mt*pt,this._accumulatedElevation+=Et*pt,this._offsetXPrev=yt,this._offsetYPrev=vt,this._elevationPrev=nt}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function o1(et,o){return[-(et[0]-Math.floor(et[0]/o)*o),-(et[1]-Math.floor(et[1]/o)*o),-(et[2]-Math.floor(et[2]/o)*o)]}function lu(et){const o=h.eo(1323123451230),g=[];for(let _e=0;_e<et;++_e){const nt=2*o()-1,st=2*o()-1,lt=2*o()-1;g.push(h.d4(nt,st,lt))}return g}function mm(et,o,g,_e,nt){const st=h.aA((nt-g)/(_e-g),0,1);return(1-st)*et+st*o}class My{constructor(o){this._movement=new s1,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Vw,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,g){const _e=o.transform;this._movement.update(_e,this._ppmScaleFactor);const nt=_e.starsProjMatrix,st=h.c6([]);h.c8(st,st,h.an(90)-_e._pitch),h.c7(st,st,-_e.angle);const lt=h.cb(new Float32Array(16),st),ut=h.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),pt=h.ed([],ut),yt=h.aB([],pt,lt),vt=Date.now()/1e3;return this._accumulatedTimeFromStart+=(vt-this._prevTime)*g,this._prevTime=vt,{projectionMatrix:nt,modelviewMatrix:yt}}}class Co extends My{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Iv(o.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){const g=o.context;if(!this.particlesVx){const _e=lu(this.particlesCount),nt=new h.eE,st=new h.b1;let lt=0;const ut=h.eo(1323123451230);for(let pt=0;pt<_e.length;++pt){const yt=_e[pt],vt=[2*ut()-1,ut(),ut(),ut()];nt.emplaceBack(yt[0],yt[1],yt[2],-1,-1,...vt),nt.emplaceBack(yt[0],yt[1],yt[2],1,-1,...vt),nt.emplaceBack(yt[0],yt[1],yt[2],1,1,...vt),nt.emplaceBack(yt[0],yt[1],yt[2],-1,1,...vt),st.emplaceBack(lt+0,lt+1,lt+2),st.emplaceBack(lt+0,lt+2,lt+3),lt+=4}this.particlesVx=g.createVertexBuffer(nt,u_.members),this.particlesIdx=g.createIndexBuffer(st)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;const g=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_e=o.transform.zoom;if(g.revealStart>_e)return;const nt=mm(0,1,g.revealStart,g.revealStart+g.revealRange,_e);if(!this.particlesVx||!this.particlesIdx)return;const st=structuredClone(this._params);let lt=[-st.direction.x,st.direction.y,-100];h.aw(lt,lt);const ut=structuredClone(this._vignetteParams);ut.strength*=nt,st.overrideStyleParameters||(st.intensity=o.style.rain.state.density,st.timeFactor=o.style.rain.state.intensity,st.color=structuredClone(o.style.rain.state.color),lt=structuredClone(o.style.rain.state.direction),st.screenThinning.intensity=o.style.rain.state.centerThinning,st.dropletSizeX=o.style.rain.state.dropletSize[0],st.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],st.distortionStrength=100*o.style.rain.state.distortionStrength,ut.strength=1,ut.color=structuredClone(o.style.rain.state.vignetteColor));const pt=this.updateOnRender(o,st.timeFactor),yt=o.context,vt=yt.gl,Mt=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new h.T(yt,{width:o.width,height:o.height,data:null},vt.RGBA8)),st.distortionStrength>0&&(yt.activeTexture.set(vt.TEXTURE0),this.screenTexture.bind(vt.LINEAR,vt.CLAMP_TO_EDGE),vt.copyTexSubImage2D(vt.TEXTURE_2D,0,0,0,0,0,o.width,o.height));const Et=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(yt,Et),yt.activeTexture.set(vt.TEXTURE0),this.screenTexture.bind(vt.LINEAR,vt.CLAMP_TO_EDGE);const Lt=[st.color.r,st.color.g,st.color.b,st.color.a],Ft=(Ot,qt)=>{const $t=o1(this._movement.getPosition(),Ot),Yt=st.dropletSizeX,tr=st.dropletSizeX*st.dropletSizeYScale,sr=o.width/2,pr=o.height/2,hr=mm(0,st.screenThinning.start,0,1,st.screenThinning.intensity),gr=mm(.001,st.screenThinning.range,0,1,st.screenThinning.intensity),dr=mm(0,st.screenThinning.particleOffset,0,1,st.screenThinning.intensity),ur=(yr={modelview:pt.modelviewMatrix,projection:pt.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:$t,velocityConeAperture:st.velocityConeAperture,velocity:st.velocity,boxSize:Ot,rainDropletSize:[Yt,tr],distortionStrength:st.distortionStrength,rainDirection:lt,color:Lt,screenSize:[Mt.width,Mt.height],thinningCenterPos:[sr,pr],thinningShape:[hr,gr,Math.pow(10,st.screenThinning.fadePower)],thinningAffectedRatio:st.screenThinning.affectedRatio,thinningParticleOffset:dr,shapeDirectionalPower:st.shapeDirPower,shapeNormalPower:st.shapeNormalPower,mode:qt?0:1},{u_modelview:Float32Array.from(yr.modelview),u_projection:Float32Array.from(yr.projection),u_time:yr.time,u_cam_pos:yr.camPos,u_texScreen:0,u_velocityConeAperture:yr.velocityConeAperture,u_velocity:yr.velocity,u_boxSize:yr.boxSize,u_rainDropletSize:yr.rainDropletSize,u_distortionStrength:yr.distortionStrength,u_rainDirection:yr.rainDirection,u_color:yr.color,u_screenSize:yr.screenSize,u_thinningCenterPos:yr.thinningCenterPos,u_thinningShape:yr.thinningShape,u_thinningAffectedRatio:yr.thinningAffectedRatio,u_thinningParticleOffset:yr.thinningParticleOffset,u_shapeDirectionalPower:yr.shapeDirectionalPower,u_shapeNormalPower:yr.shapeNormalPower,u_mode:yr.mode});var yr;const Vr=Math.round(st.intensity*this.particlesCount),Ir=h.bg.simpleSegment(0,0,4*Vr,2*Vr);Et.draw(o,vt.TRIANGLES,fn.disabled,Vn.disabled,Pn.alphaBlended,ts.disabled,ur,"rain_particles",this.particlesVx,this.particlesIdx,Ir)};st.distortionStrength>0&&Ft(st.boxSize,!0),Ft(st.boxSize,!1),this._vignette.draw(o,ut)}}const zs=h.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class a1 extends My{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Iv(o.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){const g=o.context;if(!this.particlesVx){const _e=lu(this.particlesCount),nt=new h.eF,st=new h.b1;let lt=0;const ut=h.eo(1323123451230);for(let pt=0;pt<_e.length;++pt){const yt=_e[pt],vt=ut(),Mt=ut(),Et=ut(),Lt=[pt/_e.length,vt,Mt,Et],Ft=[ut(),ut()];nt.emplaceBack(yt[0],yt[1],yt[2],-1,-1,...Lt,...Ft),nt.emplaceBack(yt[0],yt[1],yt[2],1,-1,...Lt,...Ft),nt.emplaceBack(yt[0],yt[1],yt[2],1,1,...Lt,...Ft),nt.emplaceBack(yt[0],yt[1],yt[2],-1,1,...Lt,...Ft),st.emplaceBack(lt+0,lt+1,lt+2),st.emplaceBack(lt+0,lt+2,lt+3),lt+=4}this.particlesVx=g.createVertexBuffer(nt,zs.members),this.particlesIdx=g.createIndexBuffer(st)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;const g=structuredClone(this._params);let _e=[-g.direction.x,g.direction.y,-100];h.aw(_e,_e);const nt=structuredClone(this._vignetteParams),st=g.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},lt=o.transform.zoom;if(st.revealStart>lt)return;const ut=mm(0,1,st.revealStart,st.revealStart+st.revealRange,lt);nt.strength*=ut,g.overrideStyleParameters||(g.intensity=o.style.snow.state.density,g.timeFactor=o.style.snow.state.intensity,g.color=structuredClone(o.style.snow.state.color),_e=structuredClone(o.style.snow.state.direction),g.screenThinning.intensity=o.style.snow.state.centerThinning,g.billboardSize=2.79*o.style.snow.state.flakeSize,nt.strength=1,nt.color=structuredClone(o.style.snow.state.vignetteColor));const pt=this.updateOnRender(o,g.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const yt=o.context,vt=yt.gl,Mt=o.transform,Et=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(yt,Et),((Lt,Ft,Ot)=>{const qt=o1(this._movement.getPosition(),Lt),$t=Mt.width/2,Yt=Mt.height/2,tr=mm(0,Ot.screenThinning.start,0,1,Ot.screenThinning.intensity),sr=mm(.001,Ot.screenThinning.range,0,1,Ot.screenThinning.intensity),pr=mm(0,Ot.screenThinning.particleOffset,0,1,Ot.screenThinning.intensity),hr=(gr={modelview:pt.modelviewMatrix,projection:pt.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:qt,velocityConeAperture:Ot.velocityConeAperture,velocity:Ot.velocity,horizontalOscillationRadius:Ot.horizontalOscillationRadius,horizontalOscillationRate:Ot.horizontalOscillationRate,boxSize:Lt,billboardSize:1*Ot.billboardSize,simpleShapeParameters:[Ot.shapeFadeStart,Ot.shapeFadePower],screenSize:[Mt.width,Mt.height],thinningCenterPos:[$t,Yt],thinningShape:[tr,sr,Math.pow(10,Ot.screenThinning.fadePower)],thinningAffectedRatio:Ot.screenThinning.affectedRatio,thinningParticleOffset:pr,color:[Ot.color.r,Ot.color.g,Ot.color.b,Ot.color.a],direction:_e},{u_modelview:Float32Array.from(gr.modelview),u_projection:Float32Array.from(gr.projection),u_time:gr.time,u_cam_pos:gr.camPos,u_velocityConeAperture:gr.velocityConeAperture,u_velocity:gr.velocity,u_horizontalOscillationRadius:gr.horizontalOscillationRadius,u_horizontalOscillationRate:gr.horizontalOscillationRate,u_boxSize:gr.boxSize,u_billboardSize:gr.billboardSize,u_simpleShapeParameters:gr.simpleShapeParameters,u_screenSize:gr.screenSize,u_thinningCenterPos:gr.thinningCenterPos,u_thinningShape:gr.thinningShape,u_thinningAffectedRatio:gr.thinningAffectedRatio,u_thinningParticleOffset:gr.thinningParticleOffset,u_particleColor:gr.color,u_direction:gr.direction});var gr;const dr=Math.round(Ot.intensity*this.particlesCount),ur=h.bg.simpleSegment(0,0,4*dr,2*dr);this.particlesVx&&this.particlesIdx&&Et.draw(o,vt.TRIANGLES,fn.disabled,Vn.disabled,Pn.alphaBlended,ts.disabled,hr,"snow_particles",this.particlesVx,this.particlesIdx,ur)})(g.boxSize,0,g),this._vignette.draw(o,nt)}}const gm={symbol:function(et,o,g,_e,nt){if(et.renderPass!=="translucent")return;const st=Vn.disabled,lt=et.colorModeForRenderPass(),ut=g.layout.get("text-variable-anchor"),pt=g.layout.get("text-size-scale-range"),yt=h.aA(et.scaleFactor,pt[0],pt[1]);ut&&function(Et,Lt,Ft,Ot,qt,$t,Yt,tr){const sr=Lt.transform,pr=qt==="map",hr=$t==="map";for(const gr of Et){const dr=Ot.getTile(gr),ur=dr.getBucket(Ft);if(!ur||!ur.text||!ur.text.segments.get().length)continue;const yr=h.bK(ur.textSizeData,sr.zoom,tr),Vr=Su(gr,ur.getProjection(),sr),Ir=sr.calculatePixelsToTileUnitsMatrix(dr),Qr=au(Vr,dr.tileID.canonical,hr,pr,sr,ur.getProjection(),Ir),Nr=ur.hasIconTextFit()&&ur.hasIconData();yr&&ox(ur,pr,hr,Yt,sr,Qr,gr,Math.pow(2,sr.zoom-dr.tileID.overscaledZ),yr,Nr)}}(_e,et,g,o,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),nt,yt);const vt=g.paint.get("icon-opacity").constantOr(1)!==0,Mt=g.paint.get("text-opacity").constantOr(1)!==0;g.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(vt||Mt)?l_(et,o,g,_e,st,lt):(vt&&l_(et,o,g,_e,st,lt,{onlyIcons:!0}),Mt&&l_(et,o,g,_e,st,lt,{onlyText:!0})),o.map.showCollisionBoxes&&(a_(et,o,g,_e,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),!0),a_(et,o,g,_e,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),!1))},circle:function(et,o,g,_e){if(et.renderPass!=="translucent")return;const nt=g.paint.get("circle-opacity"),st=g.paint.get("circle-stroke-width"),lt=g.paint.get("circle-stroke-opacity"),ut=g.layout.get("circle-sort-key").constantOr(1)!==void 0,pt=g.paint.get("circle-emissive-strength");if(nt.constantOr(1)===0&&(st.constantOr(1)===0||lt.constantOr(1)===0))return;const yt=et.context,vt=yt.gl,Mt=et.transform,Et=!(!et.terrain||!et.terrain.enabled),Lt=g.layout.get("circle-elevation-reference"),Ft=et.depthModeForSublayer(0,fn.ReadOnly),Ot=new fn(et.context.gl.LEQUAL,fn.ReadOnly,et.depthRangeFor3D),qt=Lt==="none"||Et?Ft:Ot,$t=Vn.disabled,Yt=et.colorModeForDrapableLayerRenderPass(pt),tr=Mt.projection.name==="globe",sr=[h.aF(Mt.center.lng),h.aJ(Mt.center.lat)],pr=[];for(let gr=0;gr<_e.length;gr++){const dr=_e[gr],ur=o.getTile(dr),yr=ur.getBucket(g);if(!yr||yr.projection.name!==Mt.projection.name)continue;const Vr=yr.programConfigurations.get(g.id),Ir=yr.layoutVertexBuffer,Qr=yr.globeExtVertexBuffer,Nr=yr.indexBuffer,Yr=h.dZ(g),Cn=[Qr],Br=et.isTileAffectedByFog(dr);tr&&Yr.push("PROJECTION_GLOBE_VIEW"),Yr.push("DEPTH_D24"),et.terrain&&Mt.depthOcclusionForSymbolsAndCircles&&Yr.push("DEPTH_OCCLUSION"),yr.hasElevation&&!et.terrain&&(Yr.push("ELEVATED_ROADS"),Cn.push(yr.elevatedLayoutVertexBuffer));const Tr=et.getOrCreateProgram("circle",{config:Vr,defines:Yr,overrideFog:Br}),en=Mt.projection.createInversionMatrix(Mt,dr.canonical),Hr={programConfiguration:Vr,program:Tr,layoutVertexBuffer:Ir,dynamicBuffers:Cn,indexBuffer:Nr,uniformValues:h.d_(et,dr,ur,en,sr,g),tile:ur};if(ut){const un=yr.segments.get();for(const Tn of un)pr.push({segments:new h.bg([Tn]),sortKey:Tn.sortKey,state:Hr})}else pr.push({segments:yr.segments,sortKey:0,state:Hr})}ut&&pr.sort((gr,dr)=>gr.sortKey-dr.sortKey);const hr={useDepthForOcclusion:Mt.depthOcclusionForSymbolsAndCircles};for(const gr of pr){const{programConfiguration:dr,program:ur,layoutVertexBuffer:yr,dynamicBuffers:Vr,indexBuffer:Ir,uniformValues:Qr,tile:Nr}=gr.state,Yr=gr.segments;et.terrain&&et.terrain.setupElevationDraw(Nr,ur,hr),et.uploadCommonUniforms(yt,ur,Nr.tileID.toUnwrapped()),ur.draw(et,vt.TRIANGLES,qt,$t,Yt,ts.disabled,Qr,g.id,yr,Ir,Yr,g.paint,Mt.zoom,dr,Vr)}},heatmap:function(et,o,g,_e){if(g.paint.get("heatmap-opacity")!==0)if(et.renderPass==="offscreen"){const nt=et.context,st=nt.gl,lt=Vn.disabled,ut=new Pn([st.ONE,st.ONE,st.ONE,st.ONE],h.ao.transparent,[!0,!0,!0,!0]);(function(Lt,Ft,Ot,qt){const $t=Lt.gl,Yt=Ft.width*qt,tr=Ft.height*qt;Lt.activeTexture.set($t.TEXTURE1),Lt.viewport.set([0,0,Yt,tr]);let sr=Ot.heatmapFbo;if(!sr||sr&&(sr.width!==Yt||sr.height!==tr)){sr&&sr.destroy();const pr=$t.createTexture();$t.bindTexture($t.TEXTURE_2D,pr),$t.texParameteri($t.TEXTURE_2D,$t.TEXTURE_WRAP_S,$t.CLAMP_TO_EDGE),$t.texParameteri($t.TEXTURE_2D,$t.TEXTURE_WRAP_T,$t.CLAMP_TO_EDGE),$t.texParameteri($t.TEXTURE_2D,$t.TEXTURE_MIN_FILTER,$t.LINEAR),$t.texParameteri($t.TEXTURE_2D,$t.TEXTURE_MAG_FILTER,$t.LINEAR),sr=Ot.heatmapFbo=Lt.createFramebuffer(Yt,tr,!0,null),function(hr,gr,dr,ur,yr,Vr){const Ir=hr.gl;Ir.texImage2D(Ir.TEXTURE_2D,0,hr.extRenderToTextureHalfFloat?Ir.RGBA16F:Ir.RGBA,yr,Vr,0,Ir.RGBA,hr.extRenderToTextureHalfFloat?Ir.HALF_FLOAT:Ir.UNSIGNED_BYTE,null),ur.colorAttachment.set(dr)}(Lt,0,pr,sr,Yt,tr)}else $t.bindTexture($t.TEXTURE_2D,sr.colorAttachment.get()),Lt.bindFramebuffer.set(sr.framebuffer)})(nt,et,g,et.transform.projection.name==="globe"?.5:.25),nt.clear({color:h.ao.transparent});const pt=et.transform,yt=pt.projection.name==="globe",vt=yt?["PROJECTION_GLOBE_VIEW"]:[],Mt=yt?ts.frontCCW:ts.disabled,Et=[h.aF(pt.center.lng),h.aJ(pt.center.lat)];for(let Lt=0;Lt<_e.length;Lt++){const Ft=_e[Lt];if(o.hasRenderableParent(Ft))continue;const Ot=o.getTile(Ft),qt=Ot.getBucket(g);if(!qt||qt.projection.name!==pt.projection.name)continue;const $t=et.isTileAffectedByFog(Ft),Yt=qt.programConfigurations.get(g.id),tr=et.getOrCreateProgram("heatmap",{config:Yt,defines:vt,overrideFog:$t}),{zoom:sr}=et.transform;et.terrain&&et.terrain.setupElevationDraw(Ot,tr),et.uploadCommonUniforms(nt,tr,Ft.toUnwrapped());const pr=pt.projection.createInversionMatrix(pt,Ft.canonical);tr.draw(et,st.TRIANGLES,fn.disabled,lt,ut,Mt,W0(et,Ft,Ot,pr,Et,sr,g.paint.get("heatmap-intensity")),g.id,qt.layoutVertexBuffer,qt.indexBuffer,qt.segments,g.paint,et.transform.zoom,Yt,yt?[qt.globeExtVertexBuffer]:null)}nt.viewport.set([0,0,et.width,et.height])}else et.renderPass==="translucent"&&(et.context.setColorMode(et.colorModeForRenderPass()),function(nt,st){const lt=nt.context,ut=lt.gl,pt=st.heatmapFbo;if(!pt)return;lt.activeTexture.set(ut.TEXTURE0),ut.bindTexture(ut.TEXTURE_2D,pt.colorAttachment.get()),lt.activeTexture.set(ut.TEXTURE1);let yt=st.colorRampTexture;yt||(yt=st.colorRampTexture=new h.T(lt,st.colorRamp,ut.RGBA8)),yt.bind(ut.LINEAR,ut.CLAMP_TO_EDGE),nt.getOrCreateProgram("heatmapTexture").draw(nt,ut.TRIANGLES,fn.disabled,Vn.disabled,nt.colorModeForRenderPass(),ts.disabled,((vt,Mt,Et,Lt)=>({u_image:0,u_color_ramp:1,u_opacity:Mt.paint.get("heatmap-opacity")}))(0,st),st.id,nt.viewportBuffer,nt.quadTriangleIndexBuffer,nt.viewportSegments,st.paint,nt.transform.zoom)}(et,g))},line:function(et,o,g,_e){if(et.renderPass!=="translucent")return;const nt=g.paint.get("line-opacity"),st=g.paint.get("line-width");if(nt.constantOr(1)===0||st.constantOr(1)===0)return;const lt=g.paint.get("line-emissive-strength"),ut=g.paint.get("line-occlusion-opacity"),pt=g.layout.get("line-elevation-reference"),yt=g.layout.get("line-width-unit")==="meters",vt=pt==="sea",Mt=!(!et.terrain||!et.terrain.enabled),Et=et.context,Lt=Et.gl;if(g.hasElevatedBuckets&&et.transform.projection.name==="globe")return;const Ft=g.layout.get("line-cross-slope"),Ot=Ft!==void 0,qt=Ft<1,$t=et.colorModeForDrapableLayerRenderPass(lt),Yt=et.terrain&&et.terrain.renderingToTexture,tr=Yt?1:h.o.devicePixelRatio,sr=g.paint.get("line-dasharray"),pr=sr.constantOr(1),hr=g.layout.get("line-cap"),gr=sr.constantOr(null),dr=hr.constantOr(null),ur=g.paint.get("line-pattern"),yr=ur.constantOr(1),Vr=g.paint.get("line-pattern-cross-fade"),Ir=ur.constantOr(null),Qr=g.paint.get("line-opacity").constantOr(1);let Nr=!yr&&Qr!==1||et.depthOcclusion&&ut>0&&ut<1;const Yr=g.paint.get("line-gradient"),Cn=yr?"linePattern":"line",Br=h.d$(g);let Tr;if(Yt&&et.terrain&&et.terrain.clipOrMaskOverlapStencilType()&&(Nr=!1),ut!==0&&et.depthOcclusion){const Tn=g.paint._values["line-opacity"];Tn&&Tn.value&&Tn.value.kind==="constant"?Tr=Tn.value:h.w(`Occlusion opacity for layer ${g.id} is supported only when line-opacity isn't data-driven.`)}st.value.kind!=="constant"&&st.value.isLineProgressConstant===!1&&Br.push("VARIABLE_LINE_WIDTH");const en=(Tn,Ln,xn,mn,Xn,Gn)=>{for(const Wn of Tn){const Un=o.getTile(Wn);if(yr&&!Un.patternsLoaded())continue;const hs=Un.getBucket(g);if(!hs||hs.elevationType!=="none"&&!Xn||hs.elevationType==="none"&&Xn)continue;et.prepareDrawTile();const vs=[...Ln],Ts=et.shadowRenderer,no=hs.elevationType==="road"&&!!Ts&&Ts.enabled;let fs=[0,0,0];if(no){const Ss=et.style.directionalLight,cs=et.style.ambientLight;Ss&&cs&&(fs=sp(et.style,Ss,cs)),vs.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const qs=hs.programConfigurations.get(g.id);let io=!1;if(Ir&&Un.imageAtlas){const Ss=h.e0.from(Ir),cs=Ss.getPrimary().scaleSelf(tr).toString(),so=Un.imageAtlas.patternPositions.get(cs),Ho=Ss.getSecondary(),Fo=Ho?Un.imageAtlas.patternPositions.get(Ho.scaleSelf(tr).toString()):null;io=!!so&&!!Fo,so&&qs.setConstantPatternPositions(so,Fo)}Vr>0&&(io||qs.getPatternTransitionVertexBuffer("line-pattern"))&&vs.push("LINE_PATTERN_TRANSITION");const Ao=et.isTileAffectedByFog(Wn),bs=et.getOrCreateProgram(Cn,{config:qs,defines:vs,overrideFog:Ao});if(!yr&&gr&&dr&&Un.lineAtlas){const Ss=Un.lineAtlas.getDash(gr,dr);Ss&&qs.setConstantPatternPositions(Ss)}no&&Ts.setupShadows(Un.tileID.toUnwrapped(),bs,"vector-tile");let[Qs,Xs]=g.paint.get("line-trim-offset");(dr==="round"||dr==="square")&&Qs!==Xs&&(Qs===0&&(Qs-=1),Xs===1&&(Xs+=1));const to=Yt?Wn.projMatrix:null,ko=yt?1/hs.tileToMeter/h.ay(Un,1,et.transform.zoom):1,Ko=yt?1/hs.tileToMeter/h.ay(Un,1,Math.floor(et.transform.zoom)):1,zl=yr?h.e1(et,Un,g,to,tr,ko,Ko,[Qs,Xs],fs,Vr):h.e2(et,Un,g,to,hs.lineClipsArray.length,tr,ko,Ko,[Qs,Xs],fs);if(Yr){const Ss=hs.gradients[g.id];let cs=Ss.texture;if(g.gradientVersion!==Ss.version){let so=256;if(g.stepInterpolant){const Ho=o.getSource().maxzoom,Fo=Wn.canonical.z===Ho?Math.ceil(1<<et.transform.maxZoom-Wn.canonical.z):1;so=h.aA(h.e3(hs.maxLineLength/h.al*1024*Fo),256,Et.maxTextureSize)}Ss.gradient=h.e4({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:so,image:Ss.gradient||void 0,clips:hs.lineClipsArray}),Ss.texture?Ss.texture.update(Ss.gradient):Ss.texture=new h.T(Et,Ss.gradient,Lt.RGBA8),Ss.version=g.gradientVersion,cs=Ss.texture}Et.activeTexture.set(Lt.TEXTURE1),cs.bind(g.stepInterpolant?Lt.NEAREST:Lt.LINEAR,Lt.CLAMP_TO_EDGE)}pr&&(Et.activeTexture.set(Lt.TEXTURE0),Un.lineAtlasTexture&&Un.lineAtlasTexture.bind(Lt.LINEAR,Lt.REPEAT),qs.updatePaintBuffers()),yr&&(Et.activeTexture.set(Lt.TEXTURE0),Un.imageAtlasTexture&&Un.imageAtlasTexture.bind(Lt.LINEAR,Lt.CLAMP_TO_EDGE),qs.updatePaintBuffers()),Xn&&!vt&&et.terrain.setupElevationDraw(Un,bs),et.uploadCommonUniforms(Et,bs,Wn.toUnwrapped());const Do=Ss=>{Tr!=null&&(Tr.value=Qr*ut),bs.draw(et,Lt.TRIANGLES,xn,Ss,$t,ts.disabled,zl,g.id,hs.layoutVertexBuffer,hs.indexBuffer,hs.segments,g.paint,et.transform.zoom,qs,[hs.layoutVertexBuffer2,hs.patternVertexBuffer,hs.zOffsetVertexBuffer]),Tr!=null&&(Tr.value=Qr)};if(Nr&&!Xn){const Ss=et.stencilModeForClipping(Wn).ref;Ss===0&&Yt&&Et.clear({stencil:0});const cs={func:Lt.EQUAL,mask:255};zl.u_alpha_discard_threshold=.8,Do(new Vn(cs,Ss,255,Lt.KEEP,Lt.KEEP,Lt.INVERT)),zl.u_alpha_discard_threshold=0,Do(new Vn(cs,Ss,255,Lt.KEEP,Lt.KEEP,Lt.KEEP))}else zl.u_alpha_discard_threshold=Nr&&Xn&&Gn?.8:0,Do(Xn?mn:et.stencilModeForClipping(Wn))}};let Hr=et.depthModeForSublayer(0,fn.ReadOnly);const un=new fn(et.depthOcclusion?Lt.GREATER:Lt.LEQUAL,fn.ReadOnly,et.depthRangeFor3D);if(g.hasNonElevatedBuckets){const Tn=!Yt&&et.terrain;ut!==0&&Tn?h.w(`Occlusion opacity for layer ${g.id} is supported on terrain only if the layer has line-z-offset enabled.`):Tn?h.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${g.id}.`):en(_e,Br,Hr,Vn.disabled,!1,!0)}if(g.hasElevatedBuckets){pt==="hd-road-markup"?Mt||(Hr=un,Br.push("ELEVATED_ROADS")):(Br.push("ELEVATED"),Hr=un,Ot&&Br.push(qt?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),vt&&Br.push("ELEVATION_REFERENCE_SEA"));const Tn=Nr?et.stencilModeFor3D():Vn.disabled;et.forceTerrainMode=!0,en(_e,Br,Hr,Tn,!0,!0),Nr&&en(_e,Br,Hr,Tn,!0,!1),et.forceTerrainMode=!1}Nr&&(et.resetStencilClippingMasks(),Yt&&Et.clear({stencil:0})),ut===0||et.depthOcclusion||Yt||et.layersWithOcclusionOpacity.push(et.currentLayer)},fill:function(et,o,g,_e){const nt=g.paint.get("fill-color"),st=g.paint.get("fill-opacity");if(st.constantOr(1)===0)return;const lt=g.paint.get("fill-emissive-strength"),ut=et.colorModeForDrapableLayerRenderPass(lt),pt=g.paint.get("fill-pattern"),yt=et.opaquePassEnabledForLayer()&&!pt.constantOr(1)&&nt.constantOr(h.ao.transparent).a===1&&st.constantOr(0)===1?"opaque":"translucent";let vt="none";g.layout.get("fill-elevation-reference")!=="none"?vt="road":g.paint.get("fill-z-offset").constantOr(1)!==0&&(vt="offset");const Mt=!(!et.terrain||!et.terrain.enabled),Et={painter:et,sourceCache:o,layer:g,coords:_e,colorMode:ut,elevationType:vt,terrainEnabled:Mt,pass:yt};if(et.renderPass!=="shadow")if(vt!=="offset"){if(Ay(Et,!1),vt==="road"){const Lt=!Mt&&et.renderPass==="translucent";Lt&&Bm(et,o,g,_e,"geometry"),Ay(Et,!0,Vn.disabled),Lt&&function(Ft){const{painter:Ot,sourceCache:qt,layer:$t,coords:Yt,colorMode:tr}=Ft,sr=Ot.context.gl,pr=Ft.painter.shadowRenderer,hr=!!pr&&pr.enabled,gr=new fn(Ot.context.gl.LEQUAL,fn.ReadOnly,Ot.depthRangeFor3D);let dr=[0,0,0];if(hr){const yr=Ot.style.directionalLight,Vr=Ot.style.ambientLight;yr&&Vr&&(dr=sp(Ot.style,yr,Vr))}const ur=yr=>{for(const Vr of Yt){const Ir=qt.getTile(Vr),Qr=Ir.getBucket($t);if(!Qr)continue;const Nr=Qr.elevatedStructures;if(!Nr)continue;let Yr,Cn;if(yr?(Yr=Nr.renderableBridgeSegments,Cn=Nr.bridgeProgramConfigurations.get($t.id)):(Yr=Nr.renderableTunnelSegments,Cn=Nr.tunnelProgramConfigurations.get($t.id)),!Yr||Yr.segments[0].primitiveLength===0)continue;Cn.updatePaintBuffers(),Ot.prepareDrawTile();const Br=Ot.isTileAffectedByFog(Vr),Tr=[];hr&&Tr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const en=Ot.getOrCreateProgram("elevatedStructures",{config:Cn,overrideFog:Br,defines:Tr}),Hr=Ot.translatePosMatrix(Vr.projMatrix,Ir,$t.paint.get("fill-translate"),$t.paint.get("fill-translate-anchor"));hr&&pr.setupShadows(Ir.tileID.toUnwrapped(),en,"vector-tile");const un=kw(Hr,dr);Ot.uploadCommonUniforms(Ot.context,en,Vr.toUnwrapped()),en.draw(Ot,sr.TRIANGLES,gr,Vn.disabled,tr,ts.backCCW,un,$t.id,Nr.vertexBuffer,Nr.indexBuffer,Yr,$t.paint,Ot.transform.zoom,Cn,[Nr.vertexBufferNormal])}};ur(!0),ur(!1)}(Et)}}else Ay(Et,!1,et.stencilModeFor3D());else et.shadowRenderer&&vt==="road"&&!Mt&&function(Lt){const{painter:Ft,sourceCache:Ot,layer:qt,coords:$t}=Lt,Yt=Ft.context.gl,tr=Lt.painter.shadowRenderer;for(const sr of $t){const pr=Ot.getTile(sr),hr=pr.getBucket(qt);if(!hr)continue;const gr=hr.elevatedStructures;if(!gr||!gr.shadowCasterSegments||gr.shadowCasterSegments.segments[0].primitiveLength===0)continue;Ft.prepareDrawTile();const dr=hr.bufferData.programConfigurations.get(qt.id),ur=Ft.isTileAffectedByFog(sr),yr=Ft.getOrCreateProgram("elevatedStructuresDepth",{config:dr,overrideFog:ur}),Vr=tr.calculateShadowPassMatrixFromTile(pr.tileID.toUnwrapped());Ft.uploadCommonUniforms(Ft.context,yr,sr.toUnwrapped());const Ir={u_matrix:Vr,u_depth_bias:0};yr.draw(Ft,Yt.TRIANGLES,tr.getShadowPassDepthMode(),Vn.disabled,tr.getShadowPassColorMode(),ts.disabled,Ir,qt.id,gr.vertexBuffer,gr.indexBuffer,gr.shadowCasterSegments,qt.paint,Ft.transform.zoom,dr)}}(Et)},"fill-extrusion":function(et,o,g,_e){const nt=g.paint.get("fill-extrusion-opacity"),st=et.context,lt=st.gl,ut=et.terrain,pt=ut&&ut.renderingToTexture;if(nt===0)return;const yt=et.conflationActive&&et.style.isLayerClipped(g,o.getSource()),vt=et.style.order.indexOf(g.fqid);if(yt&&function(Mt,Et,Lt,Ft,Ot){for(const qt of Ft){const $t=Et.getTile(qt).getBucket(Lt);$t&&($t.updateReplacement(qt,Mt.replacementSource,Ot),$t.uploadCentroid(Mt.context))}}(et,o,g,_e,vt),ut||yt)for(const Mt of _e){const Et=o.getTile(Mt).getBucket(g);Et&&dm(et.context,o,Mt,Et,g,ut,yt)}if(et.renderPass==="shadow"&&et.shadowRenderer){const Mt=et.shadowRenderer;if(ut&&nt<.65&&g._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof h.ad)return;const Et=Mt.getShadowPassDepthMode(),Lt=Mt.getShadowPassColorMode();Fn(et,o,g,_e,Et,Vn.disabled,Lt,yt)}else if(et.renderPass==="translucent"){const Mt=!g.paint.get("fill-extrusion-pattern").constantOr(1),Et=g.paint.get("fill-extrusion-color").constantOr(h.ao.white);if(!pt&&Et.a!==0){const Lt=new fn(et.context.gl.LEQUAL,fn.ReadWrite,et.depthRangeFor3D);nt===1&&Mt?Fn(et,o,g,_e,Lt,Vn.disabled,Pn.unblended,yt):(Fn(et,o,g,_e,Lt,Vn.disabled,Pn.disabled,yt),Fn(et,o,g,_e,Lt,et.stencilModeFor3D(),et.colorModeForRenderPass(),yt),et.resetStencilClippingMasks())}if(et.style.enable3dLights()&&Mt&&(!ut&&et.transform.projection.name!=="globe"||pt)){const Lt=g.paint.get("fill-extrusion-opacity"),Ft=g.paint.get("fill-extrusion-ambient-occlusion-intensity"),Ot=g.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),qt=g.paint.get("fill-extrusion-flood-light-intensity"),$t=g.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Yt=g.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor($t?null:g.lut).toArray01().slice(0,3),tr=Ft>0&&Ot>0,sr=qt>0,pr=(dr,ur,yr)=>(1-yr)*dr+yr*ur,hr=new wv;hr.translate=g.paint.get("fill-extrusion-translate"),hr.translateAnchor=g.paint.get("fill-extrusion-translate-anchor"),hr.edgeRadius=g.layout.get("fill-extrusion-edge-radius"),hr.cutoffFadeRange=g.paint.get("fill-extrusion-cutoff-fade-range");const gr=dr=>{const ur=et.depthModeForSublayer(1,fn.ReadOnly,lt.LEQUAL,!0),yr=g.paint.get(dr?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Vr=pr(.1,3,yr),Ir=et._showOverdrawInspector;if(!Ir){const Qr=new Vn({func:lt.ALWAYS,mask:255},255,255,lt.KEEP,lt.KEEP,lt.REPLACE),Nr=new Pn([lt.ONE,lt.ONE,lt.ONE,lt.ONE],h.ao.transparent,[!1,!1,!1,!0],lt.MIN);jp(hr,et,o,g,_e,ur,Qr,Nr,ts.disabled,dr,"sdf",Lt,Ft,Ot,qt,Yt,Vr,yt,!1)}{const Qr=Ir?Vn.disabled:new Vn({func:lt.EQUAL,mask:255},255,255,lt.KEEP,lt.DECR,lt.DECR),Nr=Ir?et.colorModeForRenderPass():new Pn([lt.ONE_MINUS_DST_ALPHA,lt.DST_ALPHA,lt.ONE,lt.ONE],h.ao.transparent,[!0,!0,!0,!0]);jp(hr,et,o,g,_e,ur,Qr,Nr,ts.disabled,dr,"color",Lt,Ft,Ot,qt,Yt,Vr,yt,!1)}};if(pt){const dr=(ur,yr,Vr)=>{const Ir=et.depthModeForSublayer(1,fn.ReadOnly,lt.LEQUAL,!1),Qr=g.paint.get(ur?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Nr=pr(.1,3,Qr);{const Yr=new Pn([lt.ONE,lt.ONE,lt.ONE,lt.ONE],h.ao.transparent,[!1,!1,!1,!0]);jp(hr,et,o,g,_e,Ir,Vn.disabled,Yr,ts.disabled,ur,"clear",Lt,Ft,Ot,qt,Yt,Nr,yt,yr)}{const Yr=new Vn({func:lt.ALWAYS,mask:255},255,255,lt.KEEP,lt.KEEP,lt.REPLACE),Cn=new Pn([lt.ONE,lt.ONE,lt.ONE,lt.ONE],h.ao.transparent,[!1,!1,!1,!0],lt.MIN);jp(hr,et,o,g,_e,Ir,Yr,Cn,ts.disabled,ur,"sdf",Lt,Ft,Ot,qt,Yt,Nr,yt,yr)}{const Yr=ur?lt.ZERO:lt.ONE_MINUS_DST_ALPHA,Cn=new Vn({func:lt.EQUAL,mask:255},255,255,lt.KEEP,lt.DECR,lt.DECR),Br=new Pn([Yr,lt.DST_ALPHA,lt.ONE_MINUS_DST_ALPHA,lt.ZERO],h.ao.transparent,[!0,!0,!0,!0]);jp(hr,et,o,g,_e,Ir,Cn,Br,ts.disabled,ur,"color",Lt,Ft,Ot,qt,Yt,Nr,yt,yr)}{const Yr=new Pn([lt.ONE,lt.ONE,lt.ONE,ur?lt.ZERO:lt.ONE],h.ao.transparent,[!1,!1,!1,!0],ur?lt.FUNC_ADD:lt.MAX);jp(hr,et,o,g,_e,Ir,Vn.disabled,Yr,ts.disabled,ur,"clear",Lt,Ft,Ot,qt,Yt,Nr,yt,yr,Vr)}};if(tr||sr){let ur;if(et.prepareDrawTile(),ut){const yr=ut.drapeBufferSize[0],Vr=ut.drapeBufferSize[1];ur=ut.framebufferCopyTexture,ur&&(!ur||ur.size[0]===yr&&ur.size[1]===Vr)||(ur&&ur.destroy(),ur=ut.framebufferCopyTexture=new h.T(st,new h.q({width:yr,height:Vr}),lt.RGBA8)),ur.bind(lt.LINEAR,lt.CLAMP_TO_EDGE),lt.copyTexSubImage2D(lt.TEXTURE_2D,0,0,0,0,0,yr,Vr)}tr&&dr(!0,!1,ur),sr&&dr(!1,!0,ur)}}else tr&&gr(!0),sr&&gr(!1),(tr||sr)&&et.resetStencilClippingMasks()}}},building:function(et,o,g,_e){et.currentLayer<et.firstLightBeamLayer&&(et.firstLightBeamLayer=et.currentLayer);const nt=g.paint.get("building-ambient-occlusion-ground-intensity"),st=g.paint.get("building-ambient-occlusion-ground-radius"),lt=g.paint.get("building-ambient-occlusion-ground-attenuation"),ut=g.paint.get("building-opacity");if(ut<=0)return;let pt=nt>0&&st>0,yt=!0;const vt=g.paint.get("building-vertical-scale");(!et.shadowRenderer||vt<1)&&(yt=!1);const Mt=et.conflationActive&&et.style.isLayerClipped(g,o.getSource()),Et=et.style.order.indexOf(g.fqid);if(function(Lt,Ft,Ot,qt,$t,Yt){for(const tr of Yt){const sr=Ft.getTile(tr).getBucket(Ot);sr&&($t&&sr.updateReplacement(tr,Lt.replacementSource,qt),sr.uploadUpdatedIndexBuffer(Lt.context))}}(et,o,g,Et,Mt,_e),function(Lt,Ft,Ot,qt){for(const $t of qt){const Yt=Ft.getTile($t).getBucket(Ot);Yt&&Yt.needsEvaluation()&&Yt.uploadUpdatedColorBuffer(Lt.context)}}(et,o,g,_e),g.resetLayerRenderingStats(et),et.shadowRenderer&&(et.shadowRenderer.useNormalOffset=!0),et.renderPass==="shadow"&&et.shadowRenderer){const Lt=et.shadowRenderer,Ft=[],Ot=Lt.getShadowPassDepthMode();lx({painter:et,source:o,layer:g,coords:_e,defines:Ft,blendMode:Lt.getShadowPassColorMode(),depthMode:Ot,opacity:ut,verticalScale:vt,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(et.renderPass==="translucent"){let Lt=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];yt&&(Lt=Lt.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),et.shadowRenderer&&et.shadowRenderer.useNormalOffset&&(Lt=Lt.concat("NORMAL_OFFSET"));const Ft=g.paint.get("building-facade-emissive-chance"),Ot=g.paint.get("building-ambient-occlusion-intensity"),qt=new fn(et.context.gl.LEQUAL,fn.ReadWrite,et.depthRangeFor3D);ut<1&&lx({painter:et,source:o,layer:g,coords:_e,defines:Lt,blendMode:Pn.disabled,depthMode:qt,opacity:ut,verticalScale:vt,facadeEmissiveChance:Ft,facadeAOIntensity:Ot});const $t=et.colorModeForRenderPass();lx({painter:et,source:o,layer:g,coords:_e,defines:Lt,blendMode:$t,depthMode:qt,opacity:ut,verticalScale:vt,facadeEmissiveChance:Ft,facadeAOIntensity:Ot}),pt&&function(Yt,tr,sr,pr,hr,gr,dr,ur,yr,Vr,Ir,Qr,Nr){const Yr=Yt.context.gl,Cn=Yt.depthModeForSublayer(1,fn.ReadOnly,Yr.LEQUAL,!0),Br=.1*(1-(Tr=Ir))+3*Tr;var Tr;const en=Yt._showOverdrawInspector,Hr=Qr,un=new wv;en||jp(un,Yt,tr,sr,pr,Cn,new Vn({func:Yr.ALWAYS,mask:255},255,255,Yr.KEEP,Yr.KEEP,Yr.REPLACE),new Pn([Yr.ONE,Yr.ONE,Yr.ONE,Yr.ONE],h.ao.transparent,[!1,!1,!1,!0],Yr.MIN),ts.disabled,hr,"sdf",gr,dr,ur,0,Vr,Br,Hr,!1);{const Tn=en?Vn.disabled:new Vn({func:Yr.EQUAL,mask:255},255,255,Yr.KEEP,Yr.DECR,Yr.DECR),Ln=en?Yt.colorModeForRenderPass():new Pn([Yr.ONE_MINUS_DST_ALPHA,Yr.DST_ALPHA,Yr.ONE,Yr.ONE],h.ao.transparent,[!0,!0,!0,!0]);jp(un,Yt,tr,sr,pr,Cn,Tn,Ln,ts.disabled,hr,"color",gr,dr,ur,0,Vr,Br,Hr,!1)}}(et,o,g,_e,!0,ut,nt,st,0,[0,0,0],lt,Mt)}else if(et.renderPass==="light-beam"){const Lt=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],Ft=new fn(et.context.gl.LEQUAL,fn.ReadOnly,et.depthRangeFor3D);lx({painter:et,source:o,layer:g,coords:_e,defines:Lt,blendMode:Pn.alphaBlended,depthMode:Ft,opacity:ut,verticalScale:vt,facadeEmissiveChance:0,facadeAOIntensity:0})}et.shadowRenderer&&(et.shadowRenderer.useNormalOffset=!1),et.resetStencilClippingMasks()},hillshade:function(et,o,g,_e){if(et.renderPass!=="offscreen"&&et.renderPass!=="translucent"||et.style.disableElevatedTerrain)return;const nt=et.context,st=et.terrain&&et.terrain.renderingToTexture,[lt,ut]=et.renderPass!=="translucent"||st?[{},_e]:et.stencilConfigForOverlap(_e);for(const pt of ut){const yt=o.getTile(pt);if(yt.needsHillshadePrepare&&et.renderPass==="offscreen")xw(et,yt,g);else if(et.renderPass==="translucent"){const vt=et.depthModeForSublayer(0,fn.ReadOnly),Mt=g.paint.get("hillshade-emissive-strength"),Et=et.colorModeForDrapableLayerRenderPass(Mt),Lt=st&&et.terrain?et.terrain.stencilModeForRTTOverlap(pt):lt[pt.overscaledZ];_w(et,pt,yt,g,vt,Lt,Et)}}nt.viewport.set([0,0,et.width,et.height]),et.resetStencilClippingMasks()},raster:function(et,o,g,_e,nt,st){if(et.renderPass!=="translucent"||g.paint.get("raster-opacity")===0)return;const lt=et.transform.projection.name==="globe",ut=g.paint.get("raster-elevation")!==0,pt=ut&&lt;if(et.renderElevatedRasterBackface&&!pt)return;const yt=et.context,vt=yt.gl,Mt=o.getSource(),Et=function(hr,gr,dr,ur){const yr=gr.paint.get("raster-color"),Vr=hr.type==="raster-array",Ir=[],Qr=gr.paint.get("raster-resampling"),Nr=gr.paint.get("raster-color-mix");let Yr=gr.paint.get("raster-color-range");const Cn=[Nr[0],Nr[1],Nr[2],0],Br=Nr[3];let Tr=Qr==="nearest"?ur.NEAREST:ur.LINEAR;if(Vr&&(Ir.push("RASTER_ARRAY"),yr||Ir.push("RASTER_COLOR"),Qr==="linear"&&Ir.push("RASTER_ARRAY_LINEAR"),Tr=ur.NEAREST,!Yr&&hr.rasterLayers)){const en=hr.rasterLayers.find(({id:Hr})=>Hr===gr.sourceLayer);en&&en.fields&&en.fields.range&&(Yr=en.fields.range)}if(Yr=Yr||[0,1],yr){Ir.push("RASTER_COLOR"),dr.activeTexture.set(ur.TEXTURE2),gr.updateColorRamp(Yr);let en=gr.colorRampTexture;en||(en=gr.colorRampTexture=new h.T(dr,gr.colorRamp,ur.RGBA8)),en.bind(ur.LINEAR,ur.CLAMP_TO_EDGE)}return{mix:Cn,range:Yr,offset:Br,defines:Ir,resampling:Tr}}(Mt,g,yt,vt);if(Mt instanceof h.aS&&!_e.length&&!lt)return;const Lt=g.paint.get("raster-emissive-strength"),Ft=et.colorModeForDrapableLayerRenderPass(Lt),Ot=et.terrain&&et.terrain.renderingToTexture,qt=!et.options.moving,$t=g.paint.get("raster-resampling")==="nearest"?vt.NEAREST:vt.LINEAR;if(Mt instanceof h.aS&&!_e.length&&(Mt.onNorthPole||Mt.onSouthPole)){const hr=ut?et.stencilModeFor3D():Vn.disabled;return void hx(!!Mt.onNorthPole,null,et,o,g,Lt,Et,ts.disabled,hr)}if(!_e.length)return;const[Yt,tr]=Mt instanceof h.aS||Ot?[{},_e]:et.stencilConfigForOverlap(_e),sr=tr[tr.length-1].overscaledZ;pt&&Et.defines.push("PROJECTION_GLOBE_VIEW"),ut&&Et.defines.push("RENDER_CUTOFF");const pr=(hr,gr,dr)=>{for(const ur of hr){const yr=ur.toUnwrapped(),Vr=o.getTile(ur);if(Ot&&(!Vr||!Vr.hasData()))continue;yt.activeTexture.set(vt.TEXTURE0);const Ir=K0(Vr,Mt,g,Et);if(!Ir||!Ir.texture)continue;const{texture:Qr,mix:Nr,offset:Yr,tileSize:Cn,buffer:Br}=Ir;let Tr,en;Ot?(Tr=fn.disabled,en=ur.projMatrix):ut?(Tr=new fn(vt.LEQUAL,fn.ReadWrite,et.depthRangeFor3D),en=lt?Float32Array.from(et.transform.expandedFarZProjMatrix):et.transform.calculateProjMatrix(yr,qt)):(Tr=et.depthModeForSublayer(ur.overscaledZ-sr,g.paint.get("raster-opacity")===1?fn.ReadWrite:fn.ReadOnly,vt.LESS),en=et.transform.calculateProjMatrix(yr,qt));const Hr=et.terrain&&Ot?et.terrain.stencilModeForRTTOverlap(ur):Yt[ur.overscaledZ],un=st?0:g.paint.get("raster-fade-duration");Vr.registerFadeDuration(un);const Tn=o.findLoadedParent(ur,0),Ln=Fm(Vr,Tn,o,et.transform,un);let xn,mn;!Ln.isFading&&Vr.refreshedUponExpiration&&(Vr.refreshedUponExpiration=!1),et.terrain&&et.terrain.prepareDrawTile(),yt.activeTexture.set(vt.TEXTURE0),Qr.bind($t,vt.CLAMP_TO_EDGE),yt.activeTexture.set(vt.TEXTURE1),Tn?(Tn.texture&&Tn.texture.bind($t,vt.CLAMP_TO_EDGE),xn=Math.pow(2,Tn.tileID.overscaledZ-Vr.tileID.overscaledZ),mn=[Vr.tileID.canonical.x*xn%1,Vr.tileID.canonical.y*xn%1]):Qr.bind($t,vt.CLAMP_TO_EDGE),"useMipmap"in Qr&&yt.extTextureFilterAnisotropic&&et.transform.pitch>20&&vt.texParameterf(vt.TEXTURE_2D,yt.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,yt.extTextureFilterAnisotropicMax);const Xn=et.transform;let Gn;const Wn=ut?Ow(Xn):[0,0,0,0];let Un,hs,vs,Ts,no,fs=0;if(pt&&Mt instanceof h.aS&&Mt.coordinates.length>3)Un=Float32Array.from(h.bk(h.dF(new h.cC(0,0,0)))),hs=Float32Array.from(Xn.globeMatrix),vs=Float32Array.from(h.dB(Xn)),Ts=[h.aF(Xn.center.lng),h.aJ(Xn.center.lat)],Gn=Mt.elevatedGlobePerspectiveTransform,no=Mt.elevatedGlobeGridMatrix||new Float32Array(9);else if(pt){const bs=h.dC(ur.canonical);fs=h.dD(bs.getCenter().lat),Un=Float32Array.from(h.bk(h.dF(ur.canonical))),hs=Float32Array.from(Xn.globeMatrix),vs=Float32Array.from(h.dB(Xn)),Ts=[h.aF(Xn.center.lng),h.aJ(Xn.center.lat)],Gn=[0,0],no=Float32Array.from(h.dE(ur.canonical,bs,fs,Xn.worldSize/Xn._pixelsPerMercatorPixel))}else Gn=Mt instanceof h.aS?Mt.perspectiveTransform:[0,0],Un=new Float32Array(16),hs=new Float32Array(9),vs=new Float32Array(16),Ts=[0,0],no=new Float32Array(9);const qs=J_(en,Un,hs,vs,no,mn||[0,0],h.aj(et.transform.zoom),Ts,Wn,xn||1,Ln,g,Gn,ut?g.paint.get("raster-elevation"):0,2,Nr,Yr,Et.range,Cn,Br,Lt),io=et.isTileAffectedByFog(ur),Ao=et.getOrCreateProgram("raster",{defines:Et.defines,overrideFog:io});if(et.uploadCommonUniforms(yt,Ao,yr),Mt instanceof h.aS){const bs=Mt.elevatedGlobeVertexBuffer,Qs=Mt.elevatedGlobeIndexBuffer;if(Ot||!lt)Mt.boundsBuffer&&Mt.boundsSegments&&Ao.draw(et,vt.TRIANGLES,Tr,Vn.disabled,Ft,ts.disabled,qs,g.id,Mt.boundsBuffer,et.quadTriangleIndexBuffer,Mt.boundsSegments);else if(bs&&Qs){const Xs=Xn.zoom<=h.cZ?Mt.elevatedGlobeSegments:Mt.getSegmentsForLongitude(Xn.center.lng);Xs&&Ao.draw(et,vt.TRIANGLES,Tr,Vn.disabled,Ft,gr,qs,g.id,bs,Qs,Xs)}}else if(pt){Tr=new fn(vt.LEQUAL,fn.ReadOnly,et.depthRangeFor3D);const bs=et.globeSharedBuffers;if(bs){const[Qs,Xs,to]=bs.getGridBuffers(fs,!1);Ao.draw(et,vt.TRIANGLES,Tr,dr||Hr,et.colorModeForRenderPass(),gr,qs,g.id,Qs,Xs,to)}}else{const{tileBoundsBuffer:bs,tileBoundsIndexBuffer:Qs,tileBoundsSegments:Xs}=et.getTileBoundsBuffers(Vr);Ao.draw(et,vt.TRIANGLES,Tr,Hr,Ft,ts.disabled,qs,g.id,bs,Qs,Xs)}}if(!(Mt instanceof h.aS)&&pt)for(const ur of hr){const yr=ur.canonical.y===(1<<ur.canonical.z)-1;ur.canonical.y===0&&hx(!0,ur,et,o,g,Lt,Et,gr,dr||Vn.disabled),yr&&hx(!1,ur,et,o,g,Lt,Et,gr===ts.frontCW?ts.backCW:ts.frontCW,dr||Vn.disabled)}};pt?pr(tr,et.renderElevatedRasterBackface?ts.backCW:ts.frontCW,et.stencilModeFor3D()):pr(tr,ts.disabled,void 0),et.resetStencilClippingMasks()},"raster-particle":function(et,o,g,_e,nt,st){et.renderPass==="offscreen"&&function(lt,ut,pt,yt){if(!yt.length)return;const vt=lt.context,Mt=vt.gl,Et=ut.getSource();if(!(Et instanceof ip))return;const Lt=Math.ceil(Math.sqrt(pt.paint.get("raster-particle-count")));let Ft=pt.particlePositionRGBAImage;if(!Ft||Ft.width!==Lt){const tr=function(sr){const pr=sr*sr,hr=new Uint8Array(4*pr),gr=function(ur){return ur|=0,ur=Math.imul(2747636419^ur,2654435769),ur=Math.imul(ur^ur>>>16,2654435769),((ur=Math.imul(ur^ur>>>16,2654435769))>>>0)/4294967296},dr=1/1.1;for(let ur=0;ur<pr;ur++){const yr=dr*(gr(2*ur+0)+Nm),Vr=dr*(gr(2*ur+1)+Nm),Ir=255*yr%1,Qr=255*Vr%1,Nr=Ir,Yr=Vr-Qr/255,Cn=Qr;hr[4*ur+0]=255*(yr-Ir/255),hr[4*ur+1]=255*Nr,hr[4*ur+2]=255*Yr,hr[4*ur+3]=255*Cn}return hr}(Lt);Ft=pt.particlePositionRGBAImage=new h.q({width:Lt,height:Lt},tr)}let Ot=pt.particleFramebuffer;Ot?Ot.width!==Lt&&(Ot.destroy(),Ot=pt.particleFramebuffer=vt.createFramebuffer(Lt,Lt,!0,null)):Ot=pt.particleFramebuffer=vt.createFramebuffer(Lt,Lt,!0,null);const qt=[];for(const tr of yt){const sr=ut.getTile(tr);if(!(sr instanceof Am))continue;const pr=Cu(sr,Et,pt);if(!pr)continue;const hr=[sr.tileSize,sr.tileSize];let gr=pt.tileFramebuffer;gr||(gr=pt.tileFramebuffer=vt.createFramebuffer(hr[0],hr[1],!0,null));let dr=sr.rasterParticleState;dr||(dr=sr.rasterParticleState=new Nw(vt,tr,hr,Ft));const ur=dr.update(pt.lastInvalidatedAt);dr.particleTextureDimension!==Lt&&dr.updateParticleTexture(tr,Ft);const yr=dr.targetColorTexture;dr.targetColorTexture=dr.backgroundColorTexture,dr.backgroundColorTexture=yr;const Vr=dr.particleTexture0;dr.particleTexture0=dr.particleTexture1,dr.particleTexture1=Vr,qt.push([tr,pr,dr,ur])}if(qt.length===0)return;const $t=h.o.now(),Yt=pt.previousDrawTimestamp?.001*($t-pt.previousDrawTimestamp):.0167;if(pt.previousDrawTimestamp=$t,pt.hasColorMap()){vt.activeTexture.set(Mt.TEXTURE0+2);let tr=pt.colorRampTexture;tr||(tr=pt.colorRampTexture=new h.T(vt,pt.colorRamp,Mt.RGBA8)),tr.bind(Mt.LINEAR,Mt.CLAMP_TO_EDGE)}vt.bindFramebuffer.set(pt.tileFramebuffer.framebuffer),function(tr,sr,pr){const hr=tr.context,gr=hr.gl,dr=sr.tileFramebuffer;hr.activeTexture.set(gr.TEXTURE0);const ur={u_texture:0,u_opacity:1.05*(Vr=sr.paint.get("raster-particle-fade-opacity-factor"))/(Vr+.05)},yr=tr.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Vr;for(const Ir of pr){const[,,Qr,Nr]=Ir;dr.colorAttachment.set(Qr.targetColorTexture.texture),hr.viewport.set([0,0,dr.width,dr.height]),hr.clear({color:h.ao.transparent}),Nr&&(Qr.backgroundColorTexture.bind(gr.NEAREST,gr.CLAMP_TO_EDGE),yr.draw(tr,gr.TRIANGLES,fn.disabled,Vn.disabled,Pn.alphaBlended,ts.disabled,ur,sr.id,tr.viewportBuffer,tr.quadTriangleIndexBuffer,tr.viewportSegments))}}(lt,pt,qt),function(tr,sr,pr,hr){const gr=tr.context,dr=gr.gl,ur=pr.tileFramebuffer,yr=tr.transform.projection.name==="globe",Vr=pr.paint.get("raster-particle-max-speed");for(const Ir of hr){const[Qr,Nr,Yr]=Ir;gr.activeTexture.set(dr.TEXTURE0+0),Nr.texture.bind(dr.LINEAR,dr.CLAMP_TO_EDGE),ur.colorAttachment.set(Yr.targetColorTexture.texture);const Cn=tr.getOrCreateProgram("rasterParticleDraw",{defines:Nr.defines,overrideFog:!1});gr.activeTexture.set(dr.TEXTURE0+1);const Br=Nr.scalarData?[]:[0,1,2,3].map(Hr=>h.e6[Hr](Qr));Br.push(Qr);const Tr=Qr.canonical.x,en=Qr.canonical.y;for(const Hr of Br){const un=sr.getTile(yr?Hr.wrapped():Hr);if(!un)continue;const Tn=un.rasterParticleState;if(!Tn)continue;const Ln=Hr.canonical.x+(1<<Hr.canonical.z)*(Hr.wrap-Qr.wrap),xn=Hr.canonical.y;Tn.particleTexture0.bind(dr.NEAREST,dr.CLAMP_TO_EDGE);const mn=gv(1,Tn.particleTexture0.size[0],[Ln-Tr,xn-en],0,Nr.texture.size,2,Vr,Nr.textureOffset,Nr.scale,Nr.offset);Cn.draw(tr,dr.POINTS,fn.disabled,Vn.disabled,Pn.alphaBlended,ts.disabled,mn,pr.id,Tn.particleIndexBuffer,void 0,Tn.particleSegment)}}}(lt,ut,pt,qt),vt.bindFramebuffer.set(pt.particleFramebuffer.framebuffer),function(tr,sr,pr,hr){const gr=tr.context,dr=gr.gl,ur=sr.paint.get("raster-particle-max-speed"),yr=hr*sr.paint.get("raster-particle-speed-factor")*.15,Vr=function(Qr){return Math.pow(Qr,6)}(.01+1*sr.paint.get("raster-particle-reset-rate-factor")),Ir=sr.particleFramebuffer;gr.viewport.set([0,0,Ir.width,Ir.height]);for(const Qr of pr){const[,Nr,Yr]=Qr;gr.activeTexture.set(dr.TEXTURE0+0),Nr.texture.bind(dr.LINEAR,dr.CLAMP_TO_EDGE),gr.activeTexture.set(dr.TEXTURE0+1);const Cn=Yr.particleTexture0;Cn.bind(dr.NEAREST,dr.CLAMP_TO_EDGE);const Br=ex(1,Cn.size[0],0,Nr.texture.size,ur,yr,Vr,Nr.textureOffset,Nr.scale,Nr.offset);Ir.colorAttachment.set(Yr.particleTexture1.texture),gr.clear({color:h.ao.transparent}),tr.getOrCreateProgram("rasterParticleUpdate",{defines:Nr.defines}).draw(tr,dr.TRIANGLES,fn.disabled,Vn.disabled,Pn.unblended,ts.disabled,Br,sr.id,tr.viewportBuffer,tr.quadTriangleIndexBuffer,tr.viewportSegments)}}(lt,pt,qt,Yt)}(et,o,g,_e),et.renderPass==="translucent"&&(function(lt,ut,pt,yt,vt){const Mt=lt.context,Et=Mt.gl,Lt=ut.getSource().tileSize,Ft=5*(1-h.ah(h.cK,h.cK+1,lt.transform.zoom))*Lt+pt.paint.get("raster-particle-elevation"),Ot=!lt.options.moving,qt=lt.transform.projection.name==="globe";if(!yt.length)return;const[$t,Yt]=lt.stencilConfigForOverlap(yt),tr=[];qt&&tr.push("PROJECTION_GLOBE_VIEW");const sr=lt.stencilModeFor3D();for(const pr of Yt){const hr=pr.toUnwrapped(),gr=ut.getTile(pr);if(!gr.rasterParticleState)continue;const dr=gr.rasterParticleState,ur=100;gr.registerFadeDuration(ur);const yr=ut.findLoadedParent(pr,0),Vr=Fm(gr,yr,ut,lt.transform,ur);let Ir,Qr;lt.terrain&&lt.terrain.prepareDrawTile(),Mt.activeTexture.set(Et.TEXTURE0),dr.targetColorTexture.bind(Et.LINEAR,Et.CLAMP_TO_EDGE),Mt.activeTexture.set(Et.TEXTURE1),yr&&yr.rasterParticleState?(yr.rasterParticleState.targetColorTexture.bind(Et.LINEAR,Et.CLAMP_TO_EDGE),Ir=Math.pow(2,yr.tileID.overscaledZ-gr.tileID.overscaledZ),Qr=[gr.tileID.canonical.x*Ir%1,gr.tileID.canonical.y*Ir%1]):dr.targetColorTexture.bind(Et.LINEAR,Et.CLAMP_TO_EDGE);const Nr=qt?Float32Array.from(lt.transform.expandedFarZProjMatrix):lt.transform.calculateProjMatrix(hr,Ot),Yr=lt.transform,Cn=Tv(Yr),Br=h.dC(pr.canonical),Tr=h.dD(Br.getCenter().lat);let en,Hr,un,Tn,Ln;qt?(en=Float32Array.from(h.bk(h.dF(pr.canonical))),Hr=Float32Array.from(Yr.globeMatrix),un=Float32Array.from(h.dB(Yr)),Tn=[h.aF(Yr.center.lng),h.aJ(Yr.center.lat)],Ln=Float32Array.from(h.dE(pr.canonical,Br,Tr,Yr.worldSize/Yr._pixelsPerMercatorPixel))):(en=new Float32Array(16),Hr=new Float32Array(9),un=new Float32Array(16),Tn=[0,0],Ln=new Float32Array(9));const xn=cm(Nr,en,Hr,un,Ln,Qr||[0,0],h.aj(lt.transform.zoom),Tn,Cn,Ir||1,Vr,Ft),mn=lt.isTileAffectedByFog(pr),Xn=lt.getOrCreateProgram("rasterParticle",{defines:tr,overrideFog:mn});if(lt.uploadCommonUniforms(Mt,Xn,hr),qt){const Gn=new fn(Et.LEQUAL,fn.ReadOnly,lt.depthRangeFor3D),Wn=0,Un=lt.globeSharedBuffers;if(Un){const[hs,vs,Ts]=Un.getGridBuffers(Tr,Wn!==0);Xn.draw(lt,Et.TRIANGLES,Gn,sr,Pn.alphaBlended,lt.renderElevatedRasterBackface?ts.frontCCW:ts.backCCW,xn,pt.id,hs,vs,Ts)}}else{const Gn=lt.depthModeForSublayer(0,fn.ReadOnly),Wn=$t[pr.overscaledZ],{tileBoundsBuffer:Un,tileBoundsIndexBuffer:hs,tileBoundsSegments:vs}=lt.getTileBoundsBuffers(gr);Xn.draw(lt,Et.TRIANGLES,Gn,Wn,Pn.alphaBlended,ts.disabled,xn,pt.id,Un,hs,vs)}}lt.resetStencilClippingMasks()}(et,o,g,_e),et.style.map.triggerRepaint())},background:function(et,o,g,_e){const nt=g.paint.get("background-color"),st=g.paint.get("background-color-use-theme").constantOr("default")==="none",lt=g.paint.get("background-opacity"),ut=g.paint.get("background-emissive-strength"),pt=g.paint.get("background-pitch-alignment")==="viewport";if(lt===0)return;const yt=et.context,vt=yt.gl,Mt=et.transform,Et=Mt.tileSize,Lt=g.paint.get("background-pattern");let Ft;if(Lt!==void 0&&(Lt===null||(Ft=et.imageManager.getPattern(h.I.from(Lt.toString()),g.scope,et.style.getLut(g.scope)),!Ft)))return;const Ot=!Lt&&nt.a===1&&lt===1&&et.opaquePassEnabledForLayer()?"opaque":"translucent";if(et.renderPass!==Ot)return;const qt=Vn.disabled,$t=et.depthModeForSublayer(0,Ot==="opaque"?fn.ReadWrite:fn.ReadOnly),Yt=et.colorModeForDrapableLayerRenderPass(ut),tr=Lt?"backgroundPattern":"background";let sr,pr=_e;if(pr||(sr=et.getBackgroundTiles(),pr=Object.values(sr).map(hr=>hr.tileID)),Lt&&(yt.activeTexture.set(vt.TEXTURE0),et.imageManager.bind(et.context,g.scope)),pt){const hr=et.getOrCreateProgram(tr,{overrideFog:!1,overrideRtt:!0}),gr=new Float32Array(h.bA([])),dr=new h.aO(0,0,0,0,0),ur=Lt?ix(gr,ut,lt,et,0,g.scope,Ft,pt,{tileID:dr,tileSize:Et}):tx(gr,ut,lt,nt.toPremultipliedRenderColor(st?null:g.lut));hr.draw(et,vt.TRIANGLES,$t,qt,Yt,ts.disabled,ur,g.id,et.viewportBuffer,et.quadTriangleIndexBuffer,et.viewportSegments)}else for(const hr of pr){const gr=et.isTileAffectedByFog(hr),dr=et.getOrCreateProgram(tr,{overrideFog:gr}),ur=hr.toUnwrapped(),yr=_e?hr.projMatrix:et.transform.calculateProjMatrix(ur);et.prepareDrawTile();const Vr=o?o.getTile(hr):sr?sr[hr.key]:new mp(hr,Et,Mt.zoom,et),Ir=Lt?ix(yr,ut,lt,et,0,g.scope,Ft,pt,{tileID:hr,tileSize:Et}):tx(yr,ut,lt,nt.toPremultipliedRenderColor(st?null:g.lut));et.uploadCommonUniforms(yt,dr,ur);const{tileBoundsBuffer:Qr,tileBoundsIndexBuffer:Nr,tileBoundsSegments:Yr}=et.getTileBoundsBuffers(Vr);dr.draw(et,vt.TRIANGLES,$t,qt,Yt,ts.disabled,Ir,g.id,Qr,Nr,Yr)}},sky:function(et,o,g){const _e=et._atmosphere?h.aj(et.transform.zoom):1,nt=g.paint.get("sky-opacity")*_e;if(nt===0)return;const st=et.context,lt=g.paint.get("sky-type"),ut=new fn(st.gl.LEQUAL,fn.ReadOnly,[0,1]),pt=et.frameCounter/1e3%1;lt==="atmosphere"?et.renderPass==="offscreen"?g.needsSkyboxCapture(et)&&(function(yt,vt,Mt,Et){const Lt=yt.context,Ft=Lt.gl;let Ot=vt.skyboxFbo;if(!Ot){Ot=vt.skyboxFbo=Lt.createFramebuffer(32,32,!0,null),vt.skyboxGeometry=new Rv(Lt),vt.skyboxTexture=Lt.gl.createTexture(),Ft.bindTexture(Ft.TEXTURE_CUBE_MAP,vt.skyboxTexture),Ft.texParameteri(Ft.TEXTURE_CUBE_MAP,Ft.TEXTURE_WRAP_S,Ft.CLAMP_TO_EDGE),Ft.texParameteri(Ft.TEXTURE_CUBE_MAP,Ft.TEXTURE_WRAP_T,Ft.CLAMP_TO_EDGE),Ft.texParameteri(Ft.TEXTURE_CUBE_MAP,Ft.TEXTURE_MIN_FILTER,Ft.LINEAR),Ft.texParameteri(Ft.TEXTURE_CUBE_MAP,Ft.TEXTURE_MAG_FILTER,Ft.LINEAR);for(let tr=0;tr<6;++tr)Ft.texImage2D(Ft.TEXTURE_CUBE_MAP_POSITIVE_X+tr,0,Ft.RGBA,32,32,0,Ft.RGBA,Ft.UNSIGNED_BYTE,null)}Lt.bindFramebuffer.set(Ot.framebuffer),Lt.viewport.set([0,0,32,32]);const qt=vt.getCenter(yt,!0),$t=yt.getOrCreateProgram("skyboxCapture"),Yt=new Float64Array(16);h.bA(Yt),h.ek(Yt,Yt,.5*-Math.PI),Gm(yt,vt,$t,Yt,qt,0),h.bA(Yt),h.ek(Yt,Yt,.5*Math.PI),Gm(yt,vt,$t,Yt,qt,1),h.bA(Yt),h.cT(Yt,Yt,.5*-Math.PI),Gm(yt,vt,$t,Yt,qt,2),h.bA(Yt),h.cT(Yt,Yt,.5*Math.PI),Gm(yt,vt,$t,Yt,qt,3),h.bA(Yt),Gm(yt,vt,$t,Yt,qt,4),h.bA(Yt),h.ek(Yt,Yt,Math.PI),Gm(yt,vt,$t,Yt,qt,5),Lt.viewport.set([0,0,yt.width,yt.height])}(et,g),g.markSkyboxValid(et)):et.renderPass==="sky"&&function(yt,vt,Mt,Et,Lt){const Ft=yt.context,Ot=Ft.gl,qt=yt.transform,$t=yt.getOrCreateProgram("skybox");Ft.activeTexture.set(Ot.TEXTURE0),Ot.bindTexture(Ot.TEXTURE_CUBE_MAP,vt.skyboxTexture);const Yt=((tr,sr,pr,hr,gr)=>({u_matrix:tr,u_sun_direction:sr,u_cubemap:0,u_opacity:hr,u_temporal_offset:gr}))(qt.skyboxMatrix,vt.getCenter(yt,!1),0,Et,Lt);yt.uploadCommonUniforms(Ft,$t),$t.draw(yt,Ot.TRIANGLES,Mt,Vn.disabled,yt.colorModeForRenderPass(),ts.backCW,Yt,"skybox",vt.skyboxGeometry.vertexBuffer,vt.skyboxGeometry.indexBuffer,vt.skyboxGeometry.segment)}(et,g,ut,nt,pt):lt==="gradient"&&et.renderPass==="sky"&&function(yt,vt,Mt,Et,Lt){const Ft=yt.context,Ot=Ft.gl,qt=yt.transform,$t=yt.getOrCreateProgram("skyboxGradient");vt.skyboxGeometry||(vt.skyboxGeometry=new Rv(Ft)),Ft.activeTexture.set(Ot.TEXTURE0);let Yt=vt.colorRampTexture;Yt||(Yt=vt.colorRampTexture=new h.T(Ft,vt.colorRamp,Ot.RGBA8)),Yt.bind(Ot.LINEAR,Ot.CLAMP_TO_EDGE);const tr=((sr,pr,hr,gr,dr)=>({u_matrix:sr,u_color_ramp:0,u_center_direction:pr,u_radius:h.an(hr),u_opacity:gr,u_temporal_offset:dr}))(qt.skyboxMatrix,vt.getCenter(yt,!1),vt.paint.get("sky-gradient-radius"),Et,Lt);yt.uploadCommonUniforms(Ft,$t),$t.draw(yt,Ot.TRIANGLES,Mt,Vn.disabled,yt.colorModeForRenderPass(),ts.backCW,tr,"skyboxGradient",vt.skyboxGeometry.vertexBuffer,vt.skyboxGeometry.indexBuffer,vt.skyboxGeometry.segment)}(et,g,ut,nt,pt)},custom:function(et,o,g,_e){const nt=et.context,st=g.implementation;if(!et.transform.projection.unsupportedLayers||!et.transform.projection.unsupportedLayers.includes("custom")||et.terrain&&(et.terrain.renderingToTexture||et.renderPass==="offscreen")&&g.isDraped(o)){if(et.renderPass==="offscreen"){const lt=st.prerender;if(lt){if(et.setCustomLayerDefaults(),nt.setColorMode(et.colorModeForRenderPass()),et.transform.projection.name==="globe"){const ut=et.transform.pointMerc;lt.call(st,nt.gl,et.transform.customLayerMatrix(),et.transform.getProjection(),et.transform.globeToMercatorMatrix(),h.aj(et.transform.zoom),[ut.x,ut.y],et.transform.pixelsPerMeterRatio)}else lt.call(st,nt.gl,et.transform.customLayerMatrix());nt.setDirty(),et.setBaseState()}}else if(et.renderPass==="translucent"){if(et.terrain&&et.terrain.renderingToTexture){const ut=st.renderToTile;if(ut){const pt=_e[0].canonical,yt={x:pt.x+_e[0].wrap*(st.wrapTileId?0:1<<pt.z),y:pt.y,z:pt.z};nt.setDepthMode(fn.disabled),nt.setStencilMode(Vn.disabled),nt.setColorMode(et.colorModeForRenderPass()),et.setCustomLayerDefaults(),ut.call(st,nt.gl,yt),nt.setDirty(),et.setBaseState()}return}et.setCustomLayerDefaults(),nt.setColorMode(et.colorModeForRenderPass()),nt.setStencilMode(Vn.disabled);const lt=st.renderingMode==="3d"?new fn(et.context.gl.LEQUAL,fn.ReadWrite,et.depthRangeFor3D):et.depthModeForSublayer(0,fn.ReadOnly);if(nt.setDepthMode(lt),et.transform.projection.name==="globe"){const ut=et.transform.pointMerc;st.render(nt.gl,et.transform.customLayerMatrix(),et.transform.getProjection(),et.transform.globeToMercatorMatrix(),h.aj(et.transform.zoom),[ut.x,ut.y],et.transform.pixelsPerMeterRatio)}else st.render(nt.gl,et.transform.customLayerMatrix());nt.setDirty(),et.setBaseState(),nt.bindFramebuffer.set(null)}}else h.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(et,o,g,_e){if(et.renderPass==="opaque")return;const nt=g.paint.get("model-opacity").constantOr(1);if(nt===0)return;const st=g.paint.get("model-cast-shadows");if(et.renderPass==="shadow"&&(!st||et.terrain&&nt<.65&&g._transitionablePaint._values["model-opacity"].value.expression instanceof h.ad))return;const lt=et.shadowRenderer,ut=g.paint.get("model-receive-shadows");lt&&(lt.useNormalOffset=!0,ut||(lt.enabled=!1));const pt=()=>{lt&&(lt.useNormalOffset=!0,ut||(lt.enabled=!0))},yt=o.getSource();if(et.renderPass==="light-beam"&&yt.type!=="batched-model")return;if(yt.type==="vector"||yt.type==="geojson")return function($t,Yt,tr,sr,pr){const hr=$t.transform;if(hr.projection.name!=="mercator")return void h.w(`Drawing 3D models for ${hr.projection.name} projection is not yet implemented`);const gr=hr.getFreeCameraOptions().position;if(!$t.modelManager)return;const dr=$t.modelManager;tr.modelManager=dr;const ur=$t.shadowRenderer;if(!tr._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const yr=tr._unevaluatedLayout._values["model-id"],Vr=Object.assign({},tr.layout.get("model-id").parameters),Ir=$t.style.order.indexOf(tr.fqid);for(const Qr of sr){const Nr=Yt.getTile(Qr).getBucket(tr);if(!Nr||Nr.projection.name!==hr.projection.name)continue;const Yr=Nr.getModelUris();Yr&&!Nr.modelsRequested&&(dr.addModelsFromBucket(Yr,pr),Nr.modelsRequested=!0);const Cn=Py(Qr,hr);Vr.zoom=Cn;const Br=yr.possiblyEvaluate(Vr);if(J0($t,Nr,Qr),op.shadowUniformsInitialized=!1,op.useSingleShadowCascade=!!ur&&ur.getMaxCascadeForTile(Qr.toUnwrapped())===0,$t.renderPass==="shadow"&&ur){if($t.currentShadowCascade===1&&Nr.isInsideFirstShadowMapFrustum)continue;const Hr=hr.calculatePosMatrix(Qr.toUnwrapped(),hr.worldSize);if(op.tileMatrix.set(Hr),op.shadowTileMatrix=Float32Array.from(ur.calculateShadowPassMatrixFromMatrix(Hr)),op.aabb.min=[0,0,0],op.aabb.max[0]=op.aabb.max[1]=h.al,op.aabb.max[2]=0,t1(Nr,op,$t,tr.scope))continue}const Tr=1<<Qr.canonical.z,en=[((gr.x-Qr.wrap)*Tr-Qr.canonical.x)*h.al,(gr.y*Tr-Qr.canonical.y)*h.al,gr.z*Tr*h.al];$t.conflationActive&&Object.keys(Nr.instancesPerModel).length>0&&$t.style.isLayerClipped(tr,Yt.getSource())&&Nr.updateReplacement(Qr,$t.replacementSource,Ir,pr)&&(Nr.uploaded=!1,Nr.upload($t.context));for(let Hr in Nr.instancesPerModel){const un=Nr.instancesPerModel[Hr];un.features.length>0&&(Hr=Br.evaluate(un.features[0].feature,{}));const Tn=dr.getModel(Hr,pr);if(Tn||dr.hasURLBeenRequested(Hr)||Nr.modelUris.includes(Hr)||(Nr.modelUris.push(Hr),Nr.modelsRequested=!1),Tn&&Tn.uploaded)for(const Ln of Tn.nodes)e1($t,tr,Ln,un,en,Qr,op)}}}(et,o,g,_e,yt.type==="vector"?g.scope:""),void pt();if(!yt.loaded())return;if(yt.type==="batched-model")return function($t,Yt,tr,sr){tr.resetLayerRenderingStats($t);const pr=$t.context,hr=$t.transform,gr=$t.style.fog,dr=$t.shadowRenderer;if(hr.projection.name!=="mercator")return void h.w(`Drawing 3D landmark models for ${hr.projection.name} projection is not yet implemented`);const ur=$t.transform.getFreeCameraOptions().position,yr=h.c4([],[ur.x,ur.y,ur.z],$t.transform.worldSize),Vr=h.et([],yr),Ir=h.bA([]),Qr=h.ec(hr.center.lat,hr.zoom),Nr=h.bq([],[1,1,1/Qr]);h.br(Ir,Ir,Vr);const Yr=tr.paint.get("model-opacity").constantOr(1),Cn=new fn(pr.gl.LEQUAL,fn.ReadWrite,$t.depthRangeFor3D),Br=new fn(pr.gl.LEQUAL,fn.ReadOnly,$t.depthRangeFor3D),Tr=new h.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),en=$t.renderPass==="shadow",Hr=en&&dr?dr.getCurrentCascadeFrustum():hr.getFrustum(hr.scaleZoom(hr.worldSize)),un=tr.paint.get("model-front-cutoff"),Tn=un[2]<1,Ln=Fu($t,tr.paint.get("model-cutoff-fade-range")),xn=tr.getLayerRenderingStats();(function(mn,Xn,Gn,Wn){const Un=mn.terrain?mn.terrain.exaggeration():0,hs=mn.transform.zoom;for(const vs of Wn){const Ts=Xn.getTile(vs).getBucket(Gn);Ts&&(Ts.setFilter(Gn.filter),mn.conflationActive&&Ts.updateReplacement(vs,mn.replacementSource),Ts.evaluateTransform(mn,Gn),mn.terrain&&Un>0&&Ts.elevationUpdate(mn.terrain,Un,vs,Gn.source),Ts.needsReEvaluation(mn,hs,Gn)&&Ts.evaluate(Gn))}})($t,Yt,tr,sr),function(){let mn,Xn,Gn;Tn?(mn=sr.length-1,Xn=-1,Gn=-1):(mn=0,Xn=sr.length,Gn=1);const Wn=new Float64Array(16),Un=h.cz(),hs=new h.P(0,0);for(let vs=mn;vs!==Xn;vs+=Gn){const Ts=sr[vs],no=Yt.getTile(Ts).getBucket(tr);if(!no||!no.uploaded)continue;let fs=!1;dr&&(fs=dr.getMaxCascadeForTile(Ts.toUnwrapped())===0);const qs=hr.calculatePosMatrix(Ts.toUnwrapped(),hr.worldSize),io=no.modelTraits;!en&&Tn&&(h.bl(Wn,qs),h.af(Un,yr,Wn),hs.x=Un[0],hs.y=Un[1]);const Ao=[];no.setFilter(tr.filter);for(const bs of no.getNodesInfo()){if(bs.hiddenByReplacement||!bs.node.meshes)continue;const Qs=bs.node;let Xs=0;$t.terrain&&Qs.elevation&&(Xs=Qs.elevation*$t.terrain.exaggeration());const to=(()=>{const Wl=bs.aabb;return Tr.min=[...Wl.min],Tr.max=[...Wl.max],Tr.min[2]+=Xs,Tr.max[2]+=Xs,h.af(Tr.min,Tr.min,qs),h.af(Tr.max,Tr.max,qs),Tr})(),ko=bs.evaluatedScale;if(ko[0]<=1&&ko[1]<=1&&ko[2]<=1&&to.intersects(Hr)===0)continue;if(!en&&Tn){const Wl=.16666666666666666;bs.cameraCollisionOpacity=yr[0]>to.min[0]&&yr[0]<to.max[0]&&yr[1]>to.min[1]&&yr[1]<to.max[1]&&yr[2]*Qr<to.max[2]&&Qs.footprint&&h.b$(hs,Qs.footprint)?Math.max(bs.cameraCollisionOpacity-Wl,0):Math.min(1,bs.cameraCollisionOpacity+Wl)}const Ko=[...qs],zl=1/h.d6(Ts.canonical),Do=Qs.anchor?Qs.anchor[0]:0,Ss=Qs.anchor?Qs.anchor[1]:0;h.br(Ko,Ko,[Do*(ko[0]-1)+bs.evaluatedTranslation[0]*zl,Ss*(ko[1]-1)+bs.evaluatedTranslation[1]*zl,Xs+bs.evaluatedTranslation[2]]),h.cp(ko,h.ev)||h.cR(Ko,Ko,ko);const cs=h.aB([],Ko,Qs.matrix),so=h.aB([],hr.expandedFarZProjMatrix,cs),Ho=h.aB([],hr.expandedFarZProjMatrix,Ko),Fo=h.aC([],[Do,Ss,Xs,1],so)[2];Qs.hidden=!1;let yl=Yr;en||(Tn&&(yl*=bs.cameraCollisionOpacity,yl*=Pv(Ko,hr,bs.aabb,un)),yl*=gx(Ln,Fo)),yl!==0?Ao.push({nodeInfo:bs,depth:Fo,opacity:yl,wvpForNode:so,wvpForTile:Ho,nodeModelMatrix:cs,tileModelMatrix:Ko}):Qs.hidden=!0}en||Ao.sort((bs,Qs)=>!Tn||bs.opacity===1&&Qs.opacity===1?bs.depth<Qs.depth?-1:1:bs.opacity===1?-1:Qs.opacity===1?1:bs.depth>Qs.depth?-1:1);for(const bs of Ao){const Qs=bs.nodeInfo,Xs=Qs.node;let to=h.aB([],Nr,bs.tileModelMatrix);h.aB(to,Ir,to);const ko=h.bl([],to);h.ed(ko,ko),h.cR(ko,ko,Bw),to=h.aB(to,to,Xs.matrix);const Ko=$t.renderPass==="light-beam",zl=tr.paint.get("model-color-use-theme").constantOr("default")==="none",Do=io&h.ez.HasMapboxMeshFeatures,Ss=Do?0:Qs.evaluatedRMEA[0][2];for(let cs=0;cs<Xs.meshes.length;++cs){const so=Xs.meshes[cs],Ho=cs===Xs.lightMeshIndex;let Fo=bs.wvpForNode;if(Ho){if(!Ko&&!$t.terrain&&$t.shadowRenderer){$t.currentLayer<$t.firstLightBeamLayer&&($t.firstLightBeamLayer=$t.currentLayer);continue}Fo=bs.wvpForTile}else if(Ko)continue;const yl={defines:[]},Wl=[];if(!en&&dr&&(dr.useNormalOffset=!!so.normalBuffer),fx(yl.defines,Wl,so,$t,zl?null:tr.lut),Do||yl.defines.push("DIFFUSE_SHADED"),fs&&yl.defines.push("SHADOWS_SINGLE_CASCADE"),xn&&(en?xn.numRenderedVerticesInShadowPass+=so.vertexArray.length:xn.numRenderedVerticesInTransparentPass+=so.vertexArray.length),en){c_(so,bs.nodeModelMatrix,$t,tr);continue}let Bu=null;if(gr){const cp=jr(bs.nodeModelMatrix,$t.transform);if(Bu=new Float32Array(cp),hr.projection.name!=="globe"){const Zo=so.aabb.min,Yo=so.aabb.max,[Oo,Cl]=gr.getOpacityForBounds(cp,Zo[0],Zo[1],Yo[0],Yo[1]);yl.overrideFog=Oo>=Hn||Cl>=Hn}}const Vu=so.material;let Au;Vu.occlusionTexture&&Vu.occlusionTexture.offsetScale&&(Au=Vu.occlusionTexture.offsetScale,yl.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ru=$t.getOrCreateProgram("model",yl);!en&&dr&&dr.setupShadowsFromMatrix(bs.tileModelMatrix,Ru,dr.useNormalOffset),$t.uploadCommonUniforms(pr,Ru,null,Bu);const du=Vu.pbrMetallicRoughness;du.metallicFactor=.9,du.roughnessFactor=.5;const Ju=rx(new Float32Array(Fo),new Float32Array(to),new Float32Array(ko),new Float32Array(Xs.matrix),$t,bs.opacity,du.baseColorFactor,Vu.emissiveFactor,du.metallicFactor,du.roughnessFactor,Vu,Ss,tr,[0,0,0],Au);!Ho&&(Qs.hasTranslucentParts||bs.opacity<1)&&Ru.draw($t,pr.gl.TRIANGLES,Cn,Vn.disabled,Pn.disabled,ts.backCCW,Ju,tr.id,so.vertexBuffer,so.indexBuffer,so.segments,tr.paint,$t.transform.zoom,void 0,Wl),Ru.draw($t,pr.gl.TRIANGLES,Ho?Br:Cn,Vn.disabled,Ho||bs.opacity<1||Qs.hasTranslucentParts?Pn.alphaBlended:Pn.unblended,ts.backCCW,Ju,tr.id,so.vertexBuffer,so.indexBuffer,so.segments,tr.paint,$t.transform.zoom,void 0,Wl)}}}}()}(et,o,g,_e),void pt();if(yt.type!=="model")return;const vt=yt.getModels(),Mt=[],Et=et.transform.getFreeCameraOptions().position,Lt=h.c4([],[Et.x,Et.y,Et.z],et.transform.worldSize);h.et(Lt,Lt);const Ft=[],Ot=[];let qt=0;for(const $t of vt){const Yt=g.paint.get("model-rotation").constantOr(null),tr=g.paint.get("model-scale").constantOr(null),sr=g.paint.get("model-translation").constantOr(null);$t.computeModelMatrix(et,Yt,tr,sr,!0,!0,!1);const pr=h.bA([]),hr=h.ec($t.position.lat,et.transform.zoom),gr=h.bq([],[1,1,1/hr]);h.br(pr,pr,Lt),Mt.push({zScaleMatrix:gr,negCameraPosMatrix:pr});for(const dr of $t.nodes)mx(et.transform,dr,$t.matrix,et.transform.expandedFarZProjMatrix,qt,Ft,Ot);qt++}if(Ft.sort(($t,Yt)=>Yt.depth-$t.depth),et.renderPass!=="shadow"){if(nt===1)for(const $t of Ot)Wm($t,et,g,Mt[$t.modelIndex],Vn.disabled,et.colorModeForRenderPass());else{for(const $t of Ot)Wm($t,et,g,Mt[$t.modelIndex],Vn.disabled,Pn.disabled);for(const $t of Ot)Wm($t,et,g,Mt[$t.modelIndex],et.stencilModeFor3D(),et.colorModeForRenderPass());et.resetStencilClippingMasks()}for(const $t of Ft)Wm($t,et,g,Mt[$t.modelIndex],Vn.disabled,et.colorModeForRenderPass());pt()}else{for(const $t of Ot)c_($t.mesh,$t.nodeModelMatrix,et,g);for(const $t of Ft)c_($t.mesh,$t.nodeModelMatrix,et,g);pt()}}},qm={line:function(et,o,g){if(et.hasElevatedBuckets=!1,et.hasNonElevatedBuckets=!1,et._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||et._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){const _e=o.getVisibleCoordinates();for(const nt of _e){const st=o.getTile(nt).getBucket(et);if(st&&(st.elevationType!=="none"?et.hasElevatedBuckets=!0:et.hasNonElevatedBuckets=!0,et.hasElevatedBuckets&&et.hasNonElevatedBuckets))break}}}else et.hasNonElevatedBuckets=!0},model:function(et,o,g){const _e=o.getSource();if(!_e.loaded())return;if(_e.type==="vector"||_e.type==="geojson")return void(g.modelManager&&g.modelManager.upload(g,_e.type==="vector"?et.scope:""));if(_e.type==="batched-model"||_e.type!=="model")return;const nt=_e.getModels();for(const st of nt)st.upload(g.context)},raster:function(et,o,g){const _e=o.getSource();if(!(_e instanceof ip&&_e.loaded()))return;const nt=et.sourceLayer||_e.rasterLayerIds&&_e.rasterLayerIds[0];if(!nt)return;const st=et.paint.get("raster-array-band")||_e.getInitialBand(nt);if(st==null)return;const lt=o.getIds().map(ut=>o.getTileByID(ut));for(const ut of lt)ut.updateNeeded(et.id,st)&&_e.prepareTile(ut,nt,et.id,st)},"raster-particle":function(et,o,g){const _e=o.getSource();if(!(_e instanceof ip&&_e.loaded()))return;const nt=et.sourceLayer||_e.rasterLayerIds&&_e.rasterLayerIds[0];if(!nt)return;const st=et.paint.get("raster-particle-array-band")||_e.getInitialBand(nt);if(st==null)return;const lt=o.getIds().map(ut=>o.getTileByID(ut));for(const ut of lt)ut.updateNeeded(et.id,st)&&_e.prepareTile(ut,nt,et.id,st)}},Zm={fill:Bm},ym={fill:function(et,o,g,_e){if(!g.layout||g.layout.get("fill-elevation-reference")==="none")return;const nt=et.context.gl,st=new fn(nt.LEQUAL,fn.ReadOnly,et.depthRangeFor3D),lt=new Vn({func:nt.ALWAYS,mask:255},255,255,nt.KEEP,nt.KEEP,nt.REPLACE),ut=et.transform.getFreeCameraOptions().position,pt=et.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const yt of _e){const vt=o.getTile(yt),Mt=vt.getBucket(g);if(!Mt)continue;const Et=Mt.elevatedStructures;if(!Et||Et.depthSegments.segments[0].primitiveLength===0)continue;const Lt=Z0(yt.toUnwrapped(),ut),Ft=et.translatePosMatrix(yt.projMatrix,vt,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor")),Ot=Q_(Ft,Lt,0,1,0);pt.draw(et,nt.TRIANGLES,st,lt,Pn.disabled,ts.disabled,Ot,g.id,Et.vertexBuffer,Et.indexBuffer,Et.depthSegments,g.paint,et.transform.zoom)}}};class Mv{constructor(o,g,_e,nt,st,lt){this.context=new vv(o,g),this.transform=_e,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=st,this._timeStamp=h.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const ut=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const yt of ut)this._debugParams.enabledLayers[yt]=!0;st.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),st.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),st.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),st.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),st.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),st.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const yt of ut)st.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],yt);this.occlusionParams=new yx(st),this.setup(),this.numSublayers=ou.maxUnderzooming+ou.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new h.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new pw(this),this._wireframeDebugCache=new r1,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const pt=new h.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new h.T(this.context,pt,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=nt,this.worldview=lt}updateTerrain(o,g){const _e=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(_e||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new n_(this,o));const nt=this._terrain;this.transform.elevation=_e?nt:null,nt.update(o,this.transform,g),this.transform.elevation&&!nt.enabled&&(this.transform.elevation=null)}_updateFog(o){const g=o.fog;if(!g||this.transform.projection.name==="globe"||g.getOpacity(this.transform.pitch)<1||g.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_e,nt]=g.getFovAdjustedRange(this.transform._fov);if(_e>nt)return void(this.transform.fogCullDistSq=null);const st=_e+.78*(nt-_e);this.transform.fogCullDistSq=st*st}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new n_(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,g){if(this.width=o*h.o.devicePixelRatio,this.height=g*h.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _e of this.style.order)this.style._mergedLayers[_e].resize()}setup(){const o=this.context,g=new h.bd;g.emplaceBack(0,0),g.emplaceBack(h.al,0),g.emplaceBack(0,h.al),g.emplaceBack(h.al,h.al),this.tileExtentBuffer=o.createVertexBuffer(g,h.bf.members),this.tileExtentSegments=h.bg.simpleSegment(0,0,4,2);const _e=new h.bd;_e.emplaceBack(0,0),_e.emplaceBack(h.al,0),_e.emplaceBack(0,h.al),_e.emplaceBack(h.al,h.al),this.debugBuffer=o.createVertexBuffer(_e,h.bf.members),this.debugSegments=h.bg.simpleSegment(0,0,4,5);const nt=new h.bd;nt.emplaceBack(-1,-1),nt.emplaceBack(1,-1),nt.emplaceBack(-1,1),nt.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(nt,h.bf.members),this.viewportSegments=h.bg.simpleSegment(0,0,4,2);const st=new h.b0;st.emplaceBack(0,0,0,0),st.emplaceBack(h.al,0,h.al,0),st.emplaceBack(0,h.al,0,h.al),st.emplaceBack(h.al,h.al,h.al,h.al),this.mercatorBoundsBuffer=o.createVertexBuffer(st,h.bi.members),this.mercatorBoundsSegments=h.bg.simpleSegment(0,0,4,2);const lt=new h.b1;lt.emplaceBack(0,1,2),lt.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(lt);const ut=new h.be;for(const yt of[0,1,3,2,0])ut.emplaceBack(yt);this.debugIndexBuffer=o.createIndexBuffer(ut),this.emptyTexture=new h.T(o,new h.q({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=h.bC();const pt=this.context.gl;this.stencilClearMode=new Vn({func:pt.ALWAYS,mask:0},0,255,pt.ZERO,pt.ZERO,pt.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,fn.disabled,this.stencilClearMode,Pn.disabled,ts.disabled,jm(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,g,_e){if(!g||this.currentStencilSource===g.id||!o.isTileClipped()||!_e||_e.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let ut=!1;for(const pt of _e)if(this._tileClippingMaskIDs[pt.key]===void 0){ut=!0;break}if(!ut)return}this.currentStencilSource=g.id;const nt=this.context,st=nt.gl;this.nextStencilID+_e.length>256&&this.clearStencil(),nt.setColorMode(Pn.disabled),nt.setDepthMode(fn.disabled);const lt=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const ut of _e){const pt=g.getTile(ut),yt=this._tileClippingMaskIDs[ut.key]=this.nextStencilID++,{tileBoundsBuffer:vt,tileBoundsIndexBuffer:Mt,tileBoundsSegments:Et}=this.getTileBoundsBuffers(pt);lt.draw(this,st.TRIANGLES,fn.disabled,new Vn({func:st.ALWAYS,mask:0},yt,255,st.KEEP,st.KEEP,st.REPLACE),Pn.disabled,ts.disabled,jm(ut.projMatrix),"$clipping",vt,Mt,Et)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,g=this.context.gl;return new Vn({func:g.NOTEQUAL,mask:255},o,255,g.KEEP,g.KEEP,g.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const g=this.context.gl;return new Vn({func:g.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,g.KEEP,g.KEEP,g.REPLACE)}stencilConfigForOverlap(o){const g=this.context.gl,_e=o.sort((lt,ut)=>ut.overscaledZ-lt.overscaledZ),nt=_e[_e.length-1].overscaledZ,st=_e[0].overscaledZ-nt+1;if(st>1){this.currentStencilSource=void 0,this.nextStencilID+st>256&&this.clearStencil();const lt={};for(let ut=0;ut<st;ut++)lt[ut+nt]=new Vn({func:g.GEQUAL,mask:255},ut+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=st,[lt,_e]}return[{[nt]:Vn.disabled},_e]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Pn([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new h.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Pn.unblended:Pn.alphaBlended}colorModeForDrapableLayerRenderPass(o){const g=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&this.renderPass==="translucent"?new Pn([g.ONE,g.ONE_MINUS_SRC_ALPHA,g.CONSTANT_ALPHA,g.ONE_MINUS_SRC_ALPHA],new h.ao(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,g,_e,nt=!1){if(this.depthOcclusion)return new fn(this.context.gl.GREATER,fn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!nt)return fn.disabled;const st=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new fn(_e||this.context.gl.LEQUAL,g,[st,st])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const o=this.context.gl,g=Math.ceil(this.width),_e=Math.ceil(this.height),nt=this.context.bindFramebuffer.get(),st=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===g&&this.depthFBO.height===_e||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),g!==0&&_e!==0&&(this.depthFBO=new nx(this.context,g,_e,!1,"texture"),this.depthTexture=new h.T(this.context,{width:g,height:_e,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(nt),o.bindTexture(o.TEXTURE_2D,st),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,g,_e,0,0,g,_e,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,g)=>o+g/this._fpsHistory.length,0))}render(o,g){const _e=h.o.now();this._dt=_e-this._timeStamp,this._timeStamp=_e,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=g;const nt=this.style._mergedLayers,st=!(!this.terrain||!this.terrain.enabled),lt=()=>this.style._getOrder(st).filter(Br=>{const Tr=nt[Br];return!(Tr.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Tr.type]});let ut=lt(),pt=!1,yt=!1,vt=null;for(const Br of ut){const Tr=nt[Br];Tr.type==="circle"?pt=!0:Tr.type==="building"?vt=Tr:Tr.type==="symbol"&&(Tr.hasOcclusionOpacityProperties?yt=!0:pt=!0)}let Mt=ut.map(Br=>nt[Br]);const Et=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(h.o.now()),this.imageManager.beginFrame();let Lt=0,Ft=!1;for(const Br in Et){const Tr=Et[Br];Tr.used&&(Tr.prepare(this.context),Tr.getSource().usedInConflation&&++Lt)}let Ot=!1;for(const Br of Mt)Br.isHidden(this.transform.zoom)||(Br.type==="clip"&&(Ot=!0),this.prepareLayer(Br));const qt={},$t={},Yt={},tr={},sr={};for(const Br in Et){const Tr=Et[Br];qt[Br]=Tr.getVisibleCoordinates(),$t[Br]=qt[Br].slice().reverse(),Yt[Br]=Tr.getVisibleCoordinates(!0).reverse(),tr[Br]=Tr.getShadowCasterCoordinates(),sr[Br]=Tr.sortCoordinatesByDistance(qt[Br])}const pr=Br=>{const Tr=this.style.getLayerSourceCache(Br);return Tr&&Tr.used?Tr.getSource():null};if(Lt||Ot||this._clippingActiveLastFrame){const Br=[],Tr=[];let en=0;for(const Hr of Mt)this.isSourceForClippingOrConflation(Hr,pr(Hr))&&(Br.push(Hr),Tr.push(en)),en++;if(Br&&(Ot||Br.length>1)||this._clippingActiveLastFrame){Ot=!1;const Hr=[];for(let un=0;un<Br.length;un++){const Tn=Br[un],Ln=Tr[un],xn=this.style.getLayerSourceCache(Tn);if(!xn||!xn.used||!xn.getSource().usedInConflation&&Tn.type!=="clip"&&Tn.type!=="building")continue;let mn=h.eH,Xn=h.bZ.None;const Gn=[];let Wn=!0;if(Tn.type==="building")mn=h.eJ;else if(Tn.type==="clip"){mn=Ln;for(const Un of Tn.layout.get("clip-layer-types"))Xn|=Un==="model"?h.bZ.Model:Un==="symbol"?h.bZ.Symbol:h.bZ.FillExtrusion;for(const Un of Tn.layout.get("clip-layer-scope"))Gn.push(Un);Tn.isHidden(this.transform.zoom)?Wn=!1:Ot=!0}Wn&&Hr.push({layer:Tn.fqid,cache:xn,order:mn,clipMask:Xn,clipScope:Gn})}this.replacementSource.setSources(Hr),Ft=!0}}this._clippingActiveLastFrame=Ot,Ft||this.replacementSource.clear(),this.conflationActive=Ft,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Br=0;Br<Mt.length;Br++){const Tr=Mt[Br],en=Tr.cutoffRange();if(this.longestCutoffRange=Math.max(en,this.longestCutoffRange),en>0){const Hr=pr(Tr);Hr&&(this.minCutoffZoom=Math.max(Hr.minzoom,this.minCutoffZoom)),Tr.minzoom&&(this.minCutoffZoom=Math.max(Tr.minzoom,this.minCutoffZoom))}Tr.is3D(st)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Br),this._lastOcclusionLayer=Br)}const hr=this.style&&this.style.fog;hr?(this._fogVisible=hr.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=hr.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Yt),this.opaquePassCutoff=0,ut=lt(),Mt=ut.map(Br=>nt[Br]));const gr=this._shadowRenderer;if(gr){gr.updateShadowParameters(this.transform,this.style.directionalLight);for(const Br in Et)for(const Tr of qt[Br]){let en={min:0,max:0};this.terrain&&(en=this.terrain.getMinMaxForTile(Tr)||en),gr.addShadowReceiver(Tr.toUnwrapped(),en.min,en.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new h.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ry(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const dr=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ur=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(dr&&!this._snow&&(this._snow=new a1(this)),!dr&&this._snow&&(this._snow.destroy(),delete this._snow),ur&&!this._rain&&(this._rain=new Co(this)),!ur&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),vt){this.buildingTileBorderManager||(this.buildingTileBorderManager=new $o);const Br=this.style.getLayerSourceCache(vt);this.buildingTileBorderManager.updateBorders(Br,vt)}if(!bo.has(this.context.gl))return;this.renderPass="offscreen";for(const Br of Mt){const Tr=o.getLayerSourceCache(Br);if(!Br.hasOffscreenPass()||Br.isHidden(this.transform.zoom))continue;const en=Tr?$t[Tr.id]:void 0;(Br.type==="custom"||Br.type==="raster"||Br.type==="raster-particle"||Br.isSky()||en&&en.length)&&this.renderLayer(this,Tr,Br,en)}this.depthRangeFor3D=[0,1-(Mt.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,tr)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const yr=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Vr=(()=>{if(g.showOverdrawInspector)return h.ao.black;const Br=this.style.fog;if(Br&&this.transform.projection.supportsFog){const Tr=this.style.getLut(Br.scope);if(!yr){const en=Br.properties.get("color-use-theme")==="none",Hr=Br.properties.get("color").toNonPremultipliedRenderColor(en?null:Tr).toArray01();return new h.ao(...Hr)}if(yr){const en=Br.properties.get("space-color-use-theme")==="none",Hr=Br.properties.get("space-color").toNonPremultipliedRenderColor(en?null:Tr).toArray01();return new h.ao(...Hr)}}return h.ao.transparent})();if(this.context.clear({color:Vr,depth:1}),this.clearStencil(),this._showOverdrawInspector=g.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&yr&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=ut.length-1;this.currentLayer>=0;this.currentLayer--){const Br=Mt[this.currentLayer],Tr=o.getLayerSourceCache(Br);if(Br.isSky())continue;const en=Tr?(Br.is3D(st)?sr:$t)[Tr.id]:void 0;this._renderTileClippingMasks(Br,Tr,en),this.renderLayer(this,Tr,Br,en)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&yr&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||h.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<ut.length;this.currentLayer++){const Br=Mt[this.currentLayer],Tr=o.getLayerSourceCache(Br);Br.isSky()&&this.renderLayer(this,Tr,Br,Tr?$t[Tr.id]:void 0)}function Ir(Br,Tr){let en;return Tr&&(en=(Br.type==="symbol"?Yt:Br.is3D(st)?sr:$t)[Tr.id]),en}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<ut.length;){const Br=Mt[this.currentLayer];if(Br.type==="raster"||Br.type==="raster-particle"){const Tr=o.getLayerSourceCache(Br);this.renderLayer(this,Tr,Br,Ir(Br,Tr))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Qr=0;gr&&(Qr=gr.getShadowCastingLayerCount());let Nr=!1,Yr=-1;for(let Br=0;Br<ut.length;++Br){const Tr=Mt[Br];Tr.isHidden(this.transform.zoom)||Tr.is3D(st)&&(Yr=Br)}yt&&Yr===-1&&(pt=!0);let Cn=!1;for(;this.currentLayer<ut.length;){const Br=Mt[this.currentLayer],Tr=o.getLayerSourceCache(Br);if(Br.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Br)){if(Br.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Cn&&Br.is3D(st)&&!st){const en=this.currentLayer,Hr=un=>{for(this.currentLayer=0;this.currentLayer<Mt.length;this.currentLayer++){const Tn=Mt[this.currentLayer];if(Zm[Tn.type]){const Ln=this.style.getLayerSourceCache(Tn);Zm[Tn.type](this,Ln,Tn,Ir(Tn,Ln),un)}}};Hr("initialize"),Hr("reset"),this.currentLayer=en,Cn=!0}if(pt&&!Nr&&this.terrain&&!this.transform.isOrthographic&&(Nr=!0,this.blitDepth()),yt&&Yr!==-1&&this.currentLayer===Yr+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Br,Tr,Tr?qt[Tr.id]:void 0),this.renderLayer(this,Tr,Br,Ir(Br,Tr)),!this.terrain&&gr&&Qr>0&&Br.hasShadowPass()&&--Qr==0){{this.clearStencil(),this.resetStencilClippingMasks();const en=this.currentLayer;for(this.currentLayer=0;this.currentLayer<Mt.length;this.currentLayer++){const Hr=Mt[this.currentLayer];if(ym[Hr.type]){const un=this.style.getLayerSourceCache(Hr);ym[Hr.type](this,un,Hr,Ir(Hr,un))}}this.currentLayer=en}if(gr.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const en=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=en;this.currentLayer++){const Hr=Mt[this.currentLayer];if(!Hr.hasLightBeamPass())continue;const un=o.getLayerSourceCache(Hr);this.renderLayer(this,un,Hr,un?$t[un.id]:void 0)}this.currentLayer=en,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const en=this.currentLayer;this.depthOcclusion=!0;for(const Hr of this.layersWithOcclusionOpacity){this.currentLayer=Hr;const un=Mt[this.currentLayer],Tn=o.getLayerSourceCache(un),Ln=Tn?$t[Tn.id]:void 0;this.terrain||this._renderTileClippingMasks(un,Tn,Tn?qt[Tn.id]:void 0),this.renderLayer(this,Tn,un,Ln)}this.depthOcclusion=!1,this.currentLayer=en,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Br=null;Mt.forEach(Tr=>{const en=o.getLayerSourceCache(Tr);en&&!Tr.isHidden(this.transform.zoom)&&en.getVisibleCoordinates().length&&(!Br||Br.getSource().maxzoom<en.getSource().maxzoom)&&(Br=en)}),Br&&this.options.showTileBoundaries&&dx(this,Br,Br.getVisibleCoordinates(),h.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&dx(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new h.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Br){const Tr=Br.transform.padding;vp(Br,Br.transform.height-(Tr.top||0),3,hu),vp(Br,Tr.bottom||0,3,fm),yo(Br,Tr.left||0,3,Y0),yo(Br,Br.transform.width-(Tr.right||0),3,Sv);const en=Br.transform.centerPoint;(function(Hr,un,Tn,Ln){Um(Hr,un-1,Tn-10,2,20,Ln),Um(Hr,un-10,Tn-1,20,2,Ln)})(Br,en.x,Br.transform.height-en.y,Cv)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Ft||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);const{unsupportedLayers:g}=this.transform.projection,_e=!g||!g.includes(o.type);if(qm[o.type]&&(_e||this.terrain&&o.type==="custom")){const nt=this.style.getLayerSourceCache(o);qm[o.type](o,nt,this)}this.gpuTimingEnd()}renderLayer(o,g,_e,nt){_e.isHidden(this.transform.zoom)||(_e.type==="background"||_e.type==="sky"||_e.type==="custom"||_e.type==="model"||_e.type==="raster"||_e.type==="raster-particle"||nt&&nt.length)&&(this.id=_e.id,this.gpuTimingStart(_e),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(_e.type)&&(!o.terrain||_e.type!=="custom")||_e.type==="clip"||gm[_e.type](o,g,_e,nt,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const g=this.context.extTimerQuery,_e=this.context.gl;let nt=this.gpuTimers[o.id];nt||(nt=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:_e.createQuery()}),nt.calls++,_e.beginQuery(g.TIME_ELAPSED_EXT,nt.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,g=this.context.gl,_e=g.createQuery();this.deferredRenderGpuTimeQueries.push(_e),g.beginQuery(o.TIME_ELAPSED_EXT,_e)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const g={};for(const _e in o){const nt=o[_e],st=this.context.extTimerQuery,lt=st.getQueryParameter(nt.query,this.context.gl.QUERY_RESULT)/1e6;st.deleteQueryEXT(nt.query),g[_e]=lt}return g}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const g=this.context.gl;let _e=0;for(const nt of o)_e+=g.getQueryParameter(nt,g.QUERY_RESULT)/1e6,g.deleteQuery(nt);return _e}translatePosMatrix(o,g,_e,nt,st){if(!_e[0]&&!_e[1])return o;const lt=st?nt==="map"?this.transform.angle:0:nt==="viewport"?-this.transform.angle:0;if(lt){const yt=Math.sin(lt),vt=Math.cos(lt);_e=[_e[0]*vt-_e[1]*yt,_e[0]*yt+_e[1]*vt]}const ut=[st?_e[0]:h.ay(g,_e[0],this.transform.zoom),st?_e[1]:h.ay(g,_e[1],this.transform.zoom),0],pt=new Float32Array(16);return h.br(pt,o,ut),pt}saveTileTexture(o){if(o.context!==this.context)return;const g=o.size[0],_e=this._tileTextures[g];_e?_e.push(o):this._tileTextures[g]=[o]}getTileTexture(o){const g=this._tileTextures[o];return g&&g.length>0?g.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,g,_e){const nt=_e===void 0?this.terrain&&this.terrain.renderingToTexture:_e,st=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(st.push("LIGHTING_3D_MODE"),st.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):nt||st.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||st.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(st.push("TERRAIN"),this.linearFloatFilteringSupported()&&st.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&st.push("GLOBE"),!this._fogVisible||nt||g!==void 0&&!g||st.push("FOG","FOG_DITHERING"),nt&&st.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&st.push("OVERDRAW_INSPECTOR"),st}getOrCreateProgram(o,g){this.cache=this.cache||{};const _e=g&&g.defines||[],nt=g&&g.config,st=this.currentGlobalDefines(o,g&&g.overrideFog,g&&g.overrideRtt).concat(_e),lt=Y_.cacheKey(z_[o],o,st,nt);return this.cache[lt]||(this.cache[lt]=new Y_(this.context,o,z_[o],nt,jw[o],st)),this.cache[lt]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,g){if(this.style.enable3dLights()){const _e=this.style.directionalLight,nt=this.style.ambientLight;if(_e&&nt){const st=((lt,ut,pt)=>{const yt=lt.properties.get("direction"),vt=lt.properties.get("color-use-theme")==="none",Mt=lt.properties.get("color").toNonPremultipliedRenderColor(vt?null:pt.getLut(lt.scope)).toArray01(),Et=lt.properties.get("intensity"),Lt=ut.properties.get("color-use-theme")==="none",Ft=ut.properties.get("color").toNonPremultipliedRenderColor(Lt?null:pt.getLut(ut.scope)).toArray01(),Ot=ut.properties.get("intensity"),qt=[yt.x,yt.y,yt.z],$t=h.dK(Ft,Ot),Yt=h.dK(Mt,Et);return{u_lighting_ambient_color:$t,u_lighting_directional_dir:qt,u_lighting_directional_color:Yt,u_ground_radiance:K_(qt,Yt,$t)}})(_e,nt,this.style);g.setLightsUniformValues(o,st)}}}uploadCommonUniforms(o,g,_e,nt,st){if(this.uploadCommonLightUniforms(o,g),this.terrain&&this.terrain.renderingToTexture)return;const lt=this.style.fog;if(lt){const ut=lt.getOpacity(this.transform.pitch),pt=((yt,vt,Mt,Et,Lt,Ft,Ot,qt,$t,Yt,tr,sr)=>{const pr=yt.transform,hr=vt.properties.get("color-use-theme")==="none",gr=vt.properties.get("color").toNonPremultipliedRenderColor(hr?null:yt.style.getLut(vt.scope)).toArray01();gr[3]=Et;const dr=yt.frameCounter/1e3%1,[ur,yr]=vt.properties.get("vertical-range");return{u_fog_matrix:Mt?pr.calculateFogTileMatrix(Mt):sr||yt.identityMat,u_fog_range:vt.getFovAdjustedRange(pr._fov),u_fog_color:gr,u_fog_horizon_blend:vt.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ur,yr),yr],u_fog_temporal_offset:dr,u_frustum_tl:Lt,u_frustum_tr:Ft,u_frustum_br:Ot,u_frustum_bl:qt,u_globe_pos:$t,u_globe_radius:Yt,u_viewport:tr,u_globe_transition:h.aj(pr.zoom),u_is_globe:+(pr.projection.name==="globe")}})(this,lt,_e,ut,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*h.o.devicePixelRatio,this.transform.height*h.o.devicePixelRatio],nt);g.setFogUniformValues(o,pt)}st&&g.setCutoffUniformValues(o,st.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,g=o.createTexture();return o.bindTexture(o.TEXTURE_2D,g),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),g}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,g=this._backgroundTiles={},_e=this.transform.coveringTiles({tileSize:512});for(const nt of _e)g[nt.key]=o[nt.key]||new mp(nt,512,this.transform.tileZoom,this,void 0,this.worldview);return g}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,g){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&o.type!=="building"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building"&&o.sourceLayer!=="procedural_buildings")&&(!g||g.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let g=this._cachedTileFogOpacities[o.key];return g||(this._cachedTileFogOpacities[o.key]=g=this.style.fog.getOpacityForTile(o)),g[0]>=Hn||g[1]>=Hn}setupDepthForOcclusion(o,g,_e){const nt=this.context,st=nt.gl,lt=!!_e;var ut;_e||(_e={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),nt.activeTexture.set(st.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(st.NEAREST,st.CLAMP_TO_EDGE),_e.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],_e.u_depth_range_unpack=[2/((ut=this.depthRangeFor3D)[1]-ut[0]),-1-2*ut[0]/(ut[1]-ut[0])],_e.u_occluder_half_size=.5*this.occlusionParams.occluderSize,_e.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(st.NEAREST,st.CLAMP_TO_EDGE),nt.activeTexture.set(st.TEXTURE0),lt||g.setTerrainUniformValues(nt,_e)}}function _x(et,o){let g=!1,_e=null;const nt=()=>{_e=null,g&&(et(),_e=setTimeout(nt,o),g=!1)};return()=>(g=!0,_e||nt(),_e)}class kv{constructor(o){this._hashName=o&&encodeURIComponent(o),h.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=_x(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const g=xx(o);if(this._hashName){const _e=this._hashName;let nt=!1;const st=location.hash.slice(1).split("&").map(lt=>{const ut=lt.split("=")[0];return ut===_e?(nt=!0,`${ut}=${g}`):lt}).filter(lt=>lt);return nt||st.push(`${_e}=${g}`),`#${st.join("&")}`}return`#${g}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let g;return o.split("&").map(_e=>_e.split("=")).forEach(_e=>{_e[0]===this._hashName&&(g=_e)}),(g&&g[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const g=this._getCurrentHash();if(g.length>=3&&!g.some(_e=>isNaN(Number(_e)))){const _e=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(g[3]||0):o.getBearing();return o.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:_e,pitch:+(g[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function xx(et,o){const g=et.getCenter(),_e=Math.round(100*et.getZoom())/100,nt=Math.ceil((_e*Math.LN2+Math.log(512/360/.5))/Math.LN10),st=Math.pow(10,nt),lt=Math.round(g.lng*st)/st,ut=Math.round(g.lat*st)/st,pt=et.getBearing(),yt=et.getPitch();let vt=o?`/${lt}/${ut}/${_e}`:`${_e}/${ut}/${lt}`;return(pt||yt)&&(vt+="/"+Math.round(10*pt)/10),yt&&(vt+=`/${Math.round(yt)}`),vt}const vu={linearity:.3,easing:h.eK(0,0,.3,1)},_m=Object.assign({deceleration:2500,maxSpeed:1400},vu),ky=Object.assign({deceleration:20,maxSpeed:1400},vu),vx=Object.assign({deceleration:1e3,maxSpeed:360},vu),Dv=Object.assign({deceleration:1e3,maxSpeed:90},vu);class Lv{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.o.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,g=h.o.now();for(;o.length>0&&g-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const g={zoom:0,bearing:0,pitch:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:st}of this._inertiaBuffer)g.zoom+=st.zoomDelta||0,g.bearing+=st.bearingDelta||0,g.pitch+=st.pitchDelta||0,st.panDelta&&g.pan._add(st.panDelta),st.around&&(g.around=st.around),st.pinchAround&&(g.pinchAround=st.pinchAround);const _e=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,nt={};if(g.pan.mag()){const st=Dy(g.pan.mag(),_e,Object.assign({},_m,o||{}));nt.offset=g.pan.mult(st.amount/g.pan.mag()),nt.center=this._map.transform.center,ap(nt,st)}if(g.zoom){const st=Dy(g.zoom,_e,ky);nt.zoom=this._map.transform.zoom+st.amount,ap(nt,st)}if(g.bearing){const st=Dy(g.bearing,_e,vx);nt.bearing=this._map.transform.bearing+h.aA(st.amount,-179,179),ap(nt,st)}if(g.pitch){const st=Dy(g.pitch,_e,Dv);nt.pitch=this._map.transform.pitch+st.amount,ap(nt,st)}if(nt.zoom||nt.bearing){const st=g.pinchAround===void 0?g.around:g.pinchAround;nt.around=st?this._map.unproject(st):this._map.getCenter()}return this.clear(),nt.noMoveStart=!0,nt}}function ap(et,o){(!et.duration||et.duration<o.duration)&&(et.duration=o.duration,et.easing=o.easing)}function Dy(et,o,g){const{maxSpeed:_e,linearity:nt,deceleration:st}=g,lt=h.aA(et*nt/(o/1e3),-_e,_e),ut=Math.abs(lt)/(st*nt);return{easing:g.easing,duration:1e3*ut,amount:lt*(ut/2)}}class Sl extends h.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,g,_e,nt={}){const st=nr(g.getCanvasContainer(),_e),lt=g.unproject(st);super(o,Object.assign({point:st,lngLat:lt,originalEvent:_e},nt)),this._defaultPrevented=!1,this.target=g}}class Ly extends h.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,g,_e){const nt=o==="touchend"?_e.changedTouches:_e.touches,st=kr(g.getCanvasContainer(),nt),lt=st.map(pt=>g.unproject(pt)),ut=st.reduce((pt,yt,vt,Mt)=>pt.add(yt.div(Mt.length)),new h.P(0,0));super(o,{points:st,point:ut,lngLats:lt,lngLat:g.unproject(ut),originalEvent:_e}),this._defaultPrevented=!1}}class bx extends h.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,g){super("wheel",{originalEvent:g}),this._defaultPrevented=!1}}class jv{constructor(o,g){this._map=o,this._clickTolerance=g.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new bx(this._map,o))}mousedown(o,g){return this._mousedownPos=g,this._firePreventable(new Sl(o.type,this._map,o))}mouseup(o){this._map.fire(new Sl(o.type,this._map,o))}preclick(o){const g=new MouseEvent("preclick",o);this._map.fire(new Sl(g.type,this._map,g))}click(o,g){this._mousedownPos&&this._mousedownPos.dist(g)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Sl(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Sl(o.type,this._map,o))}mouseover(o){this._map.fire(new Sl(o.type,this._map,o))}mouseout(o){this._map.fire(new Sl(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Ly(o.type,this._map,o))}touchmove(o){this._map.fire(new Ly(o.type,this._map,o))}touchend(o){this._map.fire(new Ly(o.type,this._map,o))}touchcancel(o){this._map.fire(new Ly(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fv{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Sl(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Sl("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Sl(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Dl{constructor(o,g){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=g.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,g){this.isEnabled()&&o.shiftKey&&o.button===0&&(jt(),this._startPos=this._lastPos=g,this._active=!0)}mousemoveWindow(o,g){if(!this._active)return;const _e=g,nt=this._startPos,st=this._lastPos;if(!nt||!st||st.equals(_e)||!this._box&&_e.dist(nt)<this._clickTolerance)return;this._lastPos=_e,this._box||(this._box=At("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const lt=Math.min(nt.x,_e.x),ut=Math.max(nt.x,_e.x),pt=Math.min(nt.y,_e.y),yt=Math.max(nt.y,_e.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${lt}px,${pt}px)`,this._box.style.width=ut-lt+"px",this._box.style.height=yt-pt+"px")})}mouseupWindow(o,g){if(!this._active)return;const _e=this._startPos,nt=g;if(_e&&o.button===0){if(this.reset(),ir(),_e.x!==nt.x||_e.y!==nt.y)return this._map.fire(new h.z("boxzoomend",{originalEvent:o})),{cameraAnimation:st=>st.fitScreenCoordinates(_e,nt,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ht(),delete this._startPos,delete this._lastPos}_fireEvent(o,g){return this._map.fire(new h.z(o,{originalEvent:g}))}}function h_(et,o){const g={};for(let _e=0;_e<et.length;_e++)g[et[_e].identifier]=o[_e];return g}class Ov{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,g,_e){(this.centroid||_e.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),_e.length===this.numTouches&&(this.centroid=function(nt){const st=new h.P(0,0);for(const lt of nt)st._add(lt);return st.div(nt.length)}(g),this.touches=h_(_e,g)))}touchmove(o,g,_e){if(this.aborted||!this.centroid)return;const nt=h_(_e,g);for(const st in this.touches){const lt=nt[st];(!lt||lt.dist(this.touches[st])>30)&&(this.aborted=!0)}}touchend(o,g,_e){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),_e.length===0){const nt=!this.aborted&&this.centroid;if(this.reset(),nt)return nt}}}class d_{constructor(o){this.singleTap=new Ov(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,g,_e){this.singleTap.touchstart(o,g,_e)}touchmove(o,g,_e){this.singleTap.touchmove(o,g,_e)}touchend(o,g,_e){const nt=this.singleTap.touchend(o,g,_e);if(nt){const st=o.timeStamp-this.lastTime<500,lt=!this.lastTap||this.lastTap.dist(nt)<30;if(st&&lt||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=nt,this.count===this.numTaps)return this.reset(),nt}}}class Xm{constructor(){this._zoomIn=new d_({numTouches:1,numTaps:2}),this._zoomOut=new d_({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,g,_e){this._zoomIn.touchstart(o,g,_e),this._zoomOut.touchstart(o,g,_e)}touchmove(o,g,_e){this._zoomIn.touchmove(o,g,_e),this._zoomOut.touchmove(o,g,_e)}touchend(o,g,_e){const nt=this._zoomIn.touchend(o,g,_e),st=this._zoomOut.touchend(o,g,_e);return nt?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:lt=>lt.easeTo({duration:300,zoom:lt.getZoom()+1,around:lt.unproject(nt)},{originalEvent:o})}):st?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:lt=>lt.easeTo({duration:300,zoom:lt.getZoom()-1,around:lt.unproject(st)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const zv={0:1,2:2},wx={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class p_{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,g){return!1}_move(o,g){return{}}mousedown(o,g){if(this._lastPoint)return;const _e=br(o);this._correctButton(o,_e)&&(this._lastPoint=g,this._eventButton=_e)}mousemoveWindow(o,g){const _e=this._lastPoint;if(_e){if(o.preventDefault(),this._eventButton!=null&&function(nt,st){const lt=zv[st];return nt.buttons===void 0||(nt.buttons&lt)!==lt}(o,this._eventButton))this.reset();else if(this._moved||!(g.dist(_e)<this._clickTolerance))return this._moved=!0,this._lastPoint=g,this._move(_e,g)}}mouseupWindow(o){this._lastPoint&&br(o)===this._eventButton&&(this._moved&&ir(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jy extends p_{mousedown(o,g){super.mousedown(o,g),this._lastPoint&&(this._active=!0)}_correctButton(o,g){return g===0&&!o.ctrlKey}_move(o,g){return{around:g,panDelta:g.sub(o)}}}class Ex extends p_{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?wx[o.pitchRotateKey]:void 0}_correctButton(o,g){return this._pitchRotateKey?g===0&&o[this._pitchRotateKey]:g===0&&o.ctrlKey||g===2}_move(o,g){const _e=.8*(g.x-o.x);if(_e)return this._active=!0,{bearingDelta:_e}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class Tx extends p_{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?wx[o.pitchRotateKey]:void 0}_correctButton(o,g){return this._pitchRotateKey?g===0&&o[this._pitchRotateKey]:g===0&&o.ctrlKey||g===2}_move(o,g){const _e=-.5*(g.y-o.y);if(_e)return this._active=!0,{pitchDelta:_e}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class Nv{constructor(o,g){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=g.clickTolerance||1,this.reset(),h.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}touchstart(o,g,_e){return this._calculateTransform(o,g,_e)}touchmove(o,g,_e){if(this._active&&!(_e.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_e.length===1&&!h.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,g,_e)}}touchend(o,g,_e){this._calculateTransform(o,g,_e),this._active&&_e.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,g,_e){_e.length>0&&(this._active=!0);const nt=h_(_e,g),st=new h.P(0,0),lt=new h.P(0,0);let ut=0;for(const yt in nt){const vt=nt[yt],Mt=this._touches[yt];Mt&&(st._add(vt),lt._add(vt.sub(Mt)),ut++,nt[yt]=vt)}if(this._touches=nt,ut<this._minTouches||!lt.mag())return;const pt=lt.div(ut);return this._sum._add(pt),this._sum.mag()<this._clickTolerance?void 0:{around:st.div(ut),panDelta:pt}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=At("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Fy{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,g,_e){return{}}touchstart(o,g,_e){this._firstTwoTouches||_e.length<2||(this._firstTwoTouches=[_e[0].identifier,_e[1].identifier],this._start([g[0],g[1]]))}touchmove(o,g,_e){const nt=this._firstTwoTouches;if(!nt)return;o.preventDefault();const[st,lt]=nt,ut=Oy(_e,g,st),pt=Oy(_e,g,lt);if(!ut||!pt)return;const yt=this._aroundCenter?null:ut.add(pt).div(2);return this._move([ut,pt],yt,o)}touchend(o,g,_e){if(!this._firstTwoTouches)return;const[nt,st]=this._firstTwoTouches,lt=Oy(_e,g,nt),ut=Oy(_e,g,st);lt&&ut||(this._active&&ir(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Oy(et,o,g){for(let _e=0;_e<et.length;_e++)if(et[_e].identifier===g)return o[_e]}function Sx(et,o){return Math.log2(et/o)}class l1 extends Fy{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,g){const _e=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Sx(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sx(this._distance,_e),pinchAround:g}}}function Bv(et,o){return 180*et.angleWith(o)/Math.PI}class c1 extends Fy{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,g){const _e=this._vector;if(this._vector=o[0].sub(o[1]),_e&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Bv(this._vector,_e),pinchAround:g}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const g=25/(Math.PI*this._minDiameter)*360,_e=this._startVector;if(!_e)return!1;const nt=Bv(o,_e);return Math.abs(nt)<g}}function Cx(et){return Math.abs(et.y)>Math.abs(et.x)}class u1 extends Fy{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Cx(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,g,_e){const nt=this._lastPoints;if(!nt)return;const st=o[0].sub(nt[0]),lt=o[1].sub(nt[1]);return this._map._cooperativeGestures&&!h.eL()&&_e.touches.length<3||(this._valid=this.gestureBeginsVertically(st,lt,_e.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(st.y+lt.y)/2*-.5})}gestureBeginsVertically(o,g,_e){if(this._valid!==void 0)return this._valid;const nt=o.mag()>=2,st=g.mag()>=2;if(!nt&&!st)return;if(!nt||!st)return this._firstMove==null&&(this._firstMove=_e),_e-this._firstMove<100&&void 0;const lt=o.y>0==g.y>0;return Cx(o)&&Cx(g)&&lt}}const h1={panStep:100,bearingStep:15,pitchStep:10};class d1{constructor(){const o=h1;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let g=0,_e=0,nt=0,st=0,lt=0;switch(o.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:o.shiftKey?_e=-1:(o.preventDefault(),st=-1);break;case 39:o.shiftKey?_e=1:(o.preventDefault(),st=1);break;case 38:o.shiftKey?nt=1:(o.preventDefault(),lt=-1);break;case 40:o.shiftKey?nt=-1:(o.preventDefault(),lt=1);break;default:return}return this._rotationDisabled&&(_e=0,nt=0),{cameraAnimation:ut=>{const pt=ut.getZoom();ut.easeTo({duration:300,easeId:"keyboardHandler",easing:p1,zoom:g?Math.round(pt)+g*(o.shiftKey?2:1):pt,bearing:ut.getBearing()+_e*this._bearingStep,pitch:ut.getPitch()+nt*this._pitchStep,offset:[-st*this._panStep,-lt*this._panStep],center:ut.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function p1(et){return et*(2-et)}const Vv=4.000244140625,f1=1/450;class m1{constructor(o,g){this._map=o,this._el=o.getCanvasContainer(),this._handler=g,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=f1,h.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||h.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let g=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const _e=h.o.now(),nt=_e-(this._lastWheelEventTime||0);this._lastWheelEventTime=_e,g!==0&&g%Vv==0?this._type="wheel":g!==0&&Math.abs(g)<4?this._type="trackpad":nt>400?(this._type=null,this._lastValue=g,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(nt*g)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,g+=this._lastValue)),o.shiftKey&&g&&(g/=4),this._type&&(this._lastWheelEvent=o,this._delta-=g,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const g=nr(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:g,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const g=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const yt=this._type==="wheel"&&Math.abs(this._delta)>Vv?this._wheelZoomRate:this._defaultZoomRate;let vt=2/(1+Math.exp(-Math.abs(this._delta*yt)));this._delta<0&&vt!==0&&(vt=1/vt);const Mt=g(),Et=Math.pow(2,Mt),Lt=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):Et;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(Lt*vt))),this._type==="wheel"&&(this._startZoom=Mt,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const _e=typeof this._targetZoom=="number"?this._targetZoom:g(),nt=this._startZoom,st=this._easing;let lt,ut=!1;if(this._type==="wheel"&&nt&&st){const yt=Math.min((h.o.now()-this._lastWheelEventTime)/200,1),vt=st(yt);lt=h.ak(nt,_e,vt),yt<1?this._frameId||(this._frameId=!0):ut=!0}else lt=_e,ut=!0;this._active=!0,ut&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let pt=lt-g();return pt*this._lastDelta<0&&(pt=0),{noInertia:!0,needsRenderFrame:!ut,zoomDelta:pt,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let g=h.eM;if(this._prevEase){const _e=this._prevEase,nt=(h.o.now()-_e.start)/_e.duration,st=_e.easing(nt+.01)-_e.easing(nt),lt=.27/Math.sqrt(st*st+1e-4)*.01,ut=Math.sqrt(.0729-lt*lt);g=h.eK(lt,ut,.25,1)}return this._prevEase={start:h.o.now(),duration:o,easing:g},g}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=At("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class g1{constructor(o,g){this._clickZoom=o,this._tapZoom=g}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class y1{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,g){return o.preventDefault(),{cameraAnimation:_e=>{_e.easeTo({duration:300,zoom:_e.getZoom()+(o.shiftKey?-1:1),around:_e.unproject(g)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uw{constructor(){this._tap=new d_({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,g,_e){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_e.length>0&&(this._swipePoint=g[0],this._swipeTouch=_e[0].identifier):this._tap.touchstart(o,g,_e))}touchmove(o,g,_e){if(this._tapTime){if(this._swipePoint){if(_e[0].identifier!==this._swipeTouch)return;const nt=g[0],st=nt.y-this._swipePoint.y;return this._swipePoint=nt,o.preventDefault(),this._active=!0,{zoomDelta:st/128}}}else this._tap.touchmove(o,g,_e)}touchend(o,g,_e){this._tapTime?this._swipePoint&&_e.length===0&&this.reset():this._tap.touchend(o,g,_e)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gw{constructor(o,g,_e){this._el=o,this._mousePan=g,this._touchPan=_e}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $w{constructor(o,g,_e){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=g,this._mousePitch=_e}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Bo{constructor(o,g,_e,nt){this._el=o,this._touchZoom=g,this._touchRotate=_e,this._tapDragZoom=nt,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const f_=et=>et.zoom||et.drag||et.pitch||et.rotate;class Hw extends h.z{}class Ww{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,g){const _e=h.av([],g,o);this.radius=h.ag(_e[2]<0?h.eO([],_e,this.constants):[_e[0],_e[1],0])}projectRay(o){h.eO(o,o,this.constants),h.aw(o,o),h.eP(o,o,this.constants);const g=h.c4([],o,this.radius);if(g[2]>0){const _e=h.c4([],[0,0,1],h.bJ(g,[0,0,1])),nt=h.c4([],h.aw([],[g[0],g[1],0]),this.radius),st=h.d7([],g,h.c4([],h.av([],h.d7([],nt,_e),g),2));g[0]=st[0],g[1]=st[1]}return g}}function Ax(et){return et.panDelta&&et.panDelta.mag()||et.zoomDelta||et.bearingDelta||et.pitchDelta}class m_{constructor(o,g){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Lv(o),this._bearingSnap=g.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ww,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(g),h.aY(["handleEvent","handleWindowEvent"],this);const _e=this._el;this._listeners=[[_e,"touchstart",{passive:!0}],[_e,"touchmove",{passive:!1}],[_e,"touchend",void 0],[_e,"touchcancel",void 0],[_e,"mousedown",void 0],[_e,"mousemove",void 0],[_e,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_e,"mouseover",void 0],[_e,"mouseout",void 0],[_e,"dblclick",void 0],[_e,"click",void 0],[_e,"keydown",{capture:!1}],[_e,"keyup",void 0],[_e,"wheel",{passive:!1}],[_e,"contextmenu",void 0],[window,"blur",void 0]];for(const[nt,st,lt]of this._listeners){const ut=nt===document?this.handleWindowEvent:this.handleEvent;nt.addEventListener(st,ut,lt)}}destroy(){for(const[o,g,_e]of this._listeners){const nt=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(g,nt,_e)}}_addDefaultHandlers(o){const g=this._map,_e=g.getCanvasContainer();this._add("mapEvent",new jv(g,o));const nt=g.boxZoom=new Dl(g,o);this._add("boxZoom",nt);const st=new Xm,lt=new y1;g.doubleClickZoom=new g1(lt,st),this._add("tapZoom",st),this._add("clickZoom",lt);const ut=new Uw;this._add("tapDragZoom",ut);const pt=g.touchPitch=new u1(g);this._add("touchPitch",pt);const yt=new Ex(o),vt=new Tx(o);g.dragRotate=new $w(o,yt,vt),this._add("mouseRotate",yt,["mousePitch"]),this._add("mousePitch",vt,["mouseRotate"]);const Mt=new jy(o),Et=new Nv(g,o);g.dragPan=new Gw(_e,Mt,Et),this._add("mousePan",Mt),this._add("touchPan",Et,["touchZoom","touchRotate"]);const Lt=new c1,Ft=new l1;g.touchZoomRotate=new Bo(_e,Ft,Lt,ut),this._add("touchRotate",Lt,["touchPan","touchZoom"]),this._add("touchZoom",Ft,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Fv(g));const Ot=g.scrollZoom=new m1(g,this);this._add("scrollZoom",Ot,["mousePan"]);const qt=g.keyboard=new d1;this._add("keyboard",qt);for(const $t of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[$t]&&g[$t].enable(o[$t])}_add(o,g,_e){this._handlers.push({handlerName:o,handler:g,allowed:_e}),this._handlersById[o]=g}stop(o){if(!this._updatingCamera){for(const{handler:g}of this._handlers)g.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!f_(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,g,_e){for(const nt in o)if(nt!==_e&&(!g||g.indexOf(nt)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const g=[];for(const _e of o)this._el.contains(_e.target)&&g.push(_e);return g}handleEvent(o,g){this._updatingCamera=!0;const _e=o.type==="renderFrame",nt=_e?void 0:o,st={needsRenderFrame:!1},lt={},ut={},pt=o.touches?this._getMapTouches(o.touches):void 0,yt=pt?kr(this._el,pt):_e?void 0:nr(this._el,o);for(const{handlerName:Et,handler:Lt,allowed:Ft}of this._handlers){if(!Lt.isEnabled())continue;let Ot;this._blockedByActive(ut,Ft,Et)?Lt.reset():Lt[g||o.type]&&(Ot=Lt[g||o.type](o,yt,pt),this.mergeHandlerResult(st,lt,Ot,Et,nt),Ot&&Ot.needsRenderFrame&&this._triggerRenderFrame()),(Ot||Lt.isActive())&&(ut[Et]=Lt)}const vt={};for(const Et in this._previousActiveHandlers)ut[Et]||(vt[Et]=nt);this._previousActiveHandlers=ut,(Object.keys(vt).length||Ax(st))&&(this._changes.push([st,lt,vt]),this._triggerRenderFrame()),(Object.keys(ut).length||Ax(st))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Mt}=st;Mt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Mt(this._map))}mergeHandlerResult(o,g,_e,nt,st){if(!_e)return;Object.assign(o,_e);const lt={handlerName:nt,originalEvent:_e.originalEvent||st};_e.zoomDelta!==void 0&&(g.zoom=lt),_e.panDelta!==void 0&&(g.drag=lt),_e.pitchDelta!==void 0&&(g.pitch=lt),_e.bearingDelta!==void 0&&(g.rotate=lt)}_applyChanges(){const o={},g={},_e={};for(const[nt,st,lt]of this._changes)nt.panDelta&&(o.panDelta=(o.panDelta||new h.P(0,0))._add(nt.panDelta)),nt.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+nt.zoomDelta),nt.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+nt.bearingDelta),nt.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+nt.pitchDelta),nt.around!==void 0&&(o.around=nt.around),nt.aroundCoord!==void 0&&(o.aroundCoord=nt.aroundCoord),nt.pinchAround!==void 0&&(o.pinchAround=nt.pinchAround),nt.noInertia&&(o.noInertia=nt.noInertia),Object.assign(g,st),Object.assign(_e,lt);this._updateMapTransform(o,g,_e),this._changes=[]}_updateMapTransform(o,g,_e){const nt=this._map,st=nt.transform,lt=Yt=>[Yt.x,Yt.y,Yt.z];if((Yt=>{const tr=this._eventsInProgress.drag;return tr&&!this._handlersById[tr.handlerName].isActive()})()&&!Ax(o)){const Yt=st.zoom;st.cameraElevationReference="sea",this._originalZoom!=null&&st._orthographicProjectionAtLowPitch&&st.projection.name!=="globe"&&st.pitch===0?(st.cameraElevationReference="ground",st.zoom=this._originalZoom):(st.recenterOnTerrain(),st.cameraElevationReference="ground"),Yt!==st.zoom&&this._map._update(!0)}if(st._isCameraConstrained&&nt._stop(!0),!Ax(o))return void this._fireEvents(g,_e,!0);let{panDelta:ut,zoomDelta:pt,bearingDelta:yt,pitchDelta:vt,around:Mt,aroundCoord:Et,pinchAround:Lt}=o;st._isCameraConstrained&&(pt>0&&(pt=0),st._isCameraConstrained=!1),Lt!==void 0&&(Mt=Lt),(pt||(Yt=>g[Yt]&&!this._eventsInProgress[Yt])("drag"))&&Mt&&(this._dragOrigin=lt(st.pointCoordinate3D(Mt)),this._originalZoom=st.zoom,this._trackingEllipsoid.setup(st._camera.position,this._dragOrigin)),st.cameraElevationReference="sea",nt._stop(!0),Mt=Mt||nt.transform.centerPoint,yt&&(st.bearing+=yt),vt&&(st.pitch+=vt),st._updateCameraState();const Ft=[0,0,0];if(ut)if(st.projection.name==="mercator"){const Yt=this._trackingEllipsoid.projectRay(st.screenPointToMercatorRay(Mt).dir),tr=this._trackingEllipsoid.projectRay(st.screenPointToMercatorRay(Mt.sub(ut)).dir);Ft[0]=tr[0]-Yt[0],Ft[1]=tr[1]-Yt[1]}else{const Yt=st.pointCoordinate(Mt);if(st.projection.name==="globe"){ut=ut.rotate(-st.angle);const tr=st._pixelsPerMercatorPixel/st.worldSize;Ft[0]=-ut.x*h.eN(h.a$(Yt.y))*tr,Ft[1]=-ut.y*h.eN(st.center.lat)*tr}else{const tr=st.pointCoordinate(Mt.sub(ut));Yt&&tr&&(Ft[0]=tr.x-Yt.x,Ft[1]=tr.y-Yt.y)}}const Ot=st.zoom,qt=[0,0,0];if(pt){const Yt=lt(Et||st.pointCoordinate3D(Mt)),tr={dir:h.aw([],h.av([],Yt,st._camera.position))};if(tr.dir[2]<0){const sr=st.zoomDeltaToMovement(Yt,pt);h.c4(qt,tr.dir,sr)}}const $t=h.d7(Ft,Ft,qt);st._translateCameraConstrained($t),pt&&Math.abs(st.zoom-Ot)>1e-4&&st.recenterOnTerrain(),st.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(g,_e,!0)}_fireEvents(o,g,_e){const nt=f_(this._eventsInProgress),st=f_(o),lt={};for(const vt in o){const{originalEvent:Mt}=o[vt];this._eventsInProgress[vt]||(lt[`${vt}start`]=Mt),this._eventsInProgress[vt]=o[vt]}!nt&&st&&this._fireEvent("movestart",st.originalEvent);for(const vt in lt)this._fireEvent(vt,lt[vt]);st&&this._fireEvent("move",st.originalEvent);for(const vt in o){const{originalEvent:Mt}=o[vt];this._fireEvent(vt,Mt)}const ut={};let pt;for(const vt in this._eventsInProgress){const{handlerName:Mt,originalEvent:Et}=this._eventsInProgress[vt];this._handlersById[Mt].isActive()||(delete this._eventsInProgress[vt],pt=g[Mt]||Et,ut[`${vt}end`]=pt)}for(const vt in ut)this._fireEvent(vt,ut[vt]);const yt=f_(this._eventsInProgress);if(_e&&(nt||st)&&!yt){this._updatingCamera=!0;const vt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Mt=Et=>Et!==0&&-this._bearingSnap<Et&&Et<this._bearingSnap;vt?(Mt(vt.bearing||this._map.getBearing())&&(vt.bearing=0),this._map.easeTo(vt,{originalEvent:pt})):(this._map.fire(new h.z("moveend",{originalEvent:pt})),Mt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,g){this._map.fire(new h.z(o,g?{originalEvent:g}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Hw("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Uv="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Gv extends h.E{constructor(o,g){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=g.bearingSnap,this._respectPrefersReducedMotion=g.respectPrefersReducedMotion!==!1,h.aY(["_renderFrameCallback"],this)}getCenter(){return new h.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(o,g){return this.jumpTo({center:o},g)}panBy(o,g,_e){return o=h.P.convert(o).mult(-1),this.panTo(this.transform.center,Object.assign({offset:o},g),_e)}panTo(o,g,_e){return this.easeTo(Object.assign({center:o},g),_e)}getZoom(){return this.transform.zoom}setZoom(o,g){return this.jumpTo({zoom:o},g),this}zoomTo(o,g,_e){return this.easeTo(Object.assign({zoom:o},g),_e)}zoomIn(o,g){return this.zoomTo(this.getZoom()+1,o,g),this}zoomOut(o,g){return this.zoomTo(this.getZoom()-1,o,g),this}getBearing(){return this.transform.bearing}setBearing(o,g){return this.jumpTo({bearing:o},g),this}getPadding(){return this.transform.padding}setPadding(o,g){return this.jumpTo({padding:o},g),this}rotateTo(o,g,_e){return this.easeTo(Object.assign({bearing:o},g),_e)}resetNorth(o,g){return this.rotateTo(0,Object.assign({duration:1e3},o),g),this}resetNorthPitch(o,g){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},o),g),this}snapToNorth(o,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,g):this}getPitch(){return this.transform.pitch}setPitch(o,g){return this.jumpTo({pitch:o},g),this}cameraForBounds(o,g){o=h.aI.convert(o);const _e=g&&g.bearing||0,nt=g&&g.pitch||0,st=o.getNorthWest(),lt=o.getSouthEast();return this._cameraForBounds(this.transform,st,lt,_e,nt,g)}_extendPadding(o){const g={top:0,right:0,bottom:0,left:0};return o==null?Object.assign({},g,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:Object.assign({},g,o)}_extendCameraOptions(o){return(o=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,g){const _e=g.max[0]-g.min[0],nt=g.max[1]-g.min[1];return _e/nt>o.aspect?_e/(2*Math.tan(.5*o.fovX)*o.aspect):nt/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,g,_e,nt,st,lt){const ut=o.clone(),pt=this._extendCameraOptions(lt);ut.bearing=nt,ut.pitch=st;const yt=h.aR.convert(g),vt=h.aR.convert(_e),Mt=.5*(yt.lat+vt.lat),Et=.5*(yt.lng+vt.lng),Lt=h.eQ(Mt,Et),Ft=h.aw([],Lt),Ot=h.aw([],h.bI([],Ft,[0,1,0])),qt=h.bI([],Ot,Ft),$t=[Ot[0],Ot[1],Ot[2],0,qt[0],qt[1],qt[2],0,Ft[0],Ft[1],Ft[2],0,0,0,0,1],Yt=[Lt,h.eQ(yt.lat,yt.lng),h.eQ(vt.lat,yt.lng),h.eQ(vt.lat,vt.lng),h.eQ(yt.lat,vt.lng),h.eQ(Mt,yt.lng),h.eQ(Mt,vt.lng),h.eQ(yt.lat,Et),h.eQ(vt.lat,Et)];let tr=h.d8.fromPoints(Yt.map(Hr=>[h.bJ(Ot,Hr),h.bJ(qt,Hr),h.bJ(Ft,Hr)]));const sr=h.af([],tr.center,$t);h.eR(sr)===0&&h.eS(sr,0,0,1),h.aw(sr,sr),h.c4(sr,sr,h.aD),ut.center=h.eT(sr);const pr=ut.getWorldToCameraMatrix(),hr=h.bl(new Float64Array(16),pr);tr=h.d8.applyTransform(tr,h.aB([],pr,$t));const gr=this._extendAABB(tr,ut,pt,nt);if(!gr)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");tr=gr,h.af(sr,sr,pr);const dr=.5*(tr.max[2]-tr.min[2]),ur=this._minimumAABBFrustumDistance(ut,tr),yr=h.c4([],[0,0,1],dr),Vr=h.d7(yr,sr,yr),Ir=ur+(ut.pitch===0?0:h.bG(sr,Vr)),Qr=ut.globeCenterInViewSpace,Nr=h.av([],sr,[Qr[0],Qr[1],Qr[2]]);h.aw(Nr,Nr),h.c4(Nr,Nr,Ir);const Yr=h.d7([],sr,Nr);h.af(Yr,Yr,hr);const Cn=h.eD/h.aD,Br=h.ag(Yr),Tr=h.ce(Math.max(Br*Cn-h.eD,Number.EPSILON),0),en=Math.min(ut.zoomFromMercatorZAdjusted(Tr),pt.maxZoom);return en>.5*(h.cZ+h.cK)?(ut.setProjection({name:"mercator"}),ut.zoom=en,this._cameraForBounds(ut,g,_e,nt,st,lt)):{center:ut.center,zoom:en,bearing:nt,pitch:st}}_extendAABB(o,g,_e,nt){const st=.5*((_e.padding.left||0)+(_e.padding.right||0)),lt=.5*((_e.padding.top||0)+(_e.padding.bottom||0)),ut=lt,pt=st,yt=st,vt=lt,Mt=g.width-(pt+yt),Et=g.height-(ut+vt),Lt=h.av([],o.max,o.min),Ft=Math.min(Mt/Lt[0],Et/Lt[1]),Ot=Math.min(g.scaleZoom(g.scale*Ft),_e.maxZoom);if(isNaN(Ot))return null;const qt=g.scale/g.zoomScale(Ot),$t=new h.d8([o.min[0]-pt*qt,o.min[1]-vt*qt,o.min[2]],[o.max[0]+yt*qt,o.max[1]+ut*qt,o.max[2]]),Yt=(typeof _e.offset.x=="number"&&typeof _e.offset.y=="number"?new h.P(_e.offset.x,_e.offset.y):h.P.convert(_e.offset)).rotate(-h.an(nt));return $t.center[0]-=Yt.x*qt,$t.center[1]+=Yt.y*qt,$t}queryTerrainElevation(o,g){const _e=this.transform.elevation;return _e?(g=Object.assign({},{exaggerated:!0},g),_e.getAtPoint(h.ae.fromLngLat(o),null,g.exaggerated)):null}_cameraForBounds(o,g,_e,nt,st,lt){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,g,_e,nt,st,lt);const ut=o.clone(),pt=this._extendCameraOptions(lt);ut.bearing=nt,ut.pitch=st;const yt=h.aR.convert(g),vt=h.aR.convert(_e),Mt=new h.aR(yt.lng,vt.lat),Et=new h.aR(vt.lng,yt.lat),Lt=ut.project(yt),Ft=ut.project(vt),Ot=this.queryTerrainElevation(yt),qt=this.queryTerrainElevation(vt),$t=this.queryTerrainElevation(Mt),Yt=this.queryTerrainElevation(Et),tr=[[Lt.x,Lt.y,Math.min(Ot||0,qt||0,$t||0,Yt||0)],[Ft.x,Ft.y,Math.max(Ot||0,qt||0,$t||0,Yt||0)]];let sr=h.d8.fromPoints(tr);const pr=ut.getWorldToCameraMatrix(),hr=h.bl(new Float64Array(16),pr);sr=h.d8.applyTransform(sr,pr);const gr=this._extendAABB(sr,ut,pt,nt);if(!gr)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");sr=gr;const dr=.5*h.av([],sr.max,sr.min)[2],ur=this._minimumAABBFrustumDistance(ut,sr),yr=[0,0,1,0];h.aC(yr,yr,pr),h.eU(yr,yr);const Vr=h.c4([],yr,ur+dr),Ir=h.d7([],sr.center,Vr);h.af(sr.center,sr.center,hr),h.af(Ir,Ir,hr);const Qr=ut.unproject(new h.P(sr.center[0],sr.center[1])),Nr=h.eV(ut.projection,Qr),Yr=Math.pow(2,Nr),Cn=Math.min(ut._zoomFromMercatorZ(Ir[2]*ut.pixelsPerMeter*Yr/ut.worldSize),pt.maxZoom);return ut.mercatorFromTransition&&Cn<.5*(h.cZ+h.cK)?(ut.setProjection({name:"globe"}),ut.zoom=Cn,this._cameraForBounds(ut,g,_e,nt,st,lt)):{center:Qr,zoom:Cn,bearing:nt,pitch:st}}fitBounds(o,g,_e){const nt=this.cameraForBounds(o,g);return this._fitInternal(nt,g,_e)}fitScreenCoordinates(o,g,_e,nt,st){const lt=h.P.convert(o),ut=h.P.convert(g),pt=new h.P(Math.min(lt.x,ut.x),Math.min(lt.y,ut.y)),yt=new h.P(Math.max(lt.x,ut.x),Math.max(lt.y,ut.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(lt,ut))return this;const vt=this.transform.pointLocation3D(pt),Mt=this.transform.pointLocation3D(yt),Et=this.transform.pointLocation3D(new h.P(pt.x,yt.y)),Lt=this.transform.pointLocation3D(new h.P(yt.x,pt.y)),Ft=[Math.min(vt.lng,Mt.lng,Et.lng,Lt.lng),Math.min(vt.lat,Mt.lat,Et.lat,Lt.lat)],Ot=[Math.max(vt.lng,Mt.lng,Et.lng,Lt.lng),Math.max(vt.lat,Mt.lat,Et.lat,Lt.lat)],qt=nt&&nt.pitch?nt.pitch:this.getPitch(),$t=this._cameraForBounds(this.transform,Ft,Ot,_e,qt,nt);return this._fitInternal($t,nt,st)}_fitInternal(o,g,_e){return o?(g=Object.assign(o,g)).linear?this.easeTo(g,_e):this.flyTo(g,_e):this}jumpTo(o,g){this.stop();const _e=o.preloadOnly?this.transform.clone():this.transform;let nt=!1,st=!1,lt=!1;"zoom"in o&&_e.zoom!==+o.zoom&&(nt=!0,_e.zoom=+o.zoom),o.center!==void 0&&(_e.center=h.aR.convert(o.center)),"bearing"in o&&_e.bearing!==+o.bearing&&(st=!0,_e.bearing=+o.bearing),"pitch"in o&&_e.pitch!==+o.pitch&&(lt=!0,_e.pitch=+o.pitch);const ut=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!_e.isPaddingEqual(ut))if(o.retainPadding===!1){const pt=_e.clone();pt.padding=ut,_e.setLocationAtPoint(_e.center,pt.centerPoint)}else _e.padding=ut;return o.preloadOnly?(this._preloadTiles(_e),this):(this.fire(new h.z("movestart",g)).fire(new h.z("move",g)),nt&&this.fire(new h.z("zoomstart",g)).fire(new h.z("zoom",g)).fire(new h.z("zoomend",g)),st&&this.fire(new h.z("rotatestart",g)).fire(new h.z("rotate",g)).fire(new h.z("rotateend",g)),lt&&this.fire(new h.z("pitchstart",g)).fire(new h.z("pitch",g)).fire(new h.z("pitchend",g)),this.fire(new h.z("moveend",g)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||h.w(Uv),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,g){const _e=this.transform;if(!_e.projection.supportsFreeCamera)return h.w(Uv),this;this.stop();const nt=_e.zoom,st=_e.pitch,lt=_e.bearing;_e.setFreeCameraOptions(o);const ut=nt!==_e.zoom,pt=st!==_e.pitch,yt=lt!==_e.bearing;return this.fire(new h.z("movestart",g)).fire(new h.z("move",g)),ut&&this.fire(new h.z("zoomstart",g)).fire(new h.z("zoom",g)).fire(new h.z("zoomend",g)),yt&&this.fire(new h.z("rotatestart",g)).fire(new h.z("rotate",g)).fire(new h.z("rotateend",g)),pt&&this.fire(new h.z("pitchstart",g)).fire(new h.z("pitch",g)).fire(new h.z("pitchend",g)),this.fire(new h.z("moveend",g)),this}easeTo(o,g){this._stop(!1,o.easeId),((o=Object.assign({offset:[0,0],duration:500,easing:h.eM},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const _e=this.transform,nt=this.getZoom(),st=this.getBearing(),lt=this.getPitch(),ut=this.getPadding(),pt="zoom"in o?+o.zoom:nt,yt="bearing"in o?this._normalizeBearing(o.bearing,st):st,vt="pitch"in o?+o.pitch:lt,Mt=this._extendPadding(o.padding),Et=h.P.convert(o.offset);let Lt,Ft,Ot;if(_e.projection.name==="globe"){const yr=h.ae.fromLngLat(_e.center),Vr=Et.rotate(-_e.angle);yr.x+=Vr.x/_e.worldSize,yr.y+=Vr.y/_e.worldSize;const Ir=yr.toLngLat(),Qr=h.aR.convert(o.center||Ir);this._normalizeCenter(Qr),Lt=_e.centerPoint.add(Vr),Ft=new h.P(yr.x,yr.y).mult(_e.worldSize),Ot=new h.P(h.aF(Qr.lng),h.aJ(Qr.lat)).mult(_e.worldSize).sub(Ft)}else{Lt=_e.centerPoint.add(Et);const yr=_e.pointLocation(Lt),Vr=h.aR.convert(o.center||yr);this._normalizeCenter(Vr),Ft=_e.project(yr),Ot=_e.project(Vr).sub(Ft)}const qt=_e.zoomScale(pt-nt);let $t,Yt;o.around&&($t=h.aR.convert(o.around),Yt=_e.locationPoint($t));const tr=this._zooming||pt!==nt,sr=this._rotating||st!==yt,pr=this._pitching||vt!==lt,hr=!_e.isPaddingEqual(Mt),gr=o.retainPadding===!1?_e.clone():_e,dr=yr=>Vr=>{if(tr&&(yr.zoom=h.ak(nt,pt,Vr)),sr&&(yr.bearing=h.ak(st,yt,Vr)),pr&&(yr.pitch=h.ak(lt,vt,Vr)),hr&&(gr.interpolatePadding(ut,Mt,Vr),Lt=gr.centerPoint.add(Et)),$t)yr.setLocationAtPoint($t,Yt);else{const Ir=yr.zoomScale(yr.zoom-nt),Qr=pt>nt?Math.min(2,qt):Math.max(.5,qt),Nr=Math.pow(Qr,1-Vr),Yr=yr.unproject(Ft.add(Ot.mult(Vr*Nr)).mult(Ir));yr.setLocationAtPoint(yr.renderWorldCopies?Yr.wrap():Yr,Lt)}return o.preloadOnly||this._fireMoveEvents(g),yr};if(o.preloadOnly){const yr=this._emulate(dr,o.duration,_e);return this._preloadTiles(yr),this}const ur={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=tr,this._rotating=sr,this._pitching=pr,this._padding=hr,this._easeId=o.easeId,this._prepareEase(g,o.noMoveStart,ur),this._ease(dr(_e),yr=>{_e.cameraElevationReference==="sea"&&_e.recenterOnTerrain(),this._afterEase(g,yr)},o),this}_prepareEase(o,g,_e={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),g||_e.moving||this.fire(new h.z("movestart",o)),this._zooming&&!_e.zooming&&this.fire(new h.z("zoomstart",o)),this._rotating&&!_e.rotating&&this.fire(new h.z("rotatestart",o)),this._pitching&&!_e.pitching&&this.fire(new h.z("pitchstart",o))}_fireMoveEvents(o){this.fire(new h.z("move",o)),this._zooming&&this.fire(new h.z("zoom",o)),this._rotating&&this.fire(new h.z("rotate",o)),this._pitching&&this.fire(new h.z("pitch",o))}_afterEase(o,g){if(this._easeId&&g&&this._easeId===g)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _e=this._zooming,nt=this._rotating,st=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_e&&this.fire(new h.z("zoomend",o)),nt&&this.fire(new h.z("rotateend",o)),st&&this.fire(new h.z("pitchend",o)),this.fire(new h.z("moveend",o))}flyTo(o,g){if(this._prefersReducedMotion(o)){const Hr=h.aH(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Hr,g)}this.stop(),o=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:h.eM},o);const _e=this.transform,nt=this.getZoom(),st=this.getBearing(),lt=this.getPitch(),ut=this.getPadding(),pt="zoom"in o?h.aA(+o.zoom,_e.minZoom,_e.maxZoom):nt,yt="bearing"in o?this._normalizeBearing(o.bearing,st):st,vt="pitch"in o?+o.pitch:lt,Mt=this._extendPadding(o.padding),Et=_e.zoomScale(pt-nt),Lt=h.P.convert(o.offset);let Ft=_e.centerPoint.add(Lt);const Ot=_e.pointLocation(Ft),qt=h.aR.convert(o.center||Ot);this._normalizeCenter(qt);const $t=_e.project(Ot),Yt=_e.project(qt).sub($t);let tr=o.curve;const sr=Math.max(_e.width,_e.height),pr=sr/Et,hr=Yt.mag();if("minZoom"in o){const Hr=h.aA(Math.min(o.minZoom,nt,pt),_e.minZoom,_e.maxZoom),un=sr/_e.zoomScale(Hr-nt);tr=Math.sqrt(un/hr*2)}const gr=tr*tr;function dr(Hr){const un=(pr*pr-sr*sr+(Hr?-1:1)*gr*gr*hr*hr)/(2*(Hr?pr:sr)*gr*hr);return Math.log(Math.sqrt(un*un+1)-un)}function ur(Hr){return(Math.exp(Hr)-Math.exp(-Hr))/2}function yr(Hr){return(Math.exp(Hr)+Math.exp(-Hr))/2}const Vr=dr(0);let Ir=function(Hr){return yr(Vr)/yr(Vr+tr*Hr)},Qr=function(Hr){return sr*((yr(Vr)*(ur(un=Vr+tr*Hr)/yr(un))-ur(Vr))/gr)/hr;var un},Nr=(dr(1)-Vr)/tr;if(Math.abs(hr)<1e-6||!isFinite(Nr)){if(Math.abs(sr-pr)<1e-6)return this.easeTo(o,g);const Hr=pr<sr?-1:1;Nr=Math.abs(Math.log(pr/sr))/tr,Qr=function(){return 0},Ir=function(un){return Math.exp(Hr*tr*un)}}o.duration="duration"in o?+o.duration:1e3*Nr/("screenSpeed"in o?+o.screenSpeed/tr:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Yr=st!==yt,Cn=vt!==lt,Br=!_e.isPaddingEqual(Mt),Tr=o.retainPadding===!1?_e.clone():_e,en=Hr=>un=>{const Tn=un*Nr,Ln=1/Ir(Tn);Hr.zoom=un===1?pt:nt+Hr.scaleZoom(Ln),Yr&&(Hr.bearing=h.ak(st,yt,un)),Cn&&(Hr.pitch=h.ak(lt,vt,un)),Br&&(Tr.interpolatePadding(ut,Mt,un),Ft=Tr.centerPoint.add(Lt));const xn=un===1?qt:Hr.unproject($t.add(Yt.mult(Qr(Tn))).mult(Ln));return Hr.setLocationAtPoint(Hr.renderWorldCopies?xn.wrap():xn,Ft),Hr._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(g),Hr};if(o.preloadOnly){const Hr=this._emulate(en,o.duration,_e);return this._preloadTiles(Hr),this}return this._zooming=!0,this._rotating=Yr,this._pitching=Cn,this._padding=Br,this._prepareEase(g,!1),this._ease(en(_e),()=>this._afterEase(g),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _e=this._onEaseEnd;this._onEaseEnd=void 0,_e.call(this,g)}if(!o){const _e=this.handlers;_e&&_e.stop(!1)}return this}_ease(o,g,_e){_e.animate===!1||_e.duration===0?(o(1),g()):(this._easeStart=h.o.now(),this._easeOptions=_e,this._onEaseFrame=o,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((h.o.now()-this._easeStart)/this._easeOptions.duration,1),g=this._onEaseFrame;g&&g(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,g){o=h.bT(o,-180,180);const _e=Math.abs(o-g);return Math.abs(o-360-g)<_e&&(o-=360),Math.abs(o+360-g)<_e&&(o+=360),o}_normalizeCenter(o){const g=this.transform;if(g.maxBounds||g.projection.name!=="globe"&&!g.renderWorldCopies)return;const _e=o.lng-g.center.lng;o.lng+=_e>180?-360:_e<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&h.o.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,g,_e){const nt=Math.ceil(15*g/1e3),st=[],lt=o(_e.clone());for(let ut=0;ut<=nt;ut++){const pt=lt(ut/nt);st.push(pt.clone())}return st}_preloadTiles(o,g){}}class g_{constructor(o={}){this.options=o,h.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const g=this.options&&this.options.compact,_e=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=At("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=At("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",_e);const nt=At("span","mapboxgl-ctrl-icon",this._compactButton);return nt.setAttribute("aria-hidden","true"),nt.setAttribute("title",_e),this._innerContainer=At("div","mapboxgl-ctrl-attrib-inner",this._container),g&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),g===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const g=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||h.e.ACCESS_TOKEN}];if(o){const _e=g.reduce((nt,st,lt)=>(st.value&&(nt+=`${st.key}=${st.value}${lt<g.length-1?"&":""}`),nt),"?");o.href=`${h.e.FEEDBACK_URL}/${_e}#${xx(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||(o.dataType!=="source"||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility")&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const nt=this._map.style.stylesheet;this.styleOwner=nt.owner,this.styleId=nt.id}const g=this._map.style._mergedSourceCaches;for(const nt in g){const st=g[nt];if(st.used){const lt=st.getSource();lt.attribution&&o.indexOf(lt.attribution)<0&&o.push(lt.attribution)}}o.sort((nt,st)=>nt.length-st.length),o=o.filter((nt,st)=>{for(let lt=st+1;lt<o.length;lt++)if(o[lt].indexOf(nt)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const _e=o.join(" | ");_e!==this._attribHTML&&(this._attribHTML=_e,o.length?(this._innerContainer.innerHTML=_e,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class bp{constructor(){h.aY(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=At("div","mapboxgl-ctrl");const g=At("a","mapboxgl-ctrl-logo");return g.target="_blank",g.rel="noopener nofollow",g.href="https://www.mapbox.com/",g.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),g.setAttribute("rel","noopener nofollow"),this._container.appendChild(g),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const g in o){const _e=o[g].getSource();if(_e.hasOwnProperty("mapbox_logo")&&!_e.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const g=o[0];this._map.getCanvasContainer().offsetWidth<250?g.classList.add("mapboxgl-compact"):g.classList.remove("mapboxgl-compact")}}}class y_{constructor(){h.aY(["_onIndoorUpdate"],this)}onAdd(o){return this._map=o,this._container=At("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",g=>this._onIndoorUpdate({selectedFloorId:g.selectedFloorId,floors:g.floors})),this._container}_createButton(o,g){const _e=At("button",o,this._container);return _e.type="button",_e.addEventListener("click",g),_e}_createSeparator(){return At("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(o,g){this._map&&(o.setAttribute("aria-label",g),o.textContent=g)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(o){if(!o||!o.floors)return void(this._container.style.display="none");const g=this._model;this._model=o,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const _e=o.floors.sort((nt,st)=>st.levelOrder-nt.levelOrder);g?(Array.from(this._container.children).forEach(nt=>nt.remove()),this.addCurrentFloors(_e)):this.addCurrentFloors(_e)}addCurrentFloors(o){for(let g=0;g<o.length;g++){const _e=o[g],nt=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(_e.id),this._model&&(this._model.selectedFloorId=_e.id),Array.from(this._container.children).forEach(st=>{st.classList.contains("mapboxgl-ctrl-level-button")&&st.classList.remove("mapboxgl-ctrl-level-button-selected")}),nt.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(nt,_e.shortName),this._model&&_e.id===this._model.selectedFloorId&&nt.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(nt),g<o.length-1&&this._createSeparator()}}}class ba{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const g=++this._id;return this._queue.push({callback:o,id:g,cancelled:!1}),g}remove(o){const g=this._currentlyRunning,_e=g?this._queue.concat(g):this._queue;for(const nt of _e)if(nt.id===o)return void(nt.cancelled=!0)}run(o=0){const g=this._currentlyRunning=this._queue;this._queue=[];for(const _e of g)if(!_e.cancelled&&(_e.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class wp{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const g=h.dz((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-g)+this._end*g}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,g,_e){this._start=this.getValue(g),this._end=o,this._startTime=g,this._endTime=g+_e}}const __={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class x_ extends h.z{constructor(o,g,_e,nt){const{point:st,lngLat:lt,originalEvent:ut,target:pt}=o;super(o.type,{point:st,lngLat:lt,originalEvent:ut,target:pt}),this.preventDefault=()=>{o.preventDefault()},this.id=g,this.interaction=_e,this.feature=nt}}class _1{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,g){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);const _e=g.filter;let nt=g.type;_e&&this.filters.set(o,h.b6(_e)),nt==="mouseover"&&(nt="mouseenter"),nt==="mouseout"&&(nt="mouseleave");const st=this.interactionsByType.get(nt)||new Map;nt==="mouseenter"||nt==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,g)):st.size===0&&this.map.on(nt,this.handleType),st.size===0&&this.interactionsByType.set(nt,st),st.set(o,g),this.typeById.set(o,nt)}get(o){const g=this.typeById.get(o);if(!g)return;const _e=this.interactionsByType.get(g);return _e?_e.get(o):void 0}remove(o){const g=this.typeById.get(o);if(!g)return;this.typeById.delete(o),this.filters.delete(o);const _e=this.interactionsByType.get(g);_e&&(_e.delete(o),g==="mouseenter"||g==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):_e.size===0&&this.map.off(g,this.handleType))}queryTargets(o,g){const _e=[];for(const[nt,st]of g)st.target&&_e.push({targetId:nt,target:st.target,filter:this.filters.get(nt)});return this.map.style.queryRenderedTargets(o,_e,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const g=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());g.length&&(o.type="mouseenter",this.handleType(o,g));const _e=new Map;for(const[nt,{feature:st}]of this.prevHoveredFeatures)this.hoveredFeatures.has(nt)||_e.set(st.id,st);_e.size&&(o.type="mouseleave",this.handleType(o,Array.from(_e.values())))}handleOut(o){const g=Array.from(this.hoveredFeatures.values()).map(({feature:_e})=>_e);g.length&&(o.type="mouseleave",this.handleType(o,g)),this.hoveredFeatures.clear()}handleType(o,g){const _e=o.type==="mouseenter";if(_e&&!this.interactionsByType.has(o.type))return void h.w("mouseenter interaction required for mouseleave to work.");const nt=Array.from(this.interactionsByType.get(o.type)).reverse(),st=!!g;g=g||this.queryTargets(o.point,nt);let lt=!1;const ut=new Set;for(const pt of g){for(const[yt,vt]of nt){if(!vt.target)continue;const Mt=pt.variants?pt.variants[yt]:null;if(Mt){for(const Et of Mt){if(Il(Et,pt,ut,yt))continue;const Lt=new h.dt(pt,Et),Ft=Kp(Et,pt,yt);st&&(Lt.state=this.map.getFeatureState(Lt));const Ot=_e?this.prevHoveredFeatures.get(Ft):null,qt=new x_(o,yt,vt,Lt),$t=Ot?Ot.stop:vt.handler(qt);if(_e&&this.hoveredFeatures.set(Ft,{feature:pt,stop:$t}),$t!==!1){lt=!0;break}}if(lt)break}}if(lt)break}if(!lt)for(const[pt,yt]of nt){const{handler:vt,target:Mt}=yt;if(!Mt&&vt(new x_(o,pt,yt,null))!==!1)break}}}function qw(et,o){if(Array.isArray(et)&&Array.isArray(o)){const g=new Set(et),_e=new Set(o);return g.size===_e.size&&et.every(nt=>_e.has(nt))}return h.by(et,o)}const v_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Zw={showCompass:!0,showZoom:!0,visualizePitch:!1};class Xw{constructor(o,g,_e=!1){this._clickTolerance=10,this.element=g,this.mouseRotate=new Ex({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,_e&&(this.mousePitch=new Tx({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),h.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),g.addEventListener("mousedown",this.mousedown),g.addEventListener("touchstart",this.touchstart,{passive:!1}),g.addEventListener("touchmove",this.touchmove),g.addEventListener("touchend",this.touchend),g.addEventListener("touchcancel",this.reset)}down(o,g){this.mouseRotate.mousedown(o,g),this.mousePitch&&this.mousePitch.mousedown(o,g),jt()}move(o,g){const _e=this.map,nt=this.mouseRotate.mousemoveWindow(o,g),st=nt&&nt.bearingDelta;if(st&&_e.setBearing(_e.getBearing()+st),this.mousePitch){const lt=this.mousePitch.mousemoveWindow(o,g),ut=lt&&lt.pitchDelta;ut&&_e.setPitch(_e.getPitch()+ut)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ht(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(Object.assign({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),nr(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,nr(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=kr(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=kr(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Rx(et,o,g){if(et=new h.aR(et.lng,et.lat),o){const _e=new h.aR(et.lng-360,et.lat),nt=new h.aR(et.lng+360,et.lat),st=360*Math.ceil(Math.abs(et.lng-g.center.lng)/360),lt=g.locationPoint3D(et).distSqr(o),ut=o.x<0||o.y<0||o.x>g.width||o.y>g.height;g.locationPoint3D(_e).distSqr(o)<lt&&(ut||Math.abs(_e.lng-g.center.lng)<st)?et=_e:g.locationPoint3D(nt).distSqr(o)<lt&&(ut||Math.abs(nt.lng-g.center.lng)<st)&&(et=nt)}for(;Math.abs(et.lng-g.center.lng)>180;){const _e=g.locationPoint3D(et);if(_e.x>=0&&_e.y>=0&&_e.x<=g.width&&_e.y<=g.height)break;et.lng>g.center.lng?et.lng-=360:et.lng+=360}return et}const b_={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Nu={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Km extends h.E{constructor(o,g){super(),(o instanceof HTMLElement||g)&&(o=Object.assign({element:o},g)),h.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:_e="center",color:nt="#3FB1CE",scale:st=1,draggable:lt=!1,clickTolerance:ut=0,rotation:pt=Nu.rotation,rotationAlignment:yt=Nu.rotationAlignment,pitchAlignment:vt=Nu.pitchAlignment,occludedOpacity:Mt=Nu.occludedOpacity,altitude:Et=Nu.altitude}=o||{};this._anchor=_e,this._color=nt,this._scale=st,this._draggable=lt,this._clickTolerance=ut,this._rotation=pt,this._rotationAlignment=yt,this._pitchAlignment=vt,this._occludedOpacity=Mt,this._altitude=Et,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=h.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=h.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Ot=>{Ot.preventDefault()}),this._element.addEventListener("mousedown",Ot=>{Ot.preventDefault()});const Lt=this._element.classList;for(const Ot in b_)Lt.remove(`mapboxgl-marker-anchor-${Ot}`);Lt.add(`mapboxgl-marker-anchor-${this._anchor}`);const Ft=o&&o.className?o.className.trim().split(/\s+/):[];Lt.add(...Ft),this._popup=null}_createDefaultMarker(){const o=At("div"),g=Bt("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){const _e=Bt("radialGradient",{id:"shadowGradient"},Bt("defs",{},g));Bt("stop",{offset:"10%","stop-opacity":.4},_e),Bt("stop",{offset:"100%","stop-opacity":.05},_e),Bt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},g)}return Bt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},g),Bt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},g),Bt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},g),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=h.aR.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||Nu.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const nt=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[nt,-1*(38.1-13.5+nt)],"bottom-right":[-nt,-1*(38.1-13.5+nt)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const g=o.code,_e=o.charCode||o.keyCode;g!=="Space"&&g!=="Enter"&&_e!==32&&_e!==13||this.togglePopup()}_onMapClick(o){const g=o.originalEvent.target,_e=this._element;this._popup&&(g===_e||_e.contains(g))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,g=this._pos;if(!o||!g)return!1;const _e=o.unproject(g,this._altitude),nt=o.getFreeCameraOptions();if(!nt.position)return!1;const st=nt.position.toLngLat();return st.distanceTo(_e)<.9*st.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const g=this._pos;if(!g||g.x<0||g.x>o.transform.width||g.y<0||g.y>o.transform.height)return void this._clearFadeTimer();const _e=o.unproject(g,this._altitude);let nt;o._showingGlobe()&&h.eY(o.transform,this._lngLat)?nt=0:(nt=1-o._queryFogOpacity(_e),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(nt*=this._occludedOpacity)),this._element.style.opacity=`${nt}`,this._element.style.pointerEvents=nt>0?"auto":"none",this._popup&&this._popup._setOpacity(nt),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const g=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${b_[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${g.x}px,${g.y}px)
        `}_calculateXYTransform(){const o=this._pos,g=this._map,_e=this.getPitchAlignment();if(!g||!o||_e!=="map")return"";if(!g._showingGlobe()){const pt=g.getPitch();return pt?`rotateX(${pt}deg)`:""}const nt=h.cW(h.eZ(g.transform,this._lngLat)),st=o.sub(h.e_(g.transform)),lt=Math.abs(st.x)+Math.abs(st.y);if(lt===0)return"";const ut=nt/lt;return`rotateX(${-st.y*ut}deg) rotateY(${st.x*ut}deg)`}_calculateZTransform(){const o=this._pos,g=this._map;if(!g||!o)return"";let _e=0;const nt=this.getRotationAlignment();if(nt==="map")if(g._showingGlobe()){const st=g.project(new h.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),lt=g.project(new h.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(st);_e=h.cW(Math.atan2(lt.y,lt.x))-90}else _e=-g.getBearing();else if(nt==="horizon"){const st=h.ah(4,6,g.getZoom()),lt=h.e_(g.transform);lt.y+=st*g.transform.height;const ut=o.sub(lt),pt=h.cW(Math.atan2(ut.y,ut.x));_e=(pt>90?pt-270:pt+90)*(1-st)}return _e+=this._rotation,_e?`rotateZ(${_e}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const g=this._map;g&&(g.transform.renderWorldCopies&&(this._lngLat=Rx(this._lngLat,this._pos,g.transform)),this._pos=g.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),g._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(g._showingGlobe()||g.getTerrain()||g.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=h.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const g=this._map;if(!g)return;const _e=this._pointerdownPos,nt=this._positionDelta;if(_e&&nt){if(!this._isDragging){const st=this._clickTolerance||g._clickTolerance;if(o.point.dist(_e)<st)return;this._isDragging=!0}this._pos=o.point.sub(nt),this._lngLat=g.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.z("dragstart"))),this.fire(new h.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new h.z("dragend")),this._state="inactive"}_addDragHandler(o){const g=this._map,_e=this._pos;g&&_e&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(_e),this._pointerdownPos=o.point,this._state="pending",g.on("mousemove",this._onMove),g.on("touchmove",this._onMove),g.once("mouseup",this._onUp),g.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const g=this._map;return g&&(o?(g.on("mousedown",this._addDragHandler),g.on("touchstart",this._addDragHandler)):(g.off("mousedown",this._addDragHandler),g.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||Nu.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||Nu.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||Nu.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||Nu.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const xm={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Op={maxWidth:100,unit:"metric"},zp={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ym={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},lp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function x1(et=new h.P(0,0),o="bottom"){if(typeof et=="number"){const g=Math.round(Math.sqrt(.5*Math.pow(et,2)));switch(o){case"top":return new h.P(0,et);case"top-left":return new h.P(g,g);case"top-right":return new h.P(-g,g);case"bottom":return new h.P(0,-et);case"bottom-left":return new h.P(g,-g);case"bottom-right":return new h.P(-g,-g);case"left":return new h.P(et,0);case"right":return new h.P(-et,0)}return new h.P(0,0)}return et instanceof h.P||Array.isArray(et)?h.P.convert(et):h.P.convert(et[o]||[0,0])}return{version:dt,supported:Dt.supported,setRTLTextPlugin:h.f2,getRTLTextPluginStatus:h.f1,Map:class extends Gv{constructor(et){xt.mark(ft.create);const o=et;if((et=Object.assign({},v_,et)).minZoom!=null&&et.maxZoom!=null&&et.minZoom>et.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(et.minPitch!=null&&et.maxPitch!=null&&et.minPitch>et.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(et.minPitch!=null&&et.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(et.maxPitch!=null&&et.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(et.antialias&&h.eW(window)&&(et.antialias=!1,h.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new eu(et.minZoom,et.maxZoom,et.minPitch,et.maxPitch,et.renderWorldCopies,null,null),et),this._repaint=!!et.repaint,this._interactive=et.interactive,this._minTileCacheSize=et.minTileCacheSize,this._maxTileCacheSize=et.maxTileCacheSize,this._failIfMajorPerformanceCaveat=et.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=et.preserveDrawingBuffer,this._antialias=et.antialias,this._trackResize=et.trackResize,this._bearingSnap=et.bearingSnap,this._refreshExpiredTiles=et.refreshExpiredTiles,this._fadeDuration=et.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=et.crossSourceCollisions,this._collectResourceTiming=et.collectResourceTiming,this._language=this._parseLanguage(et.language),this._worldview=et.worldview,this._renderTaskQueue=new ba,this._domRenderTaskQueue=new ba,this._controls=[],this._markers=[],this._popups=[],this._mapId=h.b2(),this._locale=Object.assign({},__,et.locale),this._clickTolerance=et.clickTolerance,this._cooperativeGestures=et.cooperativeGestures,this._performanceMetricsCollection=et.performanceMetricsCollection,this._tessellationStep=et.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=et.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new wp(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=et.scaleFactor,this._requestManager=new Zr(et.transformRequest,et.accessToken,et.testMode),this._silenceAuthErrors=!!et.testMode,this._contextCreateOptions=et.contextCreateOptions?Object.assign({},et.contextCreateOptions):{},typeof et.container=="string"){const g=document.getElementById(et.container);if(!g)throw new Error(`Container '${et.container.toString()}' not found.`);this._container=g}else{if(!(et.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=et.container}if(this._container.childNodes.length>0&&h.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),et.maxBounds&&this.setMaxBounds(et.maxBounds),this._spriteFormat=et.spriteFormat,h.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Iy),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new m_(this,et),this._localFontFamily=et.localFontFamily,this._localIdeographFontFamily=et.localIdeographFontFamily,(et.style||!et.testMode)&&this.setStyle(et.style||h.e.DEFAULT_STYLE,{config:et.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),et.projection&&this.setProjection(et.projection),this.indoor=new Dm(this),et.hash&&(this._hash=new kv(typeof et.hash=="string"&&et.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:et.center,zoom:et.zoom,bearing:et.bearing,pitch:et.pitch});const g=et.bounds;g&&(this.resize(),this.fitBounds(g,Object.assign({},et.fitBoundsOptions,{duration:0})))}this.resize(),et.attributionControl&&this.addControl(new g_({customAttribution:et.customAttribution})),this._logoControl=new bp,this.addControl(this._logoControl,et.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",g=>{this._update(g.dataType==="style"),this.fire(new h.z(`${g.dataType}data`,g))}),this.on("dataloading",g=>{this.fire(new h.z(`${g.dataType}dataloading`,g))}),this._interactions=new _1(this)}_getMapId(){return this._mapId}addControl(et,o){if(o===void 0&&(o=et.getDefaultPosition?et.getDefaultPosition():"top-right"),!et||!et.onAdd)return this.fire(new h.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const g=et.onAdd(this);this._controls.push(et);const _e=this._controlPositions[o];return o.indexOf("bottom")!==-1?_e.insertBefore(g,_e.firstChild):_e.appendChild(g),this}removeControl(et){if(!et||!et.onRemove)return this.fire(new h.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(et);return o>-1&&this._controls.splice(o,1),et.onRemove(this),this}hasControl(et){return this._controls.indexOf(et)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(et){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new h.z("movestart",et)).fire(new h.z("move",et)),this.fire(new h.z("resize",et)),o&&this.fire(new h.z("moveend",et)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(et){return this.transform.setMaxBounds(h.aI.convert(et)),this._update()}setMinZoom(et){if((et=et??-2)>=-2&&et<=this.transform.maxZoom)return this.transform.minZoom=et,this._update(),this.getZoom()<et?this.setZoom(et):this.fire(new h.z("zoomstart")).fire(new h.z("zoom")).fire(new h.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(et){if((et=et??22)>=this.transform.minZoom)return this.transform.maxZoom=et,this._update(),this.getZoom()>et?this.setZoom(et):this.fire(new h.z("zoomstart")).fire(new h.z("zoom")).fire(new h.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(et){if((et=et??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(et>=0&&et<=this.transform.maxPitch)return this.transform.minPitch=et,this._update(),this.getPitch()<et?this.setPitch(et):this.fire(new h.z("pitchstart")).fire(new h.z("pitch")).fire(new h.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(et){if((et=et??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(et>=this.transform.minPitch)return this.transform.maxPitch=et,this._update(),this.getPitch()>et?this.setPitch(et):this.fire(new h.z("pitchstart")).fire(new h.z("pitch")).fire(new h.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(et){return this._scaleFactor=et,this.painter.scaleFactor=et,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(et){return this.transform.renderWorldCopies=et,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(et){return et==="auto"?navigator.language:Array.isArray(et)?et.length===0?void 0:et.map(o=>o==="auto"?navigator.language:o):et}setLanguage(et){const o=this._parseLanguage(et);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const g of this._controls)g._setLanguage&&g._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(et){return this.style&&et!==this._worldview?(this._worldview=et,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(et){return this._lazyInitEmptyStyle(),et?typeof et=="string"&&(et={name:et}):et=null,this._useExplicitProjection=!!et,this._prioritizeAndUpdateProjection(et,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const et=this.transform,o=et.projection.name;let g;o==="globe"&&et.zoom>=h.cK?(et.setMercatorFromTransition(),g=!0):o==="mercator"&&et.zoom<h.cK&&(et.setProjection({name:"globe"}),g=!0),g&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(et,o){return this._updateProjection(et||o||{name:"mercator"})}_updateProjection(et){let o;return o=et.name==="globe"&&this.transform.zoom>=h.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(et),this.style.applyProjectionUpdate(),o&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(et,o){return this.transform.locationPoint3D(h.aR.convert(et),o)}unproject(et,o){return this.transform.pointLocation3D(h.P.convert(et),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(et,o,g){const _e=nt=>{let st=[];if(Array.isArray(o)){const lt=o.filter(ut=>this.getLayer(ut));st=lt.length?this.queryRenderedFeatures(nt,{layers:lt}):[]}else st=this.queryRenderedFeatures(nt,{target:o});return st};if(et==="mouseenter"||et==="mouseover"){let nt=!1;return{listener:g,targets:o,delegates:{mousemove:lt=>{const ut=_e(lt.point);ut.length?nt||(nt=!0,g.call(this,new Sl(et,this,lt.originalEvent,{features:ut}))):nt=!1},mouseout:()=>{nt=!1}}}}if(et==="mouseleave"||et==="mouseout"){let nt=!1;return{listener:g,targets:o,delegates:{mousemove:ut=>{_e(ut.point).length?nt=!0:nt&&(nt=!1,g.call(this,new Sl(et,this,ut.originalEvent)))},mouseout:ut=>{nt&&(nt=!1,g.call(this,new Sl(et,this,ut.originalEvent)))}}}}{const nt=st=>{const lt=_e(st.point);lt.length&&(st.features=lt,g.call(this,st),delete st.features)};return{listener:g,targets:o,delegates:{[et]:nt}}}}on(et,o,g){if(typeof o=="function"||g===void 0)return super.on(et,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const _e=this._createDelegatedListener(et,o,g);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[et]=this._delegatedListeners[et]||[],this._delegatedListeners[et].push(_e);for(const nt in _e.delegates)this.on(nt,_e.delegates[nt]);return this}once(et,o,g){if(typeof o=="function"||g===void 0)return super.once(et,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const _e=this._createDelegatedListener(et,o,g);for(const nt in _e.delegates)this.once(nt,_e.delegates[nt]);return this}off(et,o,g){if(typeof o=="function"||g===void 0)return super.off(et,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const _e=this._delegatedListeners?this._delegatedListeners[et]:void 0;return _e&&(nt=>{for(let st=0;st<nt.length;st++){const lt=nt[st];if(lt.listener===g&&qw(lt.targets,o)){for(const ut in lt.delegates)this.off(ut,lt.delegates[ut]);return nt.splice(st,1),this}}})(_e),this}queryRenderedFeatures(et,o){if(!this.style)return[];if(et===void 0||et instanceof h.P||Array.isArray(et)||o!==void 0||(o=et,et=void 0),et=et||[[0,0],[this.transform.width,this.transform.height]],!o){const st=this.style.queryRenderedFeatures(et,void 0,this.transform),lt=this.style.queryRenderedFeatureset(et,void 0,this.transform);return st.concat(lt)}let g=!0;if(o.target&&(g=this._isTargetValid(o.target),g&&!o.layers))return this.style.queryRenderedFeatureset(et,o,this.transform);let _e=!0;if(o.layers&&Array.isArray(o.layers)){for(const st of o.layers)if(!this._isValidId(st)){_e=!1;break}if(_e&&!o.target)return this.style.queryRenderedFeatures(et,o,this.transform)}let nt=[];return _e&&(nt=nt.concat(this.style.queryRenderedFeatures(et,o,this.transform))),g&&(nt=nt.concat(this.style.queryRenderedFeatureset(et,o,this.transform))),nt}querySourceFeatures(et,o){return!et||typeof et=="string"&&!this._isValidId(et)?[]:this.style.querySourceFeatures(et,o)}queryRasterValue(et,o,g){return this._isValidId(et)?this.style.queryRasterValue(et,o,g):Promise.resolve(null)}isPointOnSurface(et){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&h.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(h.P.convert(et))}addInteraction(et,o){return this._interactions.add(et,o),this}removeInteraction(et){return this._interactions.remove(et),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(et){return this._cooperativeGestures=et,this}setStyle(et,o){return o=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&et&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(et,(g,_e)=>{if(g){const nt=typeof g=="string"?g:g instanceof Error?g.message:g.error;h.w(`Unable to perform style diff: ${nt}. Rebuilding the style from scratch.`),this._updateStyle(et,o)}else _e&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(et,o))}_getUIString(et){const o=this._locale[et];if(o==null)throw new Error(`Missing UI string '${et}'`);return o}_updateStyle(et,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),et){const g=Object.assign({},o);o&&o.config&&(g.initialConfig=o.config,delete g.config),this.style=new Yu(this,g).load(et),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Yu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(h.w("There is no style added to the map."),!1)}_isValidId(et){return et==null?(this.fire(new h.y(new Error("IDs can't be empty."))),!1):!h.dm(et)||(this.fire(new h.y(new Error(`IDs can't contain special symbols: "${et}".`))),!1)}_isTargetValid(et){return"featuresetId"in et?this._isValidId("importId"in et?et.importId:et.featuresetId):"layerId"in et&&this._isValidId(et.layerId)}_areTargetsValid(et){if(Array.isArray(et)){for(const o of et)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(et)}addSource(et,o){return this._isValidId(et)?(this._lazyInitEmptyStyle(),this.style.addSource(et,o),this._update(!0)):this}isSourceLoaded(et){return!!this._isValidId(et)&&!!this.style&&this.style._isSourceCacheLoaded(et)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(et,o,g){this._lazyInitEmptyStyle(),this.style.addSourceType(et,o,g)}removeSource(et){return this._isValidId(et)?(this.style.removeSource(et),this._updateTerrain(),this._update(!0)):this}getSource(et){return this._isValidId(et)?this.style.getOwnSource(et):null}addImage(et,o,{pixelRatio:g=1,sdf:_e=!1,stretchX:nt,stretchY:st,content:lt}={}){this._lazyInitEmptyStyle();const ut=h.I.from(et);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:pt,height:yt,data:vt}=h.o.getImageData(o);this.style.addImage(ut,{data:new h.q({width:pt,height:yt},vt),pixelRatio:g,stretchX:nt,stretchY:st,content:lt,sdf:_e,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new h.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:pt,height:yt}=o,vt=o;this.style.addImage(ut,{data:new h.q({width:pt,height:yt},new Uint8Array(vt.data)),pixelRatio:g,stretchX:nt,stretchY:st,content:lt,sdf:_e,usvg:!1,version:0,userImage:vt}),vt.onAdd&&vt.onAdd(this,et)}}updateImage(et,o){this._lazyInitEmptyStyle();const g=h.I.from(et),_e=this.style.getImage(g);if(!_e)return void this.fire(new h.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const nt=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?h.o.getImageData(o):o,{width:st,height:lt,data:ut}=nt;if(st===void 0||lt===void 0)return void this.fire(new h.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(st!==(_e.usvg?_e.icon.usvg_tree.width:_e.data.width)||lt!==(_e.usvg?_e.icon.usvg_tree.height:_e.data.height))return void this.fire(new h.y(new Error(`The width and height of the updated image (${st}, ${lt})
                must be that same as the previous version of the image
                (${_e.data.width}, ${_e.data.height})`)));const pt=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);let yt=!1;_e.usvg?(_e.data=new h.q({width:st,height:lt},new Uint8Array(ut)),_e.usvg=!1,_e.icon=void 0,yt=!0):_e.data.replace(ut,pt),this.style.updateImage(g,_e,yt)}hasImage(et){return et?!!this.style&&!!this.style.getImage(h.I.from(et)):(this.fire(new h.y(new Error("Missing required image id"))),!1)}removeImage(et){this.style.removeImage(h.I.from(et))}loadImage(et,o){h.n(this._requestManager.transformRequest(et,h.R.Image),(g,_e)=>{o(g,_e instanceof HTMLImageElement?h.o.getImageData(_e):_e)})}listImages(){return this.style.listImages().map(et=>et.name)}addModel(et,o){this._lazyInitEmptyStyle(),this.style.addModel(et,o)}hasModel(et){return et?this.style.hasModel(et):(this.fire(new h.y(new Error("Missing required model id"))),!1)}removeModel(et){this.style.removeModel(et)}listModels(){return this.style.listModels()}addLayer(et,o){return this._isValidId(et.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(et,o),this._update(!0)):this}getSlot(et){const o=this.getLayer(et);return o&&o.slot||null}setSlot(et,o){return this.style.setSlot(et,o),this.style.mergeLayers(),this._update(!0)}addImport(et,o){return this.style.addImport(et,o).catch(g=>this.fire(new h.y(new Error("Failed to add import",g)))),this}updateImport(et,o){return typeof o!="string"&&o.id!==et?(this.removeImport(et),this.addImport(o)):(this.style.updateImport(et,o),this._update(!0))}removeImport(et){return this.style.removeImport(et),this}moveImport(et,o){return this.style.moveImport(et,o),this._update(!0)}moveLayer(et,o){return this._isValidId(et)?(this.style.moveLayer(et,o),this._update(!0)):this}removeLayer(et){return this._isValidId(et)?(this.style.removeLayer(et),this._update(!0)):this}getLayer(et){if(!this._isValidId(et))return null;const o=this.style.getOwnLayer(et);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(et,o,g){return this._isValidId(et)?(this.style.setLayerZoomRange(et,o,g),this._update(!0)):this}setFilter(et,o,g={}){return this._isValidId(et)?(this.style.setFilter(et,o,g),this._update(!0)):this}getFilter(et){return this._isValidId(et)?this.style.getFilter(et):null}setPaintProperty(et,o,g,_e={}){return this._isValidId(et)?(this.style.setPaintProperty(et,o,g,_e),this._update(!0)):this}getPaintProperty(et,o){return this._isValidId(et)?this.style.getPaintProperty(et,o):null}setLayoutProperty(et,o,g,_e={}){return this._isValidId(et)?(this.style.setLayoutProperty(et,o,g,_e),this._update(!0)):this}getLayoutProperty(et,o){return this._isValidId(et)?this.style.getLayoutProperty(et,o):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(et){return this.style.setGlyphsUrl(et),this._update(!0)}getSchema(et){return this.style.getSchema(et)}setSchema(et,o){return this.style.setSchema(et,o),this._update(!0)}getConfig(et){return this.style.getConfig(et)}setConfig(et,o){return this.style.setConfig(et,o),this._update(!0)}getConfigProperty(et,o){return this.style.getConfigProperty(et,o)}setConfigProperty(et,o,g){return this.style.setConfigProperty(et,o,g),this._update(!0)}getFeaturesetDescriptors(et){return this.style.getFeaturesetDescriptors(et)}setLights(et){if(this._lazyInitEmptyStyle(),et&&et.length===1&&et[0].type==="flat"){const o=et[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(et),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const et=this.style.getLights()||[];return et.length===0&&et.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),et}setLight(et,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:et}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(et){return this._lazyInitEmptyStyle(),!et&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(et),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(et){return this._lazyInitEmptyStyle(),this.style.setFog(et),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(et){return this._lazyInitEmptyStyle(),this.style.setSnow(et),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(et){return this._lazyInitEmptyStyle(),this.style.setRain(et),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(et){return this._lazyInitEmptyStyle(),this.style.setColorTheme(et),this._update(!0)}setImportColorTheme(et,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(et,o),this._update(!0)}setCamera(et){return this.style.setCamera(et),this._triggerCameraUpdate(et)}_triggerCameraUpdate(et){return this._update(this.transform.setOrthographicProjectionAtLowPitch(et["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(et){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(h.aR.convert(et),this.transform):0}setFeatureState(et,o){return et.source&&!this._isValidId(et.source)?this:(this.style.setFeatureState(et,o),this._update())}removeFeatureState(et,o){return et.source&&!this._isValidId(et.source)?this:(this.style.removeFeatureState(et,o),this._update())}getFeatureState(et){return et.source&&!this._isValidId(et.source)?null:this.style.getFeatureState(et)}_selectIndoorFloor(et){this.indoor.selectFloor(et)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new y_),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const et=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let g,_e,nt,st=this._container;for(;st&&(!_e||!nt);){const lt=window.getComputedStyle(st).transform;lt&&lt!=="none"&&(g=lt.match(/matrix.*\((.+)\)/)[1].split(", "),g[0]&&g[0]!=="0"&&g[0]!=="1"&&(_e=g[0]),g[3]&&g[3]!=="0"&&g[3]!=="1"&&(nt=g[3])),st=st.parentElement}this._containerWidth=_e?Math.abs(et/_e):et,this._containerHeight=nt?Math.abs(o/nt):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&h.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const et=this._container;et.classList.add("mapboxgl-map"),(this._missingCSSCanary=At("div","mapboxgl-canary",et)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=At("div","mapboxgl-canvas-container",et);this._canvas=At("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const g=this._controlContainer=At("div","mapboxgl-control-container",et),_e=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(nt=>{_e[nt]=At("div",`mapboxgl-ctrl-${nt}`,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(et,o){const g=h.o.devicePixelRatio||1;this._canvas.width=g*Math.ceil(et),this._canvas.height=g*Math.ceil(o),this._canvas.style.width=`${et}px`,this._canvas.style.height=`${o}px`}_addMarker(et){this._markers.push(et)}_removeMarker(et){const o=this._markers.indexOf(et);o!==-1&&this._markers.splice(o,1)}_addPopup(et){this._popups.push(et)}_removePopup(et){const o=this._popups.indexOf(et);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const et=Object.assign({},Dt.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",et);o?(Po(o,!0),this.painter=new Mv(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",g=>{g.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),h.k.testSupport(o)):this.fire(new h.y(new Error("Failed to initialize WebGL")))}_contextLost(et){et.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.z("webglcontextlost",{originalEvent:et}))}_contextRestored(et){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new h.z("webglcontextrestored",{originalEvent:et}))}_onMapScroll(et){if(et.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(et){return this.style?(this._styleDirty=this._styleDirty||et,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(et){return this._update(),this._renderTaskQueue.add(et)}_cancelRenderFrame(et){this._renderTaskQueue.remove(et)}_requestDomTask(et){!this.loaded()||this.loaded()&&!this.isMoving()?et():this._domRenderTaskQueue.add(et)}_render(et){let o;this.fire(new h.z("renderstart")),++this._frameId;const g=this.painter.context.extTimerQuery,_e=h.o.now(),nt=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=nt.createQuery(),nt.beginQuery(g.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(et),this._domRenderTaskQueue.run(et),this._removed)return;this._updateProjectionTransition();const st=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const yt=this.transform.zoom,vt=this.transform.pitch,Mt=h.o.now(),Et=new h.ac(yt,{now:Mt,fadeDuration:st,pitch:vt,transition:this.style.transition,worldview:this._worldview});this.style.update(Et)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let lt=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),lt=this._updateAverageElevation(_e),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):lt=this._updateAverageElevation(_e);const ut=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,st,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),ut&&(this._placementDirty=ut.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:st,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new h.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,xt.mark(ft.load),this.fire(new h.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const yt=h.o.now()-_e;nt.endQuery(g.TIME_ELAPSED_EXT),setTimeout(()=>{const vt=nt.getQueryParameter(o,nt.QUERY_RESULT)/1e6;nt.deleteQuery(o),this.fire(new h.z("gpu-timing-frame",{cpuTime:yt,gpuTime:vt}))},50)}if(this.listens("gpu-timing-layer")){const yt=this.painter.collectGpuTimers();setTimeout(()=>{const vt=this.painter.queryGpuTimers(yt);this.fire(new h.z("gpu-timing-layer",{layerTimes:vt}))},50)}if(this.listens("gpu-timing-deferred-render")){const yt=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const vt=this.painter.queryGpuTimeDeferredRender(yt);this.fire(new h.z("gpu-timing-deferred-render",{gpuTime:vt}))},50)}const pt=this._sourcesDirty||this._styleDirty||this._placementDirty||lt;if(pt||this._repaint)this.triggerRepaint();else{const yt=this.idle();if(yt&&(lt=this._updateAverageElevation(_e,!0)),lt)this.triggerRepaint();else if(this._triggerFrame(!1),yt&&(this.fire(new h.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const vt=this._calculateSpeedIndex();this.fire(new h.z("speedindexcompleted",{speedIndex:vt})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||pt||(this._fullyLoaded=!0,xt.mark(ft.fullLoad),this._performanceMetricsCollection&&$s(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(et){for(const o of this._markers)et&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!et||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(et,o=!1){const g=nt=>(this.transform.averageElevation=nt,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&g(0);const _e=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_e||(o||et-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(et)){const nt=this.transform.averageElevation;let st=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(st)?st=0:this._averageElevationLastSampledAt=et;const lt=Math.abs(nt-st);if(lt>1){if(this._isInitialLoad||_e)return this._averageElevation.jumpTo(st),g(st);this._averageElevation.easeTo(st,et,300)}else if(lt>1e-4)return this._averageElevation.jumpTo(st),g(st)}return!!this._averageElevation.isEasing(et)&&g(this._averageElevation.getValue(et))}_authenticate(){Vs(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,et=>{if(et&&(et.message===rn||et.status===401)){const o=this.painter.context.gl;Po(o,!1),this._logoControl instanceof bp&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new h.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Zn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&ss(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const et=this._isDragging();this.painter.updateTerrain(this.style,et)}_calculateSpeedIndex(){const et=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const g=this.painter.context.gl,_e=g.createFramebuffer();function nt(st){g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,st,0);const lt=new Uint8Array(g.drawingBufferWidth*g.drawingBufferHeight*4);return g.readPixels(0,0,g.drawingBufferWidth,g.drawingBufferHeight,g.RGBA,g.UNSIGNED_BYTE,lt),lt}return g.bindFramebuffer(g.FRAMEBUFFER,_e),this._canvasPixelComparison(nt(et),o.canvasCopies.map(nt),o.timeStamps)}_canvasPixelComparison(et,o,g){let _e=g[1]-g[0];const nt=et.length/4;for(let st=0;st<o.length;st++){const lt=o[st];let ut=0;for(let pt=0;pt<lt.length;pt+=4)lt[pt]===et[pt]&&lt[pt+1]===et[pt+1]&&lt[pt+2]===et[pt+2]&&lt[pt+3]===et[pt+3]&&(ut+=1);_e+=(g[st+2]-g[st+1])*(1-ut/nt)}return _e}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const et=this.painter.context.gl.getExtension("WEBGL_lose_context");et&&et.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),bo.delete(this.painter.context.gl),vo.remove(),On.remove(),this._removed=!0,this.fire(new h.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(et){this._renderNextFrame=this._renderNextFrame||et,this.style&&!this._frame&&(this._frame=h.o.frame(o=>{const g=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,g&&this._render(o)}))}_preloadTiles(et){const o=this.style?this.style.getSourceCaches():[];return h.bw(o,(g,_e)=>g._preloadTiles(et,_e),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(et){this._trackResize&&this.resize({originalEvent:et})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(et){this._showTileBoundaries!==et&&(this._showTileBoundaries=et,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(et){this._showParseStatus!==et&&(this._showParseStatus=et,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(et){this._showTerrainWireframe!==et&&(this._showTerrainWireframe=et,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(et){this._showLayers2DWireframe!==et&&(this._showLayers2DWireframe=et,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(et){this._showLayers3DWireframe!==et&&(this._showLayers3DWireframe=et,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(et){this._speedIndexTiming!==et&&(this._speedIndexTiming=et,this._update())}get showPadding(){return!!this._showPadding}set showPadding(et){this._showPadding!==et&&(this._showPadding=et,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(et){this._showCollisionBoxes!==et&&(this._showCollisionBoxes=et,this._tp.refreshUI(),et?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(et){this._showOverdrawInspector!==et&&(this._showOverdrawInspector=et,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(et){this._repaint!==et&&(this._repaint=et,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(et){this._vertices=et,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(et){this._showTileAABBs!==et&&(this._showTileAABBs=et,this._tp.refreshUI(),et&&this._update())}_setCacheLimits(et,o){h.eX(et,o)}get version(){return dt}},NavigationControl:class{constructor(et={}){this.options=Object.assign({},Zw,et),this._container=At("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(h.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),At("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),At("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(h.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const g=this._map;g&&(this.options.visualizePitch?g.resetNorthPitch({},{originalEvent:o}):g.resetNorth({},{originalEvent:o}))}),this._compassIcon=At("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const et=this._map;if(!et)return;const o=et.getZoom(),g=o===et.getMaxZoom(),_e=o===et.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=_e,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",_e.toString())}_rotateCompassArrow(){const et=this._map;if(!et)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(et.transform.pitch*(Math.PI/180)),.5)}) rotateX(${et.transform.pitch}deg) rotateZ(${et.transform.angle*(180/Math.PI)}deg)`:`rotate(${et.transform.angle*(180/Math.PI)}deg)`;et._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(et){return this._map=et,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),et.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&et.on("pitch",this._rotateCompassArrow),et.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Xw(et,this._compass,this.options.visualizePitch)),this._container}onRemove(){const et=this._map;et&&(this._container.remove(),this.options.showZoom&&et.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&et.off("pitch",this._rotateCompassArrow),et.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(et,o){const g=At("button",et,this._container);return g.type="button",g.addEventListener("click",o),g}_setButtonTitle(et,o){if(!this._map)return;const g=this._map._getUIString(`NavigationControl.${o}`);et.setAttribute("aria-label",g),et.firstElementChild&&et.firstElementChild.setAttribute("title",g)}},GeolocateControl:class extends h.E{constructor(et={}){super();const o=navigator.geolocation;this.options=Object.assign({geolocation:o},xm,et),h.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=_x(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(et){return this._map=et,this._container=At("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(et){const o=(g=!!this.options.geolocation)=>{this._supportsGeolocation=g,et(g)};this._supportsGeolocation!==void 0?et(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(g=>o(g.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(et){const o=this._map.getMaxBounds(),g=et.coords;return!!o&&(g.longitude<o.getWest()||g.longitude>o.getEast()||g.latitude<o.getSouth()||g.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(et){if(this._map){if(this._isOutOfMapMaxBounds(et))return this._setErrorState(),this.fire(new h.z("outofmaxbounds",et)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=et,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(et),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(et),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new h.z("geolocate",et)),this._finish()}}_updateCamera(et){const o=new h.aR(et.coords.longitude,et.coords.latitude),g=et.coords.accuracy,_e=this._map.getBearing(),nt=Object.assign({bearing:_e},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(g),nt,{geolocateSource:!0})}_updateMarker(et){if(et){const o=new h.aR(et.coords.longitude,et.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=et.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const et=this._map.transform,o=h.ce(1,et._center.lat)*et.worldSize,g=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(et){if(this._map){if(this.options.trackUserLocation)if(et.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(et.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new h.z("error",et)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(et){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=At("button","mapboxgl-ctrl-geolocate",this._container),At("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",et===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=At("div","mapboxgl-user-location"),this._dotElement.appendChild(At("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(At("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Km({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=At("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Km({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new h.z("trackuserlocationend")))})}}_onDeviceOrientation(et){this._userLocationDotMarker&&(et.webkitCompassHeading?this._heading=et.webkitCompassHeading:et.absolute===!0&&(this._heading=-1*et.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let et;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(et={maximumAge:6e5,timeout:0},this._noTimeout=!0):(et=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,et),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const et=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&et()}).catch(console.error):et()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:g_,ScaleControl:class{constructor(et={}){this.options=Object.assign({},Op,et),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),h.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const et=this.options.maxWidth||100,o=this._map,g=o._containerHeight/2,_e=o._containerWidth/2-et/2,nt=o.unproject([_e,g]),st=o.unproject([_e+et,g]),lt=nt.distanceTo(st);if(this.options.unit==="imperial"){const ut=3.2808*lt;ut>5280?this._setScale(et,ut/5280,"mile"):this._setScale(et,ut,"foot")}else this.options.unit==="nautical"?this._setScale(et,lt/1852,"nautical-mile"):lt>=1e3?this._setScale(et,lt/1e3,"kilometer"):this._setScale(et,lt,"meter")}_setScale(et,o,g){this._map._requestDomTask(()=>{const _e=function(st){const lt=Math.pow(10,`${Math.floor(st)}`.length-1);let ut=st/lt;return ut=ut>=10?10:ut>=5?5:ut>=3?3:ut>=2?2:ut>=1?1:function(pt){const yt=Math.pow(10,Math.ceil(-Math.log(pt)/Math.LN10));return Math.round(pt*yt)/yt}(ut),lt*ut}(o),nt=_e/o;this._container.innerHTML=this._isNumberFormatSupported&&g!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:g}).format(_e):`${_e}&nbsp;${zp[g]}`,this._container.style.width=et*nt+"px"})}onAdd(et){return this._map=et,this._language=et.getLanguage(),this._container=At("div","mapboxgl-ctrl mapboxgl-ctrl-scale",et.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(et){this._language=et,this._update()}setUnit(et){this.options.unit=et,this._update()}},FullscreenControl:class{constructor(et={}){this._fullscreen=!1,et&&et.container&&(et.container instanceof HTMLElement?this._container=et.container:h.w("Full screen control 'container' must be a DOM element.")),h.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(et){return this._map=et,this._container||(this._container=this._map.getContainer()),this._controlContainer=At("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const et=this._fullscreenButton=At("button","mapboxgl-ctrl-fullscreen",this._controlContainer);At("span","mapboxgl-ctrl-icon",et).setAttribute("aria-hidden","true"),et.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const et=this._getTitle();this._fullscreenButton.setAttribute("aria-label",et),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",et)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:y_,Popup:class extends h.E{constructor(et){super(),this.options=Object.assign(Object.create(Ym),et),this._altitude=this.options.altitude,h.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(et&&et.className?et.className.trim().split(/\s+/):[])}addTo(et){return this._map&&this.remove(),this._map=et,this.options.closeOnClick&&et.on("preclick",this._onClose),this.options.closeOnMove&&et.on("move",this._onClose),et.on("remove",this.remove),this._update(),et._addPopup(this),this._focusFirstElement(),this._trackPointer?(et.on("mousemove",this._onMouseEvent),et.on("mouseup",this._onMouseEvent),et._canvasContainer.classList.add("mapboxgl-track-pointer")):et.on("move",this._update),this.fire(new h.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const et=this._map;return et&&(et.off("move",this._update),et.off("move",this._onClose),et.off("preclick",this._onClose),et.off("click",this._onClose),et.off("remove",this.remove),et.off("mousemove",this._onMouseEvent),et.off("mouseup",this._onMouseEvent),et.off("drag",this._onMouseEvent),et._canvasContainer&&et._canvasContainer.classList.remove("mapboxgl-track-pointer"),et._removePopup(this),this._map=void 0),this.fire(new h.z("close")),this}getLngLat(){return this._lngLat}setLngLat(et){this._lngLat=h.aR.convert(et),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(et){return this._altitude=et,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const et=this._map;return et&&(et.off("move",this._update),et.on("mousemove",this._onMouseEvent),et.on("drag",this._onMouseEvent),et._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(et){return this.setDOMContent(document.createTextNode(et))}setHTML(et){const o=document.createDocumentFragment(),g=document.createElement("body");let _e;for(g.innerHTML=et;_e=g.firstChild,_e;)o.appendChild(_e);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(et){return this.options.maxWidth=et,this._update(),this}setDOMContent(et){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=At("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(et),this.options.closeButton){const g=this._closeButton=At("button","mapboxgl-popup-close-button",o);g.type="button",g.setAttribute("aria-label","Close popup"),g.innerHTML='<span aria-hidden="true">&#215;</span>',g.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(et){return this._classList.add(et),this._updateClassList(),this}removeClassName(et){return this._classList.delete(et),this._updateClassList(),this}setOffset(et){return this.options.offset=et,this._update(),this}toggleClassName(et){let o;return this._classList.delete(et)?o=!1:(this._classList.add(et),o=!0),this._updateClassList(),o}_onMouseEvent(et){this._update(et.point)}_getAnchor(et){if(this.options.anchor)return this.options.anchor;const o=this._map,g=this._container,_e=this._pos;if(!o||!g||!_e)return"bottom";const nt=g.offsetWidth,st=g.offsetHeight,lt=_e.x<nt/2,ut=_e.x>o.transform.width-nt/2;if(_e.y+et<st)return lt?"top-left":ut?"top-right":"top";if(_e.y>o.transform.height-st){if(lt)return"bottom-left";if(ut)return"bottom-right"}return lt?"left":ut?"right":"bottom"}_updateClassList(){const et=this._container;if(!et)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),et.className=o.join(" ")}_update(et){const o=this._map,g=this._content;if(!o||!this._lngLat&&!this._trackPointer||!g)return;let _e=this._container;if(_e||(_e=this._container=At("div","mapboxgl-popup",o.getContainer()),this._tip=At("div","mapboxgl-popup-tip",_e),_e.appendChild(g)),this.options.maxWidth&&_e.style.maxWidth!==this.options.maxWidth&&(_e.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Rx(this._lngLat,this._pos,o.transform)),!this._trackPointer||et){const nt=this._pos=this._trackPointer&&et instanceof h.P?et:o.project(this._lngLat,this._altitude),st=x1(this.options.offset),lt=this._anchor=this._getAnchor(st.y),ut=x1(this.options.offset,lt),pt=nt.add(ut).round();o._requestDomTask(()=>{this._container&&lt&&(this._container.style.transform=`${b_[lt]} translate(${pt.x}px,${pt.y}px)`)})}if(!this._marker&&o._showingGlobe()){const nt=h.eY(o.transform,this._lngLat)?0:1;this._setOpacity(nt)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const et=this._container.querySelector(lp);et&&et.focus()}_onClose(){this.remove()}_setOpacity(et){this._container&&(this._container.style.opacity=`${et}`),this._content&&(this._content.style.pointerEvents=et?"auto":"none")}},Marker:Km,Style:Yu,LngLat:h.aR,LngLatBounds:h.aI,Point:h.P,MercatorCoordinate:h.ae,FreeCameraOptions:Ku,Evented:h.E,config:h.e,prewarm:h.f0,clearPrewarmedResources:h.e$,get accessToken(){return h.e.ACCESS_TOKEN},set accessToken(et){h.e.ACCESS_TOKEN=et},get baseApiUrl(){return h.e.API_URL},set baseApiUrl(et){h.e.API_URL=et},get workerCount(){return h.f9.workerCount},set workerCount(et){h.f9.workerCount=et},get maxParallelImageRequests(){return h.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(et){h.e.MAX_PARALLEL_IMAGE_REQUESTS=et},clearStorage(et){h.f8(et)},get workerUrl(){return h.f7.workerUrl},set workerUrl(et){h.f7.workerUrl=et},get workerClass(){return h.f7.workerClass},set workerClass(et){h.f7.workerClass=et},get workerParams(){return h.f7.workerParams},set workerParams(et){h.f7.workerParams=et},get dracoUrl(){return h.f6()},set dracoUrl(et){h.f5(et)},get meshoptUrl(){return h.f4()},set meshoptUrl(et){h.f3(et)},setNow:h.o.setNow,restoreNow:h.o.restoreNow}});var at=$;return at})})(mapboxGl$1);var mapboxGlExports=mapboxGl$1.exports;const mapboxgl=getDefaultExportFromCjs(mapboxGlExports),mapboxGl="";function CaregiverManage(){const{toast:e}=useToast(),i=useQueryClient(),[c,b]=reactExports.useState(""),[$,it]=reactExports.useState(""),[at,h]=reactExports.useState(""),dt=reactExports.useRef(null),ft=reactExports.useRef(null),xt=useMutation({mutationFn:async bt=>{await apiRequest("POST","/api/caregivers",bt)},onSuccess:()=>{i.invalidateQueries({queryKey:["/api/caregivers"]}),b(""),it(""),h(""),e({title:"Success",description:"Caregiver successfully added"})},onError:bt=>{if(isUnauthorizedError(bt)){e({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}e({title:"Error",description:"Failed to add caregiver",variant:"destructive"})}}),Ct=()=>{if(!c.trim()||!$.trim()||!at.trim()){e({title:"Error",description:"Please fill in all fields",variant:"destructive"});return}xt.mutate({name:c.trim(),relationship:$.trim(),contactInfo:at.trim()})};return reactExports.useEffect(()=>{if(!ft.current&&dt.current)return fetch("/api/mapbox-key").then(bt=>bt.json()).then(bt=>{bt.key?(mapboxgl.accessToken=bt.key,ft.current=new mapboxgl.Map({container:dt.current,style:"mapbox://styles/mapbox/streets-v12",center:[106.8456,-6.2088],zoom:12})):e({title:"Map Error",description:"Mapbox key not available",variant:"destructive"})}).catch(bt=>{console.error("Failed to load map:",bt),e({title:"Map Error",description:"Failed to load map",variant:"destructive"})}),()=>{ft.current&&(ft.current.remove(),ft.current=null)}},[e]),jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen neuropad-bg pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6 px-6 pt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Heart,{className:"w-7 h-7 text-primary"}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-serif font-bold neuropad-text-primary",children:"Manage Caregivers"})]}),jsxRuntimeExports.jsx(Link,{to:"/caregiver-network",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-11 h-11 rounded-2xl bg-white shadow-native flex items-center justify-center native-active","aria-label":"Back to Caregiver Overview",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 neuropad-text-primary"})})})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Link,{to:"/caregiver-network",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Overview"})}),jsxRuntimeExports.jsx(Link,{to:"/caregiver-network/manage",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Manage"})})]})}),jsxRuntimeExports.jsxs("div",{className:"neuropad-card p-6 mb-6 shadow-sm mx-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold mb-4 neuropad-text-primary",children:"Add Family Member or Caregiver"}),jsxRuntimeExports.jsx(Input,{type:"text",placeholder:"Name",value:c,onChange:bt=>b(bt.target.value),className:"w-full px-4 py-3 mb-3 rounded-xl bg-gray-100 neuropad-text-secondary placeholder:text-text-secondary focus:outline-none focus:ring-2 focus:ring-primary","data-testid":"input-caregiver-name"}),jsxRuntimeExports.jsx(Input,{type:"text",placeholder:"Relationship (e.g.: Mother, Husband, Child)",value:$,onChange:bt=>it(bt.target.value),className:"w-full px-4 py-3 mb-3 rounded-xl bg-gray-100 neuropad-text-secondary placeholder:text-text-secondary focus:outline-none focus:ring-2 focus:ring-primary","data-testid":"input-caregiver-relationship"}),jsxRuntimeExports.jsx(Input,{type:"text",placeholder:"Contact Info (e.g.: 08123456789)",value:at,onChange:bt=>h(bt.target.value),className:"w-full px-4 py-3 mb-4 rounded-xl bg-gray-100 neuropad-text-secondary placeholder:text-text-secondary focus:outline-none focus:ring-2 focus:ring-primary","data-testid":"input-caregiver-contact"}),jsxRuntimeExports.jsx(motion.button,{onClick:Ct,whileTap:{scale:.98},className:"w-full py-3 rounded-full neuropad-primary neuropad-text-primary font-bold shadow-native","data-testid":"button-add-caregiver",children:xt.isPending?"Adding...":"Add Caregiver"})]}),jsxRuntimeExports.jsxs("div",{className:"neuropad-card p-6 mb-6 shadow-sm mx-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold mb-4 neuropad-text-primary",children:"Location Sharing"}),jsxRuntimeExports.jsxs("div",{className:"w-full h-48 rounded-xl overflow-hidden relative bg-gray-100",children:[jsxRuntimeExports.jsx("div",{ref:dt,className:"w-full h-full"}),jsxRuntimeExports.jsx("div",{className:"absolute top-2 left-2 bg-white bg-opacity-95 rounded-lg px-3 py-1.5 shadow-md z-10",children:jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold text-gray-800",children:"Jakarta, Indonesia"})})]})]})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/caregiver-network"})]})})}function BluetoothDevice(){const{toast:e}=useToast(),i=useQueryClient(),[c,b]=reactExports.useState(!1),[$,it]=reactExports.useState(null),[at,h]=reactExports.useState(0),[dt,ft]=reactExports.useState(0),xt=reactExports.useRef(null),Ct=reactExports.useRef(null);useQuery({queryKey:["/api/health-metrics"],retry:!1});const bt=($==null?void 0:$.connected)??!1,kt=()=>{e({title:"Diagnostic Test",description:`Running diagnostic test...
Device is in good condition!`})},Dt=()=>{e({title:"Device Health",description:`Battery: ${dt}%
Connection: ${bt?"Stable":"Disconnected"}
Last sync: 2 minutes ago`})},At=()=>{prompt("Describe the issue you're experiencing:")&&e({title:"Report Sent",description:"Issue report has been sent to support team. Thank you!"})},Bt=()=>{e({title:"Synchronization",description:`Data synchronization started...
Data successfully synchronized!`})},Tt=useMutation({mutationFn:async kr=>{await apiRequest("POST","/api/health-metrics",kr)},onSuccess:()=>{i.invalidateQueries({queryKey:["/api/health-metrics"]})}});reactExports.useEffect(()=>()=>{var kr;(kr=Ct.current)!=null&&kr.connected&&Ct.current.disconnect()},[]);const It=()=>navigator.bluetooth!==void 0,St=async()=>{b(!0);try{const kr=navigator;if(!kr.bluetooth){b(!1),e({title:" Browser Not Supported",description:`Web Bluetooth is not available in this browser.

Please use:
 Chrome (Desktop/Android)
 Edge (Desktop)
 Opera (Desktop/Android)

 Safari and Firefox don't support Bluetooth yet.`,variant:"destructive"});return}console.log("Bluetooth API available, requesting device..."),e({title:" Scanning Devices...",description:"Please select your Bluetooth device from the popup"});const br=await kr.bluetooth.requestDevice({acceptAllDevices:!0,optionalServices:["heart_rate","battery_service","health_thermometer","blood_pressure","glucose","generic_access","device_information"]});xt.current=br,e({title:"Connecting...",description:`Connecting to ${br.name||"Unknown Device"}`});const Sr=await br.gatt.connect();Ct.current=Sr;const rn=(await Sr.getPrimaryServices()).map(Zr=>Zr.uuid);it({name:br.name||"Unknown Device",id:br.id,connected:!0,services:rn});try{const Kr=await(await Sr.getPrimaryService("heart_rate")).getCharacteristic("heart_rate_measurement");await Kr.startNotifications(),Kr.addEventListener("characteristicvaluechanged",Xt=>{const Ut=Xt.target.value.getUint8(1);h(Ut),Tt.mutate({heartRate:Ut,bluetoothConnected:!0,batteryLevel:dt||void 0})})}catch{console.log("Heart rate service not available")}try{const mr=(await(await(await Sr.getPrimaryService("battery_service")).getCharacteristic("battery_level")).readValue()).getUint8(0);ft(mr)}catch{console.log("Battery service not available")}Tt.mutate({heartRate:at||void 0,batteryLevel:dt||void 0,bluetoothConnected:!0}),e({title:" Connected Successfully!",description:`${br.name||"Device"} is now connected and syncing data`}),br.addEventListener("gattserverdisconnected",()=>{it(Zr=>Zr?{...Zr,connected:!1}:null),Tt.mutate({bluetoothConnected:!1}),e({title:"Device Disconnected",description:"Bluetooth device has been disconnected",variant:"destructive"})})}catch(kr){console.error("Bluetooth connection error:",kr);let br="Failed to connect to Bluetooth device";kr.name==="NotFoundError"?br=`No Bluetooth device was selected.

Please try again and select a device from the popup.`:kr.name==="SecurityError"?br=`Bluetooth access was denied.

Please check your browser permissions.`:kr.name==="NotSupportedError"?br=`Your device doesn't support Bluetooth.

Make sure Bluetooth is turned on.`:kr.message&&(br=kr.message),e({title:" Connection Failed",description:br,variant:"destructive"})}finally{b(!1)}},jt=()=>{var kr;(kr=Ct.current)!=null&&kr.connected&&(Ct.current.disconnect(),it(null),h(0),ft(0),Tt.mutate({bluetoothConnected:!1}),e({title:"Disconnected",description:"Device has been disconnected"}))},Ht=async()=>{if(xt.current)try{b(!0);const kr=await xt.current.gatt.connect();Ct.current=kr,it(br=>br?{...br,connected:!0}:null),e({title:"Reconnected",description:"Successfully reconnected to device"})}catch{e({title:"Reconnection Failed",description:"Please try connecting again",variant:"destructive"})}finally{b(!1)}else await St()},Kt=()=>{e({title:"Settings",description:"Opening Bluetooth settings..."})},ir=()=>{e({title:"Bluetooth Help",description:`- Make sure Bluetooth is on
- Device within 10m range
- Restart if problem persists`})},nr=It();return jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"h-screen neuropad-bg pb-16 overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto h-full flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4 px-6 pt-6",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-8 h-8 rounded-xl bg-white shadow-native flex items-center justify-center native-active","data-testid":"button-back",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-4 h-4 text-gray-700"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold neuropad-text-primary",children:"Bluetooth Device"}),jsxRuntimeExports.jsx("div",{className:"w-8"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto",children:[!nr&&jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-red-50 to-rose-50 rounded-2xl p-3 shadow-native border border-red-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-2xl bg-red-500 flex items-center justify-center shadow-sm",children:jsxRuntimeExports.jsx("span",{className:"text-2xl",children:""})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"text-title text-red-800 mb-1",children:"Browser Not Supported"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700 mb-2",children:"Web Bluetooth is not available in this browser."}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-red-600",children:[jsxRuntimeExports.jsx("strong",{children:"Supported Browsers:"}),jsxRuntimeExports.jsx("br",{})," Chrome (Desktop/Android)",jsxRuntimeExports.jsx("br",{})," Edge (Desktop)",jsxRuntimeExports.jsx("br",{})," Opera (Desktop/Android)"]})]})]})})}),nr&&jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-3 shadow-native border border-green-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-2xl bg-green-500 flex items-center justify-center shadow-sm",children:jsxRuntimeExports.jsx("span",{className:"text-xl",children:""})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-green-800 font-semibold",children:"Bluetooth Ready - Click button below to connect your device"})]})})}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"native-card-elevated p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-5",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-title mb-1 neuropad-text-primary",children:($==null?void 0:$.name)||"No Device Connected"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${bt?"bg-green-500 animate-pulse shadow-lg shadow-green-500/50":"bg-red-500"}`}),jsxRuntimeExports.jsx("p",{className:`text-sm font-semibold ${bt?"text-green-600":"text-red-600"}`,children:bt?"Connected & Syncing":"Disconnected"})]}),($==null?void 0:$.id)&&jsxRuntimeExports.jsxs("p",{className:"text-xs neuropad-text-secondary mt-1",children:["ID: ",$.id.substring(0,16),"..."]})]}),jsxRuntimeExports.jsx(motion.div,{animate:{scale:bt?[1,1.1,1]:1},transition:{repeat:bt?1/0:0,duration:2},className:`w-16 h-16 rounded-2xl flex items-center justify-center shadow-sm ${bt?"bg-blue-50 animate-pulse":"bg-gray-100"}`,children:jsxRuntimeExports.jsx(Bluetooth,{className:`w-8 h-8 ${bt?"text-blue-600":"text-gray-400"}`})})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm neuropad-text-secondary font-medium",children:"Battery Level"}),jsxRuntimeExports.jsxs("span",{className:"font-bold neuropad-text-primary",children:[dt,"%"]})]}),jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-100 rounded-full h-2.5",children:jsxRuntimeExports.jsx(motion.div,{initial:{width:0},animate:{width:`${dt}%`},transition:{duration:.8,ease:"easeOut"},className:`h-2.5 rounded-full ${dt>20?"bg-green-500":"bg-red-500"}`})})]})}),jsxRuntimeExports.jsxs("div",{className:"px-6 mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-bold mb-3 neuropad-text-primary",children:"Diagnostic Tools"}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"native-card p-5 space-y-3",children:[jsxRuntimeExports.jsx(motion.button,{onClick:kt,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full py-3 rounded-2xl neuropad-primary neuropad-text-primary font-bold shadow-native native-active","data-testid":"button-run-diagnostic",children:"Run Diagnostic Test"}),jsxRuntimeExports.jsx(motion.button,{onClick:Dt,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full py-3 rounded-2xl bg-white border-2 border-primary neuropad-text-primary font-bold shadow-native native-active","data-testid":"button-device-health",children:"View Device Health"}),jsxRuntimeExports.jsx(motion.button,{onClick:At,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full py-3 rounded-2xl bg-white border-2 border-primary neuropad-text-primary font-bold shadow-native native-active","data-testid":"button-report-issue",children:"Report Issue"}),jsxRuntimeExports.jsx(motion.button,{onClick:Bt,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full py-3 rounded-2xl neuropad-primary neuropad-text-primary font-bold shadow-native native-active","data-testid":"button-sync-data",children:"Sync Data Now"})]})]}),bt&&(at>0||dt>0)&&jsxRuntimeExports.jsxs("div",{className:"px-6 mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-bold mb-3 neuropad-text-primary",children:"Real-Time Data"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[at>0&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.3},className:"native-card p-5 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-2xl bg-red-50 flex items-center justify-center mx-auto mb-3 shadow-sm",children:jsxRuntimeExports.jsx(Heart,{className:"w-6 h-6 text-red-500"})}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold neuropad-text-primary",children:at}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary font-medium",children:"BPM"})]}),dt>0&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.3},className:"native-card p-5 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-2xl bg-green-50 flex items-center justify-center mx-auto mb-3 shadow-sm",children:jsxRuntimeExports.jsx(Battery,{className:"w-6 h-6 text-green-500"})}),jsxRuntimeExports.jsxs("p",{className:"text-2xl font-bold neuropad-text-primary",children:[dt,"%"]}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary font-medium",children:"Battery"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-bold mb-3 neuropad-text-primary",children:"Device Connection"}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:bt?jsxRuntimeExports.jsxs(motion.button,{onClick:jt,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full py-4 rounded-2xl bg-gradient-to-r from-red-500 to-red-600 text-white font-bold shadow-native-lg shadow-red-500/25 native-active flex items-center justify-center gap-2","data-testid":"button-disconnect-device",children:[jsxRuntimeExports.jsx(Bluetooth,{className:"w-5 h-5"}),"Disconnect Device"]}):jsxRuntimeExports.jsxs(motion.button,{onClick:St,disabled:c,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full py-4 rounded-2xl bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold shadow-native-lg shadow-blue-500/25 disabled:opacity-50 native-active flex items-center justify-center gap-2","data-testid":"button-connect-device",children:[jsxRuntimeExports.jsx(Bluetooth,{className:"w-5 h-5"}),c?"Connecting...":"Connect Bluetooth Device"]})})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-bold mb-3 neuropad-text-primary",children:"Connectivity Check"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs(motion.button,{onClick:kt,whileHover:{y:-4},whileTap:{scale:.97},className:"native-card p-5 text-center native-active","data-testid":"button-diagnostic",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-2xl bg-blue-50 flex items-center justify-center mx-auto mb-3 shadow-sm",children:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-6 h-6 text-blue-500"})}),jsxRuntimeExports.jsx("p",{className:"font-semibold neuropad-text-primary",children:"Diagnostik"})]}),jsxRuntimeExports.jsxs(motion.button,{onClick:Ht,disabled:c,whileHover:{y:-4},whileTap:{scale:.97},className:"native-card p-5 text-center disabled:opacity-50 native-active","data-testid":"button-reconnect",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-2xl bg-green-50 flex items-center justify-center mx-auto mb-3 shadow-sm",children:jsxRuntimeExports.jsx(RotateCcw,{className:`w-6 h-6 text-green-500 ${c?"animate-spin":""}`})}),jsxRuntimeExports.jsx("p",{className:"font-semibold neuropad-text-primary",children:c?"Connecting...":"Reconnect"})]}),jsxRuntimeExports.jsxs(motion.button,{onClick:Kt,whileHover:{y:-4},whileTap:{scale:.97},className:"native-card p-5 text-center native-active","data-testid":"button-settings",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gray-50 flex items-center justify-center mx-auto mb-3 shadow-sm",children:jsxRuntimeExports.jsx(Settings,{className:"w-6 h-6 neuropad-text-secondary"})}),jsxRuntimeExports.jsx("p",{className:"font-semibold neuropad-text-primary",children:"Settings"})]}),jsxRuntimeExports.jsxs(motion.button,{onClick:ir,whileHover:{y:-4},whileTap:{scale:.97},className:"native-card p-5 text-center native-active","data-testid":"button-help",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-2xl bg-yellow-50 flex items-center justify-center mx-auto mb-3 shadow-sm",children:jsxRuntimeExports.jsx(CircleHelp,{className:"w-6 h-6 text-yellow-600"})}),jsxRuntimeExports.jsx("p",{className:"font-semibold neuropad-text-primary",children:"Help"})]})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsx(motion.button,{onClick:At,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full py-3 rounded-2xl neuropad-primary neuropad-text-primary font-bold shadow-native-lg shadow-primary/25 native-active text-sm","data-testid":"button-submit-issue",children:"Report Issue"})})]})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/bluetooth-device"})]})})}function RiskLog(){var Ct;const{user:e}=useAuth(),{data:i}=useQuery({queryKey:["/api/health-metrics"],retry:!1}),[c,b]=reactExports.useState(!1),[$,it]=reactExports.useState(()=>[]),[at,h]=reactExports.useState((i==null?void 0:i.heartRate)||72),[dt,ft]=reactExports.useState((i==null?void 0:i.footPressure)||40),xt=reactExports.useRef(null);return reactExports.useEffect(()=>{const bt=localStorage.getItem("neuro_risk_log_events");if(bt)try{it(JSON.parse(bt))}catch{}},[]),reactExports.useEffect(()=>{localStorage.setItem("neuro_risk_log_events",JSON.stringify($.slice(-100)))},[$]),reactExports.useEffect(()=>{if(!c){xt.current&&(clearInterval(xt.current),xt.current=null);return}return xt.current=window.setInterval(()=>{h(bt=>{const kt=Math.round((Math.random()-.5)*6),Dt=Math.min(110,Math.max(55,bt+kt));return it(At=>[...At,{id:crypto.randomUUID(),type:"heart",value:Dt,timestamp:Date.now()}]),Dt}),ft(bt=>{const kt=Math.round((Math.random()-.5)*10),Dt=Math.min(100,Math.max(20,bt+kt));return it(At=>[...At,{id:crypto.randomUUID(),type:"pressure",value:Dt,timestamp:Date.now()}]),Dt})},2500),()=>{xt.current&&(clearInterval(xt.current),xt.current=null)}},[c]),e!=null&&e.firstName||(Ct=e==null?void 0:e.email)!=null&&Ct.split("@")[0],jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen neuropad-bg pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6 px-6 pt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full neuropad-card mr-4 overflow-hidden flex items-center justify-center",children:jsxRuntimeExports.jsx(Activity,{className:"w-8 h-8 text-blue-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-serif font-bold neuropad-text-primary",children:"Risk & Log"}),jsxRuntimeExports.jsx("p",{className:"neuropad-text-secondary",children:"@health.monitor"})]})]}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-11 h-11 rounded-2xl bg-white shadow-native flex items-center justify-center native-active","aria-label":"Back to Home","data-testid":"button-back-home",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 neuropad-text-primary"})})})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold neuropad-text-primary",children:"Statistics"}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.03},whileTap:{scale:.97},onClick:()=>b(bt=>!bt),className:`px-4 py-2 rounded-xl font-bold shadow-native native-active text-white ${c?"bg-gradient-to-r from-green-500 to-green-600":"bg-gradient-to-r from-blue-500 to-blue-600"}`,"data-testid":"button-toggle-live",children:c?"Live: ON":"Live: OFF"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"text-center","data-testid":"stat-daily",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-2 flex items-center justify-center",children:jsxRuntimeExports.jsx(Heart,{className:"w-10 h-10 neuropad-text-primary"})}),jsxRuntimeExports.jsx("p",{className:"font-bold text-lg neuropad-text-primary",children:"Daily"}),jsxRuntimeExports.jsxs("p",{className:"text-sm neuropad-text-secondary text-center",children:["Foot pressure",jsxRuntimeExports.jsx("br",{}),"imbalance"]})]}),jsxRuntimeExports.jsxs("div",{className:"text-center","data-testid":"stat-weekly",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-2 flex items-center justify-center",children:jsxRuntimeExports.jsx(ChartColumn,{className:"w-10 h-10 neuropad-text-primary"})}),jsxRuntimeExports.jsx("p",{className:"font-bold text-lg neuropad-text-primary",children:"Weekly"}),jsxRuntimeExports.jsxs("p",{className:"text-sm neuropad-text-secondary text-center",children:["Walking pattern",jsxRuntimeExports.jsx("br",{}),"analysis"]})]}),jsxRuntimeExports.jsxs("div",{className:"text-center","data-testid":"stat-irregularities",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-2 flex items-center justify-center",children:jsxRuntimeExports.jsx(Activity,{className:"w-10 h-10 neuropad-text-primary"})}),jsxRuntimeExports.jsx("p",{className:"font-bold text-lg neuropad-text-primary",children:Math.max(0,$.filter(bt=>bt.type==="heart"&&bt.value>100).length)}),jsxRuntimeExports.jsxs("p",{className:"text-sm neuropad-text-secondary text-center",children:["Heart rate",jsxRuntimeExports.jsx("br",{}),"irregularities"]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold mb-4 neuropad-text-primary",children:"View Details"}),jsxRuntimeExports.jsxs("div",{className:"neuropad-card p-6 mb-4 shadow-sm","data-testid":"card-ai-insights",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold mb-2 neuropad-text-primary",children:"AI Insights available"}),jsxRuntimeExports.jsx("p",{className:"neuropad-text-secondary text-sm mb-4",children:"Tap for more info!"}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm neuropad-text-primary",children:"Trend"}),jsxRuntimeExports.jsx("span",{className:"text-sm neuropad-text-secondary",children:"Daily monitoring"})]}),jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:jsxRuntimeExports.jsx("div",{className:"neuropad-primary h-2 rounded-full",style:{width:"70%"}})})]}),jsxRuntimeExports.jsxs("div",{className:"neuropad-card p-6 shadow-sm","data-testid":"card-weekly-report",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold mb-2 neuropad-text-primary",children:"Weekly report"}),jsxRuntimeExports.jsx("p",{className:"neuropad-text-secondary text-sm mb-4",children:"Analyze your data"}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm neuropad-text-primary",children:"Trend"}),jsxRuntimeExports.jsx("span",{className:"text-sm neuropad-text-secondary",children:"Weekly review"})]}),jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:jsxRuntimeExports.jsx("div",{className:"neuropad-primary h-2 rounded-full",style:{width:"45%"}})})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold mb-4 neuropad-text-primary",children:"Metrics Summary"}),jsxRuntimeExports.jsxs("div",{className:"neuropad-card p-6 shadow-sm",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),jsxRuntimeExports.jsx("p",{className:"font-semibold neuropad-text-primary",children:"Heart Rate"}),jsxRuntimeExports.jsxs("p",{className:"text-sm neuropad-text-secondary",children:[c?at:(i==null?void 0:i.heartRate)||"--"," BPM"]})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(Activity,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),jsxRuntimeExports.jsx("p",{className:"font-semibold neuropad-text-primary",children:"Foot Pressure"}),jsxRuntimeExports.jsxs("p",{className:"text-sm neuropad-text-secondary",children:[c?dt:(i==null?void 0:i.footPressure)||"--"," mmHg"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm neuropad-text-secondary",children:"Device Status"}),jsxRuntimeExports.jsx("span",{className:`text-sm font-semibold ${i!=null&&i.bluetoothConnected?"text-green-500":"text-red-500"}`,children:i!=null&&i.bluetoothConnected?"Connected":"Disconnected"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mt-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm neuropad-text-secondary",children:"Anomalies Detected"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold neuropad-text-primary",children:(i==null?void 0:i.anomaliesDetected)||0})]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 mb-8",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold mb-4 neuropad-text-primary",children:"Live Timeline"}),jsxRuntimeExports.jsx("div",{className:"neuropad-card p-4 overflow-x-auto",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3 min-w-full",children:[$.slice(-20).map(bt=>jsxRuntimeExports.jsxs(motion.div,{whileHover:{y:-2},className:`px-3 py-2 rounded-xl shadow-sm border text-sm font-bold ${bt.type==="heart"?"border-red-200 bg-red-50 text-red-700":"border-blue-200 bg-blue-50 text-blue-700"}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[bt.type==="heart"?jsxRuntimeExports.jsx(Activity,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(TrendingUp,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:bt.value})]}),jsxRuntimeExports.jsx("div",{className:"text-[11px] text-gray-500 mt-1",children:new Date(bt.timestamp).toLocaleTimeString()})]},bt.id)),$.length===0&&jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary",children:"No data yet. Turn on Live to start monitoring."})]})})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 mb-6 space-y-3",children:[jsxRuntimeExports.jsx(Link,{to:"/urgent-alerts",children:jsxRuntimeExports.jsx(Button,{className:"w-full py-3 rounded-full neuropad-primary neuropad-text-primary font-bold","data-testid":"button-view-alerts",children:"View Urgent Alerts"})}),jsxRuntimeExports.jsx(Link,{to:"/bluetooth-device",children:jsxRuntimeExports.jsx(Button,{variant:"outline",className:"w-full py-3 rounded-full neuropad-card border-2 border-primary neuropad-text-primary font-bold","data-testid":"button-device-settings",children:"Device Settings"})})]})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/risk-log"})]})})}function AnimatedButton({children:e,variant:i="default",size:c="default",className:b="",...$}){return jsxRuntimeExports.jsx(Button,{variant:i,size:c,className:b,...$,children:e})}function UrgentAlerts(){const{toast:e}=useToast(),i=useQueryClient(),[c,b]=reactExports.useState(!1),{data:$,isLoading:it}=useQuery({queryKey:["/api/urgent-alerts"],retry:!1}),at=useMutation({mutationFn:async Ht=>{await apiRequest("PATCH",`/api/urgent-alerts/${Ht}/read`)},onSuccess:()=>{i.invalidateQueries({queryKey:["/api/urgent-alerts"]})},onError:Ht=>{if(isUnauthorizedError(Ht)){e({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}console.error("Error marking alert as read:",Ht)}}),h=useMutation({mutationFn:async()=>{const Ht=[{alertType:"stroke_risk",title:"Potential stroke risk detected!",description:"Contact emergency services immediately",severity:"critical"},{alertType:"emergency_call",title:"Call Emergency immediately.",description:"Notify your caregiver.",severity:"high"},{alertType:"review_guidance",title:"Review health guidance.",description:"1 minute ago",severity:"medium"},{alertType:"general_alert",title:"2 minutes ago",description:"3 minutes ago",severity:"low"},{alertType:"monitor_health",title:"Stay alert and monitor.",description:"4 minutes ago",severity:"medium"},{alertType:"track_metrics",title:"Track your health metrics.",description:"5 minutes ago",severity:"medium"},{alertType:"be_proactive",title:"Be proactive about your health.",description:"6 minutes ago",severity:"low"}];for(const Kt of Ht)await apiRequest("POST","/api/urgent-alerts",Kt)},onSuccess:()=>{i.invalidateQueries({queryKey:["/api/urgent-alerts"]})},onError:Ht=>{if(isUnauthorizedError(Ht)){e({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}console.error("Error creating sample alerts:",Ht)}});reactExports.useEffect(()=>{!it&&!c&&(!$||$.length===0)&&(b(!0),h.mutate())},[it,$,c]);const dt=()=>{e({title:"Calling Emergency Services",description:"Connecting to 119..."})},ft=()=>{e({title:"Doctor Information",description:"Showing nearest doctor information..."})},xt=Ht=>{at.mutate(Ht),e({title:"Alert Marked",description:"Alert marked as important"})},Ct=()=>{e({title:"Health Guidance",description:"Opening health guidance..."})},bt=()=>{e({title:"Information Details",description:"Showing information details..."})},kt=()=>{e({title:"Reminder Set",description:"Reminder has been set"})},Dt=()=>{e({title:"Monitoring Timer",description:"Monitoring timer started"})},At=Ht=>{at.mutate(Ht),e({title:"Added to Favorites",description:"Alert added to favorites"})},Bt=()=>{e({title:"Health Chart",description:"Showing health metrics chart..."})},Tt=()=>{e({title:"Health Check",description:"Starting health check..."})},It=Ht=>{at.mutate(Ht),e({title:"Alert Confirmed",description:"Alert confirmed"})},St=Ht=>{switch(Ht){case"stroke_risk":return jsxRuntimeExports.jsx(Heart,{className:"w-8 h-8 text-red-500"});case"emergency_call":return jsxRuntimeExports.jsx(Phone,{className:"w-8 h-8 text-orange-500"});case"review_guidance":return jsxRuntimeExports.jsx(Book,{className:"w-8 h-8 text-blue-500"});case"monitor_health":return jsxRuntimeExports.jsx(TrendingUp,{className:"w-8 h-8 text-red-500"});case"track_metrics":return jsxRuntimeExports.jsx(TrendingUp,{className:"w-8 h-8 text-green-500"});case"be_proactive":return jsxRuntimeExports.jsx(Star,{className:"w-8 h-8 text-purple-500"});default:return jsxRuntimeExports.jsx(Bell,{className:"w-8 h-8 text-yellow-500"})}},jt=Ht=>{switch(Ht){case"stroke_risk":return"bg-red-100";case"emergency_call":return"bg-orange-100";case"review_guidance":return"bg-blue-100";case"monitor_health":return"bg-red-100";case"track_metrics":return"bg-green-100";case"be_proactive":return"bg-purple-100";default:return"bg-yellow-100"}};return jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen neuropad-bg pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center mb-6 px-6 pt-6",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(AnimatedButton,{variant:"ghost",size:"sm",className:"mr-4","data-testid":"button-back",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-6 h-6"})})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold neuropad-text-primary",children:"Urgent Alerts"})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Link,{to:"/urgent-alerts",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"Overview"})}),jsxRuntimeExports.jsx(Link,{to:"/urgent-alerts/history",children:jsxRuntimeExports.jsx("button",{className:"px-3 py-2 rounded-full bg-white shadow-native text-sm font-semibold native-active",children:"History"})})]})}),jsxRuntimeExports.jsx("div",{className:"px-6 space-y-4",children:it?jsxRuntimeExports.jsxs("div",{className:"text-center py-8",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"neuropad-text-secondary",children:"Loading alerts..."})]}):!$||$.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-8",children:[jsxRuntimeExports.jsx(Bell,{className:"w-12 h-12 mx-auto mb-4 neuropad-text-secondary"}),jsxRuntimeExports.jsx("p",{className:"neuropad-text-secondary",children:"No alerts yet"})]}):$.map((Ht,Kt)=>jsxRuntimeExports.jsxs("div",{className:`neuropad-card p-4 shadow-sm flex items-center justify-between ${Ht.isRead?"":"border-l-4 border-l-red-500"}`,"data-testid":`alert-${Ht.id}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[jsxRuntimeExports.jsx("div",{className:`w-14 h-14 rounded-full ${jt(Ht.alertType)} flex items-center justify-center overflow-hidden`,children:St(Ht.alertType)}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold neuropad-text-primary",children:Ht.title}),jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary",children:Ht.description}),jsxRuntimeExports.jsx("p",{className:"text-xs neuropad-text-secondary mt-1",children:Ht.createdAt?new Date(Ht.createdAt).toLocaleTimeString("en-US"):"Just now"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-2",children:[Ht.alertType==="stroke_risk"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AnimatedButton,{onClick:dt,variant:"ghost",size:"sm","data-testid":`button-call-${Ht.id}`,children:jsxRuntimeExports.jsx(Phone,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx(AnimatedButton,{onClick:ft,variant:"ghost",size:"sm","data-testid":`button-doctor-${Ht.id}`,children:jsxRuntimeExports.jsx(User,{className:"w-6 h-6"})})]}),Ht.alertType==="emergency_call"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AnimatedButton,{onClick:dt,variant:"ghost",size:"sm","data-testid":`button-call-${Ht.id}`,children:jsxRuntimeExports.jsx(Phone,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx(AnimatedButton,{onClick:()=>xt(Ht.id),variant:"ghost",size:"sm","data-testid":`button-like-${Ht.id}`,children:jsxRuntimeExports.jsx(Heart,{className:"w-6 h-6"})})]}),Ht.alertType==="review_guidance"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AnimatedButton,{onClick:Ct,variant:"ghost",size:"sm","data-testid":`button-guidance-${Ht.id}`,children:jsxRuntimeExports.jsx(Book,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx(AnimatedButton,{onClick:bt,variant:"ghost",size:"sm","data-testid":`button-info-${Ht.id}`,children:jsxRuntimeExports.jsx(Info,{className:"w-6 h-6"})})]}),Ht.alertType==="general_alert"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AnimatedButton,{onClick:kt,variant:"ghost",size:"sm","data-testid":`button-reminder-${Ht.id}`,children:jsxRuntimeExports.jsx(Bell,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx(AnimatedButton,{onClick:bt,variant:"ghost",size:"sm","data-testid":`button-info-${Ht.id}`,children:jsxRuntimeExports.jsx(Info,{className:"w-6 h-6"})})]}),Ht.alertType==="monitor_health"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AnimatedButton,{onClick:Dt,variant:"ghost",size:"sm","data-testid":`button-clock-${Ht.id}`,children:jsxRuntimeExports.jsx(Clock,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx(AnimatedButton,{onClick:()=>At(Ht.id),variant:"ghost",size:"sm","data-testid":`button-favorite-${Ht.id}`,children:jsxRuntimeExports.jsx(Heart,{className:"w-6 h-6"})})]}),Ht.alertType==="track_metrics"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AnimatedButton,{onClick:Bt,variant:"ghost",size:"sm","data-testid":`button-chart-${Ht.id}`,children:jsxRuntimeExports.jsx(TrendingUp,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx(AnimatedButton,{onClick:Tt,variant:"ghost",size:"sm","data-testid":`button-health-check-${Ht.id}`,children:jsxRuntimeExports.jsx(Star,{className:"w-6 h-6"})})]}),Ht.alertType==="be_proactive"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AnimatedButton,{onClick:dt,variant:"ghost",size:"sm","data-testid":`button-call-${Ht.id}`,children:jsxRuntimeExports.jsx(Phone,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx(AnimatedButton,{onClick:()=>It(Ht.id),variant:"ghost",size:"sm","data-testid":`button-confirm-${Ht.id}`,children:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-6 h-6"})})]})]})]},Ht.id))})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/urgent-alerts"})]})})}function FootpadTracking(){const{toast:e}=useToast(),i=useQueryClient(),[c,b]=reactExports.useState("left"),[$,it]=reactExports.useState([]),[at,h]=reactExports.useState(!1),[dt,ft]=reactExports.useState(!1),[xt,Ct]=reactExports.useState(!1),[bt,kt]=reactExports.useState("cardboard"),[Dt,At]=reactExports.useState(0),Bt=reactExports.useRef(null),Tt=reactExports.useRef(null),It=reactExports.useRef(null),St=reactExports.useRef(null),jt=reactExports.useRef(null);reactExports.useEffect(()=>()=>{Tt.current&&Tt.current.getTracks().forEach(Xt=>Xt.stop()),jt.current&&(cancelAnimationFrame(jt.current),jt.current=null)},[]);const Ht=async()=>{try{const Xt=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});Bt.current&&(Bt.current.srcObject=Xt,Tt.current=Xt,ft(!0),e({title:"Camera Active",description:"Point camera at your foot and click to mark pressure points"}))}catch(Xt){console.error("Camera access error:",Xt),e({title:"Camera Error",description:"Could not access camera. Please allow camera permissions.",variant:"destructive"})}},Kt=()=>{Tt.current&&(Tt.current.getTracks().forEach(Xt=>Xt.stop()),Tt.current=null,ft(!1),Bt.current&&(Bt.current.srcObject=null),Ct(!1),jt.current&&(cancelAnimationFrame(jt.current),jt.current=null),e({title:"Camera Stopped",description:"Camera has been turned off"}))},ir=()=>{const Xt=Bt.current,mr=It.current;let Ut=St.current;if(!Xt||!mr){jt.current=requestAnimationFrame(ir);return}const Jt=Xt.videoWidth||640,Or=Xt.videoHeight||480;mr.width=Jt,mr.height=Or,Ut||(St.current=document.createElement("canvas"),Ut=St.current),Ut.width=Jt,Ut.height=Or;const Cr=Ut.getContext("2d"),pn=mr.getContext("2d");if(!Cr||!pn){jt.current=requestAnimationFrame(ir);return}Cr.drawImage(Xt,0,0,Jt,Or);const On=Cr.getImageData(0,0,Jt,Or);let Zn=Jt,As=Or,ss=-1,Ls=-1,$s=0;const vo=3;for(let Po=0;Po<Or;Po+=vo)for(let ws=0;ws<Jt;ws+=vo){const Jn=(Po*Jt+ws)*4,Hs=On.data[Jn],El=On.data[Jn+1],Xo=On.data[Jn+2];let _l=!1;if(bt==="cardboard")_l=Hs>90&&El>60&&Xo<80&&Hs>El&&Hs-Xo>30;else{const Io=Hs>180&&El>180&&Xo>180,Pl=Math.abs(Hs-El)<18&&Math.abs(Hs-Xo)<18&&Math.abs(El-Xo)<18;_l=Io&&Pl}_l&&($s++,ws<Zn&&(Zn=ws),Po<As&&(As=Po),ws>ss&&(ss=ws),Po>Ls&&(Ls=Po))}const Vs=Jt*Or/(vo*vo),bo=Math.min(100,Math.round($s/Vs*100));At(bo),pn.clearRect(0,0,Jt,Or),$s>800&&(pn.strokeStyle=bt==="cardboard"?"#d97706":"#9ca3af",pn.lineWidth=4,pn.shadowColor=bt==="cardboard"?"rgba(217,119,6,0.4)":"rgba(156,163,175,0.4)",pn.shadowBlur=8,pn.strokeRect(Zn,As,Math.max(1,ss-Zn),Math.max(1,Ls-As))),jt.current=requestAnimationFrame(ir)},nr=()=>{if(!dt){e({title:"Camera Required",description:"Please start the camera first",variant:"destructive"});return}Ct(Xt=>{const mr=!Xt;if(mr)ir();else if(jt.current){cancelAnimationFrame(jt.current),jt.current=null,At(0);const Ut=It.current;if(Ut){const Jt=Ut.getContext("2d");Jt&&Jt.clearRect(0,0,Ut.width,Ut.height)}}return mr})},{data:kr}=useQuery({queryKey:["/api/footpad-pressure"],retry:!1}),br=useMutation({mutationFn:async Xt=>{await apiRequest("POST","/api/footpad-pressure",Xt)},onSuccess:()=>{i.invalidateQueries({queryKey:["/api/footpad-pressure"]}),e({title:"Success",description:"Footpad pressure data saved successfully"}),it([]),h(!1)},onError:Xt=>{if(isUnauthorizedError(Xt)){e({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}e({title:"Error",description:"Failed to save footpad pressure data",variant:"destructive"})}}),Sr=Xt=>{if(!at||!dt){e({title:"Not Ready",description:"Please start camera and recording first",variant:"destructive"});return}const mr=Xt.currentTarget.getBoundingClientRect(),Ut=(Xt.clientX-mr.left)/mr.width*100,Jt=(Xt.clientY-mr.top)/mr.height*100,Or=50,Cr=50,pn=Math.sqrt(Math.pow(Ut-Or,2)+Math.pow(Jt-Cr,2)),On=Math.max(20,Math.min(100,100-pn)),Zn={x:Ut,y:Jt,pressure:Math.round(On)};it([...$,Zn]),e({title:"Pressure Point Detected",description:`Position: (${Ut.toFixed(0)}%, ${Jt.toFixed(0)}%) | Pressure: ${Math.round(On)}`})},$r=()=>{if($.length===0){e({title:"No Data",description:"Please record at least one pressure point",variant:"destructive"});return}const Xt=$.reduce((Ut,Jt)=>Ut+Jt.pressure,0)/$.length,mr=Math.max(...$.map(Ut=>Ut.pressure));br.mutate({foot:c,pressurePoints:$,averagePressure:Xt,maxPressure:mr})},rn=()=>{it([]),h(!1),e({title:"Reset",description:"Pressure points cleared"})},Zr=Xt=>Xt>=80?"bg-red-500":Xt>=60?"bg-orange-500":Xt>=40?"bg-yellow-500":"bg-green-500",Kr=kr&&kr.length>0?kr[0]:null;return jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen neuropad-bg pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-8 px-6 pt-8",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-11 h-11 rounded-2xl bg-white shadow-native flex items-center justify-center native-active","data-testid":"button-back",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-gray-700"})})}),jsxRuntimeExports.jsx("h1",{className:"text-headline neuropad-text-primary",children:"Footpad Tracking"}),jsxRuntimeExports.jsx("div",{className:"w-11 h-11 rounded-2xl bg-pink-50 shadow-sm flex items-center justify-center",children:jsxRuntimeExports.jsx(Activity,{className:"w-5 h-5 text-pink-500"})})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-8",children:jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"native-card-elevated p-5 bg-gradient-to-r from-blue-50 to-yellow-50",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-2xl bg-blue-500 flex items-center justify-center shadow-sm flex-shrink-0",children:jsxRuntimeExports.jsx(Activity,{className:"w-5 h-5 text-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-title mb-3 neuropad-text-primary",children:"Footpad Pressure Tracking"}),jsxRuntimeExports.jsxs("ol",{className:"text-sm neuropad-text-secondary space-y-1.5 font-medium",children:[jsxRuntimeExports.jsx("li",{children:"1. Select left or right foot"}),jsxRuntimeExports.jsx("li",{children:'2. Click "Start Camera" to activate camera'}),jsxRuntimeExports.jsx("li",{children:"3. Point camera at your foot clearly"}),jsxRuntimeExports.jsx("li",{children:'4. Click "Manual Mode" to start recording'}),jsxRuntimeExports.jsx("li",{children:"5. Tap on the camera feed to mark pressure points"}),jsxRuntimeExports.jsx("li",{children:'6. Click "Save Data" to store to database'})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-blue-600 mt-3 font-bold",children:" Tap anywhere on your foot to mark pressure points manually!"})]})]})})}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-8",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx(motion.button,{onClick:()=>b("left"),whileHover:{scale:1.02},whileTap:{scale:.98},className:`flex-1 py-3.5 rounded-2xl font-bold shadow-native native-active ${c==="left"?"neuropad-primary neuropad-text-primary shadow-primary/25":"bg-white border-2 border-primary neuropad-text-primary"}`,"data-testid":"button-select-left",children:"Left Foot"}),jsxRuntimeExports.jsx(motion.button,{onClick:()=>b("right"),whileHover:{scale:1.02},whileTap:{scale:.98},className:`flex-1 py-3.5 rounded-2xl font-bold shadow-native native-active ${c==="right"?"neuropad-primary neuropad-text-primary shadow-primary/25":"bg-white border-2 border-primary neuropad-text-primary"}`,"data-testid":"button-select-right",children:"Right Foot"})]})}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-8",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"native-card-elevated p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-5",children:[jsxRuntimeExports.jsxs("h3",{className:"text-title neuropad-text-primary",children:[c==="left"?"Left":"Right"," Foot - Camera View"]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:`text-sm font-bold ${dt?"text-green-600":"neuropad-text-secondary"}`,children:dt?" Camera On":" Camera Off"}),jsxRuntimeExports.jsx("span",{className:`text-sm font-bold ${at?"text-red-500":"neuropad-text-secondary"}`,children:at?" Recording":" Not Recording"})]})]}),jsxRuntimeExports.jsxs("div",{className:"relative w-full aspect-video bg-black rounded-xl overflow-hidden border-4 border-primary",children:[jsxRuntimeExports.jsx("video",{ref:Bt,autoPlay:!0,playsInline:!0,onClick:Sr,className:`w-full h-full object-cover ${at&&dt?"cursor-crosshair":"cursor-not-allowed"}`,"data-testid":"camera-feed"}),jsxRuntimeExports.jsx("canvas",{ref:It,className:"absolute inset-0 w-full h-full pointer-events-none"}),$.map((Xt,mr)=>jsxRuntimeExports.jsx("div",{className:`absolute w-8 h-8 rounded-full ${Zr(Xt.pressure)} opacity-80 transform -translate-x-1/2 -translate-y-1/2 flex items-center justify-center text-white text-xs font-bold shadow-lg border-2 border-white`,style:{left:`${Xt.x}%`,top:`${Xt.y}%`},"data-testid":`pressure-point-${mr}`,children:Xt.pressure},mr)),!dt&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900",children:jsxRuntimeExports.jsxs("div",{className:"text-center text-white",children:[jsxRuntimeExports.jsx(CameraOff,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),jsxRuntimeExports.jsx("p",{className:"text-sm opacity-75",children:'Camera is off. Click "Start Camera" to begin.'})]})})]}),jsxRuntimeExports.jsxs("div",{className:"mt-5 flex justify-around text-xs",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500 shadow-sm"}),jsxRuntimeExports.jsx("span",{className:"neuropad-text-secondary font-medium",children:"20-40"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500 shadow-sm"}),jsxRuntimeExports.jsx("span",{className:"neuropad-text-secondary font-medium",children:"40-60"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500 shadow-sm"}),jsxRuntimeExports.jsx("span",{className:"neuropad-text-secondary font-medium",children:"60-80"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500 shadow-sm"}),jsxRuntimeExports.jsx("span",{className:"neuropad-text-secondary font-medium",children:"80-100"})]})]}),jsxRuntimeExports.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-2xl",children:[jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary font-medium",children:"Points"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-bold neuropad-text-primary",children:$.length})]}),jsxRuntimeExports.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-2xl",children:[jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary font-medium",children:"Avg Pressure"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-bold neuropad-text-primary",children:$.length>0?Math.round($.reduce((Xt,mr)=>Xt+mr.pressure,0)/$.length):0})]})]}),jsxRuntimeExports.jsxs("div",{className:"mt-4 px-4 py-3 bg-gray-50 rounded-2xl flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary font-medium",children:"Target"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-bold neuropad-text-primary capitalize",children:bt})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary font-medium",children:"Confidence"}),jsxRuntimeExports.jsxs("p",{className:"text-sm font-bold neuropad-text-primary",children:[Dt,"%"]})]})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-6 mb-8 space-y-3",children:[jsxRuntimeExports.jsx(motion.button,{onClick:dt?Kt:Ht,whileHover:{scale:1.02},whileTap:{scale:.98},className:`w-full py-4 rounded-2xl font-bold shadow-native-lg native-active flex items-center justify-center gap-2 ${dt?"bg-gradient-to-r from-green-500 to-green-600 text-white shadow-green-500/25":"bg-gradient-to-r from-yellow-400 to-yellow-500 text-white shadow-yellow-500/25"}`,"data-testid":"button-toggle-camera",children:dt?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(CameraOff,{className:"w-5 h-5"}),"Stop Camera"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Camera,{className:"w-5 h-5"}),"Start Camera"]})}),jsxRuntimeExports.jsxs(motion.button,{onClick:()=>h(!at),whileHover:{scale:1.02},whileTap:{scale:.98},className:`w-full py-4 rounded-2xl font-bold shadow-native-lg native-active flex items-center justify-center gap-2 ${at?"bg-gradient-to-r from-red-500 to-red-600 text-white shadow-red-500/25":"bg-gradient-to-r from-yellow-400 to-yellow-500 text-white shadow-yellow-500/25"}`,disabled:!dt,"data-testid":"button-toggle-recording",children:[jsxRuntimeExports.jsx(Activity,{className:"w-5 h-5"}),at?"Stop Manual Mode":"Manual Mode (Tap to Mark)"]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx(motion.button,{onClick:nr,whileHover:{scale:1.02},whileTap:{scale:.98},className:`flex-1 py-3.5 rounded-2xl font-bold shadow-native native-active ${xt?"bg-gradient-to-r from-green-500 to-green-600 text-white shadow-green-500/25":"bg-white border-2 border-primary neuropad-text-primary"}`,disabled:!dt,"data-testid":"button-scan-target",children:xt?"Stop Scan":"Scan Target"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 py-3.5 rounded-2xl bg-white border-2 border-primary flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-bold neuropad-text-primary",children:"Target:"}),jsxRuntimeExports.jsxs("select",{className:"text-sm font-bold neuropad-text-primary bg-transparent",value:bt,onChange:Xt=>kt(Xt.target.value),children:[jsxRuntimeExports.jsx("option",{value:"cardboard",children:"Cardboard"}),jsxRuntimeExports.jsx("option",{value:"aluminum",children:"Aluminum"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsxs(motion.button,{onClick:rn,whileHover:{scale:1.02},whileTap:{scale:.98},className:"flex-1 py-3.5 rounded-2xl bg-white border-2 border-primary neuropad-text-primary font-bold shadow-native native-active disabled:opacity-50 flex items-center justify-center gap-2",disabled:$.length===0,"data-testid":"button-reset",children:[jsxRuntimeExports.jsx(RotateCw,{className:"w-5 h-5"}),"Reset"]}),jsxRuntimeExports.jsxs(motion.button,{onClick:$r,whileHover:{scale:1.02},whileTap:{scale:.98},className:"flex-1 py-3.5 rounded-2xl neuropad-primary font-bold shadow-native shadow-primary/25 native-active disabled:opacity-50 flex items-center justify-center gap-2",disabled:$.length===0||br.isPending,"data-testid":"button-save",children:[jsxRuntimeExports.jsx(Save,{className:"w-5 h-5"}),br.isPending?"Saving...":"Save Data"]})]})]}),Kr&&jsxRuntimeExports.jsxs("div",{className:"px-6 mb-8",children:[jsxRuntimeExports.jsx("h3",{className:"text-headline mb-5 neuropad-text-primary",children:"Latest Reading"}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"native-card-elevated p-5",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary font-medium",children:"Foot"}),jsxRuntimeExports.jsx("p",{className:"font-bold neuropad-text-primary capitalize",children:Kr.foot})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary font-medium",children:"Avg Pressure"}),jsxRuntimeExports.jsx("p",{className:"font-bold neuropad-text-primary",children:Kr.averagePressure})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm neuropad-text-secondary font-medium",children:"Max Pressure"}),jsxRuntimeExports.jsx("p",{className:"font-bold neuropad-text-primary",children:Kr.maxPressure})]})]}),jsxRuntimeExports.jsx("p",{className:"text-xs neuropad-text-secondary mt-4 text-center font-medium",children:Kr.recordedAt?new Date(Kr.recordedAt).toLocaleString():""})]})]})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/footpad-tracking"})]})})}var lottie$1={exports:{}};(function(module,exports){typeof document<"u"&&typeof navigator<"u"&&function(e,i){module.exports=i()}(commonjsGlobal,function(){var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(i){_useWebWorker=!!i},getWebWorker=function(){return _useWebWorker},setLocationHref=function(i){locationHref=i},getLocationHref=function(){return locationHref};function createTag(e){return document.createElement(e)}function extendPrototype(e,i){var c,b=e.length,$;for(c=0;c<b;c+=1){$=e[c].prototype;for(var it in $)Object.prototype.hasOwnProperty.call($,it)&&(i.prototype[it]=$[it])}}function getDescriptor(e,i){return Object.getOwnPropertyDescriptor(e,i)}function createProxyFunction(e){function i(){}return i.prototype=e,i}var audioControllerFactory=function(){function e(i){this.audios=[],this.audioFactory=i,this._volume=1,this._isMuted=!1}return e.prototype={addAudio:function(c){this.audios.push(c)},pause:function(){var c,b=this.audios.length;for(c=0;c<b;c+=1)this.audios[c].pause()},resume:function(){var c,b=this.audios.length;for(c=0;c<b;c+=1)this.audios[c].resume()},setRate:function(c){var b,$=this.audios.length;for(b=0;b<$;b+=1)this.audios[b].setRate(c)},createAudio:function(c){return this.audioFactory?this.audioFactory(c):window.Howl?new window.Howl({src:[c]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(c){this.audioFactory=c},setVolume:function(c){this._volume=c,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var c,b=this.audios.length;for(c=0;c<b;c+=1)this.audios[c].volume(this._volume*(this._isMuted?0:1))}},function(){return new e}}(),createTypedArray=function(){function e(c,b){var $=0,it=[],at;switch(c){case"int16":case"uint8c":at=1;break;default:at=1.1;break}for($=0;$<b;$+=1)it.push(at);return it}function i(c,b){return c==="float32"?new Float32Array(b):c==="int16"?new Int16Array(b):c==="uint8c"?new Uint8ClampedArray(b):e(c,b)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?i:e}();function createSizedArray(e){return Array.apply(null,{length:e})}function _typeof$6(e){"@babel/helpers - typeof";return _typeof$6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$6(e)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};(function(){var e=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],i,c=e.length;for(i=0;i<c;i+=1)BMMath[e[i]]=Math[e[i]]})(),BMMath.random=Math.random,BMMath.abs=function(e){var i=_typeof$6(e);if(i==="object"&&e.length){var c=createSizedArray(e.length),b,$=e.length;for(b=0;b<$;b+=1)c[b]=Math.abs(e[b]);return c}return Math.abs(e)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function styleDiv(e){e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.display="block",e.style.transformOrigin="0 0",e.style.webkitTransformOrigin="0 0",e.style.backfaceVisibility="visible",e.style.webkitBackfaceVisibility="visible",e.style.transformStyle="preserve-3d",e.style.webkitTransformStyle="preserve-3d",e.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(e,i,c,b){this.type=e,this.currentTime=i,this.totalTime=c,this.direction=b<0?-1:1}function BMCompleteEvent(e,i){this.type=e,this.direction=i<0?-1:1}function BMCompleteLoopEvent(e,i,c,b){this.type=e,this.currentLoop=c,this.totalLoops=i,this.direction=b<0?-1:1}function BMSegmentStartEvent(e,i,c){this.type=e,this.firstFrame=i,this.totalFrames=c}function BMDestroyEvent(e,i){this.type=e,this.target=i}function BMRenderFrameErrorEvent(e,i){this.type="renderFrameError",this.nativeError=e,this.currentTime=i}function BMConfigErrorEvent(e){this.type="configError",this.nativeError=e}var createElementID=function(){var e=0;return function(){return e+=1,idPrefix$1+"__lottie_element_"+e}}();function HSVtoRGB(e,i,c){var b,$,it,at,h,dt,ft,xt;switch(at=Math.floor(e*6),h=e*6-at,dt=c*(1-i),ft=c*(1-h*i),xt=c*(1-(1-h)*i),at%6){case 0:b=c,$=xt,it=dt;break;case 1:b=ft,$=c,it=dt;break;case 2:b=dt,$=c,it=xt;break;case 3:b=dt,$=ft,it=c;break;case 4:b=xt,$=dt,it=c;break;case 5:b=c,$=dt,it=ft;break}return[b,$,it]}function RGBtoHSV(e,i,c){var b=Math.max(e,i,c),$=Math.min(e,i,c),it=b-$,at,h=b===0?0:it/b,dt=b/255;switch(b){case $:at=0;break;case e:at=i-c+it*(i<c?6:0),at/=6*it;break;case i:at=c-e+it*2,at/=6*it;break;case c:at=e-i+it*4,at/=6*it;break}return[at,h,dt]}function addSaturationToRGB(e,i){var c=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return c[1]+=i,c[1]>1?c[1]=1:c[1]<=0&&(c[1]=0),HSVtoRGB(c[0],c[1],c[2])}function addBrightnessToRGB(e,i){var c=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return c[2]+=i,c[2]>1?c[2]=1:c[2]<0&&(c[2]=0),HSVtoRGB(c[0],c[1],c[2])}function addHueToRGB(e,i){var c=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return c[0]+=i/360,c[0]>1?c[0]-=1:c[0]<0&&(c[0]+=1),HSVtoRGB(c[0],c[1],c[2])}var rgbToHex=function(){var e=[],i,c;for(i=0;i<256;i+=1)c=i.toString(16),e[i]=c.length===1?"0"+c:c;return function(b,$,it){return b<0&&(b=0),$<0&&($=0),it<0&&(it=0),"#"+e[b]+e[$]+e[it]}}(),setSubframeEnabled=function(i){subframeEnabled=!!i},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(i){expressionsPlugin=i},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(i){expressionsInterfaces=i},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(i){defaultCurveSegments=i},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(i){idPrefix$1=i};function createNS(e){return document.createElementNS(svgNS,e)}function _typeof$5(e){"@babel/helpers - typeof";return _typeof$5=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$5(e)}var dataManager=function(){var e=1,i=[],c,b,$={onmessage:function(){},postMessage:function(kt){c({data:kt})}},it={postMessage:function(kt){$.onmessage({data:kt})}};function at(bt){if(window.Worker&&window.Blob&&getWebWorker()){var kt=new Blob(["var _workerSelf = self; self.onmessage = ",bt.toString()],{type:"text/javascript"}),Dt=URL.createObjectURL(kt);return new Worker(Dt)}return c=bt,$}function h(){b||(b=at(function(kt){function Dt(){function Bt(Kr,Xt){var mr,Ut,Jt=Kr.length,Or,Cr,pn,On;for(Ut=0;Ut<Jt;Ut+=1)if(mr=Kr[Ut],"ks"in mr&&!mr.completed){if(mr.completed=!0,mr.hasMask){var Zn=mr.masksProperties;for(Cr=Zn.length,Or=0;Or<Cr;Or+=1)if(Zn[Or].pt.k.i)Ht(Zn[Or].pt.k);else for(On=Zn[Or].pt.k.length,pn=0;pn<On;pn+=1)Zn[Or].pt.k[pn].s&&Ht(Zn[Or].pt.k[pn].s[0]),Zn[Or].pt.k[pn].e&&Ht(Zn[Or].pt.k[pn].e[0])}mr.ty===0?(mr.layers=St(mr.refId,Xt),Bt(mr.layers,Xt)):mr.ty===4?jt(mr.shapes):mr.ty===5&&rn(mr)}}function Tt(Kr,Xt){if(Kr){var mr=0,Ut=Kr.length;for(mr=0;mr<Ut;mr+=1)Kr[mr].t===1&&(Kr[mr].data.layers=St(Kr[mr].data.refId,Xt),Bt(Kr[mr].data.layers,Xt))}}function It(Kr,Xt){for(var mr=0,Ut=Xt.length;mr<Ut;){if(Xt[mr].id===Kr)return Xt[mr];mr+=1}return null}function St(Kr,Xt){var mr=It(Kr,Xt);return mr?mr.layers.__used?JSON.parse(JSON.stringify(mr.layers)):(mr.layers.__used=!0,mr.layers):null}function jt(Kr){var Xt,mr=Kr.length,Ut,Jt;for(Xt=mr-1;Xt>=0;Xt-=1)if(Kr[Xt].ty==="sh")if(Kr[Xt].ks.k.i)Ht(Kr[Xt].ks.k);else for(Jt=Kr[Xt].ks.k.length,Ut=0;Ut<Jt;Ut+=1)Kr[Xt].ks.k[Ut].s&&Ht(Kr[Xt].ks.k[Ut].s[0]),Kr[Xt].ks.k[Ut].e&&Ht(Kr[Xt].ks.k[Ut].e[0]);else Kr[Xt].ty==="gr"&&jt(Kr[Xt].it)}function Ht(Kr){var Xt,mr=Kr.i.length;for(Xt=0;Xt<mr;Xt+=1)Kr.i[Xt][0]+=Kr.v[Xt][0],Kr.i[Xt][1]+=Kr.v[Xt][1],Kr.o[Xt][0]+=Kr.v[Xt][0],Kr.o[Xt][1]+=Kr.v[Xt][1]}function Kt(Kr,Xt){var mr=Xt?Xt.split("."):[100,100,100];return Kr[0]>mr[0]?!0:mr[0]>Kr[0]?!1:Kr[1]>mr[1]?!0:mr[1]>Kr[1]?!1:Kr[2]>mr[2]?!0:mr[2]>Kr[2]?!1:null}var ir=function(){var Kr=[4,4,14];function Xt(Ut){var Jt=Ut.t.d;Ut.t.d={k:[{s:Jt,t:0}]}}function mr(Ut){var Jt,Or=Ut.length;for(Jt=0;Jt<Or;Jt+=1)Ut[Jt].ty===5&&Xt(Ut[Jt])}return function(Ut){if(Kt(Kr,Ut.v)&&(mr(Ut.layers),Ut.assets)){var Jt,Or=Ut.assets.length;for(Jt=0;Jt<Or;Jt+=1)Ut.assets[Jt].layers&&mr(Ut.assets[Jt].layers)}}}(),nr=function(){var Kr=[4,7,99];return function(Xt){if(Xt.chars&&!Kt(Kr,Xt.v)){var mr,Ut=Xt.chars.length;for(mr=0;mr<Ut;mr+=1){var Jt=Xt.chars[mr];Jt.data&&Jt.data.shapes&&(jt(Jt.data.shapes),Jt.data.ip=0,Jt.data.op=99999,Jt.data.st=0,Jt.data.sr=1,Jt.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},Xt.chars[mr].t||(Jt.data.shapes.push({ty:"no"}),Jt.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),kr=function(){var Kr=[5,7,15];function Xt(Ut){var Jt=Ut.t.p;typeof Jt.a=="number"&&(Jt.a={a:0,k:Jt.a}),typeof Jt.p=="number"&&(Jt.p={a:0,k:Jt.p}),typeof Jt.r=="number"&&(Jt.r={a:0,k:Jt.r})}function mr(Ut){var Jt,Or=Ut.length;for(Jt=0;Jt<Or;Jt+=1)Ut[Jt].ty===5&&Xt(Ut[Jt])}return function(Ut){if(Kt(Kr,Ut.v)&&(mr(Ut.layers),Ut.assets)){var Jt,Or=Ut.assets.length;for(Jt=0;Jt<Or;Jt+=1)Ut.assets[Jt].layers&&mr(Ut.assets[Jt].layers)}}}(),br=function(){var Kr=[4,1,9];function Xt(Ut){var Jt,Or=Ut.length,Cr,pn;for(Jt=0;Jt<Or;Jt+=1)if(Ut[Jt].ty==="gr")Xt(Ut[Jt].it);else if(Ut[Jt].ty==="fl"||Ut[Jt].ty==="st")if(Ut[Jt].c.k&&Ut[Jt].c.k[0].i)for(pn=Ut[Jt].c.k.length,Cr=0;Cr<pn;Cr+=1)Ut[Jt].c.k[Cr].s&&(Ut[Jt].c.k[Cr].s[0]/=255,Ut[Jt].c.k[Cr].s[1]/=255,Ut[Jt].c.k[Cr].s[2]/=255,Ut[Jt].c.k[Cr].s[3]/=255),Ut[Jt].c.k[Cr].e&&(Ut[Jt].c.k[Cr].e[0]/=255,Ut[Jt].c.k[Cr].e[1]/=255,Ut[Jt].c.k[Cr].e[2]/=255,Ut[Jt].c.k[Cr].e[3]/=255);else Ut[Jt].c.k[0]/=255,Ut[Jt].c.k[1]/=255,Ut[Jt].c.k[2]/=255,Ut[Jt].c.k[3]/=255}function mr(Ut){var Jt,Or=Ut.length;for(Jt=0;Jt<Or;Jt+=1)Ut[Jt].ty===4&&Xt(Ut[Jt].shapes)}return function(Ut){if(Kt(Kr,Ut.v)&&(mr(Ut.layers),Ut.assets)){var Jt,Or=Ut.assets.length;for(Jt=0;Jt<Or;Jt+=1)Ut.assets[Jt].layers&&mr(Ut.assets[Jt].layers)}}}(),Sr=function(){var Kr=[4,4,18];function Xt(Ut){var Jt,Or=Ut.length,Cr,pn;for(Jt=Or-1;Jt>=0;Jt-=1)if(Ut[Jt].ty==="sh")if(Ut[Jt].ks.k.i)Ut[Jt].ks.k.c=Ut[Jt].closed;else for(pn=Ut[Jt].ks.k.length,Cr=0;Cr<pn;Cr+=1)Ut[Jt].ks.k[Cr].s&&(Ut[Jt].ks.k[Cr].s[0].c=Ut[Jt].closed),Ut[Jt].ks.k[Cr].e&&(Ut[Jt].ks.k[Cr].e[0].c=Ut[Jt].closed);else Ut[Jt].ty==="gr"&&Xt(Ut[Jt].it)}function mr(Ut){var Jt,Or,Cr=Ut.length,pn,On,Zn,As;for(Or=0;Or<Cr;Or+=1){if(Jt=Ut[Or],Jt.hasMask){var ss=Jt.masksProperties;for(On=ss.length,pn=0;pn<On;pn+=1)if(ss[pn].pt.k.i)ss[pn].pt.k.c=ss[pn].cl;else for(As=ss[pn].pt.k.length,Zn=0;Zn<As;Zn+=1)ss[pn].pt.k[Zn].s&&(ss[pn].pt.k[Zn].s[0].c=ss[pn].cl),ss[pn].pt.k[Zn].e&&(ss[pn].pt.k[Zn].e[0].c=ss[pn].cl)}Jt.ty===4&&Xt(Jt.shapes)}}return function(Ut){if(Kt(Kr,Ut.v)&&(mr(Ut.layers),Ut.assets)){var Jt,Or=Ut.assets.length;for(Jt=0;Jt<Or;Jt+=1)Ut.assets[Jt].layers&&mr(Ut.assets[Jt].layers)}}}();function $r(Kr){Kr.__complete||(br(Kr),ir(Kr),nr(Kr),kr(Kr),Sr(Kr),Bt(Kr.layers,Kr.assets),Tt(Kr.chars,Kr.assets),Kr.__complete=!0)}function rn(Kr){Kr.t.a.length===0&&"m"in Kr.t.p}var Zr={};return Zr.completeData=$r,Zr.checkColors=br,Zr.checkChars=nr,Zr.checkPathProperties=kr,Zr.checkShapes=Sr,Zr.completeLayers=Bt,Zr}if(it.dataManager||(it.dataManager=Dt()),it.assetLoader||(it.assetLoader=function(){function Bt(It){var St=It.getResponseHeader("content-type");return St&&It.responseType==="json"&&St.indexOf("json")!==-1||It.response&&_typeof$5(It.response)==="object"?It.response:It.response&&typeof It.response=="string"?JSON.parse(It.response):It.responseText?JSON.parse(It.responseText):null}function Tt(It,St,jt,Ht){var Kt,ir=new XMLHttpRequest;try{ir.responseType="json"}catch{}ir.onreadystatechange=function(){if(ir.readyState===4)if(ir.status===200)Kt=Bt(ir),jt(Kt);else try{Kt=Bt(ir),jt(Kt)}catch(nr){Ht&&Ht(nr)}};try{ir.open(["G","E","T"].join(""),It,!0)}catch{ir.open(["G","E","T"].join(""),St+"/"+It,!0)}ir.send()}return{load:Tt}}()),kt.data.type==="loadAnimation")it.assetLoader.load(kt.data.path,kt.data.fullPath,function(Bt){it.dataManager.completeData(Bt),it.postMessage({id:kt.data.id,payload:Bt,status:"success"})},function(){it.postMessage({id:kt.data.id,status:"error"})});else if(kt.data.type==="complete"){var At=kt.data.animation;it.dataManager.completeData(At),it.postMessage({id:kt.data.id,payload:At,status:"success"})}else kt.data.type==="loadData"&&it.assetLoader.load(kt.data.path,kt.data.fullPath,function(Bt){it.postMessage({id:kt.data.id,payload:Bt,status:"success"})},function(){it.postMessage({id:kt.data.id,status:"error"})})}),b.onmessage=function(bt){var kt=bt.data,Dt=kt.id,At=i[Dt];i[Dt]=null,kt.status==="success"?At.onComplete(kt.payload):At.onError&&At.onError()})}function dt(bt,kt){e+=1;var Dt="processId_"+e;return i[Dt]={onComplete:bt,onError:kt},Dt}function ft(bt,kt,Dt){h();var At=dt(kt,Dt);b.postMessage({type:"loadAnimation",path:bt,fullPath:window.location.origin+window.location.pathname,id:At})}function xt(bt,kt,Dt){h();var At=dt(kt,Dt);b.postMessage({type:"loadData",path:bt,fullPath:window.location.origin+window.location.pathname,id:At})}function Ct(bt,kt,Dt){h();var At=dt(kt,Dt);b.postMessage({type:"complete",animation:bt,id:At})}return{loadAnimation:ft,loadData:xt,completeAnimation:Ct}}(),ImagePreloader=function(){var e=function(){var Tt=createTag("canvas");Tt.width=1,Tt.height=1;var It=Tt.getContext("2d");return It.fillStyle="rgba(0,0,0,0)",It.fillRect(0,0,1,1),Tt}();function i(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function c(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function b(Tt,It,St){var jt="";if(Tt.e)jt=Tt.p;else if(It){var Ht=Tt.p;Ht.indexOf("images/")!==-1&&(Ht=Ht.split("/")[1]),jt=It+Ht}else jt=St,jt+=Tt.u?Tt.u:"",jt+=Tt.p;return jt}function $(Tt){var It=0,St=setInterval((function(){var jt=Tt.getBBox();(jt.width||It>500)&&(this._imageLoaded(),clearInterval(St)),It+=1}).bind(this),50)}function it(Tt){var It=b(Tt,this.assetsPath,this.path),St=createNS("image");isSafari?this.testImageLoaded(St):St.addEventListener("load",this._imageLoaded,!1),St.addEventListener("error",(function(){jt.img=e,this._imageLoaded()}).bind(this),!1),St.setAttributeNS("http://www.w3.org/1999/xlink","href",It),this._elementHelper.append?this._elementHelper.append(St):this._elementHelper.appendChild(St);var jt={img:St,assetData:Tt};return jt}function at(Tt){var It=b(Tt,this.assetsPath,this.path),St=createTag("img");St.crossOrigin="anonymous",St.addEventListener("load",this._imageLoaded,!1),St.addEventListener("error",(function(){jt.img=e,this._imageLoaded()}).bind(this),!1),St.src=It;var jt={img:St,assetData:Tt};return jt}function h(Tt){var It={assetData:Tt},St=b(Tt,this.assetsPath,this.path);return dataManager.loadData(St,(function(jt){It.img=jt,this._footageLoaded()}).bind(this),(function(){It.img={},this._footageLoaded()}).bind(this)),It}function dt(Tt,It){this.imagesLoadedCb=It;var St,jt=Tt.length;for(St=0;St<jt;St+=1)Tt[St].layers||(!Tt[St].t||Tt[St].t==="seq"?(this.totalImages+=1,this.images.push(this._createImageData(Tt[St]))):Tt[St].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(Tt[St]))))}function ft(Tt){this.path=Tt||""}function xt(Tt){this.assetsPath=Tt||""}function Ct(Tt){for(var It=0,St=this.images.length;It<St;){if(this.images[It].assetData===Tt)return this.images[It].img;It+=1}return null}function bt(){this.imagesLoadedCb=null,this.images.length=0}function kt(){return this.totalImages===this.loadedAssets}function Dt(){return this.totalFootages===this.loadedFootagesCount}function At(Tt,It){Tt==="svg"?(this._elementHelper=It,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function Bt(){this._imageLoaded=i.bind(this),this._footageLoaded=c.bind(this),this.testImageLoaded=$.bind(this),this.createFootageData=h.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return Bt.prototype={loadAssets:dt,setAssetsPath:xt,setPath:ft,loadedImages:kt,loadedFootages:Dt,destroy:bt,getAsset:Ct,createImgData:at,createImageData:it,imageLoaded:i,footageLoaded:c,setCacheType:At},Bt}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(i,c){if(this._cbs[i])for(var b=this._cbs[i],$=0;$<b.length;$+=1)b[$](c)},addEventListener:function(i,c){return this._cbs[i]||(this._cbs[i]=[]),this._cbs[i].push(c),(function(){this.removeEventListener(i,c)}).bind(this)},removeEventListener:function(i,c){if(!c)this._cbs[i]=null;else if(this._cbs[i]){for(var b=0,$=this._cbs[i].length;b<$;)this._cbs[i][b]===c&&(this._cbs[i].splice(b,1),b-=1,$-=1),b+=1;this._cbs[i].length||(this._cbs[i]=null)}}};var markerParser=function(){function e(i){for(var c=i.split(`\r
`),b={},$,it=0,at=0;at<c.length;at+=1)$=c[at].split(":"),$.length===2&&(b[$[0]]=$[1].trim(),it+=1);if(it===0)throw new Error;return b}return function(i){for(var c=[],b=0;b<i.length;b+=1){var $=i[b],it={time:$.tm,duration:$.dr};try{it.payload=JSON.parse(i[b].cm)}catch{try{it.payload=e(i[b].cm)}catch{it.payload={name:i[b].cm}}}c.push(it)}return c}}(),ProjectInterface=function(){function e(i){this.compositions.push(i)}return function(){function i(c){for(var b=0,$=this.compositions.length;b<$;){if(this.compositions[b].data&&this.compositions[b].data.nm===c)return this.compositions[b].prepareFrame&&this.compositions[b].data.xt&&this.compositions[b].prepareFrame(this.currentFrame),this.compositions[b].compInterface;b+=1}return null}return i.compositions=[],i.currentFrame=0,i.registerComposition=e,i}}(),renderers={},registerRenderer=function(i,c){renderers[i]=c};function getRenderer(e){return renderers[e]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var e in renderers)if(renderers[e])return e;return""}function _typeof$4(e){"@babel/helpers - typeof";return _typeof$4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$4(e)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(e){(e.wrapper||e.container)&&(this.wrapper=e.wrapper||e.container);var i="svg";e.animType?i=e.animType:e.renderer&&(i=e.renderer);var c=getRenderer(i);this.renderer=new c(this,e.rendererSettings),this.imagePreloader.setCacheType(i,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=i,e.loop===""||e.loop===null||e.loop===void 0||e.loop===!0?this.loop=!0:e.loop===!1?this.loop=!1:this.loop=parseInt(e.loop,10),this.autoplay="autoplay"in e?e.autoplay:!0,this.name=e.name?e.name:"",this.autoloadSegments=Object.prototype.hasOwnProperty.call(e,"autoloadSegments")?e.autoloadSegments:!0,this.assetsPath=e.assetsPath,this.initialSegment=e.initialSegment,e.audioFactory&&this.audioController.setAudioFactory(e.audioFactory),e.animationData?this.setupAnimation(e.animationData):e.path&&(e.path.lastIndexOf("\\")!==-1?this.path=e.path.substr(0,e.path.lastIndexOf("\\")+1):this.path=e.path.substr(0,e.path.lastIndexOf("/")+1),this.fileName=e.path.substr(e.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(e.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(e){dataManager.completeAnimation(e,this.configAnimation)},AnimationItem.prototype.setData=function(e,i){i&&_typeof$4(i)!=="object"&&(i=JSON.parse(i));var c={wrapper:e,animationData:i},b=e.attributes;c.path=b.getNamedItem("data-animation-path")?b.getNamedItem("data-animation-path").value:b.getNamedItem("data-bm-path")?b.getNamedItem("data-bm-path").value:b.getNamedItem("bm-path")?b.getNamedItem("bm-path").value:"",c.animType=b.getNamedItem("data-anim-type")?b.getNamedItem("data-anim-type").value:b.getNamedItem("data-bm-type")?b.getNamedItem("data-bm-type").value:b.getNamedItem("bm-type")?b.getNamedItem("bm-type").value:b.getNamedItem("data-bm-renderer")?b.getNamedItem("data-bm-renderer").value:b.getNamedItem("bm-renderer")?b.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var $=b.getNamedItem("data-anim-loop")?b.getNamedItem("data-anim-loop").value:b.getNamedItem("data-bm-loop")?b.getNamedItem("data-bm-loop").value:b.getNamedItem("bm-loop")?b.getNamedItem("bm-loop").value:"";$==="false"?c.loop=!1:$==="true"?c.loop=!0:$!==""&&(c.loop=parseInt($,10));var it=b.getNamedItem("data-anim-autoplay")?b.getNamedItem("data-anim-autoplay").value:b.getNamedItem("data-bm-autoplay")?b.getNamedItem("data-bm-autoplay").value:b.getNamedItem("bm-autoplay")?b.getNamedItem("bm-autoplay").value:!0;c.autoplay=it!=="false",c.name=b.getNamedItem("data-name")?b.getNamedItem("data-name").value:b.getNamedItem("data-bm-name")?b.getNamedItem("data-bm-name").value:b.getNamedItem("bm-name")?b.getNamedItem("bm-name").value:"";var at=b.getNamedItem("data-anim-prerender")?b.getNamedItem("data-anim-prerender").value:b.getNamedItem("data-bm-prerender")?b.getNamedItem("data-bm-prerender").value:b.getNamedItem("bm-prerender")?b.getNamedItem("bm-prerender").value:"";at==="false"&&(c.prerender=!1),c.path?this.setParams(c):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(e){e.op>this.animationData.op&&(this.animationData.op=e.op,this.totalFrames=Math.floor(e.op-this.animationData.ip));var i=this.animationData.layers,c,b=i.length,$=e.layers,it,at=$.length;for(it=0;it<at;it+=1)for(c=0;c<b;){if(i[c].id===$[it].id){i[c]=$[it];break}c+=1}if((e.chars||e.fonts)&&(this.renderer.globalData.fontManager.addChars(e.chars),this.renderer.globalData.fontManager.addFonts(e.fonts,this.renderer.globalData.defs)),e.assets)for(b=e.assets.length,c=0;c<b;c+=1)this.animationData.assets.push(e.assets[c]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(e){this.animationData=e;var i=getExpressionsPlugin();i&&i.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var e=this.animationData.segments;if(!e||e.length===0||!this.autoloadSegments){this.trigger("data_ready"),this.timeCompleted=this.totalFrames;return}var i=e.shift();this.timeCompleted=i.time*this.frameRate;var c=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(c,this.includeLayers.bind(this),(function(){this.trigger("data_failed")}).bind(this))},AnimationItem.prototype.loadSegments=function(){var e=this.animationData.segments;e||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(e){if(this.renderer)try{this.animationData=e,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(e),e.assets||(e.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(e.assets),this.markers=markerParser(e.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(i){this.triggerConfigError(i)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.renderer.initItems(),setTimeout((function(){this.trigger("DOMLoaded")}).bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(e,i){var c=typeof e=="number"?e:void 0,b=typeof i=="number"?i:void 0;this.renderer.updateContainerSize(c,b)},AnimationItem.prototype.setSubframe=function(e){this.isSubframeEnabled=!!e},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!(this.isLoaded===!1||!this.renderer))try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(e){this.triggerRenderFrameError(e)}},AnimationItem.prototype.play=function(e){e&&this.name!==e||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(e){e&&this.name!==e||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(e){e&&this.name!==e||(this.isPaused===!0?this.play():this.pause())},AnimationItem.prototype.stop=function(e){e&&this.name!==e||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(e){for(var i,c=0;c<this.markers.length;c+=1)if(i=this.markers[c],i.payload&&i.payload.name===e)return i;return null},AnimationItem.prototype.goToAndStop=function(e,i,c){if(!(c&&this.name!==c)){var b=Number(e);if(isNaN(b)){var $=this.getMarkerData(e);$&&this.goToAndStop($.time,!0)}else i?this.setCurrentRawFrameValue(e):this.setCurrentRawFrameValue(e*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(e,i,c){if(!(c&&this.name!==c)){var b=Number(e);if(isNaN(b)){var $=this.getMarkerData(e);$&&($.duration?this.playSegments([$.time,$.time+$.duration],!0):this.goToAndStop($.time,!0))}else this.goToAndStop(b,i,c);this.play()}},AnimationItem.prototype.advanceTime=function(e){if(!(this.isPaused===!0||this.isLoaded===!1)){var i=this.currentRawFrame+e*this.frameModifier,c=!1;i>=this.totalFrames-1&&this.frameModifier>0?!this.loop||this.playCount===this.loop?this.checkSegments(i>this.totalFrames?i%this.totalFrames:0)||(c=!0,i=this.totalFrames-1):i>=this.totalFrames?(this.playCount+=1,this.checkSegments(i%this.totalFrames)||(this.setCurrentRawFrameValue(i%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(i):i<0?this.checkSegments(i%this.totalFrames)||(this.loop&&!(this.playCount--<=0&&this.loop!==!0)?(this.setCurrentRawFrameValue(this.totalFrames+i%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0):(c=!0,i=0)):this.setCurrentRawFrameValue(i),c&&(this.setCurrentRawFrameValue(i),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(e,i){this.playCount=0,e[1]<e[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=e[0]-e[1],this.timeCompleted=this.totalFrames,this.firstFrame=e[1],this.setCurrentRawFrameValue(this.totalFrames-.001-i)):e[1]>e[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=e[1]-e[0],this.timeCompleted=this.totalFrames,this.firstFrame=e[0],this.setCurrentRawFrameValue(.001+i)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(e,i){var c=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<e?c=e:this.currentRawFrame+this.firstFrame>i&&(c=i-e)),this.firstFrame=e,this.totalFrames=i-e,this.timeCompleted=this.totalFrames,c!==-1&&this.goToAndStop(c,!0)},AnimationItem.prototype.playSegments=function(e,i){if(i&&(this.segments.length=0),_typeof$4(e[0])==="object"){var c,b=e.length;for(c=0;c<b;c+=1)this.segments.push(e[c])}else this.segments.push(e);this.segments.length&&i&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(e){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),e&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(e){return this.segments.length?(this.adjustSegment(this.segments.shift(),e),!0):!1},AnimationItem.prototype.destroy=function(e){e&&this.name!==e||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(e){this.currentRawFrame=e,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(e){this.playSpeed=e,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(e){this.playDirection=e<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(e){this.loop=e},AnimationItem.prototype.setVolume=function(e,i){i&&this.name!==i||this.audioController.setVolume(e)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(e){e&&this.name!==e||this.audioController.mute()},AnimationItem.prototype.unmute=function(e){e&&this.name!==e||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(e){var i="";if(e.e)i=e.p;else if(this.assetsPath){var c=e.p;c.indexOf("images/")!==-1&&(c=c.split("/")[1]),i=this.assetsPath+c}else i=this.path,i+=e.u?e.u:"",i+=e.p;return i},AnimationItem.prototype.getAssetData=function(e){for(var i=0,c=this.assets.length;i<c;){if(e===this.assets[i].id)return this.assets[i];i+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(e){return e?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(e,i,c){try{var b=this.renderer.getElementByPath(e);b.updateDocumentData(i,c)}catch{}},AnimationItem.prototype.trigger=function(e){if(this._cbs&&this._cbs[e])switch(e){case"enterFrame":this.triggerEvent(e,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(e,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(e,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(e,new BMCompleteEvent(e,this.frameMult));break;case"segmentStart":this.triggerEvent(e,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(e,new BMDestroyEvent(e,this));break;default:this.triggerEvent(e)}e==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameMult)),e==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult)),e==="complete"&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(e,this.frameMult)),e==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames)),e==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(e,this))},AnimationItem.prototype.triggerRenderFrameError=function(e){var i=new BMRenderFrameErrorEvent(e,this.currentFrame);this.triggerEvent("error",i),this.onError&&this.onError.call(this,i)},AnimationItem.prototype.triggerConfigError=function(e){var i=new BMConfigErrorEvent(e,this.currentFrame);this.triggerEvent("error",i),this.onError&&this.onError.call(this,i)};var animationManager=function(){var e={},i=[],c=0,b=0,$=0,it=!0,at=!1;function h(Xt){for(var mr=0,Ut=Xt.target;mr<b;)i[mr].animation===Ut&&(i.splice(mr,1),mr-=1,b-=1,Ut.isPaused||Ct()),mr+=1}function dt(Xt,mr){if(!Xt)return null;for(var Ut=0;Ut<b;){if(i[Ut].elem===Xt&&i[Ut].elem!==null)return i[Ut].animation;Ut+=1}var Jt=new AnimationItem;return bt(Jt,Xt),Jt.setData(Xt,mr),Jt}function ft(){var Xt,mr=i.length,Ut=[];for(Xt=0;Xt<mr;Xt+=1)Ut.push(i[Xt].animation);return Ut}function xt(){$+=1,br()}function Ct(){$-=1}function bt(Xt,mr){Xt.addEventListener("destroy",h),Xt.addEventListener("_active",xt),Xt.addEventListener("_idle",Ct),i.push({elem:mr,animation:Xt}),b+=1}function kt(Xt){var mr=new AnimationItem;return bt(mr,null),mr.setParams(Xt),mr}function Dt(Xt,mr){var Ut;for(Ut=0;Ut<b;Ut+=1)i[Ut].animation.setSpeed(Xt,mr)}function At(Xt,mr){var Ut;for(Ut=0;Ut<b;Ut+=1)i[Ut].animation.setDirection(Xt,mr)}function Bt(Xt){var mr;for(mr=0;mr<b;mr+=1)i[mr].animation.play(Xt)}function Tt(Xt){var mr=Xt-c,Ut;for(Ut=0;Ut<b;Ut+=1)i[Ut].animation.advanceTime(mr);c=Xt,$&&!at?window.requestAnimationFrame(Tt):it=!0}function It(Xt){c=Xt,window.requestAnimationFrame(Tt)}function St(Xt){var mr;for(mr=0;mr<b;mr+=1)i[mr].animation.pause(Xt)}function jt(Xt,mr,Ut){var Jt;for(Jt=0;Jt<b;Jt+=1)i[Jt].animation.goToAndStop(Xt,mr,Ut)}function Ht(Xt){var mr;for(mr=0;mr<b;mr+=1)i[mr].animation.stop(Xt)}function Kt(Xt){var mr;for(mr=0;mr<b;mr+=1)i[mr].animation.togglePause(Xt)}function ir(Xt){var mr;for(mr=b-1;mr>=0;mr-=1)i[mr].animation.destroy(Xt)}function nr(Xt,mr,Ut){var Jt=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),Or,Cr=Jt.length;for(Or=0;Or<Cr;Or+=1)Ut&&Jt[Or].setAttribute("data-bm-type",Ut),dt(Jt[Or],Xt);if(mr&&Cr===0){Ut||(Ut="svg");var pn=document.getElementsByTagName("body")[0];pn.innerText="";var On=createTag("div");On.style.width="100%",On.style.height="100%",On.setAttribute("data-bm-type",Ut),pn.appendChild(On),dt(On,Xt)}}function kr(){var Xt;for(Xt=0;Xt<b;Xt+=1)i[Xt].animation.resize()}function br(){!at&&$&&it&&(window.requestAnimationFrame(It),it=!1)}function Sr(){at=!0}function $r(){at=!1,br()}function rn(Xt,mr){var Ut;for(Ut=0;Ut<b;Ut+=1)i[Ut].animation.setVolume(Xt,mr)}function Zr(Xt){var mr;for(mr=0;mr<b;mr+=1)i[mr].animation.mute(Xt)}function Kr(Xt){var mr;for(mr=0;mr<b;mr+=1)i[mr].animation.unmute(Xt)}return e.registerAnimation=dt,e.loadAnimation=kt,e.setSpeed=Dt,e.setDirection=At,e.play=Bt,e.pause=St,e.stop=Ht,e.togglePause=Kt,e.searchAnimations=nr,e.resize=kr,e.goToAndStop=jt,e.destroy=ir,e.freeze=Sr,e.unfreeze=$r,e.setVolume=rn,e.mute=Zr,e.unmute=Kr,e.getRegisteredAnimations=ft,e}(),BezierFactory=function(){var e={};e.getBezierEasing=c;var i={};function c(It,St,jt,Ht,Kt){var ir=Kt||("bez_"+It+"_"+St+"_"+jt+"_"+Ht).replace(/\./g,"p");if(i[ir])return i[ir];var nr=new Tt([It,St,jt,Ht]);return i[ir]=nr,nr}var b=4,$=.001,it=1e-7,at=10,h=11,dt=1/(h-1),ft=typeof Float32Array=="function";function xt(It,St){return 1-3*St+3*It}function Ct(It,St){return 3*St-6*It}function bt(It){return 3*It}function kt(It,St,jt){return((xt(St,jt)*It+Ct(St,jt))*It+bt(St))*It}function Dt(It,St,jt){return 3*xt(St,jt)*It*It+2*Ct(St,jt)*It+bt(St)}function At(It,St,jt,Ht,Kt){var ir,nr,kr=0;do nr=St+(jt-St)/2,ir=kt(nr,Ht,Kt)-It,ir>0?jt=nr:St=nr;while(Math.abs(ir)>it&&++kr<at);return nr}function Bt(It,St,jt,Ht){for(var Kt=0;Kt<b;++Kt){var ir=Dt(St,jt,Ht);if(ir===0)return St;var nr=kt(St,jt,Ht)-It;St-=nr/ir}return St}function Tt(It){this._p=It,this._mSampleValues=ft?new Float32Array(h):new Array(h),this._precomputed=!1,this.get=this.get.bind(this)}return Tt.prototype={get:function(St){var jt=this._p[0],Ht=this._p[1],Kt=this._p[2],ir=this._p[3];return this._precomputed||this._precompute(),jt===Ht&&Kt===ir?St:St===0?0:St===1?1:kt(this._getTForX(St),Ht,ir)},_precompute:function(){var St=this._p[0],jt=this._p[1],Ht=this._p[2],Kt=this._p[3];this._precomputed=!0,(St!==jt||Ht!==Kt)&&this._calcSampleValues()},_calcSampleValues:function(){for(var St=this._p[0],jt=this._p[2],Ht=0;Ht<h;++Ht)this._mSampleValues[Ht]=kt(Ht*dt,St,jt)},_getTForX:function(St){for(var jt=this._p[0],Ht=this._p[2],Kt=this._mSampleValues,ir=0,nr=1,kr=h-1;nr!==kr&&Kt[nr]<=St;++nr)ir+=dt;--nr;var br=(St-Kt[nr])/(Kt[nr+1]-Kt[nr]),Sr=ir+br*dt,$r=Dt(Sr,jt,Ht);return $r>=$?Bt(St,Sr,jt,Ht):$r===0?Sr:At(St,ir,ir+dt,jt,Ht)}},e}(),pooling=function(){function e(i){return i.concat(createSizedArray(i.length))}return{double:e}}(),poolFactory=function(){return function(e,i,c){var b=0,$=e,it=createSizedArray($),at={newElement:h,release:dt};function h(){var ft;return b?(b-=1,ft=it[b]):ft=i(),ft}function dt(ft){b===$&&(it=pooling.double(it),$*=2),c&&c(ft),it[b]=ft,b+=1}return at}}(),bezierLengthPool=function(){function e(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}return poolFactory(8,e)}(),segmentsLengthPool=function(){function e(){return{lengths:[],totalLength:0}}function i(c){var b,$=c.lengths.length;for(b=0;b<$;b+=1)bezierLengthPool.release(c.lengths[b]);c.lengths.length=0}return poolFactory(8,e,i)}();function bezFunction(){var e=Math;function i(bt,kt,Dt,At,Bt,Tt){var It=bt*At+kt*Bt+Dt*Tt-Bt*At-Tt*bt-Dt*kt;return It>-.001&&It<.001}function c(bt,kt,Dt,At,Bt,Tt,It,St,jt){if(Dt===0&&Tt===0&&jt===0)return i(bt,kt,At,Bt,It,St);var Ht=e.sqrt(e.pow(At-bt,2)+e.pow(Bt-kt,2)+e.pow(Tt-Dt,2)),Kt=e.sqrt(e.pow(It-bt,2)+e.pow(St-kt,2)+e.pow(jt-Dt,2)),ir=e.sqrt(e.pow(It-At,2)+e.pow(St-Bt,2)+e.pow(jt-Tt,2)),nr;return Ht>Kt?Ht>ir?nr=Ht-Kt-ir:nr=ir-Kt-Ht:ir>Kt?nr=ir-Kt-Ht:nr=Kt-Ht-ir,nr>-1e-4&&nr<1e-4}var b=function(){return function(bt,kt,Dt,At){var Bt=getDefaultCurveSegments(),Tt,It,St,jt,Ht,Kt=0,ir,nr=[],kr=[],br=bezierLengthPool.newElement();for(St=Dt.length,Tt=0;Tt<Bt;Tt+=1){for(Ht=Tt/(Bt-1),ir=0,It=0;It<St;It+=1)jt=bmPow(1-Ht,3)*bt[It]+3*bmPow(1-Ht,2)*Ht*Dt[It]+3*(1-Ht)*bmPow(Ht,2)*At[It]+bmPow(Ht,3)*kt[It],nr[It]=jt,kr[It]!==null&&(ir+=bmPow(nr[It]-kr[It],2)),kr[It]=nr[It];ir&&(ir=bmSqrt(ir),Kt+=ir),br.percents[Tt]=Ht,br.lengths[Tt]=Kt}return br.addedLength=Kt,br}}();function $(bt){var kt=segmentsLengthPool.newElement(),Dt=bt.c,At=bt.v,Bt=bt.o,Tt=bt.i,It,St=bt._length,jt=kt.lengths,Ht=0;for(It=0;It<St-1;It+=1)jt[It]=b(At[It],At[It+1],Bt[It],Tt[It+1]),Ht+=jt[It].addedLength;return Dt&&St&&(jt[It]=b(At[It],At[0],Bt[It],Tt[0]),Ht+=jt[It].addedLength),kt.totalLength=Ht,kt}function it(bt){this.segmentLength=0,this.points=new Array(bt)}function at(bt,kt){this.partialLength=bt,this.point=kt}var h=function(){var bt={};return function(kt,Dt,At,Bt){var Tt=(kt[0]+"_"+kt[1]+"_"+Dt[0]+"_"+Dt[1]+"_"+At[0]+"_"+At[1]+"_"+Bt[0]+"_"+Bt[1]).replace(/\./g,"p");if(!bt[Tt]){var It=getDefaultCurveSegments(),St,jt,Ht,Kt,ir,nr=0,kr,br,Sr=null;kt.length===2&&(kt[0]!==Dt[0]||kt[1]!==Dt[1])&&i(kt[0],kt[1],Dt[0],Dt[1],kt[0]+At[0],kt[1]+At[1])&&i(kt[0],kt[1],Dt[0],Dt[1],Dt[0]+Bt[0],Dt[1]+Bt[1])&&(It=2);var $r=new it(It);for(Ht=At.length,St=0;St<It;St+=1){for(br=createSizedArray(Ht),ir=St/(It-1),kr=0,jt=0;jt<Ht;jt+=1)Kt=bmPow(1-ir,3)*kt[jt]+3*bmPow(1-ir,2)*ir*(kt[jt]+At[jt])+3*(1-ir)*bmPow(ir,2)*(Dt[jt]+Bt[jt])+bmPow(ir,3)*Dt[jt],br[jt]=Kt,Sr!==null&&(kr+=bmPow(br[jt]-Sr[jt],2));kr=bmSqrt(kr),nr+=kr,$r.points[St]=new at(kr,br),Sr=br}$r.segmentLength=nr,bt[Tt]=$r}return bt[Tt]}}();function dt(bt,kt){var Dt=kt.percents,At=kt.lengths,Bt=Dt.length,Tt=bmFloor((Bt-1)*bt),It=bt*kt.addedLength,St=0;if(Tt===Bt-1||Tt===0||It===At[Tt])return Dt[Tt];for(var jt=At[Tt]>It?-1:1,Ht=!0;Ht;)if(At[Tt]<=It&&At[Tt+1]>It?(St=(It-At[Tt])/(At[Tt+1]-At[Tt]),Ht=!1):Tt+=jt,Tt<0||Tt>=Bt-1){if(Tt===Bt-1)return Dt[Tt];Ht=!1}return Dt[Tt]+(Dt[Tt+1]-Dt[Tt])*St}function ft(bt,kt,Dt,At,Bt,Tt){var It=dt(Bt,Tt),St=1-It,jt=e.round((St*St*St*bt[0]+(It*St*St+St*It*St+St*St*It)*Dt[0]+(It*It*St+St*It*It+It*St*It)*At[0]+It*It*It*kt[0])*1e3)/1e3,Ht=e.round((St*St*St*bt[1]+(It*St*St+St*It*St+St*St*It)*Dt[1]+(It*It*St+St*It*It+It*St*It)*At[1]+It*It*It*kt[1])*1e3)/1e3;return[jt,Ht]}var xt=createTypedArray("float32",8);function Ct(bt,kt,Dt,At,Bt,Tt,It){Bt<0?Bt=0:Bt>1&&(Bt=1);var St=dt(Bt,It);Tt=Tt>1?1:Tt;var jt=dt(Tt,It),Ht,Kt=bt.length,ir=1-St,nr=1-jt,kr=ir*ir*ir,br=St*ir*ir*3,Sr=St*St*ir*3,$r=St*St*St,rn=ir*ir*nr,Zr=St*ir*nr+ir*St*nr+ir*ir*jt,Kr=St*St*nr+ir*St*jt+St*ir*jt,Xt=St*St*jt,mr=ir*nr*nr,Ut=St*nr*nr+ir*jt*nr+ir*nr*jt,Jt=St*jt*nr+ir*jt*jt+St*nr*jt,Or=St*jt*jt,Cr=nr*nr*nr,pn=jt*nr*nr+nr*jt*nr+nr*nr*jt,On=jt*jt*nr+nr*jt*jt+jt*nr*jt,Zn=jt*jt*jt;for(Ht=0;Ht<Kt;Ht+=1)xt[Ht*4]=e.round((kr*bt[Ht]+br*Dt[Ht]+Sr*At[Ht]+$r*kt[Ht])*1e3)/1e3,xt[Ht*4+1]=e.round((rn*bt[Ht]+Zr*Dt[Ht]+Kr*At[Ht]+Xt*kt[Ht])*1e3)/1e3,xt[Ht*4+2]=e.round((mr*bt[Ht]+Ut*Dt[Ht]+Jt*At[Ht]+Or*kt[Ht])*1e3)/1e3,xt[Ht*4+3]=e.round((Cr*bt[Ht]+pn*Dt[Ht]+On*At[Ht]+Zn*kt[Ht])*1e3)/1e3;return xt}return{getSegmentsLength:$,getNewSegment:Ct,getPointInSegment:ft,buildBezierData:h,pointOnLine2D:i,pointOnLine3D:c}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(e,i){var c=this.offsetTime,b;this.propType==="multidimensional"&&(b=createTypedArray("float32",this.pv.length));for(var $=i.lastIndex,it=$,at=this.keyframes.length-1,h=!0,dt,ft,xt;h;){if(dt=this.keyframes[it],ft=this.keyframes[it+1],it===at-1&&e>=ft.t-c){dt.h&&(dt=ft),$=0;break}if(ft.t-c>e){$=it;break}it<at-1?it+=1:($=0,h=!1)}xt=this.keyframesMetadata[it]||{};var Ct,bt,kt,Dt,At,Bt,Tt=ft.t-c,It=dt.t-c,St;if(dt.to){xt.bezierData||(xt.bezierData=bez.buildBezierData(dt.s,ft.s||dt.e,dt.to,dt.ti));var jt=xt.bezierData;if(e>=Tt||e<It){var Ht=e>=Tt?jt.points.length-1:0;for(bt=jt.points[Ht].point.length,Ct=0;Ct<bt;Ct+=1)b[Ct]=jt.points[Ht].point[Ct]}else{xt.__fnct?Bt=xt.__fnct:(Bt=BezierFactory.getBezierEasing(dt.o.x,dt.o.y,dt.i.x,dt.i.y,dt.n).get,xt.__fnct=Bt),kt=Bt((e-It)/(Tt-It));var Kt=jt.segmentLength*kt,ir,nr=i.lastFrame<e&&i._lastKeyframeIndex===it?i._lastAddedLength:0;for(At=i.lastFrame<e&&i._lastKeyframeIndex===it?i._lastPoint:0,h=!0,Dt=jt.points.length;h;){if(nr+=jt.points[At].partialLength,Kt===0||kt===0||At===jt.points.length-1){for(bt=jt.points[At].point.length,Ct=0;Ct<bt;Ct+=1)b[Ct]=jt.points[At].point[Ct];break}else if(Kt>=nr&&Kt<nr+jt.points[At+1].partialLength){for(ir=(Kt-nr)/jt.points[At+1].partialLength,bt=jt.points[At].point.length,Ct=0;Ct<bt;Ct+=1)b[Ct]=jt.points[At].point[Ct]+(jt.points[At+1].point[Ct]-jt.points[At].point[Ct])*ir;break}At<Dt-1?At+=1:h=!1}i._lastPoint=At,i._lastAddedLength=nr-jt.points[At].partialLength,i._lastKeyframeIndex=it}}else{var kr,br,Sr,$r,rn;if(at=dt.s.length,St=ft.s||dt.e,this.sh&&dt.h!==1)if(e>=Tt)b[0]=St[0],b[1]=St[1],b[2]=St[2];else if(e<=It)b[0]=dt.s[0],b[1]=dt.s[1],b[2]=dt.s[2];else{var Zr=createQuaternion(dt.s),Kr=createQuaternion(St),Xt=(e-It)/(Tt-It);quaternionToEuler(b,slerp(Zr,Kr,Xt))}else for(it=0;it<at;it+=1)dt.h!==1&&(e>=Tt?kt=1:e<It?kt=0:(dt.o.x.constructor===Array?(xt.__fnct||(xt.__fnct=[]),xt.__fnct[it]?Bt=xt.__fnct[it]:(kr=dt.o.x[it]===void 0?dt.o.x[0]:dt.o.x[it],br=dt.o.y[it]===void 0?dt.o.y[0]:dt.o.y[it],Sr=dt.i.x[it]===void 0?dt.i.x[0]:dt.i.x[it],$r=dt.i.y[it]===void 0?dt.i.y[0]:dt.i.y[it],Bt=BezierFactory.getBezierEasing(kr,br,Sr,$r).get,xt.__fnct[it]=Bt)):xt.__fnct?Bt=xt.__fnct:(kr=dt.o.x,br=dt.o.y,Sr=dt.i.x,$r=dt.i.y,Bt=BezierFactory.getBezierEasing(kr,br,Sr,$r).get,dt.keyframeMetadata=Bt),kt=Bt((e-It)/(Tt-It)))),St=ft.s||dt.e,rn=dt.h===1?dt.s[it]:dt.s[it]+(St[it]-dt.s[it])*kt,this.propType==="multidimensional"?b[it]=rn:b=rn}return i.lastIndex=$,b}function slerp(e,i,c){var b=[],$=e[0],it=e[1],at=e[2],h=e[3],dt=i[0],ft=i[1],xt=i[2],Ct=i[3],bt,kt,Dt,At,Bt;return kt=$*dt+it*ft+at*xt+h*Ct,kt<0&&(kt=-kt,dt=-dt,ft=-ft,xt=-xt,Ct=-Ct),1-kt>1e-6?(bt=Math.acos(kt),Dt=Math.sin(bt),At=Math.sin((1-c)*bt)/Dt,Bt=Math.sin(c*bt)/Dt):(At=1-c,Bt=c),b[0]=At*$+Bt*dt,b[1]=At*it+Bt*ft,b[2]=At*at+Bt*xt,b[3]=At*h+Bt*Ct,b}function quaternionToEuler(e,i){var c=i[0],b=i[1],$=i[2],it=i[3],at=Math.atan2(2*b*it-2*c*$,1-2*b*b-2*$*$),h=Math.asin(2*c*b+2*$*it),dt=Math.atan2(2*c*it-2*b*$,1-2*c*c-2*$*$);e[0]=at/degToRads,e[1]=h/degToRads,e[2]=dt/degToRads}function createQuaternion(e){var i=e[0]*degToRads,c=e[1]*degToRads,b=e[2]*degToRads,$=Math.cos(i/2),it=Math.cos(c/2),at=Math.cos(b/2),h=Math.sin(i/2),dt=Math.sin(c/2),ft=Math.sin(b/2),xt=$*it*at-h*dt*ft,Ct=h*dt*at+$*it*ft,bt=h*it*at+$*dt*ft,kt=$*dt*at-h*it*ft;return[Ct,bt,kt,xt]}function getValueAtCurrentTime(){var e=this.comp.renderedFrame-this.offsetTime,i=this.keyframes[0].t-this.offsetTime,c=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(e===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=c&&e>=c||this._caching.lastFrame<i&&e<i))){this._caching.lastFrame>=e&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var b=this.interpolateValue(e,this._caching);this.pv=b}return this._caching.lastFrame=e,this.pv}function setVValue(e){var i;if(this.propType==="unidimensional")i=e*this.mult,mathAbs(this.v-i)>1e-5&&(this.v=i,this._mdf=!0);else for(var c=0,b=this.v.length;c<b;)i=e[c]*this.mult,mathAbs(this.v[c]-i)>1e-5&&(this.v[c]=i,this._mdf=!0),c+=1}function processEffectsSequence(){if(!(this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)){if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=this._isFirstFrame;var e,i=this.effectsSequence.length,c=this.kf?this.pv:this.data.k;for(e=0;e<i;e+=1)c=this.effectsSequence[e](c);this.setVValue(c),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function ValueProperty(e,i,c,b){this.propType="unidimensional",this.mult=c||1,this.data=i,this.v=c?i.k*c:i.k,this.pv=i.k,this._mdf=!1,this.elem=e,this.container=b,this.comp=e.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(e,i,c,b){this.propType="multidimensional",this.mult=c||1,this.data=i,this._mdf=!1,this.elem=e,this.container=b,this.comp=e.comp,this.k=!1,this.kf=!1,this.frameId=-1;var $,it=i.k.length;for(this.v=createTypedArray("float32",it),this.pv=createTypedArray("float32",it),this.vel=createTypedArray("float32",it),$=0;$<it;$+=1)this.v[$]=i.k[$]*this.mult,this.pv[$]=i.k[$];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(e,i,c,b){this.propType="unidimensional",this.keyframes=i.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=i,this.mult=c||1,this.elem=e,this.container=b,this.comp=e.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(e,i,c,b){this.propType="multidimensional";var $,it=i.k.length,at,h,dt,ft;for($=0;$<it-1;$+=1)i.k[$].to&&i.k[$].s&&i.k[$+1]&&i.k[$+1].s&&(at=i.k[$].s,h=i.k[$+1].s,dt=i.k[$].to,ft=i.k[$].ti,(at.length===2&&!(at[0]===h[0]&&at[1]===h[1])&&bez.pointOnLine2D(at[0],at[1],h[0],h[1],at[0]+dt[0],at[1]+dt[1])&&bez.pointOnLine2D(at[0],at[1],h[0],h[1],h[0]+ft[0],h[1]+ft[1])||at.length===3&&!(at[0]===h[0]&&at[1]===h[1]&&at[2]===h[2])&&bez.pointOnLine3D(at[0],at[1],at[2],h[0],h[1],h[2],at[0]+dt[0],at[1]+dt[1],at[2]+dt[2])&&bez.pointOnLine3D(at[0],at[1],at[2],h[0],h[1],h[2],h[0]+ft[0],h[1]+ft[1],h[2]+ft[2]))&&(i.k[$].to=null,i.k[$].ti=null),at[0]===h[0]&&at[1]===h[1]&&dt[0]===0&&dt[1]===0&&ft[0]===0&&ft[1]===0&&(at.length===2||at[2]===h[2]&&dt[2]===0&&ft[2]===0)&&(i.k[$].to=null,i.k[$].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=i,this.keyframes=i.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=c||1,this.elem=e,this.container=b,this.comp=e.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var xt=i.k[0].s.length;for(this.v=createTypedArray("float32",xt),this.pv=createTypedArray("float32",xt),$=0;$<xt;$+=1)this.v[$]=initFrame,this.pv[$]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",xt)},this.addEffect=addEffect}var PropertyFactory=function(){function e(c,b,$,it,at){b.sid&&(b=c.globalData.slotManager.getProp(b));var h;if(!b.k.length)h=new ValueProperty(c,b,it,at);else if(typeof b.k[0]=="number")h=new MultiDimensionalProperty(c,b,it,at);else switch($){case 0:h=new KeyframedValueProperty(c,b,it,at);break;case 1:h=new KeyframedMultidimensionalProperty(c,b,it,at);break}return h.effectsSequence.length&&at.addDynamicProperty(h),h}var i={getProp:e};return i}();function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(i){this.dynamicProperties.indexOf(i)===-1&&(this.dynamicProperties.push(i),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var i,c=this.dynamicProperties.length;for(i=0;i<c;i+=1)this.dynamicProperties[i].getValue(),this.dynamicProperties[i]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(i){this.container=i,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=function(){function e(){return createTypedArray("float32",2)}return poolFactory(8,e)}();function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(e,i){this.c=e,this.setLength(i);for(var c=0;c<i;)this.v[c]=pointPool.newElement(),this.o[c]=pointPool.newElement(),this.i[c]=pointPool.newElement(),c+=1},ShapePath.prototype.setLength=function(e){for(;this._maxLength<e;)this.doubleArrayLength();this._length=e},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(e,i,c,b,$){var it;switch(this._length=Math.max(this._length,b+1),this._length>=this._maxLength&&this.doubleArrayLength(),c){case"v":it=this.v;break;case"i":it=this.i;break;case"o":it=this.o;break;default:it=[];break}(!it[b]||it[b]&&!$)&&(it[b]=pointPool.newElement()),it[b][0]=e,it[b][1]=i},ShapePath.prototype.setTripleAt=function(e,i,c,b,$,it,at,h){this.setXYAt(e,i,"v",at,h),this.setXYAt(c,b,"o",at,h),this.setXYAt($,it,"i",at,h)},ShapePath.prototype.reverse=function(){var e=new ShapePath;e.setPathData(this.c,this._length);var i=this.v,c=this.o,b=this.i,$=0;this.c&&(e.setTripleAt(i[0][0],i[0][1],b[0][0],b[0][1],c[0][0],c[0][1],0,!1),$=1);var it=this._length-1,at=this._length,h;for(h=$;h<at;h+=1)e.setTripleAt(i[it][0],i[it][1],b[it][0],b[it][1],c[it][0],c[it][1],h,!1),it-=1;return e},ShapePath.prototype.length=function(){return this._length};var shapePool=function(){function e(){return new ShapePath}function i($){var it=$._length,at;for(at=0;at<it;at+=1)pointPool.release($.v[at]),pointPool.release($.i[at]),pointPool.release($.o[at]),$.v[at]=null,$.i[at]=null,$.o[at]=null;$._length=0,$.c=!1}function c($){var it=b.newElement(),at,h=$._length===void 0?$.v.length:$._length;for(it.setLength(h),it.c=$.c,at=0;at<h;at+=1)it.setTripleAt($.v[at][0],$.v[at][1],$.o[at][0],$.o[at][1],$.i[at][0],$.i[at][1],at);return it}var b=poolFactory(4,e,i);return b.clone=c,b}();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(e){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=e,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var e;for(e=0;e<this._length;e+=1)shapePool.release(this.shapes[e]);this._length=0};var shapeCollectionPool=function(){var e={newShapeCollection:$,release:it},i=0,c=4,b=createSizedArray(c);function $(){var at;return i?(i-=1,at=b[i]):at=new ShapeCollection,at}function it(at){var h,dt=at._length;for(h=0;h<dt;h+=1)shapePool.release(at.shapes[h]);at._length=0,i===c&&(b=pooling.double(b),c*=2),b[i]=at,i+=1}return e}(),ShapePropertyFactory=function(){var e=-999999;function i(Tt,It,St){var jt=St.lastIndex,Ht,Kt,ir,nr,kr,br,Sr,$r,rn,Zr=this.keyframes;if(Tt<Zr[0].t-this.offsetTime)Ht=Zr[0].s[0],ir=!0,jt=0;else if(Tt>=Zr[Zr.length-1].t-this.offsetTime)Ht=Zr[Zr.length-1].s?Zr[Zr.length-1].s[0]:Zr[Zr.length-2].e[0],ir=!0;else{for(var Kr=jt,Xt=Zr.length-1,mr=!0,Ut,Jt,Or;mr&&(Ut=Zr[Kr],Jt=Zr[Kr+1],!(Jt.t-this.offsetTime>Tt));)Kr<Xt-1?Kr+=1:mr=!1;if(Or=this.keyframesMetadata[Kr]||{},ir=Ut.h===1,jt=Kr,!ir){if(Tt>=Jt.t-this.offsetTime)$r=1;else if(Tt<Ut.t-this.offsetTime)$r=0;else{var Cr;Or.__fnct?Cr=Or.__fnct:(Cr=BezierFactory.getBezierEasing(Ut.o.x,Ut.o.y,Ut.i.x,Ut.i.y).get,Or.__fnct=Cr),$r=Cr((Tt-(Ut.t-this.offsetTime))/(Jt.t-this.offsetTime-(Ut.t-this.offsetTime)))}Kt=Jt.s?Jt.s[0]:Ut.e[0]}Ht=Ut.s[0]}for(br=It._length,Sr=Ht.i[0].length,St.lastIndex=jt,nr=0;nr<br;nr+=1)for(kr=0;kr<Sr;kr+=1)rn=ir?Ht.i[nr][kr]:Ht.i[nr][kr]+(Kt.i[nr][kr]-Ht.i[nr][kr])*$r,It.i[nr][kr]=rn,rn=ir?Ht.o[nr][kr]:Ht.o[nr][kr]+(Kt.o[nr][kr]-Ht.o[nr][kr])*$r,It.o[nr][kr]=rn,rn=ir?Ht.v[nr][kr]:Ht.v[nr][kr]+(Kt.v[nr][kr]-Ht.v[nr][kr])*$r,It.v[nr][kr]=rn}function c(){var Tt=this.comp.renderedFrame-this.offsetTime,It=this.keyframes[0].t-this.offsetTime,St=this.keyframes[this.keyframes.length-1].t-this.offsetTime,jt=this._caching.lastFrame;return jt!==e&&(jt<It&&Tt<It||jt>St&&Tt>St)||(this._caching.lastIndex=jt<Tt?this._caching.lastIndex:0,this.interpolateShape(Tt,this.pv,this._caching)),this._caching.lastFrame=Tt,this.pv}function b(){this.paths=this.localShapeCollection}function $(Tt,It){if(Tt._length!==It._length||Tt.c!==It.c)return!1;var St,jt=Tt._length;for(St=0;St<jt;St+=1)if(Tt.v[St][0]!==It.v[St][0]||Tt.v[St][1]!==It.v[St][1]||Tt.o[St][0]!==It.o[St][0]||Tt.o[St][1]!==It.o[St][1]||Tt.i[St][0]!==It.i[St][0]||Tt.i[St][1]!==It.i[St][1])return!1;return!0}function it(Tt){$(this.v,Tt)||(this.v=shapePool.clone(Tt),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function at(){if(this.elem.globalData.frameId!==this.frameId){if(!this.effectsSequence.length){this._mdf=!1;return}if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=!1;var Tt;this.kf?Tt=this.pv:this.data.ks?Tt=this.data.ks.k:Tt=this.data.pt.k;var It,St=this.effectsSequence.length;for(It=0;It<St;It+=1)Tt=this.effectsSequence[It](Tt);this.setVValue(Tt),this.lock=!1,this.frameId=this.elem.globalData.frameId}}function h(Tt,It,St){this.propType="shape",this.comp=Tt.comp,this.container=Tt,this.elem=Tt,this.data=It,this.k=!1,this.kf=!1,this._mdf=!1;var jt=St===3?It.pt.k:It.ks.k;this.v=shapePool.clone(jt),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=b,this.effectsSequence=[]}function dt(Tt){this.effectsSequence.push(Tt),this.container.addDynamicProperty(this)}h.prototype.interpolateShape=i,h.prototype.getValue=at,h.prototype.setVValue=it,h.prototype.addEffect=dt;function ft(Tt,It,St){this.propType="shape",this.comp=Tt.comp,this.elem=Tt,this.container=Tt,this.offsetTime=Tt.data.st,this.keyframes=St===3?It.pt.k:It.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var jt=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,jt),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=e,this.reset=b,this._caching={lastFrame:e,lastIndex:0},this.effectsSequence=[c.bind(this)]}ft.prototype.getValue=at,ft.prototype.interpolateShape=i,ft.prototype.setVValue=it,ft.prototype.addEffect=dt;var xt=function(){var Tt=roundCorner;function It(St,jt){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=jt.d,this.elem=St,this.comp=St.comp,this.frameId=-1,this.initDynamicPropertyContainer(St),this.p=PropertyFactory.getProp(St,jt.p,1,0,this),this.s=PropertyFactory.getProp(St,jt.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return It.prototype={reset:b,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var jt=this.p.v[0],Ht=this.p.v[1],Kt=this.s.v[0]/2,ir=this.s.v[1]/2,nr=this.d!==3,kr=this.v;kr.v[0][0]=jt,kr.v[0][1]=Ht-ir,kr.v[1][0]=nr?jt+Kt:jt-Kt,kr.v[1][1]=Ht,kr.v[2][0]=jt,kr.v[2][1]=Ht+ir,kr.v[3][0]=nr?jt-Kt:jt+Kt,kr.v[3][1]=Ht,kr.i[0][0]=nr?jt-Kt*Tt:jt+Kt*Tt,kr.i[0][1]=Ht-ir,kr.i[1][0]=nr?jt+Kt:jt-Kt,kr.i[1][1]=Ht-ir*Tt,kr.i[2][0]=nr?jt+Kt*Tt:jt-Kt*Tt,kr.i[2][1]=Ht+ir,kr.i[3][0]=nr?jt-Kt:jt+Kt,kr.i[3][1]=Ht+ir*Tt,kr.o[0][0]=nr?jt+Kt*Tt:jt-Kt*Tt,kr.o[0][1]=Ht-ir,kr.o[1][0]=nr?jt+Kt:jt-Kt,kr.o[1][1]=Ht+ir*Tt,kr.o[2][0]=nr?jt-Kt*Tt:jt+Kt*Tt,kr.o[2][1]=Ht+ir,kr.o[3][0]=nr?jt-Kt:jt+Kt,kr.o[3][1]=Ht-ir*Tt}},extendPrototype([DynamicPropertyContainer],It),It}(),Ct=function(){function Tt(It,St){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=It,this.comp=It.comp,this.data=St,this.frameId=-1,this.d=St.d,this.initDynamicPropertyContainer(It),St.sy===1?(this.ir=PropertyFactory.getProp(It,St.ir,0,0,this),this.is=PropertyFactory.getProp(It,St.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(It,St.pt,0,0,this),this.p=PropertyFactory.getProp(It,St.p,1,0,this),this.r=PropertyFactory.getProp(It,St.r,0,degToRads,this),this.or=PropertyFactory.getProp(It,St.or,0,0,this),this.os=PropertyFactory.getProp(It,St.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return Tt.prototype={reset:b,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var St=Math.floor(this.pt.v)*2,jt=Math.PI*2/St,Ht=!0,Kt=this.or.v,ir=this.ir.v,nr=this.os.v,kr=this.is.v,br=2*Math.PI*Kt/(St*2),Sr=2*Math.PI*ir/(St*2),$r,rn,Zr,Kr,Xt=-Math.PI/2;Xt+=this.r.v;var mr=this.data.d===3?-1:1;for(this.v._length=0,$r=0;$r<St;$r+=1){rn=Ht?Kt:ir,Zr=Ht?nr:kr,Kr=Ht?br:Sr;var Ut=rn*Math.cos(Xt),Jt=rn*Math.sin(Xt),Or=Ut===0&&Jt===0?0:Jt/Math.sqrt(Ut*Ut+Jt*Jt),Cr=Ut===0&&Jt===0?0:-Ut/Math.sqrt(Ut*Ut+Jt*Jt);Ut+=+this.p.v[0],Jt+=+this.p.v[1],this.v.setTripleAt(Ut,Jt,Ut-Or*Kr*Zr*mr,Jt-Cr*Kr*Zr*mr,Ut+Or*Kr*Zr*mr,Jt+Cr*Kr*Zr*mr,$r,!0),Ht=!Ht,Xt+=jt*mr}},convertPolygonToPath:function(){var St=Math.floor(this.pt.v),jt=Math.PI*2/St,Ht=this.or.v,Kt=this.os.v,ir=2*Math.PI*Ht/(St*4),nr,kr=-Math.PI*.5,br=this.data.d===3?-1:1;for(kr+=this.r.v,this.v._length=0,nr=0;nr<St;nr+=1){var Sr=Ht*Math.cos(kr),$r=Ht*Math.sin(kr),rn=Sr===0&&$r===0?0:$r/Math.sqrt(Sr*Sr+$r*$r),Zr=Sr===0&&$r===0?0:-Sr/Math.sqrt(Sr*Sr+$r*$r);Sr+=+this.p.v[0],$r+=+this.p.v[1],this.v.setTripleAt(Sr,$r,Sr-rn*ir*Kt*br,$r-Zr*ir*Kt*br,Sr+rn*ir*Kt*br,$r+Zr*ir*Kt*br,nr,!0),kr+=jt*br}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],Tt),Tt}(),bt=function(){function Tt(It,St){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=It,this.comp=It.comp,this.frameId=-1,this.d=St.d,this.initDynamicPropertyContainer(It),this.p=PropertyFactory.getProp(It,St.p,1,0,this),this.s=PropertyFactory.getProp(It,St.s,1,0,this),this.r=PropertyFactory.getProp(It,St.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return Tt.prototype={convertRectToPath:function(){var St=this.p.v[0],jt=this.p.v[1],Ht=this.s.v[0]/2,Kt=this.s.v[1]/2,ir=bmMin(Ht,Kt,this.r.v),nr=ir*(1-roundCorner);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(St+Ht,jt-Kt+ir,St+Ht,jt-Kt+ir,St+Ht,jt-Kt+nr,0,!0),this.v.setTripleAt(St+Ht,jt+Kt-ir,St+Ht,jt+Kt-nr,St+Ht,jt+Kt-ir,1,!0),ir!==0?(this.v.setTripleAt(St+Ht-ir,jt+Kt,St+Ht-ir,jt+Kt,St+Ht-nr,jt+Kt,2,!0),this.v.setTripleAt(St-Ht+ir,jt+Kt,St-Ht+nr,jt+Kt,St-Ht+ir,jt+Kt,3,!0),this.v.setTripleAt(St-Ht,jt+Kt-ir,St-Ht,jt+Kt-ir,St-Ht,jt+Kt-nr,4,!0),this.v.setTripleAt(St-Ht,jt-Kt+ir,St-Ht,jt-Kt+nr,St-Ht,jt-Kt+ir,5,!0),this.v.setTripleAt(St-Ht+ir,jt-Kt,St-Ht+ir,jt-Kt,St-Ht+nr,jt-Kt,6,!0),this.v.setTripleAt(St+Ht-ir,jt-Kt,St+Ht-nr,jt-Kt,St+Ht-ir,jt-Kt,7,!0)):(this.v.setTripleAt(St-Ht,jt+Kt,St-Ht+nr,jt+Kt,St-Ht,jt+Kt,2),this.v.setTripleAt(St-Ht,jt-Kt,St-Ht,jt-Kt+nr,St-Ht,jt-Kt,3))):(this.v.setTripleAt(St+Ht,jt-Kt+ir,St+Ht,jt-Kt+nr,St+Ht,jt-Kt+ir,0,!0),ir!==0?(this.v.setTripleAt(St+Ht-ir,jt-Kt,St+Ht-ir,jt-Kt,St+Ht-nr,jt-Kt,1,!0),this.v.setTripleAt(St-Ht+ir,jt-Kt,St-Ht+nr,jt-Kt,St-Ht+ir,jt-Kt,2,!0),this.v.setTripleAt(St-Ht,jt-Kt+ir,St-Ht,jt-Kt+ir,St-Ht,jt-Kt+nr,3,!0),this.v.setTripleAt(St-Ht,jt+Kt-ir,St-Ht,jt+Kt-nr,St-Ht,jt+Kt-ir,4,!0),this.v.setTripleAt(St-Ht+ir,jt+Kt,St-Ht+ir,jt+Kt,St-Ht+nr,jt+Kt,5,!0),this.v.setTripleAt(St+Ht-ir,jt+Kt,St+Ht-nr,jt+Kt,St+Ht-ir,jt+Kt,6,!0),this.v.setTripleAt(St+Ht,jt+Kt-ir,St+Ht,jt+Kt-ir,St+Ht,jt+Kt-nr,7,!0)):(this.v.setTripleAt(St-Ht,jt-Kt,St-Ht+nr,jt-Kt,St-Ht,jt-Kt,1,!0),this.v.setTripleAt(St-Ht,jt+Kt,St-Ht,jt+Kt-nr,St-Ht,jt+Kt,2,!0),this.v.setTripleAt(St+Ht,jt+Kt,St+Ht-nr,jt+Kt,St+Ht,jt+Kt,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:b},extendPrototype([DynamicPropertyContainer],Tt),Tt}();function kt(Tt,It,St){var jt;if(St===3||St===4){var Ht=St===3?It.pt:It.ks,Kt=Ht.k;Kt.length?jt=new ft(Tt,It,St):jt=new h(Tt,It,St)}else St===5?jt=new bt(Tt,It):St===6?jt=new xt(Tt,It):St===7&&(jt=new Ct(Tt,It));return jt.k&&Tt.addDynamicProperty(jt),jt}function Dt(){return h}function At(){return ft}var Bt={};return Bt.getShapeProp=kt,Bt.getConstructorFunction=Dt,Bt.getKeyframedConstructorFunction=At,Bt}();/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */var Matrix=function(){var e=Math.cos,i=Math.sin,c=Math.tan,b=Math.round;function $(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function it(Ut){if(Ut===0)return this;var Jt=e(Ut),Or=i(Ut);return this._t(Jt,-Or,0,0,Or,Jt,0,0,0,0,1,0,0,0,0,1)}function at(Ut){if(Ut===0)return this;var Jt=e(Ut),Or=i(Ut);return this._t(1,0,0,0,0,Jt,-Or,0,0,Or,Jt,0,0,0,0,1)}function h(Ut){if(Ut===0)return this;var Jt=e(Ut),Or=i(Ut);return this._t(Jt,0,Or,0,0,1,0,0,-Or,0,Jt,0,0,0,0,1)}function dt(Ut){if(Ut===0)return this;var Jt=e(Ut),Or=i(Ut);return this._t(Jt,-Or,0,0,Or,Jt,0,0,0,0,1,0,0,0,0,1)}function ft(Ut,Jt){return this._t(1,Jt,Ut,1,0,0)}function xt(Ut,Jt){return this.shear(c(Ut),c(Jt))}function Ct(Ut,Jt){var Or=e(Jt),Cr=i(Jt);return this._t(Or,Cr,0,0,-Cr,Or,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,c(Ut),1,0,0,0,0,1,0,0,0,0,1)._t(Or,-Cr,0,0,Cr,Or,0,0,0,0,1,0,0,0,0,1)}function bt(Ut,Jt,Or){return!Or&&Or!==0&&(Or=1),Ut===1&&Jt===1&&Or===1?this:this._t(Ut,0,0,0,0,Jt,0,0,0,0,Or,0,0,0,0,1)}function kt(Ut,Jt,Or,Cr,pn,On,Zn,As,ss,Ls,$s,vo,Vs,bo,Po,ws){return this.props[0]=Ut,this.props[1]=Jt,this.props[2]=Or,this.props[3]=Cr,this.props[4]=pn,this.props[5]=On,this.props[6]=Zn,this.props[7]=As,this.props[8]=ss,this.props[9]=Ls,this.props[10]=$s,this.props[11]=vo,this.props[12]=Vs,this.props[13]=bo,this.props[14]=Po,this.props[15]=ws,this}function Dt(Ut,Jt,Or){return Or=Or||0,Ut!==0||Jt!==0||Or!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,Ut,Jt,Or,1):this}function At(Ut,Jt,Or,Cr,pn,On,Zn,As,ss,Ls,$s,vo,Vs,bo,Po,ws){var Jn=this.props;if(Ut===1&&Jt===0&&Or===0&&Cr===0&&pn===0&&On===1&&Zn===0&&As===0&&ss===0&&Ls===0&&$s===1&&vo===0)return Jn[12]=Jn[12]*Ut+Jn[15]*Vs,Jn[13]=Jn[13]*On+Jn[15]*bo,Jn[14]=Jn[14]*$s+Jn[15]*Po,Jn[15]*=ws,this._identityCalculated=!1,this;var Hs=Jn[0],El=Jn[1],Xo=Jn[2],_l=Jn[3],Io=Jn[4],Pl=Jn[5],Uo=Jn[6],Fl=Jn[7],Vl=Jn[8],_a=Jn[9],Xl=Jn[10],Go=Jn[11],xl=Jn[12],$u=Jn[13],su=Jn[14],Mu=Jn[15];return Jn[0]=Hs*Ut+El*pn+Xo*ss+_l*Vs,Jn[1]=Hs*Jt+El*On+Xo*Ls+_l*bo,Jn[2]=Hs*Or+El*Zn+Xo*$s+_l*Po,Jn[3]=Hs*Cr+El*As+Xo*vo+_l*ws,Jn[4]=Io*Ut+Pl*pn+Uo*ss+Fl*Vs,Jn[5]=Io*Jt+Pl*On+Uo*Ls+Fl*bo,Jn[6]=Io*Or+Pl*Zn+Uo*$s+Fl*Po,Jn[7]=Io*Cr+Pl*As+Uo*vo+Fl*ws,Jn[8]=Vl*Ut+_a*pn+Xl*ss+Go*Vs,Jn[9]=Vl*Jt+_a*On+Xl*Ls+Go*bo,Jn[10]=Vl*Or+_a*Zn+Xl*$s+Go*Po,Jn[11]=Vl*Cr+_a*As+Xl*vo+Go*ws,Jn[12]=xl*Ut+$u*pn+su*ss+Mu*Vs,Jn[13]=xl*Jt+$u*On+su*Ls+Mu*bo,Jn[14]=xl*Or+$u*Zn+su*$s+Mu*Po,Jn[15]=xl*Cr+$u*As+su*vo+Mu*ws,this._identityCalculated=!1,this}function Bt(Ut){var Jt=Ut.props;return this.transform(Jt[0],Jt[1],Jt[2],Jt[3],Jt[4],Jt[5],Jt[6],Jt[7],Jt[8],Jt[9],Jt[10],Jt[11],Jt[12],Jt[13],Jt[14],Jt[15])}function Tt(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function It(Ut){for(var Jt=0;Jt<16;){if(Ut.props[Jt]!==this.props[Jt])return!1;Jt+=1}return!0}function St(Ut){var Jt;for(Jt=0;Jt<16;Jt+=1)Ut.props[Jt]=this.props[Jt];return Ut}function jt(Ut){var Jt;for(Jt=0;Jt<16;Jt+=1)this.props[Jt]=Ut[Jt]}function Ht(Ut,Jt,Or){return{x:Ut*this.props[0]+Jt*this.props[4]+Or*this.props[8]+this.props[12],y:Ut*this.props[1]+Jt*this.props[5]+Or*this.props[9]+this.props[13],z:Ut*this.props[2]+Jt*this.props[6]+Or*this.props[10]+this.props[14]}}function Kt(Ut,Jt,Or){return Ut*this.props[0]+Jt*this.props[4]+Or*this.props[8]+this.props[12]}function ir(Ut,Jt,Or){return Ut*this.props[1]+Jt*this.props[5]+Or*this.props[9]+this.props[13]}function nr(Ut,Jt,Or){return Ut*this.props[2]+Jt*this.props[6]+Or*this.props[10]+this.props[14]}function kr(){var Ut=this.props[0]*this.props[5]-this.props[1]*this.props[4],Jt=this.props[5]/Ut,Or=-this.props[1]/Ut,Cr=-this.props[4]/Ut,pn=this.props[0]/Ut,On=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/Ut,Zn=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/Ut,As=new Matrix;return As.props[0]=Jt,As.props[1]=Or,As.props[4]=Cr,As.props[5]=pn,As.props[12]=On,As.props[13]=Zn,As}function br(Ut){var Jt=this.getInverseMatrix();return Jt.applyToPointArray(Ut[0],Ut[1],Ut[2]||0)}function Sr(Ut){var Jt,Or=Ut.length,Cr=[];for(Jt=0;Jt<Or;Jt+=1)Cr[Jt]=br(Ut[Jt]);return Cr}function $r(Ut,Jt,Or){var Cr=createTypedArray("float32",6);if(this.isIdentity())Cr[0]=Ut[0],Cr[1]=Ut[1],Cr[2]=Jt[0],Cr[3]=Jt[1],Cr[4]=Or[0],Cr[5]=Or[1];else{var pn=this.props[0],On=this.props[1],Zn=this.props[4],As=this.props[5],ss=this.props[12],Ls=this.props[13];Cr[0]=Ut[0]*pn+Ut[1]*Zn+ss,Cr[1]=Ut[0]*On+Ut[1]*As+Ls,Cr[2]=Jt[0]*pn+Jt[1]*Zn+ss,Cr[3]=Jt[0]*On+Jt[1]*As+Ls,Cr[4]=Or[0]*pn+Or[1]*Zn+ss,Cr[5]=Or[0]*On+Or[1]*As+Ls}return Cr}function rn(Ut,Jt,Or){var Cr;return this.isIdentity()?Cr=[Ut,Jt,Or]:Cr=[Ut*this.props[0]+Jt*this.props[4]+Or*this.props[8]+this.props[12],Ut*this.props[1]+Jt*this.props[5]+Or*this.props[9]+this.props[13],Ut*this.props[2]+Jt*this.props[6]+Or*this.props[10]+this.props[14]],Cr}function Zr(Ut,Jt){if(this.isIdentity())return Ut+","+Jt;var Or=this.props;return Math.round((Ut*Or[0]+Jt*Or[4]+Or[12])*100)/100+","+Math.round((Ut*Or[1]+Jt*Or[5]+Or[13])*100)/100}function Kr(){for(var Ut=0,Jt=this.props,Or="matrix3d(",Cr=1e4;Ut<16;)Or+=b(Jt[Ut]*Cr)/Cr,Or+=Ut===15?")":",",Ut+=1;return Or}function Xt(Ut){var Jt=1e4;return Ut<1e-6&&Ut>0||Ut>-1e-6&&Ut<0?b(Ut*Jt)/Jt:Ut}function mr(){var Ut=this.props,Jt=Xt(Ut[0]),Or=Xt(Ut[1]),Cr=Xt(Ut[4]),pn=Xt(Ut[5]),On=Xt(Ut[12]),Zn=Xt(Ut[13]);return"matrix("+Jt+","+Or+","+Cr+","+pn+","+On+","+Zn+")"}return function(){this.reset=$,this.rotate=it,this.rotateX=at,this.rotateY=h,this.rotateZ=dt,this.skew=xt,this.skewFromAxis=Ct,this.shear=ft,this.scale=bt,this.setTransform=kt,this.translate=Dt,this.transform=At,this.multiply=Bt,this.applyToPoint=Ht,this.applyToX=Kt,this.applyToY=ir,this.applyToZ=nr,this.applyToPointArray=rn,this.applyToTriplePoints=$r,this.applyToPointStringified=Zr,this.toCSS=Kr,this.to2dCSS=mr,this.clone=St,this.cloneFromProps=jt,this.equals=It,this.inversePoints=Sr,this.inversePoint=br,this.getInverseMatrix=kr,this._t=this.transform,this.isIdentity=Tt,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(e){"@babel/helpers - typeof";return _typeof$3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$3(e)}var lottie={};function setLocation(e){setLocationHref(e)}function searchAnimations(){animationManager.searchAnimations()}function setSubframeRendering(e){setSubframeEnabled(e)}function setPrefix(e){setIdPrefix(e)}function loadAnimation(e){return animationManager.loadAnimation(e)}function setQuality(e){if(typeof e=="string")switch(e){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10);break}else!isNaN(e)&&e>1&&setDefaultCurveSegments(e)}function inBrowser(){return typeof navigator<"u"}function installPlugin(e,i){e==="expressions"&&setExpressionsPlugin(i)}function getFactory(e){switch(e){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.13.0";function checkReady(){document.readyState==="complete"&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(e){for(var i=queryString.split("&"),c=0;c<i.length;c+=1){var b=i[c].split("=");if(decodeURIComponent(b[0])==e)return decodeURIComponent(b[1])}return null}var queryString="";{var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{_typeof$3(exports)!=="object"&&(window.bodymovin=lottie)}catch(e){}var ShapeModifiers=function(){var e={},i={};e.registerModifier=c,e.getModifier=b;function c($,it){i[$]||(i[$]=it)}function b($,it,at){return new i[$](it,at)}return e}();function ShapeModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(e){if(!this.closed){e.sh.container.addDynamicProperty(e.sh);var i={shape:e.sh,data:e,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(i),this.addShapeToModifier(i),this._isAnimated&&e.setAsAnimated()}},ShapeModifier.prototype.init=function(e,i){this.shapes=[],this.elem=e,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,i),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier);function TrimModifier(){}extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(e,i){this.s=PropertyFactory.getProp(e,i.s,0,.01,this),this.e=PropertyFactory.getProp(e,i.e,0,.01,this),this.o=PropertyFactory.getProp(e,i.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=i.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(e){e.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(e,i,c,b,$){var it=[];i<=1?it.push({s:e,e:i}):e>=1?it.push({s:e-1,e:i-1}):(it.push({s:e,e:1}),it.push({s:0,e:i-1}));var at=[],h,dt=it.length,ft;for(h=0;h<dt;h+=1)if(ft=it[h],!(ft.e*$<b||ft.s*$>b+c)){var xt,Ct;ft.s*$<=b?xt=0:xt=(ft.s*$-b)/c,ft.e*$>=b+c?Ct=1:Ct=(ft.e*$-b)/c,at.push([xt,Ct])}return at.length||at.push([0,0]),at},TrimModifier.prototype.releasePathsData=function(e){var i,c=e.length;for(i=0;i<c;i+=1)segmentsLengthPool.release(e[i]);return e.length=0,e},TrimModifier.prototype.processShapes=function(e){var i,c;if(this._mdf||e){var b=this.o.v%360/360;if(b<0&&(b+=1),this.s.v>1?i=1+b:this.s.v<0?i=0+b:i=this.s.v+b,this.e.v>1?c=1+b:this.e.v<0?c=0+b:c=this.e.v+b,i>c){var $=i;i=c,c=$}i=Math.round(i*1e4)*1e-4,c=Math.round(c*1e4)*1e-4,this.sValue=i,this.eValue=c}else i=this.sValue,c=this.eValue;var it,at,h=this.shapes.length,dt,ft,xt,Ct,bt,kt=0;if(c===i)for(at=0;at<h;at+=1)this.shapes[at].localShapeCollection.releaseShapes(),this.shapes[at].shape._mdf=!0,this.shapes[at].shape.paths=this.shapes[at].localShapeCollection,this._mdf&&(this.shapes[at].pathsData.length=0);else if(c===1&&i===0||c===0&&i===1){if(this._mdf)for(at=0;at<h;at+=1)this.shapes[at].pathsData.length=0,this.shapes[at].shape._mdf=!0}else{var Dt=[],At,Bt;for(at=0;at<h;at+=1)if(At=this.shapes[at],!At.shape._mdf&&!this._mdf&&!e&&this.m!==2)At.shape.paths=At.localShapeCollection;else{if(it=At.shape.paths,ft=it._length,bt=0,!At.shape._mdf&&At.pathsData.length)bt=At.totalShapeLength;else{for(xt=this.releasePathsData(At.pathsData),dt=0;dt<ft;dt+=1)Ct=bez.getSegmentsLength(it.shapes[dt]),xt.push(Ct),bt+=Ct.totalLength;At.totalShapeLength=bt,At.pathsData=xt}kt+=bt,At.shape._mdf=!0}var Tt=i,It=c,St=0,jt;for(at=h-1;at>=0;at-=1)if(At=this.shapes[at],At.shape._mdf){for(Bt=At.localShapeCollection,Bt.releaseShapes(),this.m===2&&h>1?(jt=this.calculateShapeEdges(i,c,At.totalShapeLength,St,kt),St+=At.totalShapeLength):jt=[[Tt,It]],ft=jt.length,dt=0;dt<ft;dt+=1){Tt=jt[dt][0],It=jt[dt][1],Dt.length=0,It<=1?Dt.push({s:At.totalShapeLength*Tt,e:At.totalShapeLength*It}):Tt>=1?Dt.push({s:At.totalShapeLength*(Tt-1),e:At.totalShapeLength*(It-1)}):(Dt.push({s:At.totalShapeLength*Tt,e:At.totalShapeLength}),Dt.push({s:0,e:At.totalShapeLength*(It-1)}));var Ht=this.addShapes(At,Dt[0]);if(Dt[0].s!==Dt[0].e){if(Dt.length>1){var Kt=At.shape.paths.shapes[At.shape.paths._length-1];if(Kt.c){var ir=Ht.pop();this.addPaths(Ht,Bt),Ht=this.addShapes(At,Dt[1],ir)}else this.addPaths(Ht,Bt),Ht=this.addShapes(At,Dt[1])}this.addPaths(Ht,Bt)}}At.shape.paths=Bt}}},TrimModifier.prototype.addPaths=function(e,i){var c,b=e.length;for(c=0;c<b;c+=1)i.addShape(e[c])},TrimModifier.prototype.addSegment=function(e,i,c,b,$,it,at){$.setXYAt(i[0],i[1],"o",it),$.setXYAt(c[0],c[1],"i",it+1),at&&$.setXYAt(e[0],e[1],"v",it),$.setXYAt(b[0],b[1],"v",it+1)},TrimModifier.prototype.addSegmentFromArray=function(e,i,c,b){i.setXYAt(e[1],e[5],"o",c),i.setXYAt(e[2],e[6],"i",c+1),b&&i.setXYAt(e[0],e[4],"v",c),i.setXYAt(e[3],e[7],"v",c+1)},TrimModifier.prototype.addShapes=function(e,i,c){var b=e.pathsData,$=e.shape.paths.shapes,it,at=e.shape.paths._length,h,dt,ft=0,xt,Ct,bt,kt,Dt=[],At,Bt=!0;for(c?(Ct=c._length,At=c._length):(c=shapePool.newElement(),Ct=0,At=0),Dt.push(c),it=0;it<at;it+=1){for(bt=b[it].lengths,c.c=$[it].c,dt=$[it].c?bt.length:bt.length+1,h=1;h<dt;h+=1)if(xt=bt[h-1],ft+xt.addedLength<i.s)ft+=xt.addedLength,c.c=!1;else if(ft>i.e){c.c=!1;break}else i.s<=ft&&i.e>=ft+xt.addedLength?(this.addSegment($[it].v[h-1],$[it].o[h-1],$[it].i[h],$[it].v[h],c,Ct,Bt),Bt=!1):(kt=bez.getNewSegment($[it].v[h-1],$[it].v[h],$[it].o[h-1],$[it].i[h],(i.s-ft)/xt.addedLength,(i.e-ft)/xt.addedLength,bt[h-1]),this.addSegmentFromArray(kt,c,Ct,Bt),Bt=!1,c.c=!1),ft+=xt.addedLength,Ct+=1;if($[it].c&&bt.length){if(xt=bt[h-1],ft<=i.e){var Tt=bt[h-1].addedLength;i.s<=ft&&i.e>=ft+Tt?(this.addSegment($[it].v[h-1],$[it].o[h-1],$[it].i[0],$[it].v[0],c,Ct,Bt),Bt=!1):(kt=bez.getNewSegment($[it].v[h-1],$[it].v[0],$[it].o[h-1],$[it].i[0],(i.s-ft)/Tt,(i.e-ft)/Tt,bt[h-1]),this.addSegmentFromArray(kt,c,Ct,Bt),Bt=!1,c.c=!1)}else c.c=!1;ft+=xt.addedLength,Ct+=1}if(c._length&&(c.setXYAt(c.v[At][0],c.v[At][1],"i",At),c.setXYAt(c.v[c._length-1][0],c.v[c._length-1][1],"o",c._length-1)),ft>i.e)break;it<at-1&&(c=shapePool.newElement(),Bt=!0,Dt.push(c),Ct=0)}return Dt};function PuckerAndBloatModifier(){}extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,i.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(e,i){var c=i/100,b=[0,0],$=e._length,it=0;for(it=0;it<$;it+=1)b[0]+=e.v[it][0],b[1]+=e.v[it][1];b[0]/=$,b[1]/=$;var at=shapePool.newElement();at.c=e.c;var h,dt,ft,xt,Ct,bt;for(it=0;it<$;it+=1)h=e.v[it][0]+(b[0]-e.v[it][0])*c,dt=e.v[it][1]+(b[1]-e.v[it][1])*c,ft=e.o[it][0]+(b[0]-e.o[it][0])*-c,xt=e.o[it][1]+(b[1]-e.o[it][1])*-c,Ct=e.i[it][0]+(b[0]-e.i[it][0])*-c,bt=e.i[it][1]+(b[1]-e.i[it][1])*-c,at.setTripleAt(h,dt,ft,xt,Ct,bt,it);return at},PuckerAndBloatModifier.prototype.processShapes=function(e){var i,c,b=this.shapes.length,$,it,at=this.amount.v;if(at!==0){var h,dt;for(c=0;c<b;c+=1){if(h=this.shapes[c],dt=h.localShapeCollection,!(!h.shape._mdf&&!this._mdf&&!e))for(dt.releaseShapes(),h.shape._mdf=!0,i=h.shape.paths.shapes,it=h.shape.paths._length,$=0;$<it;$+=1)dt.addShape(this.processPath(i[$],at));h.shape.paths=h.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var e=[0,0];function i(dt){var ft=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||ft,this.a&&dt.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&dt.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&dt.skewFromAxis(-this.sk.v,this.sa.v),this.r?dt.rotate(-this.r.v):dt.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?dt.translate(this.px.v,this.py.v,-this.pz.v):dt.translate(this.px.v,this.py.v,0):dt.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function c(dt){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||dt){var ft;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var xt,Ct;if(ft=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(xt=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/ft,0),Ct=this.p.getValueAtTime(this.p.keyframes[0].t/ft,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(xt=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/ft,0),Ct=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/ft,0)):(xt=this.p.pv,Ct=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/ft,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){xt=[],Ct=[];var bt=this.px,kt=this.py;bt._caching.lastFrame+bt.offsetTime<=bt.keyframes[0].t?(xt[0]=bt.getValueAtTime((bt.keyframes[0].t+.01)/ft,0),xt[1]=kt.getValueAtTime((kt.keyframes[0].t+.01)/ft,0),Ct[0]=bt.getValueAtTime(bt.keyframes[0].t/ft,0),Ct[1]=kt.getValueAtTime(kt.keyframes[0].t/ft,0)):bt._caching.lastFrame+bt.offsetTime>=bt.keyframes[bt.keyframes.length-1].t?(xt[0]=bt.getValueAtTime(bt.keyframes[bt.keyframes.length-1].t/ft,0),xt[1]=kt.getValueAtTime(kt.keyframes[kt.keyframes.length-1].t/ft,0),Ct[0]=bt.getValueAtTime((bt.keyframes[bt.keyframes.length-1].t-.01)/ft,0),Ct[1]=kt.getValueAtTime((kt.keyframes[kt.keyframes.length-1].t-.01)/ft,0)):(xt=[bt.pv,kt.pv],Ct[0]=bt.getValueAtTime((bt._caching.lastFrame+bt.offsetTime-.01)/ft,bt.offsetTime),Ct[1]=kt.getValueAtTime((kt._caching.lastFrame+kt.offsetTime-.01)/ft,kt.offsetTime))}else Ct=e,xt=Ct;this.v.rotate(-Math.atan2(xt[1]-Ct[1],xt[0]-Ct[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function b(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length)this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1;else return;if(!this.s.effectsSequence.length)this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2;else return;if(this.sk)if(!this.sk.effectsSequence.length&&!this.sa.effectsSequence.length)this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3;else return;this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):!this.rz.effectsSequence.length&&!this.ry.effectsSequence.length&&!this.rx.effectsSequence.length&&!this.or.effectsSequence.length&&(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}function $(){}function it(dt){this._addDynamicProperty(dt),this.elem.addDynamicProperty(dt),this._isDirty=!0}function at(dt,ft,xt){if(this.elem=dt,this.frameId=-1,this.propType="transform",this.data=ft,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(xt||dt),ft.p&&ft.p.s?(this.px=PropertyFactory.getProp(dt,ft.p.x,0,0,this),this.py=PropertyFactory.getProp(dt,ft.p.y,0,0,this),ft.p.z&&(this.pz=PropertyFactory.getProp(dt,ft.p.z,0,0,this))):this.p=PropertyFactory.getProp(dt,ft.p||{k:[0,0,0]},1,0,this),ft.rx){if(this.rx=PropertyFactory.getProp(dt,ft.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(dt,ft.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(dt,ft.rz,0,degToRads,this),ft.or.k[0].ti){var Ct,bt=ft.or.k.length;for(Ct=0;Ct<bt;Ct+=1)ft.or.k[Ct].to=null,ft.or.k[Ct].ti=null}this.or=PropertyFactory.getProp(dt,ft.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(dt,ft.r||{k:0},0,degToRads,this);ft.sk&&(this.sk=PropertyFactory.getProp(dt,ft.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(dt,ft.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(dt,ft.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(dt,ft.s||{k:[100,100,100]},1,.01,this),ft.o?this.o=PropertyFactory.getProp(dt,ft.o,0,.01,dt):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}at.prototype={applyToMatrix:i,getValue:c,precalculateMatrix:b,autoOrient:$},extendPrototype([DynamicPropertyContainer],at),at.prototype.addDynamicProperty=it,at.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function h(dt,ft,xt){return new at(dt,ft,xt)}return{getTransformProperty:h}}();function RepeaterModifier(){}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(e,i.c,0,null,this),this.o=PropertyFactory.getProp(e,i.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(e,i.tr,this),this.so=PropertyFactory.getProp(e,i.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(e,i.tr.eo,0,.01,this),this.data=i,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(e,i,c,b,$,it){var at=it?-1:1,h=b.s.v[0]+(1-b.s.v[0])*(1-$),dt=b.s.v[1]+(1-b.s.v[1])*(1-$);e.translate(b.p.v[0]*at*$,b.p.v[1]*at*$,b.p.v[2]),i.translate(-b.a.v[0],-b.a.v[1],b.a.v[2]),i.rotate(-b.r.v*at*$),i.translate(b.a.v[0],b.a.v[1],b.a.v[2]),c.translate(-b.a.v[0],-b.a.v[1],b.a.v[2]),c.scale(it?1/h:h,it?1/dt:dt),c.translate(b.a.v[0],b.a.v[1],b.a.v[2])},RepeaterModifier.prototype.init=function(e,i,c,b){for(this.elem=e,this.arr=i,this.pos=c,this.elemsData=b,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,i[c]);c>0;)c-=1,this._elements.unshift(i[c]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(e){var i,c=e.length;for(i=0;i<c;i+=1)e[i]._processed=!1,e[i].ty==="gr"&&this.resetElements(e[i].it)},RepeaterModifier.prototype.cloneElements=function(e){var i=JSON.parse(JSON.stringify(e));return this.resetElements(i),i},RepeaterModifier.prototype.changeGroupRender=function(e,i){var c,b=e.length;for(c=0;c<b;c+=1)e[c]._render=i,e[c].ty==="gr"&&this.changeGroupRender(e[c].it,i)},RepeaterModifier.prototype.processShapes=function(e){var i,c,b,$,it,at=!1;if(this._mdf||e){var h=Math.ceil(this.c.v);if(this._groups.length<h){for(;this._groups.length<h;){var dt={it:this.cloneElements(this._elements),ty:"gr"};dt.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,dt),this._groups.splice(0,0,dt),this._currentCopies+=1}this.elem.reloadShapes(),at=!0}it=0;var ft;for(b=0;b<=this._groups.length-1;b+=1){if(ft=it<h,this._groups[b]._render=ft,this.changeGroupRender(this._groups[b].it,ft),!ft){var xt=this.elemsData[b].it,Ct=xt[xt.length-1];Ct.transform.op.v!==0?(Ct.transform.op._mdf=!0,Ct.transform.op.v=0):Ct.transform.op._mdf=!1}it+=1}this._currentCopies=h;var bt=this.o.v,kt=bt%1,Dt=bt>0?Math.floor(bt):Math.ceil(bt),At=this.pMatrix.props,Bt=this.rMatrix.props,Tt=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var It=0;if(bt>0){for(;It<Dt;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),It+=1;kt&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,kt,!1),It+=kt)}else if(bt<0){for(;It>Dt;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),It-=1;kt&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-kt,!0),It-=kt)}b=this.data.m===1?0:this._currentCopies-1,$=this.data.m===1?1:-1,it=this._currentCopies;for(var St,jt;it;){if(i=this.elemsData[b].it,c=i[i.length-1].transform.mProps.v.props,jt=c.length,i[i.length-1].transform.mProps._mdf=!0,i[i.length-1].transform.op._mdf=!0,i[i.length-1].transform.op.v=this._currentCopies===1?this.so.v:this.so.v+(this.eo.v-this.so.v)*(b/(this._currentCopies-1)),It!==0){for((b!==0&&$===1||b!==this._currentCopies-1&&$===-1)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(Bt[0],Bt[1],Bt[2],Bt[3],Bt[4],Bt[5],Bt[6],Bt[7],Bt[8],Bt[9],Bt[10],Bt[11],Bt[12],Bt[13],Bt[14],Bt[15]),this.matrix.transform(Tt[0],Tt[1],Tt[2],Tt[3],Tt[4],Tt[5],Tt[6],Tt[7],Tt[8],Tt[9],Tt[10],Tt[11],Tt[12],Tt[13],Tt[14],Tt[15]),this.matrix.transform(At[0],At[1],At[2],At[3],At[4],At[5],At[6],At[7],At[8],At[9],At[10],At[11],At[12],At[13],At[14],At[15]),St=0;St<jt;St+=1)c[St]=this.matrix.props[St];this.matrix.reset()}else for(this.matrix.reset(),St=0;St<jt;St+=1)c[St]=this.matrix.props[St];It+=1,it-=1,b+=$}}else for(it=this._currentCopies,b=0,$=1;it;)i=this.elemsData[b].it,c=i[i.length-1].transform.mProps.v.props,i[i.length-1].transform.mProps._mdf=!1,i[i.length-1].transform.op._mdf=!1,it-=1,b+=$;return at},RepeaterModifier.prototype.addShape=function(){};function RoundCornersModifier(){}extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(e,i.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(e,i){var c=shapePool.newElement();c.c=e.c;var b,$=e._length,it,at,h,dt,ft,xt,Ct=0,bt,kt,Dt,At,Bt,Tt;for(b=0;b<$;b+=1)it=e.v[b],h=e.o[b],at=e.i[b],it[0]===h[0]&&it[1]===h[1]&&it[0]===at[0]&&it[1]===at[1]?(b===0||b===$-1)&&!e.c?(c.setTripleAt(it[0],it[1],h[0],h[1],at[0],at[1],Ct),Ct+=1):(b===0?dt=e.v[$-1]:dt=e.v[b-1],ft=Math.sqrt(Math.pow(it[0]-dt[0],2)+Math.pow(it[1]-dt[1],2)),xt=ft?Math.min(ft/2,i)/ft:0,Bt=it[0]+(dt[0]-it[0])*xt,bt=Bt,Tt=it[1]-(it[1]-dt[1])*xt,kt=Tt,Dt=bt-(bt-it[0])*roundCorner,At=kt-(kt-it[1])*roundCorner,c.setTripleAt(bt,kt,Dt,At,Bt,Tt,Ct),Ct+=1,b===$-1?dt=e.v[0]:dt=e.v[b+1],ft=Math.sqrt(Math.pow(it[0]-dt[0],2)+Math.pow(it[1]-dt[1],2)),xt=ft?Math.min(ft/2,i)/ft:0,Dt=it[0]+(dt[0]-it[0])*xt,bt=Dt,At=it[1]+(dt[1]-it[1])*xt,kt=At,Bt=bt-(bt-it[0])*roundCorner,Tt=kt-(kt-it[1])*roundCorner,c.setTripleAt(bt,kt,Dt,At,Bt,Tt,Ct),Ct+=1):(c.setTripleAt(e.v[b][0],e.v[b][1],e.o[b][0],e.o[b][1],e.i[b][0],e.i[b][1],Ct),Ct+=1);return c},RoundCornersModifier.prototype.processShapes=function(e){var i,c,b=this.shapes.length,$,it,at=this.rd.v;if(at!==0){var h,dt;for(c=0;c<b;c+=1){if(h=this.shapes[c],dt=h.localShapeCollection,!(!h.shape._mdf&&!this._mdf&&!e))for(dt.releaseShapes(),h.shape._mdf=!0,i=h.shape.paths.shapes,it=h.shape.paths._length,$=0;$<it;$+=1)dt.addShape(this.processPath(i[$],at));h.shape.paths=h.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function floatEqual(e,i){return Math.abs(e-i)*1e5<=Math.min(Math.abs(e),Math.abs(i))}function floatZero(e){return Math.abs(e)<=1e-5}function lerp(e,i,c){return e*(1-c)+i*c}function lerpPoint(e,i,c){return[lerp(e[0],i[0],c),lerp(e[1],i[1],c)]}function quadRoots(e,i,c){if(e===0)return[];var b=i*i-4*e*c;if(b<0)return[];var $=-i/(2*e);if(b===0)return[$];var it=Math.sqrt(b)/(2*e);return[$-it,$+it]}function polynomialCoefficients(e,i,c,b){return[-e+3*i-3*c+b,3*e-6*i+3*c,-3*e+3*i,e]}function singlePoint(e){return new PolynomialBezier(e,e,e,e,!1)}function PolynomialBezier(e,i,c,b,$){$&&pointEqual(e,i)&&(i=lerpPoint(e,b,1/3)),$&&pointEqual(c,b)&&(c=lerpPoint(e,b,2/3));var it=polynomialCoefficients(e[0],i[0],c[0],b[0]),at=polynomialCoefficients(e[1],i[1],c[1],b[1]);this.a=[it[0],at[0]],this.b=[it[1],at[1]],this.c=[it[2],at[2]],this.d=[it[3],at[3]],this.points=[e,i,c,b]}PolynomialBezier.prototype.point=function(e){return[((this.a[0]*e+this.b[0])*e+this.c[0])*e+this.d[0],((this.a[1]*e+this.b[1])*e+this.c[1])*e+this.d[1]]},PolynomialBezier.prototype.derivative=function(e){return[(3*e*this.a[0]+2*this.b[0])*e+this.c[0],(3*e*this.a[1]+2*this.b[1])*e+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(e){var i=this.derivative(e);return Math.atan2(i[1],i[0])},PolynomialBezier.prototype.normalAngle=function(e){var i=this.derivative(e);return Math.atan2(i[0],i[1])},PolynomialBezier.prototype.inflectionPoints=function(){var e=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(e))return[];var i=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/e,c=i*i-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/e;if(c<0)return[];var b=Math.sqrt(c);return floatZero(b)?b>0&&b<1?[i]:[]:[i-b,i+b].filter(function($){return $>0&&$<1})},PolynomialBezier.prototype.split=function(e){if(e<=0)return[singlePoint(this.points[0]),this];if(e>=1)return[this,singlePoint(this.points[this.points.length-1])];var i=lerpPoint(this.points[0],this.points[1],e),c=lerpPoint(this.points[1],this.points[2],e),b=lerpPoint(this.points[2],this.points[3],e),$=lerpPoint(i,c,e),it=lerpPoint(c,b,e),at=lerpPoint($,it,e);return[new PolynomialBezier(this.points[0],i,$,at,!0),new PolynomialBezier(at,it,b,this.points[3],!0)]};function extrema(e,i){var c=e.points[0][i],b=e.points[e.points.length-1][i];if(c>b){var $=b;b=c,c=$}for(var it=quadRoots(3*e.a[i],2*e.b[i],e.c[i]),at=0;at<it.length;at+=1)if(it[at]>0&&it[at]<1){var h=e.point(it[at])[i];h<c?c=h:h>b&&(b=h)}return{min:c,max:b}}PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var e=this.bounds();return{left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max,width:e.x.max-e.x.min,height:e.y.max-e.y.min,cx:(e.x.max+e.x.min)/2,cy:(e.y.max+e.y.min)/2}};function intersectData(e,i,c){var b=e.boundingBox();return{cx:b.cx,cy:b.cy,width:b.width,height:b.height,bez:e,t:(i+c)/2,t1:i,t2:c}}function splitData(e){var i=e.bez.split(.5);return[intersectData(i[0],e.t1,e.t),intersectData(i[1],e.t,e.t2)]}function boxIntersect(e,i){return Math.abs(e.cx-i.cx)*2<e.width+i.width&&Math.abs(e.cy-i.cy)*2<e.height+i.height}function intersectsImpl(e,i,c,b,$,it){if(boxIntersect(e,i)){if(c>=it||e.width<=b&&e.height<=b&&i.width<=b&&i.height<=b){$.push([e.t,i.t]);return}var at=splitData(e),h=splitData(i);intersectsImpl(at[0],h[0],c+1,b,$,it),intersectsImpl(at[0],h[1],c+1,b,$,it),intersectsImpl(at[1],h[0],c+1,b,$,it),intersectsImpl(at[1],h[1],c+1,b,$,it)}}PolynomialBezier.prototype.intersections=function(e,i,c){i===void 0&&(i=2),c===void 0&&(c=7);var b=[];return intersectsImpl(intersectData(this,0,1),intersectData(e,0,1),0,i,b,c),b},PolynomialBezier.shapeSegment=function(e,i){var c=(i+1)%e.length();return new PolynomialBezier(e.v[i],e.o[i],e.i[c],e.v[c],!0)},PolynomialBezier.shapeSegmentInverted=function(e,i){var c=(i+1)%e.length();return new PolynomialBezier(e.v[c],e.i[c],e.o[i],e.v[i],!0)};function crossProduct(e,i){return[e[1]*i[2]-e[2]*i[1],e[2]*i[0]-e[0]*i[2],e[0]*i[1]-e[1]*i[0]]}function lineIntersection(e,i,c,b){var $=[e[0],e[1],1],it=[i[0],i[1],1],at=[c[0],c[1],1],h=[b[0],b[1],1],dt=crossProduct(crossProduct($,it),crossProduct(at,h));return floatZero(dt[2])?null:[dt[0]/dt[2],dt[1]/dt[2]]}function polarOffset(e,i,c){return[e[0]+Math.cos(i)*c,e[1]-Math.sin(i)*c]}function pointDistance(e,i){return Math.hypot(e[0]-i[0],e[1]-i[1])}function pointEqual(e,i){return floatEqual(e[0],i[0])&&floatEqual(e[1],i[1])}function ZigZagModifier(){}extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(e,i.s,0,null,this),this.frequency=PropertyFactory.getProp(e,i.r,0,null,this),this.pointsType=PropertyFactory.getProp(e,i.pt,0,null,this),this._isAnimated=this.amplitude.effectsSequence.length!==0||this.frequency.effectsSequence.length!==0||this.pointsType.effectsSequence.length!==0};function setPoint(e,i,c,b,$,it,at){var h=c-Math.PI/2,dt=c+Math.PI/2,ft=i[0]+Math.cos(c)*b*$,xt=i[1]-Math.sin(c)*b*$;e.setTripleAt(ft,xt,ft+Math.cos(h)*it,xt-Math.sin(h)*it,ft+Math.cos(dt)*at,xt-Math.sin(dt)*at,e.length())}function getPerpendicularVector(e,i){var c=[i[0]-e[0],i[1]-e[1]],b=-Math.PI*.5,$=[Math.cos(b)*c[0]-Math.sin(b)*c[1],Math.sin(b)*c[0]+Math.cos(b)*c[1]];return $}function getProjectingAngle(e,i){var c=i===0?e.length()-1:i-1,b=(i+1)%e.length(),$=e.v[c],it=e.v[b],at=getPerpendicularVector($,it);return Math.atan2(0,1)-Math.atan2(at[1],at[0])}function zigZagCorner(e,i,c,b,$,it,at){var h=getProjectingAngle(i,c),dt=i.v[c%i._length],ft=i.v[c===0?i._length-1:c-1],xt=i.v[(c+1)%i._length],Ct=it===2?Math.sqrt(Math.pow(dt[0]-ft[0],2)+Math.pow(dt[1]-ft[1],2)):0,bt=it===2?Math.sqrt(Math.pow(dt[0]-xt[0],2)+Math.pow(dt[1]-xt[1],2)):0;setPoint(e,i.v[c%i._length],h,at,b,bt/(($+1)*2),Ct/(($+1)*2))}function zigZagSegment(e,i,c,b,$,it){for(var at=0;at<b;at+=1){var h=(at+1)/(b+1),dt=$===2?Math.sqrt(Math.pow(i.points[3][0]-i.points[0][0],2)+Math.pow(i.points[3][1]-i.points[0][1],2)):0,ft=i.normalAngle(h),xt=i.point(h);setPoint(e,xt,ft,it,c,dt/((b+1)*2),dt/((b+1)*2)),it=-it}return it}ZigZagModifier.prototype.processPath=function(e,i,c,b){var $=e._length,it=shapePool.newElement();if(it.c=e.c,e.c||($-=1),$===0)return it;var at=-1,h=PolynomialBezier.shapeSegment(e,0);zigZagCorner(it,e,0,i,c,b,at);for(var dt=0;dt<$;dt+=1)at=zigZagSegment(it,h,i,c,b,-at),dt===$-1&&!e.c?h=null:h=PolynomialBezier.shapeSegment(e,(dt+1)%$),zigZagCorner(it,e,dt+1,i,c,b,at);return it},ZigZagModifier.prototype.processShapes=function(e){var i,c,b=this.shapes.length,$,it,at=this.amplitude.v,h=Math.max(0,Math.round(this.frequency.v)),dt=this.pointsType.v;if(at!==0){var ft,xt;for(c=0;c<b;c+=1){if(ft=this.shapes[c],xt=ft.localShapeCollection,!(!ft.shape._mdf&&!this._mdf&&!e))for(xt.releaseShapes(),ft.shape._mdf=!0,i=ft.shape.paths.shapes,it=ft.shape.paths._length,$=0;$<it;$+=1)xt.addShape(this.processPath(i[$],at,h,dt));ft.shape.paths=ft.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function linearOffset(e,i,c){var b=Math.atan2(i[0]-e[0],i[1]-e[1]);return[polarOffset(e,b,c),polarOffset(i,b,c)]}function offsetSegment(e,i){var c,b,$,it,at,h,dt;dt=linearOffset(e.points[0],e.points[1],i),c=dt[0],b=dt[1],dt=linearOffset(e.points[1],e.points[2],i),$=dt[0],it=dt[1],dt=linearOffset(e.points[2],e.points[3],i),at=dt[0],h=dt[1];var ft=lineIntersection(c,b,$,it);ft===null&&(ft=b);var xt=lineIntersection(at,h,$,it);return xt===null&&(xt=at),new PolynomialBezier(c,ft,xt,h)}function joinLines(e,i,c,b,$){var it=i.points[3],at=c.points[0];if(b===3||pointEqual(it,at))return it;if(b===2){var h=-i.tangentAngle(1),dt=-c.tangentAngle(0)+Math.PI,ft=lineIntersection(it,polarOffset(it,h+Math.PI/2,100),at,polarOffset(at,h+Math.PI/2,100)),xt=ft?pointDistance(ft,it):pointDistance(it,at)/2,Ct=polarOffset(it,h,2*xt*roundCorner);return e.setXYAt(Ct[0],Ct[1],"o",e.length()-1),Ct=polarOffset(at,dt,2*xt*roundCorner),e.setTripleAt(at[0],at[1],at[0],at[1],Ct[0],Ct[1],e.length()),at}var bt=pointEqual(it,i.points[2])?i.points[0]:i.points[2],kt=pointEqual(at,c.points[1])?c.points[3]:c.points[1],Dt=lineIntersection(bt,it,at,kt);return Dt&&pointDistance(Dt,it)<$?(e.setTripleAt(Dt[0],Dt[1],Dt[0],Dt[1],Dt[0],Dt[1],e.length()),Dt):it}function getIntersection(e,i){var c=e.intersections(i);return c.length&&floatEqual(c[0][0],1)&&c.shift(),c.length?c[0]:null}function pruneSegmentIntersection(e,i){var c=e.slice(),b=i.slice(),$=getIntersection(e[e.length-1],i[0]);return $&&(c[e.length-1]=e[e.length-1].split($[0])[0],b[0]=i[0].split($[1])[1]),e.length>1&&i.length>1&&($=getIntersection(e[0],i[i.length-1]),$)?[[e[0].split($[0])[0]],[i[i.length-1].split($[1])[1]]]:[c,b]}function pruneIntersections(e){for(var i,c=1;c<e.length;c+=1)i=pruneSegmentIntersection(e[c-1],e[c]),e[c-1]=i[0],e[c]=i[1];return e.length>1&&(i=pruneSegmentIntersection(e[e.length-1],e[0]),e[e.length-1]=i[0],e[0]=i[1]),e}function offsetSegmentSplit(e,i){var c=e.inflectionPoints(),b,$,it,at;if(c.length===0)return[offsetSegment(e,i)];if(c.length===1||floatEqual(c[1],1))return it=e.split(c[0]),b=it[0],$=it[1],[offsetSegment(b,i),offsetSegment($,i)];it=e.split(c[0]),b=it[0];var h=(c[1]-c[0])/(1-c[0]);return it=it[1].split(h),at=it[0],$=it[1],[offsetSegment(b,i),offsetSegment(at,i),offsetSegment($,i)]}function OffsetPathModifier(){}extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,i.a,0,null,this),this.miterLimit=PropertyFactory.getProp(e,i.ml,0,null,this),this.lineJoin=i.lj,this._isAnimated=this.amount.effectsSequence.length!==0},OffsetPathModifier.prototype.processPath=function(e,i,c,b){var $=shapePool.newElement();$.c=e.c;var it=e.length();e.c||(it-=1);var at,h,dt,ft=[];for(at=0;at<it;at+=1)dt=PolynomialBezier.shapeSegment(e,at),ft.push(offsetSegmentSplit(dt,i));if(!e.c)for(at=it-1;at>=0;at-=1)dt=PolynomialBezier.shapeSegmentInverted(e,at),ft.push(offsetSegmentSplit(dt,i));ft=pruneIntersections(ft);var xt=null,Ct=null;for(at=0;at<ft.length;at+=1){var bt=ft[at];for(Ct&&(xt=joinLines($,Ct,bt[0],c,b)),Ct=bt[bt.length-1],h=0;h<bt.length;h+=1)dt=bt[h],xt&&pointEqual(dt.points[0],xt)?$.setXYAt(dt.points[1][0],dt.points[1][1],"o",$.length()-1):$.setTripleAt(dt.points[0][0],dt.points[0][1],dt.points[1][0],dt.points[1][1],dt.points[0][0],dt.points[0][1],$.length()),$.setTripleAt(dt.points[3][0],dt.points[3][1],dt.points[3][0],dt.points[3][1],dt.points[2][0],dt.points[2][1],$.length()),xt=dt.points[3]}return ft.length&&joinLines($,Ct,ft[0][0],c,b),$},OffsetPathModifier.prototype.processShapes=function(e){var i,c,b=this.shapes.length,$,it,at=this.amount.v,h=this.miterLimit.v,dt=this.lineJoin;if(at!==0){var ft,xt;for(c=0;c<b;c+=1){if(ft=this.shapes[c],xt=ft.localShapeCollection,!(!ft.shape._mdf&&!this._mdf&&!e))for(xt.releaseShapes(),ft.shape._mdf=!0,i=ft.shape.paths.shapes,it=ft.shape.paths._length,$=0;$<it;$+=1)xt.addShape(this.processPath(i[$],at,dt,h));ft.shape.paths=ft.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function getFontProperties(e){for(var i=e.fStyle?e.fStyle.split(" "):[],c="normal",b="normal",$=i.length,it,at=0;at<$;at+=1)switch(it=i[at].toLowerCase(),it){case"italic":b="italic";break;case"bold":c="700";break;case"black":c="900";break;case"medium":c="500";break;case"regular":case"normal":c="400";break;case"light":case"thin":c="200";break}return{style:b,weight:e.fWeight||c}}var FontManager=function(){var e=5e3,i={w:0,size:0,shapes:[],data:{shapes:[]}},c=[];c=c.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var b=127988,$=917631,it=917601,at=917626,h=65039,dt=8205,ft=127462,xt=127487,Ct=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function bt(Xt){var mr=Xt.split(","),Ut,Jt=mr.length,Or=[];for(Ut=0;Ut<Jt;Ut+=1)mr[Ut]!=="sans-serif"&&mr[Ut]!=="monospace"&&Or.push(mr[Ut]);return Or.join(",")}function kt(Xt,mr){var Ut=createTag("span");Ut.setAttribute("aria-hidden",!0),Ut.style.fontFamily=mr;var Jt=createTag("span");Jt.innerText="giItT1WQy@!-/#",Ut.style.position="absolute",Ut.style.left="-10000px",Ut.style.top="-10000px",Ut.style.fontSize="300px",Ut.style.fontVariant="normal",Ut.style.fontStyle="normal",Ut.style.fontWeight="normal",Ut.style.letterSpacing="0",Ut.appendChild(Jt),document.body.appendChild(Ut);var Or=Jt.offsetWidth;return Jt.style.fontFamily=bt(Xt)+", "+mr,{node:Jt,w:Or,parent:Ut}}function Dt(){var Xt,mr=this.fonts.length,Ut,Jt,Or=mr;for(Xt=0;Xt<mr;Xt+=1)this.fonts[Xt].loaded?Or-=1:this.fonts[Xt].fOrigin==="n"||this.fonts[Xt].origin===0?this.fonts[Xt].loaded=!0:(Ut=this.fonts[Xt].monoCase.node,Jt=this.fonts[Xt].monoCase.w,Ut.offsetWidth!==Jt?(Or-=1,this.fonts[Xt].loaded=!0):(Ut=this.fonts[Xt].sansCase.node,Jt=this.fonts[Xt].sansCase.w,Ut.offsetWidth!==Jt&&(Or-=1,this.fonts[Xt].loaded=!0)),this.fonts[Xt].loaded&&(this.fonts[Xt].sansCase.parent.parentNode.removeChild(this.fonts[Xt].sansCase.parent),this.fonts[Xt].monoCase.parent.parentNode.removeChild(this.fonts[Xt].monoCase.parent)));Or!==0&&Date.now()-this.initTime<e?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function At(Xt,mr){var Ut=document.body&&mr?"svg":"canvas",Jt,Or=getFontProperties(Xt);if(Ut==="svg"){var Cr=createNS("text");Cr.style.fontSize="100px",Cr.setAttribute("font-family",Xt.fFamily),Cr.setAttribute("font-style",Or.style),Cr.setAttribute("font-weight",Or.weight),Cr.textContent="1",Xt.fClass?(Cr.style.fontFamily="inherit",Cr.setAttribute("class",Xt.fClass)):Cr.style.fontFamily=Xt.fFamily,mr.appendChild(Cr),Jt=Cr}else{var pn=new OffscreenCanvas(500,500).getContext("2d");pn.font=Or.style+" "+Or.weight+" 100px "+Xt.fFamily,Jt=pn}function On(Zn){return Ut==="svg"?(Jt.textContent=Zn,Jt.getComputedTextLength()):Jt.measureText(Zn).width}return{measureText:On}}function Bt(Xt,mr){if(!Xt){this.isLoaded=!0;return}if(this.chars){this.isLoaded=!0,this.fonts=Xt.list;return}if(!document.body){this.isLoaded=!0,Xt.list.forEach(function($s){$s.helper=At($s),$s.cache={}}),this.fonts=Xt.list;return}var Ut=Xt.list,Jt,Or=Ut.length,Cr=Or;for(Jt=0;Jt<Or;Jt+=1){var pn=!0,On,Zn;if(Ut[Jt].loaded=!1,Ut[Jt].monoCase=kt(Ut[Jt].fFamily,"monospace"),Ut[Jt].sansCase=kt(Ut[Jt].fFamily,"sans-serif"),!Ut[Jt].fPath)Ut[Jt].loaded=!0,Cr-=1;else if(Ut[Jt].fOrigin==="p"||Ut[Jt].origin===3){if(On=document.querySelectorAll('style[f-forigin="p"][f-family="'+Ut[Jt].fFamily+'"], style[f-origin="3"][f-family="'+Ut[Jt].fFamily+'"]'),On.length>0&&(pn=!1),pn){var As=createTag("style");As.setAttribute("f-forigin",Ut[Jt].fOrigin),As.setAttribute("f-origin",Ut[Jt].origin),As.setAttribute("f-family",Ut[Jt].fFamily),As.type="text/css",As.innerText="@font-face {font-family: "+Ut[Jt].fFamily+"; font-style: normal; src: url('"+Ut[Jt].fPath+"');}",mr.appendChild(As)}}else if(Ut[Jt].fOrigin==="g"||Ut[Jt].origin===1){for(On=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),Zn=0;Zn<On.length;Zn+=1)On[Zn].href.indexOf(Ut[Jt].fPath)!==-1&&(pn=!1);if(pn){var ss=createTag("link");ss.setAttribute("f-forigin",Ut[Jt].fOrigin),ss.setAttribute("f-origin",Ut[Jt].origin),ss.type="text/css",ss.rel="stylesheet",ss.href=Ut[Jt].fPath,document.body.appendChild(ss)}}else if(Ut[Jt].fOrigin==="t"||Ut[Jt].origin===2){for(On=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),Zn=0;Zn<On.length;Zn+=1)Ut[Jt].fPath===On[Zn].src&&(pn=!1);if(pn){var Ls=createTag("link");Ls.setAttribute("f-forigin",Ut[Jt].fOrigin),Ls.setAttribute("f-origin",Ut[Jt].origin),Ls.setAttribute("rel","stylesheet"),Ls.setAttribute("href",Ut[Jt].fPath),mr.appendChild(Ls)}}Ut[Jt].helper=At(Ut[Jt],mr),Ut[Jt].cache={},this.fonts.push(Ut[Jt])}Cr===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}function Tt(Xt){if(Xt){this.chars||(this.chars=[]);var mr,Ut=Xt.length,Jt,Or=this.chars.length,Cr;for(mr=0;mr<Ut;mr+=1){for(Jt=0,Cr=!1;Jt<Or;)this.chars[Jt].style===Xt[mr].style&&this.chars[Jt].fFamily===Xt[mr].fFamily&&this.chars[Jt].ch===Xt[mr].ch&&(Cr=!0),Jt+=1;Cr||(this.chars.push(Xt[mr]),Or+=1)}}}function It(Xt,mr,Ut){for(var Jt=0,Or=this.chars.length;Jt<Or;){if(this.chars[Jt].ch===Xt&&this.chars[Jt].style===mr&&this.chars[Jt].fFamily===Ut)return this.chars[Jt];Jt+=1}return(typeof Xt=="string"&&Xt.charCodeAt(0)!==13||!Xt)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",Xt,mr,Ut)),i}function St(Xt,mr,Ut){var Jt=this.getFontByName(mr),Or=Xt;if(!Jt.cache[Or]){var Cr=Jt.helper;if(Xt===" "){var pn=Cr.measureText("|"+Xt+"|"),On=Cr.measureText("||");Jt.cache[Or]=(pn-On)/100}else Jt.cache[Or]=Cr.measureText(Xt)/100}return Jt.cache[Or]*Ut}function jt(Xt){for(var mr=0,Ut=this.fonts.length;mr<Ut;){if(this.fonts[mr].fName===Xt)return this.fonts[mr];mr+=1}return this.fonts[0]}function Ht(Xt){var mr=0,Ut=Xt.charCodeAt(0);if(Ut>=55296&&Ut<=56319){var Jt=Xt.charCodeAt(1);Jt>=56320&&Jt<=57343&&(mr=(Ut-55296)*1024+Jt-56320+65536)}return mr}function Kt(Xt,mr){var Ut=Xt.toString(16)+mr.toString(16);return Ct.indexOf(Ut)!==-1}function ir(Xt){return Xt===dt}function nr(Xt){return Xt===h}function kr(Xt){var mr=Ht(Xt);return mr>=ft&&mr<=xt}function br(Xt){return kr(Xt.substr(0,2))&&kr(Xt.substr(2,2))}function Sr(Xt){return c.indexOf(Xt)!==-1}function $r(Xt,mr){var Ut=Ht(Xt.substr(mr,2));if(Ut!==b)return!1;var Jt=0;for(mr+=2;Jt<5;){if(Ut=Ht(Xt.substr(mr,2)),Ut<it||Ut>at)return!1;Jt+=1,mr+=2}return Ht(Xt.substr(mr,2))===$}function rn(){this.isLoaded=!0}var Zr=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};Zr.isModifier=Kt,Zr.isZeroWidthJoiner=ir,Zr.isFlagEmoji=br,Zr.isRegionalCode=kr,Zr.isCombinedCharacter=Sr,Zr.isRegionalFlag=$r,Zr.isVariationSelector=nr,Zr.BLACK_FLAG_CODE_POINT=b;var Kr={addChars:Tt,addFonts:Bt,getCharData:It,getFontByName:jt,measureText:St,checkLoadedFonts:Dt,setIsLoaded:rn};return Zr.prototype=Kr,Zr}();function SlotManager(e){this.animationData=e}SlotManager.prototype.getProp=function(e){return this.animationData.slots&&this.animationData.slots[e.sid]?Object.assign(e,this.animationData.slots[e.sid].p):e};function slotFactory(e){return new SlotManager(e)}function RenderableElement(){}RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(i){this.renderableComponents.indexOf(i)===-1&&this.renderableComponents.push(i)},removeRenderableComponent:function(i){this.renderableComponents.indexOf(i)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(i),1)},prepareRenderableFrame:function(i){this.checkLayerLimits(i)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(i){this.data.ip-this.data.st<=i&&this.data.op-this.data.st>i?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var i,c=this.renderableComponents.length;for(i=0;i<c;i+=1)this.renderableComponents[i].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var e={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(i){return e[i]||""}}();function SliderEffect(e,i,c){this.p=PropertyFactory.getProp(i,e.v,0,0,c)}function AngleEffect(e,i,c){this.p=PropertyFactory.getProp(i,e.v,0,0,c)}function ColorEffect(e,i,c){this.p=PropertyFactory.getProp(i,e.v,1,0,c)}function PointEffect(e,i,c){this.p=PropertyFactory.getProp(i,e.v,1,0,c)}function LayerIndexEffect(e,i,c){this.p=PropertyFactory.getProp(i,e.v,0,0,c)}function MaskIndexEffect(e,i,c){this.p=PropertyFactory.getProp(i,e.v,0,0,c)}function CheckboxEffect(e,i,c){this.p=PropertyFactory.getProp(i,e.v,0,0,c)}function NoValueEffect(){this.p={}}function EffectsManager(e,i){var c=e.ef||[];this.effectElements=[];var b,$=c.length,it;for(b=0;b<$;b+=1)it=new GroupEffect(c[b],i),this.effectElements.push(it)}function GroupEffect(e,i){this.init(e,i)}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(e,i){this.data=e,this.effectElements=[],this.initDynamicPropertyContainer(i);var c,b=this.data.ef.length,$,it=this.data.ef;for(c=0;c<b;c+=1){switch($=null,it[c].ty){case 0:$=new SliderEffect(it[c],i,this);break;case 1:$=new AngleEffect(it[c],i,this);break;case 2:$=new ColorEffect(it[c],i,this);break;case 3:$=new PointEffect(it[c],i,this);break;case 4:case 7:$=new CheckboxEffect(it[c],i,this);break;case 10:$=new LayerIndexEffect(it[c],i,this);break;case 11:$=new MaskIndexEffect(it[c],i,this);break;case 5:$=new EffectsManager(it[c],i);break;default:$=new NoValueEffect(it[c]);break}$&&this.effectElements.push($)}};function BaseElement(){}BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var i=0,c=this.data.masksProperties.length;i<c;){if(this.data.masksProperties[i].mode!=="n"&&this.data.masksProperties[i].cl!==!1)return!0;i+=1}return!1},initExpressions:function(){var i=getExpressionInterfaces();if(i){var c=i("layer"),b=i("effects"),$=i("shape"),it=i("text"),at=i("comp");this.layerInterface=c(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var h=b.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(h),this.data.ty===0||this.data.xt?this.compInterface=at(this):this.data.ty===4?(this.layerInterface.shapeInterface=$(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):this.data.ty===5&&(this.layerInterface.textInterface=it(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var i=getBlendMode(this.data.bm),c=this.baseElement||this.layerElement;c.style["mix-blend-mode"]=i},initBaseData:function(i,c,b){this.globalData=c,this.comp=b,this.data=i,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}};function FrameElement(){}FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(i,c){var b,$=this.dynamicProperties.length;for(b=0;b<$;b+=1)(c||this._isParent&&this.dynamicProperties[b].propType==="transform")&&(this.dynamicProperties[b].getValue(),this.dynamicProperties[b]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(i){this.dynamicProperties.indexOf(i)===-1&&this.dynamicProperties.push(i)}};function FootageElement(e,i,c){this.initFrame(),this.initRenderable(),this.assetData=i.getAssetData(e.refId),this.footageData=i.imageLoader.getAsset(this.assetData),this.initBaseData(e,i,c)}FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var e=getExpressionInterfaces();if(e){var i=e("footage");this.layerInterface=i(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData};function AudioElement(e,i,c){this.initFrame(),this.initRenderable(),this.assetData=i.getAssetData(e.refId),this.initBaseData(e,i,c),this._isPlaying=!1,this._canPlay=!1;var b=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(b),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,e.au&&e.au.lv?e.au.lv:{k:[100]},1,.01,this)}AudioElement.prototype.prepareFrame=function(e){if(this.prepareRenderableFrame(e,!0),this.prepareProperties(e,!0),this.tm._placeholder)this._currentTime=e/this.data.sr;else{var i=this.tm.v;this._currentTime=i}this._volume=this.lv.v[0];var c=this._volume*this._volumeMultiplier;this._previousVolume!==c&&(this._previousVolume=c,this.audio.volume(c))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(e){this.audio.rate(e)},AudioElement.prototype.volume=function(e){this._volumeMultiplier=e,this._previousVolume=e*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){};function BaseRenderer(){}BaseRenderer.prototype.checkLayers=function(e){var i,c=this.layers.length,b;for(this.completeLayers=!0,i=c-1;i>=0;i-=1)this.elements[i]||(b=this.layers[i],b.ip-b.st<=e-this.layers[i].st&&b.op-b.st>e-this.layers[i].st&&this.buildItem(i)),this.completeLayers=this.elements[i]?this.completeLayers:!1;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(e){switch(e.ty){case 2:return this.createImage(e);case 0:return this.createComp(e);case 1:return this.createSolid(e);case 3:return this.createNull(e);case 4:return this.createShape(e);case 5:return this.createText(e);case 6:return this.createAudio(e);case 13:return this.createCamera(e);case 15:return this.createFootage(e);default:return this.createNull(e)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(e){return new AudioElement(e,this.globalData,this)},BaseRenderer.prototype.createFootage=function(e){return new FootageElement(e,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)this.buildItem(e);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(e){this.completeLayers=!1;var i,c=e.length,b,$=this.layers.length;for(i=0;i<c;i+=1)for(b=0;b<$;){if(this.layers[b].id===e[i].id){this.layers[b]=e[i];break}b+=1}},BaseRenderer.prototype.setProjectInterface=function(e){this.globalData.projectInterface=e},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(e,i,c){for(var b=this.elements,$=this.layers,it=0,at=$.length;it<at;)$[it].ind==i&&(!b[it]||b[it]===!0?(this.buildItem(it),this.addPendingElement(e)):(c.push(b[it]),b[it].setAsParent(),$[it].parent!==void 0?this.buildElementParenting(e,$[it].parent,c):e.setHierarchy(c))),it+=1},BaseRenderer.prototype.addPendingElement=function(e){this.pendingElements.push(e)},BaseRenderer.prototype.searchExtraCompositions=function(e){var i,c=e.length;for(i=0;i<c;i+=1)if(e[i].xt){var b=this.createComp(e[i]);b.initExpressions(),this.globalData.projectInterface.registerComposition(b)}},BaseRenderer.prototype.getElementById=function(e){var i,c=this.elements.length;for(i=0;i<c;i+=1)if(this.elements[i].data.ind===e)return this.elements[i];return null},BaseRenderer.prototype.getElementByPath=function(e){var i=e.shift(),c;if(typeof i=="number")c=this.elements[i];else{var b,$=this.elements.length;for(b=0;b<$;b+=1)if(this.elements[b].data.nm===i){c=this.elements[b];break}}return e.length===0?c:c.getElementByPath(e)},BaseRenderer.prototype.setupGlobalData=function(e,i){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(e),this.globalData.fontManager.addChars(e.chars),this.globalData.fontManager.addFonts(e.fonts,i),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=e.fr,this.globalData.nm=e.nm,this.globalData.compSize={w:e.w,h:e.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}TransformElement.prototype={initTransform:function(){var i=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:i,localMat:i,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var i,c=this.finalTransform.mat,b=0,$=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;b<$;){if(this.hierarchy[b].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}b+=1}if(this.finalTransform._matMdf)for(i=this.finalTransform.mProp.v.props,c.cloneFromProps(i),b=0;b<$;b+=1)c.multiply(this.hierarchy[b].finalTransform.mProp.v)}(!this.localTransforms||this.finalTransform._matMdf)&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var i=0,c=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;i<c;)this.localTransforms[i]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[i]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),i+=1;if(this.finalTransform._localMatMdf){var b=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(b),i=1;i<c;i+=1){var $=this.localTransforms[i].matrix;b.multiply($)}b.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var it=this.finalTransform.localOpacity;for(i=0;i<c;i+=1)it*=this.localTransforms[i].opacity*.01;this.finalTransform.localOpacity=it}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var i=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(i.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var c=0,b=i.length;for(c=0;c<b;c+=1)this.localTransforms.push(i[c])}}},globalToLocal:function(i){var c=[];c.push(this.finalTransform);for(var b=!0,$=this.comp;b;)$.finalTransform?($.data.hasMask&&c.splice(0,0,$.finalTransform),$=$.comp):b=!1;var it,at=c.length,h;for(it=0;it<at;it+=1)h=c[it].mat.applyToPointArray(0,0,0),i=[i[0]-h[0],i[1]-h[1],0];return i},mHelper:new Matrix};function MaskElement(e,i,c){this.data=e,this.element=i,this.globalData=c,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var b=this.globalData.defs,$,it=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(it),this.solidPath="";var at,h=this.masksProperties,dt=0,ft=[],xt,Ct,bt=createElementID(),kt,Dt,At,Bt,Tt="clipPath",It="clip-path";for($=0;$<it;$+=1)if((h[$].mode!=="a"&&h[$].mode!=="n"||h[$].inv||h[$].o.k!==100||h[$].o.x)&&(Tt="mask",It="mask"),(h[$].mode==="s"||h[$].mode==="i")&&dt===0?(kt=createNS("rect"),kt.setAttribute("fill","#ffffff"),kt.setAttribute("width",this.element.comp.data.w||0),kt.setAttribute("height",this.element.comp.data.h||0),ft.push(kt)):kt=null,at=createNS("path"),h[$].mode==="n")this.viewData[$]={op:PropertyFactory.getProp(this.element,h[$].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,h[$],3),elem:at,lastPath:""},b.appendChild(at);else{dt+=1,at.setAttribute("fill",h[$].mode==="s"?"#000000":"#ffffff"),at.setAttribute("clip-rule","nonzero");var St;if(h[$].x.k!==0?(Tt="mask",It="mask",Bt=PropertyFactory.getProp(this.element,h[$].x,0,null,this.element),St=createElementID(),Dt=createNS("filter"),Dt.setAttribute("id",St),At=createNS("feMorphology"),At.setAttribute("operator","erode"),At.setAttribute("in","SourceGraphic"),At.setAttribute("radius","0"),Dt.appendChild(At),b.appendChild(Dt),at.setAttribute("stroke",h[$].mode==="s"?"#000000":"#ffffff")):(At=null,Bt=null),this.storedData[$]={elem:at,x:Bt,expan:At,lastPath:"",lastOperator:"",filterId:St,lastRadius:0},h[$].mode==="i"){Ct=ft.length;var jt=createNS("g");for(xt=0;xt<Ct;xt+=1)jt.appendChild(ft[xt]);var Ht=createNS("mask");Ht.setAttribute("mask-type","alpha"),Ht.setAttribute("id",bt+"_"+dt),Ht.appendChild(at),b.appendChild(Ht),jt.setAttribute("mask","url("+getLocationHref()+"#"+bt+"_"+dt+")"),ft.length=0,ft.push(jt)}else ft.push(at);h[$].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[$]={elem:at,lastPath:"",op:PropertyFactory.getProp(this.element,h[$].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,h[$],3),invRect:kt},this.viewData[$].prop.k||this.drawPath(h[$],this.viewData[$].prop.v,this.viewData[$])}for(this.maskElement=createNS(Tt),it=ft.length,$=0;$<it;$+=1)this.maskElement.appendChild(ft[$]);dt>0&&(this.maskElement.setAttribute("id",bt),this.element.maskedElement.setAttribute(It,"url("+getLocationHref()+"#"+bt+")"),b.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}MaskElement.prototype.getMaskProperty=function(e){return this.viewData[e].prop},MaskElement.prototype.renderFrame=function(e){var i=this.element.finalTransform.mat,c,b=this.masksProperties.length;for(c=0;c<b;c+=1)if((this.viewData[c].prop._mdf||e)&&this.drawPath(this.masksProperties[c],this.viewData[c].prop.v,this.viewData[c]),(this.viewData[c].op._mdf||e)&&this.viewData[c].elem.setAttribute("fill-opacity",this.viewData[c].op.v),this.masksProperties[c].mode!=="n"&&(this.viewData[c].invRect&&(this.element.finalTransform.mProp._mdf||e)&&this.viewData[c].invRect.setAttribute("transform",i.getInverseMatrix().to2dCSS()),this.storedData[c].x&&(this.storedData[c].x._mdf||e))){var $=this.storedData[c].expan;this.storedData[c].x.v<0?(this.storedData[c].lastOperator!=="erode"&&(this.storedData[c].lastOperator="erode",this.storedData[c].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[c].filterId+")")),$.setAttribute("radius",-this.storedData[c].x.v)):(this.storedData[c].lastOperator!=="dilate"&&(this.storedData[c].lastOperator="dilate",this.storedData[c].elem.setAttribute("filter",null)),this.storedData[c].elem.setAttribute("stroke-width",this.storedData[c].x.v*2))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var e="M0,0 ";return e+=" h"+this.globalData.compSize.w,e+=" v"+this.globalData.compSize.h,e+=" h-"+this.globalData.compSize.w,e+=" v-"+this.globalData.compSize.h+" ",e},MaskElement.prototype.drawPath=function(e,i,c){var b=" M"+i.v[0][0]+","+i.v[0][1],$,it;for(it=i._length,$=1;$<it;$+=1)b+=" C"+i.o[$-1][0]+","+i.o[$-1][1]+" "+i.i[$][0]+","+i.i[$][1]+" "+i.v[$][0]+","+i.v[$][1];if(i.c&&it>1&&(b+=" C"+i.o[$-1][0]+","+i.o[$-1][1]+" "+i.i[0][0]+","+i.i[0][1]+" "+i.v[0][0]+","+i.v[0][1]),c.lastPath!==b){var at="";c.elem&&(i.c&&(at=e.inv?this.solidPath+b:b),c.elem.setAttribute("d",at)),c.lastPath=b}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var e={};e.createFilter=i,e.createAlphaToLuminanceFilter=c;function i(b,$){var it=createNS("filter");return it.setAttribute("id",b),$!==!0&&(it.setAttribute("filterUnits","objectBoundingBox"),it.setAttribute("x","0%"),it.setAttribute("y","0%"),it.setAttribute("width","100%"),it.setAttribute("height","100%")),it}function c(){var b=createNS("feColorMatrix");return b.setAttribute("type","matrix"),b.setAttribute("color-interpolation-filters","sRGB"),b.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),b}return e}(),featureSupport=function(){var e={maskType:!0,svgLumaHidden:!0,offscreenCanvas:typeof OffscreenCanvas<"u"};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(e.maskType=!1),/firefox/i.test(navigator.userAgent)&&(e.svgLumaHidden=!1),e}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(e){var i,c="SourceGraphic",b=e.data.ef?e.data.ef.length:0,$=createElementID(),it=filtersFactory.createFilter($,!0),at=0;this.filters=[];var h;for(i=0;i<b;i+=1){h=null;var dt=e.data.ef[i].ty;if(registeredEffects$1[dt]){var ft=registeredEffects$1[dt].effect;h=new ft(it,e.effectsManager.effectElements[i],e,idPrefix+at,c),c=idPrefix+at,registeredEffects$1[dt].countsAsEffect&&(at+=1)}h&&this.filters.push(h)}at&&(e.globalData.defs.appendChild(it),e.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+$+")")),this.filters.length&&e.addRenderableComponent(this)}SVGEffects.prototype.renderFrame=function(e){var i,c=this.filters.length;for(i=0;i<c;i+=1)this.filters[i].renderFrame(e)},SVGEffects.prototype.getEffects=function(e){var i,c=this.filters.length,b=[];for(i=0;i<c;i+=1)this.filters[i].type===e&&b.push(this.filters[i]);return b};function registerEffect$1(e,i,c){registeredEffects$1[e]={effect:i,countsAsEffect:c}}function SVGBaseElement(){}SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var i=null;if(this.data.td){this.matteMasks={};var c=createNS("g");c.setAttribute("id",this.layerId),c.appendChild(this.layerElement),i=c,this.globalData.defs.appendChild(c)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),i=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var b=createNS("clipPath"),$=createNS("path");$.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var it=createElementID();if(b.setAttribute("id",it),b.appendChild($),this.globalData.defs.appendChild(b),this.checkMasks()){var at=createNS("g");at.setAttribute("clip-path","url("+getLocationHref()+"#"+it+")"),at.appendChild(this.layerElement),this.transformedElement=at,i?i.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+it+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(i){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[i]){var c=this.layerId+"_"+i,b,$,it,at;if(i===1||i===3){var h=createNS("mask");h.setAttribute("id",c),h.setAttribute("mask-type",i===3?"luminance":"alpha"),it=createNS("use"),it.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),h.appendChild(it),this.globalData.defs.appendChild(h),!featureSupport.maskType&&i===1&&(h.setAttribute("mask-type","luminance"),b=createElementID(),$=filtersFactory.createFilter(b),this.globalData.defs.appendChild($),$.appendChild(filtersFactory.createAlphaToLuminanceFilter()),at=createNS("g"),at.appendChild(it),h.appendChild(at),at.setAttribute("filter","url("+getLocationHref()+"#"+b+")"))}else if(i===2){var dt=createNS("mask");dt.setAttribute("id",c),dt.setAttribute("mask-type","alpha");var ft=createNS("g");dt.appendChild(ft),b=createElementID(),$=filtersFactory.createFilter(b);var xt=createNS("feComponentTransfer");xt.setAttribute("in","SourceGraphic"),$.appendChild(xt);var Ct=createNS("feFuncA");Ct.setAttribute("type","table"),Ct.setAttribute("tableValues","1.0 0.0"),xt.appendChild(Ct),this.globalData.defs.appendChild($);var bt=createNS("rect");bt.setAttribute("width",this.comp.data.w),bt.setAttribute("height",this.comp.data.h),bt.setAttribute("x","0"),bt.setAttribute("y","0"),bt.setAttribute("fill","#ffffff"),bt.setAttribute("opacity","0"),ft.setAttribute("filter","url("+getLocationHref()+"#"+b+")"),ft.appendChild(bt),it=createNS("use"),it.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),ft.appendChild(it),featureSupport.maskType||(dt.setAttribute("mask-type","luminance"),$.appendChild(filtersFactory.createAlphaToLuminanceFilter()),at=createNS("g"),ft.appendChild(bt),at.appendChild(this.layerElement),ft.appendChild(at)),this.globalData.defs.appendChild(dt)}this.matteMasks[i]=c}return this.matteMasks[i]},setMatte:function(i){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+i+")")}};function HierarchyElement(){}HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(i){this.hierarchy=i},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}};function RenderableDOMElement(){}(function(){var e={initElement:function(c,b,$){this.initFrame(),this.initBaseData(c,b,$),this.initTransform(c,b,$),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){if(!this.hidden&&(!this.isInRange||this.isTransparent)){var c=this.baseElement||this.layerElement;c.style.display="none",this.hidden=!0}},show:function(){if(this.isInRange&&!this.isTransparent){if(!this.data.hd){var c=this.baseElement||this.layerElement;c.style.display="block"}this.hidden=!1,this._isFirstFrame=!0}},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(c){this._mdf=!1,this.prepareRenderableFrame(c),this.prepareProperties(c,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}};extendPrototype([RenderableElement,createProxyFunction(e)],RenderableDOMElement)})();function IImageElement(e,i,c){this.assetData=i.getAssetData(e.refId),this.assetData&&this.assetData.sid&&(this.assetData=i.slotManager.getProp(this.assetData)),this.initElement(e,i,c),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect};function ProcessedElement(e,i){this.elem=e,this.pos=i}function IShapeElement(){}IShapeElement.prototype={addShapeToModifiers:function(i){var c,b=this.shapeModifiers.length;for(c=0;c<b;c+=1)this.shapeModifiers[c].addShape(i)},isShapeInAnimatedModifiers:function(i){for(var c=0,b=this.shapeModifiers.length;c<b;)if(this.shapeModifiers[c].isAnimatedWithShape(i))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var i,c=this.shapes.length;for(i=0;i<c;i+=1)this.shapes[i].sh.reset();c=this.shapeModifiers.length;var b;for(i=c-1;i>=0&&(b=this.shapeModifiers[i].processShapes(this._isFirstFrame),!b);i-=1);}},searchProcessedElement:function(i){for(var c=this.processedElements,b=0,$=c.length;b<$;){if(c[b].elem===i)return c[b].pos;b+=1}return 0},addProcessedElement:function(i,c){for(var b=this.processedElements,$=b.length;$;)if($-=1,b[$].elem===i){b[$].pos=c;return}b.push(new ProcessedElement(i,c))},prepareFrame:function(i){this.prepareRenderableFrame(i),this.prepareProperties(i,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(e,i,c){this.caches=[],this.styles=[],this.transformers=e,this.lStr="",this.sh=c,this.lvl=i,this._isAnimated=!!c.k;for(var b=0,$=e.length;b<$;){if(e[b].mProps.dynamicProperties.length){this._isAnimated=!0;break}b+=1}}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0};function SVGStyleData(e,i){this.data=e,this.type=e.ty,this.d="",this.lvl=i,this._mdf=!1,this.closed=e.hd===!0,this.pElem=createNS("path"),this.msElem=null}SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1};function DashProperty(e,i,c,b){this.elem=e,this.frameId=-1,this.dataProps=createSizedArray(i.length),this.renderer=c,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",i.length?i.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(b);var $,it=i.length||0,at;for($=0;$<it;$+=1)at=PropertyFactory.getProp(e,i[$].v,0,0,this),this.k=at.k||this.k,this.dataProps[$]={n:i[$].n,p:at};this.k||this.getValue(!0),this._isAnimated=this.k}DashProperty.prototype.getValue=function(e){if(!(this.elem.globalData.frameId===this.frameId&&!e)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||e,this._mdf)){var i=0,c=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),i=0;i<c;i+=1)this.dataProps[i].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[i].p.v:this.dashArray[i]=this.dataProps[i].p.v:this.dashoffset[0]=this.dataProps[i].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty);function SVGStrokeStyleData(e,i,c){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.w=PropertyFactory.getProp(e,i.w,0,null,this),this.d=new DashProperty(e,i.d||{},"svg",this),this.c=PropertyFactory.getProp(e,i.c,1,255,this),this.style=c,this._isAnimated=!!this._isAnimated}extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData);function SVGFillStyleData(e,i,c){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.c=PropertyFactory.getProp(e,i.c,1,255,this),this.style=c}extendPrototype([DynamicPropertyContainer],SVGFillStyleData);function SVGNoStyleData(e,i,c){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.style=c}extendPrototype([DynamicPropertyContainer],SVGNoStyleData);function GradientProperty(e,i,c){this.data=i,this.c=createTypedArray("uint8c",i.p*4);var b=i.k.k[0].s?i.k.k[0].s.length-i.p*4:i.k.k.length-i.p*4;this.o=createTypedArray("float32",b),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=b,this.initDynamicPropertyContainer(c),this.prop=PropertyFactory.getProp(e,i.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}GradientProperty.prototype.comparePoints=function(e,i){for(var c=0,b=this.o.length/2,$;c<b;){if($=Math.abs(e[c*4]-e[i*4+c*2]),$>.01)return!1;c+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var e=0,i=this.data.k.k.length;e<i;){if(!this.comparePoints(this.data.k.k[e].s,this.data.p))return!1;e+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(e){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||e){var i,c=this.data.p*4,b,$;for(i=0;i<c;i+=1)b=i%4===0?100:255,$=Math.round(this.prop.v[i]*b),this.c[i]!==$&&(this.c[i]=$,this._cmdf=!e);if(this.o.length)for(c=this.prop.v.length,i=this.data.p*4;i<c;i+=1)b=i%2===0?100:1,$=i%2===0?Math.round(this.prop.v[i]*100):this.prop.v[i],this.o[i-this.data.p*4]!==$&&(this.o[i-this.data.p*4]=$,this._omdf=!e);this._mdf=!e}},extendPrototype([DynamicPropertyContainer],GradientProperty);function SVGGradientFillStyleData(e,i,c){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.initGradientData(e,i,c)}SVGGradientFillStyleData.prototype.initGradientData=function(e,i,c){this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.s=PropertyFactory.getProp(e,i.s,1,null,this),this.e=PropertyFactory.getProp(e,i.e,1,null,this),this.h=PropertyFactory.getProp(e,i.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(e,i.a||{k:0},0,degToRads,this),this.g=new GradientProperty(e,i.g,this),this.style=c,this.stops=[],this.setGradientData(c.pElem,i),this.setGradientOpacity(i,c),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(e,i){var c=createElementID(),b=createNS(i.t===1?"linearGradient":"radialGradient");b.setAttribute("id",c),b.setAttribute("spreadMethod","pad"),b.setAttribute("gradientUnits","userSpaceOnUse");var $=[],it,at,h;for(h=i.g.p*4,at=0;at<h;at+=4)it=createNS("stop"),b.appendChild(it),$.push(it);e.setAttribute(i.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+c+")"),this.gf=b,this.cst=$},SVGGradientFillStyleData.prototype.setGradientOpacity=function(e,i){if(this.g._hasOpacity&&!this.g._collapsable){var c,b,$,it=createNS("mask"),at=createNS("path");it.appendChild(at);var h=createElementID(),dt=createElementID();it.setAttribute("id",dt);var ft=createNS(e.t===1?"linearGradient":"radialGradient");ft.setAttribute("id",h),ft.setAttribute("spreadMethod","pad"),ft.setAttribute("gradientUnits","userSpaceOnUse"),$=e.g.k.k[0].s?e.g.k.k[0].s.length:e.g.k.k.length;var xt=this.stops;for(b=e.g.p*4;b<$;b+=2)c=createNS("stop"),c.setAttribute("stop-color","rgb(255,255,255)"),ft.appendChild(c),xt.push(c);at.setAttribute(e.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+h+")"),e.ty==="gs"&&(at.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),at.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),e.lj===1&&at.setAttribute("stroke-miterlimit",e.ml)),this.of=ft,this.ms=it,this.ost=xt,this.maskId=dt,i.msElem=at}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData);function SVGGradientStrokeStyleData(e,i,c){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(e,i.w,0,null,this),this.d=new DashProperty(e,i.d||{},"svg",this),this.initGradientData(e,i,c),this._isAnimated=!!this._isAnimated}extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(e,i,c){this.transform={mProps:e,op:i,container:c},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}var buildShapeString=function(i,c,b,$){if(c===0)return"";var it=i.o,at=i.i,h=i.v,dt,ft=" M"+$.applyToPointStringified(h[0][0],h[0][1]);for(dt=1;dt<c;dt+=1)ft+=" C"+$.applyToPointStringified(it[dt-1][0],it[dt-1][1])+" "+$.applyToPointStringified(at[dt][0],at[dt][1])+" "+$.applyToPointStringified(h[dt][0],h[dt][1]);return b&&c&&(ft+=" C"+$.applyToPointStringified(it[dt-1][0],it[dt-1][1])+" "+$.applyToPointStringified(at[0][0],at[0][1])+" "+$.applyToPointStringified(h[0][0],h[0][1]),ft+="z"),ft},SVGElementsRenderer=function(){var e=new Matrix,i=new Matrix,c={createRenderFunction:b};function b(Ct){switch(Ct.ty){case"fl":return h;case"gf":return ft;case"gs":return dt;case"st":return xt;case"sh":case"el":case"rc":case"sr":return at;case"tr":return $;case"no":return it;default:return null}}function $(Ct,bt,kt){(kt||bt.transform.op._mdf)&&bt.transform.container.setAttribute("opacity",bt.transform.op.v),(kt||bt.transform.mProps._mdf)&&bt.transform.container.setAttribute("transform",bt.transform.mProps.v.to2dCSS())}function it(){}function at(Ct,bt,kt){var Dt,At,Bt,Tt,It,St,jt=bt.styles.length,Ht=bt.lvl,Kt,ir,nr,kr;for(St=0;St<jt;St+=1){if(Tt=bt.sh._mdf||kt,bt.styles[St].lvl<Ht){for(ir=i.reset(),nr=Ht-bt.styles[St].lvl,kr=bt.transformers.length-1;!Tt&&nr>0;)Tt=bt.transformers[kr].mProps._mdf||Tt,nr-=1,kr-=1;if(Tt)for(nr=Ht-bt.styles[St].lvl,kr=bt.transformers.length-1;nr>0;)ir.multiply(bt.transformers[kr].mProps.v),nr-=1,kr-=1}else ir=e;if(Kt=bt.sh.paths,At=Kt._length,Tt){for(Bt="",Dt=0;Dt<At;Dt+=1)It=Kt.shapes[Dt],It&&It._length&&(Bt+=buildShapeString(It,It._length,It.c,ir));bt.caches[St]=Bt}else Bt=bt.caches[St];bt.styles[St].d+=Ct.hd===!0?"":Bt,bt.styles[St]._mdf=Tt||bt.styles[St]._mdf}}function h(Ct,bt,kt){var Dt=bt.style;(bt.c._mdf||kt)&&Dt.pElem.setAttribute("fill","rgb("+bmFloor(bt.c.v[0])+","+bmFloor(bt.c.v[1])+","+bmFloor(bt.c.v[2])+")"),(bt.o._mdf||kt)&&Dt.pElem.setAttribute("fill-opacity",bt.o.v)}function dt(Ct,bt,kt){ft(Ct,bt,kt),xt(Ct,bt,kt)}function ft(Ct,bt,kt){var Dt=bt.gf,At=bt.g._hasOpacity,Bt=bt.s.v,Tt=bt.e.v;if(bt.o._mdf||kt){var It=Ct.ty==="gf"?"fill-opacity":"stroke-opacity";bt.style.pElem.setAttribute(It,bt.o.v)}if(bt.s._mdf||kt){var St=Ct.t===1?"x1":"cx",jt=St==="x1"?"y1":"cy";Dt.setAttribute(St,Bt[0]),Dt.setAttribute(jt,Bt[1]),At&&!bt.g._collapsable&&(bt.of.setAttribute(St,Bt[0]),bt.of.setAttribute(jt,Bt[1]))}var Ht,Kt,ir,nr;if(bt.g._cmdf||kt){Ht=bt.cst;var kr=bt.g.c;for(ir=Ht.length,Kt=0;Kt<ir;Kt+=1)nr=Ht[Kt],nr.setAttribute("offset",kr[Kt*4]+"%"),nr.setAttribute("stop-color","rgb("+kr[Kt*4+1]+","+kr[Kt*4+2]+","+kr[Kt*4+3]+")")}if(At&&(bt.g._omdf||kt)){var br=bt.g.o;for(bt.g._collapsable?Ht=bt.cst:Ht=bt.ost,ir=Ht.length,Kt=0;Kt<ir;Kt+=1)nr=Ht[Kt],bt.g._collapsable||nr.setAttribute("offset",br[Kt*2]+"%"),nr.setAttribute("stop-opacity",br[Kt*2+1])}if(Ct.t===1)(bt.e._mdf||kt)&&(Dt.setAttribute("x2",Tt[0]),Dt.setAttribute("y2",Tt[1]),At&&!bt.g._collapsable&&(bt.of.setAttribute("x2",Tt[0]),bt.of.setAttribute("y2",Tt[1])));else{var Sr;if((bt.s._mdf||bt.e._mdf||kt)&&(Sr=Math.sqrt(Math.pow(Bt[0]-Tt[0],2)+Math.pow(Bt[1]-Tt[1],2)),Dt.setAttribute("r",Sr),At&&!bt.g._collapsable&&bt.of.setAttribute("r",Sr)),bt.s._mdf||bt.e._mdf||bt.h._mdf||bt.a._mdf||kt){Sr||(Sr=Math.sqrt(Math.pow(Bt[0]-Tt[0],2)+Math.pow(Bt[1]-Tt[1],2)));var $r=Math.atan2(Tt[1]-Bt[1],Tt[0]-Bt[0]),rn=bt.h.v;rn>=1?rn=.99:rn<=-1&&(rn=-.99);var Zr=Sr*rn,Kr=Math.cos($r+bt.a.v)*Zr+Bt[0],Xt=Math.sin($r+bt.a.v)*Zr+Bt[1];Dt.setAttribute("fx",Kr),Dt.setAttribute("fy",Xt),At&&!bt.g._collapsable&&(bt.of.setAttribute("fx",Kr),bt.of.setAttribute("fy",Xt))}}}function xt(Ct,bt,kt){var Dt=bt.style,At=bt.d;At&&(At._mdf||kt)&&At.dashStr&&(Dt.pElem.setAttribute("stroke-dasharray",At.dashStr),Dt.pElem.setAttribute("stroke-dashoffset",At.dashoffset[0])),bt.c&&(bt.c._mdf||kt)&&Dt.pElem.setAttribute("stroke","rgb("+bmFloor(bt.c.v[0])+","+bmFloor(bt.c.v[1])+","+bmFloor(bt.c.v[2])+")"),(bt.o._mdf||kt)&&Dt.pElem.setAttribute("stroke-opacity",bt.o.v),(bt.w._mdf||kt)&&(Dt.pElem.setAttribute("stroke-width",bt.w.v),Dt.msElem&&Dt.msElem.setAttribute("stroke-width",bt.w.v))}return c}();function SVGShapeElement(e,i,c){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(e,i,c),this.prevViewData=[]}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var e,i=this.shapes.length,c,b,$=this.stylesList.length,it,at=[],h=!1;for(b=0;b<$;b+=1){for(it=this.stylesList[b],h=!1,at.length=0,e=0;e<i;e+=1)c=this.shapes[e],c.styles.indexOf(it)!==-1&&(at.push(c),h=c._isAnimated||h);at.length>1&&h&&this.setShapesAsAnimated(at)}},SVGShapeElement.prototype.setShapesAsAnimated=function(e){var i,c=e.length;for(i=0;i<c;i+=1)e[i].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(e,i){var c,b=new SVGStyleData(e,i),$=b.pElem;if(e.ty==="st")c=new SVGStrokeStyleData(this,e,b);else if(e.ty==="fl")c=new SVGFillStyleData(this,e,b);else if(e.ty==="gf"||e.ty==="gs"){var it=e.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;c=new it(this,e,b),this.globalData.defs.appendChild(c.gf),c.maskId&&(this.globalData.defs.appendChild(c.ms),this.globalData.defs.appendChild(c.of),$.setAttribute("mask","url("+getLocationHref()+"#"+c.maskId+")"))}else e.ty==="no"&&(c=new SVGNoStyleData(this,e,b));return(e.ty==="st"||e.ty==="gs")&&($.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),$.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),$.setAttribute("fill-opacity","0"),e.lj===1&&$.setAttribute("stroke-miterlimit",e.ml)),e.r===2&&$.setAttribute("fill-rule","evenodd"),e.ln&&$.setAttribute("id",e.ln),e.cl&&$.setAttribute("class",e.cl),e.bm&&($.style["mix-blend-mode"]=getBlendMode(e.bm)),this.stylesList.push(b),this.addToAnimatedContents(e,c),c},SVGShapeElement.prototype.createGroupElement=function(e){var i=new ShapeGroupData;return e.ln&&i.gr.setAttribute("id",e.ln),e.cl&&i.gr.setAttribute("class",e.cl),e.bm&&(i.gr.style["mix-blend-mode"]=getBlendMode(e.bm)),i},SVGShapeElement.prototype.createTransformElement=function(e,i){var c=TransformPropertyFactory.getTransformProperty(this,e,this),b=new SVGTransformData(c,c.o,i);return this.addToAnimatedContents(e,b),b},SVGShapeElement.prototype.createShapeElement=function(e,i,c){var b=4;e.ty==="rc"?b=5:e.ty==="el"?b=6:e.ty==="sr"&&(b=7);var $=ShapePropertyFactory.getShapeProp(this,e,b,this),it=new SVGShapeData(i,c,$);return this.shapes.push(it),this.addShapeToModifiers(it),this.addToAnimatedContents(e,it),it},SVGShapeElement.prototype.addToAnimatedContents=function(e,i){for(var c=0,b=this.animatedContents.length;c<b;){if(this.animatedContents[c].element===i)return;c+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(e),element:i,data:e})},SVGShapeElement.prototype.setElementStyles=function(e){var i=e.styles,c,b=this.stylesList.length;for(c=0;c<b;c+=1)i.indexOf(this.stylesList[c])===-1&&!this.stylesList[c].closed&&i.push(this.stylesList[c])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,i=this.itemsData.length;for(e=0;e<i;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),i=this.dynamicProperties.length,e=0;e<i;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(e,i,c,b,$,it,at){var h=[].concat(it),dt,ft=e.length-1,xt,Ct,bt=[],kt=[],Dt,At,Bt;for(dt=ft;dt>=0;dt-=1){if(Bt=this.searchProcessedElement(e[dt]),Bt?i[dt]=c[Bt-1]:e[dt]._render=at,e[dt].ty==="fl"||e[dt].ty==="st"||e[dt].ty==="gf"||e[dt].ty==="gs"||e[dt].ty==="no")Bt?i[dt].style.closed=e[dt].hd:i[dt]=this.createStyleElement(e[dt],$),e[dt]._render&&i[dt].style.pElem.parentNode!==b&&b.appendChild(i[dt].style.pElem),bt.push(i[dt].style);else if(e[dt].ty==="gr"){if(!Bt)i[dt]=this.createGroupElement(e[dt]);else for(Ct=i[dt].it.length,xt=0;xt<Ct;xt+=1)i[dt].prevViewData[xt]=i[dt].it[xt];this.searchShapes(e[dt].it,i[dt].it,i[dt].prevViewData,i[dt].gr,$+1,h,at),e[dt]._render&&i[dt].gr.parentNode!==b&&b.appendChild(i[dt].gr)}else e[dt].ty==="tr"?(Bt||(i[dt]=this.createTransformElement(e[dt],b)),Dt=i[dt].transform,h.push(Dt)):e[dt].ty==="sh"||e[dt].ty==="rc"||e[dt].ty==="el"||e[dt].ty==="sr"?(Bt||(i[dt]=this.createShapeElement(e[dt],h,$)),this.setElementStyles(i[dt])):e[dt].ty==="tm"||e[dt].ty==="rd"||e[dt].ty==="ms"||e[dt].ty==="pb"||e[dt].ty==="zz"||e[dt].ty==="op"?(Bt?(At=i[dt],At.closed=!1):(At=ShapeModifiers.getModifier(e[dt].ty),At.init(this,e[dt]),i[dt]=At,this.shapeModifiers.push(At)),kt.push(At)):e[dt].ty==="rp"&&(Bt?(At=i[dt],At.closed=!0):(At=ShapeModifiers.getModifier(e[dt].ty),i[dt]=At,At.init(this,e,dt,i),this.shapeModifiers.push(At),at=!1),kt.push(At));this.addProcessedElement(e[dt],dt+1)}for(ft=bt.length,dt=0;dt<ft;dt+=1)bt[dt].closed=!0;for(ft=kt.length,dt=0;dt<ft;dt+=1)kt[dt].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var e,i=this.stylesList.length;for(e=0;e<i;e+=1)this.stylesList[e].reset();for(this.renderShape(),e=0;e<i;e+=1)(this.stylesList[e]._mdf||this._isFirstFrame)&&(this.stylesList[e].msElem&&(this.stylesList[e].msElem.setAttribute("d",this.stylesList[e].d),this.stylesList[e].d="M0 0"+this.stylesList[e].d),this.stylesList[e].pElem.setAttribute("d",this.stylesList[e].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var e,i=this.animatedContents.length,c;for(e=0;e<i;e+=1)c=this.animatedContents[e],(this._isFirstFrame||c.element._isAnimated)&&c.data!==!0&&c.fn(c.data,c.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null};function LetterProps(e,i,c,b,$,it){this.o=e,this.sw=i,this.sc=c,this.fc=b,this.m=$,this.p=it,this._mdf={o:!0,sw:!!i,sc:!!c,fc:!!b,m:!0,p:!0}}LetterProps.prototype.update=function(e,i,c,b,$,it){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var at=!1;return this.o!==e&&(this.o=e,this._mdf.o=!0,at=!0),this.sw!==i&&(this.sw=i,this._mdf.sw=!0,at=!0),this.sc!==c&&(this.sc=c,this._mdf.sc=!0,at=!0),this.fc!==b&&(this.fc=b,this._mdf.fc=!0,at=!0),this.m!==$&&(this.m=$,this._mdf.m=!0,at=!0),it.length&&(this.p[0]!==it[0]||this.p[1]!==it[1]||this.p[4]!==it[4]||this.p[5]!==it[5]||this.p[12]!==it[12]||this.p[13]!==it[13])&&(this.p=it,this._mdf.p=!0,at=!0),at};function TextProperty(e,i){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,i.d&&i.d.sid&&(i.d=e.globalData.slotManager.getProp(i.d)),this.data=i,this.elem=e,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(e,i){for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(e[c]=i[c]);return e},TextProperty.prototype.setCurrentData=function(e){e.__complete||this.completeTextData(e),this.currentData=e,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(e){this.effectsSequence.push(e),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(e){if(!((this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)&&!e)){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var i=this.currentData,c=this.keysIndex;if(this.lock){this.setCurrentData(this.currentData);return}this.lock=!0,this._mdf=!1;var b,$=this.effectsSequence.length,it=e||this.data.d.k[this.keysIndex].s;for(b=0;b<$;b+=1)c!==this.keysIndex?it=this.effectsSequence[b](it,it.t):it=this.effectsSequence[b](this.currentData,it.t);i!==it&&this.setCurrentData(it),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}},TextProperty.prototype.getKeyframeValue=function(){for(var e=this.data.d.k,i=this.elem.comp.renderedFrame,c=0,b=e.length;c<=b-1&&!(c===b-1||e[c+1].t>i);)c+=1;return this.keysIndex!==c&&(this.keysIndex=c),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(e){for(var i=[],c=0,b=e.length,$,it,at=!1,h=!1,dt="";c<b;)at=h,h=!1,$=e.charCodeAt(c),dt=e.charAt(c),FontManager.isCombinedCharacter($)?at=!0:$>=55296&&$<=56319?FontManager.isRegionalFlag(e,c)?dt=e.substr(c,14):(it=e.charCodeAt(c+1),it>=56320&&it<=57343&&(FontManager.isModifier($,it)?(dt=e.substr(c,2),at=!0):FontManager.isFlagEmoji(e.substr(c,4))?dt=e.substr(c,4):dt=e.substr(c,2))):$>56319?(it=e.charCodeAt(c+1),FontManager.isVariationSelector($)&&(at=!0)):FontManager.isZeroWidthJoiner($)&&(at=!0,h=!0),at?(i[i.length-1]+=dt,at=!1):i.push(dt),c+=dt.length;return i},TextProperty.prototype.completeTextData=function(e){e.__complete=!0;var i=this.elem.globalData.fontManager,c=this.data,b=[],$,it,at,h=0,dt,ft=c.m.g,xt=0,Ct=0,bt=0,kt=[],Dt=0,At=0,Bt,Tt,It=i.getFontByName(e.f),St,jt=0,Ht=getFontProperties(It);e.fWeight=Ht.weight,e.fStyle=Ht.style,e.finalSize=e.s,e.finalText=this.buildFinalText(e.t),it=e.finalText.length,e.finalLineHeight=e.lh;var Kt=e.tr/1e3*e.finalSize,ir;if(e.sz)for(var nr=!0,kr=e.sz[0],br=e.sz[1],Sr,$r;nr;){$r=this.buildFinalText(e.t),Sr=0,Dt=0,it=$r.length,Kt=e.tr/1e3*e.finalSize;var rn=-1;for($=0;$<it;$+=1)ir=$r[$].charCodeAt(0),at=!1,$r[$]===" "?rn=$:(ir===13||ir===3)&&(Dt=0,at=!0,Sr+=e.finalLineHeight||e.finalSize*1.2),i.chars?(St=i.getCharData($r[$],It.fStyle,It.fFamily),jt=at?0:St.w*e.finalSize/100):jt=i.measureText($r[$],e.f,e.finalSize),Dt+jt>kr&&$r[$]!==" "?(rn===-1?it+=1:$=rn,Sr+=e.finalLineHeight||e.finalSize*1.2,$r.splice($,rn===$?1:0,"\r"),rn=-1,Dt=0):(Dt+=jt,Dt+=Kt);Sr+=It.ascent*e.finalSize/100,this.canResize&&e.finalSize>this.minimumFontSize&&br<Sr?(e.finalSize-=1,e.finalLineHeight=e.finalSize*e.lh/e.s):(e.finalText=$r,it=e.finalText.length,nr=!1)}Dt=-Kt,jt=0;var Zr=0,Kr;for($=0;$<it;$+=1)if(at=!1,Kr=e.finalText[$],ir=Kr.charCodeAt(0),ir===13||ir===3?(Zr=0,kt.push(Dt),At=Dt>At?Dt:At,Dt=-2*Kt,dt="",at=!0,bt+=1):dt=Kr,i.chars?(St=i.getCharData(Kr,It.fStyle,i.getFontByName(e.f).fFamily),jt=at?0:St.w*e.finalSize/100):jt=i.measureText(dt,e.f,e.finalSize),Kr===" "?Zr+=jt+Kt:(Dt+=jt+Kt+Zr,Zr=0),b.push({l:jt,an:jt,add:xt,n:at,anIndexes:[],val:dt,line:bt,animatorJustifyOffset:0}),ft==2){if(xt+=jt,dt===""||dt===" "||$===it-1){for((dt===""||dt===" ")&&(xt-=jt);Ct<=$;)b[Ct].an=xt,b[Ct].ind=h,b[Ct].extra=jt,Ct+=1;h+=1,xt=0}}else if(ft==3){if(xt+=jt,dt===""||$===it-1){for(dt===""&&(xt-=jt);Ct<=$;)b[Ct].an=xt,b[Ct].ind=h,b[Ct].extra=jt,Ct+=1;xt=0,h+=1}}else b[h].ind=h,b[h].extra=0,h+=1;if(e.l=b,At=Dt>At?Dt:At,kt.push(Dt),e.sz)e.boxWidth=e.sz[0],e.justifyOffset=0;else switch(e.boxWidth=At,e.j){case 1:e.justifyOffset=-e.boxWidth;break;case 2:e.justifyOffset=-e.boxWidth/2;break;default:e.justifyOffset=0}e.lineWidths=kt;var Xt=c.a,mr,Ut;Tt=Xt.length;var Jt,Or,Cr=[];for(Bt=0;Bt<Tt;Bt+=1){for(mr=Xt[Bt],mr.a.sc&&(e.strokeColorAnim=!0),mr.a.sw&&(e.strokeWidthAnim=!0),(mr.a.fc||mr.a.fh||mr.a.fs||mr.a.fb)&&(e.fillColorAnim=!0),Or=0,Jt=mr.s.b,$=0;$<it;$+=1)Ut=b[$],Ut.anIndexes[Bt]=Or,(Jt==1&&Ut.val!==""||Jt==2&&Ut.val!==""&&Ut.val!==" "||Jt==3&&(Ut.n||Ut.val==" "||$==it-1)||Jt==4&&(Ut.n||$==it-1))&&(mr.s.rn===1&&Cr.push(Or),Or+=1);c.a[Bt].s.totalChars=Or;var pn=-1,On;if(mr.s.rn===1)for($=0;$<it;$+=1)Ut=b[$],pn!=Ut.anIndexes[Bt]&&(pn=Ut.anIndexes[Bt],On=Cr.splice(Math.floor(Math.random()*Cr.length),1)[0]),Ut.anIndexes[Bt]=On}e.yOffset=e.finalLineHeight||e.finalSize*1.2,e.ls=e.ls||0,e.ascent=It.ascent*e.finalSize/100},TextProperty.prototype.updateDocumentData=function(e,i){i=i===void 0?this.keysIndex:i;var c=this.copyData({},this.data.d.k[i].s);c=this.copyData(c,e),this.data.d.k[i].s=c,this.recalculate(i),this.setCurrentData(c),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(e){var i=this.data.d.k[e].s;i.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(i)},TextProperty.prototype.canResizeFont=function(e){this.canResize=e,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(e){this.minimumFontSize=Math.floor(e)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var e=Math.max,i=Math.min,c=Math.floor;function b(it,at){this._currentTextLength=-1,this.k=!1,this.data=at,this.elem=it,this.comp=it.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(it),this.s=PropertyFactory.getProp(it,at.s||{k:0},0,0,this),"e"in at?this.e=PropertyFactory.getProp(it,at.e,0,0,this):this.e={v:100},this.o=PropertyFactory.getProp(it,at.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(it,at.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(it,at.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(it,at.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(it,at.a,0,.01,this),this.dynamicProperties.length||this.getValue()}b.prototype={getMult:function(at){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var h=0,dt=0,ft=1,xt=1;this.ne.v>0?h=this.ne.v/100:dt=-this.ne.v/100,this.xe.v>0?ft=1-this.xe.v/100:xt=1+this.xe.v/100;var Ct=BezierFactory.getBezierEasing(h,dt,ft,xt).get,bt=0,kt=this.finalS,Dt=this.finalE,At=this.data.sh;if(At===2)Dt===kt?bt=at>=Dt?1:0:bt=e(0,i(.5/(Dt-kt)+(at-kt)/(Dt-kt),1)),bt=Ct(bt);else if(At===3)Dt===kt?bt=at>=Dt?0:1:bt=1-e(0,i(.5/(Dt-kt)+(at-kt)/(Dt-kt),1)),bt=Ct(bt);else if(At===4)Dt===kt?bt=0:(bt=e(0,i(.5/(Dt-kt)+(at-kt)/(Dt-kt),1)),bt<.5?bt*=2:bt=1-2*(bt-.5)),bt=Ct(bt);else if(At===5){if(Dt===kt)bt=0;else{var Bt=Dt-kt;at=i(e(0,at+.5-kt),Dt-kt);var Tt=-Bt/2+at,It=Bt/2;bt=Math.sqrt(1-Tt*Tt/(It*It))}bt=Ct(bt)}else At===6?(Dt===kt?bt=0:(at=i(e(0,at+.5-kt),Dt-kt),bt=(1+Math.cos(Math.PI+Math.PI*2*at/(Dt-kt)))/2),bt=Ct(bt)):(at>=c(kt)&&(at-kt<0?bt=e(0,i(i(Dt,1)-(kt-at),1)):bt=e(0,i(Dt-at,1))),bt=Ct(bt));if(this.sm.v!==100){var St=this.sm.v*.01;St===0&&(St=1e-8);var jt=.5-St*.5;bt<jt?bt=0:(bt=(bt-jt)/St,bt>1&&(bt=1))}return bt*this.a.v},getValue:function(at){this.iterateDynamicProperties(),this._mdf=at||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,at&&this.data.r===2&&(this.e.v=this._currentTextLength);var h=this.data.r===2?1:100/this.data.totalChars,dt=this.o.v/h,ft=this.s.v/h+dt,xt=this.e.v/h+dt;if(ft>xt){var Ct=ft;ft=xt,xt=Ct}this.finalS=ft,this.finalE=xt}},extendPrototype([DynamicPropertyContainer],b);function $(it,at,h){return new b(it,at)}return{getTextSelectorProp:$}}();function TextAnimatorDataProperty(e,i,c){var b={propType:!1},$=PropertyFactory.getProp,it=i.a;this.a={r:it.r?$(e,it.r,0,degToRads,c):b,rx:it.rx?$(e,it.rx,0,degToRads,c):b,ry:it.ry?$(e,it.ry,0,degToRads,c):b,sk:it.sk?$(e,it.sk,0,degToRads,c):b,sa:it.sa?$(e,it.sa,0,degToRads,c):b,s:it.s?$(e,it.s,1,.01,c):b,a:it.a?$(e,it.a,1,0,c):b,o:it.o?$(e,it.o,0,.01,c):b,p:it.p?$(e,it.p,1,0,c):b,sw:it.sw?$(e,it.sw,0,0,c):b,sc:it.sc?$(e,it.sc,1,0,c):b,fc:it.fc?$(e,it.fc,1,0,c):b,fh:it.fh?$(e,it.fh,0,0,c):b,fs:it.fs?$(e,it.fs,0,.01,c):b,fb:it.fb?$(e,it.fb,0,.01,c):b,t:it.t?$(e,it.t,0,0,c):b},this.s=TextSelectorProp.getTextSelectorProp(e,i.s,c),this.s.t=i.s.t}function TextAnimatorProperty(e,i,c){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=e,this._renderType=i,this._elem=c,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(c)}TextAnimatorProperty.prototype.searchProperties=function(){var e,i=this._textData.a.length,c,b=PropertyFactory.getProp;for(e=0;e<i;e+=1)c=this._textData.a[e],this._animatorsData[e]=new TextAnimatorDataProperty(this._elem,c,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:b(this._elem,this._textData.p.a,0,0,this),f:b(this._elem,this._textData.p.f,0,0,this),l:b(this._elem,this._textData.p.l,0,0,this),r:b(this._elem,this._textData.p.r,0,0,this),p:b(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=b(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(e,i){if(this.lettersChangedFlag=i,!(!this._mdf&&!this._isFirstFrame&&!i&&(!this._hasMaskedPath||!this._pathData.m._mdf))){this._isFirstFrame=!1;var c=this._moreOptions.alignment.v,b=this._animatorsData,$=this._textData,it=this.mHelper,at=this._renderType,h=this.renderedLetters.length,dt,ft,xt,Ct,bt=e.l,kt,Dt,At,Bt,Tt,It,St,jt,Ht,Kt,ir,nr,kr,br,Sr;if(this._hasMaskedPath){if(Sr=this._pathData.m,!this._pathData.n||this._pathData._mdf){var $r=Sr.v;this._pathData.r.v&&($r=$r.reverse()),kt={tLength:0,segments:[]},Ct=$r._length-1;var rn;for(nr=0,xt=0;xt<Ct;xt+=1)rn=bez.buildBezierData($r.v[xt],$r.v[xt+1],[$r.o[xt][0]-$r.v[xt][0],$r.o[xt][1]-$r.v[xt][1]],[$r.i[xt+1][0]-$r.v[xt+1][0],$r.i[xt+1][1]-$r.v[xt+1][1]]),kt.tLength+=rn.segmentLength,kt.segments.push(rn),nr+=rn.segmentLength;xt=Ct,Sr.v.c&&(rn=bez.buildBezierData($r.v[xt],$r.v[0],[$r.o[xt][0]-$r.v[xt][0],$r.o[xt][1]-$r.v[xt][1]],[$r.i[0][0]-$r.v[0][0],$r.i[0][1]-$r.v[0][1]]),kt.tLength+=rn.segmentLength,kt.segments.push(rn),nr+=rn.segmentLength),this._pathData.pi=kt}if(kt=this._pathData.pi,Dt=this._pathData.f.v,St=0,It=1,Bt=0,Tt=!0,Kt=kt.segments,Dt<0&&Sr.v.c)for(kt.tLength<Math.abs(Dt)&&(Dt=-Math.abs(Dt)%kt.tLength),St=Kt.length-1,Ht=Kt[St].points,It=Ht.length-1;Dt<0;)Dt+=Ht[It].partialLength,It-=1,It<0&&(St-=1,Ht=Kt[St].points,It=Ht.length-1);Ht=Kt[St].points,jt=Ht[It-1],At=Ht[It],ir=At.partialLength}Ct=bt.length,dt=0,ft=0;var Zr=e.finalSize*1.2*.714,Kr=!0,Xt,mr,Ut,Jt,Or;Jt=b.length;var Cr,pn=-1,On,Zn,As,ss=Dt,Ls=St,$s=It,vo=-1,Vs,bo,Po,ws,Jn,Hs,El,Xo,_l="",Io=this.defaultPropsArray,Pl;if(e.j===2||e.j===1){var Uo=0,Fl=0,Vl=e.j===2?-.5:-1,_a=0,Xl=!0;for(xt=0;xt<Ct;xt+=1)if(bt[xt].n){for(Uo&&(Uo+=Fl);_a<xt;)bt[_a].animatorJustifyOffset=Uo,_a+=1;Uo=0,Xl=!0}else{for(Ut=0;Ut<Jt;Ut+=1)Xt=b[Ut].a,Xt.t.propType&&(Xl&&e.j===2&&(Fl+=Xt.t.v*Vl),mr=b[Ut].s,Cr=mr.getMult(bt[xt].anIndexes[Ut],$.a[Ut].s.totalChars),Cr.length?Uo+=Xt.t.v*Cr[0]*Vl:Uo+=Xt.t.v*Cr*Vl);Xl=!1}for(Uo&&(Uo+=Fl);_a<xt;)bt[_a].animatorJustifyOffset=Uo,_a+=1}for(xt=0;xt<Ct;xt+=1){if(it.reset(),Vs=1,bt[xt].n)dt=0,ft+=e.yOffset,ft+=Kr?1:0,Dt=ss,Kr=!1,this._hasMaskedPath&&(St=Ls,It=$s,Ht=Kt[St].points,jt=Ht[It-1],At=Ht[It],ir=At.partialLength,Bt=0),_l="",Xo="",Hs="",Pl="",Io=this.defaultPropsArray;else{if(this._hasMaskedPath){if(vo!==bt[xt].line){switch(e.j){case 1:Dt+=nr-e.lineWidths[bt[xt].line];break;case 2:Dt+=(nr-e.lineWidths[bt[xt].line])/2;break}vo=bt[xt].line}pn!==bt[xt].ind&&(bt[pn]&&(Dt+=bt[pn].extra),Dt+=bt[xt].an/2,pn=bt[xt].ind),Dt+=c[0]*bt[xt].an*.005;var Go=0;for(Ut=0;Ut<Jt;Ut+=1)Xt=b[Ut].a,Xt.p.propType&&(mr=b[Ut].s,Cr=mr.getMult(bt[xt].anIndexes[Ut],$.a[Ut].s.totalChars),Cr.length?Go+=Xt.p.v[0]*Cr[0]:Go+=Xt.p.v[0]*Cr),Xt.a.propType&&(mr=b[Ut].s,Cr=mr.getMult(bt[xt].anIndexes[Ut],$.a[Ut].s.totalChars),Cr.length?Go+=Xt.a.v[0]*Cr[0]:Go+=Xt.a.v[0]*Cr);for(Tt=!0,this._pathData.a.v&&(Dt=bt[0].an*.5+(nr-this._pathData.f.v-bt[0].an*.5-bt[bt.length-1].an*.5)*pn/(Ct-1),Dt+=this._pathData.f.v);Tt;)Bt+ir>=Dt+Go||!Ht?(kr=(Dt+Go-Bt)/At.partialLength,Zn=jt.point[0]+(At.point[0]-jt.point[0])*kr,As=jt.point[1]+(At.point[1]-jt.point[1])*kr,it.translate(-c[0]*bt[xt].an*.005,-(c[1]*Zr)*.01),Tt=!1):Ht&&(Bt+=At.partialLength,It+=1,It>=Ht.length&&(It=0,St+=1,Kt[St]?Ht=Kt[St].points:Sr.v.c?(It=0,St=0,Ht=Kt[St].points):(Bt-=At.partialLength,Ht=null)),Ht&&(jt=At,At=Ht[It],ir=At.partialLength));On=bt[xt].an/2-bt[xt].add,it.translate(-On,0,0)}else On=bt[xt].an/2-bt[xt].add,it.translate(-On,0,0),it.translate(-c[0]*bt[xt].an*.005,-c[1]*Zr*.01,0);for(Ut=0;Ut<Jt;Ut+=1)Xt=b[Ut].a,Xt.t.propType&&(mr=b[Ut].s,Cr=mr.getMult(bt[xt].anIndexes[Ut],$.a[Ut].s.totalChars),(dt!==0||e.j!==0)&&(this._hasMaskedPath?Cr.length?Dt+=Xt.t.v*Cr[0]:Dt+=Xt.t.v*Cr:Cr.length?dt+=Xt.t.v*Cr[0]:dt+=Xt.t.v*Cr));for(e.strokeWidthAnim&&(Po=e.sw||0),e.strokeColorAnim&&(e.sc?bo=[e.sc[0],e.sc[1],e.sc[2]]:bo=[0,0,0]),e.fillColorAnim&&e.fc&&(ws=[e.fc[0],e.fc[1],e.fc[2]]),Ut=0;Ut<Jt;Ut+=1)Xt=b[Ut].a,Xt.a.propType&&(mr=b[Ut].s,Cr=mr.getMult(bt[xt].anIndexes[Ut],$.a[Ut].s.totalChars),Cr.length?it.translate(-Xt.a.v[0]*Cr[0],-Xt.a.v[1]*Cr[1],Xt.a.v[2]*Cr[2]):it.translate(-Xt.a.v[0]*Cr,-Xt.a.v[1]*Cr,Xt.a.v[2]*Cr));for(Ut=0;Ut<Jt;Ut+=1)Xt=b[Ut].a,Xt.s.propType&&(mr=b[Ut].s,Cr=mr.getMult(bt[xt].anIndexes[Ut],$.a[Ut].s.totalChars),Cr.length?it.scale(1+(Xt.s.v[0]-1)*Cr[0],1+(Xt.s.v[1]-1)*Cr[1],1):it.scale(1+(Xt.s.v[0]-1)*Cr,1+(Xt.s.v[1]-1)*Cr,1));for(Ut=0;Ut<Jt;Ut+=1){if(Xt=b[Ut].a,mr=b[Ut].s,Cr=mr.getMult(bt[xt].anIndexes[Ut],$.a[Ut].s.totalChars),Xt.sk.propType&&(Cr.length?it.skewFromAxis(-Xt.sk.v*Cr[0],Xt.sa.v*Cr[1]):it.skewFromAxis(-Xt.sk.v*Cr,Xt.sa.v*Cr)),Xt.r.propType&&(Cr.length?it.rotateZ(-Xt.r.v*Cr[2]):it.rotateZ(-Xt.r.v*Cr)),Xt.ry.propType&&(Cr.length?it.rotateY(Xt.ry.v*Cr[1]):it.rotateY(Xt.ry.v*Cr)),Xt.rx.propType&&(Cr.length?it.rotateX(Xt.rx.v*Cr[0]):it.rotateX(Xt.rx.v*Cr)),Xt.o.propType&&(Cr.length?Vs+=(Xt.o.v*Cr[0]-Vs)*Cr[0]:Vs+=(Xt.o.v*Cr-Vs)*Cr),e.strokeWidthAnim&&Xt.sw.propType&&(Cr.length?Po+=Xt.sw.v*Cr[0]:Po+=Xt.sw.v*Cr),e.strokeColorAnim&&Xt.sc.propType)for(Jn=0;Jn<3;Jn+=1)Cr.length?bo[Jn]+=(Xt.sc.v[Jn]-bo[Jn])*Cr[0]:bo[Jn]+=(Xt.sc.v[Jn]-bo[Jn])*Cr;if(e.fillColorAnim&&e.fc){if(Xt.fc.propType)for(Jn=0;Jn<3;Jn+=1)Cr.length?ws[Jn]+=(Xt.fc.v[Jn]-ws[Jn])*Cr[0]:ws[Jn]+=(Xt.fc.v[Jn]-ws[Jn])*Cr;Xt.fh.propType&&(Cr.length?ws=addHueToRGB(ws,Xt.fh.v*Cr[0]):ws=addHueToRGB(ws,Xt.fh.v*Cr)),Xt.fs.propType&&(Cr.length?ws=addSaturationToRGB(ws,Xt.fs.v*Cr[0]):ws=addSaturationToRGB(ws,Xt.fs.v*Cr)),Xt.fb.propType&&(Cr.length?ws=addBrightnessToRGB(ws,Xt.fb.v*Cr[0]):ws=addBrightnessToRGB(ws,Xt.fb.v*Cr))}}for(Ut=0;Ut<Jt;Ut+=1)Xt=b[Ut].a,Xt.p.propType&&(mr=b[Ut].s,Cr=mr.getMult(bt[xt].anIndexes[Ut],$.a[Ut].s.totalChars),this._hasMaskedPath?Cr.length?it.translate(0,Xt.p.v[1]*Cr[0],-Xt.p.v[2]*Cr[1]):it.translate(0,Xt.p.v[1]*Cr,-Xt.p.v[2]*Cr):Cr.length?it.translate(Xt.p.v[0]*Cr[0],Xt.p.v[1]*Cr[1],-Xt.p.v[2]*Cr[2]):it.translate(Xt.p.v[0]*Cr,Xt.p.v[1]*Cr,-Xt.p.v[2]*Cr));if(e.strokeWidthAnim&&(Hs=Po<0?0:Po),e.strokeColorAnim&&(El="rgb("+Math.round(bo[0]*255)+","+Math.round(bo[1]*255)+","+Math.round(bo[2]*255)+")"),e.fillColorAnim&&e.fc&&(Xo="rgb("+Math.round(ws[0]*255)+","+Math.round(ws[1]*255)+","+Math.round(ws[2]*255)+")"),this._hasMaskedPath){if(it.translate(0,-e.ls),it.translate(0,c[1]*Zr*.01+ft,0),this._pathData.p.v){br=(At.point[1]-jt.point[1])/(At.point[0]-jt.point[0]);var xl=Math.atan(br)*180/Math.PI;At.point[0]<jt.point[0]&&(xl+=180),it.rotate(-xl*Math.PI/180)}it.translate(Zn,As,0),Dt-=c[0]*bt[xt].an*.005,bt[xt+1]&&pn!==bt[xt+1].ind&&(Dt+=bt[xt].an/2,Dt+=e.tr*.001*e.finalSize)}else{switch(it.translate(dt,ft,0),e.ps&&it.translate(e.ps[0],e.ps[1]+e.ascent,0),e.j){case 1:it.translate(bt[xt].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[bt[xt].line]),0,0);break;case 2:it.translate(bt[xt].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[bt[xt].line])/2,0,0);break}it.translate(0,-e.ls),it.translate(On,0,0),it.translate(c[0]*bt[xt].an*.005,c[1]*Zr*.01,0),dt+=bt[xt].l+e.tr*.001*e.finalSize}at==="html"?_l=it.toCSS():at==="svg"?_l=it.to2dCSS():Io=[it.props[0],it.props[1],it.props[2],it.props[3],it.props[4],it.props[5],it.props[6],it.props[7],it.props[8],it.props[9],it.props[10],it.props[11],it.props[12],it.props[13],it.props[14],it.props[15]],Pl=Vs}h<=xt?(Or=new LetterProps(Pl,Hs,El,Xo,_l,Io),this.renderedLetters.push(Or),h+=1,this.lettersChangedFlag=!0):(Or=this.renderedLetters[xt],this.lettersChangedFlag=Or.update(Pl,Hs,El,Xo,_l,Io)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty);function ITextElement(){}ITextElement.prototype.initElement=function(e,i,c){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(e,i,c),this.textProperty=new TextProperty(this,e.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(e.t,this.renderType,this),this.initTransform(e,i,c),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)},ITextElement.prototype.createPathShape=function(e,i){var c,b=i.length,$,it="";for(c=0;c<b;c+=1)i[c].ty==="sh"&&($=i[c].ks.k,it+=buildShapeString($,$.i.length,!0,e));return it},ITextElement.prototype.updateDocumentData=function(e,i){this.textProperty.updateDocumentData(e,i)},ITextElement.prototype.canResizeFont=function(e){this.textProperty.canResizeFont(e)},ITextElement.prototype.setMinimumFontSize=function(e){this.textProperty.setMinimumFontSize(e)},ITextElement.prototype.applyTextPropertiesToMatrix=function(e,i,c,b,$){switch(e.ps&&i.translate(e.ps[0],e.ps[1]+e.ascent,0),i.translate(0,-e.ls,0),e.j){case 1:i.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[c]),0,0);break;case 2:i.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[c])/2,0,0);break}i.translate(b,$,0)},ITextElement.prototype.buildColor=function(e){return"rgb("+Math.round(e[0]*255)+","+Math.round(e[1]*255)+","+Math.round(e[2]*255)+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(e,i,c){this.textSpans=[],this.renderType="svg",this.initElement(e,i,c)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(e){for(var i=0,c=e.length,b=[],$="";i<c;)e[i]===String.fromCharCode(13)||e[i]===String.fromCharCode(3)?(b.push($),$=""):$+=e[i],i+=1;return b.push($),b},SVGTextLottieElement.prototype.buildShapeData=function(e,i){if(e.shapes&&e.shapes.length){var c=e.shapes[0];if(c.it){var b=c.it[c.it.length-1];b.s&&(b.s.k[0]=i,b.s.k[1]=i)}}return e},SVGTextLottieElement.prototype.buildNewText=function(){this.addDynamicProperty(this);var e,i,c=this.textProperty.currentData;this.renderedLetters=createSizedArray(c?c.l.length:0),c.fc?this.layerElement.setAttribute("fill",this.buildColor(c.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),c.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(c.sc)),this.layerElement.setAttribute("stroke-width",c.sw)),this.layerElement.setAttribute("font-size",c.finalSize);var b=this.globalData.fontManager.getFontByName(c.f);if(b.fClass)this.layerElement.setAttribute("class",b.fClass);else{this.layerElement.setAttribute("font-family",b.fFamily);var $=c.fWeight,it=c.fStyle;this.layerElement.setAttribute("font-style",it),this.layerElement.setAttribute("font-weight",$)}this.layerElement.setAttribute("aria-label",c.t);var at=c.l||[],h=!!this.globalData.fontManager.chars;i=at.length;var dt,ft=this.mHelper,xt="",Ct=this.data.singleShape,bt=0,kt=0,Dt=!0,At=c.tr*.001*c.finalSize;if(Ct&&!h&&!c.sz){var Bt=this.textContainer,Tt="start";switch(c.j){case 1:Tt="end";break;case 2:Tt="middle";break;default:Tt="start";break}Bt.setAttribute("text-anchor",Tt),Bt.setAttribute("letter-spacing",At);var It=this.buildTextContents(c.finalText);for(i=It.length,kt=c.ps?c.ps[1]+c.ascent:0,e=0;e<i;e+=1)dt=this.textSpans[e].span||createNS("tspan"),dt.textContent=It[e],dt.setAttribute("x",0),dt.setAttribute("y",kt),dt.style.display="inherit",Bt.appendChild(dt),this.textSpans[e]||(this.textSpans[e]={span:null,glyph:null}),this.textSpans[e].span=dt,kt+=c.finalLineHeight;this.layerElement.appendChild(Bt)}else{var St=this.textSpans.length,jt;for(e=0;e<i;e+=1){if(this.textSpans[e]||(this.textSpans[e]={span:null,childSpan:null,glyph:null}),!h||!Ct||e===0){if(dt=St>e?this.textSpans[e].span:createNS(h?"g":"text"),St<=e){if(dt.setAttribute("stroke-linecap","butt"),dt.setAttribute("stroke-linejoin","round"),dt.setAttribute("stroke-miterlimit","4"),this.textSpans[e].span=dt,h){var Ht=createNS("g");dt.appendChild(Ht),this.textSpans[e].childSpan=Ht}this.textSpans[e].span=dt,this.layerElement.appendChild(dt)}dt.style.display="inherit"}if(ft.reset(),Ct&&(at[e].n&&(bt=-At,kt+=c.yOffset,kt+=Dt?1:0,Dt=!1),this.applyTextPropertiesToMatrix(c,ft,at[e].line,bt,kt),bt+=at[e].l||0,bt+=At),h){jt=this.globalData.fontManager.getCharData(c.finalText[e],b.fStyle,this.globalData.fontManager.getFontByName(c.f).fFamily);var Kt;if(jt.t===1)Kt=new SVGCompElement(jt.data,this.globalData,this);else{var ir=emptyShapeData;jt.data&&jt.data.shapes&&(ir=this.buildShapeData(jt.data,c.finalSize)),Kt=new SVGShapeElement(ir,this.globalData,this)}if(this.textSpans[e].glyph){var nr=this.textSpans[e].glyph;this.textSpans[e].childSpan.removeChild(nr.layerElement),nr.destroy()}this.textSpans[e].glyph=Kt,Kt._debug=!0,Kt.prepareFrame(0),Kt.renderFrame(),this.textSpans[e].childSpan.appendChild(Kt.layerElement),jt.t===1&&this.textSpans[e].childSpan.setAttribute("transform","scale("+c.finalSize/100+","+c.finalSize/100+")")}else Ct&&dt.setAttribute("transform","translate("+ft.props[12]+","+ft.props[13]+")"),dt.textContent=at[e].val,dt.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}Ct&&dt&&dt.setAttribute("d",xt)}for(;e<this.textSpans.length;)this.textSpans[e].span.style.display="none",e+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var e=this.layerElement.getBBox();this.bbox={top:e.y,left:e.x,width:e.width,height:e.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var e,i=this.textSpans.length,c;for(this.renderedFrame=this.comp.renderedFrame,e=0;e<i;e+=1)c=this.textSpans[e].glyph,c&&(c.prepareFrame(this.comp.renderedFrame-this.data.st),c._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){this._sizeChanged=!0;var e,i,c=this.textAnimator.renderedLetters,b=this.textProperty.currentData.l;i=b.length;var $,it,at;for(e=0;e<i;e+=1)b[e].n||($=c[e],it=this.textSpans[e].span,at=this.textSpans[e].glyph,at&&at.renderFrame(),$._mdf.m&&it.setAttribute("transform",$.m),$._mdf.o&&it.setAttribute("opacity",$.o),$._mdf.sw&&it.setAttribute("stroke-width",$.sw),$._mdf.sc&&it.setAttribute("stroke",$.sc),$._mdf.fc&&it.setAttribute("fill",$.fc))}};function ISolidElement(e,i,c){this.initElement(e,i,c)}extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var e=createNS("rect");e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.layerElement.appendChild(e)};function NullElement(e,i,c){this.initFrame(),this.initBaseData(e,i,c),this.initFrame(),this.initTransform(e,i,c),this.initHierarchy()}NullElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement);function SVGRendererBase(){}extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(e){return new NullElement(e,this.globalData,this)},SVGRendererBase.prototype.createShape=function(e){return new SVGShapeElement(e,this.globalData,this)},SVGRendererBase.prototype.createText=function(e){return new SVGTextLottieElement(e,this.globalData,this)},SVGRendererBase.prototype.createImage=function(e){return new IImageElement(e,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(e){return new ISolidElement(e,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(e){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+e.w+" "+e.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",e.w),this.svgElement.setAttribute("height",e.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var i=this.globalData.defs;this.setupGlobalData(e,i),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=e;var c=createNS("clipPath"),b=createNS("rect");b.setAttribute("width",e.w),b.setAttribute("height",e.h),b.setAttribute("x",0),b.setAttribute("y",0);var $=createElementID();c.setAttribute("id",$),c.appendChild(b),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+$+")"),i.appendChild(c),this.layers=e.layers,this.elements=createSizedArray(e.layers.length)},SVGRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var e,i=this.layers?this.layers.length:0;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(e){var i=0,c=this.layers.length;for(i=0;i<c;i+=1)if(this.layers[i].ind===e)return i;return-1},SVGRendererBase.prototype.buildItem=function(e){var i=this.elements;if(!(i[e]||this.layers[e].ty===99)){i[e]=!0;var c=this.createItem(this.layers[e]);if(i[e]=c,getExpressionsPlugin()&&(this.layers[e].ty===0&&this.globalData.projectInterface.registerComposition(c),c.initExpressions()),this.appendElementInPos(c,e),this.layers[e].tt){var b="tp"in this.layers[e]?this.findIndexByInd(this.layers[e].tp):e-1;if(b===-1)return;if(!this.elements[b]||this.elements[b]===!0)this.buildItem(b),this.addPendingElement(c);else{var $=i[b],it=$.getMatte(this.layers[e].tt);c.setMatte(it)}}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();if(e.checkParenting(),e.data.tt)for(var i=0,c=this.elements.length;i<c;){if(this.elements[i]===e){var b="tp"in e.data?this.findIndexByInd(e.data.tp):i-1,$=this.elements[b],it=$.getMatte(this.layers[i].tt);e.setMatte(it);break}i+=1}}},SVGRendererBase.prototype.renderFrame=function(e){if(!(this.renderedFrame===e||this.destroyed)){e===null?e=this.renderedFrame:this.renderedFrame=e,this.globalData.frameNum=e,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=e,this.globalData._mdf=!1;var i,c=this.layers.length;for(this.completeLayers||this.checkLayers(e),i=c-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].prepareFrame(e-this.layers[i].st);if(this.globalData._mdf)for(i=0;i<c;i+=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(e,i){var c=e.getBaseElement();if(c){for(var b=0,$;b<i;)this.elements[b]&&this.elements[b]!==!0&&this.elements[b].getBaseElement()&&($=this.elements[b].getBaseElement()),b+=1;$?this.layerElement.insertBefore(c,$):this.layerElement.appendChild(c)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"};function ICompElement(){}extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(e,i,c){this.initFrame(),this.initBaseData(e,i,c),this.initTransform(e,i,c),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),(this.data.xt||!i.progressiveLoad)&&this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(e){if(this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),!(!this.isInRange&&!this.data.xt)){if(this.tm._placeholder)this.renderedFrame=e/this.data.sr;else{var i=this.tm.v;i===this.data.op&&(i=this.data.op-1),this.renderedFrame=i}var c,b=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),c=b-1;c>=0;c-=1)(this.completeLayers||this.elements[c])&&(this.elements[c].prepareFrame(this.renderedFrame-this.layers[c].st),this.elements[c]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},ICompElement.prototype.setElements=function(e){this.elements=e},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()};function SVGCompElement(e,i,c){this.layers=e.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,i,c),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function SVGRenderer(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var c="";if(i&&i.title){var b=createNS("title"),$=createElementID();b.setAttribute("id",$),b.textContent=i.title,this.svgElement.appendChild(b),c+=$}if(i&&i.description){var it=createNS("desc"),at=createElementID();it.setAttribute("id",at),it.textContent=i.description,this.svgElement.appendChild(it),c+=" "+at}c&&this.svgElement.setAttribute("aria-labelledby",c);var h=createNS("defs");this.svgElement.appendChild(h);var dt=createNS("g");this.svgElement.appendChild(dt),this.layerElement=dt,this.renderConfig={preserveAspectRatio:i&&i.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:i&&i.contentVisibility||"visible",progressiveLoad:i&&i.progressiveLoad||!1,hideOnTransparent:!(i&&i.hideOnTransparent===!1),viewBoxOnly:i&&i.viewBoxOnly||!1,viewBoxSize:i&&i.viewBoxSize||!1,className:i&&i.className||"",id:i&&i.id||"",focusable:i&&i.focusable,filterSize:{width:i&&i.filterSize&&i.filterSize.width||"100%",height:i&&i.filterSize&&i.filterSize.height||"100%",x:i&&i.filterSize&&i.filterSize.x||"0%",y:i&&i.filterSize&&i.filterSize.y||"0%"},width:i&&i.width,height:i&&i.height,runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:h,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}ShapeTransformManager.prototype={addTransformSequence:function(i){var c,b=i.length,$="_";for(c=0;c<b;c+=1)$+=i[c].transform.key+"_";var it=this.sequences[$];return it||(it={transforms:[].concat(i),finalTransform:new Matrix,_mdf:!1},this.sequences[$]=it,this.sequenceList.push(it)),it},processSequence:function(i,c){for(var b=0,$=i.transforms.length,it=c;b<$&&!c;){if(i.transforms[b].transform.mProps._mdf){it=!0;break}b+=1}if(it)for(i.finalTransform.reset(),b=$-1;b>=0;b-=1)i.finalTransform.multiply(i.transforms[b].transform.mProps.v);i._mdf=it},processSequences:function(i){var c,b=this.sequenceList.length;for(c=0;c<b;c+=1)this.processSequence(this.sequenceList[c],i)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var i="__lottie_element_luma_buffer",c=null,b=null,$=null;function it(){var dt=createNS("svg"),ft=createNS("filter"),xt=createNS("feColorMatrix");return ft.setAttribute("id",i),xt.setAttribute("type","matrix"),xt.setAttribute("color-interpolation-filters","sRGB"),xt.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),ft.appendChild(xt),dt.appendChild(ft),dt.setAttribute("id",i+"_svg"),featureSupport.svgLumaHidden&&(dt.style.display="none"),dt}function at(){c||($=it(),document.body.appendChild($),c=createTag("canvas"),b=c.getContext("2d"),b.filter="url(#"+i+")",b.fillStyle="rgba(0,0,0,0)",b.fillRect(0,0,1,1))}function h(dt){return c||at(),c.width=dt.width,c.height=dt.height,b.filter="url(#"+i+")",c}return{load:at,get:h}};function createCanvas(e,i){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(e,i);var c=createTag("canvas");return c.width=e,c.height=i,c}var assetLoader=function(){return{loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas}}(),registeredEffects={};function CVEffects(e){var i,c=e.data.ef?e.data.ef.length:0;this.filters=[];var b;for(i=0;i<c;i+=1){b=null;var $=e.data.ef[i].ty;if(registeredEffects[$]){var it=registeredEffects[$].effect;b=new it(e.effectsManager.effectElements[i],e)}b&&this.filters.push(b)}this.filters.length&&e.addRenderableComponent(this)}CVEffects.prototype.renderFrame=function(e){var i,c=this.filters.length;for(i=0;i<c;i+=1)this.filters[i].renderFrame(e)},CVEffects.prototype.getEffects=function(e){var i,c=this.filters.length,b=[];for(i=0;i<c;i+=1)this.filters[i].type===e&&b.push(this.filters[i]);return b};function registerEffect(e,i){registeredEffects[e]={effect:i}}function CVMaskElement(e,i){this.data=e,this.element=i,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var c,b=this.masksProperties.length,$=!1;for(c=0;c<b;c+=1)this.masksProperties[c].mode!=="n"&&($=!0),this.viewData[c]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[c],3);this.hasMasks=$,$&&this.element.addRenderableComponent(this)}CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var e=this.element.finalTransform.mat,i=this.element.canvasContext,c,b=this.masksProperties.length,$,it,at;for(i.beginPath(),c=0;c<b;c+=1)if(this.masksProperties[c].mode!=="n"){this.masksProperties[c].inv&&(i.moveTo(0,0),i.lineTo(this.element.globalData.compSize.w,0),i.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),i.lineTo(0,this.element.globalData.compSize.h),i.lineTo(0,0)),at=this.viewData[c].v,$=e.applyToPointArray(at.v[0][0],at.v[0][1],0),i.moveTo($[0],$[1]);var h,dt=at._length;for(h=1;h<dt;h+=1)it=e.applyToTriplePoints(at.o[h-1],at.i[h],at.v[h]),i.bezierCurveTo(it[0],it[1],it[2],it[3],it[4],it[5]);it=e.applyToTriplePoints(at.o[h-1],at.i[0],at.v[0]),i.bezierCurveTo(it[0],it[1],it[2],it[3],it[4],it[5])}this.element.globalData.renderer.save(!0),i.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};function CVBaseElement(){}var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var i=this.globalData.canvasContext,c=assetLoader.createCanvas(i.canvas.width,i.canvas.height);this.buffers.push(c);var b=assetLoader.createCanvas(i.canvas.width,i.canvas.height);this.buffers.push(b),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var i=this.globalData;if(i.blendMode!==this.data.bm){i.blendMode=this.data.bm;var c=getBlendMode(this.data.bm);i.canvasContext.globalCompositeOperation=c}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){!this.hidden&&(!this.isInRange||this.isTransparent)&&(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(i){i.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var i=this.buffers[0],c=i.getContext("2d");this.clearCanvas(c),c.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var i=this.buffers[1],c=i.getContext("2d");this.clearCanvas(c),c.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform);var b=this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1);if(b.renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var $=assetLoader.getLumaCanvas(this.canvasContext.canvas),it=$.getContext("2d");it.drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage($,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(i,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(i){if(!(this.hidden||this.data.hd)&&!(this.data.td===1&&!i)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var c=this.data.ty===0;this.prepareLayer(),this.globalData.renderer.save(c),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(c),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement;function CVShapeData(e,i,c,b){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var $=4;i.ty==="rc"?$=5:i.ty==="el"?$=6:i.ty==="sr"&&($=7),this.sh=ShapePropertyFactory.getShapeProp(e,i,$,e);var it,at=c.length,h;for(it=0;it<at;it+=1)c[it].closed||(h={transforms:b.addTransformSequence(c[it].transforms),trNodes:[]},this.styledShapes.push(h),c[it].elements.push(h))}CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated;function CVShapeElement(e,i,c){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(e,i,c)}extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(e,i){var c={data:e,type:e.ty,preTransforms:this.transformsManager.addTransformSequence(i),transforms:[],elements:[],closed:e.hd===!0},b={};if(e.ty==="fl"||e.ty==="st"?(b.c=PropertyFactory.getProp(this,e.c,1,255,this),b.c.k||(c.co="rgb("+bmFloor(b.c.v[0])+","+bmFloor(b.c.v[1])+","+bmFloor(b.c.v[2])+")")):(e.ty==="gf"||e.ty==="gs")&&(b.s=PropertyFactory.getProp(this,e.s,1,null,this),b.e=PropertyFactory.getProp(this,e.e,1,null,this),b.h=PropertyFactory.getProp(this,e.h||{k:0},0,.01,this),b.a=PropertyFactory.getProp(this,e.a||{k:0},0,degToRads,this),b.g=new GradientProperty(this,e.g,this)),b.o=PropertyFactory.getProp(this,e.o,0,.01,this),e.ty==="st"||e.ty==="gs"){if(c.lc=lineCapEnum[e.lc||2],c.lj=lineJoinEnum[e.lj||2],e.lj==1&&(c.ml=e.ml),b.w=PropertyFactory.getProp(this,e.w,0,null,this),b.w.k||(c.wi=b.w.v),e.d){var $=new DashProperty(this,e.d,"canvas",this);b.d=$,b.d.k||(c.da=b.d.dashArray,c.do=b.d.dashoffset[0])}}else c.r=e.r===2?"evenodd":"nonzero";return this.stylesList.push(c),b.style=c,b},CVShapeElement.prototype.createGroupElement=function(){var e={it:[],prevViewData:[]};return e},CVShapeElement.prototype.createTransformElement=function(e){var i={transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,e.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,e,this)}};return i},CVShapeElement.prototype.createShapeElement=function(e){var i=new CVShapeData(this,e,this.stylesList,this.transformsManager);return this.shapes.push(i),this.addShapeToModifiers(i),i},CVShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,i=this.itemsData.length;for(e=0;e<i;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),i=this.dynamicProperties.length,e=0;e<i;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(e){var i,c=this.stylesList.length;for(i=0;i<c;i+=1)this.stylesList[i].closed||this.stylesList[i].transforms.push(e)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var e,i=this.stylesList.length;for(e=0;e<i;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.pop()},CVShapeElement.prototype.closeStyles=function(e){var i,c=e.length;for(i=0;i<c;i+=1)e[i].closed=!0},CVShapeElement.prototype.searchShapes=function(e,i,c,b,$){var it,at=e.length-1,h,dt,ft=[],xt=[],Ct,bt,kt,Dt=[].concat($);for(it=at;it>=0;it-=1){if(Ct=this.searchProcessedElement(e[it]),Ct?i[it]=c[Ct-1]:e[it]._shouldRender=b,e[it].ty==="fl"||e[it].ty==="st"||e[it].ty==="gf"||e[it].ty==="gs")Ct?i[it].style.closed=!1:i[it]=this.createStyleElement(e[it],Dt),ft.push(i[it].style);else if(e[it].ty==="gr"){if(!Ct)i[it]=this.createGroupElement(e[it]);else for(dt=i[it].it.length,h=0;h<dt;h+=1)i[it].prevViewData[h]=i[it].it[h];this.searchShapes(e[it].it,i[it].it,i[it].prevViewData,b,Dt)}else e[it].ty==="tr"?(Ct||(kt=this.createTransformElement(e[it]),i[it]=kt),Dt.push(i[it]),this.addTransformToStyleList(i[it])):e[it].ty==="sh"||e[it].ty==="rc"||e[it].ty==="el"||e[it].ty==="sr"?Ct||(i[it]=this.createShapeElement(e[it])):e[it].ty==="tm"||e[it].ty==="rd"||e[it].ty==="pb"||e[it].ty==="zz"||e[it].ty==="op"?(Ct?(bt=i[it],bt.closed=!1):(bt=ShapeModifiers.getModifier(e[it].ty),bt.init(this,e[it]),i[it]=bt,this.shapeModifiers.push(bt)),xt.push(bt)):e[it].ty==="rp"&&(Ct?(bt=i[it],bt.closed=!0):(bt=ShapeModifiers.getModifier(e[it].ty),i[it]=bt,bt.init(this,e,it,i),this.shapeModifiers.push(bt),b=!1),xt.push(bt));this.addProcessedElement(e[it],it+1)}for(this.removeTransformFromStyleList(),this.closeStyles(ft),at=xt.length,it=0;it<at;it+=1)xt[it].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(e,i){(e._opMdf||i.op._mdf||this._isFirstFrame)&&(i.opacity=e.opacity,i.opacity*=i.op.v,i._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var e,i=this.stylesList.length,c,b,$,it,at,h,dt=this.globalData.renderer,ft=this.globalData.canvasContext,xt,Ct;for(e=0;e<i;e+=1)if(Ct=this.stylesList[e],xt=Ct.type,!((xt==="st"||xt==="gs")&&Ct.wi===0||!Ct.data._shouldRender||Ct.coOp===0||this.globalData.currentGlobalAlpha===0)){for(dt.save(),at=Ct.elements,xt==="st"||xt==="gs"?(dt.ctxStrokeStyle(xt==="st"?Ct.co:Ct.grd),dt.ctxLineWidth(Ct.wi),dt.ctxLineCap(Ct.lc),dt.ctxLineJoin(Ct.lj),dt.ctxMiterLimit(Ct.ml||0)):dt.ctxFillStyle(xt==="fl"?Ct.co:Ct.grd),dt.ctxOpacity(Ct.coOp),xt!=="st"&&xt!=="gs"&&ft.beginPath(),dt.ctxTransform(Ct.preTransforms.finalTransform.props),b=at.length,c=0;c<b;c+=1){for((xt==="st"||xt==="gs")&&(ft.beginPath(),Ct.da&&(ft.setLineDash(Ct.da),ft.lineDashOffset=Ct.do)),h=at[c].trNodes,it=h.length,$=0;$<it;$+=1)h[$].t==="m"?ft.moveTo(h[$].p[0],h[$].p[1]):h[$].t==="c"?ft.bezierCurveTo(h[$].pts[0],h[$].pts[1],h[$].pts[2],h[$].pts[3],h[$].pts[4],h[$].pts[5]):ft.closePath();(xt==="st"||xt==="gs")&&(dt.ctxStroke(),Ct.da&&ft.setLineDash(this.dashResetter))}xt!=="st"&&xt!=="gs"&&this.globalData.renderer.ctxFill(Ct.r),dt.restore()}},CVShapeElement.prototype.renderShape=function(e,i,c,b){var $,it=i.length-1,at;for(at=e,$=it;$>=0;$-=1)i[$].ty==="tr"?(at=c[$].transform,this.renderShapeTransform(e,at)):i[$].ty==="sh"||i[$].ty==="el"||i[$].ty==="rc"||i[$].ty==="sr"?this.renderPath(i[$],c[$]):i[$].ty==="fl"?this.renderFill(i[$],c[$],at):i[$].ty==="st"?this.renderStroke(i[$],c[$],at):i[$].ty==="gf"||i[$].ty==="gs"?this.renderGradientFill(i[$],c[$],at):i[$].ty==="gr"?this.renderShape(at,i[$].it,c[$].it):i[$].ty;b&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(e,i){if(this._isFirstFrame||i._mdf||e.transforms._mdf){var c=e.trNodes,b=i.paths,$,it,at,h=b._length;c.length=0;var dt=e.transforms.finalTransform;for(at=0;at<h;at+=1){var ft=b.shapes[at];if(ft&&ft.v){for(it=ft._length,$=1;$<it;$+=1)$===1&&c.push({t:"m",p:dt.applyToPointArray(ft.v[0][0],ft.v[0][1],0)}),c.push({t:"c",pts:dt.applyToTriplePoints(ft.o[$-1],ft.i[$],ft.v[$])});it===1&&c.push({t:"m",p:dt.applyToPointArray(ft.v[0][0],ft.v[0][1],0)}),ft.c&&it&&(c.push({t:"c",pts:dt.applyToTriplePoints(ft.o[$-1],ft.i[0],ft.v[0])}),c.push({t:"z"}))}}e.trNodes=c}},CVShapeElement.prototype.renderPath=function(e,i){if(e.hd!==!0&&e._shouldRender){var c,b=i.styledShapes.length;for(c=0;c<b;c+=1)this.renderStyledShape(i.styledShapes[c],i.sh)}},CVShapeElement.prototype.renderFill=function(e,i,c){var b=i.style;(i.c._mdf||this._isFirstFrame)&&(b.co="rgb("+bmFloor(i.c.v[0])+","+bmFloor(i.c.v[1])+","+bmFloor(i.c.v[2])+")"),(i.o._mdf||c._opMdf||this._isFirstFrame)&&(b.coOp=i.o.v*c.opacity)},CVShapeElement.prototype.renderGradientFill=function(e,i,c){var b=i.style,$;if(!b.grd||i.g._mdf||i.s._mdf||i.e._mdf||e.t!==1&&(i.h._mdf||i.a._mdf)){var it=this.globalData.canvasContext,at=i.s.v,h=i.e.v;if(e.t===1)$=it.createLinearGradient(at[0],at[1],h[0],h[1]);else{var dt=Math.sqrt(Math.pow(at[0]-h[0],2)+Math.pow(at[1]-h[1],2)),ft=Math.atan2(h[1]-at[1],h[0]-at[0]),xt=i.h.v;xt>=1?xt=.99:xt<=-1&&(xt=-.99);var Ct=dt*xt,bt=Math.cos(ft+i.a.v)*Ct+at[0],kt=Math.sin(ft+i.a.v)*Ct+at[1];$=it.createRadialGradient(bt,kt,0,at[0],at[1],dt)}var Dt,At=e.g.p,Bt=i.g.c,Tt=1;for(Dt=0;Dt<At;Dt+=1)i.g._hasOpacity&&i.g._collapsable&&(Tt=i.g.o[Dt*2+1]),$.addColorStop(Bt[Dt*4]/100,"rgba("+Bt[Dt*4+1]+","+Bt[Dt*4+2]+","+Bt[Dt*4+3]+","+Tt+")");b.grd=$}b.coOp=i.o.v*c.opacity},CVShapeElement.prototype.renderStroke=function(e,i,c){var b=i.style,$=i.d;$&&($._mdf||this._isFirstFrame)&&(b.da=$.dashArray,b.do=$.dashoffset[0]),(i.c._mdf||this._isFirstFrame)&&(b.co="rgb("+bmFloor(i.c.v[0])+","+bmFloor(i.c.v[1])+","+bmFloor(i.c.v[2])+")"),(i.o._mdf||c._opMdf||this._isFirstFrame)&&(b.coOp=i.o.v*c.opacity),(i.w._mdf||this._isFirstFrame)&&(b.wi=i.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0};function CVTextElement(e,i,c){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(e,i,c)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var i=!1;e.fc?(i=!0,this.values.fill=this.buildColor(e.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=i;var c=!1;e.sc&&(c=!0,this.values.stroke=this.buildColor(e.sc),this.values.sWidth=e.sw);var b=this.globalData.fontManager.getFontByName(e.f),$,it,at=e.l,h=this.mHelper;this.stroke=c,this.values.fValue=e.finalSize+"px "+this.globalData.fontManager.getFontByName(e.f).fFamily,it=e.finalText.length;var dt,ft,xt,Ct,bt,kt,Dt,At,Bt,Tt,It=this.data.singleShape,St=e.tr*.001*e.finalSize,jt=0,Ht=0,Kt=!0,ir=0;for($=0;$<it;$+=1){dt=this.globalData.fontManager.getCharData(e.finalText[$],b.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),ft=dt&&dt.data||{},h.reset(),It&&at[$].n&&(jt=-St,Ht+=e.yOffset,Ht+=Kt?1:0,Kt=!1),bt=ft.shapes?ft.shapes[0].it:[],Dt=bt.length,h.scale(e.finalSize/100,e.finalSize/100),It&&this.applyTextPropertiesToMatrix(e,h,at[$].line,jt,Ht),Bt=createSizedArray(Dt-1);var nr=0;for(kt=0;kt<Dt;kt+=1)if(bt[kt].ty==="sh"){for(Ct=bt[kt].ks.k.i.length,At=bt[kt].ks.k,Tt=[],xt=1;xt<Ct;xt+=1)xt===1&&Tt.push(h.applyToX(At.v[0][0],At.v[0][1],0),h.applyToY(At.v[0][0],At.v[0][1],0)),Tt.push(h.applyToX(At.o[xt-1][0],At.o[xt-1][1],0),h.applyToY(At.o[xt-1][0],At.o[xt-1][1],0),h.applyToX(At.i[xt][0],At.i[xt][1],0),h.applyToY(At.i[xt][0],At.i[xt][1],0),h.applyToX(At.v[xt][0],At.v[xt][1],0),h.applyToY(At.v[xt][0],At.v[xt][1],0));Tt.push(h.applyToX(At.o[xt-1][0],At.o[xt-1][1],0),h.applyToY(At.o[xt-1][0],At.o[xt-1][1],0),h.applyToX(At.i[0][0],At.i[0][1],0),h.applyToY(At.i[0][0],At.i[0][1],0),h.applyToX(At.v[0][0],At.v[0][1],0),h.applyToY(At.v[0][0],At.v[0][1],0)),Bt[nr]=Tt,nr+=1}It&&(jt+=at[$].l,jt+=St),this.textSpans[ir]?this.textSpans[ir].elem=Bt:this.textSpans[ir]={elem:Bt},ir+=1}},CVTextElement.prototype.renderInnerContent=function(){this.validateText();var e=this.canvasContext;e.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var i,c,b,$,it,at,h=this.textAnimator.renderedLetters,dt=this.textProperty.currentData.l;c=dt.length;var ft,xt=null,Ct=null,bt=null,kt,Dt,At=this.globalData.renderer;for(i=0;i<c;i+=1)if(!dt[i].n){if(ft=h[i],ft&&(At.save(),At.ctxTransform(ft.p),At.ctxOpacity(ft.o)),this.fill){for(ft&&ft.fc?xt!==ft.fc&&(At.ctxFillStyle(ft.fc),xt=ft.fc):xt!==this.values.fill&&(xt=this.values.fill,At.ctxFillStyle(this.values.fill)),kt=this.textSpans[i].elem,$=kt.length,this.globalData.canvasContext.beginPath(),b=0;b<$;b+=1)for(Dt=kt[b],at=Dt.length,this.globalData.canvasContext.moveTo(Dt[0],Dt[1]),it=2;it<at;it+=6)this.globalData.canvasContext.bezierCurveTo(Dt[it],Dt[it+1],Dt[it+2],Dt[it+3],Dt[it+4],Dt[it+5]);this.globalData.canvasContext.closePath(),At.ctxFill()}if(this.stroke){for(ft&&ft.sw?bt!==ft.sw&&(bt=ft.sw,At.ctxLineWidth(ft.sw)):bt!==this.values.sWidth&&(bt=this.values.sWidth,At.ctxLineWidth(this.values.sWidth)),ft&&ft.sc?Ct!==ft.sc&&(Ct=ft.sc,At.ctxStrokeStyle(ft.sc)):Ct!==this.values.stroke&&(Ct=this.values.stroke,At.ctxStrokeStyle(this.values.stroke)),kt=this.textSpans[i].elem,$=kt.length,this.globalData.canvasContext.beginPath(),b=0;b<$;b+=1)for(Dt=kt[b],at=Dt.length,this.globalData.canvasContext.moveTo(Dt[0],Dt[1]),it=2;it<at;it+=6)this.globalData.canvasContext.bezierCurveTo(Dt[it],Dt[it+1],Dt[it+2],Dt[it+3],Dt[it+4],Dt[it+5]);this.globalData.canvasContext.closePath(),At.ctxStroke()}ft&&this.globalData.renderer.restore()}};function CVImageElement(e,i,c){this.assetData=i.getAssetData(e.refId),this.img=i.imageLoader.getAsset(this.assetData),this.initElement(e,i,c)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var e=createTag("canvas");e.width=this.assetData.w,e.height=this.assetData.h;var i=e.getContext("2d"),c=this.img.width,b=this.img.height,$=c/b,it=this.assetData.w/this.assetData.h,at,h,dt=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;$>it&&dt==="xMidYMid slice"||$<it&&dt!=="xMidYMid slice"?(h=b,at=h*it):(at=c,h=at/it),i.drawImage(this.img,(c-at)/2,(b-h)/2,at,h,0,0,this.assetData.w,this.assetData.h),this.img=e}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null};function CVSolidElement(e,i,c){this.initElement(e,i,c)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)};function CanvasRendererBase(){}extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(e){return new CVShapeElement(e,this.globalData,this)},CanvasRendererBase.prototype.createText=function(e){return new CVTextElement(e,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(e){return new CVImageElement(e,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(e){return new CVSolidElement(e,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(e){e[0]===1&&e[1]===0&&e[4]===0&&e[5]===1&&e[12]===0&&e[13]===0||this.canvasContext.transform(e[0],e[1],e[4],e[5],e[12],e[13])},CanvasRendererBase.prototype.ctxOpacity=function(e){this.canvasContext.globalAlpha*=e<0?0:e},CanvasRendererBase.prototype.ctxFillStyle=function(e){this.canvasContext.fillStyle=e},CanvasRendererBase.prototype.ctxStrokeStyle=function(e){this.canvasContext.strokeStyle=e},CanvasRendererBase.prototype.ctxLineWidth=function(e){this.canvasContext.lineWidth=e},CanvasRendererBase.prototype.ctxLineCap=function(e){this.canvasContext.lineCap=e},CanvasRendererBase.prototype.ctxLineJoin=function(e){this.canvasContext.lineJoin=e},CanvasRendererBase.prototype.ctxMiterLimit=function(e){this.canvasContext.miterLimit=e},CanvasRendererBase.prototype.ctxFill=function(e){this.canvasContext.fill(e)},CanvasRendererBase.prototype.ctxFillRect=function(e,i,c,b){this.canvasContext.fillRect(e,i,c,b)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}this.contextData.reset()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(e){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}e&&(this.globalData.blendMode="source-over"),this.contextData.restore(e)},CanvasRendererBase.prototype.configAnimation=function(e){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var i=this.animationItem.container.style;i.width="100%",i.height="100%";var c="0px 0px 0px";i.transformOrigin=c,i.mozTransformOrigin=c,i.webkitTransformOrigin=c,i["-webkit-transform"]=c,i.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=e,this.layers=e.layers,this.transformCanvas={w:e.w,h:e.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(e,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(e.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(e,i){this.reset();var c,b;e?(c=e,b=i,this.canvasContext.canvas.width=c,this.canvasContext.canvas.height=b):(this.animationItem.wrapper&&this.animationItem.container?(c=this.animationItem.wrapper.offsetWidth,b=this.animationItem.wrapper.offsetHeight):(c=this.canvasContext.canvas.width,b=this.canvasContext.canvas.height),this.canvasContext.canvas.width=c*this.renderConfig.dpr,this.canvasContext.canvas.height=b*this.renderConfig.dpr);var $,it;if(this.renderConfig.preserveAspectRatio.indexOf("meet")!==-1||this.renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var at=this.renderConfig.preserveAspectRatio.split(" "),h=at[1]||"meet",dt=at[0]||"xMidYMid",ft=dt.substr(0,4),xt=dt.substr(4);$=c/b,it=this.transformCanvas.w/this.transformCanvas.h,it>$&&h==="meet"||it<$&&h==="slice"?(this.transformCanvas.sx=c/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=c/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=b/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=b/(this.transformCanvas.h/this.renderConfig.dpr)),ft==="xMid"&&(it<$&&h==="meet"||it>$&&h==="slice")?this.transformCanvas.tx=(c-this.transformCanvas.w*(b/this.transformCanvas.h))/2*this.renderConfig.dpr:ft==="xMax"&&(it<$&&h==="meet"||it>$&&h==="slice")?this.transformCanvas.tx=(c-this.transformCanvas.w*(b/this.transformCanvas.h))*this.renderConfig.dpr:this.transformCanvas.tx=0,xt==="YMid"&&(it>$&&h==="meet"||it<$&&h==="slice")?this.transformCanvas.ty=(b-this.transformCanvas.h*(c/this.transformCanvas.w))/2*this.renderConfig.dpr:xt==="YMax"&&(it>$&&h==="meet"||it<$&&h==="slice")?this.transformCanvas.ty=(b-this.transformCanvas.h*(c/this.transformCanvas.w))*this.renderConfig.dpr:this.transformCanvas.ty=0}else this.renderConfig.preserveAspectRatio==="none"?(this.transformCanvas.sx=c/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=b/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText="");var e,i=this.layers?this.layers.length:0;for(e=i-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(e,i){if(!(this.renderedFrame===e&&this.renderConfig.clearCanvas===!0&&!i||this.destroyed||e===-1)){this.renderedFrame=e,this.globalData.frameNum=e-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||i,this.globalData.projectInterface.currentFrame=e;var c,b=this.layers.length;for(this.completeLayers||this.checkLayers(e),c=b-1;c>=0;c-=1)(this.completeLayers||this.elements[c])&&this.elements[c].prepareFrame(e-this.layers[c].st);if(this.globalData._mdf){for(this.renderConfig.clearCanvas===!0?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),c=b-1;c>=0;c-=1)(this.completeLayers||this.elements[c])&&this.elements[c].renderFrame();this.renderConfig.clearCanvas!==!0&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(e){var i=this.elements;if(!(i[e]||this.layers[e].ty===99)){var c=this.createItem(this.layers[e],this,this.globalData);i[e]=c,c.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"};function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){this.stack=[],this.cArrPos=0,this.cTr=new Matrix;var e,i=15;for(e=0;e<i;e+=1){var c=new CanvasContext;this.stack[e]=c}this._length=i,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}CVContextData.prototype.duplicate=function(){var e=this._length*2,i=0;for(i=this._length;i<e;i+=1)this.stack[i]=new CanvasContext;this._length=e},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(e){this.cArrPos-=1;var i=this.stack[this.cArrPos],c=i.transform,b,$=this.cTr.props;for(b=0;b<16;b+=1)$[b]=c[b];if(e){this.nativeContext.restore();var it=this.stack[this.cArrPos+1];this.appliedFillStyle=it.fillStyle,this.appliedStrokeStyle=it.strokeStyle,this.appliedLineWidth=it.lineWidth,this.appliedLineCap=it.lineCap,this.appliedLineJoin=it.lineJoin,this.appliedMiterLimit=it.miterLimit}this.nativeContext.setTransform(c[0],c[1],c[4],c[5],c[12],c[13]),(e||i.opacity!==-1&&this.currentOpacity!==i.opacity)&&(this.nativeContext.globalAlpha=i.opacity,this.currentOpacity=i.opacity),this.currentFillStyle=i.fillStyle,this.currentStrokeStyle=i.strokeStyle,this.currentLineWidth=i.lineWidth,this.currentLineCap=i.lineCap,this.currentLineJoin=i.lineJoin,this.currentMiterLimit=i.miterLimit},CVContextData.prototype.save=function(e){e&&this.nativeContext.save();var i=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var c=this.stack[this.cArrPos],b;for(b=0;b<16;b+=1)c.transform[b]=i[b];this.cArrPos+=1;var $=this.stack[this.cArrPos];$.opacity=c.opacity,$.fillStyle=c.fillStyle,$.strokeStyle=c.strokeStyle,$.lineWidth=c.lineWidth,$.lineCap=c.lineCap,$.lineJoin=c.lineJoin,$.miterLimit=c.miterLimit},CVContextData.prototype.setOpacity=function(e){this.stack[this.cArrPos].opacity=e},CVContextData.prototype.setContext=function(e){this.nativeContext=e},CVContextData.prototype.fillStyle=function(e){this.stack[this.cArrPos].fillStyle!==e&&(this.currentFillStyle=e,this.stack[this.cArrPos].fillStyle=e)},CVContextData.prototype.strokeStyle=function(e){this.stack[this.cArrPos].strokeStyle!==e&&(this.currentStrokeStyle=e,this.stack[this.cArrPos].strokeStyle=e)},CVContextData.prototype.lineWidth=function(e){this.stack[this.cArrPos].lineWidth!==e&&(this.currentLineWidth=e,this.stack[this.cArrPos].lineWidth=e)},CVContextData.prototype.lineCap=function(e){this.stack[this.cArrPos].lineCap!==e&&(this.currentLineCap=e,this.stack[this.cArrPos].lineCap=e)},CVContextData.prototype.lineJoin=function(e){this.stack[this.cArrPos].lineJoin!==e&&(this.currentLineJoin=e,this.stack[this.cArrPos].lineJoin=e)},CVContextData.prototype.miterLimit=function(e){this.stack[this.cArrPos].miterLimit!==e&&(this.currentMiterLimit=e,this.stack[this.cArrPos].miterLimit=e)},CVContextData.prototype.transform=function(e){this.transformMat.cloneFromProps(e);var i=this.cTr;this.transformMat.multiply(i),i.cloneFromProps(this.transformMat.props);var c=i.props;this.nativeContext.setTransform(c[0],c[1],c[4],c[5],c[12],c[13])},CVContextData.prototype.opacity=function(e){var i=this.stack[this.cArrPos].opacity;i*=e<0?0:e,this.stack[this.cArrPos].opacity!==i&&(this.currentOpacity!==e&&(this.nativeContext.globalAlpha=e,this.currentOpacity=e),this.stack[this.cArrPos].opacity=i)},CVContextData.prototype.fill=function(e){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(e)},CVContextData.prototype.fillRect=function(e,i,c,b){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(e,i,c,b)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()};function CVCompElement(e,i,c){this.completeLayers=!1,this.layers=e.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(e,i,c),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var e=this.canvasContext;e.beginPath(),e.moveTo(0,0),e.lineTo(this.data.w,0),e.lineTo(this.data.w,this.data.h),e.lineTo(0,this.data.h),e.lineTo(0,0),e.clip();var i,c=this.layers.length;for(i=c-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame()},CVCompElement.prototype.destroy=function(){var e,i=this.layers.length;for(e=i-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function CanvasRenderer(e,i){this.animationItem=e,this.renderConfig={clearCanvas:i&&i.clearCanvas!==void 0?i.clearCanvas:!0,context:i&&i.context||null,progressiveLoad:i&&i.progressiveLoad||!1,preserveAspectRatio:i&&i.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:i&&i.contentVisibility||"visible",className:i&&i.className||"",id:i&&i.id||"",runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.renderConfig.dpr=i&&i.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=i&&i.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function HBaseElement(){}HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.bm!==0&&this.setBlendMode()},renderElement:function(){var i=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var c=this.finalTransform.mat.toCSS();i.transform=c,i.webkitTransform=c}this.finalTransform._opMdf&&(i.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting;function HSolidElement(e,i,c){this.initElement(e,i,c)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var e;this.data.hasMask?(e=createNS("rect"),e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):(e=createTag("div"),e.style.width=this.data.sw+"px",e.style.height=this.data.sh+"px",e.style.backgroundColor=this.data.sc),this.layerElement.appendChild(e)};function HShapeElement(e,i,c){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(e,i,c),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var e;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),e=this.svgElement;else{e=createNS("svg");var i=this.comp.data?this.comp.data:this.globalData.compSize;e.setAttribute("width",i.w),e.setAttribute("height",i.h),e.appendChild(this.shapesContainer),this.layerElement.appendChild(e)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=e},HShapeElement.prototype.getTransformedPoint=function(e,i){var c,b=e.length;for(c=0;c<b;c+=1)i=e[c].mProps.v.applyToPointArray(i[0],i[1],0);return i},HShapeElement.prototype.calculateShapeBoundingBox=function(e,i){var c=e.sh.v,b=e.transformers,$,it=c._length,at,h,dt,ft;if(!(it<=1)){for($=0;$<it-1;$+=1)at=this.getTransformedPoint(b,c.v[$]),h=this.getTransformedPoint(b,c.o[$]),dt=this.getTransformedPoint(b,c.i[$+1]),ft=this.getTransformedPoint(b,c.v[$+1]),this.checkBounds(at,h,dt,ft,i);c.c&&(at=this.getTransformedPoint(b,c.v[$]),h=this.getTransformedPoint(b,c.o[$]),dt=this.getTransformedPoint(b,c.i[0]),ft=this.getTransformedPoint(b,c.v[0]),this.checkBounds(at,h,dt,ft,i))}},HShapeElement.prototype.checkBounds=function(e,i,c,b,$){this.getBoundsOfCurve(e,i,c,b);var it=this.shapeBoundingBox;$.x=bmMin(it.left,$.x),$.xMax=bmMax(it.right,$.xMax),$.y=bmMin(it.top,$.y),$.yMax=bmMax(it.bottom,$.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(e,i,c,b){for(var $=[[e[0],b[0]],[e[1],b[1]]],it,at,h,dt,ft,xt,Ct,bt=0;bt<2;++bt)at=6*e[bt]-12*i[bt]+6*c[bt],it=-3*e[bt]+9*i[bt]-9*c[bt]+3*b[bt],h=3*i[bt]-3*e[bt],at|=0,it|=0,h|=0,it===0&&at===0||(it===0?(dt=-h/at,dt>0&&dt<1&&$[bt].push(this.calculateF(dt,e,i,c,b,bt))):(ft=at*at-4*h*it,ft>=0&&(xt=(-at+bmSqrt(ft))/(2*it),xt>0&&xt<1&&$[bt].push(this.calculateF(xt,e,i,c,b,bt)),Ct=(-at-bmSqrt(ft))/(2*it),Ct>0&&Ct<1&&$[bt].push(this.calculateF(Ct,e,i,c,b,bt)))));this.shapeBoundingBox.left=bmMin.apply(null,$[0]),this.shapeBoundingBox.top=bmMin.apply(null,$[1]),this.shapeBoundingBox.right=bmMax.apply(null,$[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,$[1])},HShapeElement.prototype.calculateF=function(e,i,c,b,$,it){return bmPow(1-e,3)*i[it]+3*bmPow(1-e,2)*e*c[it]+3*(1-e)*bmPow(e,2)*b[it]+bmPow(e,3)*$[it]},HShapeElement.prototype.calculateBoundingBox=function(e,i){var c,b=e.length;for(c=0;c<b;c+=1)e[c]&&e[c].sh?this.calculateShapeBoundingBox(e[c],i):e[c]&&e[c].it?this.calculateBoundingBox(e[c].it,i):e[c]&&e[c].style&&e[c].w&&this.expandStrokeBoundingBox(e[c].w,i)},HShapeElement.prototype.expandStrokeBoundingBox=function(e,i){var c=0;if(e.keyframes){for(var b=0;b<e.keyframes.length;b+=1){var $=e.keyframes[b].s;$>c&&(c=$)}c*=e.mult}else c=e.v*e.mult;i.x-=c,i.xMax+=c,i.y-=c,i.yMax+=c},HShapeElement.prototype.currentBoxContains=function(e){return this.currentBBox.x<=e.x&&this.currentBBox.y<=e.y&&this.currentBBox.width+this.currentBBox.x>=e.x+e.width&&this.currentBBox.height+this.currentBBox.y>=e.y+e.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var e=this.tempBoundingBox,i=999999;if(e.x=i,e.xMax=-i,e.y=i,e.yMax=-i,this.calculateBoundingBox(this.itemsData,e),e.width=e.xMax<e.x?0:e.xMax-e.x,e.height=e.yMax<e.y?0:e.yMax-e.y,this.currentBoxContains(e))return;var c=!1;if(this.currentBBox.w!==e.width&&(this.currentBBox.w=e.width,this.shapeCont.setAttribute("width",e.width),c=!0),this.currentBBox.h!==e.height&&(this.currentBBox.h=e.height,this.shapeCont.setAttribute("height",e.height),c=!0),c||this.currentBBox.x!==e.x||this.currentBBox.y!==e.y){this.currentBBox.w=e.width,this.currentBBox.h=e.height,this.currentBBox.x=e.x,this.currentBBox.y=e.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var b=this.shapeCont.style,$="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";b.transform=$,b.webkitTransform=$}}};function HTextElement(e,i,c){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(e,i,c)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var e=createNS("g");this.maskedElement.appendChild(e),this.innerElem=e}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var i=this.innerElem.style,c=e.fc?this.buildColor(e.fc):"rgba(0,0,0,0)";i.fill=c,i.color=c,e.sc&&(i.stroke=this.buildColor(e.sc),i.strokeWidth=e.sw+"px");var b=this.globalData.fontManager.getFontByName(e.f);if(!this.globalData.fontManager.chars)if(i.fontSize=e.finalSize+"px",i.lineHeight=e.finalSize+"px",b.fClass)this.innerElem.className=b.fClass;else{i.fontFamily=b.fFamily;var $=e.fWeight,it=e.fStyle;i.fontStyle=it,i.fontWeight=$}var at,h,dt=e.l;h=dt.length;var ft,xt,Ct,bt=this.mHelper,kt,Dt="",At=0;for(at=0;at<h;at+=1){if(this.globalData.fontManager.chars?(this.textPaths[At]?ft=this.textPaths[At]:(ft=createNS("path"),ft.setAttribute("stroke-linecap",lineCapEnum[1]),ft.setAttribute("stroke-linejoin",lineJoinEnum[2]),ft.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[At]?(xt=this.textSpans[At],Ct=xt.children[0]):(xt=createTag("div"),xt.style.lineHeight=0,Ct=createNS("svg"),Ct.appendChild(ft),styleDiv(xt)))):this.isMasked?ft=this.textPaths[At]?this.textPaths[At]:createNS("text"):this.textSpans[At]?(xt=this.textSpans[At],ft=this.textPaths[At]):(xt=createTag("span"),styleDiv(xt),ft=createTag("span"),styleDiv(ft),xt.appendChild(ft)),this.globalData.fontManager.chars){var Bt=this.globalData.fontManager.getCharData(e.finalText[at],b.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),Tt;if(Bt?Tt=Bt.data:Tt=null,bt.reset(),Tt&&Tt.shapes&&Tt.shapes.length&&(kt=Tt.shapes[0].it,bt.scale(e.finalSize/100,e.finalSize/100),Dt=this.createPathShape(bt,kt),ft.setAttribute("d",Dt)),this.isMasked)this.innerElem.appendChild(ft);else{if(this.innerElem.appendChild(xt),Tt&&Tt.shapes){document.body.appendChild(Ct);var It=Ct.getBBox();Ct.setAttribute("width",It.width+2),Ct.setAttribute("height",It.height+2),Ct.setAttribute("viewBox",It.x-1+" "+(It.y-1)+" "+(It.width+2)+" "+(It.height+2));var St=Ct.style,jt="translate("+(It.x-1)+"px,"+(It.y-1)+"px)";St.transform=jt,St.webkitTransform=jt,dt[at].yOffset=It.y-1}else Ct.setAttribute("width",1),Ct.setAttribute("height",1);xt.appendChild(Ct)}}else if(ft.textContent=dt[at].val,ft.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(ft);else{this.innerElem.appendChild(xt);var Ht=ft.style,Kt="translate3d(0,"+-e.finalSize/1.2+"px,0)";Ht.transform=Kt,Ht.webkitTransform=Kt}this.isMasked?this.textSpans[At]=ft:this.textSpans[At]=xt,this.textSpans[At].style.display="block",this.textPaths[At]=ft,At+=1}for(;At<this.textSpans.length;)this.textSpans[At].style.display="none",At+=1},HTextElement.prototype.renderInnerContent=function(){this.validateText();var e;if(this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),e=this.svgElement.style;var i="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";e.transform=i,e.webkitTransform=i}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),!(!this.lettersChangedFlag&&!this.textAnimator.lettersChangedFlag)){var c,b,$=0,it=this.textAnimator.renderedLetters,at=this.textProperty.currentData.l;b=at.length;var h,dt,ft;for(c=0;c<b;c+=1)at[c].n?$+=1:(dt=this.textSpans[c],ft=this.textPaths[c],h=it[$],$+=1,h._mdf.m&&(this.isMasked?dt.setAttribute("transform",h.m):(dt.style.webkitTransform=h.m,dt.style.transform=h.m)),dt.style.opacity=h.o,h.sw&&h._mdf.sw&&ft.setAttribute("stroke-width",h.sw),h.sc&&h._mdf.sc&&ft.setAttribute("stroke",h.sc),h.fc&&h._mdf.fc&&(ft.setAttribute("fill",h.fc),ft.style.color=h.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var xt=this.innerElem.getBBox();this.currentBBox.w!==xt.width&&(this.currentBBox.w=xt.width,this.svgElement.setAttribute("width",xt.width)),this.currentBBox.h!==xt.height&&(this.currentBBox.h=xt.height,this.svgElement.setAttribute("height",xt.height));var Ct=1;if(this.currentBBox.w!==xt.width+Ct*2||this.currentBBox.h!==xt.height+Ct*2||this.currentBBox.x!==xt.x-Ct||this.currentBBox.y!==xt.y-Ct){this.currentBBox.w=xt.width+Ct*2,this.currentBBox.h=xt.height+Ct*2,this.currentBBox.x=xt.x-Ct,this.currentBBox.y=xt.y-Ct,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),e=this.svgElement.style;var bt="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";e.transform=bt,e.webkitTransform=bt}}}};function HCameraElement(e,i,c){this.initFrame(),this.initBaseData(e,i,c),this.initHierarchy();var b=PropertyFactory.getProp;if(this.pe=b(this,e.pe,0,0,this),e.ks.p.s?(this.px=b(this,e.ks.p.x,1,0,this),this.py=b(this,e.ks.p.y,1,0,this),this.pz=b(this,e.ks.p.z,1,0,this)):this.p=b(this,e.ks.p,1,0,this),e.ks.a&&(this.a=b(this,e.ks.a,1,0,this)),e.ks.or.k.length&&e.ks.or.k[0].to){var $,it=e.ks.or.k.length;for($=0;$<it;$+=1)e.ks.or.k[$].to=null,e.ks.or.k[$].ti=null}this.or=b(this,e.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=b(this,e.ks.rx,0,degToRads,this),this.ry=b(this,e.ks.ry,0,degToRads,this),this.rz=b(this,e.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var e,i=this.comp.threeDElements.length,c,b,$;for(e=0;e<i;e+=1)if(c=this.comp.threeDElements[e],c.type==="3d"){b=c.perspectiveElem.style,$=c.container.style;var it=this.pe.v+"px",at="0px 0px 0px",h="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";b.perspective=it,b.webkitPerspective=it,$.transformOrigin=at,$.mozTransformOrigin=at,$.webkitTransformOrigin=at,b.transform=h,b.webkitTransform=h}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var e=this._isFirstFrame,i,c;if(this.hierarchy)for(c=this.hierarchy.length,i=0;i<c;i+=1)e=this.hierarchy[i].finalTransform.mProp._mdf||e;if(e||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(c=this.hierarchy.length-1,i=c;i>=0;i-=1){var b=this.hierarchy[i].finalTransform.mProp;this.mat.translate(-b.p.v[0],-b.p.v[1],b.p.v[2]),this.mat.rotateX(-b.or.v[0]).rotateY(-b.or.v[1]).rotateZ(b.or.v[2]),this.mat.rotateX(-b.rx.v).rotateY(-b.ry.v).rotateZ(b.rz.v),this.mat.scale(1/b.s.v[0],1/b.s.v[1],1/b.s.v[2]),this.mat.translate(b.a.v[0],b.a.v[1],b.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var $;this.p?$=[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:$=[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var it=Math.sqrt(Math.pow($[0],2)+Math.pow($[1],2)+Math.pow($[2],2)),at=[$[0]/it,$[1]/it,$[2]/it],h=Math.sqrt(at[2]*at[2]+at[0]*at[0]),dt=Math.atan2(at[1],h),ft=Math.atan2(at[0],-at[2]);this.mat.rotateY(ft).rotateX(-dt)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var xt=!this._prevMat.equals(this.mat);if((xt||this.pe._mdf)&&this.comp.threeDElements){c=this.comp.threeDElements.length;var Ct,bt,kt;for(i=0;i<c;i+=1)if(Ct=this.comp.threeDElements[i],Ct.type==="3d"){if(xt){var Dt=this.mat.toCSS();kt=Ct.container.style,kt.transform=Dt,kt.webkitTransform=Dt}this.pe._mdf&&(bt=Ct.perspectiveElem.style,bt.perspective=this.pe.v+"px",bt.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null};function HImageElement(e,i,c){this.assetData=i.getAssetData(e.refId),this.initElement(e,i,c)}extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData),i=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(i),i.crossOrigin="anonymous",i.src=e,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)};function HybridRendererBase(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:i&&i.className||"",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(i&&i.hideOnTransparent===!1),filterSize:{width:i&&i.filterSize&&i.filterSize.width||"400%",height:i&&i.filterSize&&i.filterSize.height||"400%",x:i&&i.filterSize&&i.filterSize.x||"-100%",y:i&&i.filterSize&&i.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},HybridRendererBase.prototype.appendElementInPos=function(e,i){var c=e.getBaseElement();if(c){var b=this.layers[i];if(!b.ddd||!this.supports3d)if(this.threeDElements)this.addTo3dContainer(c,i);else{for(var $=0,it,at,h;$<i;)this.elements[$]&&this.elements[$]!==!0&&this.elements[$].getBaseElement&&(at=this.elements[$],h=this.layers[$].ddd?this.getThreeDContainerByPos($):at.getBaseElement(),it=h||it),$+=1;it?(!b.ddd||!this.supports3d)&&this.layerElement.insertBefore(c,it):(!b.ddd||!this.supports3d)&&this.layerElement.appendChild(c)}else this.addTo3dContainer(c,i)}},HybridRendererBase.prototype.createShape=function(e){return this.supports3d?new HShapeElement(e,this.globalData,this):new SVGShapeElement(e,this.globalData,this)},HybridRendererBase.prototype.createText=function(e){return this.supports3d?new HTextElement(e,this.globalData,this):new SVGTextLottieElement(e,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(e){return this.camera=new HCameraElement(e,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(e){return this.supports3d?new HImageElement(e,this.globalData,this):new IImageElement(e,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(e){return this.supports3d?new HSolidElement(e,this.globalData,this):new ISolidElement(e,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(e){for(var i=0,c=this.threeDElements.length;i<c;){if(this.threeDElements[i].startPos<=e&&this.threeDElements[i].endPos>=e)return this.threeDElements[i].perspectiveElem;i+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(e,i){var c=createTag("div"),b,$;styleDiv(c);var it=createTag("div");if(styleDiv(it),i==="3d"){b=c.style,b.width=this.globalData.compSize.w+"px",b.height=this.globalData.compSize.h+"px";var at="50% 50%";b.webkitTransformOrigin=at,b.mozTransformOrigin=at,b.transformOrigin=at,$=it.style;var h="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";$.transform=h,$.webkitTransform=h}c.appendChild(it);var dt={container:it,perspectiveElem:c,startPos:e,endPos:e,type:i};return this.threeDElements.push(dt),dt},HybridRendererBase.prototype.build3dContainers=function(){var e,i=this.layers.length,c,b="";for(e=0;e<i;e+=1)this.layers[e].ddd&&this.layers[e].ty!==3?(b!=="3d"&&(b="3d",c=this.createThreeDContainer(e,"3d")),c.endPos=Math.max(c.endPos,e)):(b!=="2d"&&(b="2d",c=this.createThreeDContainer(e,"2d")),c.endPos=Math.max(c.endPos,e));for(i=this.threeDElements.length,e=i-1;e>=0;e-=1)this.resizerElem.appendChild(this.threeDElements[e].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(e,i){for(var c=0,b=this.threeDElements.length;c<b;){if(i<=this.threeDElements[c].endPos){for(var $=this.threeDElements[c].startPos,it;$<i;)this.elements[$]&&this.elements[$].getBaseElement&&(it=this.elements[$].getBaseElement()),$+=1;it?this.threeDElements[c].container.insertBefore(e,it):this.threeDElements[c].container.appendChild(e);break}c+=1}},HybridRendererBase.prototype.configAnimation=function(e){var i=createTag("div"),c=this.animationItem.wrapper,b=i.style;b.width=e.w+"px",b.height=e.h+"px",this.resizerElem=i,styleDiv(i),b.transformStyle="flat",b.mozTransformStyle="flat",b.webkitTransformStyle="flat",this.renderConfig.className&&i.setAttribute("class",this.renderConfig.className),c.appendChild(i),b.overflow="hidden";var $=createNS("svg");$.setAttribute("width","1"),$.setAttribute("height","1"),styleDiv($),this.resizerElem.appendChild($);var it=createNS("defs");$.appendChild(it),this.data=e,this.setupGlobalData(e,$),this.globalData.defs=it,this.layers=e.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var e,i=this.layers?this.layers.length:0;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var e=this.animationItem.wrapper.offsetWidth,i=this.animationItem.wrapper.offsetHeight,c=e/i,b=this.globalData.compSize.w/this.globalData.compSize.h,$,it,at,h;b>c?($=e/this.globalData.compSize.w,it=e/this.globalData.compSize.w,at=0,h=(i-this.globalData.compSize.h*(e/this.globalData.compSize.w))/2):($=i/this.globalData.compSize.h,it=i/this.globalData.compSize.h,at=(e-this.globalData.compSize.w*(i/this.globalData.compSize.h))/2,h=0);var dt=this.resizerElem.style;dt.webkitTransform="matrix3d("+$+",0,0,0,0,"+it+",0,0,0,0,1,0,"+at+","+h+",0,1)",dt.transform=dt.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var e=this.globalData.compSize.w,i=this.globalData.compSize.h,c,b=this.threeDElements.length;for(c=0;c<b;c+=1){var $=this.threeDElements[c].perspectiveElem.style;$.webkitPerspective=Math.sqrt(Math.pow(e,2)+Math.pow(i,2))+"px",$.perspective=$.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(e){var i,c=e.length,b=createTag("div");for(i=0;i<c;i+=1)if(e[i].xt){var $=this.createComp(e[i],b,this.globalData.comp,null);$.initExpressions(),this.globalData.projectInterface.registerComposition($)}};function HCompElement(e,i,c){this.layers=e.layers,this.supports3d=!e.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,i,c),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(e,i){for(var c=0,b;c<i;)this.elements[c]&&this.elements[c].getBaseElement&&(b=this.elements[c].getBaseElement()),c+=1;b?this.layerElement.insertBefore(e,b):this.layerElement.appendChild(e)},HCompElement.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};function HybridRenderer(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:i&&i.className||"",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(i&&i.hideOnTransparent===!1),filterSize:{width:i&&i.filterSize&&i.filterSize.width||"400%",height:i&&i.filterSize&&i.filterSize.height||"400%",x:i&&i.filterSize&&i.filterSize.x||"-100%",y:i&&i.filterSize&&i.filterSize.y||"-100%"},runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};var CompExpressionInterface=function(){return function(e){function i(c){for(var b=0,$=e.layers.length;b<$;){if(e.layers[b].nm===c||e.layers[b].ind===c)return e.elements[b].layerInterface;b+=1}return null}return Object.defineProperty(i,"_name",{value:e.data.nm}),i.layer=i,i.pixelAspect=1,i.height=e.data.h||e.globalData.compSize.h,i.width=e.data.w||e.globalData.compSize.w,i.pixelAspect=1,i.frameDuration=1/e.globalData.frameRate,i.displayStartTime=0,i.numLayers=e.layers.length,i}}();function _typeof$2(e){"@babel/helpers - typeof";return _typeof$2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$2(e)}function seedRandom(e,i){var c=this,b=256,$=6,it=52,at="random",h=i.pow(b,$),dt=i.pow(2,it),ft=dt*2,xt=b-1,Ct;function bt(St,jt,Ht){var Kt=[];jt=jt===!0?{entropy:!0}:jt||{};var ir=Bt(At(jt.entropy?[St,It(e)]:St===null?Tt():St,3),Kt),nr=new kt(Kt),kr=function(){for(var Sr=nr.g($),$r=h,rn=0;Sr<dt;)Sr=(Sr+rn)*b,$r*=b,rn=nr.g(1);for(;Sr>=ft;)Sr/=2,$r/=2,rn>>>=1;return(Sr+rn)/$r};return kr.int32=function(){return nr.g(4)|0},kr.quick=function(){return nr.g(4)/4294967296},kr.double=kr,Bt(It(nr.S),e),(jt.pass||Ht||function(br,Sr,$r,rn){return rn&&(rn.S&&Dt(rn,nr),br.state=function(){return Dt(nr,{})}),$r?(i[at]=br,Sr):br})(kr,ir,"global"in jt?jt.global:this==i,jt.state)}i["seed"+at]=bt;function kt(St){var jt,Ht=St.length,Kt=this,ir=0,nr=Kt.i=Kt.j=0,kr=Kt.S=[];for(Ht||(St=[Ht++]);ir<b;)kr[ir]=ir++;for(ir=0;ir<b;ir++)kr[ir]=kr[nr=xt&nr+St[ir%Ht]+(jt=kr[ir])],kr[nr]=jt;Kt.g=function(br){for(var Sr,$r=0,rn=Kt.i,Zr=Kt.j,Kr=Kt.S;br--;)Sr=Kr[rn=xt&rn+1],$r=$r*b+Kr[xt&(Kr[rn]=Kr[Zr=xt&Zr+Sr])+(Kr[Zr]=Sr)];return Kt.i=rn,Kt.j=Zr,$r}}function Dt(St,jt){return jt.i=St.i,jt.j=St.j,jt.S=St.S.slice(),jt}function At(St,jt){var Ht=[],Kt=_typeof$2(St),ir;if(jt&&Kt=="object")for(ir in St)try{Ht.push(At(St[ir],jt-1))}catch{}return Ht.length?Ht:Kt=="string"?St:St+"\0"}function Bt(St,jt){for(var Ht=St+"",Kt,ir=0;ir<Ht.length;)jt[xt&ir]=xt&(Kt^=jt[xt&ir]*19)+Ht.charCodeAt(ir++);return It(jt)}function Tt(){try{var St=new Uint8Array(b);return(c.crypto||c.msCrypto).getRandomValues(St),It(St)}catch{var jt=c.navigator,Ht=jt&&jt.plugins;return[+new Date,c,Ht,c.screen,It(e)]}}function It(St){return String.fromCharCode.apply(0,St)}Bt(i.random(),e)}function initialize$2(e){seedRandom([],e)}var propTypes={SHAPE:"shape"};function _typeof$1(e){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$1(e)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};initialize$2(BMMath);function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(e){return e.constructor===Array||e.constructor===Float32Array}function isNumerable(e,i){return e==="number"||i instanceof Number||e==="boolean"||e==="string"}function $bm_neg(e){var i=_typeof$1(e);if(i==="number"||e instanceof Number||i==="boolean")return-e;if($bm_isInstanceOfArray(e)){var c,b=e.length,$=[];for(c=0;c<b;c+=1)$[c]=-e[c];return $}return e.propType?e.v:-e}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(e,i){var c=_typeof$1(e),b=_typeof$1(i);if(isNumerable(c,e)&&isNumerable(b,i)||c==="string"||b==="string")return e+i;if($bm_isInstanceOfArray(e)&&isNumerable(b,i))return e=e.slice(0),e[0]+=i,e;if(isNumerable(c,e)&&$bm_isInstanceOfArray(i))return i=i.slice(0),i[0]=e+i[0],i;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(i)){for(var $=0,it=e.length,at=i.length,h=[];$<it||$<at;)(typeof e[$]=="number"||e[$]instanceof Number)&&(typeof i[$]=="number"||i[$]instanceof Number)?h[$]=e[$]+i[$]:h[$]=i[$]===void 0?e[$]:e[$]||i[$],$+=1;return h}return 0}var add=sum;function sub(e,i){var c=_typeof$1(e),b=_typeof$1(i);if(isNumerable(c,e)&&isNumerable(b,i))return c==="string"&&(e=parseInt(e,10)),b==="string"&&(i=parseInt(i,10)),e-i;if($bm_isInstanceOfArray(e)&&isNumerable(b,i))return e=e.slice(0),e[0]-=i,e;if(isNumerable(c,e)&&$bm_isInstanceOfArray(i))return i=i.slice(0),i[0]=e-i[0],i;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(i)){for(var $=0,it=e.length,at=i.length,h=[];$<it||$<at;)(typeof e[$]=="number"||e[$]instanceof Number)&&(typeof i[$]=="number"||i[$]instanceof Number)?h[$]=e[$]-i[$]:h[$]=i[$]===void 0?e[$]:e[$]||i[$],$+=1;return h}return 0}function mul(e,i){var c=_typeof$1(e),b=_typeof$1(i),$;if(isNumerable(c,e)&&isNumerable(b,i))return e*i;var it,at;if($bm_isInstanceOfArray(e)&&isNumerable(b,i)){for(at=e.length,$=createTypedArray("float32",at),it=0;it<at;it+=1)$[it]=e[it]*i;return $}if(isNumerable(c,e)&&$bm_isInstanceOfArray(i)){for(at=i.length,$=createTypedArray("float32",at),it=0;it<at;it+=1)$[it]=e*i[it];return $}return 0}function div(e,i){var c=_typeof$1(e),b=_typeof$1(i),$;if(isNumerable(c,e)&&isNumerable(b,i))return e/i;var it,at;if($bm_isInstanceOfArray(e)&&isNumerable(b,i)){for(at=e.length,$=createTypedArray("float32",at),it=0;it<at;it+=1)$[it]=e[it]/i;return $}if(isNumerable(c,e)&&$bm_isInstanceOfArray(i)){for(at=i.length,$=createTypedArray("float32",at),it=0;it<at;it+=1)$[it]=e/i[it];return $}return 0}function mod(e,i){return typeof e=="string"&&(e=parseInt(e,10)),typeof i=="string"&&(i=parseInt(i,10)),e%i}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(e,i,c){if(i>c){var b=c;c=i,i=b}return Math.min(Math.max(e,i),c)}function radiansToDegrees(e){return e/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(e){return e*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(e,i){if(typeof e=="number"||e instanceof Number)return i=i||0,Math.abs(e-i);i||(i=helperLengthArray);var c,b=Math.min(e.length,i.length),$=0;for(c=0;c<b;c+=1)$+=Math.pow(i[c]-e[c],2);return Math.sqrt($)}function normalize(e){return div(e,length(e))}function rgbToHsl(e){var i=e[0],c=e[1],b=e[2],$=Math.max(i,c,b),it=Math.min(i,c,b),at,h,dt=($+it)/2;if($===it)at=0,h=0;else{var ft=$-it;switch(h=dt>.5?ft/(2-$-it):ft/($+it),$){case i:at=(c-b)/ft+(c<b?6:0);break;case c:at=(b-i)/ft+2;break;case b:at=(i-c)/ft+4;break}at/=6}return[at,h,dt,e[3]]}function hue2rgb(e,i,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?e+(i-e)*6*c:c<1/2?i:c<2/3?e+(i-e)*(2/3-c)*6:e}function hslToRgb(e){var i=e[0],c=e[1],b=e[2],$,it,at;if(c===0)$=b,at=b,it=b;else{var h=b<.5?b*(1+c):b+c-b*c,dt=2*b-h;$=hue2rgb(dt,h,i+1/3),it=hue2rgb(dt,h,i),at=hue2rgb(dt,h,i-1/3)}return[$,it,at,e[3]]}function linear(e,i,c,b,$){if((b===void 0||$===void 0)&&(b=i,$=c,i=0,c=1),c<i){var it=c;c=i,i=it}if(e<=i)return b;if(e>=c)return $;var at=c===i?0:(e-i)/(c-i);if(!b.length)return b+($-b)*at;var h,dt=b.length,ft=createTypedArray("float32",dt);for(h=0;h<dt;h+=1)ft[h]=b[h]+($[h]-b[h])*at;return ft}function random(e,i){if(i===void 0&&(e===void 0?(e=0,i=1):(i=e,e=void 0)),i.length){var c,b=i.length;e||(e=createTypedArray("float32",b));var $=createTypedArray("float32",b),it=BMMath.random();for(c=0;c<b;c+=1)$[c]=e[c]+it*(i[c]-e[c]);return $}e===void 0&&(e=0);var at=BMMath.random();return e+at*(i-e)}function createPath(e,i,c,b){var $,it=e.length,at=shapePool.newElement();at.setPathData(!!b,it);var h=[0,0],dt,ft;for($=0;$<it;$+=1)dt=i&&i[$]?i[$]:h,ft=c&&c[$]?c[$]:h,at.setTripleAt(e[$][0],e[$][1],ft[0]+e[$][0],ft[1]+e[$][1],dt[0]+e[$][0],dt[1]+e[$][1],$,!0);return at}function initiateExpression(elem,data,property){function noOp(e){return e}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=val.indexOf("random")!==-1,elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty._name=elem.data.nm,thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||this.data.hd!==!0,wiggle=(function e(i,c){var b,$,it=this.pv.length?this.pv.length:1,at=createTypedArray("float32",it);i=5;var h=Math.floor(time*i);for(b=0,$=0;b<h;){for($=0;$<it;$+=1)at[$]+=-c+c*2*BMMath.random();b+=1}var dt=time*i,ft=dt-Math.floor(dt),xt=createTypedArray("float32",it);if(it>1){for($=0;$<it;$+=1)xt[$]=this.pv[$]+at[$]+(-c+c*2*BMMath.random())*ft;return xt}return this.pv+at[0]+(-c+c*2*BMMath.random())*ft}).bind(this);thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty));function loopInDuration(e,i){return loopIn(e,i,!0)}function loopOutDuration(e,i){return loopOut(e,i,!0)}this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function lookAt(e,i){var c=[i[0]-e[0],i[1]-e[1],i[2]-e[2]],b=Math.atan2(c[0],Math.sqrt(c[1]*c[1]+c[2]*c[2]))/degToRads,$=-Math.atan2(c[1],c[2])/degToRads;return[$,b,0]}function easeOut(e,i,c,b,$){return applyEase(easeOutBez,e,i,c,b,$)}function easeIn(e,i,c,b,$){return applyEase(easeInBez,e,i,c,b,$)}function ease(e,i,c,b,$){return applyEase(easeInOutBez,e,i,c,b,$)}function applyEase(e,i,c,b,$,it){$===void 0?($=c,it=b):i=(i-c)/(b-c),i>1?i=1:i<0&&(i=0);var at=e(i);if($bm_isInstanceOfArray($)){var h,dt=$.length,ft=createTypedArray("float32",dt);for(h=0;h<dt;h+=1)ft[h]=(it[h]-$[h])*at+$[h];return ft}return(it-$)*at+$}function nearestKey(e){var i,c=data.k.length,b,$;if(!data.k.length||typeof data.k[0]=="number")b=0,$=0;else if(b=-1,e*=elem.comp.globalData.frameRate,e<data.k[0].t)b=1,$=data.k[0].t;else{for(i=0;i<c-1;i+=1)if(e===data.k[i].t){b=i+1,$=data.k[i].t;break}else if(e>data.k[i].t&&e<data.k[i+1].t){e-data.k[i].t>data.k[i+1].t-e?(b=i+2,$=data.k[i+1].t):(b=i+1,$=data.k[i].t);break}b===-1&&(b=i+1,$=data.k[i].t)}var it={};return it.index=b,it.time=$/elem.comp.globalData.frameRate,it}function key(e){var i,c,b;if(!data.k.length||typeof data.k[0]=="number")throw new Error("The property has no keyframe at index "+e);e-=1,i={time:data.k[e].t/elem.comp.globalData.frameRate,value:[]};var $=Object.prototype.hasOwnProperty.call(data.k[e],"s")?data.k[e].s:data.k[e-1].e;for(b=$.length,c=0;c<b;c+=1)i[c]=$[c],i.value[c]=$[c];return i}function framesToTime(e,i){return i||(i=elem.comp.globalData.frameRate),e/i}function timeToFrames(e,i){return!e&&e!==0&&(e=time),i||(i=elem.comp.globalData.frameRate),e*i}function seedRandom(e){BMMath.seedrandom(randSeed+e)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(e,i){return typeof value=="string"?i===void 0?value.substring(e):value.substring(e,i):""}function substr(e,i){return typeof value=="string"?i===void 0?value.substr(e):value.substr(e,i):""}function posterizeTime(e){time=e===0?0:Math.floor(time*e)/e,value=valueAtTime(time)}var time,velocity,value,text,textIndex,textTotal,selectorValue,index=elem.data.ind,hasParent=!!(elem.hierarchy&&elem.hierarchy.length),parent,randSeed=Math.floor(Math.random()*1e6),globalData=elem.globalData;function executeExpression(e){return value=e,this.frameExpressionId===elem.globalData.frameId&&this.propType!=="textSelector"?value:(this.propType==="textSelector"&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),elemType===4&&!content&&(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),hasParent=!!(elem.hierarchy&&elem.hierarchy.length),hasParent&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt,scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var e={};e.initExpressions=i,e.resetFrame=ExpressionManager.resetFrame;function i(c){var b=0,$=[];function it(){b+=1}function at(){b-=1,b===0&&dt()}function h(ft){$.indexOf(ft)===-1&&$.push(ft)}function dt(){var ft,xt=$.length;for(ft=0;ft<xt;ft+=1)$[ft].release();$.length=0}c.renderer.compInterface=CompExpressionInterface(c.renderer),c.renderer.globalData.projectInterface.registerComposition(c.renderer),c.renderer.globalData.pushExpression=it,c.renderer.globalData.popExpression=at,c.renderer.globalData.registerExpressionProperty=h}return e}(),MaskManagerInterface=function(){function e(c,b){this._mask=c,this._data=b}Object.defineProperty(e.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(e.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),this._mask.op.v*100}});var i=function(b){var $=createSizedArray(b.viewData.length),it,at=b.viewData.length;for(it=0;it<at;it+=1)$[it]=new e(b.viewData[it],b.masksProperties[it]);var h=function(ft){for(it=0;it<at;){if(b.masksProperties[it].nm===ft)return $[it];it+=1}return null};return h};return i}(),ExpressionPropertyInterface=function(){var e={pv:0,v:0,mult:1},i={pv:[0,0,0],v:[0,0,0],mult:1};function c(at,h,dt){Object.defineProperty(at,"velocity",{get:function(){return h.getVelocityAtTime(h.comp.currentFrame)}}),at.numKeys=h.keyframes?h.keyframes.length:0,at.key=function(ft){if(!at.numKeys)return 0;var xt="";"s"in h.keyframes[ft-1]?xt=h.keyframes[ft-1].s:"e"in h.keyframes[ft-2]?xt=h.keyframes[ft-2].e:xt=h.keyframes[ft-2].s;var Ct=dt==="unidimensional"?new Number(xt):Object.assign({},xt);return Ct.time=h.keyframes[ft-1].t/h.elem.comp.globalData.frameRate,Ct.value=dt==="unidimensional"?xt[0]:xt,Ct},at.valueAtTime=h.getValueAtTime,at.speedAtTime=h.getSpeedAtTime,at.velocityAtTime=h.getVelocityAtTime,at.propertyGroup=h.propertyGroup}function b(at){(!at||!("pv"in at))&&(at=e);var h=1/at.mult,dt=at.pv*h,ft=new Number(dt);return ft.value=dt,c(ft,at,"unidimensional"),function(){return at.k&&at.getValue(),dt=at.v*h,ft.value!==dt&&(ft=new Number(dt),ft.value=dt,ft[0]=dt,c(ft,at,"unidimensional")),ft}}function $(at){(!at||!("pv"in at))&&(at=i);var h=1/at.mult,dt=at.data&&at.data.l||at.pv.length,ft=createTypedArray("float32",dt),xt=createTypedArray("float32",dt);return ft.value=xt,c(ft,at,"multidimensional"),function(){at.k&&at.getValue();for(var Ct=0;Ct<dt;Ct+=1)xt[Ct]=at.v[Ct]*h,ft[Ct]=xt[Ct];return ft}}function it(){return e}return function(at){return at?at.propType==="unidimensional"?b(at):$(at):it}}(),TransformExpressionInterface=function(){return function(e){function i(at){switch(at){case"scale":case"Scale":case"ADBE Scale":case 6:return i.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return i.rotation;case"ADBE Rotate X":return i.xRotation;case"ADBE Rotate Y":return i.yRotation;case"position":case"Position":case"ADBE Position":case 2:return i.position;case"ADBE Position_0":return i.xPosition;case"ADBE Position_1":return i.yPosition;case"ADBE Position_2":return i.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return i.anchorPoint;case"opacity":case"Opacity":case 11:return i.opacity;default:return null}}Object.defineProperty(i,"rotation",{get:ExpressionPropertyInterface(e.r||e.rz)}),Object.defineProperty(i,"zRotation",{get:ExpressionPropertyInterface(e.rz||e.r)}),Object.defineProperty(i,"xRotation",{get:ExpressionPropertyInterface(e.rx)}),Object.defineProperty(i,"yRotation",{get:ExpressionPropertyInterface(e.ry)}),Object.defineProperty(i,"scale",{get:ExpressionPropertyInterface(e.s)});var c,b,$,it;return e.p?it=ExpressionPropertyInterface(e.p):(c=ExpressionPropertyInterface(e.px),b=ExpressionPropertyInterface(e.py),e.pz&&($=ExpressionPropertyInterface(e.pz))),Object.defineProperty(i,"position",{get:function(){return e.p?it():[c(),b(),$?$():0]}}),Object.defineProperty(i,"xPosition",{get:ExpressionPropertyInterface(e.px)}),Object.defineProperty(i,"yPosition",{get:ExpressionPropertyInterface(e.py)}),Object.defineProperty(i,"zPosition",{get:ExpressionPropertyInterface(e.pz)}),Object.defineProperty(i,"anchorPoint",{get:ExpressionPropertyInterface(e.a)}),Object.defineProperty(i,"opacity",{get:ExpressionPropertyInterface(e.o)}),Object.defineProperty(i,"skew",{get:ExpressionPropertyInterface(e.sk)}),Object.defineProperty(i,"skewAxis",{get:ExpressionPropertyInterface(e.sa)}),Object.defineProperty(i,"orientation",{get:ExpressionPropertyInterface(e.or)}),i}}(),LayerExpressionInterface=function(){function e(ft){var xt=new Matrix;if(ft!==void 0){var Ct=this._elem.finalTransform.mProp.getValueAtTime(ft);Ct.clone(xt)}else{var bt=this._elem.finalTransform.mProp;bt.applyToMatrix(xt)}return xt}function i(ft,xt){var Ct=this.getMatrix(xt);return Ct.props[12]=0,Ct.props[13]=0,Ct.props[14]=0,this.applyPoint(Ct,ft)}function c(ft,xt){var Ct=this.getMatrix(xt);return this.applyPoint(Ct,ft)}function b(ft,xt){var Ct=this.getMatrix(xt);return Ct.props[12]=0,Ct.props[13]=0,Ct.props[14]=0,this.invertPoint(Ct,ft)}function $(ft,xt){var Ct=this.getMatrix(xt);return this.invertPoint(Ct,ft)}function it(ft,xt){if(this._elem.hierarchy&&this._elem.hierarchy.length){var Ct,bt=this._elem.hierarchy.length;for(Ct=0;Ct<bt;Ct+=1)this._elem.hierarchy[Ct].finalTransform.mProp.applyToMatrix(ft)}return ft.applyToPointArray(xt[0],xt[1],xt[2]||0)}function at(ft,xt){if(this._elem.hierarchy&&this._elem.hierarchy.length){var Ct,bt=this._elem.hierarchy.length;for(Ct=0;Ct<bt;Ct+=1)this._elem.hierarchy[Ct].finalTransform.mProp.applyToMatrix(ft)}return ft.inversePoint(xt)}function h(ft){var xt=new Matrix;if(xt.reset(),this._elem.finalTransform.mProp.applyToMatrix(xt),this._elem.hierarchy&&this._elem.hierarchy.length){var Ct,bt=this._elem.hierarchy.length;for(Ct=0;Ct<bt;Ct+=1)this._elem.hierarchy[Ct].finalTransform.mProp.applyToMatrix(xt);return xt.inversePoint(ft)}return xt.inversePoint(ft)}function dt(){return[1,1,1,1]}return function(ft){var xt;function Ct(At){kt.mask=new MaskManagerInterface(At,ft)}function bt(At){kt.effect=At}function kt(At){switch(At){case"ADBE Root Vectors Group":case"Contents":case 2:return kt.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return xt;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return kt.effect;case"ADBE Text Properties":return kt.textInterface;default:return null}}kt.getMatrix=e,kt.invertPoint=at,kt.applyPoint=it,kt.toWorld=c,kt.toWorldVec=i,kt.fromWorld=$,kt.fromWorldVec=b,kt.toComp=c,kt.fromComp=h,kt.sampleImage=dt,kt.sourceRectAtTime=ft.sourceRectAtTime.bind(ft),kt._elem=ft,xt=TransformExpressionInterface(ft.finalTransform.mProp);var Dt=getDescriptor(xt,"anchorPoint");return Object.defineProperties(kt,{hasParent:{get:function(){return ft.hierarchy.length}},parent:{get:function(){return ft.hierarchy[0].layerInterface}},rotation:getDescriptor(xt,"rotation"),scale:getDescriptor(xt,"scale"),position:getDescriptor(xt,"position"),opacity:getDescriptor(xt,"opacity"),anchorPoint:Dt,anchor_point:Dt,transform:{get:function(){return xt}},active:{get:function(){return ft.isInRange}}}),kt.startTime=ft.data.st,kt.index=ft.data.ind,kt.source=ft.data.refId,kt.height=ft.data.ty===0?ft.data.h:100,kt.width=ft.data.ty===0?ft.data.w:100,kt.inPoint=ft.data.ip/ft.comp.globalData.frameRate,kt.outPoint=ft.data.op/ft.comp.globalData.frameRate,kt._name=ft.data.nm,kt.registerMaskInterface=Ct,kt.registerEffectsInterface=bt,kt}}(),propertyGroupFactory=function(){return function(e,i){return function(c){return c=c===void 0?1:c,c<=0?e:i(c-1)}}}(),PropertyInterface=function(){return function(e,i){var c={_name:e};function b($){return $=$===void 0?1:$,$<=0?c:i($-1)}return b}}(),EffectsExpressionInterface=function(){var e={createEffectsInterface:i};function i($,it){if($.effectsManager){var at=[],h=$.data.ef,dt,ft=$.effectsManager.effectElements.length;for(dt=0;dt<ft;dt+=1)at.push(c(h[dt],$.effectsManager.effectElements[dt],it,$));var xt=$.data.ef||[],Ct=function(kt){for(dt=0,ft=xt.length;dt<ft;){if(kt===xt[dt].nm||kt===xt[dt].mn||kt===xt[dt].ix)return at[dt];dt+=1}return null};return Object.defineProperty(Ct,"numProperties",{get:function(){return xt.length}}),Ct}return null}function c($,it,at,h){function dt(kt){for(var Dt=$.ef,At=0,Bt=Dt.length;At<Bt;){if(kt===Dt[At].nm||kt===Dt[At].mn||kt===Dt[At].ix)return Dt[At].ty===5?xt[At]:xt[At]();At+=1}throw new Error}var ft=propertyGroupFactory(dt,at),xt=[],Ct,bt=$.ef.length;for(Ct=0;Ct<bt;Ct+=1)$.ef[Ct].ty===5?xt.push(c($.ef[Ct],it.effectElements[Ct],it.effectElements[Ct].propertyGroup,h)):xt.push(b(it.effectElements[Ct],$.ef[Ct].ty,h,ft));return $.mn==="ADBE Color Control"&&Object.defineProperty(dt,"color",{get:function(){return xt[0]()}}),Object.defineProperties(dt,{numProperties:{get:function(){return $.np}},_name:{value:$.nm},propertyGroup:{value:ft}}),dt.enabled=$.en!==0,dt.active=dt.enabled,dt}function b($,it,at,h){var dt=ExpressionPropertyInterface($.p);function ft(){return it===10?at.comp.compInterface($.p.v):dt()}return $.p.setGroupProperty&&$.p.setGroupProperty(PropertyInterface("",h)),ft}return e}(),ShapePathInterface=function(){return function(i,c,b){var $=c.sh;function it(h){return h==="Shape"||h==="shape"||h==="Path"||h==="path"||h==="ADBE Vector Shape"||h===2?it.path:null}var at=propertyGroupFactory(it,b);return $.setGroupProperty(PropertyInterface("Path",at)),Object.defineProperties(it,{path:{get:function(){return $.k&&$.getValue(),$}},shape:{get:function(){return $.k&&$.getValue(),$}},_name:{value:i.nm},ix:{value:i.ix},propertyIndex:{value:i.ix},mn:{value:i.mn},propertyGroup:{value:b}}),it}}(),ShapeExpressionInterface=function(){function e(Dt,At,Bt){var Tt=[],It,St=Dt?Dt.length:0;for(It=0;It<St;It+=1)Dt[It].ty==="gr"?Tt.push(c(Dt[It],At[It],Bt)):Dt[It].ty==="fl"?Tt.push(b(Dt[It],At[It],Bt)):Dt[It].ty==="st"?Tt.push(at(Dt[It],At[It],Bt)):Dt[It].ty==="tm"?Tt.push(h(Dt[It],At[It],Bt)):Dt[It].ty==="tr"||(Dt[It].ty==="el"?Tt.push(ft(Dt[It],At[It],Bt)):Dt[It].ty==="sr"?Tt.push(xt(Dt[It],At[It],Bt)):Dt[It].ty==="sh"?Tt.push(ShapePathInterface(Dt[It],At[It],Bt)):Dt[It].ty==="rc"?Tt.push(Ct(Dt[It],At[It],Bt)):Dt[It].ty==="rd"?Tt.push(bt(Dt[It],At[It],Bt)):Dt[It].ty==="rp"?Tt.push(kt(Dt[It],At[It],Bt)):Dt[It].ty==="gf"?Tt.push($(Dt[It],At[It],Bt)):Tt.push(it(Dt[It],At[It])));return Tt}function i(Dt,At,Bt){var Tt,It=function(Ht){for(var Kt=0,ir=Tt.length;Kt<ir;){if(Tt[Kt]._name===Ht||Tt[Kt].mn===Ht||Tt[Kt].propertyIndex===Ht||Tt[Kt].ix===Ht||Tt[Kt].ind===Ht)return Tt[Kt];Kt+=1}return typeof Ht=="number"?Tt[Ht-1]:null};It.propertyGroup=propertyGroupFactory(It,Bt),Tt=e(Dt.it,At.it,It.propertyGroup),It.numProperties=Tt.length;var St=dt(Dt.it[Dt.it.length-1],At.it[At.it.length-1],It.propertyGroup);return It.transform=St,It.propertyIndex=Dt.cix,It._name=Dt.nm,It}function c(Dt,At,Bt){var Tt=function(Ht){switch(Ht){case"ADBE Vectors Group":case"Contents":case 2:return Tt.content;default:return Tt.transform}};Tt.propertyGroup=propertyGroupFactory(Tt,Bt);var It=i(Dt,At,Tt.propertyGroup),St=dt(Dt.it[Dt.it.length-1],At.it[At.it.length-1],Tt.propertyGroup);return Tt.content=It,Tt.transform=St,Object.defineProperty(Tt,"_name",{get:function(){return Dt.nm}}),Tt.numProperties=Dt.np,Tt.propertyIndex=Dt.ix,Tt.nm=Dt.nm,Tt.mn=Dt.mn,Tt}function b(Dt,At,Bt){function Tt(It){return It==="Color"||It==="color"?Tt.color:It==="Opacity"||It==="opacity"?Tt.opacity:null}return Object.defineProperties(Tt,{color:{get:ExpressionPropertyInterface(At.c)},opacity:{get:ExpressionPropertyInterface(At.o)},_name:{value:Dt.nm},mn:{value:Dt.mn}}),At.c.setGroupProperty(PropertyInterface("Color",Bt)),At.o.setGroupProperty(PropertyInterface("Opacity",Bt)),Tt}function $(Dt,At,Bt){function Tt(It){return It==="Start Point"||It==="start point"?Tt.startPoint:It==="End Point"||It==="end point"?Tt.endPoint:It==="Opacity"||It==="opacity"?Tt.opacity:null}return Object.defineProperties(Tt,{startPoint:{get:ExpressionPropertyInterface(At.s)},endPoint:{get:ExpressionPropertyInterface(At.e)},opacity:{get:ExpressionPropertyInterface(At.o)},type:{get:function(){return"a"}},_name:{value:Dt.nm},mn:{value:Dt.mn}}),At.s.setGroupProperty(PropertyInterface("Start Point",Bt)),At.e.setGroupProperty(PropertyInterface("End Point",Bt)),At.o.setGroupProperty(PropertyInterface("Opacity",Bt)),Tt}function it(){function Dt(){return null}return Dt}function at(Dt,At,Bt){var Tt=propertyGroupFactory(ir,Bt),It=propertyGroupFactory(Kt,Tt);function St(nr){Object.defineProperty(Kt,Dt.d[nr].nm,{get:ExpressionPropertyInterface(At.d.dataProps[nr].p)})}var jt,Ht=Dt.d?Dt.d.length:0,Kt={};for(jt=0;jt<Ht;jt+=1)St(jt),At.d.dataProps[jt].p.setGroupProperty(It);function ir(nr){return nr==="Color"||nr==="color"?ir.color:nr==="Opacity"||nr==="opacity"?ir.opacity:nr==="Stroke Width"||nr==="stroke width"?ir.strokeWidth:null}return Object.defineProperties(ir,{color:{get:ExpressionPropertyInterface(At.c)},opacity:{get:ExpressionPropertyInterface(At.o)},strokeWidth:{get:ExpressionPropertyInterface(At.w)},dash:{get:function(){return Kt}},_name:{value:Dt.nm},mn:{value:Dt.mn}}),At.c.setGroupProperty(PropertyInterface("Color",Tt)),At.o.setGroupProperty(PropertyInterface("Opacity",Tt)),At.w.setGroupProperty(PropertyInterface("Stroke Width",Tt)),ir}function h(Dt,At,Bt){function Tt(St){return St===Dt.e.ix||St==="End"||St==="end"?Tt.end:St===Dt.s.ix?Tt.start:St===Dt.o.ix?Tt.offset:null}var It=propertyGroupFactory(Tt,Bt);return Tt.propertyIndex=Dt.ix,At.s.setGroupProperty(PropertyInterface("Start",It)),At.e.setGroupProperty(PropertyInterface("End",It)),At.o.setGroupProperty(PropertyInterface("Offset",It)),Tt.propertyIndex=Dt.ix,Tt.propertyGroup=Bt,Object.defineProperties(Tt,{start:{get:ExpressionPropertyInterface(At.s)},end:{get:ExpressionPropertyInterface(At.e)},offset:{get:ExpressionPropertyInterface(At.o)},_name:{value:Dt.nm}}),Tt.mn=Dt.mn,Tt}function dt(Dt,At,Bt){function Tt(St){return Dt.a.ix===St||St==="Anchor Point"?Tt.anchorPoint:Dt.o.ix===St||St==="Opacity"?Tt.opacity:Dt.p.ix===St||St==="Position"?Tt.position:Dt.r.ix===St||St==="Rotation"||St==="ADBE Vector Rotation"?Tt.rotation:Dt.s.ix===St||St==="Scale"?Tt.scale:Dt.sk&&Dt.sk.ix===St||St==="Skew"?Tt.skew:Dt.sa&&Dt.sa.ix===St||St==="Skew Axis"?Tt.skewAxis:null}var It=propertyGroupFactory(Tt,Bt);return At.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",It)),At.transform.mProps.p.setGroupProperty(PropertyInterface("Position",It)),At.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",It)),At.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",It)),At.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",It)),At.transform.mProps.sk&&(At.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",It)),At.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",It))),At.transform.op.setGroupProperty(PropertyInterface("Opacity",It)),Object.defineProperties(Tt,{opacity:{get:ExpressionPropertyInterface(At.transform.mProps.o)},position:{get:ExpressionPropertyInterface(At.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(At.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(At.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(At.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(At.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(At.transform.mProps.sa)},_name:{value:Dt.nm}}),Tt.ty="tr",Tt.mn=Dt.mn,Tt.propertyGroup=Bt,Tt}function ft(Dt,At,Bt){function Tt(jt){return Dt.p.ix===jt?Tt.position:Dt.s.ix===jt?Tt.size:null}var It=propertyGroupFactory(Tt,Bt);Tt.propertyIndex=Dt.ix;var St=At.sh.ty==="tm"?At.sh.prop:At.sh;return St.s.setGroupProperty(PropertyInterface("Size",It)),St.p.setGroupProperty(PropertyInterface("Position",It)),Object.defineProperties(Tt,{size:{get:ExpressionPropertyInterface(St.s)},position:{get:ExpressionPropertyInterface(St.p)},_name:{value:Dt.nm}}),Tt.mn=Dt.mn,Tt}function xt(Dt,At,Bt){function Tt(jt){return Dt.p.ix===jt?Tt.position:Dt.r.ix===jt?Tt.rotation:Dt.pt.ix===jt?Tt.points:Dt.or.ix===jt||jt==="ADBE Vector Star Outer Radius"?Tt.outerRadius:Dt.os.ix===jt?Tt.outerRoundness:Dt.ir&&(Dt.ir.ix===jt||jt==="ADBE Vector Star Inner Radius")?Tt.innerRadius:Dt.is&&Dt.is.ix===jt?Tt.innerRoundness:null}var It=propertyGroupFactory(Tt,Bt),St=At.sh.ty==="tm"?At.sh.prop:At.sh;return Tt.propertyIndex=Dt.ix,St.or.setGroupProperty(PropertyInterface("Outer Radius",It)),St.os.setGroupProperty(PropertyInterface("Outer Roundness",It)),St.pt.setGroupProperty(PropertyInterface("Points",It)),St.p.setGroupProperty(PropertyInterface("Position",It)),St.r.setGroupProperty(PropertyInterface("Rotation",It)),Dt.ir&&(St.ir.setGroupProperty(PropertyInterface("Inner Radius",It)),St.is.setGroupProperty(PropertyInterface("Inner Roundness",It))),Object.defineProperties(Tt,{position:{get:ExpressionPropertyInterface(St.p)},rotation:{get:ExpressionPropertyInterface(St.r)},points:{get:ExpressionPropertyInterface(St.pt)},outerRadius:{get:ExpressionPropertyInterface(St.or)},outerRoundness:{get:ExpressionPropertyInterface(St.os)},innerRadius:{get:ExpressionPropertyInterface(St.ir)},innerRoundness:{get:ExpressionPropertyInterface(St.is)},_name:{value:Dt.nm}}),Tt.mn=Dt.mn,Tt}function Ct(Dt,At,Bt){function Tt(jt){return Dt.p.ix===jt?Tt.position:Dt.r.ix===jt?Tt.roundness:Dt.s.ix===jt||jt==="Size"||jt==="ADBE Vector Rect Size"?Tt.size:null}var It=propertyGroupFactory(Tt,Bt),St=At.sh.ty==="tm"?At.sh.prop:At.sh;return Tt.propertyIndex=Dt.ix,St.p.setGroupProperty(PropertyInterface("Position",It)),St.s.setGroupProperty(PropertyInterface("Size",It)),St.r.setGroupProperty(PropertyInterface("Rotation",It)),Object.defineProperties(Tt,{position:{get:ExpressionPropertyInterface(St.p)},roundness:{get:ExpressionPropertyInterface(St.r)},size:{get:ExpressionPropertyInterface(St.s)},_name:{value:Dt.nm}}),Tt.mn=Dt.mn,Tt}function bt(Dt,At,Bt){function Tt(jt){return Dt.r.ix===jt||jt==="Round Corners 1"?Tt.radius:null}var It=propertyGroupFactory(Tt,Bt),St=At;return Tt.propertyIndex=Dt.ix,St.rd.setGroupProperty(PropertyInterface("Radius",It)),Object.defineProperties(Tt,{radius:{get:ExpressionPropertyInterface(St.rd)},_name:{value:Dt.nm}}),Tt.mn=Dt.mn,Tt}function kt(Dt,At,Bt){function Tt(jt){return Dt.c.ix===jt||jt==="Copies"?Tt.copies:Dt.o.ix===jt||jt==="Offset"?Tt.offset:null}var It=propertyGroupFactory(Tt,Bt),St=At;return Tt.propertyIndex=Dt.ix,St.c.setGroupProperty(PropertyInterface("Copies",It)),St.o.setGroupProperty(PropertyInterface("Offset",It)),Object.defineProperties(Tt,{copies:{get:ExpressionPropertyInterface(St.c)},offset:{get:ExpressionPropertyInterface(St.o)},_name:{value:Dt.nm}}),Tt.mn=Dt.mn,Tt}return function(Dt,At,Bt){var Tt;function It(jt){if(typeof jt=="number")return jt=jt===void 0?1:jt,jt===0?Bt:Tt[jt-1];for(var Ht=0,Kt=Tt.length;Ht<Kt;){if(Tt[Ht]._name===jt)return Tt[Ht];Ht+=1}return null}function St(){return Bt}return It.propertyGroup=propertyGroupFactory(It,St),Tt=e(Dt,At,It.propertyGroup),It.numProperties=Tt.length,It._name="Contents",It}}(),TextExpressionInterface=function(){return function(e){var i;function c(b){switch(b){case"ADBE Text Document":return c.sourceText;default:return null}}return Object.defineProperty(c,"sourceText",{get:function(){e.textProperty.getValue();var $=e.textProperty.currentData.t;return(!i||$!==i.value)&&(i=new String($),i.value=$||new String($),Object.defineProperty(i,"style",{get:function(){return{fillColor:e.textProperty.currentData.fc}}})),i}}),c}}();function _typeof(e){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof(e)}var FootageInterface=function(){var e=function(b){var $="",it=b.getFootageData();function at(){return $="",it=b.getFootageData(),h}function h(dt){if(it[dt])return $=dt,it=it[dt],_typeof(it)==="object"?h:it;var ft=dt.indexOf($);if(ft!==-1){var xt=parseInt(dt.substr(ft+$.length),10);return it=it[xt],_typeof(it)==="object"?h:it}return""}return at},i=function(b){function $(it){return it==="Outline"?$.outlineInterface():null}return $._name="Outline",$.outlineInterface=e(b),$};return function(c){function b($){return $==="Data"?b.dataInterface:null}return b._name="Data",b.dataInterface=i(c),b}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(e){return interfaces[e]||null}var expressionHelpers=function(){function e(at,h,dt){h.x&&(dt.k=!0,dt.x=!0,dt.initiateExpression=ExpressionManager.initiateExpression,dt.effectsSequence.push(dt.initiateExpression(at,h,dt).bind(dt)))}function i(at){return at*=this.elem.globalData.frameRate,at-=this.offsetTime,at!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<at?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(at,this._cachingAtTime),this._cachingAtTime.lastFrame=at),this._cachingAtTime.value}function c(at){var h=-.01,dt=this.getValueAtTime(at),ft=this.getValueAtTime(at+h),xt=0;if(dt.length){var Ct;for(Ct=0;Ct<dt.length;Ct+=1)xt+=Math.pow(ft[Ct]-dt[Ct],2);xt=Math.sqrt(xt)*100}else xt=0;return xt}function b(at){if(this.vel!==void 0)return this.vel;var h=-.001,dt=this.getValueAtTime(at),ft=this.getValueAtTime(at+h),xt;if(dt.length){xt=createTypedArray("float32",dt.length);var Ct;for(Ct=0;Ct<dt.length;Ct+=1)xt[Ct]=(ft[Ct]-dt[Ct])/h}else xt=(ft-dt)/h;return xt}function $(){return this.pv}function it(at){this.propertyGroup=at}return{searchExpressions:e,getSpeedAtTime:c,getVelocityAtTime:b,getValueAtTime:i,getStaticValueAtTime:$,setGroupProperty:it}}();function addPropertyDecorator(){function e(bt,kt,Dt){if(!this.k||!this.keyframes)return this.pv;bt=bt?bt.toLowerCase():"";var At=this.comp.renderedFrame,Bt=this.keyframes,Tt=Bt[Bt.length-1].t;if(At<=Tt)return this.pv;var It,St;Dt?(kt?It=Math.abs(Tt-this.elem.comp.globalData.frameRate*kt):It=Math.max(0,Tt-this.elem.data.ip),St=Tt-It):((!kt||kt>Bt.length-1)&&(kt=Bt.length-1),St=Bt[Bt.length-1-kt].t,It=Tt-St);var jt,Ht,Kt;if(bt==="pingpong"){var ir=Math.floor((At-St)/It);if(ir%2!==0)return this.getValueAtTime((It-(At-St)%It+St)/this.comp.globalData.frameRate,0)}else if(bt==="offset"){var nr=this.getValueAtTime(St/this.comp.globalData.frameRate,0),kr=this.getValueAtTime(Tt/this.comp.globalData.frameRate,0),br=this.getValueAtTime(((At-St)%It+St)/this.comp.globalData.frameRate,0),Sr=Math.floor((At-St)/It);if(this.pv.length){for(Kt=new Array(nr.length),Ht=Kt.length,jt=0;jt<Ht;jt+=1)Kt[jt]=(kr[jt]-nr[jt])*Sr+br[jt];return Kt}return(kr-nr)*Sr+br}else if(bt==="continue"){var $r=this.getValueAtTime(Tt/this.comp.globalData.frameRate,0),rn=this.getValueAtTime((Tt-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(Kt=new Array($r.length),Ht=Kt.length,jt=0;jt<Ht;jt+=1)Kt[jt]=$r[jt]+($r[jt]-rn[jt])*((At-Tt)/this.comp.globalData.frameRate)/5e-4;return Kt}return $r+($r-rn)*((At-Tt)/.001)}return this.getValueAtTime(((At-St)%It+St)/this.comp.globalData.frameRate,0)}function i(bt,kt,Dt){if(!this.k)return this.pv;bt=bt?bt.toLowerCase():"";var At=this.comp.renderedFrame,Bt=this.keyframes,Tt=Bt[0].t;if(At>=Tt)return this.pv;var It,St;Dt?(kt?It=Math.abs(this.elem.comp.globalData.frameRate*kt):It=Math.max(0,this.elem.data.op-Tt),St=Tt+It):((!kt||kt>Bt.length-1)&&(kt=Bt.length-1),St=Bt[kt].t,It=St-Tt);var jt,Ht,Kt;if(bt==="pingpong"){var ir=Math.floor((Tt-At)/It);if(ir%2===0)return this.getValueAtTime(((Tt-At)%It+Tt)/this.comp.globalData.frameRate,0)}else if(bt==="offset"){var nr=this.getValueAtTime(Tt/this.comp.globalData.frameRate,0),kr=this.getValueAtTime(St/this.comp.globalData.frameRate,0),br=this.getValueAtTime((It-(Tt-At)%It+Tt)/this.comp.globalData.frameRate,0),Sr=Math.floor((Tt-At)/It)+1;if(this.pv.length){for(Kt=new Array(nr.length),Ht=Kt.length,jt=0;jt<Ht;jt+=1)Kt[jt]=br[jt]-(kr[jt]-nr[jt])*Sr;return Kt}return br-(kr-nr)*Sr}else if(bt==="continue"){var $r=this.getValueAtTime(Tt/this.comp.globalData.frameRate,0),rn=this.getValueAtTime((Tt+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(Kt=new Array($r.length),Ht=Kt.length,jt=0;jt<Ht;jt+=1)Kt[jt]=$r[jt]+($r[jt]-rn[jt])*(Tt-At)/.001;return Kt}return $r+($r-rn)*(Tt-At)/.001}return this.getValueAtTime((It-((Tt-At)%It+Tt))/this.comp.globalData.frameRate,0)}function c(bt,kt){if(!this.k)return this.pv;if(bt=(bt||.4)*.5,kt=Math.floor(kt||5),kt<=1)return this.pv;var Dt=this.comp.renderedFrame/this.comp.globalData.frameRate,At=Dt-bt,Bt=Dt+bt,Tt=kt>1?(Bt-At)/(kt-1):1,It=0,St=0,jt;this.pv.length?jt=createTypedArray("float32",this.pv.length):jt=0;for(var Ht;It<kt;){if(Ht=this.getValueAtTime(At+It*Tt),this.pv.length)for(St=0;St<this.pv.length;St+=1)jt[St]+=Ht[St];else jt+=Ht;It+=1}if(this.pv.length)for(St=0;St<this.pv.length;St+=1)jt[St]/=kt;else jt/=kt;return jt}function b(bt){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var kt=this._transformCachingAtTime.v;if(kt.cloneFromProps(this.pre.props),this.appliedTransformations<1){var Dt=this.a.getValueAtTime(bt);kt.translate(-Dt[0]*this.a.mult,-Dt[1]*this.a.mult,Dt[2]*this.a.mult)}if(this.appliedTransformations<2){var At=this.s.getValueAtTime(bt);kt.scale(At[0]*this.s.mult,At[1]*this.s.mult,At[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var Bt=this.sk.getValueAtTime(bt),Tt=this.sa.getValueAtTime(bt);kt.skewFromAxis(-Bt*this.sk.mult,Tt*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var It=this.r.getValueAtTime(bt);kt.rotate(-It*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var St=this.rz.getValueAtTime(bt),jt=this.ry.getValueAtTime(bt),Ht=this.rx.getValueAtTime(bt),Kt=this.or.getValueAtTime(bt);kt.rotateZ(-St*this.rz.mult).rotateY(jt*this.ry.mult).rotateX(Ht*this.rx.mult).rotateZ(-Kt[2]*this.or.mult).rotateY(Kt[1]*this.or.mult).rotateX(Kt[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var ir=this.px.getValueAtTime(bt),nr=this.py.getValueAtTime(bt);if(this.data.p.z){var kr=this.pz.getValueAtTime(bt);kt.translate(ir*this.px.mult,nr*this.py.mult,-kr*this.pz.mult)}else kt.translate(ir*this.px.mult,nr*this.py.mult,0)}else{var br=this.p.getValueAtTime(bt);kt.translate(br[0]*this.p.mult,br[1]*this.p.mult,-br[2]*this.p.mult)}return kt}function $(){return this.v.clone(new Matrix)}var it=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(bt,kt,Dt){var At=it(bt,kt,Dt);return At.dynamicProperties.length?At.getValueAtTime=b.bind(At):At.getValueAtTime=$.bind(At),At.setGroupProperty=expressionHelpers.setGroupProperty,At};var at=PropertyFactory.getProp;PropertyFactory.getProp=function(bt,kt,Dt,At,Bt){var Tt=at(bt,kt,Dt,At,Bt);Tt.kf?Tt.getValueAtTime=expressionHelpers.getValueAtTime.bind(Tt):Tt.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(Tt),Tt.setGroupProperty=expressionHelpers.setGroupProperty,Tt.loopOut=e,Tt.loopIn=i,Tt.smooth=c,Tt.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(Tt),Tt.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(Tt),Tt.numKeys=kt.a===1?kt.k.length:0,Tt.propertyIndex=kt.ix;var It=0;return Dt!==0&&(It=createTypedArray("float32",kt.a===1?kt.k[0].s.length:kt.k.length)),Tt._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:It},expressionHelpers.searchExpressions(bt,kt,Tt),Tt.k&&Bt.addDynamicProperty(Tt),Tt};function h(bt){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),bt*=this.elem.globalData.frameRate,bt-=this.offsetTime,bt!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<bt?this._caching.lastIndex:0,this._cachingAtTime.lastTime=bt,this.interpolateShape(bt,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue}var dt=ShapePropertyFactory.getConstructorFunction(),ft=ShapePropertyFactory.getKeyframedConstructorFunction();function xt(){}xt.prototype={vertices:function(kt,Dt){this.k&&this.getValue();var At=this.v;Dt!==void 0&&(At=this.getValueAtTime(Dt,0));var Bt,Tt=At._length,It=At[kt],St=At.v,jt=createSizedArray(Tt);for(Bt=0;Bt<Tt;Bt+=1)kt==="i"||kt==="o"?jt[Bt]=[It[Bt][0]-St[Bt][0],It[Bt][1]-St[Bt][1]]:jt[Bt]=[It[Bt][0],It[Bt][1]];return jt},points:function(kt){return this.vertices("v",kt)},inTangents:function(kt){return this.vertices("i",kt)},outTangents:function(kt){return this.vertices("o",kt)},isClosed:function(){return this.v.c},pointOnPath:function(kt,Dt){var At=this.v;Dt!==void 0&&(At=this.getValueAtTime(Dt,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(At));for(var Bt=this._segmentsLength,Tt=Bt.lengths,It=Bt.totalLength*kt,St=0,jt=Tt.length,Ht=0,Kt;St<jt;){if(Ht+Tt[St].addedLength>It){var ir=St,nr=At.c&&St===jt-1?0:St+1,kr=(It-Ht)/Tt[St].addedLength;Kt=bez.getPointInSegment(At.v[ir],At.v[nr],At.o[ir],At.i[nr],kr,Tt[St]);break}else Ht+=Tt[St].addedLength;St+=1}return Kt||(Kt=At.c?[At.v[0][0],At.v[0][1]]:[At.v[At._length-1][0],At.v[At._length-1][1]]),Kt},vectorOnPath:function(kt,Dt,At){kt==1?kt=this.v.c:kt==0&&(kt=.999);var Bt=this.pointOnPath(kt,Dt),Tt=this.pointOnPath(kt+.001,Dt),It=Tt[0]-Bt[0],St=Tt[1]-Bt[1],jt=Math.sqrt(Math.pow(It,2)+Math.pow(St,2));if(jt===0)return[0,0];var Ht=At==="tangent"?[It/jt,St/jt]:[-St/jt,It/jt];return Ht},tangentOnPath:function(kt,Dt){return this.vectorOnPath(kt,Dt,"tangent")},normalOnPath:function(kt,Dt){return this.vectorOnPath(kt,Dt,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([xt],dt),extendPrototype([xt],ft),ft.prototype.getValueAtTime=h,ft.prototype.initiateExpression=ExpressionManager.initiateExpression;var Ct=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(bt,kt,Dt,At,Bt){var Tt=Ct(bt,kt,Dt,At,Bt);return Tt.propertyIndex=kt.ix,Tt.lock=!1,Dt===3?expressionHelpers.searchExpressions(bt,kt.pt,Tt):Dt===4&&expressionHelpers.searchExpressions(bt,kt.ks,Tt),Tt.k&&bt.addDynamicProperty(Tt),Tt}}function initialize$1(){addPropertyDecorator()}function addDecorator(){function e(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}TextProperty.prototype.getExpressionValue=function(i,c){var b=this.calculateExpression(c);if(i.t!==b){var $={};return this.copyData($,i),$.t=b.toString(),$.__complete=!1,$}return i},TextProperty.prototype.searchProperty=function(){var i=this.searchKeyframes(),c=this.searchExpressions();return this.kf=i||c,this.kf},TextProperty.prototype.searchExpressions=e}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function e(i,c){var b=createNS("feMerge");b.setAttribute("result",i);var $,it;for(it=0;it<c.length;it+=1)$=createNS("feMergeNode"),$.setAttribute("in",c[it]),b.appendChild($),b.appendChild($);return b}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(e,i,c,b,$){this.filterManager=i;var it=createNS("feColorMatrix");it.setAttribute("type","matrix"),it.setAttribute("color-interpolation-filters","linearRGB"),it.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=it,it.setAttribute("result",b+"_tint_1"),e.appendChild(it),it=createNS("feColorMatrix"),it.setAttribute("type","matrix"),it.setAttribute("color-interpolation-filters","sRGB"),it.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),it.setAttribute("result",b+"_tint_2"),e.appendChild(it),this.matrixFilter=it;var at=this.createMergeNode(b,[$,b+"_tint_1",b+"_tint_2"]);e.appendChild(at)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[0].p.v,c=this.filterManager.effectElements[1].p.v,b=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+b+" 0"),this.matrixFilter.setAttribute("values",c[0]-i[0]+" 0 0 0 "+i[0]+" "+(c[1]-i[1])+" 0 0 0 "+i[1]+" "+(c[2]-i[2])+" 0 0 0 "+i[2]+" 0 0 0 1 0")}};function SVGFillFilter(e,i,c,b){this.filterManager=i;var $=createNS("feColorMatrix");$.setAttribute("type","matrix"),$.setAttribute("color-interpolation-filters","sRGB"),$.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),$.setAttribute("result",b),e.appendChild($),this.matrixFilter=$}SVGFillFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[2].p.v,c=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+i[0]+" 0 0 0 0 "+i[1]+" 0 0 0 0 "+i[2]+" 0 0 0 "+c+" 0")}};function SVGStrokeEffect(e,i,c){this.initialized=!1,this.filterManager=i,this.elem=c,this.paths=[]}SVGStrokeEffect.prototype.initialize=function(){var e=this.elem.layerElement.children||this.elem.layerElement.childNodes,i,c,b,$;for(this.filterManager.effectElements[1].p.v===1?($=this.elem.maskManager.masksProperties.length,b=0):(b=this.filterManager.effectElements[0].p.v-1,$=b+1),c=createNS("g"),c.setAttribute("fill","none"),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-dashoffset",1),b;b<$;b+=1)i=createNS("path"),c.appendChild(i),this.paths.push({p:i,m:b});if(this.filterManager.effectElements[10].p.v===3){var it=createNS("mask"),at=createElementID();it.setAttribute("id",at),it.setAttribute("mask-type","alpha"),it.appendChild(c),this.elem.globalData.defs.appendChild(it);var h=createNS("g");for(h.setAttribute("mask","url("+getLocationHref()+"#"+at+")");e[0];)h.appendChild(e[0]);this.elem.layerElement.appendChild(h),this.masker=it,c.setAttribute("stroke","#fff")}else if(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2){if(this.filterManager.effectElements[10].p.v===2)for(e=this.elem.layerElement.children||this.elem.layerElement.childNodes;e.length;)this.elem.layerElement.removeChild(e[0]);this.elem.layerElement.appendChild(c),this.elem.layerElement.removeAttribute("mask"),c.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=c},SVGStrokeEffect.prototype.renderFrame=function(e){this.initialized||this.initialize();var i,c=this.paths.length,b,$;for(i=0;i<c;i+=1)if(this.paths[i].m!==-1&&(b=this.elem.maskManager.viewData[this.paths[i].m],$=this.paths[i].p,(e||this.filterManager._mdf||b.prop._mdf)&&$.setAttribute("d",b.lastPath),e||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||b.prop._mdf)){var it;if(this.filterManager.effectElements[7].p.v!==0||this.filterManager.effectElements[8].p.v!==100){var at=Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,h=Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,dt=$.getTotalLength();it="0 0 0 "+dt*at+" ";var ft=dt*(h-at),xt=1+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01,Ct=Math.floor(ft/xt),bt;for(bt=0;bt<Ct;bt+=1)it+="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01+" ";it+="0 "+dt*10+" 0 0"}else it="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01;$.setAttribute("stroke-dasharray",it)}if((e||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",this.filterManager.effectElements[4].p.v*2),(e||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2)&&(e||this.filterManager.effectElements[3].p._mdf)){var kt=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(kt[0]*255)+","+bmFloor(kt[1]*255)+","+bmFloor(kt[2]*255)+")")}};function SVGTritoneFilter(e,i,c,b){this.filterManager=i;var $=createNS("feColorMatrix");$.setAttribute("type","matrix"),$.setAttribute("color-interpolation-filters","linearRGB"),$.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),e.appendChild($);var it=createNS("feComponentTransfer");it.setAttribute("color-interpolation-filters","sRGB"),it.setAttribute("result",b),this.matrixFilter=it;var at=createNS("feFuncR");at.setAttribute("type","table"),it.appendChild(at),this.feFuncR=at;var h=createNS("feFuncG");h.setAttribute("type","table"),it.appendChild(h),this.feFuncG=h;var dt=createNS("feFuncB");dt.setAttribute("type","table"),it.appendChild(dt),this.feFuncB=dt,e.appendChild(it)}SVGTritoneFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[0].p.v,c=this.filterManager.effectElements[1].p.v,b=this.filterManager.effectElements[2].p.v,$=b[0]+" "+c[0]+" "+i[0],it=b[1]+" "+c[1]+" "+i[1],at=b[2]+" "+c[2]+" "+i[2];this.feFuncR.setAttribute("tableValues",$),this.feFuncG.setAttribute("tableValues",it),this.feFuncB.setAttribute("tableValues",at)}};function SVGProLevelsFilter(e,i,c,b){this.filterManager=i;var $=this.filterManager.effectElements,it=createNS("feComponentTransfer");($[10].p.k||$[10].p.v!==0||$[11].p.k||$[11].p.v!==1||$[12].p.k||$[12].p.v!==1||$[13].p.k||$[13].p.v!==0||$[14].p.k||$[14].p.v!==1)&&(this.feFuncR=this.createFeFunc("feFuncR",it)),($[17].p.k||$[17].p.v!==0||$[18].p.k||$[18].p.v!==1||$[19].p.k||$[19].p.v!==1||$[20].p.k||$[20].p.v!==0||$[21].p.k||$[21].p.v!==1)&&(this.feFuncG=this.createFeFunc("feFuncG",it)),($[24].p.k||$[24].p.v!==0||$[25].p.k||$[25].p.v!==1||$[26].p.k||$[26].p.v!==1||$[27].p.k||$[27].p.v!==0||$[28].p.k||$[28].p.v!==1)&&(this.feFuncB=this.createFeFunc("feFuncB",it)),($[31].p.k||$[31].p.v!==0||$[32].p.k||$[32].p.v!==1||$[33].p.k||$[33].p.v!==1||$[34].p.k||$[34].p.v!==0||$[35].p.k||$[35].p.v!==1)&&(this.feFuncA=this.createFeFunc("feFuncA",it)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(it.setAttribute("color-interpolation-filters","sRGB"),e.appendChild(it)),($[3].p.k||$[3].p.v!==0||$[4].p.k||$[4].p.v!==1||$[5].p.k||$[5].p.v!==1||$[6].p.k||$[6].p.v!==0||$[7].p.k||$[7].p.v!==1)&&(it=createNS("feComponentTransfer"),it.setAttribute("color-interpolation-filters","sRGB"),it.setAttribute("result",b),e.appendChild(it),this.feFuncRComposed=this.createFeFunc("feFuncR",it),this.feFuncGComposed=this.createFeFunc("feFuncG",it),this.feFuncBComposed=this.createFeFunc("feFuncB",it))}SVGProLevelsFilter.prototype.createFeFunc=function(e,i){var c=createNS(e);return c.setAttribute("type","table"),i.appendChild(c),c},SVGProLevelsFilter.prototype.getTableValue=function(e,i,c,b,$){for(var it=0,at=256,h,dt=Math.min(e,i),ft=Math.max(e,i),xt=Array.call(null,{length:at}),Ct,bt=0,kt=$-b,Dt=i-e;it<=256;)h=it/256,h<=dt?Ct=Dt<0?$:b:h>=ft?Ct=Dt<0?b:$:Ct=b+kt*Math.pow((h-e)/Dt,1/c),xt[bt]=Ct,bt+=1,it+=256/(at-1);return xt.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i,c=this.filterManager.effectElements;this.feFuncRComposed&&(e||c[3].p._mdf||c[4].p._mdf||c[5].p._mdf||c[6].p._mdf||c[7].p._mdf)&&(i=this.getTableValue(c[3].p.v,c[4].p.v,c[5].p.v,c[6].p.v,c[7].p.v),this.feFuncRComposed.setAttribute("tableValues",i),this.feFuncGComposed.setAttribute("tableValues",i),this.feFuncBComposed.setAttribute("tableValues",i)),this.feFuncR&&(e||c[10].p._mdf||c[11].p._mdf||c[12].p._mdf||c[13].p._mdf||c[14].p._mdf)&&(i=this.getTableValue(c[10].p.v,c[11].p.v,c[12].p.v,c[13].p.v,c[14].p.v),this.feFuncR.setAttribute("tableValues",i)),this.feFuncG&&(e||c[17].p._mdf||c[18].p._mdf||c[19].p._mdf||c[20].p._mdf||c[21].p._mdf)&&(i=this.getTableValue(c[17].p.v,c[18].p.v,c[19].p.v,c[20].p.v,c[21].p.v),this.feFuncG.setAttribute("tableValues",i)),this.feFuncB&&(e||c[24].p._mdf||c[25].p._mdf||c[26].p._mdf||c[27].p._mdf||c[28].p._mdf)&&(i=this.getTableValue(c[24].p.v,c[25].p.v,c[26].p.v,c[27].p.v,c[28].p.v),this.feFuncB.setAttribute("tableValues",i)),this.feFuncA&&(e||c[31].p._mdf||c[32].p._mdf||c[33].p._mdf||c[34].p._mdf||c[35].p._mdf)&&(i=this.getTableValue(c[31].p.v,c[32].p.v,c[33].p.v,c[34].p.v,c[35].p.v),this.feFuncA.setAttribute("tableValues",i))}};function SVGDropShadowEffect(e,i,c,b,$){var it=i.container.globalData.renderConfig.filterSize,at=i.data.fs||it;e.setAttribute("x",at.x||it.x),e.setAttribute("y",at.y||it.y),e.setAttribute("width",at.width||it.width),e.setAttribute("height",at.height||it.height),this.filterManager=i;var h=createNS("feGaussianBlur");h.setAttribute("in","SourceAlpha"),h.setAttribute("result",b+"_drop_shadow_1"),h.setAttribute("stdDeviation","0"),this.feGaussianBlur=h,e.appendChild(h);var dt=createNS("feOffset");dt.setAttribute("dx","25"),dt.setAttribute("dy","0"),dt.setAttribute("in",b+"_drop_shadow_1"),dt.setAttribute("result",b+"_drop_shadow_2"),this.feOffset=dt,e.appendChild(dt);var ft=createNS("feFlood");ft.setAttribute("flood-color","#00ff00"),ft.setAttribute("flood-opacity","1"),ft.setAttribute("result",b+"_drop_shadow_3"),this.feFlood=ft,e.appendChild(ft);var xt=createNS("feComposite");xt.setAttribute("in",b+"_drop_shadow_3"),xt.setAttribute("in2",b+"_drop_shadow_2"),xt.setAttribute("operator","in"),xt.setAttribute("result",b+"_drop_shadow_4"),e.appendChild(xt);var Ct=this.createMergeNode(b,[b+"_drop_shadow_4",$]);e.appendChild(Ct)}extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){if((e||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),e||this.filterManager.effectElements[0].p._mdf){var i=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(i[0]*255),Math.round(i[1]*255),Math.round(i[2]*255)))}if((e||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),e||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var c=this.filterManager.effectElements[3].p.v,b=(this.filterManager.effectElements[2].p.v-90)*degToRads,$=c*Math.cos(b),it=c*Math.sin(b);this.feOffset.setAttribute("dx",$),this.feOffset.setAttribute("dy",it)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(e,i,c){this.initialized=!1,this.filterManager=i,this.filterElem=e,this.elem=c,c.matteElement=createNS("g"),c.matteElement.appendChild(c.layerElement),c.matteElement.appendChild(c.transformedElement),c.baseElement=c.matteElement}SVGMatte3Effect.prototype.findSymbol=function(e){for(var i=0,c=_svgMatteSymbols.length;i<c;){if(_svgMatteSymbols[i]===e)return _svgMatteSymbols[i];i+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(e,i){var c=e.layerElement.parentNode;if(c){for(var b=c.children,$=0,it=b.length;$<it&&b[$]!==e.layerElement;)$+=1;var at;$<=it-2&&(at=b[$+1]);var h=createNS("use");h.setAttribute("href","#"+i),at?c.insertBefore(h,at):c.appendChild(h)}},SVGMatte3Effect.prototype.setElementAsMask=function(e,i){if(!this.findSymbol(i)){var c=createElementID(),b=createNS("mask");b.setAttribute("id",i.layerId),b.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(i);var $=e.globalData.defs;$.appendChild(b);var it=createNS("symbol");it.setAttribute("id",c),this.replaceInParent(i,c),it.appendChild(i.layerElement),$.appendChild(it);var at=createNS("use");at.setAttribute("href","#"+c),b.appendChild(at),i.data.hd=!1,i.show()}e.setMatte(i.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var e=this.filterManager.effectElements[0].p.v,i=this.elem.comp.elements,c=0,b=i.length;c<b;)i[c]&&i[c].data.ind===e&&this.setElementAsMask(this.elem,i[c]),c+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()};function SVGGaussianBlurEffect(e,i,c,b){e.setAttribute("x","-100%"),e.setAttribute("y","-100%"),e.setAttribute("width","300%"),e.setAttribute("height","300%"),this.filterManager=i;var $=createNS("feGaussianBlur");$.setAttribute("result",b),e.appendChild($),this.feGaussianBlur=$}SVGGaussianBlurEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=.3,c=this.filterManager.effectElements[0].p.v*i,b=this.filterManager.effectElements[1].p.v,$=b==3?0:c,it=b==2?0:c;this.feGaussianBlur.setAttribute("stdDeviation",$+" "+it);var at=this.filterManager.effectElements[2].p.v==1?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",at)}};function TransformEffect(){}TransformEffect.prototype.init=function(e){this.effectsManager=e,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(e){if(this._opMdf=!1,this._mdf=!1,e||this.effectsManager._mdf){var i=this.effectsManager.effectElements,c=i[0].p.v,b=i[1].p.v,$=i[2].p.v===1,it=i[3].p.v,at=$?it:i[4].p.v,h=i[5].p.v,dt=i[6].p.v,ft=i[7].p.v;this.matrix.reset(),this.matrix.translate(-c[0],-c[1],c[2]),this.matrix.scale(at*.01,it*.01,1),this.matrix.rotate(-ft*degToRads),this.matrix.skewFromAxis(-h*degToRads,(dt+90)*degToRads),this.matrix.translate(b[0],b[1],0),this._mdf=!0,this.opacity!==i[8].p.v&&(this.opacity=i[8].p.v,this._opMdf=!0)}};function SVGTransformEffect(e,i){this.init(i)}extendPrototype([TransformEffect],SVGTransformEffect);function CVTransformEffect(e){this.init(e)}return extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie})})(lottie$1,lottie$1.exports);var lottieExports=lottie$1.exports;const lottie=getDefaultExportFromCjs(lottieExports);function _arrayLikeToArray(e,i){(i==null||i>e.length)&&(i=e.length);for(var c=0,b=Array(i);c<i;c++)b[c]=e[c];return b}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _defineProperty(e,i,c){return(i=_toPropertyKey(i))in e?Object.defineProperty(e,i,{value:c,enumerable:!0,configurable:!0,writable:!0}):e[i]=c,e}function _iterableToArrayLimit(e,i){var c=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(c!=null){var b,$,it,at,h=[],dt=!0,ft=!1;try{if(it=(c=c.call(e)).next,i===0){if(Object(c)!==c)return;dt=!1}else for(;!(dt=(b=it.call(c)).done)&&(h.push(b.value),h.length!==i);dt=!0);}catch(xt){ft=!0,$=xt}finally{try{if(!dt&&c.return!=null&&(at=c.return(),Object(at)!==at))return}finally{if(ft)throw $}}return h}}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ownKeys(e,i){var c=Object.keys(e);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);i&&(b=b.filter(function($){return Object.getOwnPropertyDescriptor(e,$).enumerable})),c.push.apply(c,b)}return c}function _objectSpread2(e){for(var i=1;i<arguments.length;i++){var c=arguments[i]!=null?arguments[i]:{};i%2?ownKeys(Object(c),!0).forEach(function(b){_defineProperty(e,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(c)):ownKeys(Object(c)).forEach(function(b){Object.defineProperty(e,b,Object.getOwnPropertyDescriptor(c,b))})}return e}function _objectWithoutProperties(e,i){if(e==null)return{};var c,b,$=_objectWithoutPropertiesLoose(e,i);if(Object.getOwnPropertySymbols){var it=Object.getOwnPropertySymbols(e);for(b=0;b<it.length;b++)c=it[b],i.includes(c)||{}.propertyIsEnumerable.call(e,c)&&($[c]=e[c])}return $}function _objectWithoutPropertiesLoose(e,i){if(e==null)return{};var c={};for(var b in e)if({}.hasOwnProperty.call(e,b)){if(i.includes(b))continue;c[b]=e[b]}return c}function _slicedToArray(e,i){return _arrayWithHoles(e)||_iterableToArrayLimit(e,i)||_unsupportedIterableToArray(e,i)||_nonIterableRest()}function _toPrimitive(e,i){if(typeof e!="object"||!e)return e;var c=e[Symbol.toPrimitive];if(c!==void 0){var b=c.call(e,i||"default");if(typeof b!="object")return b;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function _toPropertyKey(e){var i=_toPrimitive(e,"string");return typeof i=="symbol"?i:i+""}function _unsupportedIterableToArray(e,i){if(e){if(typeof e=="string")return _arrayLikeToArray(e,i);var c={}.toString.call(e).slice(8,-1);return c==="Object"&&e.constructor&&(c=e.constructor.name),c==="Map"||c==="Set"?Array.from(e):c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(e,i):void 0}}var _excluded$1=["animationData","loop","autoplay","initialSegment","onComplete","onLoopComplete","onEnterFrame","onSegmentStart","onConfigReady","onDataReady","onDataFailed","onLoadedImages","onDOMLoaded","onDestroy","lottieRef","renderer","name","assetsPath","rendererSettings"],useLottie=function e(i,c){var b=i.animationData,$=i.loop,it=i.autoplay,at=i.initialSegment,h=i.onComplete,dt=i.onLoopComplete,ft=i.onEnterFrame,xt=i.onSegmentStart,Ct=i.onConfigReady,bt=i.onDataReady,kt=i.onDataFailed,Dt=i.onLoadedImages,At=i.onDOMLoaded,Bt=i.onDestroy;i.lottieRef,i.renderer,i.name,i.assetsPath,i.rendererSettings;var Tt=_objectWithoutProperties(i,_excluded$1),It=reactExports.useState(!1),St=_slicedToArray(It,2),jt=St[0],Ht=St[1],Kt=reactExports.useRef(),ir=reactExports.useRef(null),nr=function(){var pn;(pn=Kt.current)===null||pn===void 0||pn.play()},kr=function(){var pn;(pn=Kt.current)===null||pn===void 0||pn.stop()},br=function(){var pn;(pn=Kt.current)===null||pn===void 0||pn.pause()},Sr=function(pn){var On;(On=Kt.current)===null||On===void 0||On.setSpeed(pn)},$r=function(pn,On){var Zn;(Zn=Kt.current)===null||Zn===void 0||Zn.goToAndPlay(pn,On)},rn=function(pn,On){var Zn;(Zn=Kt.current)===null||Zn===void 0||Zn.goToAndStop(pn,On)},Zr=function(pn){var On;(On=Kt.current)===null||On===void 0||On.setDirection(pn)},Kr=function(pn,On){var Zn;(Zn=Kt.current)===null||Zn===void 0||Zn.playSegments(pn,On)},Xt=function(pn){var On;(On=Kt.current)===null||On===void 0||On.setSubframe(pn)},mr=function(pn){var On;return(On=Kt.current)===null||On===void 0?void 0:On.getDuration(pn)},Ut=function(){var pn;(pn=Kt.current)===null||pn===void 0||pn.destroy(),Kt.current=void 0},Jt=function(){var pn=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},On;if(ir.current){(On=Kt.current)===null||On===void 0||On.destroy();var Zn=_objectSpread2(_objectSpread2(_objectSpread2({},i),pn),{},{container:ir.current});return Kt.current=lottie.loadAnimation(Zn),Ht(!!Kt.current),function(){var As;(As=Kt.current)===null||As===void 0||As.destroy(),Kt.current=void 0}}};reactExports.useEffect(function(){var Cr=Jt();return function(){return Cr==null?void 0:Cr()}},[b,$]),reactExports.useEffect(function(){Kt.current&&(Kt.current.autoplay=!!it)},[it]),reactExports.useEffect(function(){if(Kt.current){if(!at){Kt.current.resetSegments(!0);return}!Array.isArray(at)||!at.length||((Kt.current.currentRawFrame<at[0]||Kt.current.currentRawFrame>at[1])&&(Kt.current.currentRawFrame=at[0]),Kt.current.setSegment(at[0],at[1]))}},[at]),reactExports.useEffect(function(){var Cr=[{name:"complete",handler:h},{name:"loopComplete",handler:dt},{name:"enterFrame",handler:ft},{name:"segmentStart",handler:xt},{name:"config_ready",handler:Ct},{name:"data_ready",handler:bt},{name:"data_failed",handler:kt},{name:"loaded_images",handler:Dt},{name:"DOMLoaded",handler:At},{name:"destroy",handler:Bt}],pn=Cr.filter(function(Zn){return Zn.handler!=null});if(pn.length){var On=pn.map(function(Zn){var As;return(As=Kt.current)===null||As===void 0||As.addEventListener(Zn.name,Zn.handler),function(){var ss;(ss=Kt.current)===null||ss===void 0||ss.removeEventListener(Zn.name,Zn.handler)}});return function(){On.forEach(function(Zn){return Zn()})}}},[h,dt,ft,xt,Ct,bt,kt,Dt,At,Bt]);var Or=React$2.createElement("div",_objectSpread2({style:c,ref:ir},Tt));return{View:Or,play:nr,stop:kr,pause:br,setSpeed:Sr,goToAndStop:rn,goToAndPlay:$r,setDirection:Zr,playSegments:Kr,setSubframe:Xt,getDuration:mr,destroy:Ut,animationContainerRef:ir,animationLoaded:jt,animationItem:Kt.current}};function getContainerVisibility(e){var i=e.getBoundingClientRect(),c=i.top,b=i.height,$=window.innerHeight-c,it=window.innerHeight+b;return $/it}function getContainerCursorPosition(e,i,c){var b=e.getBoundingClientRect(),$=b.top,it=b.left,at=b.width,h=b.height,dt=(i-it)/at,ft=(c-$)/h;return{x:dt,y:ft}}var useInitInteractivity=function e(i){var c=i.wrapperRef,b=i.animationItem,$=i.mode,it=i.actions;reactExports.useEffect(function(){var at=c.current;if(!(!at||!b||!it.length)){b.stop();var h=function(){var xt=null,Ct=function(){var kt=getContainerVisibility(at),Dt=it.find(function(Bt){var Tt=Bt.visibility;return Tt&&kt>=Tt[0]&&kt<=Tt[1]});if(Dt){if(Dt.type==="seek"&&Dt.visibility&&Dt.frames.length===2){var At=Dt.frames[0]+Math.ceil((kt-Dt.visibility[0])/(Dt.visibility[1]-Dt.visibility[0])*Dt.frames[1]);//! goToAndStop must be relative to the start of the current segment
b.goToAndStop(At-b.firstFrame-1,!0)}Dt.type==="loop"&&(xt===null||xt!==Dt.frames||b.isPaused)&&(b.playSegments(Dt.frames,!0),xt=Dt.frames),Dt.type==="play"&&b.isPaused&&(b.resetSegments(!0),b.play()),Dt.type==="stop"&&b.goToAndStop(Dt.frames[0]-b.firstFrame-1,!0)}};return document.addEventListener("scroll",Ct),function(){document.removeEventListener("scroll",Ct)}},dt=function(){var xt=function(Dt,At){var Bt=Dt,Tt=At;if(Bt!==-1&&Tt!==-1){var It=getContainerCursorPosition(at,Bt,Tt);Bt=It.x,Tt=It.y}var St=it.find(function(Kt){var ir=Kt.position;return ir&&Array.isArray(ir.x)&&Array.isArray(ir.y)?Bt>=ir.x[0]&&Bt<=ir.x[1]&&Tt>=ir.y[0]&&Tt<=ir.y[1]:ir&&!Number.isNaN(ir.x)&&!Number.isNaN(ir.y)?Bt===ir.x&&Tt===ir.y:!1});if(St){if(St.type==="seek"&&St.position&&Array.isArray(St.position.x)&&Array.isArray(St.position.y)&&St.frames.length===2){var jt=(Bt-St.position.x[0])/(St.position.x[1]-St.position.x[0]),Ht=(Tt-St.position.y[0])/(St.position.y[1]-St.position.y[0]);b.playSegments(St.frames,!0),b.goToAndStop(Math.ceil((jt+Ht)/2*(St.frames[1]-St.frames[0])),!0)}St.type==="loop"&&b.playSegments(St.frames,!0),St.type==="play"&&(b.isPaused&&b.resetSegments(!1),b.playSegments(St.frames)),St.type==="stop"&&b.goToAndStop(St.frames[0],!0)}},Ct=function(Dt){xt(Dt.clientX,Dt.clientY)},bt=function(){xt(-1,-1)};return at.addEventListener("mousemove",Ct),at.addEventListener("mouseout",bt),function(){at.removeEventListener("mousemove",Ct),at.removeEventListener("mouseout",bt)}};switch($){case"scroll":return h();case"cursor":return dt()}}},[$,b])},useLottieInteractivity=function e(i){var c=i.actions,b=i.mode,$=i.lottieObj,it=$.animationItem,at=$.View,h=$.animationContainerRef;return useInitInteractivity({actions:c,animationItem:it,mode:b,wrapperRef:h}),at},_excluded=["style","interactivity"],Lottie=function e(i){var c,b,$,it=i.style,at=i.interactivity,h=_objectWithoutProperties(i,_excluded),dt=useLottie(h,it),ft=dt.View,xt=dt.play,Ct=dt.stop,bt=dt.pause,kt=dt.setSpeed,Dt=dt.goToAndStop,At=dt.goToAndPlay,Bt=dt.setDirection,Tt=dt.playSegments,It=dt.setSubframe,St=dt.getDuration,jt=dt.destroy,Ht=dt.animationContainerRef,Kt=dt.animationLoaded,ir=dt.animationItem;return reactExports.useEffect(function(){i.lottieRef&&(i.lottieRef.current={play:xt,stop:Ct,pause:bt,setSpeed:kt,goToAndPlay:At,goToAndStop:Dt,setDirection:Bt,playSegments:Tt,setSubframe:It,getDuration:St,destroy:jt,animationContainerRef:Ht,animationLoaded:Kt,animationItem:ir})},[(c=i.lottieRef)===null||c===void 0?void 0:c.current]),useLottieInteractivity({lottieObj:{View:ft,play:xt,stop:Ct,pause:bt,setSpeed:kt,goToAndStop:Dt,goToAndPlay:At,setDirection:Bt,playSegments:Tt,setSubframe:It,getDuration:St,destroy:jt,animationContainerRef:Ht,animationLoaded:Kt,animationItem:ir},actions:(b=at==null?void 0:at.actions)!==null&&b!==void 0?b:[],mode:($=at==null?void 0:at.mode)!==null&&$!==void 0?$:"scroll"})},pose={};(function(){var e;function i(wt){var Nt=0;return function(){return Nt<wt.length?{done:!1,value:wt[Nt++]}:{done:!0}}}var c=typeof Object.defineProperties=="function"?Object.defineProperty:function(wt,Nt,Zt){return wt==Array.prototype||wt==Object.prototype||(wt[Nt]=Zt.value),wt};function b(wt){wt=[typeof globalThis=="object"&&globalThis,wt,typeof window=="object"&&window,typeof self=="object"&&self,typeof commonjsGlobal=="object"&&commonjsGlobal];for(var Nt=0;Nt<wt.length;++Nt){var Zt=wt[Nt];if(Zt&&Zt.Math==Math)return Zt}throw Error("Cannot find global object")}var $=b(this);function it(wt,Nt){if(Nt)e:{var Zt=$;wt=wt.split(".");for(var cr=0;cr<wt.length-1;cr++){var Mr=wt[cr];if(!(Mr in Zt))break e;Zt=Zt[Mr]}wt=wt[wt.length-1],cr=Zt[wt],Nt=Nt(cr),Nt!=cr&&Nt!=null&&c(Zt,wt,{configurable:!0,writable:!0,value:Nt})}}it("Symbol",function(wt){function Nt(zr){if(this instanceof Nt)throw new TypeError("Symbol is not a constructor");return new Zt(cr+(zr||"")+"_"+Mr++,zr)}function Zt(zr,Dr){this.h=zr,c(this,"description",{configurable:!0,writable:!0,value:Dr})}if(wt)return wt;Zt.prototype.toString=function(){return this.h};var cr="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Mr=0;return Nt}),it("Symbol.iterator",function(wt){if(wt)return wt;wt=Symbol("Symbol.iterator");for(var Nt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Zt=0;Zt<Nt.length;Zt++){var cr=$[Nt[Zt]];typeof cr=="function"&&typeof cr.prototype[wt]!="function"&&c(cr.prototype,wt,{configurable:!0,writable:!0,value:function(){return at(i(this))}})}return wt});function at(wt){return wt={next:wt},wt[Symbol.iterator]=function(){return this},wt}function h(wt){var Nt=typeof Symbol<"u"&&Symbol.iterator&&wt[Symbol.iterator];return Nt?Nt.call(wt):{next:i(wt)}}function dt(wt){if(!(wt instanceof Array)){wt=h(wt);for(var Nt,Zt=[];!(Nt=wt.next()).done;)Zt.push(Nt.value);wt=Zt}return wt}var ft=typeof Object.assign=="function"?Object.assign:function(wt,Nt){for(var Zt=1;Zt<arguments.length;Zt++){var cr=arguments[Zt];if(cr)for(var Mr in cr)Object.prototype.hasOwnProperty.call(cr,Mr)&&(wt[Mr]=cr[Mr])}return wt};it("Object.assign",function(wt){return wt||ft});var xt=typeof Object.create=="function"?Object.create:function(wt){function Nt(){}return Nt.prototype=wt,new Nt},Ct;if(typeof Object.setPrototypeOf=="function")Ct=Object.setPrototypeOf;else{var bt;e:{var kt={a:!0},Dt={};try{Dt.__proto__=kt,bt=Dt.a;break e}catch{}bt=!1}Ct=bt?function(wt,Nt){if(wt.__proto__=Nt,wt.__proto__!==Nt)throw new TypeError(wt+" is not extensible");return wt}:null}var At=Ct;function Bt(wt,Nt){if(wt.prototype=xt(Nt.prototype),wt.prototype.constructor=wt,At)At(wt,Nt);else for(var Zt in Nt)if(Zt!="prototype")if(Object.defineProperties){var cr=Object.getOwnPropertyDescriptor(Nt,Zt);cr&&Object.defineProperty(wt,Zt,cr)}else wt[Zt]=Nt[Zt];wt.za=Nt.prototype}function Tt(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function It(wt){if(wt.m)throw new TypeError("Generator is already running");wt.m=!0}Tt.prototype.u=function(wt){this.i=wt};function St(wt,Nt){wt.l={ma:Nt,na:!0},wt.h=wt.s||wt.v}Tt.prototype.return=function(wt){this.l={return:wt},this.h=this.v};function jt(wt,Nt,Zt){return wt.h=Zt,{value:Nt}}function Ht(wt){this.h=new Tt,this.i=wt}function Kt(wt,Nt){It(wt.h);var Zt=wt.h.j;return Zt?ir(wt,"return"in Zt?Zt.return:function(cr){return{value:cr,done:!0}},Nt,wt.h.return):(wt.h.return(Nt),nr(wt))}function ir(wt,Nt,Zt,cr){try{var Mr=Nt.call(wt.h.j,Zt);if(!(Mr instanceof Object))throw new TypeError("Iterator result "+Mr+" is not an object");if(!Mr.done)return wt.h.m=!1,Mr;var zr=Mr.value}catch(Dr){return wt.h.j=null,St(wt.h,Dr),nr(wt)}return wt.h.j=null,cr.call(wt.h,zr),nr(wt)}function nr(wt){for(;wt.h.h;)try{var Nt=wt.i(wt.h);if(Nt)return wt.h.m=!1,{value:Nt.value,done:!1}}catch(Zt){wt.h.i=void 0,St(wt.h,Zt)}if(wt.h.m=!1,wt.h.l){if(Nt=wt.h.l,wt.h.l=null,Nt.na)throw Nt.ma;return{value:Nt.return,done:!0}}return{value:void 0,done:!0}}function kr(wt){this.next=function(Nt){return It(wt.h),wt.h.j?Nt=ir(wt,wt.h.j.next,Nt,wt.h.u):(wt.h.u(Nt),Nt=nr(wt)),Nt},this.throw=function(Nt){return It(wt.h),wt.h.j?Nt=ir(wt,wt.h.j.throw,Nt,wt.h.u):(St(wt.h,Nt),Nt=nr(wt)),Nt},this.return=function(Nt){return Kt(wt,Nt)},this[Symbol.iterator]=function(){return this}}function br(wt){function Nt(cr){return wt.next(cr)}function Zt(cr){return wt.throw(cr)}return new Promise(function(cr,Mr){function zr(Dr){Dr.done?cr(Dr.value):Promise.resolve(Dr.value).then(Nt,Zt).then(zr,Mr)}zr(wt.next())})}function Sr(wt){return br(new kr(new Ht(wt)))}it("Promise",function(wt){function Nt(Dr){this.i=0,this.j=void 0,this.h=[],this.u=!1;var Jr=this.l();try{Dr(Jr.resolve,Jr.reject)}catch(bn){Jr.reject(bn)}}function Zt(){this.h=null}function cr(Dr){return Dr instanceof Nt?Dr:new Nt(function(Jr){Jr(Dr)})}if(wt)return wt;Zt.prototype.i=function(Dr){if(this.h==null){this.h=[];var Jr=this;this.j(function(){Jr.m()})}this.h.push(Dr)};var Mr=$.setTimeout;Zt.prototype.j=function(Dr){Mr(Dr,0)},Zt.prototype.m=function(){for(;this.h&&this.h.length;){var Dr=this.h;this.h=[];for(var Jr=0;Jr<Dr.length;++Jr){var bn=Dr[Jr];Dr[Jr]=null;try{bn()}catch(Qn){this.l(Qn)}}}this.h=null},Zt.prototype.l=function(Dr){this.j(function(){throw Dr})},Nt.prototype.l=function(){function Dr(Qn){return function(as){bn||(bn=!0,Qn.call(Jr,as))}}var Jr=this,bn=!1;return{resolve:Dr(this.I),reject:Dr(this.m)}},Nt.prototype.I=function(Dr){if(Dr===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(Dr instanceof Nt)this.L(Dr);else{e:switch(typeof Dr){case"object":var Jr=Dr!=null;break e;case"function":Jr=!0;break e;default:Jr=!1}Jr?this.F(Dr):this.s(Dr)}},Nt.prototype.F=function(Dr){var Jr=void 0;try{Jr=Dr.then}catch(bn){this.m(bn);return}typeof Jr=="function"?this.M(Jr,Dr):this.s(Dr)},Nt.prototype.m=function(Dr){this.v(2,Dr)},Nt.prototype.s=function(Dr){this.v(1,Dr)},Nt.prototype.v=function(Dr,Jr){if(this.i!=0)throw Error("Cannot settle("+Dr+", "+Jr+"): Promise already settled in state"+this.i);this.i=Dr,this.j=Jr,this.i===2&&this.K(),this.H()},Nt.prototype.K=function(){var Dr=this;Mr(function(){if(Dr.D()){var Jr=$.console;typeof Jr<"u"&&Jr.error(Dr.j)}},1)},Nt.prototype.D=function(){if(this.u)return!1;var Dr=$.CustomEvent,Jr=$.Event,bn=$.dispatchEvent;return typeof bn>"u"?!0:(typeof Dr=="function"?Dr=new Dr("unhandledrejection",{cancelable:!0}):typeof Jr=="function"?Dr=new Jr("unhandledrejection",{cancelable:!0}):(Dr=$.document.createEvent("CustomEvent"),Dr.initCustomEvent("unhandledrejection",!1,!0,Dr)),Dr.promise=this,Dr.reason=this.j,bn(Dr))},Nt.prototype.H=function(){if(this.h!=null){for(var Dr=0;Dr<this.h.length;++Dr)zr.i(this.h[Dr]);this.h=null}};var zr=new Zt;return Nt.prototype.L=function(Dr){var Jr=this.l();Dr.T(Jr.resolve,Jr.reject)},Nt.prototype.M=function(Dr,Jr){var bn=this.l();try{Dr.call(Jr,bn.resolve,bn.reject)}catch(Qn){bn.reject(Qn)}},Nt.prototype.then=function(Dr,Jr){function bn(gs,Pn){return typeof gs=="function"?function(fn){try{Qn(gs(fn))}catch(ro){as(ro)}}:Pn}var Qn,as,_s=new Nt(function(gs,Pn){Qn=gs,as=Pn});return this.T(bn(Dr,Qn),bn(Jr,as)),_s},Nt.prototype.catch=function(Dr){return this.then(void 0,Dr)},Nt.prototype.T=function(Dr,Jr){function bn(){switch(Qn.i){case 1:Dr(Qn.j);break;case 2:Jr(Qn.j);break;default:throw Error("Unexpected state: "+Qn.i)}}var Qn=this;this.h==null?zr.i(bn):this.h.push(bn),this.u=!0},Nt.resolve=cr,Nt.reject=function(Dr){return new Nt(function(Jr,bn){bn(Dr)})},Nt.race=function(Dr){return new Nt(function(Jr,bn){for(var Qn=h(Dr),as=Qn.next();!as.done;as=Qn.next())cr(as.value).T(Jr,bn)})},Nt.all=function(Dr){var Jr=h(Dr),bn=Jr.next();return bn.done?cr([]):new Nt(function(Qn,as){function _s(fn){return function(ro){gs[fn]=ro,Pn--,Pn==0&&Qn(gs)}}var gs=[],Pn=0;do gs.push(void 0),Pn++,cr(bn.value).T(_s(gs.length-1),as),bn=Jr.next();while(!bn.done)})},Nt});function $r(wt,Nt){wt instanceof String&&(wt+="");var Zt=0,cr=!1,Mr={next:function(){if(!cr&&Zt<wt.length){var zr=Zt++;return{value:Nt(zr,wt[zr]),done:!1}}return cr=!0,{done:!0,value:void 0}}};return Mr[Symbol.iterator]=function(){return Mr},Mr}it("Array.prototype.keys",function(wt){return wt||function(){return $r(this,function(Nt){return Nt})}}),it("Array.prototype.fill",function(wt){return wt||function(Nt,Zt,cr){var Mr=this.length||0;for(0>Zt&&(Zt=Math.max(0,Mr+Zt)),(cr==null||cr>Mr)&&(cr=Mr),cr=Number(cr),0>cr&&(cr=Math.max(0,Mr+cr)),Zt=Number(Zt||0);Zt<cr;Zt++)this[Zt]=Nt;return this}});function rn(wt){return wt||Array.prototype.fill}it("Int8Array.prototype.fill",rn),it("Uint8Array.prototype.fill",rn),it("Uint8ClampedArray.prototype.fill",rn),it("Int16Array.prototype.fill",rn),it("Uint16Array.prototype.fill",rn),it("Int32Array.prototype.fill",rn),it("Uint32Array.prototype.fill",rn),it("Float32Array.prototype.fill",rn),it("Float64Array.prototype.fill",rn),it("Object.is",function(wt){return wt||function(Nt,Zt){return Nt===Zt?Nt!==0||1/Nt===1/Zt:Nt!==Nt&&Zt!==Zt}}),it("Array.prototype.includes",function(wt){return wt||function(Nt,Zt){var cr=this;cr instanceof String&&(cr=String(cr));var Mr=cr.length;for(Zt=Zt||0,0>Zt&&(Zt=Math.max(Zt+Mr,0));Zt<Mr;Zt++){var zr=cr[Zt];if(zr===Nt||Object.is(zr,Nt))return!0}return!1}}),it("String.prototype.includes",function(wt){return wt||function(Nt,Zt){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(Nt instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(Nt,Zt||0)!==-1}});var Zr=this||self;function Kr(wt,Nt){wt=wt.split(".");var Zt=Zr;wt[0]in Zt||typeof Zt.execScript>"u"||Zt.execScript("var "+wt[0]);for(var cr;wt.length&&(cr=wt.shift());)wt.length||Nt===void 0?Zt[cr]&&Zt[cr]!==Object.prototype[cr]?Zt=Zt[cr]:Zt=Zt[cr]={}:Zt[cr]=Nt}function Xt(wt){var Nt;e:{if((Nt=Zr.navigator)&&(Nt=Nt.userAgent))break e;Nt=""}return Nt.indexOf(wt)!=-1}var mr=Array.prototype.map?function(wt,Nt){return Array.prototype.map.call(wt,Nt,void 0)}:function(wt,Nt){for(var Zt=wt.length,cr=Array(Zt),Mr=typeof wt=="string"?wt.split(""):wt,zr=0;zr<Zt;zr++)zr in Mr&&(cr[zr]=Nt.call(void 0,Mr[zr],zr,wt));return cr},Ut={},Jt=null;function Or(wt){var Nt=wt.length,Zt=3*Nt/4;Zt%3?Zt=Math.floor(Zt):"=.".indexOf(wt[Nt-1])!=-1&&(Zt="=.".indexOf(wt[Nt-2])!=-1?Zt-2:Zt-1);var cr=new Uint8Array(Zt),Mr=0;return Cr(wt,function(zr){cr[Mr++]=zr}),Mr!==Zt?cr.subarray(0,Mr):cr}function Cr(wt,Nt){function Zt(bn){for(;cr<wt.length;){var Qn=wt.charAt(cr++),as=Jt[Qn];if(as!=null)return as;if(!/^[\s\xa0]*$/.test(Qn))throw Error("Unknown base64 encoding at char: "+Qn)}return bn}pn();for(var cr=0;;){var Mr=Zt(-1),zr=Zt(0),Dr=Zt(64),Jr=Zt(64);if(Jr===64&&Mr===-1)break;Nt(Mr<<2|zr>>4),Dr!=64&&(Nt(zr<<4&240|Dr>>2),Jr!=64&&Nt(Dr<<6&192|Jr))}}function pn(){if(!Jt){Jt={};for(var wt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),Nt=["+/=","+/","-_=","-_.","-_"],Zt=0;5>Zt;Zt++){var cr=wt.concat(Nt[Zt].split(""));Ut[Zt]=cr;for(var Mr=0;Mr<cr.length;Mr++){var zr=cr[Mr];Jt[zr]===void 0&&(Jt[zr]=Mr)}}}}var On=typeof Uint8Array<"u",Zn=!(Xt("Trident")||Xt("MSIE"))&&typeof Zr.btoa=="function";function As(wt){if(!Zn){var Nt;Nt===void 0&&(Nt=0),pn(),Nt=Ut[Nt];for(var Zt=Array(Math.floor(wt.length/3)),cr=Nt[64]||"",Mr=0,zr=0;Mr<wt.length-2;Mr+=3){var Dr=wt[Mr],Jr=wt[Mr+1],bn=wt[Mr+2],Qn=Nt[Dr>>2];Dr=Nt[(Dr&3)<<4|Jr>>4],Jr=Nt[(Jr&15)<<2|bn>>6],bn=Nt[bn&63],Zt[zr++]=Qn+Dr+Jr+bn}switch(Qn=0,bn=cr,wt.length-Mr){case 2:Qn=wt[Mr+1],bn=Nt[(Qn&15)<<2]||cr;case 1:wt=wt[Mr],Zt[zr]=Nt[wt>>2]+Nt[(wt&3)<<4|Qn>>4]+bn+cr}return Zt.join("")}for(Nt="";10240<wt.length;)Nt+=String.fromCharCode.apply(null,wt.subarray(0,10240)),wt=wt.subarray(10240);return Nt+=String.fromCharCode.apply(null,wt),btoa(Nt)}var ss=RegExp("[-_.]","g");function Ls(wt){switch(wt){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function $s(wt){if(!Zn)return Or(wt);ss.test(wt)&&(wt=wt.replace(ss,Ls)),wt=atob(wt);for(var Nt=new Uint8Array(wt.length),Zt=0;Zt<wt.length;Zt++)Nt[Zt]=wt.charCodeAt(Zt);return Nt}var vo;function Vs(){return vo||(vo=new Uint8Array(0))}var bo={},Po=typeof Uint8Array.prototype.slice=="function",ws=0,Jn=0;function Hs(wt){var Nt=0>wt;wt=Math.abs(wt);var Zt=wt>>>0;wt=Math.floor((wt-Zt)/4294967296),Nt&&(Zt=h(Xo(Zt,wt)),Nt=Zt.next().value,wt=Zt.next().value,Zt=Nt),ws=Zt>>>0,Jn=wt>>>0}var El=typeof BigInt=="function";function Xo(wt,Nt){return Nt=~Nt,wt?wt=~wt+1:Nt+=1,[wt,Nt]}function _l(wt,Nt){this.i=wt>>>0,this.h=Nt>>>0}function Io(wt){if(!wt)return Pl||(Pl=new _l(0,0));if(!/^-?\d+$/.test(wt))return null;if(16>wt.length)Hs(Number(wt));else if(El)wt=BigInt(wt),ws=Number(wt&BigInt(4294967295))>>>0,Jn=Number(wt>>BigInt(32)&BigInt(4294967295));else{var Nt=+(wt[0]==="-");Jn=ws=0;for(var Zt=wt.length,cr=Nt,Mr=(Zt-Nt)%6+Nt;Mr<=Zt;cr=Mr,Mr+=6)cr=Number(wt.slice(cr,Mr)),Jn*=1e6,ws=1e6*ws+cr,4294967296<=ws&&(Jn+=ws/4294967296|0,ws%=4294967296);Nt&&(Nt=h(Xo(ws,Jn)),wt=Nt.next().value,Nt=Nt.next().value,ws=wt,Jn=Nt)}return new _l(ws,Jn)}var Pl;function Uo(wt,Nt){return Error("Invalid wire type: "+wt+" (at position "+Nt+")")}function Fl(){return Error("Failed to read varint, encoding is invalid.")}function Vl(wt,Nt){return Error("Tried to read past the end of the data "+Nt+" > "+wt)}function _a(){throw Error("Invalid UTF8")}function Xl(wt,Nt){return Nt=String.fromCharCode.apply(null,Nt),wt==null?Nt:wt+Nt}var Go=void 0,xl,$u=typeof TextDecoder<"u",su,Mu=typeof TextEncoder<"u",Ol;function bu(wt){if(wt!==bo)throw Error("illegal external caller")}function _h(wt,Nt){if(bu(Nt),this.V=wt,wt!=null&&wt.length===0)throw Error("ByteString should be constructed with non-empty values")}function Hu(){return Ol||(Ol=new _h(null,bo))}function ku(wt){bu(bo);var Nt=wt.V;return Nt=Nt==null||On&&Nt!=null&&Nt instanceof Uint8Array?Nt:typeof Nt=="string"?$s(Nt):null,Nt==null?Nt:wt.V=Nt}function _d(wt){if(typeof wt=="string")return{buffer:$s(wt),C:!1};if(Array.isArray(wt))return{buffer:new Uint8Array(wt),C:!1};if(wt.constructor===Uint8Array)return{buffer:wt,C:!1};if(wt.constructor===ArrayBuffer)return{buffer:new Uint8Array(wt),C:!1};if(wt.constructor===_h)return{buffer:ku(wt)||Vs(),C:!0};if(wt instanceof Uint8Array)return{buffer:new Uint8Array(wt.buffer,wt.byteOffset,wt.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function dp(wt,Nt){this.i=null,this.m=!1,this.h=this.j=this.l=0,So(this,wt,Nt)}function So(wt,Nt,Zt){Zt=Zt===void 0?{}:Zt,wt.S=Zt.S===void 0?!1:Zt.S,Nt&&(Nt=_d(Nt),wt.i=Nt.buffer,wt.m=Nt.C,wt.l=0,wt.j=wt.i.length,wt.h=wt.l)}dp.prototype.reset=function(){this.h=this.l};function Qo(wt,Nt){if(wt.h=Nt,Nt>wt.j)throw Vl(wt.j,Nt)}function ep(wt){var Nt=wt.i,Zt=wt.h,cr=Nt[Zt++],Mr=cr&127;if(cr&128&&(cr=Nt[Zt++],Mr|=(cr&127)<<7,cr&128&&(cr=Nt[Zt++],Mr|=(cr&127)<<14,cr&128&&(cr=Nt[Zt++],Mr|=(cr&127)<<21,cr&128&&(cr=Nt[Zt++],Mr|=cr<<28,cr&128&&Nt[Zt++]&128&&Nt[Zt++]&128&&Nt[Zt++]&128&&Nt[Zt++]&128&&Nt[Zt++]&128)))))throw Fl();return Qo(wt,Zt),Mr}function pp(wt,Nt){if(0>Nt)throw Error("Tried to read a negative byte length: "+Nt);var Zt=wt.h,cr=Zt+Nt;if(cr>wt.j)throw Vl(Nt,wt.j-Zt);return wt.h=cr,Zt}var wu=[];function Ap(){this.h=[]}Ap.prototype.length=function(){return this.h.length},Ap.prototype.end=function(){var wt=this.h;return this.h=[],wt};function Wp(wt,Nt,Zt){for(;0<Zt||127<Nt;)wt.h.push(Nt&127|128),Nt=(Nt>>>7|Zt<<25)>>>0,Zt>>>=7;wt.h.push(Nt)}function Wu(wt,Nt){for(;127<Nt;)wt.h.push(Nt&127|128),Nt>>>=7;wt.h.push(Nt)}function yn(wt,Nt){if(wu.length){var Zt=wu.pop();So(Zt,wt,Nt),wt=Zt}else wt=new dp(wt,Nt);this.h=wt,this.j=this.h.h,this.i=this.l=-1,this.setOptions(Nt)}yn.prototype.setOptions=function(wt){wt=wt===void 0?{}:wt,this.ca=wt.ca===void 0?!1:wt.ca},yn.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function qu(wt){var Nt=wt.h;if(Nt.h==Nt.j)return!1;wt.j=wt.h.h;var Zt=ep(wt.h)>>>0;if(Nt=Zt>>>3,Zt&=7,!(0<=Zt&&5>=Zt))throw Uo(Zt,wt.j);if(1>Nt)throw Error("Invalid field number: "+Nt+" (at position "+wt.j+")");return wt.l=Nt,wt.i=Zt,!0}function qp(wt){switch(wt.i){case 0:if(wt.i!=0)qp(wt);else e:{wt=wt.h;for(var Nt=wt.h,Zt=Nt+10,cr=wt.i;Nt<Zt;)if(!(cr[Nt++]&128)){Qo(wt,Nt);break e}throw Fl()}break;case 1:wt=wt.h,Qo(wt,wt.h+8);break;case 2:wt.i!=2?qp(wt):(Nt=ep(wt.h)>>>0,wt=wt.h,Qo(wt,wt.h+Nt));break;case 5:wt=wt.h,Qo(wt,wt.h+4);break;case 3:Nt=wt.l;do{if(!qu(wt))throw Error("Unmatched start-group tag: stream EOF");if(wt.i==4){if(wt.l!=Nt)throw Error("Unmatched end-group tag");break}qp(wt)}while(1);break;default:throw Uo(wt.i,wt.j)}}var tp=[];function Lr(){this.j=[],this.i=0,this.h=new Ap}function Wt(wt,Nt){Nt.length!==0&&(wt.j.push(Nt),wt.i+=Nt.length)}function Qt(wt,Nt){if(Nt=Nt.R){Wt(wt,wt.h.end());for(var Zt=0;Zt<Nt.length;Zt++)Wt(wt,ku(Nt[Zt])||Vs())}}var lr=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function wr(wt,Nt){return lr?wt[lr]|=Nt:wt.A!==void 0?wt.A|=Nt:(Object.defineProperties(wt,{A:{value:Nt,configurable:!0,writable:!0,enumerable:!1}}),Nt)}function vr(wt,Nt){lr?wt[lr]&&(wt[lr]&=~Nt):wt.A!==void 0&&(wt.A&=~Nt)}function fr(wt){var Nt;return lr?Nt=wt[lr]:Nt=wt.A,Nt??0}function Ur(wt,Nt){lr?wt[lr]=Nt:wt.A!==void 0?wt.A=Nt:Object.defineProperties(wt,{A:{value:Nt,configurable:!0,writable:!0,enumerable:!1}})}function Rr(wt){return wr(wt,1),wt}function Xr(wt,Nt){Ur(Nt,(wt|0)&-51)}function Sn(wt,Nt){Ur(Nt,(wt|18)&-41)}var ln={};function Hn(wt){return wt!==null&&typeof wt=="object"&&!Array.isArray(wt)&&wt.constructor===Object}var rs,ds=[];Ur(ds,23),rs=Object.freeze(ds);function js(wt){if(fr(wt.o)&2)throw Error("Cannot mutate an immutable Message")}function Rs(wt){var Nt=wt.length;(Nt=Nt?wt[Nt-1]:void 0)&&Hn(Nt)?Nt.g=1:(Nt={},wt.push((Nt.g=1,Nt)))}function Fs(wt){var Nt=wt.i+wt.G;return wt.B||(wt.B=wt.o[Nt]={})}function Gs(wt,Nt){return Nt===-1?null:Nt>=wt.i?wt.B?wt.B[Nt]:void 0:wt.o[Nt+wt.G]}function Es(wt,Nt,Zt,cr){js(wt),Mo(wt,Nt,Zt,cr)}function Mo(wt,Nt,Zt,cr){wt.j&&(wt.j=void 0),Nt>=wt.i||cr?Fs(wt)[Nt]=Zt:(wt.o[Nt+wt.G]=Zt,(wt=wt.B)&&Nt in wt&&delete wt[Nt])}function Jo(wt,Nt,Zt,cr){var Mr=Gs(wt,Nt);Array.isArray(Mr)||(Mr=rs);var zr=fr(Mr);if(zr&1||Rr(Mr),cr)zr&2||wr(Mr,2),Zt&1||Object.freeze(Mr);else{cr=!(Zt&2);var Dr=zr&2;Zt&1||!Dr?cr&&zr&16&&!Dr&&vr(Mr,16):(Mr=Rr(Array.prototype.slice.call(Mr)),Mo(wt,Nt,Mr))}return Mr}function na(wt,Nt){var Zt=Gs(wt,Nt),cr=Zt==null?Zt:typeof Zt=="number"||Zt==="NaN"||Zt==="Infinity"||Zt==="-Infinity"?Number(Zt):void 0;return cr!=null&&cr!==Zt&&Mo(wt,Nt,cr),cr}function ao(wt,Nt,Zt,cr,Mr){wt.h||(wt.h={});var zr=wt.h[Zt],Dr=Jo(wt,Zt,3,Mr);if(!zr){var Jr=Dr;zr=[];var bn=!!(fr(wt.o)&16);Dr=!!(fr(Jr)&2);var Qn=Jr;!Mr&&Dr&&(Jr=Array.prototype.slice.call(Jr));for(var as=Dr,_s=0;_s<Jr.length;_s++){var gs=Jr[_s],Pn=Nt,fn=!1;if(fn=fn===void 0?!1:fn,gs=Array.isArray(gs)?new Pn(gs):fn?new Pn:void 0,gs!==void 0){Pn=gs.o;var ro=fn=fr(Pn);Dr&&(ro|=2),bn&&(ro|=16),ro!=fn&&Ur(Pn,ro),Pn=ro,as=as||!!(2&Pn),zr.push(gs)}}return wt.h[Zt]=zr,bn=fr(Jr),Nt=bn|33,Nt=as?Nt&-9:Nt|8,bn!=Nt&&(as=Jr,Object.isFrozen(as)&&(as=Array.prototype.slice.call(as)),Ur(as,Nt),Jr=as),Qn!==Jr&&Mo(wt,Zt,Jr),(Mr||cr&&Dr)&&wr(zr,2),cr&&Object.freeze(zr),zr}return Mr||(Mr=Object.isFrozen(zr),cr&&!Mr?Object.freeze(zr):!cr&&Mr&&(zr=Array.prototype.slice.call(zr),wt.h[Zt]=zr)),zr}function Ws(wt,Nt,Zt){var cr=!!(fr(wt.o)&2);if(Nt=ao(wt,Nt,Zt,cr,cr),wt=Jo(wt,Zt,3,cr),!(cr||fr(wt)&8)){for(cr=0;cr<Nt.length;cr++){if(Zt=Nt[cr],fr(Zt.o)&2){var Mr=Kp(Zt,!1);Mr.j=Zt}else Mr=Zt;Zt!==Mr&&(Nt[cr]=Mr,wt[cr]=Mr.o)}wr(wt,8)}return Nt}function ho(wt,Nt,Zt){if(Zt!=null&&typeof Zt!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof Zt+": "+Zt);Es(wt,Nt,Zt)}function zo(wt,Nt,Zt,cr,Mr){js(wt);var zr=ao(wt,Zt,Nt,!1,!1);return Zt=cr??new Zt,wt=Jo(wt,Nt,2,!1),Mr!=null?(zr.splice(Mr,0,Zt),wt.splice(Mr,0,Zt.o)):(zr.push(Zt),wt.push(Zt.o)),Zt.C()&&vr(wt,8),Zt}function po(wt,Nt){return wt??Nt}function qo(wt,Nt,Zt){return Zt=Zt===void 0?0:Zt,po(na(wt,Nt),Zt)}var Ul;function mu(wt){switch(typeof wt){case"number":return isFinite(wt)?wt:String(wt);case"object":if(wt)if(Array.isArray(wt)){if(fr(wt)&128)return wt=Array.prototype.slice.call(wt),Rs(wt),wt}else{if(On&&wt!=null&&wt instanceof Uint8Array)return As(wt);if(wt instanceof _h){var Nt=wt.V;return Nt==null?"":typeof Nt=="string"?Nt:wt.V=As(Nt)}}}return wt}function Zu(wt,Nt,Zt,cr){if(wt!=null){if(Array.isArray(wt))wt=Gl(wt,Nt,Zt,cr!==void 0);else if(Hn(wt)){var Mr={},zr;for(zr in wt)Mr[zr]=Zu(wt[zr],Nt,Zt,cr);wt=Mr}else wt=Nt(wt,cr);return wt}}function Gl(wt,Nt,Zt,cr){var Mr=fr(wt);cr=cr?!!(Mr&16):void 0,wt=Array.prototype.slice.call(wt);for(var zr=0;zr<wt.length;zr++)wt[zr]=Zu(wt[zr],Nt,Zt,cr);return Zt(Mr,wt),wt}function Zp(wt){return wt.ja===ln?wt.toJSON():mu(wt)}function P_(wt,Nt){wt&128&&Rs(Nt)}function ip(wt,Nt,Zt){if(Zt=Zt===void 0?Sn:Zt,wt!=null){if(On&&wt instanceof Uint8Array)return wt.length?new _h(new Uint8Array(wt),bo):Hu();if(Array.isArray(wt)){var cr=fr(wt);return cr&2?wt:Nt&&!(cr&32)&&(cr&16||cr===0)?(Ur(wt,cr|2),wt):(wt=Gl(wt,ip,cr&4?Sn:Zt,!0),Nt=fr(wt),Nt&4&&Nt&2&&Object.freeze(wt),wt)}return wt.ja===ln?Xp(wt):wt}}function Rp(wt,Nt,Zt,cr,Mr,zr,Dr){if(wt=wt.h&&wt.h[Zt]){if(cr=fr(wt),cr&2?cr=wt:(zr=mr(wt,Xp),Sn(cr,zr),Object.freeze(zr),cr=zr),js(Nt),Dr=cr==null?rs:Rr([]),cr!=null){for(zr=!!cr.length,wt=0;wt<cr.length;wt++){var Jr=cr[wt];zr=zr&&!(fr(Jr.o)&2),Dr[wt]=Jr.o}zr=(zr?8:0)|1,wt=fr(Dr),(wt&zr)!==zr&&(Object.isFrozen(Dr)&&(Dr=Array.prototype.slice.call(Dr)),Ur(Dr,wt|zr)),Nt.h||(Nt.h={}),Nt.h[Zt]=cr}else Nt.h&&(Nt.h[Zt]=void 0);Mo(Nt,Zt,Dr,Mr)}else Es(Nt,Zt,ip(cr,zr,Dr),Mr)}function Xp(wt){return fr(wt.o)&2||(wt=Kp(wt,!0),wr(wt.o,2)),wt}function Kp(wt,Nt){var Zt=wt.o,cr=[];wr(cr,16);var Mr=wt.constructor.h;if(Mr&&cr.push(Mr),Mr=wt.B,Mr){cr.length=Zt.length,cr.fill(void 0,cr.length,Zt.length);var zr={};cr[cr.length-1]=zr}fr(Zt)&128&&Rs(cr),Nt=Nt||wt.C()?Sn:Xr,zr=wt.constructor,Ul=cr,cr=new zr(cr),Ul=void 0,wt.R&&(cr.R=wt.R.slice()),zr=!!(fr(Zt)&16);for(var Dr=Mr?Zt.length-1:Zt.length,Jr=0;Jr<Dr;Jr++)Rp(wt,cr,Jr-wt.G,Zt[Jr],!1,zr,Nt);if(Mr)for(var bn in Mr)Rp(wt,cr,+bn,Mr[bn],!0,zr,Nt);return cr}function Il(wt,Nt,Zt){wt==null&&(wt=Ul),Ul=void 0;var cr=this.constructor.i||0,Mr=0<cr,zr=this.constructor.h,Dr=!1;if(wt==null){wt=zr?[zr]:[];var Jr=48,bn=!0;Mr&&(cr=0,Jr|=128),Ur(wt,Jr)}else{if(!Array.isArray(wt)||zr&&zr!==wt[0])throw Error();var Qn=Jr=wr(wt,0);if((bn=(16&Qn)!==0)&&((Dr=(32&Qn)!==0)||(Qn|=32)),Mr){if(128&Qn)cr=0;else if(0<wt.length){var as=wt[wt.length-1];if(Hn(as)&&"g"in as){cr=0,Qn|=128,delete as.g;var _s=!0,gs;for(gs in as){_s=!1;break}_s&&wt.pop()}}}else if(128&Qn)throw Error();Jr!==Qn&&Ur(wt,Qn)}this.G=(zr?0:-1)-cr,this.h=void 0,this.o=wt;e:{if(zr=this.o.length,cr=zr-1,zr&&(zr=this.o[cr],Hn(zr))){this.B=zr,this.i=cr-this.G;break e}Nt!==void 0&&-1<Nt?(this.i=Math.max(Nt,cr+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!Mr&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(Zt){Nt=bn&&!Dr&&!0,Mr=this.i;var Pn;for(bn=0;bn<Zt.length;bn++)Dr=Zt[bn],Dr<Mr?(Dr+=this.G,(cr=wt[Dr])?Yp(cr,Nt):wt[Dr]=rs):(Pn||(Pn=Fs(this)),(cr=Pn[Dr])?Yp(cr,Nt):Pn[Dr]=rs)}}Il.prototype.toJSON=function(){return Gl(this.o,Zp,P_)},Il.prototype.C=function(){return!!(fr(this.o)&2)};function Yp(wt,Nt){if(Array.isArray(wt)){var Zt=fr(wt),cr=1;!Nt||Zt&2||(cr|=16),(Zt&cr)!==cr&&Ur(wt,Zt|cr)}}Il.prototype.ja=ln,Il.prototype.toString=function(){return this.o.toString()};function ey(wt,Nt,Zt){if(Zt){var cr={},Mr;for(Mr in Zt){var zr=Zt[Mr],Dr=zr.ra;Dr||(cr.J=zr.xa||zr.oa.W,zr.ia?(cr.aa=fp(zr.ia),Dr=function(Jr){return function(bn,Qn,as){return Jr.J(bn,Qn,as,Jr.aa)}}(cr)):zr.ka?(cr.Z=iy(zr.da.P,zr.ka),Dr=function(Jr){return function(bn,Qn,as){return Jr.J(bn,Qn,as,Jr.Z)}}(cr)):Dr=cr.J,zr.ra=Dr),Dr(Nt,wt,zr.da),cr={J:cr.J,aa:cr.aa,Z:cr.Z}}}Qt(Nt,wt)}var gu=Symbol();function ty(wt,Nt,Zt){return wt[gu]||(wt[gu]=function(cr,Mr){return Nt(cr,Mr,Zt)})}function Cm(wt){var Nt=wt[gu];if(!Nt){var Zt=_f(wt);Nt=function(cr,Mr){return Ns(cr,Mr,Zt)},wt[gu]=Nt}return Nt}function yu(wt){var Nt=wt.ia;if(Nt)return Cm(Nt);if(Nt=wt.wa)return ty(wt.da.P,Nt,wt.ka)}function Du(wt){var Nt=yu(wt),Zt=wt.da,cr=wt.oa.U;return Nt?function(Mr,zr){return cr(Mr,zr,Zt,Nt)}:function(Mr,zr){return cr(Mr,zr,Zt)}}function Xu(wt,Nt){var Zt=wt[Nt];return typeof Zt=="function"&&Zt.length===0&&(Zt=Zt(),wt[Nt]=Zt),Array.isArray(Zt)&&(Pp in Zt||rp in Zt||0<Zt.length&&typeof Zt[0]=="function")?Zt:void 0}function Eu(wt,Nt,Zt,cr,Mr,zr){Nt.P=wt[0];var Dr=1;if(wt.length>Dr&&typeof wt[Dr]!="number"){var Jr=wt[Dr++];Zt(Nt,Jr)}for(;Dr<wt.length;){Zt=wt[Dr++];for(var bn=Dr+1;bn<wt.length&&typeof wt[bn]!="number";)bn++;switch(Jr=wt[Dr++],bn-=Dr,bn){case 0:cr(Nt,Zt,Jr);break;case 1:(bn=Xu(wt,Dr))?(Dr++,Mr(Nt,Zt,Jr,bn)):cr(Nt,Zt,Jr,wt[Dr++]);break;case 2:bn=Dr++,bn=Xu(wt,bn),Mr(Nt,Zt,Jr,bn,wt[Dr++]);break;case 3:zr(Nt,Zt,Jr,wt[Dr++],wt[Dr++],wt[Dr++]);break;case 4:zr(Nt,Zt,Jr,wt[Dr++],wt[Dr++],wt[Dr++],wt[Dr++]);break;default:throw Error("unexpected number of binary field arguments: "+bn)}}return Nt}var $l=Symbol();function fp(wt){var Nt=wt[$l];if(!Nt){var Zt=ou(wt);Nt=function(cr,Mr){return Ip(cr,Mr,Zt)},wt[$l]=Nt}return Nt}function iy(wt,Nt){var Zt=wt[$l];return Zt||(Zt=function(cr,Mr){return ey(cr,Mr,Nt)},wt[$l]=Zt),Zt}var rp=Symbol();function mp(wt,Nt){wt.push(Nt)}function Am(wt,Nt,Zt){wt.push(Nt,Zt.W)}function Rm(wt,Nt,Zt,cr){var Mr=fp(cr),zr=ou(cr).P,Dr=Zt.W;wt.push(Nt,function(Jr,bn,Qn){return Dr(Jr,bn,Qn,zr,Mr)})}function Qp(wt,Nt,Zt,cr,Mr,zr){var Dr=iy(cr,zr),Jr=Zt.W;wt.push(Nt,function(bn,Qn,as){return Jr(bn,Qn,as,cr,Dr)})}function ou(wt){var Nt=wt[rp];return Nt||(Nt=Eu(wt,wt[rp]=[],mp,Am,Rm,Qp),Pp in wt&&rp in wt&&(wt.length=0),Nt)}var Pp=Symbol();function ry(wt,Nt){wt[0]=Nt}function Jp(wt,Nt,Zt,cr){var Mr=Zt.U;wt[Nt]=cr?function(zr,Dr,Jr){return Mr(zr,Dr,Jr,cr)}:Mr}function ny(wt,Nt,Zt,cr,Mr){var zr=Zt.U,Dr=Cm(cr),Jr=_f(cr).P;wt[Nt]=function(bn,Qn,as){return zr(bn,Qn,as,Jr,Dr,Mr)}}function Zy(wt,Nt,Zt,cr,Mr,zr,Dr){var Jr=Zt.U,bn=ty(cr,Mr,zr);wt[Nt]=function(Qn,as,_s){return Jr(Qn,as,_s,cr,bn,Dr)}}function _f(wt){var Nt=wt[Pp];return Nt||(Nt=Eu(wt,wt[Pp]={},ry,Jp,ny,Zy),Pp in wt&&rp in wt&&(wt.length=0),Nt)}function Ns(wt,Nt,Zt){for(;qu(Nt)&&Nt.i!=4;){var cr=Nt.l,Mr=Zt[cr];if(!Mr){var zr=Zt[0];zr&&(zr=zr[cr])&&(Mr=Zt[cr]=Du(zr))}if(!Mr||!Mr(Nt,wt,cr)){Mr=Nt,cr=wt,zr=Mr.j,qp(Mr);var Dr=Mr;if(!Dr.ca){if(Mr=Dr.h.h-zr,Dr.h.h=zr,Dr=Dr.h,Mr==0)Mr=Hu();else{if(zr=pp(Dr,Mr),Dr.S&&Dr.m)Mr=Dr.i.subarray(zr,zr+Mr);else{Dr=Dr.i;var Jr=zr;Mr=zr+Mr,Mr=Jr===Mr?Vs():Po?Dr.slice(Jr,Mr):new Uint8Array(Dr.subarray(Jr,Mr))}Mr=Mr.length==0?Hu():new _h(Mr,bo)}(zr=cr.R)?zr.push(Mr):cr.R=[Mr]}}}return wt}function Ip(wt,Nt,Zt){for(var cr=Zt.length,Mr=cr%2==1,zr=Mr?1:0;zr<cr;zr+=2)(0,Zt[zr+1])(Nt,wt,Zt[zr]);ey(wt,Nt,Mr?Zt[0]:void 0)}function em(wt,Nt){return{U:wt,W:Nt}}var Tu=em(function(wt,Nt,Zt){if(wt.i!==5)return!1;wt=wt.h;var cr=wt.i,Mr=wt.h,zr=cr[Mr],Dr=cr[Mr+1],Jr=cr[Mr+2];return cr=cr[Mr+3],Qo(wt,wt.h+4),Dr=(zr<<0|Dr<<8|Jr<<16|cr<<24)>>>0,wt=2*(Dr>>31)+1,zr=Dr>>>23&255,Dr&=8388607,Es(Nt,Zt,zr==255?Dr?NaN:1/0*wt:zr==0?wt*Math.pow(2,-149)*Dr:wt*Math.pow(2,zr-150)*(Dr+Math.pow(2,23))),!0},function(wt,Nt,Zt){if(Nt=na(Nt,Zt),Nt!=null){Wu(wt.h,8*Zt+5),wt=wt.h;var cr=+Nt;cr===0?0<1/cr?ws=Jn=0:(Jn=0,ws=2147483648):isNaN(cr)?(Jn=0,ws=2147483647):(cr=(Zt=0>cr?-2147483648:0)?-cr:cr,34028234663852886e22<cr?(Jn=0,ws=(Zt|2139095040)>>>0):11754943508222875e-54>cr?(cr=Math.round(cr/Math.pow(2,-149)),Jn=0,ws=(Zt|cr)>>>0):(Nt=Math.floor(Math.log(cr)/Math.LN2),cr*=Math.pow(2,-Nt),cr=Math.round(8388608*cr),16777216<=cr&&++Nt,Jn=0,ws=(Zt|Nt+127<<23|cr&8388607)>>>0)),Zt=ws,wt.h.push(Zt>>>0&255),wt.h.push(Zt>>>8&255),wt.h.push(Zt>>>16&255),wt.h.push(Zt>>>24&255)}}),sy=em(function(wt,Nt,Zt){if(wt.i!==0)return!1;var cr=wt.h,Mr=0,zr=wt=0,Dr=cr.i,Jr=cr.h;do{var bn=Dr[Jr++];Mr|=(bn&127)<<zr,zr+=7}while(32>zr&&bn&128);for(32<zr&&(wt|=(bn&127)>>4),zr=3;32>zr&&bn&128;zr+=7)bn=Dr[Jr++],wt|=(bn&127)<<zr;if(Qo(cr,Jr),128>bn)cr=Mr>>>0,bn=wt>>>0,(wt=bn&2147483648)&&(cr=~cr+1>>>0,bn=~bn>>>0,cr==0&&(bn=bn+1>>>0)),cr=4294967296*bn+(cr>>>0);else throw Fl();return Es(Nt,Zt,wt?-cr:cr),!0},function(wt,Nt,Zt){Nt=Gs(Nt,Zt),Nt!=null&&(typeof Nt=="string"&&Io(Nt),Nt!=null&&(Wu(wt.h,8*Zt),typeof Nt=="number"?(wt=wt.h,Hs(Nt),Wp(wt,ws,Jn)):(Zt=Io(Nt),Wp(wt.h,Zt.i,Zt.h))))}),gp=em(function(wt,Nt,Zt){return wt.i!==0?!1:(Es(Nt,Zt,ep(wt.h)),!0)},function(wt,Nt,Zt){if(Nt=Gs(Nt,Zt),Nt!=null&&Nt!=null)if(Wu(wt.h,8*Zt),wt=wt.h,Zt=Nt,0<=Zt)Wu(wt,Zt);else{for(Nt=0;9>Nt;Nt++)wt.h.push(Zt&127|128),Zt>>=7;wt.h.push(1)}}),Mp=em(function(wt,Nt,Zt){if(wt.i!==2)return!1;var cr=ep(wt.h)>>>0;wt=wt.h;var Mr=pp(wt,cr);if(wt=wt.i,$u){var zr=wt,Dr;(Dr=xl)||(Dr=xl=new TextDecoder("utf-8",{fatal:!0})),wt=Mr+cr,zr=Mr===0&&wt===zr.length?zr:zr.subarray(Mr,wt);try{var Jr=Dr.decode(zr)}catch(_s){if(Go===void 0){try{Dr.decode(new Uint8Array([128]))}catch{}try{Dr.decode(new Uint8Array([97])),Go=!0}catch{Go=!1}}throw!Go&&(xl=void 0),_s}}else{Jr=Mr,cr=Jr+cr,Mr=[];for(var bn=null,Qn,as;Jr<cr;)Qn=wt[Jr++],128>Qn?Mr.push(Qn):224>Qn?Jr>=cr?_a():(as=wt[Jr++],194>Qn||(as&192)!==128?(Jr--,_a()):Mr.push((Qn&31)<<6|as&63)):240>Qn?Jr>=cr-1?_a():(as=wt[Jr++],(as&192)!==128||Qn===224&&160>as||Qn===237&&160<=as||((zr=wt[Jr++])&192)!==128?(Jr--,_a()):Mr.push((Qn&15)<<12|(as&63)<<6|zr&63)):244>=Qn?Jr>=cr-2?_a():(as=wt[Jr++],(as&192)!==128||(Qn<<28)+(as-144)>>30||((zr=wt[Jr++])&192)!==128||((Dr=wt[Jr++])&192)!==128?(Jr--,_a()):(Qn=(Qn&7)<<18|(as&63)<<12|(zr&63)<<6|Dr&63,Qn-=65536,Mr.push((Qn>>10&1023)+55296,(Qn&1023)+56320))):_a(),8192<=Mr.length&&(bn=Xl(bn,Mr),Mr.length=0);Jr=Xl(bn,Mr)}return Es(Nt,Zt,Jr),!0},function(wt,Nt,Zt){if(Nt=Gs(Nt,Zt),Nt!=null){var cr=!1;if(cr=cr===void 0?!1:cr,Mu){if(cr&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(Nt))throw Error("Found an unpaired surrogate");Nt=(su||(su=new TextEncoder)).encode(Nt)}else{for(var Mr=0,zr=new Uint8Array(3*Nt.length),Dr=0;Dr<Nt.length;Dr++){var Jr=Nt.charCodeAt(Dr);if(128>Jr)zr[Mr++]=Jr;else{if(2048>Jr)zr[Mr++]=Jr>>6|192;else{if(55296<=Jr&&57343>=Jr){if(56319>=Jr&&Dr<Nt.length){var bn=Nt.charCodeAt(++Dr);if(56320<=bn&&57343>=bn){Jr=1024*(Jr-55296)+bn-56320+65536,zr[Mr++]=Jr>>18|240,zr[Mr++]=Jr>>12&63|128,zr[Mr++]=Jr>>6&63|128,zr[Mr++]=Jr&63|128;continue}else Dr--}if(cr)throw Error("Found an unpaired surrogate");Jr=65533}zr[Mr++]=Jr>>12|224,zr[Mr++]=Jr>>6&63|128}zr[Mr++]=Jr&63|128}}Nt=Mr===zr.length?zr:zr.subarray(0,Mr)}Wu(wt.h,8*Zt+2),Wu(wt.h,Nt.length),Wt(wt,wt.h.end()),Wt(wt,Nt)}}),tm=em(function(wt,Nt,Zt,cr,Mr){if(wt.i!==2)return!1;Nt=zo(Nt,Zt,cr),Zt=wt.h.j,cr=ep(wt.h)>>>0;var zr=wt.h.h+cr,Dr=zr-Zt;if(0>=Dr&&(wt.h.j=zr,Mr(Nt,wt,void 0,void 0,void 0),Dr=zr-wt.h.h),Dr)throw Error("Message parsing ended unexpectedly. Expected to read "+(cr+" bytes, instead read "+(cr-Dr)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return wt.h.h=zr,wt.h.j=Zt,!0},function(wt,Nt,Zt,cr,Mr){if(Nt=Ws(Nt,cr,Zt),Nt!=null)for(cr=0;cr<Nt.length;cr++){var zr=wt;Wu(zr.h,8*Zt+2);var Dr=zr.h.end();Wt(zr,Dr),Dr.push(zr.i),zr=Dr,Mr(Nt[cr],wt),Dr=wt;var Jr=zr.pop();for(Jr=Dr.i+Dr.h.length()-Jr;127<Jr;)zr.push(Jr&127|128),Jr>>>=7,Dr.i++;zr.push(Jr),Dr.i++}});function im(wt){return function(Nt,Zt){e:{if(tp.length){var cr=tp.pop();cr.setOptions(Zt),So(cr.h,Nt,Zt),Nt=cr}else Nt=new yn(Nt,Zt);try{var Mr=_f(wt),zr=Ns(new Mr.P,Nt,Mr);break e}finally{Mr=Nt.h,Mr.i=null,Mr.m=!1,Mr.l=0,Mr.j=0,Mr.h=0,Mr.S=!1,Nt.l=-1,Nt.i=-1,100>tp.length&&tp.push(Nt)}zr=void 0}return zr}}function oy(wt){return function(){var Nt=new Lr;Ip(this,Nt,ou(wt)),Wt(Nt,Nt.h.end());for(var Zt=new Uint8Array(Nt.i),cr=Nt.j,Mr=cr.length,zr=0,Dr=0;Dr<Mr;Dr++){var Jr=cr[Dr];Zt.set(Jr,zr),zr+=Jr.length}return Nt.j=[Zt],Zt}}function Su(wt){Il.call(this,wt)}Bt(Su,Il);var Xy=[Su,1,gp,2,Tu,3,Mp,4,Mp];Su.prototype.l=oy(Xy);function Pm(wt){Il.call(this,wt,-1,rm)}Bt(Pm,Il),Pm.prototype.addClassification=function(wt,Nt){return zo(this,1,Su,wt,Nt),this};var rm=[1],ay=im([Pm,1,tm,Xy]);function au(wt){Il.call(this,wt)}Bt(au,Il);var nm=[au,1,Tu,2,Tu,3,Tu,4,Tu,5,Tu];au.prototype.l=oy(nm);function Im(wt){Il.call(this,wt,-1,_u)}Bt(Im,Il);var _u=[1],kp=im([Im,1,tm,nm]);function Jl(wt){Il.call(this,wt)}Bt(Jl,Il);var ly=[Jl,1,Tu,2,Tu,3,Tu,4,Tu,5,Tu,6,sy],cy=im(ly);Jl.prototype.l=oy(ly);function uy(wt,Nt,Zt){if(Zt=wt.createShader(Zt===0?wt.VERTEX_SHADER:wt.FRAGMENT_SHADER),wt.shaderSource(Zt,Nt),wt.compileShader(Zt),!wt.getShaderParameter(Zt,wt.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+wt.getShaderInfoLog(Zt));return Zt}function Js(wt){return Ws(wt,Su,1).map(function(Nt){var Zt=Gs(Nt,1);return{index:Zt??0,qa:qo(Nt,2),label:Gs(Nt,3)!=null?po(Gs(Nt,3),""):void 0,displayName:Gs(Nt,4)!=null?po(Gs(Nt,4),""):void 0}})}function Ky(wt){return{x:qo(wt,1),y:qo(wt,2),z:qo(wt,3),visibility:na(wt,4)!=null?qo(wt,4):void 0}}function hy(wt){return Ws(kp(wt),au,1).map(Ky)}function sm(wt,Nt){this.i=wt,this.h=Nt,this.m=0}function ns(wt,Nt,Zt){return Yy(wt,Nt),typeof wt.h.canvas.transferToImageBitmap=="function"?Promise.resolve(wt.h.canvas.transferToImageBitmap()):Zt?Promise.resolve(wt.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(wt.h.canvas):(wt.j===void 0&&(wt.j=document.createElement("canvas")),new Promise(function(cr){wt.j.height=wt.h.canvas.height,wt.j.width=wt.h.canvas.width,wt.j.getContext("2d",{}).drawImage(wt.h.canvas,0,0,wt.h.canvas.width,wt.h.canvas.height),cr(wt.j)}))}function Yy(wt,Nt){var Zt=wt.h;if(wt.s===void 0){var cr=uy(Zt,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),Mr=uy(Zt,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),zr=Zt.createProgram();if(Zt.attachShader(zr,cr),Zt.attachShader(zr,Mr),Zt.linkProgram(zr),!Zt.getProgramParameter(zr,Zt.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+Zt.getProgramInfoLog(zr));cr=wt.s=zr,Zt.useProgram(cr),Mr=Zt.getUniformLocation(cr,"sampler0"),wt.l={O:Zt.getAttribLocation(cr,"aVertex"),N:Zt.getAttribLocation(cr,"aTex"),ya:Mr},wt.v=Zt.createBuffer(),Zt.bindBuffer(Zt.ARRAY_BUFFER,wt.v),Zt.enableVertexAttribArray(wt.l.O),Zt.vertexAttribPointer(wt.l.O,2,Zt.FLOAT,!1,0,0),Zt.bufferData(Zt.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),Zt.STATIC_DRAW),Zt.bindBuffer(Zt.ARRAY_BUFFER,null),wt.u=Zt.createBuffer(),Zt.bindBuffer(Zt.ARRAY_BUFFER,wt.u),Zt.enableVertexAttribArray(wt.l.N),Zt.vertexAttribPointer(wt.l.N,2,Zt.FLOAT,!1,0,0),Zt.bufferData(Zt.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),Zt.STATIC_DRAW),Zt.bindBuffer(Zt.ARRAY_BUFFER,null),Zt.uniform1i(Mr,0)}cr=wt.l,Zt.useProgram(wt.s),Zt.canvas.width=Nt.width,Zt.canvas.height=Nt.height,Zt.viewport(0,0,Nt.width,Nt.height),Zt.activeTexture(Zt.TEXTURE0),wt.i.bindTexture2d(Nt.glName),Zt.enableVertexAttribArray(cr.O),Zt.bindBuffer(Zt.ARRAY_BUFFER,wt.v),Zt.vertexAttribPointer(cr.O,2,Zt.FLOAT,!1,0,0),Zt.enableVertexAttribArray(cr.N),Zt.bindBuffer(Zt.ARRAY_BUFFER,wt.u),Zt.vertexAttribPointer(cr.N,2,Zt.FLOAT,!1,0,0),Zt.bindFramebuffer(Zt.DRAW_FRAMEBUFFER?Zt.DRAW_FRAMEBUFFER:Zt.FRAMEBUFFER,null),Zt.clearColor(0,0,0,0),Zt.clear(Zt.COLOR_BUFFER_BIT),Zt.colorMask(!0,!0,!0,!0),Zt.drawArrays(Zt.TRIANGLE_FAN,0,4),Zt.disableVertexAttribArray(cr.O),Zt.disableVertexAttribArray(cr.N),Zt.bindBuffer(Zt.ARRAY_BUFFER,null),wt.i.bindTexture2d(0)}function xu(wt){this.h=wt}var Lu=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function dy(wt,Nt){return Nt+wt}function ju(wt,Nt){window[wt]=Nt}function qn(wt){var Nt=document.createElement("script");return Nt.setAttribute("src",wt),Nt.setAttribute("crossorigin","anonymous"),new Promise(function(Zt){Nt.addEventListener("load",function(){Zt()},!1),Nt.addEventListener("error",function(){Zt()},!1),document.body.appendChild(Nt)})}function eo(){return Sr(function(wt){switch(wt.h){case 1:return wt.s=2,jt(wt,WebAssembly.instantiate(Lu),4);case 4:wt.h=3,wt.s=0;break;case 2:return wt.s=0,wt.l=null,wt.return(!1);case 3:return wt.return(!0)}})}function Ys(wt){if(this.h=wt,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=wt&&wt.locateFile||dy,typeof window=="object")var Nt=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")Nt=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=Nt,wt.options){Nt=h(Object.keys(wt.options));for(var Zt=Nt.next();!Zt.done;Zt=Nt.next()){Zt=Zt.value;var cr=wt.options[Zt].default;cr!==void 0&&(this.l[Zt]=typeof cr=="function"?cr():cr)}}}e=Ys.prototype,e.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function uu(wt){var Nt,Zt,cr,Mr,zr,Dr,Jr,bn,Qn,as,_s;return Sr(function(gs){switch(gs.h){case 1:return wt.ga?(Nt=wt.h.files===void 0?[]:typeof wt.h.files=="function"?wt.h.files(wt.l):wt.h.files,jt(gs,eo(),2)):gs.return();case 2:if(Zt=gs.i,typeof window=="object")return ju("createMediapipeSolutionsWasm",{locateFile:wt.locateFile}),ju("createMediapipeSolutionsPackedAssets",{locateFile:wt.locateFile}),Dr=Nt.filter(function(Pn){return Pn.data!==void 0}),Jr=Nt.filter(function(Pn){return Pn.data===void 0}),bn=Promise.all(Dr.map(function(Pn){var fn=Lp(wt,Pn.url);if(Pn.path!==void 0){var ro=Pn.path;fn=fn.then(function(Vn){return wt.overrideFile(ro,Vn),Promise.resolve(Vn)})}return fn})),Qn=Promise.all(Jr.map(function(Pn){return Pn.simd===void 0||Pn.simd&&Zt||!Pn.simd&&!Zt?qn(wt.locateFile(Pn.url,wt.ha)):Promise.resolve()})).then(function(){var Pn,fn,ro;return Sr(function(Vn){if(Vn.h==1)return Pn=window.createMediapipeSolutionsWasm,fn=window.createMediapipeSolutionsPackedAssets,ro=wt,jt(Vn,Pn(fn),2);ro.i=Vn.i,Vn.h=0})}),as=function(){return Sr(function(Pn){return wt.h.graph&&wt.h.graph.url?Pn=jt(Pn,Lp(wt,wt.h.graph.url),0):(Pn.h=0,Pn=void 0),Pn})}(),jt(gs,Promise.all([Qn,bn,as]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return cr=Nt.filter(function(Pn){return Pn.simd===void 0||Pn.simd&&Zt||!Pn.simd&&!Zt}).map(function(Pn){return wt.locateFile(Pn.url,wt.ha)}),importScripts.apply(null,dt(cr)),Mr=wt,jt(gs,createMediapipeSolutionsWasm(Module),6);case 6:Mr.i=gs.i,wt.m=new OffscreenCanvas(1,1),wt.i.canvas=wt.m,zr=wt.i.GL.createContext(wt.m,{antialias:!1,alpha:!1,va:typeof WebGL2RenderingContext<"u"?2:1}),wt.i.GL.makeContextCurrent(zr),gs.h=4;break;case 7:if(wt.m=document.createElement("canvas"),_s=wt.m.getContext("webgl2",{}),!_s&&(_s=wt.m.getContext("webgl",{}),!_s))return alert("Failed to create WebGL canvas context when passing video frame."),gs.return();wt.K=_s,wt.i.canvas=wt.m,wt.i.createContext(wt.m,!0,!0,{});case 4:wt.j=new wt.i.SolutionWasm,wt.ga=!1,gs.h=0}})}function Dp(wt){var Nt,Zt,cr,Mr,zr,Dr,Jr,bn;return Sr(function(Qn){if(Qn.h==1){if(wt.h.graph&&wt.h.graph.url&&wt.fa===wt.h.graph.url)return Qn.return();if(wt.u=!0,!wt.h.graph||!wt.h.graph.url){Qn.h=2;return}return wt.fa=wt.h.graph.url,jt(Qn,Lp(wt,wt.h.graph.url),3)}for(Qn.h!=2&&(Nt=Qn.i,wt.j.loadGraph(Nt)),Zt=h(Object.keys(wt.D)),cr=Zt.next();!cr.done;cr=Zt.next())Mr=cr.value,wt.j.overrideFile(Mr,wt.D[Mr]);if(wt.D={},wt.h.listeners)for(zr=h(wt.h.listeners),Dr=zr.next();!Dr.done;Dr=zr.next())Jr=Dr.value,Kl(wt,Jr);bn=wt.l,wt.l={},wt.setOptions(bn),Qn.h=0})}e.reset=function(){var wt=this;return Sr(function(Nt){wt.j&&(wt.j.reset(),wt.s={},wt.v={}),Nt.h=0})},e.setOptions=function(wt,Nt){var Zt=this;if(Nt=Nt||this.h.options){for(var cr=[],Mr=[],zr={},Dr=h(Object.keys(wt)),Jr=Dr.next();!Jr.done;zr={X:zr.X,Y:zr.Y},Jr=Dr.next())if(Jr=Jr.value,!(Jr in this.l&&this.l[Jr]===wt[Jr])){this.l[Jr]=wt[Jr];var bn=Nt[Jr];bn!==void 0&&(bn.onChange&&(zr.X=bn.onChange,zr.Y=wt[Jr],cr.push(function(Qn){return function(){var as;return Sr(function(_s){if(_s.h==1)return jt(_s,Qn.X(Qn.Y),2);as=_s.i,as===!0&&(Zt.u=!0),_s.h=0})}}(zr))),bn.graphOptionXref&&(Jr=Object.assign({},{calculatorName:"",calculatorIndex:0},bn.graphOptionXref,{valueNumber:bn.type===1?wt[Jr]:0,valueBoolean:bn.type===0?wt[Jr]:!1,valueString:bn.type===2?wt[Jr]:""}),Mr.push(Jr)))}(cr.length!==0||Mr.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(Mr),this.F=(this.F===void 0?[]:this.F).concat(cr))}};function Zs(wt){var Nt,Zt,cr,Mr,zr,Dr,Jr;return Sr(function(bn){switch(bn.h){case 1:if(!wt.u)return bn.return();if(!wt.F){bn.h=2;break}Nt=h(wt.F),Zt=Nt.next();case 3:if(Zt.done){bn.h=5;break}return cr=Zt.value,jt(bn,cr(),4);case 4:Zt=Nt.next(),bn.h=3;break;case 5:wt.F=void 0;case 2:if(wt.H){for(Mr=new wt.i.GraphOptionChangeRequestList,zr=h(wt.H),Dr=zr.next();!Dr.done;Dr=zr.next())Jr=Dr.value,Mr.push_back(Jr);wt.j.changeOptions(Mr),Mr.delete(),wt.H=void 0}wt.u=!1,bn.h=0}})}e.initialize=function(){var wt=this;return Sr(function(Nt){return Nt.h==1?jt(Nt,uu(wt),2):Nt.h!=3?jt(Nt,Dp(wt),3):jt(Nt,Zs(wt),0)})};function Lp(wt,Nt){var Zt,cr;return Sr(function(Mr){return Nt in wt.L?Mr.return(wt.L[Nt]):(Zt=wt.locateFile(Nt,""),cr=fetch(Zt).then(function(zr){return zr.arrayBuffer()}),wt.L[Nt]=cr,Mr.return(cr))})}e.overrideFile=function(wt,Nt){this.j?this.j.overrideFile(wt,Nt):this.D[wt]=Nt},e.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},e.send=function(wt,Nt){var Zt=this,cr,Mr,zr,Dr,Jr,bn,Qn,as,_s;return Sr(function(gs){switch(gs.h){case 1:return Zt.h.inputs?(cr=1e3*(Nt??performance.now()),jt(gs,Zt.I,2)):gs.return();case 2:return jt(gs,Zt.initialize(),3);case 3:for(Mr=new Zt.i.PacketDataList,zr=h(Object.keys(wt)),Dr=zr.next();!Dr.done;Dr=zr.next())if(Jr=Dr.value,bn=Zt.h.inputs[Jr]){e:{var Pn=wt[Jr];switch(bn.type){case"video":var fn=Zt.s[bn.stream];if(fn||(fn=new sm(Zt.i,Zt.K),Zt.s[bn.stream]=fn),fn.m===0&&(fn.m=fn.i.createTexture()),typeof HTMLVideoElement<"u"&&Pn instanceof HTMLVideoElement)var ro=Pn.videoWidth,Vn=Pn.videoHeight;else typeof HTMLImageElement<"u"&&Pn instanceof HTMLImageElement?(ro=Pn.naturalWidth,Vn=Pn.naturalHeight):(ro=Pn.width,Vn=Pn.height);Vn={glName:fn.m,width:ro,height:Vn},ro=fn.h,ro.canvas.width=Vn.width,ro.canvas.height=Vn.height,ro.activeTexture(ro.TEXTURE0),fn.i.bindTexture2d(fn.m),ro.texImage2D(ro.TEXTURE_2D,0,ro.RGBA,ro.RGBA,ro.UNSIGNED_BYTE,Pn),fn.i.bindTexture2d(0),fn=Vn;break e;case"detections":for(fn=Zt.s[bn.stream],fn||(fn=new xu(Zt.i),Zt.s[bn.stream]=fn),fn.data||(fn.data=new fn.h.DetectionListData),fn.data.reset(Pn.length),Vn=0;Vn<Pn.length;++Vn){ro=Pn[Vn];var jo=fn.data,Tl=jo.setBoundingBox,ts=Vn,_c=ro.la,go=new Jl;if(ho(go,1,_c.sa),ho(go,2,_c.ta),ho(go,3,_c.height),ho(go,4,_c.width),ho(go,5,_c.rotation),Es(go,6,_c.pa),_c=go.l(),Tl.call(jo,ts,_c),ro.ea)for(jo=0;jo<ro.ea.length;++jo){go=ro.ea[jo],Tl=fn.data,ts=Tl.addNormalizedLandmark,_c=Vn,go=Object.assign({},go,{visibility:go.visibility?go.visibility:0});var Ml=new au;ho(Ml,1,go.x),ho(Ml,2,go.y),ho(Ml,3,go.z),go.visibility&&ho(Ml,4,go.visibility),go=Ml.l(),ts.call(Tl,_c,go)}if(ro.ba)for(jo=0;jo<ro.ba.length;++jo)Tl=fn.data,ts=Tl.addClassification,_c=Vn,go=ro.ba[jo],Ml=new Su,ho(Ml,2,go.qa),go.index&&Es(Ml,1,go.index),go.label&&Es(Ml,3,go.label),go.displayName&&Es(Ml,4,go.displayName),go=Ml.l(),ts.call(Tl,_c,go)}fn=fn.data;break e;default:fn={}}}switch(Qn=fn,as=bn.stream,bn.type){case"video":Mr.pushTexture2d(Object.assign({},Qn,{stream:as,timestamp:cr}));break;case"detections":_s=Qn,_s.stream=as,_s.timestamp=cr,Mr.pushDetectionList(_s);break;default:throw Error("Unknown input config type: '"+bn.type+"'")}}return Zt.j.send(Mr),jt(gs,Zt.I,4);case 4:Mr.delete(),gs.h=0}})};function yp(wt,Nt,Zt){var cr,Mr,zr,Dr,Jr,bn,Qn,as,_s,gs,Pn,fn,ro,Vn;return Sr(function(jo){switch(jo.h){case 1:if(!Zt)return jo.return(Nt);for(cr={},Mr=0,zr=h(Object.keys(Zt)),Dr=zr.next();!Dr.done;Dr=zr.next())Jr=Dr.value,bn=Zt[Jr],typeof bn!="string"&&bn.type==="texture"&&Nt[bn.stream]!==void 0&&++Mr;1<Mr&&(wt.M=!1),Qn=h(Object.keys(Zt)),Dr=Qn.next();case 2:if(Dr.done){jo.h=4;break}if(as=Dr.value,_s=Zt[as],typeof _s=="string")return ro=cr,Vn=as,jt(jo,Mm(wt,as,Nt[_s]),14);if(gs=Nt[_s.stream],_s.type==="detection_list"){if(gs){for(var Tl=gs.getRectList(),ts=gs.getLandmarksList(),_c=gs.getClassificationsList(),go=[],Ml=0;Ml<Tl.size();++Ml){var Ku=cy(Tl.get(Ml)),py=qo(Ku,1),ga=qo(Ku,2),Qy=qo(Ku,3),np=qo(Ku,4),eu=qo(Ku,5,0),Fu=void 0;Fu=Fu===void 0?0:Fu,Ku={la:{sa:py,ta:ga,height:Qy,width:np,rotation:eu,pa:po(Gs(Ku,6),Fu)},ea:hy(ts.get(Ml)),ba:Js(ay(_c.get(Ml)))},go.push(Ku)}Tl=go}else Tl=[];cr[as]=Tl,jo.h=7;break}if(_s.type==="proto_list"){if(gs){for(Tl=Array(gs.size()),ts=0;ts<gs.size();ts++)Tl[ts]=gs.get(ts);gs.delete()}else Tl=[];cr[as]=Tl,jo.h=7;break}if(gs===void 0){jo.h=3;break}if(_s.type==="float_list"){cr[as]=gs,jo.h=7;break}if(_s.type==="proto"){cr[as]=gs,jo.h=7;break}if(_s.type!=="texture")throw Error("Unknown output config type: '"+_s.type+"'");return Pn=wt.v[as],Pn||(Pn=new sm(wt.i,wt.K),wt.v[as]=Pn),jt(jo,ns(Pn,gs,wt.M),13);case 13:fn=jo.i,cr[as]=fn;case 7:_s.transform&&cr[as]&&(cr[as]=_s.transform(cr[as])),jo.h=3;break;case 14:ro[Vn]=jo.i;case 3:Dr=Qn.next(),jo.h=2;break;case 4:return jo.return(cr)}})}function Mm(wt,Nt,Zt){var cr;return Sr(function(Mr){return typeof Zt=="number"||Zt instanceof Uint8Array||Zt instanceof wt.i.Uint8BlobList?Mr.return(Zt):Zt instanceof wt.i.Texture2dDataOut?(cr=wt.v[Nt],cr||(cr=new sm(wt.i,wt.K),wt.v[Nt]=cr),Mr.return(ns(cr,Zt,wt.M))):Mr.return(void 0)})}function Kl(wt,Nt){for(var Zt=Nt.name||"$",cr=[].concat(dt(Nt.wants)),Mr=new wt.i.StringList,zr=h(Nt.wants),Dr=zr.next();!Dr.done;Dr=zr.next())Mr.push_back(Dr.value);zr=wt.i.PacketListener.implement({onResults:function(Jr){for(var bn={},Qn=0;Qn<Nt.wants.length;++Qn)bn[cr[Qn]]=Jr.get(Qn);var as=wt.listeners[Zt];as&&(wt.I=yp(wt,bn,Nt.outs).then(function(_s){_s=as(_s);for(var gs=0;gs<Nt.wants.length;++gs){var Pn=bn[cr[gs]];typeof Pn=="object"&&Pn.hasOwnProperty&&Pn.hasOwnProperty("delete")&&Pn.delete()}_s&&(wt.I=_s)}))}}),wt.j.attachMultiListener(Mr,zr),Mr.delete()}e.onResults=function(wt,Nt){this.listeners[Nt||"$"]=wt},Kr("Solution",Ys),Kr("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"});function xa(wt){switch(wt===void 0&&(wt=0),wt){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function I_(wt){var Nt=this;wt=wt||{},this.h=new Ys({locateFile:wt.locateFile,files:function(Zt){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:xa(Zt.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:hy},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:hy},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(Zt){var cr,Mr,zr;return Sr(function(Dr){return Dr.h==1?(cr=xa(Zt),Mr="third_party/mediapipe/modules/pose_landmark/"+cr,jt(Dr,Lp(Nt.h,cr),2)):(zr=Dr.i,Nt.h.overrideFile(Mr,zr),Dr.return(!0))})}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}e=I_.prototype,e.reset=function(){this.h.reset()},e.close=function(){return this.h.close(),Promise.resolve()},e.onResults=function(wt){this.h.onResults(wt)},e.initialize=function(){var wt=this;return Sr(function(Nt){return jt(Nt,wt.h.initialize(),0)})},e.send=function(wt,Nt){var Zt=this;return Sr(function(cr){return jt(cr,Zt.h.send(wt,Nt),0)})},e.setOptions=function(wt){this.h.setOptions(wt)},Kr("Pose",I_),Kr("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),Kr("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),Kr("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),Kr("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),Kr("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),Kr("VERSION","0.5.1675469404")}).call(commonjsGlobal);var camera_utils={};(function(){function e(br){var Sr=0;return function(){return Sr<br.length?{done:!1,value:br[Sr++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(br,Sr,$r){return br==Array.prototype||br==Object.prototype||(br[Sr]=$r.value),br};function c(br){br=[typeof globalThis=="object"&&globalThis,br,typeof window=="object"&&window,typeof self=="object"&&self,typeof commonjsGlobal=="object"&&commonjsGlobal];for(var Sr=0;Sr<br.length;++Sr){var $r=br[Sr];if($r&&$r.Math==Math)return $r}throw Error("Cannot find global object")}var b=c(this);function $(br,Sr){if(Sr)e:{var $r=b;br=br.split(".");for(var rn=0;rn<br.length-1;rn++){var Zr=br[rn];if(!(Zr in $r))break e;$r=$r[Zr]}br=br[br.length-1],rn=$r[br],Sr=Sr(rn),Sr!=rn&&Sr!=null&&i($r,br,{configurable:!0,writable:!0,value:Sr})}}$("Symbol",function(br){function Sr(Kr){if(this instanceof Sr)throw new TypeError("Symbol is not a constructor");return new $r(rn+(Kr||"")+"_"+Zr++,Kr)}function $r(Kr,Xt){this.g=Kr,i(this,"description",{configurable:!0,writable:!0,value:Xt})}if(br)return br;$r.prototype.toString=function(){return this.g};var rn="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Zr=0;return Sr}),$("Symbol.iterator",function(br){if(br)return br;br=Symbol("Symbol.iterator");for(var Sr="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),$r=0;$r<Sr.length;$r++){var rn=b[Sr[$r]];typeof rn=="function"&&typeof rn.prototype[br]!="function"&&i(rn.prototype,br,{configurable:!0,writable:!0,value:function(){return it(e(this))}})}return br});function it(br){return br={next:br},br[Symbol.iterator]=function(){return this},br}function at(br){var Sr=typeof Symbol<"u"&&Symbol.iterator&&br[Symbol.iterator];return Sr?Sr.call(br):{next:e(br)}}function h(){this.i=!1,this.g=null,this.o=void 0,this.j=1,this.m=0,this.h=null}function dt(br){if(br.i)throw new TypeError("Generator is already running");br.i=!0}h.prototype.l=function(br){this.o=br};function ft(br,Sr){br.h={F:Sr,G:!0},br.j=br.m}h.prototype.return=function(br){this.h={return:br},this.j=this.m};function xt(br){this.g=new h,this.h=br}function Ct(br,Sr){dt(br.g);var $r=br.g.g;return $r?bt(br,"return"in $r?$r.return:function(rn){return{value:rn,done:!0}},Sr,br.g.return):(br.g.return(Sr),kt(br))}function bt(br,Sr,$r,rn){try{var Zr=Sr.call(br.g.g,$r);if(!(Zr instanceof Object))throw new TypeError("Iterator result "+Zr+" is not an object");if(!Zr.done)return br.g.i=!1,Zr;var Kr=Zr.value}catch(Xt){return br.g.g=null,ft(br.g,Xt),kt(br)}return br.g.g=null,rn.call(br.g,Kr),kt(br)}function kt(br){for(;br.g.j;)try{var Sr=br.h(br.g);if(Sr)return br.g.i=!1,{value:Sr.value,done:!1}}catch($r){br.g.o=void 0,ft(br.g,$r)}if(br.g.i=!1,br.g.h){if(Sr=br.g.h,br.g.h=null,Sr.G)throw Sr.F;return{value:Sr.return,done:!0}}return{value:void 0,done:!0}}function Dt(br){this.next=function(Sr){return dt(br.g),br.g.g?Sr=bt(br,br.g.g.next,Sr,br.g.l):(br.g.l(Sr),Sr=kt(br)),Sr},this.throw=function(Sr){return dt(br.g),br.g.g?Sr=bt(br,br.g.g.throw,Sr,br.g.l):(ft(br.g,Sr),Sr=kt(br)),Sr},this.return=function(Sr){return Ct(br,Sr)},this[Symbol.iterator]=function(){return this}}function At(br){function Sr(rn){return br.next(rn)}function $r(rn){return br.throw(rn)}return new Promise(function(rn,Zr){function Kr(Xt){Xt.done?rn(Xt.value):Promise.resolve(Xt.value).then(Sr,$r).then(Kr,Zr)}Kr(br.next())})}$("Promise",function(br){function Sr(Xt){this.h=0,this.i=void 0,this.g=[],this.o=!1;var mr=this.j();try{Xt(mr.resolve,mr.reject)}catch(Ut){mr.reject(Ut)}}function $r(){this.g=null}function rn(Xt){return Xt instanceof Sr?Xt:new Sr(function(mr){mr(Xt)})}if(br)return br;$r.prototype.h=function(Xt){if(this.g==null){this.g=[];var mr=this;this.i(function(){mr.l()})}this.g.push(Xt)};var Zr=b.setTimeout;$r.prototype.i=function(Xt){Zr(Xt,0)},$r.prototype.l=function(){for(;this.g&&this.g.length;){var Xt=this.g;this.g=[];for(var mr=0;mr<Xt.length;++mr){var Ut=Xt[mr];Xt[mr]=null;try{Ut()}catch(Jt){this.j(Jt)}}}this.g=null},$r.prototype.j=function(Xt){this.i(function(){throw Xt})},Sr.prototype.j=function(){function Xt(Jt){return function(Or){Ut||(Ut=!0,Jt.call(mr,Or))}}var mr=this,Ut=!1;return{resolve:Xt(this.A),reject:Xt(this.l)}},Sr.prototype.A=function(Xt){if(Xt===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(Xt instanceof Sr)this.C(Xt);else{e:switch(typeof Xt){case"object":var mr=Xt!=null;break e;case"function":mr=!0;break e;default:mr=!1}mr?this.v(Xt):this.m(Xt)}},Sr.prototype.v=function(Xt){var mr=void 0;try{mr=Xt.then}catch(Ut){this.l(Ut);return}typeof mr=="function"?this.D(mr,Xt):this.m(Xt)},Sr.prototype.l=function(Xt){this.u(2,Xt)},Sr.prototype.m=function(Xt){this.u(1,Xt)},Sr.prototype.u=function(Xt,mr){if(this.h!=0)throw Error("Cannot settle("+Xt+", "+mr+"): Promise already settled in state"+this.h);this.h=Xt,this.i=mr,this.h===2&&this.B(),this.H()},Sr.prototype.B=function(){var Xt=this;Zr(function(){if(Xt.I()){var mr=b.console;typeof mr<"u"&&mr.error(Xt.i)}},1)},Sr.prototype.I=function(){if(this.o)return!1;var Xt=b.CustomEvent,mr=b.Event,Ut=b.dispatchEvent;return typeof Ut>"u"?!0:(typeof Xt=="function"?Xt=new Xt("unhandledrejection",{cancelable:!0}):typeof mr=="function"?Xt=new mr("unhandledrejection",{cancelable:!0}):(Xt=b.document.createEvent("CustomEvent"),Xt.initCustomEvent("unhandledrejection",!1,!0,Xt)),Xt.promise=this,Xt.reason=this.i,Ut(Xt))},Sr.prototype.H=function(){if(this.g!=null){for(var Xt=0;Xt<this.g.length;++Xt)Kr.h(this.g[Xt]);this.g=null}};var Kr=new $r;return Sr.prototype.C=function(Xt){var mr=this.j();Xt.s(mr.resolve,mr.reject)},Sr.prototype.D=function(Xt,mr){var Ut=this.j();try{Xt.call(mr,Ut.resolve,Ut.reject)}catch(Jt){Ut.reject(Jt)}},Sr.prototype.then=function(Xt,mr){function Ut(pn,On){return typeof pn=="function"?function(Zn){try{Jt(pn(Zn))}catch(As){Or(As)}}:On}var Jt,Or,Cr=new Sr(function(pn,On){Jt=pn,Or=On});return this.s(Ut(Xt,Jt),Ut(mr,Or)),Cr},Sr.prototype.catch=function(Xt){return this.then(void 0,Xt)},Sr.prototype.s=function(Xt,mr){function Ut(){switch(Jt.h){case 1:Xt(Jt.i);break;case 2:mr(Jt.i);break;default:throw Error("Unexpected state: "+Jt.h)}}var Jt=this;this.g==null?Kr.h(Ut):this.g.push(Ut),this.o=!0},Sr.resolve=rn,Sr.reject=function(Xt){return new Sr(function(mr,Ut){Ut(Xt)})},Sr.race=function(Xt){return new Sr(function(mr,Ut){for(var Jt=at(Xt),Or=Jt.next();!Or.done;Or=Jt.next())rn(Or.value).s(mr,Ut)})},Sr.all=function(Xt){var mr=at(Xt),Ut=mr.next();return Ut.done?rn([]):new Sr(function(Jt,Or){function Cr(Zn){return function(As){pn[Zn]=As,On--,On==0&&Jt(pn)}}var pn=[],On=0;do pn.push(void 0),On++,rn(Ut.value).s(Cr(pn.length-1),Or),Ut=mr.next();while(!Ut.done)})},Sr});var Bt=typeof Object.assign=="function"?Object.assign:function(br,Sr){for(var $r=1;$r<arguments.length;$r++){var rn=arguments[$r];if(rn)for(var Zr in rn)Object.prototype.hasOwnProperty.call(rn,Zr)&&(br[Zr]=rn[Zr])}return br};$("Object.assign",function(br){return br||Bt});var Tt=this||self,It={facingMode:"user",width:640,height:480};function St(br,Sr){this.video=br,this.i=0,this.h=Object.assign(Object.assign({},It),Sr)}St.prototype.stop=function(){var br=this,Sr,$r,rn,Zr;return At(new Dt(new xt(function(Kr){if(br.g){for(Sr=br.g.getTracks(),$r=at(Sr),rn=$r.next();!rn.done;rn=$r.next())Zr=rn.value,Zr.stop();br.g=void 0}Kr.j=0})))},St.prototype.start=function(){var br=this,Sr;return At(new Dt(new xt(function($r){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||alert("No navigator.mediaDevices.getUserMedia exists."),Sr=br.h,$r.return(navigator.mediaDevices.getUserMedia({video:{facingMode:Sr.facingMode,width:Sr.width,height:Sr.height}}).then(function(rn){Ht(br,rn)}).catch(function(rn){var Zr="Failed to acquire camera feed: "+rn;throw console.error(Zr),alert(Zr),rn}))})))};function jt(br){window.requestAnimationFrame(function(){Kt(br)})}function Ht(br,Sr){br.g=Sr,br.video.srcObject=Sr,br.video.onloadedmetadata=function(){br.video.play(),jt(br)}}function Kt(br){var Sr=null;br.video.paused||br.video.currentTime===br.i||(br.i=br.video.currentTime,Sr=br.h.onFrame()),Sr?Sr.then(function(){jt(br)}):jt(br)}var ir=["Camera"],nr=Tt;ir[0]in nr||typeof nr.execScript>"u"||nr.execScript("var "+ir[0]);for(var kr;ir.length&&(kr=ir.shift());)ir.length||St===void 0?nr[kr]&&nr[kr]!==Object.prototype[kr]?nr=nr[kr]:nr=nr[kr]={}:nr[kr]=St}).call(commonjsGlobal);function IMUSensor(){const{toast:e}=useToast(),i=useQueryClient(),[c,b]=reactExports.useState(!1),[$,it]=reactExports.useState(null),[at,h]=reactExports.useState({accelerometer:{x:0,y:0,z:0},gyroscope:{x:0,y:0,z:0}}),dt=reactExports.useRef(null),ft=reactExports.useRef(null),xt=reactExports.useRef(null),Ct=reactExports.useRef(null),bt=reactExports.useRef(null),kt=reactExports.useRef(null),Dt=reactExports.useRef(null),[At,Bt]=reactExports.useState(!1),[Tt,It]=reactExports.useState(0),St=()=>navigator.bluetooth!==void 0,jt=useMutation({mutationFn:async kr=>{await apiRequest("POST","/api/imu-data",kr)},onSuccess:()=>{i.invalidateQueries({queryKey:["/api/imu-data"]})}});reactExports.useEffect(()=>()=>{var kr;xt.current&&(clearInterval(xt.current),xt.current=null),(kr=ft.current)!=null&&kr.connected&&ft.current.disconnect()},[]),reactExports.useEffect(()=>{var Sr;if(!At){Dt.current&&(Dt.current.stop(),Dt.current=null),(Sr=kt.current)==null||Sr.close(),kt.current=null;return}const kr=new pose.Pose({locateFile:$r=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${$r}`});kr.setOptions({modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!1,minDetectionConfidence:.6,minTrackingConfidence:.6}),kr.onResults($r=>{const rn=bt.current,Zr=rn.getContext("2d");Zr.save(),Zr.clearRect(0,0,rn.width,rn.height),Zr.globalAlpha=.9,Zr.drawImage($r.image,0,0,rn.width,rn.height);const Kr=$r.poseLandmarks||[];let Xt=0;if(Kr.length){const mr=Kr[11],Ut=Kr[12],Jt=Kr[23],Or=Kr[24],Cr=Math.abs(mr.y-Ut.y),pn=Math.abs(Jt.y-Or.y),On=Math.abs(Kr[27].x-Kr[28].x);Xt=Math.max(0,100-(Cr+pn)*300)+Math.min(On*200,40)}It(Math.round(Xt)),Zr.lineWidth=3,Zr.strokeStyle="rgba(99,102,241,0.9)";for(const mr of Kr)Zr.beginPath(),Zr.arc(mr.x*rn.width,mr.y*rn.height,4,0,Math.PI*2),Zr.stroke();Zr.restore()}),kt.current=kr;const br=new camera_utils.Camera(Ct.current,{onFrame:async()=>{await kt.current.send({image:Ct.current})},width:640,height:480});return br.start(),Dt.current=br,()=>{var $r,rn,Zr,Kr;(rn=($r=Dt.current)==null?void 0:$r.stop)==null||rn.call($r),(Kr=(Zr=kt.current)==null?void 0:Zr.close)==null||Kr.call(Zr),Dt.current=null,kt.current=null}},[At]);const Ht=async()=>{b(!0);try{const kr=navigator;if(!kr.bluetooth){b(!1),e({title:" Browser Not Supported",description:"Web Bluetooth is not available. Please use Chrome, Edge, or Opera.",variant:"destructive"});return}console.log("Bluetooth API available, requesting IMU device..."),e({title:" Scanning IMU Sensors...",description:"Please select your IMU/motion sensor from the popup"});const br=await kr.bluetooth.requestDevice({acceptAllDevices:!0,optionalServices:["environmental_sensing","device_information","generic_access","00001800-0000-1000-8000-00805f9b34fb","00001801-0000-1000-8000-00805f9b34fb"]});dt.current=br,e({title:"Connecting...",description:`Connecting to ${br.name||"IMU Sensor"}`});const Sr=await br.gatt.connect();ft.current=Sr;const $r=await Sr.getPrimaryServices();it({name:br.name||"IMU Sensor",id:br.id,connected:!0});let rn=!1;try{for(const Zr of $r){console.log("Service UUID:",Zr.uuid);const Kr=await Zr.getCharacteristics();for(const Xt of Kr)if(console.log("Characteristic UUID:",Xt.uuid,"Properties:",Xt.properties),Xt.properties.notify)try{await Xt.startNotifications(),Xt.addEventListener("characteristicvaluechanged",mr=>{const Ut=mr.target.value;if(Ut.byteLength>=6){const Jt={accelerometer:{x:Ut.getInt16(0,!0)/100,y:Ut.getInt16(2,!0)/100,z:Ut.getInt16(4,!0)/100},gyroscope:{x:Ut.byteLength>=12?Ut.getInt16(6,!0)/100:0,y:Ut.byteLength>=12?Ut.getInt16(8,!0)/100:0,z:Ut.byteLength>=12?Ut.getInt16(10,!0)/100:0}};h(Jt),jt.mutate(Jt)}}),rn=!0,console.log("Subscribed to IMU notifications");break}catch(mr){console.log("Could not subscribe to notifications:",mr)}if(rn)break}}catch(Zr){console.log("Error reading characteristics:",Zr)}rn||(e({title:" Demo Mode Active",description:"Real sensor data unavailable. Using simulated IMU data for demonstration."}),xt.current=setInterval(()=>{const Zr={accelerometer:{x:(Math.random()-.5)*20,y:(Math.random()-.5)*20,z:9.8+(Math.random()-.5)*2},gyroscope:{x:(Math.random()-.5)*360,y:(Math.random()-.5)*360,z:(Math.random()-.5)*360}};h(Zr),jt.mutate(Zr)},500)),e({title:" Connected Successfully!",description:`${br.name||"IMU Sensor"} is now ${rn?"streaming":"simulating"} motion data`}),br.addEventListener("gattserverdisconnected",()=>{it(Zr=>Zr?{...Zr,connected:!1}:null),xt.current&&(clearInterval(xt.current),xt.current=null),e({title:"Device Disconnected",description:"IMU sensor has been disconnected",variant:"destructive"})})}catch(kr){console.error("Bluetooth connection error:",kr);let br="Failed to connect to IMU sensor";kr.name==="NotFoundError"?br="No device was selected. Please try again.":kr.name==="SecurityError"?br="Bluetooth access denied. Check permissions.":kr.message&&(br=kr.message),e({title:" Connection Failed",description:br,variant:"destructive"})}finally{b(!1)}},Kt=()=>{var kr;xt.current&&(clearInterval(xt.current),xt.current=null),(kr=ft.current)!=null&&kr.connected&&(ft.current.disconnect(),it(null),h({accelerometer:{x:0,y:0,z:0},gyroscope:{x:0,y:0,z:0}}),e({title:"Disconnected",description:"IMU sensor has been disconnected"}))},ir=St(),nr=($==null?void 0:$.connected)??!1;return jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsxs("div",{className:"h-screen neuropad-bg pb-16 overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto h-full flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-10 backdrop-blur-xl bg-[hsl(45,35%,93%)]/80 border-b border-[hsl(45,8%,90%)]",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.95},className:"w-10 h-10 rounded-full bg-white shadow-md flex items-center justify-center hover:shadow-lg transition-shadow","data-testid":"button-back",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-[hsl(45,15%,15%)]"})})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-[hsl(45,15%,15%)]",children:"IMU & Body Tracking"}),jsxRuntimeExports.jsx("div",{className:"w-10"})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 space-y-3 mt-4 flex-1 overflow-y-auto",children:[ir?jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-white rounded-xl p-4 shadow-lg border border-[hsl(45,8%,90%)]",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(motion.div,{animate:{scale:[1,1.05,1]},transition:{repeat:1/0,duration:2},className:"w-12 h-12 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center shadow-lg shadow-green-500/30",children:jsxRuntimeExports.jsx(CircleCheck,{className:"w-6 h-6 text-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-[hsl(45,15%,15%)]",children:"IMU Ready"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-[hsl(45,10%,35%)]",children:"Connect your motion sensor"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse shadow-lg shadow-green-500/50"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-green-600",children:"Supported"})]})]})}):jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-red-50 to-rose-50 rounded-xl p-3 shadow-lg shadow-red-500/10 border border-red-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-red-500 flex items-center justify-center shadow-md",children:jsxRuntimeExports.jsx(CircleX,{className:"w-6 h-6 text-white"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-red-800 text-base",children:"Browser Not Supported"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:"Use Chrome, Edge, or Opera"})]})]})}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-xl p-4 shadow-lg border border-[hsl(45,8%,90%)]",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-bold text-[hsl(45,15%,15%)] mb-1",children:($==null?void 0:$.name)||"No Device Connected"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${nr?"bg-green-500 animate-pulse shadow-lg shadow-green-500/50":"bg-gray-400"}`}),jsxRuntimeExports.jsx("p",{className:`text-sm font-semibold ${nr?"text-green-600":"text-gray-500"}`,children:nr?"Connected & Streaming":"Disconnected"})]})]}),jsxRuntimeExports.jsx(motion.div,{animate:{scale:nr?[1,1.1,1]:1},transition:{repeat:nr?1/0:0,duration:2},className:`w-12 h-12 rounded-full flex items-center justify-center shadow-lg ${nr?"bg-gradient-to-br from-purple-500 to-purple-600 shadow-purple-500/30":"bg-gray-100"}`,children:jsxRuntimeExports.jsx(Bluetooth,{className:`w-6 h-6 ${nr?"text-white":"text-gray-400"}`})})]})}),nr&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"space-y-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-[hsl(45,15%,15%)] px-2",children:"Live Motion Data"}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-lg border border-[hsl(45,8%,90%)]",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-md",children:jsxRuntimeExports.jsx(Gauge,{className:"w-4 h-4 text-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-bold text-[hsl(45,15%,15%)] text-sm",children:"Accelerometer"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-[hsl(45,10%,45%)]",children:"m/s"})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 rounded-lg p-2 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-blue-600 font-semibold mb-1",children:"X-Axis"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-bold text-blue-700 tabular-nums",children:at.accelerometer.x.toFixed(2)})]}),jsxRuntimeExports.jsxs("div",{className:"bg-green-50 rounded-lg p-2 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-green-600 font-semibold mb-1",children:"Y-Axis"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-bold text-green-700 tabular-nums",children:at.accelerometer.y.toFixed(2)})]}),jsxRuntimeExports.jsxs("div",{className:"bg-purple-50 rounded-lg p-2 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-purple-600 font-semibold mb-1",children:"Z-Axis"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-bold text-purple-700 tabular-nums",children:at.accelerometer.z.toFixed(2)})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-lg border border-[hsl(45,8%,90%)]",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-md",children:jsxRuntimeExports.jsx(RotateCcw,{className:"w-4 h-4 text-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-bold text-[hsl(45,15%,15%)] text-sm",children:"Gyroscope"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-[hsl(45,10%,45%)]",children:"/s"})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"bg-orange-50 rounded-lg p-2 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-orange-600 font-semibold mb-1",children:"X-Axis"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-bold text-orange-700 tabular-nums",children:at.gyroscope.x.toFixed(2)})]}),jsxRuntimeExports.jsxs("div",{className:"bg-amber-50 rounded-lg p-2 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-600 font-semibold mb-1",children:"Y-Axis"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-bold text-amber-700 tabular-nums",children:at.gyroscope.y.toFixed(2)})]}),jsxRuntimeExports.jsxs("div",{className:"bg-red-50 rounded-lg p-2 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-red-600 font-semibold mb-1",children:"Z-Axis"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-bold text-red-700 tabular-nums",children:at.gyroscope.z.toFixed(2)})]})]})]})]}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"pt-2",children:nr?jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.98},onClick:Kt,className:"w-full rounded-xl py-4 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold shadow-lg shadow-red-500/25 hover:shadow-xl hover:shadow-red-500/30 transition-all","data-testid":"button-disconnect-imu",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(Activity,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{children:"Disconnect Sensor"})]})}):jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.98},onClick:Ht,disabled:c||!ir,className:"w-full rounded-xl py-4 bg-gradient-to-r from-[hsl(48,98%,60%)] to-[hsl(48,90%,55%)] text-[hsl(45,15%,15%)] font-bold shadow-lg shadow-[hsl(48,98%,60%)]/25 hover:shadow-xl hover:shadow-[hsl(48,98%,60%)]/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed","data-testid":"button-connect-imu",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(Activity,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{children:c?"Connecting...":"Connect IMU Sensor"})]})})}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.35},className:"bg-white rounded-xl p-4 shadow-lg border border-[hsl(45,8%,90%)]",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-[hsl(45,15%,15%)] text-sm",children:"Body Tracking"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-[hsl(45,10%,45%)]",children:"Uses camera with realistic overlay"})]}),jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.98},onClick:()=>Bt(kr=>!kr),className:`rounded-full px-4 py-2 text-sm font-bold shadow ${At?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700"}`,"data-testid":"button-toggle-body-tracking",children:At?"Stop":"Start"})]}),jsxRuntimeExports.jsxs("div",{className:"relative rounded-xl overflow-hidden bg-black",children:[jsxRuntimeExports.jsx("video",{ref:Ct,className:"w-full h-64 object-cover",playsInline:!0,muted:!0}),jsxRuntimeExports.jsx("canvas",{ref:bt,className:"absolute inset-0 w-full h-full"}),jsxRuntimeExports.jsxs("div",{className:"absolute bottom-2 right-2 bg-white/80 backdrop-blur rounded-lg px-3 py-1 text-xs font-bold text-indigo-700 shadow",children:["Posture Score: ",Tt]})]}),jsxRuntimeExports.jsx("div",{className:"mt-3",children:jsxRuntimeExports.jsx(Lottie,{animationData:{v:"5.9.0",fr:60,ip:0,op:120,w:300,h:120,nm:"pulse-bar",ddd:0,assets:[],layers:[{ddd:0,ind:1,ty:4,nm:"bar",sr:1,ks:{o:{a:0,k:100},r:{a:0,k:0},p:{a:0,k:[150,60,0]},a:{a:0,k:[0,0,0]},s:{a:0,k:[100,100,100]}},shapes:[{ty:"rc",p:{a:0,k:[0,0]},s:{a:0,k:[260,16]},r:{a:0,k:8}},{ty:"fl",c:{a:0,k:[.38,.38,.98,1]},o:{a:0,k:1}},{ty:"tr",p:{a:0,k:[0,0]},a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},r:{a:0,k:0},o:{a:0,k:100}}]},{ddd:0,ind:2,ty:4,nm:"dot",sr:1,ks:{o:{a:0,k:100},r:{a:0,k:0},p:{a:1,k:[{t:0,s:[20,60,0]},{t:120,s:[280,60,0]}]},a:{a:0,k:[0,0,0]},s:{a:0,k:[100,100,100]}},shapes:[{ty:"el",p:{a:0,k:[0,0]},s:{a:0,k:[14,14]},d:1},{ty:"fl",c:{a:0,k:[1,.8,.2,1]},o:{a:0,k:1}},{ty:"tr",p:{a:0,k:[0,0]},a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},r:{a:0,k:0},o:{a:0,k:100}}]}]},loop:!0,style:{width:300,height:120}})})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-gradient-to-br from-white to-[hsl(45,20%,98%)] rounded-xl p-4 shadow-lg border border-[hsl(45,8%,90%)]",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-[hsl(45,15%,15%)] mb-2 text-sm",children:"About IMU Sensors"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-[hsl(45,10%,45%)] mb-2 leading-relaxed",children:"IMU (Inertial Measurement Unit) sensors track motion, orientation, and position using:"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[hsl(48,98%,60%)] mt-2"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-[hsl(45,10%,45%)] flex-1",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-[hsl(45,15%,15%)]",children:"Accelerometer:"})," Measures acceleration forces"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[hsl(48,98%,60%)] mt-2"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-[hsl(45,10%,45%)] flex-1",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-[hsl(45,15%,15%)]",children:"Gyroscope:"})," Measures rotational velocity"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[hsl(48,98%,60%)] mt-2"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-[hsl(45,10%,45%)] flex-1",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-[hsl(45,15%,15%)]",children:"Magnetometer:"})," Measures magnetic field (optional)"]})]})]})]})]})]}),jsxRuntimeExports.jsx(BottomNavigation,{currentPage:"/imu-sensor"})]})})}function Onboarding(){const[e,i]=reactExports.useState("monitoring"),c=()=>{try{localStorage.setItem("neuro_onboarding_completed","true")}catch{}typeof window<"u"&&(window.location.href="/auth")},b=()=>{c()};return jsxRuntimeExports.jsx(PageTransition,{children:jsxRuntimeExports.jsx("div",{className:"min-h-screen relative flex flex-col items-center justify-center px-6 neuropad-bg",children:jsxRuntimeExports.jsxs(Card,{className:"w-full max-w-md bg-transparent shadow-none border-none",children:[jsxRuntimeExports.jsxs(CardHeader,{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-40 h-40 sm:w-64 sm:h-64 mx-auto flex items-center justify-center mb-4 sm:mb-6",children:jsxRuntimeExports.jsx("img",{src:welcomeImg,alt:"Welcome",className:"w-full h-full object-contain"})}),jsxRuntimeExports.jsx(CardTitle,{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Welcome to NeuroPad"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mt-2 text-sm sm:text-base",children:"Your personal health monitoring companion for diabetic foot care"})]}),jsxRuntimeExports.jsxs(CardContent,{className:"space-y-6",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"text-center",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3 mb-3 sm:mb-4",children:[jsxRuntimeExports.jsxs("button",{className:`w-full rounded-2xl p-2 sm:p-3 bg-transparent shadow-none flex flex-col items-center justify-center border ${e==="monitoring"?"border-primary":"border-transparent"}`,onClick:()=>i("monitoring"),children:[jsxRuntimeExports.jsx(Activity,{className:"h-6 w-6 text-primary mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold",children:"Monitoring"})]}),jsxRuntimeExports.jsxs("button",{className:`w-full rounded-2xl p-2 sm:p-3 bg-transparent shadow-none flex flex-col items-center justify-center border ${e==="prevention"?"border-primary":"border-transparent"}`,onClick:()=>i("prevention"),children:[jsxRuntimeExports.jsx(Shield,{className:"h-6 w-6 text-primary mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold",children:"Prevention"})]}),jsxRuntimeExports.jsxs("button",{className:`w-full rounded-2xl p-2 sm:p-3 bg-transparent shadow-none flex flex-col items-center justify-center border ${e==="caregiver"?"border-primary":"border-transparent"}`,onClick:()=>i("caregiver"),children:[jsxRuntimeExports.jsx(Users,{className:"h-6 w-6 text-primary mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold",children:"Caregiver"})]})]}),jsxRuntimeExports.jsxs("p",{className:"text-gray-700 leading-relaxed text-sm sm:text-base",children:[e==="monitoring"&&"Our smart sensors continuously monitor your foot health, providing real-time insights and alerts.",e==="prevention"&&"Receive customized prevention tips and early warning alerts to maintain optimal foot health.",e==="caregiver"&&"Share your health updates with caregivers and receive timely support."]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between space-x-3 sm:space-x-4 mt-2 sm:mt-4",children:[jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:b,className:"flex-1 py-2 sm:py-3",children:"Skip"}),jsxRuntimeExports.jsx(Button,{onClick:c,className:"flex-1 py-2 sm:py-3",children:"Start"})]})]})]})})})}function Router(){const{isAuthenticated:e,isLoading:i}=useAuth(),c=typeof window<"u"&&localStorage.getItem("neuro_onboarding_completed")==="true";return i?jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center neuropad-bg",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"neuropad-text-secondary",children:"Loading..."})]})}):jsxRuntimeExports.jsxs(Switch,{children:[jsxRuntimeExports.jsx(Route,{path:"/onboarding",component:Onboarding}),jsxRuntimeExports.jsx(Route,{path:"/auth",component:Landing}),c?e?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Route,{path:"/",component:Dashboard}),jsxRuntimeExports.jsx(Route,{path:"/health-tracker",component:HealthTracker}),jsxRuntimeExports.jsx(Route,{path:"/dashboard/articles",component:DashboardArticles}),jsxRuntimeExports.jsx(Route,{path:"/health-tracker/tips",component:HealthTrackerTips}),jsxRuntimeExports.jsx(Route,{path:"/health-tracker/goals",component:HealthTrackerGoals}),jsxRuntimeExports.jsx(Route,{path:"/prevention-tips",component:PreventionTips}),jsxRuntimeExports.jsx(Route,{path:"/prevention-tips/goals",component:PreventionTipsGoals}),jsxRuntimeExports.jsx(Route,{path:"/prevention-tips/reminders",component:PreventionTipsReminders}),jsxRuntimeExports.jsx(Route,{path:"/urgent-alerts/history",component:UrgentAlertsHistory}),jsxRuntimeExports.jsx(Route,{path:"/caregiver-network",component:CaregiverNetwork}),jsxRuntimeExports.jsx(Route,{path:"/caregiver-network/manage",component:CaregiverManage}),jsxRuntimeExports.jsx(Route,{path:"/bluetooth-device",component:BluetoothDevice}),jsxRuntimeExports.jsx(Route,{path:"/imu-sensor",component:IMUSensor}),jsxRuntimeExports.jsx(Route,{path:"/risk-log",component:RiskLog}),jsxRuntimeExports.jsx(Route,{path:"/urgent-alerts",component:UrgentAlerts}),jsxRuntimeExports.jsx(Route,{path:"/footpad-tracking",component:FootpadTracking})]}):jsxRuntimeExports.jsx(Route,{path:"/",component:Landing}):jsxRuntimeExports.jsx(Route,{path:"/",component:Onboarding}),jsxRuntimeExports.jsx(Route,{component:NotFound})]})}function App(){return jsxRuntimeExports.jsx(QueryClientProvider,{client:queryClient,children:jsxRuntimeExports.jsxs(TooltipProvider,{children:[jsxRuntimeExports.jsx(Toaster,{}),jsxRuntimeExports.jsx(Router,{})]})})}const index="";createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(App,{}));
